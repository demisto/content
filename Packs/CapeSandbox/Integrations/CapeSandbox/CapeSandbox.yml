category: Forensics & Malware Analysis
commonfields:
  id: CapeSandbox
  version: -1
configuration:
  - name: url
    display: Server URL
    type: 0
    required: true
    section: Connect
    additionalinfo: Base URL of the CAPE Sandbox.
  - name: api_token
    display: API token
    type: 4
    required: false
    section: Connect
    hiddenusername: true
    additionalinfo: Token value as generated in CAPE. If provided, Username/Password is not required.
  - name: credentials
    display: Username
    displaypassword: Password
    required: false
    section: Connect
    type: 9
    additionalinfo: |
      Required if 'Username and Password' is selected above.
      Provides credentials for token generation.
  - display: Trust any certificate (not secure)
    name: insecure
    required: false
    type: 8
  - display: Use system proxy settings
    name: proxy
    required: false
    type: 8
description: CAPE Sandbox is an Open Source software for automating analysis of suspicious files.
display: Cape Sandbox
name: CapeSandbox
sectionOrder:
  - Connect
  - Collect
script:
  commands:
    - name: cape-file-submit
      description: Submit a file for analysis. Supports PCAP with automatic pcap=1. Polls until the task is reported and then returns the task view.
      polling: true
      arguments:
        - name: entry_id
          description: The War Room entry ID of the file to submit.
          required: true
        - name: package
          description: Analysis package (e.g., ps1).
        - name: timeout
          description: Analysis timeout in seconds.
        - name: priority
          description: Priority to assign to the task (1-3).
        - name: options
          description: Options string (e.g., options:function=DllMain).
        - name: machine
          description: ID of the analysis machine to use.
        - name: platform
          description: Platform name to select the analysis machine from (e.g., windows).
        - name: tags
          description: Comma-separated tags.
        - name: custom
          description: Custom string to pass over the analysis.
        - name: memory
          description: Enable full memory dump (true/false).
        - name: enforce_timeout
          description: Enforce timeout (true/false).
        - name: clock
          description: VM clock (format %m-%d-%Y %H:%M:%S).
      outputs:
        - contextPath: Cape.Task
          description: Task data returned from CAPE when analysis is ready.
          type: Unknown
    - name: cape-file-view
      description: View file information by Task ID, MD5, or SHA256.
      arguments:
        - name: task_id
          description: Task ID.
        - name: md5
          description: MD5 hash.
        - name: sha256
          description: SHA256 hash.
      outputs:
        - contextPath: Cape.File.id
          description: File/task ID.
          type: String
        - contextPath: Cape.File.file_type
          description: File type.
          type: String
        - contextPath: Cape.File.md5
          description: MD5.
          type: String
        - contextPath: Cape.File.crc32
          description: CRC32.
          type: String
        - contextPath: Cape.File.sha256
          description: SHA256.
          type: String
        - contextPath: Cape.File.sha512
          description: SHA512.
          type: String
        - contextPath: Cape.File.parent
          description: Parent.
          type: String
        - contextPath: Cape.File.source_url
          description: Source URL.
          type: String
    - name: cape-sample-download
      description: Download a sample from a Task by Task ID, MD5, SHA1 or SHA256.
      arguments:
        - name: task_id
          description: Task ID.
        - name: md5
          description: MD5 hash.
        - name: sha1
          description: SHA1 hash.
        - name: sha256
          description: SHA256 hash.
      outputs: []
    - name: cape-url-submit
      description: Submit a URL for analysis. Polls until the task is reported and then returns the task view.
      polling: true
      arguments:
        - name: url
          description: The URL to analyze.
          required: true
        - name: package
          description: Analysis package.
        - name: timeout
          description: Analysis timeout in seconds.
        - name: priority
          description: Priority to assign to the task (1-3).
        - name: options
          description: Options string (e.g., options:function=DllMain).
        - name: machine
          description: ID of the analysis machine to use.
        - name: platform
          description: Platform name to select the analysis machine from (e.g., windows).
        - name: tags
          description: Comma-separated tags.
        - name: custom
          description: Custom string to pass over the analysis.
        - name: memory
          description: Enable full memory dump (true/false).
        - name: enforce_timeout
          description: Enforce timeout (true/false).
        - name: clock
          description: VM clock (format %m-%d-%Y %H:%M:%S).
        - name: polling
          deprecated: false
          defaultValue: "true"
          description: "Cape generic polling"
          required: false
          isArray: false
          auto: PREDEFINED
          predefined:
            - "true"
            - "false"
        - name: pollingInterval
          description: The polling interval **in seconds**. We strongly recommend an interval of 60 seconds or more to prevent API throttling by the CAPE server.
          required: false
        - name: pollingTimeout
          description: Total time allowed **in seconds** for the XSOAR polling sequence to complete.
          required: false

      outputs:
        - contextPath: Cape.Task
          description: Task data returned from CAPE when analysis is ready.
          type: Unknown
    - name: cape-task-delete
      description: Delete CAPE task by ID.
      arguments:
        - name: task_id
          description: Task ID to delete.
          required: true
      outputs: []
    - name: cape-tasks-list
      description: Returns list of tasks. If task_id is provided, returns the task details.
      arguments:
        - name: task_id
          description: Task ID to retrieve (optional).
        - name: page
          description: Page number (starts at 1).
        - name: page_size
          description: Page size (API max is 50).
          defaultValue: 50
        # REMOVED: The 'limit' argument is removed as it was redundant with page_size.
      outputs:
        - contextPath: Cape.Task
          description: Task data.
          type: Unknown
          isArray: true
    - name: cape-task-report-get
      description: Returns the report associated with the specified task ID. If zip=true, a ZIP file is returned for download.
      arguments:
        - name: task_id
          description: Task ID.
          required: true
        - name: format
          description: Report format.
          auto: PREDEFINED
          defaultValue: "json"
          predefined:
            - "json"
            - "maec"
            - "maec5"
            - "metadata"
            - "lite"
            - "all"
        - name: zip
          description: Download report as ZIP file.
          type: 8
          defaultValue: "false"
      outputs:
        - contextPath: Cape.Task.Report
          description: Details from the CAPE analysis report info object.
          type: Unknown
    - name: cape-pcap-file-download
      description: Download the PCAP network dump file associated with the task ID.
      arguments:
        - name: task_id
          description: Task ID.
          required: true
      outputs: []
    - name: cape-task-screenshot-download
      description: Download screenshots for a task. If 'screenshot' is provided, downloads that single screenshot.
      arguments:
        - name: task_id
          description: Task ID.
          required: true
        - name: screenshot
          description: Specific screenshot number to download (optional). If not provided, all are downloaded.
      outputs: []
    - name: cape-machines-list
      description: Returns a list of analysis machines. If machine_name is provided, returns details for that machine.
      arguments:
        - name: machine_name
          description: Machine name to fetch (optional).
        - name: all_results
          description: Return all machines, ignoring the limit (true/false).
          defaultValue: "false"
          auto: PREDEFINED
          predefined:
            - "true"
            - "false"
        - name: limit
          description: Maximum number of machines to return when listing.
          defaultValue: 50
      outputs:
        - contextPath: Cape.Machine
          description: Machine data.
          type: Unknown
    - name: cape-cuckoo-status-get
      description: Returns overall CAPE/Cuckoo status. Human-readable only.
      arguments: []
      outputs: []
    - name: cape-task-poll
      description: Internal command used by cape-file-submit and cape-url-submit for polling status.
      polling: true
      internal: true
      arguments:
        - name: hide_polling_output
          hidden: true
        - name: task_id
          description: The ID of the task to poll.
          required: true
        - name: polling
          deprecated: false
          defaultValue: "true"
          description: "Cape generic polling"
          required: false
          isArray: false
          auto: PREDEFINED
          predefined:
            - "true"
            - "false"
        - name: pollingInterval
          description: The polling interval **in seconds**. We strongly recommend an interval of 60 seconds or more to prevent API throttling by the CAPE server.
          required: false
        - name: pollingTimeout
          description: Total time allowed **in seconds** for the XSOAR polling sequence to complete.
          required: false

      outputs: []
  isfetch: false
  runonce: false
  script: ""
  type: python
  subtype: python3
  dockerimage: demisto/python3:3.12.11.4508456
fromversion: 6.1.0
marketplaces:
  - xsoar
  - marketplacev2
tests:
  - No tests (auto formatted)
