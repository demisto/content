commonfields:
  id: CapeSandbox
  version: -1
name: CapeSandbox
display: Cape Sandbox
category: Forensics & Malware Analysis
description: CAPE Sandbox is an Open Source software for automating analysis of suspicious files.
sectionOrder:
  - Connect
configuration:
  - name: url
    display: Server URL
    type: 0
    required: true
    section: Connect
    additionalinfo: Base URL of the CAPE Sandbox
  - display: Username
    name: credentials
    displaypassword: Password
    type: 9
    required: false
    section: Connect
    additionalinfo: Provide either Username + Password or an API token.
  - name: api_token
    display: API token
    type: 4
    required: false
    section: Connect
    additionalinfo: Token value as generated in CAPE. If provided, Username/Password is not required.
  - name: insecure
    display: Trust any certificate (not secure)
    type: 8
    required: false
    defaultvalue: "false"
    section: Connect
    advanced: true
  - name: proxy
    display: Use system proxy settings
    type: 8
    required: false
    defaultvalue: "false"
    section: Connect
    advanced: true
script:
  script: ""
  dockerimage: demisto/python3:3.12.11.4417419
  isfetch: false
  commands:
    - name: cape-file-submit
      polling: true
      description: Submit a file for analysis. Supports PCAP with automatic pcap=1. Polls until the task is reported and then returns the task view.
      arguments:
        - name: entry_id
          description: The War Room entry ID of the file to submit.
          required: true
        - name: package
          description: Analysis package (e.g., ps1)
        - name: timeout
          description: Analysis timeout in seconds
        - name: priority
          description: Priority to assign to the task (1-3)
        - name: options
          description: Options string (e.g., options:function=DllMain)
        - name: machine
          description: ID of the analysis machine to use
        - name: platform
          description: Platform name to select the analysis machine from (e.g., windows)
        - name: tags
          description: Comma-separated tags
        - name: custom
          description: Custom string to pass over the analysis
        - name: memory
          description: Enable full memory dump (true/false)
        - name: enforce_timeout
          description: Enforce timeout (true/false)
        - name: clock
          description: VM clock (format %m-%d-%Y %H:%M:%S)
      outputs:
        - contextPath: Cape.Task
          description: Task data returned from CAPE when analysis is ready
          type: Unknown
    - name: cape-url-submit
      description: Submit a URL for analysis. Polls until the task is reported and then returns the task view.
      arguments:
        - name: url
          description: The URL to analyze
          required: true
        - name: package
          description: Analysis package
        - name: timeout
          description: Analysis timeout in seconds
        - name: priority
          description: Priority to assign to the task (1-3)
        - name: options
          description: Options string (e.g., options:function=DllMain)
        - name: machine
          description: ID of the analysis machine to use
        - name: platform
          description: Platform name to select the analysis machine from (e.g., windows)
        - name: tags
          description: Comma-separated tags
        - name: custom
          description: Custom string to pass over the analysis
        - name: memory
          description: Enable full memory dump (true/false)
        - name: enforce_timeout
          description: Enforce timeout (true/false)
        - name: clock
          description: VM clock (format %m-%d-%Y %H:%M:%S)
      outputs:
        - contextPath: Cape.Task
          description: Task data returned from CAPE when analysis is ready
          type: Unknown
    - name: cape-file-view
      description: View file information by task ID, MD5, or SHA256.
      arguments:
        - name: task_id
          description: Task ID
        - name: md5
          description: MD5 hash
        - name: sha256
          description: SHA256 hash
      outputs:
        - contextPath: Cape.Task.File.id
          description: File/task ID
          type: String
        - contextPath: Cape.Task.File.file_type
          description: File type
          type: String
        - contextPath: Cape.Task.File.md5
          description: MD5
          type: String
        - contextPath: Cape.Task.File.crc32
          description: CRC32
          type: String
        - contextPath: Cape.Task.File.sha256
          description: SHA256
          type: String
        - contextPath: Cape.Task.File.sha512
          description: SHA512
          type: String
        - contextPath: Cape.Task.File.parent
          description: Parent
          type: String
        - contextPath: Cape.Task.File.source_url
          description: Source URL
          type: String
    - name: cape-task-delete
      description: Delete CAPE task(s) by ID. When multiple IDs are provided, each is deleted sequentially.
      arguments:
        - name: task_id
          description: Task ID(s) to delete
          required: true
          isArray: true
      outputs: []
    - name: cape-tasks-list
      description: Returns list of tasks. If task_id is provided, returns the task details.
      arguments:
        - name: task_id
          description: Task ID to retrieve (optional)
        - name: page
          description: Page number (starts at 1)
        - name: page_siz
          description: Page size (API max is 50)
        - name: limit
          description: Alias for page_size (API max is 50)
          defaultValue: "50"
      outputs:
        - contextPath: Cape.Task
          description: Task data
          type: Unknown
    - name: cape-task-report-get
      description: Returns the report associated with the specified task ID. If zip=true, a ZIP file is returned for download.
      arguments:
        - name: task_id
          description: Task ID
          required: true
        - name: format
          description: Report format
          predefined: [json, maec, maec5, metadata, lite, all, dist, dropped]
        - name: zip
          description: Download report as ZIP file
          type: 8
          defaultValue: "false"
      outputs:
        - contextPath: Cape.Task.Report.id
          description: Task ID
          type: String
        - contextPath: Cape.Task.Report.started
          description: Started time
          type: String
        - contextPath: Cape.Task.Report.ended
          description: Ended time
          type: String
        - contextPath: Cape.Task.Report.category
          description: Category
          type: String
        - contextPath: Cape.Task.Report.machine
          description: Machine
          type: String
        - contextPath: Cape.Task.Report.package
          description: Package
          type: String
        - contextPath: Cape.Task.Report.tlp
          description: TLP
          type: String
        - contextPath: Cape.Task.Report.options
          description: Options
          type: String
        - contextPath: Cape.Task.Report.source_url
          description: Source URL
          type: String
        - contextPath: Cape.Task.Report.route
          description: Route
          type: String
        - contextPath: Cape.Task.Report.user_id
          description: User ID
          type: String
    - name: cape-machines-list
      description: Returns a list of analysis machines. If machine_name is provided, returns details for that machine.
      arguments:
        - name: machine_name
          description: Machine name to fetch (optional)
        - name: all_results
          description: Return all machines, ignoring the limit (true/false)
          type: 8
          defaultValue: "false"
        - name: limit
          description: Maximum number of machines to return when listing
          defaultValue: "50"
      outputs:
        - contextPath: Cape.Machine
          description: Machine data
          type: Unknown
    - name: cape-status-get
      description: Returns overall CAPE/Cuckoo status. Human-readable only.
      arguments: []
      outputs: []
tests:
  - No tests (auto formatted)
fromversion: 6.10.0
marketplaces: #TODO remove marketplacev2?
  - xsoar
  - marketplacev2
