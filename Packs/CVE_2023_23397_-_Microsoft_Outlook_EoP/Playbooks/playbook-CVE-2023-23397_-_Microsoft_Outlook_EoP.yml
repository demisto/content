id: CVE-2023-23397 - Microsoft Outlook EoP
version: -1
name: CVE-2023-23397 - Microsoft Outlook EoP
description: "### CVE-2023-23397 - Critical Elevation of Privilege vulnerability in Microsoft Outlook \n\n#### Summary \nMicrosoft Threat Intelligence discovered limited, targeted abuse of a vulnerability in Microsoft Outlook for Windows that allows for new technology LAN manager (NTLM) credential theft. Microsoft has released CVE-2023-23397 to address the critical elevation of privilege (EoP) vulnerability affecting Microsoft Outlook for Windows. We strongly recommend all customers update Microsoft Outlook for Windows to remain secure.\n\n#### Affected Products \nAll supported versions of Microsoft Outlook for Windows are affected. Other versions of Microsoft Outlook such as Android, iOS, Mac, as well as Outlook on the web and other M365 services are not affected.\n\n#### Technical Details \nCVE-2023-23397 is a critical EoP vulnerability in Microsoft Outlook that is triggered when an attacker sends a message with an extended MAPI property with a UNC path to an SMB (TCP 445) share on a threat actor-controlled server. No user interaction is required.\n\nThe threat actor is using a connection to the remote SMB server sends the userâ€™s NTLM negotiation message, which the attacker can then relay for authentication against other systems that support NTLM authentication.\n\n**This playbook should be triggered manually or can be configured as a job.** \nPlease create a new incident and choose the CVE-2023-23397 - Microsoft Outlook EoP  playbook and Rapid Breach Response incident type.\n\n**The playbook includes the following tasks:**\n\n**Hunting:**\n- Microsoft PowerShell hunting script\n- Advanced SIEM hunting queries\n- Indicators hunting\n\n**Mitigations:**\n- Microsoft official CVE-2023-23397 patch\n- Microsoft workarounds\n- Detection Rules\n    - Yara\n\n**References:**\n\n[Microsoft Mitigates Outlook Elevation of Privilege Vulnerability](https://msrc.microsoft.com/blog/2023/03/microsoft-mitigates-outlook-elevation-of-privilege-vulnerability/)\n[CVE-2023-23397 Audit & Eradication Script](https://github.com/microsoft/CSS-Exchange/blob/a4c096e8b6e6eddeba2f42910f165681ed64adf7/docs/Security/CVE-2023-23397.md)\n[Neo23x0 Yara Rules](https://github.com/Neo23x0/signature-base/blob/master/yara/expl_outlook_cve_2023_23397.yar)\n\nNote: This is a beta playbook, which lets you implement and test pre-release software. Since the playbook is beta, it might contain bugs. Updates to the pack during the beta phase might include non-backward compatible features. We appreciate your feedback on the quality and usability of the pack to help us identify issues, fix them, and continually improve."
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: bf12d27c-1ac2-4fe1-896a-41199b347044
    type: start
    task:
      id: bf12d27c-1ac2-4fe1-896a-41199b347044
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "1"
      - "21"
      - "45"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 40
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: fa42cf99-3a7c-4eaa-8d7d-f45912174f93
    type: title
    task:
      id: fa42cf99-3a7c-4eaa-8d7d-f45912174f93
      version: -1
      name: Collect Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "20"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 890,
          "y": 190
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: 7f013a5c-42cc-4c70-827d-e7af4e5882b2
    type: regular
    task:
      id: 7f013a5c-42cc-4c70-827d-e7af4e5882b2
      version: -1
      name: Microsoft PS hunting script
      description: Sends a HTTP request with advanced capabilities
      scriptName: HttpV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      filename:
        simple: CVE-2023-23397.ps1
      method:
        simple: GET
      save_as_file:
        simple: "yes"
      unsecure:
        simple: "True"
      url:
        simple: https://raw.githubusercontent.com/microsoft/CSS-Exchange/a4c096e8b6e6eddeba2f42910f165681ed64adf7/Security/src/CVE-2023-23397/CVE-2023-23397.ps1
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 320
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: 2363610e-9e02-46e1-80d6-9cde602f68eb
    type: title
    task:
      id: 2363610e-9e02-46e1-80d6-9cde602f68eb
      version: -1
      name: Tag Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "5"
      - "4"
      - "22"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 490
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: ae33f774-e7ec-4374-8ea9-5b5025a0f767
    type: regular
    task:
      id: ae33f774-e7ec-4374-8ea9-5b5025a0f767
      version: -1
      name: Link Indicators To Incident
      description: commands.local.cmd.associate.indicators
      script: Builtin|||associateIndicatorsToIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      incidentId:
        complex:
          root: incident
          accessor: id
      indicatorsValues:
        complex:
          root: IP
          accessor: Address
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: CVE.ID
                iscontext: true
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 20,
          "y": 640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: 93495d42-e42d-471a-8ff0-fb07de943d8b
    type: regular
    task:
      id: 93495d42-e42d-471a-8ff0-fb07de943d8b
      version: -1
      name: Tag CVE Indicators
      description: Create indicators to the Threat Intel database only if they are not registered. When using the script with many indicators, or when the Threat Intel Management database is highly populated, this script may have low performance issue.
      scriptName: CreateNewIndicatorsOnly
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      indicator_values:
        complex:
          root: CVE
          accessor: ID
      tags:
        simple: Outlook, 0-day, Microsoft
      type:
        simple: CVE
    reputationcalc: 2
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: 9acb4dad-e9a7-41b3-8c39-e0624c5c67a4
    type: title
    task:
      id: 9acb4dad-e9a7-41b3-8c39-e0624c5c67a4
      version: -1
      name: Threat Hunting
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "7"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1100
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: 597cbcec-ab40-4557-8c3a-20c27804b0cd
    type: title
    task:
      id: 597cbcec-ab40-4557-8c3a-20c27804b0cd
      version: -1
      name: SIEM Advanced Hunting
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "8"
      - "9"
      - "14"
      - "13"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: 43ee6cdf-703e-4952-8f57-4f6fdd2c321f
    type: condition
    task:
      id: 43ee6cdf-703e-4952-8f57-4f6fdd2c321f
      version: -1
      name: Is Splunk Enabled?
      description: Check if Splunk instance is enabled.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "24"
      "Yes":
      - "17"
    separatecontext: false
    conditions:
    - label: "Yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: SplunkPy
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 670,
          "y": 1380
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: 0ccf2492-c288-4a31-8307-e689064bd2c1
    type: condition
    task:
      id: 0ccf2492-c288-4a31-8307-e689064bd2c1
      version: -1
      name: Is QRadar Enabled?
      description: Check if Splunk instance is enabled.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "24"
      "Yes":
      - "23"
    separatecontext: false
    conditions:
    - label: "Yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: QRadar_v2
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 230,
          "y": 1380
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: db12e671-7c53-449e-8731-441eace92937
    type: title
    task:
      id: db12e671-7c53-449e-8731-441eace92937
      version: -1
      name: Set Rapid Breach Response Layout
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "12"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 810
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: a94eaebe-f3da-44ce-83d4-af1fdcdd9233
    type: playbook
    task:
      id: a94eaebe-f3da-44ce-83d4-af1fdcdd9233
      version: -1
      name: Rapid Breach Response - Set Incident Info
      description: This playbook is responsible for setting up the Rapid Breach Response Incident Info tab in the layout.
      playbookName: Rapid Breach Response - Set Incident Info
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "6"
    scriptarguments:
      SourceOfIndicators:
        simple: https://www.deepinstinct.com/blog/cve-2023-23397-exploitations-in-the-wild-what-you-need-to-know
      countTotalIndicators:
        complex:
          root: CVE
          accessor: ID
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: IP.Address
                iscontext: true
          - operator: uniq
          - operator: count
      playbookDescription:
        complex:
          root: inputs.PlaybookDescription
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 450,
          "y": 940
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: fb680adc-7457-4c78-83f2-f0d65c58257b
    type: condition
    task:
      id: fb680adc-7457-4c78-83f2-f0d65c58257b
      version: -1
      name: Is Elasticsearch Enabled?
      description: Check whether the values provided in arguments are equal. If either of the arguments are missing, no is returned.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "24"
      "Yes":
      - "19"
    separatecontext: false
    conditions:
    - label: "Yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Elasticsearch
                    ignorecase: true
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1110,
          "y": 1380
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "14":
    id: "14"
    taskid: 3552fc8b-26e9-4524-82ba-47bb2a709a2a
    type: condition
    task:
      id: 3552fc8b-26e9-4524-82ba-47bb2a709a2a
      version: -1
      name: Is Azure Log Analytics Enabled?
      description: Returns 'yes' if integration brand is available. Otherwise returns 'no'
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "24"
      "yes":
      - "15"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Azure Log Analytics
                    ignorecase: true
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                    ignorecase: true
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -210,
          "y": 1380
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "15":
    id: "15"
    taskid: 31139cd7-3c4e-4b30-876e-6732db753d70
    type: regular
    task:
      id: 31139cd7-3c4e-4b30-876e-6732db753d70
      version: -1
      name: Outlook initiating connection to WebDAV or SMB share
      description: |-
        Detects outlook initiating connection to a WebDAV or SMB share, which could be a sign of CVE-2023-23397 exploitation, based on the following Sigma rule:

        [CVE-2023-23397 Exploitation Attempt](https://github.com/SigmaHQ/sigma/blob/b52abdef5c2929933dbaee5ae5a2edd1be0981c5/rules/windows/builtin/security/win_security_exploit_cve_2023_23397_outlook_remote_file_query.yml)
      script: '|||azure-log-analytics-execute-query'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "24"
    scriptarguments:
      query:
        simple: SecurityEvent | where ((EventID == 4656 or EventID == 4663) and ProcessName endswith @'\OUTLOOK.EXE' and Accesses contains 'Query key value' and ObjectName contains @'\REGISTRY\MACHINE\SYSTEM' and ObjectName contains @'Services\' and (ObjectName endswith @'WebClient\NetworkProvider' or ObjectName endswith @'LanmanWorkstation\NetworkProvider'))
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -210,
          "y": 1560
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: 62bf161e-4084-4f08-8201-f3f444c014a3
    type: regular
    task:
      id: 62bf161e-4084-4f08-8201-f3f444c014a3
      version: -1
      name: Outlook initiating connection to WebDAV or SMB share
      description: |-
        Detects outlook initiating connection to a WebDAV or SMB share, which could be a sign of CVE-2023-23397 exploitation, based on the following Sigma rule:

        [CVE-2023-23397 Exploitation Attempt](https://github.com/SigmaHQ/sigma/blob/b52abdef5c2929933dbaee5ae5a2edd1be0981c5/rules/windows/builtin/security/win_security_exploit_cve_2023_23397_outlook_remote_file_query.yml)
      script: '|||splunk-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "24"
    scriptarguments:
      query:
        simple: source="WinEventLog:Security" AND ((EventCode="4656" OR EventCode="4663") AND ProcessName="*\\OUTLOOK.EXE" AND Accesses="*Query key value*" AND ObjectName="*\\REGISTRY\\MACHINE\\SYSTEM*" AND ObjectName="*Services\\*" AND (ObjectName="*WebClient\\NetworkProvider" OR ObjectName="*LanmanWorkstation\\NetworkProvider"))
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 670,
          "y": 1560
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: 003cd572-d572-4ba4-8e74-11838d73fe54
    type: regular
    task:
      id: 003cd572-d572-4ba4-8e74-11838d73fe54
      version: -1
      name: Outlook initiating connection to WebDAV or SMB share
      description: |-
        Detects outlook initiating connection to a WebDAV or SMB share, which could be a sign of CVE-2023-23397 exploitation, based on the following Sigma rule:

        [CVE-2023-23397 Exploitation Attempt](https://github.com/SigmaHQ/sigma/blob/b52abdef5c2929933dbaee5ae5a2edd1be0981c5/rules/windows/builtin/security/win_security_exploit_cve_2023_23397_outlook_remote_file_query.yml)
      script: Elasticsearch v2|||es-eql-search
      type: regular
      iscommand: true
      brand: Elasticsearch v2
    nexttasks:
      '#none#':
      - "24"
    scriptarguments:
      query:
        simple: (winlog.channel:"Security" AND winlog.event_id:("4656" OR "4663") AND winlog.event_data.ProcessName:*\\OUTLOOK.EXE AND Accesses:*Query\ key\ value* AND winlog.event_data.ObjectName:*\\REGISTRY\\MACHINE\\SYSTEM* AND winlog.event_data.ObjectName:*Services\\* AND winlog.event_data.ObjectName:(*WebClient\\NetworkProvider OR *LanmanWorkstation\\NetworkProvider))
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1110,
          "y": 1560
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: 5320f40a-a8e6-4ea2-8cc7-faf3398bbb16
    type: regular
    task:
      id: 5320f40a-a8e6-4ea2-8cc7-faf3398bbb16
      version: -1
      name: Collect IoCs from DeepInstinct
      description: This script will extract indicators from given HTML and will handle bad top-level domains to avoid false positives caused by file extensions.
      scriptName: ParseHTMLIndicators
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      url:
        simple: https://www.deepinstinct.com/blog/cve-2023-23397-exploitations-in-the-wild-what-you-need-to-know
    reputationcalc: 2
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 890,
          "y": 320
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: 65ffe443-7ca8-47de-876d-fbf2e27fc39e
    type: title
    task:
      id: 65ffe443-7ca8-47de-876d-fbf2e27fc39e
      version: -1
      name: Download IR Tools
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "2"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: 521f06be-e2d7-41bc-8f07-276fa1464308
    type: regular
    task:
      id: 521f06be-e2d7-41bc-8f07-276fa1464308
      version: -1
      name: Tag IP Indicators
      description: Create indicators to the Threat Intel database only if they are not registered. When using the script with many indicators, or when the Threat Intel Management database is highly populated, this script may have low performance issue.
      scriptName: CreateNewIndicatorsOnly
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      indicator_values:
        complex:
          root: IP
          accessor: Address
      tags:
        simple: Outlook, 0-day, Microsoft
      type:
        simple: IP
    reputationcalc: 2
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 880,
          "y": 640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: b44510b0-ecad-42a9-8b8d-c804cbecfe63
    type: playbook
    task:
      id: b44510b0-ecad-42a9-8b8d-c804cbecfe63
      version: -1
      name: Outlook initiating connection to WebDAV or SMB share
      description: This playbook runs a QRadar query and return its results to the context.
      playbookName: QRadarFullSearch
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "24"
    scriptarguments:
      interval:
        simple: "1"
      query_expression:
        simple: SELECT UTF8(payload) from events where LOGSOURCETYPENAME(devicetype)='Microsoft Windows Security Event Log' and ("EventID" = '4656' or "EventID" = '4663') and UTF8(payload) ILIKE '%\OUTLOOK.EXE' and UTF8(payload) ILIKE '%Query key value%' and "ObjectName" ilike '%\REGISTRY\MACHINE\SYSTEM%' and "ObjectName" ilike '%Services\%' and ("ObjectName" ilike '%WebClient\NetworkProvider' or "ObjectName" ilike '%LanmanWorkstation\NetworkProvider')
      timeout:
        simple: "600"
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 230,
          "y": 1560
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: b956591d-4b27-40bb-8dd0-8a6c942b60a0
    type: title
    task:
      id: b956591d-4b27-40bb-8dd0-8a6c942b60a0
      version: -1
      name: PowerShell Hunting
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "25"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1730
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: f0aa0dab-5d4e-4ffe-8d66-c2894eea6702
    type: regular
    task:
      id: f0aa0dab-5d4e-4ffe-8d66-c2894eea6702
      version: -1
      name: Run CVE-2023-23397 hunting script
      description: |-
        Please refer to the Microsoft release notes for the full steps needed for the script execution.

        [CVE-2023-23397 PowerShell Hunting Script](https://microsoft.github.io/CSS-Exchange/Security/CVE-2023-23397/)

        The file is ready to be used in the incident War Room, you can also find it by filtering for '**huntingScript**' tag.

        File name: CVE-2023-23397.ps1
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "26"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1860
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: 1640a5d2-aa6e-4f0e-8df3-7e838ea66feb
    type: collection
    task:
      id: 1640a5d2-aa6e-4f0e-8df3-7e838ea66feb
      version: -1
      name: Verify PowerShell hunting script results
      description: Check Microsoft PowerShell script execution results for further investigation.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "27"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
        simple: Verify PowerShell hunting script results
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: Found any suspicious email files?
        required: true
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - {}
        - simple: "Yes"
        - simple: "No"
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      title: Verify PowerShell hunting script results
      description: ""
      sender: ""
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: 9e21d556-159a-43f6-87a2-986861e01b9d
    type: condition
    task:
      id: 9e21d556-159a-43f6-87a2-986861e01b9d
      version: -1
      name: Found suspicious email files?
      description: User input for whether results were found in the script execution.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "40"
      "yes":
      - "28"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Verify PowerShell hunting script results.Answers
                accessor: "0"
            iscontext: true
          right:
            value:
              simple: "yes"
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: f8ace49c-e90d-40cf-8ba3-6c556662cec9
    type: condition
    task:
      id: f8ace49c-e90d-40cf-8ba3-6c556662cec9
      version: -1
      name: Upload email files for analysis?
      description: Asks the user for the eml files for further analysis.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      Manual:
      - "41"
      "Yes":
      - "30"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -210,
          "y": 2360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: 8682fa3d-c5a3-4c56-8d84-fd5c6e1af9aa
    type: playbook
    task:
      id: 8682fa3d-c5a3-4c56-8d84-fd5c6e1af9aa
      version: -1
      name: Process Email - Generic v2
      description: |
        This playbook adds email details to the relevant context entities and handles original email attachments.

        The v2 playbook enables parsing email artifacts more efficiently, including:
        - Using incident fields and not incident labels.
        - Providing separate paths to "Phishing Alerts".
        - Using the new "Get Original Email - Generic v2" playbook to retrieve original emails as EML files from the following integrations:
          * EWS v2
          * Microsoft Graph Mail integration
          * Gmail
          * FireEye EX and FireEye CM
          * Proofpoint Protection Server
          * Agari Phishing Defense (EWS v2, MSGraph Mail, Gmail)
          * Mimecast
      playbookName: Process Email - Generic v2
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "40"
    scriptarguments:
      Email:
        complex:
          root: incident
          accessor: emailto
      EmailCC:
        complex:
          root: incident
          accessor: emailcc
      EmailFileToExtract:
        simple: Inner file
      EmailFormat:
        complex:
          root: incident
          accessor: emailformat
      EmailFrom:
        complex:
          root: incident
          accessor: emailfrom
      EmailHeaders:
        complex:
          root: incident
          accessor: phishingreporteremailheaders
      EmailHtml:
        complex:
          root: incident
          accessor: emailhtml
      EmailSubject:
        complex:
          root: incident
          accessor: emailsubject
      EmailText:
        complex:
          root: incident
          accessor: emailbody
      File:
        complex:
          root: File
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: File.Extension
                iscontext: true
              right:
                value:
                  simple: eml
              ignorecase: true
      GetOriginalEmail:
        simple: "False"
      MessageID:
        complex:
          root: incident
          accessor: emailmessageid
      Thread-Topic:
        complex:
          root: incident
          accessor: emailsubject
      UserID:
        complex:
          root: incident
          accessor: emailto
          transformers:
          - operator: replaceMatch
            args:
              regex:
                value:
                  simple: (?i).*<([A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,})>
              replaceWith:
                value:
                  simple: $1
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
      forEach: true
    view: |-
      {
        "position": {
          "x": -210,
          "y": 2710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: 9a397f55-738d-43f7-884c-07bfd5e7faa5
    type: collection
    task:
      id: 9a397f55-738d-43f7-884c-07bfd5e7faa5
      version: -1
      name: Upload suspicious emails for processing
      description: Upload the eml files.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "29"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -210,
          "y": 2550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
        simple: Upload suspicious emails for processing
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
        required: false
        gridcolumns: []
        defaultrows: []
        type: attachments
        options: []
        optionsarg: []
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      title: Please upload the suspicious email files
      description: ""
      sender: ""
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: da6916ba-fcf0-4be9-8fa0-634f225cca96
    type: playbook
    task:
      id: da6916ba-fcf0-4be9-8fa0-634f225cca96
      version: -1
      name: Threat Hunting - Generic
      playbookName: Threat Hunting - Generic
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "35"
    separatecontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 3020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: a42e7e2e-00e5-4eef-8105-bfdab412d4e2
    type: condition
    task:
      id: a42e7e2e-00e5-4eef-8105-bfdab412d4e2
      version: -1
      name: Should continue with the investigation?
      description: Whether to continue with the investigation or close it.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "39"
      "Yes":
      - "38"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 3850
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: 61a214b6-9c1b-4834-8f27-87cb8c193829
    type: condition
    task:
      id: 61a214b6-9c1b-4834-8f27-87cb8c193829
      version: -1
      name: Should block indicators automatically?
      description: Checks whether to block the indicators automatically.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "37"
      "yes":
      - "36"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.autoBlockIndicators
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 3180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: 79059585-743a-46d1-83a8-66fd2cb48929
    type: playbook
    task:
      id: 79059585-743a-46d1-83a8-66fd2cb48929
      version: -1
      name: Block Indicators - Generic v3
      playbookName: Block Indicators - Generic v3
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "42"
    separatecontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 670,
          "y": 3350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: 0345f447-729c-47a3-8e08-5a341df18e89
    type: regular
    task:
      id: 0345f447-729c-47a3-8e08-5a341df18e89
      version: -1
      name: Handle indicators manually
      description: Manual task for indicators handling.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "42"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 230,
          "y": 3350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: 8ac741ea-62b7-4a00-883d-67cfc88c2ab1
    type: regular
    task:
      id: 8ac741ea-62b7-4a00-883d-67cfc88c2ab1
      version: -1
      name: Investigate further
      description: Continue with the investigation manually.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "39"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 890,
          "y": 4020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: 9a7ff786-dd6a-4a84-82c8-f2de1652322c
    type: title
    task:
      id: 9a7ff786-dd6a-4a84-82c8-f2de1652322c
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 4190
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: f54e4a48-896a-4cb5-8633-634881f980ff
    type: title
    task:
      id: f54e4a48-896a-4cb5-8633-634881f980ff
      version: -1
      name: Indicators Hunting
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "32"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "41":
    id: "41"
    taskid: 8240d593-1a59-4fba-8980-cfb94544bde5
    type: regular
    task:
      id: 8240d593-1a59-4fba-8980-cfb94544bde5
      version: -1
      name: Review found email files manually
      description: Manual review of the found suspicious email files.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "40"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 220,
          "y": 2550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "42":
    id: "42"
    taskid: 0a54ed67-5618-4e6f-8fa3-5d0086aac136
    type: title
    task:
      id: 0a54ed67-5618-4e6f-8fa3-5d0086aac136
      version: -1
      name: Mitigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "43"
      - "44"
      - "47"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 3520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "43":
    id: "43"
    taskid: 49a7e4ad-a88d-4eee-8ef2-99b9dd4ebba3
    type: regular
    task:
      id: 49a7e4ad-a88d-4eee-8ef2-99b9dd4ebba3
      version: -1
      name: Microsoft mitigating factors
      description: "#### Protected Users Security Group\n\nAdd users to the Protected Users Security Group, which prevents the use of NTLM as an authentication mechanism.\nPerforming this mitigation makes troubleshooting easier than other methods of disabling NTLM. Consider using it for high value accounts such as Domain Admins when possible. Please note: \nThis may cause impact to applications that require NTLM, however the settings will revert once the user is removed from the Protected Users Group. \n\n#### Block TCP 445/SMB\n\nBlock TCP 445/SMB outbound from your network by using a perimeter firewall, a local firewall, and via your VPN settings. This will prevent the sending of NTLM authentication messages to remote file shares.\n"
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "34"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 3670
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "44":
    id: "44"
    taskid: de69e403-3169-4fdb-8fe8-1eb4b15e610e
    type: regular
    task:
      id: de69e403-3169-4fdb-8fe8-1eb4b15e610e
      version: -1
      name: Patch vulnerable servers
      description: |-
        Download Microsoft's latest security updates and patch all vulnerable servers.

        [Microsoft Outlook Elevation of Privilege Vulnerability
        ](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-23397)
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "34"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 890,
          "y": 3670
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "45":
    id: "45"
    taskid: 84b3ce1f-416d-4833-853c-c02c6ac93016
    type: title
    task:
      id: 84b3ce1f-416d-4833-853c-c02c6ac93016
      version: -1
      name: Download Signatures
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "46"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 10,
          "y": 180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "46":
    id: "46"
    taskid: a5cb1cb7-f02d-4433-8e90-361a4dbfd01f
    type: regular
    task:
      id: a5cb1cb7-f02d-4433-8e90-361a4dbfd01f
      version: -1
      name: Download Yara Rules
      description: |-
        This file contains multiple Yara rules provided by Neo23x0.

        Reference: [expl_outlook_cve_2023_23397.yar](https://github.com/Neo23x0/signature-base/blob/master/yara/expl_outlook_cve_2023_23397.yar)
      tags:
      - Yara
      scriptName: HttpV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      filename:
        simple: expl_outlook_cve_2023_23397.yar
      method:
        simple: GET
      save_as_file:
        simple: "yes"
      unsecure:
        simple: "True"
      url:
        simple: https://raw.githubusercontent.com/Neo23x0/signature-base/master/yara/expl_outlook_cve_2023_23397.yar
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 10,
          "y": 320
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "47":
    id: "47"
    taskid: 30216756-b693-4cf5-837b-8d35977940f1
    type: regular
    task:
      id: 30216756-b693-4cf5-837b-8d35977940f1
      version: -1
      name: Deploy Yara rules
      description: |
        The Yara rules file is ready to be used in the incident War Room, you can also find it by filtering for '**Yara**' tag.

        File name: expl_outlook_cve_2023_23397.yar
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "34"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 10,
          "y": 3670
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "52":
    id: "52"
    taskid: f461f437-c82b-4f85-8879-4d15921c45e2
    type: title
    task:
      id: f461f437-c82b-4f85-8879-4d15921c45e2
      version: -1
      name: IPS Signatures
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "53"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1330,
          "y": 1920
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "53":
    id: "53"
    taskid: 15447708-b337-4406-8383-6aebfad745fc
    type: playbook
    task:
      id: 15447708-b337-4406-8383-6aebfad745fc
      version: -1
      name: Panorama Query Logs
      playbookName: Panorama Query Logs
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "40"
    scriptarguments:
      log_type:
        simple: threat
      query:
        simple: (threatid eq 93584) or (threatid eq 1110542)
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": -1330,
          "y": 2080
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "54":
    id: "54"
    taskid: f8f5e156-2dfe-4b2c-8ea6-78890edceee8
    type: playbook
    task:
      id: f8f5e156-2dfe-4b2c-8ea6-78890edceee8
      version: -1
      name: Search Endpoint by CVE - Generic
      playbookName: Search Endpoint by CVE - Generic
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "40"
    scriptarguments:
      CVE_ID:
        complex:
          root: CVE
          accessor: ID
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 2760,
          "y": 2080
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "55":
    id: "55"
    taskid: 51bcface-7da2-4e14-8d7f-b45539027380
    type: title
    task:
      id: 51bcface-7da2-4e14-8d7f-b45539027380
      version: -1
      name: Endpoints by CVE Hunting
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "54"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2760,
          "y": 1890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "13_19_Yes": 0.4,
      "13_24_#default#": 0.41,
      "14_15_yes": 0.4,
      "14_24_#default#": 0.41,
      "27_28_yes": 0.73,
      "27_40_#default#": 0.2,
      "28_30_Yes": 0.43,
      "28_41_Manual": 0.65,
      "35_36_yes": 0.41,
      "8_17_Yes": 0.42,
      "8_24_#default#": 0.48,
      "9_23_Yes": 0.4,
      "9_24_#default#": 0.49
    },
    "paper": {
      "dimensions": {
        "height": 4215,
        "width": 1700,
        "x": -210,
        "y": 40
      }
    }
  }
inputs:
- key: PlaybookDescription
  value:
    simple: "### CVE-2023-23397 - Critical Elevation of Privilege vulnerability in Microsoft Outlook \n\n#### Summary \nMicrosoft Threat Intelligence discovered limited, targeted abuse of a vulnerability in Microsoft Outlook for Windows that allows for new technology LAN manager (NTLM) credential theft. Microsoft has released CVE-2023-23397 to address the critical elevation of privilege (EoP) vulnerability affecting Microsoft Outlook for Windows. We strongly recommend all customers update Microsoft Outlook for Windows to remain secure.\n\n#### Affected Products \nAll supported versions of Microsoft Outlook for Windows are affected. Other versions of Microsoft Outlook such as Android, iOS, Mac, as well as Outlook on the web and other M365 services are not affected.\n\n#### Technical Details \nCVE-2023-23397 is a critical EoP vulnerability in Microsoft Outlook that is triggered when an attacker sends a message with an extended MAPI property with a UNC path to an SMB (TCP 445) share on a threat actor-controlled server. No user interaction is required.\n\nThe threat actor is using a connection to the remote SMB server sends the userâ€™s NTLM negotiation message, which the attacker can then relay for authentication against other systems that support NTLM authentication.\n\n**This playbook should be triggered manually or can be configured as a job.** \nPlease create a new incident and choose the CVE-2023-23397 - Microsoft Outlook EoP  playbook and Rapid Breach Response incident type.\n\n**The playbook includes the following tasks:**\n\n**Hunting:**\n- Panorama Threat IDs\n- Cortex XDR XQL hunting query\n- Microsoft PowerShell hunting script\n- Advanced SIEM hunting queries\n- Indicators hunting\n- Endpoint by CVE hunting\n\n**Mitigations:**\n- Microsoft official CVE-2023-23397 patch\n- Microsoft workarounds\n- Detection Rules\n    - Yara\n\n**References:**\n\n[Microsoft Mitigates Outlook Elevation of Privilege Vulnerability](https://msrc.microsoft.com/blog/2023/03/microsoft-mitigates-outlook-elevation-of-privilege-vulnerability/)\n\n[CVE-2023-23397 Audit & Eradication Script](https://github.com/microsoft/CSS-Exchange/blob/a4c096e8b6e6eddeba2f42910f165681ed64adf7/docs/Security/CVE-2023-23397.md)\n\n[Neo23x0 Yara Rules](https://github.com/Neo23x0/signature-base/blob/master/yara/expl_outlook_cve_2023_23397.yar)\n\nNote: This is a beta playbook, which lets you implement and test pre-release software. Since the playbook is beta, it might contain bugs. Updates to the pack during the beta phase might include non-backward compatible features. We appreciate your feedback on the quality and usability of the pack to help us identify issues, fix them, and continually improve."
  required: false
  description: The playbook description to be used in the Rapid Breach Response - Set Incident Info sub-playbook.
  playbookInputQuery:
- key: autoBlockIndicators
  value:
    simple: "False"
  required: false
  description: Whether to block the indicators automatically.
  playbookInputQuery:
outputs: []
tests:
- No tests (auto formatted)
fromversion: 6.8.0
