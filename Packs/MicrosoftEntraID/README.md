<~XSIAM>

## What does this pack do

The Azure Logs pack contains data normalization rules for ingesting various Azure log types that are collected via the [Office 365](https://docs-cortex.paloaltonetworks.com/r/Cortex-XSIAM/Cortex-XSIAM-Documentation/Ingest-logs-from-Microsoft-Office-365) and [Azure Event Hub](https://docs-cortex.paloaltonetworks.com/r/Cortex-XSIAM/Cortex-XSIAM-Documentation/Ingest-logs-from-Microsoft-Azure-Event-Hub) data sources, and modeling them to the Cortex Data Model (XDM).

### Supported Log Types 

The normalization rules included in this pack supports the following log types: 

  | Log Type                                                                                                                                                                                                                     | Target Dataset | XSIAM Collector | Timestamp Field         | 
  |:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------| :------------------------- | :------------------- |:------------------------|
  | Microsoft Entra ID (Azure AD) [authentication logs](https://learn.microsoft.com/en-us/entra/identity/monitoring-health/concept-sign-ins)                                                                                     | `msft_azure_ad_raw` | Office 365 | `CreatedDateTime`       |
  | Microsoft Entra ID (Azure AD) [audit logs](https://learn.microsoft.com/en-us/entra/identity/monitoring-health/concept-audit-logs)                                                                                            | `msft_azure_ad_audit_raw` | Office 365 | `ActivityDateTime`      |            
  | Active Directory Federation Service Sign-in logs ([ADFSSignInLogs](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/adfssigninlogs))                                                                   | `msft_azure_raw` | Azure Event Hub | `ActivityDateTime`      | 
  | Audit logs for Azure Active Directory ([AuditLogs](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/auditlogs]))                                                                                       | `msft_azure_raw` | Azure Event Hub | `ActivityDateTime`      |                                                        
  | Managed identity Azure Active Directory sign-in logs ([ManagedIdentitySignInLogs](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/aadmanagedidentitysigninlogs))                                      | `msft_azure_raw`| Azure Event Hub | `CreatedDateTime`       |    
  | Non-interactive Azure Active Directory sign-in logs from user ([NonInteractiveUserSignInLogs](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/aadnoninteractiveusersigninlogs))                       | `msft_azure_raw` | Azure Event Hub | `CreatedDateTime`       |    
  | Logs generated by Azure AD Provisioning ([ProvisioningLogs](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/aadprovisioninglogs))                                                                     | `msft_azure_raw` | Azure Event Hub | `ActivityDateTime`      |    
  | Logs generated by identity protection for Azure AD risky service principals ([RiskyServicePrincipals](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/aadriskyserviceprincipals))                     | `msft_azure_raw` | Azure Event Hub | `RiskLastUpdatedDateTime` |    
  | Logs generated by Identity Protection for Azure AD Risky Users ([RiskyUsers](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/aadriskyusers))                                                          | `msft_azure_raw` | Azure Event Hub | `RiskLastUpdatedDateTime` |    
  | Logs generated by identity protection for Azure AD service principal risk events ([ServicePrincipalRiskEvents](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/aadserviceprincipalriskevents))        | `msft_azure_raw`| Azure Event Hub | `ActivityDateTime`      |    
  | Service principal Azure Active Directory sign-in logs ([ServicePrincipalSignInLogs](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/aadserviceprincipalsigninlogs))                                   | `msft_azure_raw` | Azure Event Hub | `CreatedDateTime`       |     
  | Sign-in Logs ([SignInLogs](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/signinlogs))                                                                                                               | `msft_azure_raw` | Azure Event Hub | `CreatedDateTime`       |    
  | Logs generated by Identity Protection for Azure AD User Risk Events ([UserRiskEvents](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/aaduserriskevents))                                             | `msft_azure_raw` | Azure Event Hub | `ActivityDateTime`      |
  | Activity Logs ([Activity Logs](https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/activity-log-schema), [AzureActivity](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/azureactivity)) | `msft_azure_raw` | Azure Event Hub | `ActivityDateTime` / `TimeGenerated`   |


### Other Azure Log Types 
There are additional Azure log types which are collected via the [Azure Event Hub](https://docs-cortex.paloaltonetworks.com/r/Cortex-XSIAM/Cortex-XSIAM-Documentation/Ingest-logs-from-Microsoft-Azure-Event-Hub) data source that are normalized into XDM via separate dedicated packs.   
See the table below that lists these additional log types, along the relevant marketplace pack that handles their XDM modeling. 

  | Log Type | Marketplace Pack | 
  | :------------------------------------------------------------------------------------------------------------------------ | :-------------------------------------------------------------------------------------- |
  | [Azure Firewall Resource Logs](https://learn.microsoft.com/en-us/azure/firewall/monitor-firewall-reference#resource-logs) | [Azure Firewall](https://cortex.marketplace.pan.dev/marketplace/details/AzureFirewall/) |
  | [Azure WAF Resource Logs](https://learn.microsoft.com/en-us/azure/application-gateway/monitor-application-gateway-reference#resource-logs) | [Azure WAF](https://cortex.marketplace.pan.dev/marketplace/details/AzureWAF/) |

***

## Data Collection

### Azure Entra ID Logs 

To collect Azure Entra ID logs and ingest them into the *`msft_azure_ad_raw`* and *`msft_azure_ad_audit_raw`* datasets, you will need to configure an instance of the **Office 365** data source as described [here](https://docs-cortex.paloaltonetworks.com/r/Cortex-XSIAM/Cortex-XSIAM-Documentation/Ingest-logs-from-Microsoft-Office-365).

When configuring the Office 365 data source, mark the following checkboxes under the *Microsoft Graph API* section, as demonstrated in the screenshot below:
* **`Azure AD Authentication Logs`** 
  * **`Collect all sign-in event types`**
* **`Azure AD Audit Logs`**

![MicrosoftEntraID_Office_365](https://raw.githubusercontent.com/demisto/content/refs/heads/master/Packs/MicrosoftEntraID/doc_files/MicrosoftEntraID_Office_365.png)

### Azure Event Hub Logs

To collect Azure Logs from an Azure Event Hub and ingest them into the *`msft_azure_raw`* dataset, you will need to configure an instance of the **Azure Event Hub** data source as described [here](https://docs-cortex.paloaltonetworks.com/r/Cortex-XSIAM/Cortex-XSIAM-Documentation/Ingest-logs-from-Microsoft-Azure-Event-Hub).

When configuring the Azure Event Hub data source, mark the following checkbox under the *Enhanced Cloud Protection* section, as demonstrated in the screenshot below:
* **`Use audit logs in analytics`** 

![MicrosoftEntraID_Azure_Event_Hub](https://raw.githubusercontent.com/demisto/content/refs/heads/master/Packs/MicrosoftEntraID/doc_files/MicrosoftEntraID_Azure_Event_Hub.png)

</~XSIAM>