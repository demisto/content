id: 92eb37ab-8999-4a46-8a88-17bff8fe9731
version: 72
vcShouldKeepItemLegacyProdMachine: false
name: DSPM Multi-Cloud Risk Remediation
description: The playbook ensures efficient incident resolution and compliance with
  security policies by guiding the user through decision points based on incident
  type, such as empty storage assets or assets open to the world. It concludes by
  updating the incident status and closing the playbook upon resolution.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: bf838bc6-fd32-4cfb-8907-d8ab44600b88
    type: start
    task:
      id: bf838bc6-fd32-4cfb-8907-d8ab44600b88
      version: -1
      name: ""
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "25"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1667.5,
          "y": 50
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: d71509bd-4b68-4fd5-847a-750dad4f305a
    type: regular
    task:
      id: d71509bd-4b68-4fd5-847a-750dad4f305a
      version: -1
      name: Closed current  Incident playbook
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    scriptarguments:
      closeReason:
        simple: Resolved
      id:
        simple: ${incident.id}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 530,
          "y": 3060
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: 146a7e3d-6f4f-4325-84c3-0266aa8c5f22
    type: regular
    task:
      id: 146a7e3d-6f4f-4325-84c3-0266aa8c5f22
      version: -1
      name: Get DSPM risk details
      scriptName: DSPMExtractRiskDetails
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "35"
    scriptarguments:
      incident_object:
        simple: ${incident}
    results:
    - userSlackEmail
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1667.5,
          "y": 195
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: 871cd1d0-8209-4cef-8888-edbe6284b589
    type: regular
    task:
      id: 871cd1d0-8209-4cef-8888-edbe6284b589
      version: -1
      name: Create a Slackblock list to send a user notification displaying risk information.
      description: This XSOAR automation script generates a Slack message block to
        notify users of risks detected by a Data Security Posture Management (DSPM)
        tool. The Slack block is dynamically constructed based on the details of the
        security incident and includes options for users to take specific actions,
        such as creating a Jira ticket or remediating the risk.
      scriptName: DSPMCreateRiskSlackBlocks
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "36"
    scriptarguments:
      dspm_incident:
        simple: ${incident_object}
      list_of_project:
        simple: ${projects_list}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1340,
          "y": 590
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 2c01d0a1-08ee-456a-8122-d8fb59844756
    type: regular
    task:
      id: 2c01d0a1-08ee-456a-8122-d8fb59844756
      version: -1
      name: Removing ${block_list_name} list from XSOAR LIST
      scriptName: DSPMRemoveSlackBlockList
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "60"
    scriptarguments:
      list_name:
        simple: ${block_list_name}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 530,
          "y": 2680
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: a3fa951e-294b-4dd2-8186-eb09df490d17
    type: condition
    task:
      id: a3fa951e-294b-4dd2-8186-eb09df490d17
      version: -1
      name: Error while retrieving DSPM risk details?
      description: This script checks for error entries based on provided entry IDs
        and returns "yes" if any errors are found or "no" if no errors are present.
        If errors are detected, it sets the error messages in the XSOAR context.
      scriptName: DSPMCheckAndSetErrorEntries
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "27"
      "yes":
      - "50"
    scriptarguments:
      entry_id:
        simple: ${lastCompletedTaskEntries}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1667.5,
          "y": 390
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: 3aa32a75-bc46-4852-8f17-df11598270d5
    type: condition
    task:
      id: 3aa32a75-bc46-4852-8f17-df11598270d5
      version: -1
      name: 'Errors occurred when developing the Slack block list for the incident
        ID : ${incident.id}'
      description: This script checks for error entries based on provided entry IDs
        and returns "yes" if any errors are found or "no" if no errors are present.
        If errors are detected, it sets the error messages in the XSOAR context.
      scriptName: DSPMCheckAndSetErrorEntries
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "52"
      "yes":
      - "51"
    scriptarguments:
      entry_id:
        simple: ${lastCompletedTaskEntries}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1340,
          "y": 815
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: 39b683cb-15fc-4ca0-8f13-12e163012ba8
    type: regular
    task:
      id: 39b683cb-15fc-4ca0-8f13-12e163012ba8
      version: -1
      name: closeInvestigation
      description: Close the current incident
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    scriptarguments:
      closeNotes:
        simple: Closing the playbook before sending notification to user.
      closeReason:
        simple: Unable to fetch the list of project.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2010,
          "y": 775
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: b99382b5-a6ec-49a5-865f-378c34948474
    type: regular
    task:
      id: b99382b5-a6ec-49a5-865f-378c34948474
      version: -1
      name: closeInvestigation
      description: Close the current incident
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    scriptarguments:
      closeNotes:
        simple: Closing the playbook before sending notification to user.
      closeReason:
        simple: Unable to create custom slack block for this incident.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1630,
          "y": 1280
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "50":
    id: "50"
    taskid: 81fb07ed-ba19-4d62-8034-268f5dffd01e
    type: playbook
    task:
      id: 81fb07ed-ba19-4d62-8034-268f5dffd01e
      version: -1
      name: DSPM Error Notification
      description: The DSPM Notify User in Case of Error playbook is designed to handle
        errors in DSPM incidents by notifying users and managing Slack notifications.
      playbookName: DSPM notify user in case of error
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "37"
    separatecontext: false
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 2010,
          "y": 580
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "51":
    id: "51"
    taskid: c9419eba-bb51-4c5f-87de-b0f936257ebc
    type: playbook
    task:
      id: c9419eba-bb51-4c5f-87de-b0f936257ebc
      version: -1
      name: DSPM notify user in case of error
      description: The DSPM Notify User in Case of Error playbook is designed to handle
        errors in DSPM incidents by notifying users and managing Slack notifications.
      playbookName: DSPM notify user in case of error
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "38"
    separatecontext: false
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1630,
          "y": 1070
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "52":
    id: "52"
    taskid: 6738ba14-d13e-466b-8ce5-3ce42f8af0a7
    type: playbook
    task:
      id: 6738ba14-d13e-466b-8ce5-3ce42f8af0a7
      version: -1
      name: Send Slack Notification to User
      playbookName: DSPM Send Slack Notification to User
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "61"
    separatecontext: false
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1100,
          "y": 1070
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "53":
    id: "53"
    taskid: 8c4e75b3-095d-4bd9-85bd-4eb6868f3b58
    type: regular
    task:
      id: 8c4e75b3-095d-4bd9-85bd-4eb6868f3b58
      version: -1
      name: Add incident for re-run
      scriptName: DSPMIncidentList
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "28"
    scriptarguments:
      action:
        simple: add
      incident_data:
        simple: ${incident_object}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 850,
          "y": 2460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "60":
    id: "60"
    taskid: b3651460-49ae-4c14-8bd2-33f4e8b684f9
    type: regular
    task:
      id: b3651460-49ae-4c14-8bd2-33f4e8b684f9
      version: -1
      name: Delete incident from INCIDENT LIST
      scriptName: DSPMIncidentList
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      action:
        simple: delete
      incident_data:
        simple: ${incident_object}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 530,
          "y": 2870
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "61":
    id: "61"
    taskid: 568e1c3d-4b36-42d4-8f6f-4ec55e38da80
    type: condition
    task:
      id: 568e1c3d-4b36-42d4-8f6f-4ec55e38da80
      version: -1
      name: Check if the user action is invalid?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      Invalid response:
      - "62"
      Valid response:
      - "67"
    separatecontext: false
    conditions:
    - label: Invalid response
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: User.Action
            iscontext: true
          right:
            value:
              simple: invalid_response
    - label: Valid response
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: User.Action
            iscontext: true
          right:
            value:
              simple: jira
        - operator: isEqualString
          left:
            value:
              simple: User.Action
            iscontext: true
          right:
            value:
              simple: no_response
        - operator: isEqualString
          left:
            value:
              simple: User.Action
            iscontext: true
          right:
            value:
              simple: remediate
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1100,
          "y": 1280
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "62":
    id: "62"
    taskid: fec31c2d-8d60-488b-824c-c837166b7794
    type: playbook
    task:
      id: fec31c2d-8d60-488b-824c-c837166b7794
      version: -1
      name: DSPM Invalid User Response
      playbookName: DSPM Invalid User Response
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "63"
    separatecontext: false
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 530,
          "y": 1465
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "63":
    id: "63"
    taskid: 88493bf0-afee-4721-8ace-a08465534d89
    type: condition
    task:
      id: 88493bf0-afee-4721-8ace-a08465534d89
      version: -1
      name: Is there any error occurred in DSPM Invalid Response playbook?
      description: Check whether given entry/entries returned an error. Use ${lastCompletedTaskEntries}
        to check the previous task entries. If array is provided, will return yes
        if one of the entries returned an error.
      scriptName: isError
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "66"
      "yes":
      - "28"
    scriptarguments:
      entryId:
        simple: ${lastCompletedTaskEntries}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 530,
          "y": 1660
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "64":
    id: "64"
    taskid: 6685f021-9859-42f8-815e-3a974492b650
    type: regular
    task:
      id: 6685f021-9859-42f8-815e-3a974492b650
      version: -1
      name: OverwriteListAndNotify
      description: This automation script overwrites the value of a specified list
        and sends a Slack notification to inform the user that they failed to respond
        to an incident notification in a timely manner. The notification includes
        a message indicating the end of the incident playbook and an invitation to
        reopen the incident if necessary.
      scriptName: DSPMOverwriteListAndNotify
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "68"
    scriptarguments:
      incident_id:
        simple: ${incident_object.incidentId}
      list_name:
        simple: ${block_list_name}
      message:
        simple: "You have provided invalid response to ${incident_object.incidentId}
          \n Incident notification. We will resend the notification for Incident ${incident_object.incidentId}
          respond with valid details when slack message lifetime expires.\nRegards."
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 850,
          "y": 2130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "66":
    id: "66"
    taskid: 81afcf34-d8bf-4e77-8e9e-30228205c72e
    type: condition
    task:
      id: 81afcf34-d8bf-4e77-8e9e-30228205c72e
      version: -1
      name: Check if the user action is valid?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      Invalid response:
      - "64"
      Valid response:
      - "67"
    separatecontext: false
    conditions:
    - label: Invalid response
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: User.Action
            iscontext: true
          right:
            value:
              simple: invalid_response
    - label: Valid response
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: User.Action
            iscontext: true
          right:
            value:
              simple: jira
        - operator: isEqualString
          left:
            value:
              simple: User.Action
            iscontext: true
          right:
            value:
              simple: remediate
        - operator: isEqualString
          left:
            value:
              simple: User.Action
            iscontext: true
          right:
            value:
              simple: no_response
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 850,
          "y": 1880
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "67":
    id: "67"
    taskid: 58446751-7448-4e23-8451-ef5cfe962b62
    type: playbook
    task:
      id: 58446751-7448-4e23-8451-ef5cfe962b62
      version: -1
      name: DSPM Valid User Response
      playbookName: DSPM Valid User Response
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "28"
    separatecontext: false
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1410,
          "y": 2130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "68":
    id: "68"
    taskid: 9b3a9bc7-d336-4db9-8e14-83b7fe399a8c
    type: regular
    task:
      id: 9b3a9bc7-d336-4db9-8e14-83b7fe399a8c
      version: -1
      name: SlackBlockBuilder
      description: SlackBlockBuilder will format a given Slack block into a format
        readable by the SlackV3 integration. The script will also send the block to
        the given destination. Make sure to mark **Trust any certificate** and fill
        the **XSOAR API Key integration** parameters if you want to get a response
        to the incident context.
      scriptName: SlackBlockBuilder
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "53"
    scriptarguments:
      list_name:
        simple: ${block_list_name}
      user:
        simple: ${userSlackEmail}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 850,
          "y": 2290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 3105,
        "width": 1860,
        "x": 530,
        "y": 50
      }
    }
  }
inputs:
- key: Incident Name
  value:
    simple: ${incident.name}
  required: true
  description: ""
  playbookInputQuery: null
- key: Project Key
  value:
    simple: ${incident.jiraproject}
  required: false
  description: ""
  playbookInputQuery: null
- key: Summary
  value:
    simple: ${incident.jirasummary}
  required: false
  description: ""
  playbookInputQuery: null
- key: Issue Type
  value:
    simple: ${incident.jiraissuetype}
  required: false
  description: ""
  playbookInputQuery: null
- key: Issue Description
  value:
    simple: ${incident.jiradescription}
  required: false
  description: ""
  playbookInputQuery: null
- key: Action
  value:
    simple: ${incident.action}
  required: true
  description: ""
  playbookInputQuery: null
outputs: []
sourceplaybookid: da7fa1c4-11b7-4c6c-8afa-15d0e3e5f417
