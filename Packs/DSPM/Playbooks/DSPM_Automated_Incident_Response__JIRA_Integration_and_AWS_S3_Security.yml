id: da7fa1c4-11b7-4c6c-8afa-15d0e3e5f417
version: 50
vcShouldKeepItemLegacyProdMachine: false
name: 'DSPM Automated Incident Response: JIRA Integration and AWS S3 Security'
description: Automates incident response by integrating JIRA for issue tracking and
  AWS S3 for security. Streamlines incident handling by creating JIRA tickets, updating
  AWS S3 bucket access settings, and communicating via Slack for efficient resolution
  and compliance with security policies.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 3c51c4da-670f-4ebf-879e-56ea5b62aaee
    type: start
    task:
      id: 3c51c4da-670f-4ebf-879e-56ea5b62aaee
      version: -1
      name: ""
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "25"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 240,
          "y": -970
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: 5e40dd0d-8e7b-400d-8886-da95e3c49912
    type: condition
    task:
      id: 5e40dd0d-8e7b-400d-8886-da95e3c49912
      version: -1
      name: Check if the Action is value
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      Jira action:
      - "16"
      No Response from user:
      - "29"
      Remedition action (Sensitive asset open to world):
      - "40"
    separatecontext: false
    conditions:
    - label: Jira action
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: User.Action
            iscontext: true
          right:
            value:
              simple: jira
    - label: Remedition action (Sensitive asset open to world)
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: User.Action
            iscontext: true
          right:
            value:
              simple: remediate
    - label: No Response from user
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: User.Action
            iscontext: true
          right:
            value:
              simple: no_response
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -770,
          "y": 825
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: 9c74b338-83dd-45b8-8ab3-3019769766ac
    type: regular
    task:
      id: 9c74b338-83dd-45b8-8ab3-3019769766ac
      version: -1
      name: Update Slack Incident with JIRA details
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "33"
    scriptarguments:
      details:
        simple: 'JIRA Ticket created successfully with ID: ${Ticket.Id} and Key: ${Ticket.Key}.
          Associated Remediation ID: ${riskFindingId}.'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1720,
          "y": 1150
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: e7f2a212-1ba9-4e37-8a64-991a86fe8dbb
    type: regular
    task:
      id: e7f2a212-1ba9-4e37-8a64-991a86fe8dbb
      version: -1
      name: Closed current  Incident playbook
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    scriptarguments:
      closeNotes:
        simple: ${incident.details}
      closeReason:
        simple: Resolved
      id:
        simple: ${incident.id}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -110,
          "y": 2020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: 0b335bbd-afb2-4410-8391-74d3605807a0
    type: regular
    task:
      id: 0b335bbd-afb2-4410-8391-74d3605807a0
      version: -1
      name: Create Jira Issue
      description: Creates a new issue in Jira.
      script: Jira V3|||jira-create-issue
      type: regular
      iscommand: true
      brand: Jira V3
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      assignee_id:
        simple: ${AccountInfo.AccountID}
      description:
        simple: |-
          The issue created from incident Id: ${incident.id} and Incident Name: ${incident.name}
          Remediation steps :  ${incident.remediateSteps}
      issue_type_id:
        simple: ${User.JiraTicketTypeID}
      project_name:
        simple: ${User.JiraProjectName}
      summary:
        simple: 'The issue created from Incident Id: ${incident.id} for ${User.JiraProjectName}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1720,
          "y": 980
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: c93ab27a-45e2-4363-86a9-836c7d506ad0
    type: regular
    task:
      id: c93ab27a-45e2-4363-86a9-836c7d506ad0
      version: -1
      name: Get Assignee ID from email
      scriptName: DSPM-Get-Jira-accountId
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "12"
    scriptarguments:
      email:
        simple: ${User.Email}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1720,
          "y": 840
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: 64f0f97f-b8c1-4d81-8e7d-20cfe555fb13
    type: regular
    task:
      id: 64f0f97f-b8c1-4d81-8e7d-20cfe555fb13
      version: -1
      name: ParseSlackBlockBuilderResponse
      scriptName: ParseSlackBlockBuilderResponse
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -770,
          "y": 640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: b05fb3a7-2daf-4335-81e8-9e964f22af7c
    type: regular
    task:
      id: b05fb3a7-2daf-4335-81e8-9e964f22af7c
      version: -1
      name: SlackBlockBuilder
      description: SlackBlockBuilder will format a given Slack block into a format
        readable by the SlackV3 integration. The script will also send the block to
        the given destination. Make sure to mark **Trust any certificate** and fill
        the **XSOAR API Key integration** parameters if you want to get a response
        to the incident context.
      scriptName: SlackBlockBuilder
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "23"
    scriptarguments:
      list_name:
        simple: ${block_list_name}
      user:
        simple: Sachin Indoriya
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -470,
          "y": 80
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: e3b6a288-eaeb-4eb0-8b53-bfd0eba3c0ef
    type: regular
    task:
      id: e3b6a288-eaeb-4eb0-8b53-bfd0eba3c0ef
      version: -1
      name: GetSlackBlockBuilderResponse
      description: GetSlackBlockBuilderResponse will format a SlackBlockBuilder response
        and insert it into an incident's context.
      scriptName: GetSlackBlockBuilderResponse
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "39"
    scriptarguments:
      retry-count:
        simple: "3"
      retry-interval:
        simple: "30"
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -470,
          "y": 270
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: 74473851-d30a-4e15-88fa-8d45ba87cd84
    type: regular
    task:
      id: 74473851-d30a-4e15-88fa-8d45ba87cd84
      version: -1
      name: DSPM_risk_status_update
      scriptName: DSPM_risk_status_update
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "28"
    scriptarguments:
      riskFindingId:
        simple: 247f5b8e-7db4-497e-86f2-0ef7d8ac479e
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1260,
          "y": 1780
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: adcf1d58-ebdb-4cdd-8bcf-68cd357fb02f
    type: regular
    task:
      id: adcf1d58-ebdb-4cdd-8bcf-68cd357fb02f
      version: -1
      name: Extracts DSPM risk fields
      scriptName: DSPM_fetch_incident_details
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      get_incident_details:
        simple: ${incident}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 240,
          "y": -830
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: c7b14e64-6409-48ef-8a38-598b0eeefa0a
    type: regular
    task:
      id: c7b14e64-6409-48ef-8a38-598b0eeefa0a
      version: -1
      name: Fetch list of Jira project
      scriptName: DSPM_fetch_list_of_jira_project
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "35"
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 240,
          "y": -650
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: aab8ce38-8645-4512-8373-64a6fa52c201
    type: regular
    task:
      id: aab8ce38-8645-4512-8373-64a6fa52c201
      version: -1
      name: CreateDSPMRiskSlackBlocks
      scriptName: CreateDSPMRiskSlackBlocks
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "36"
    scriptarguments:
      dspm_incident:
        simple: ${incident_object}
      list_of_project:
        simple: ${projects_list}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -100,
          "y": -290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 162cd8ac-57af-4dc2-8d72-198e8afe9705
    type: regular
    task:
      id: 162cd8ac-57af-4dc2-8d72-198e8afe9705
      version: -1
      name: RemoveSlackBlockList
      scriptName: RemoveSlackBlockList
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      list_name:
        simple: ${block_list_name}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -110,
          "y": 1790
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: 599a5efe-a642-4727-8411-29199588b53c
    type: regular
    task:
      id: 599a5efe-a642-4727-8411-29199588b53c
      version: -1
      name: OverwriteListAndNotify
      description: This automation script overwrites the value of a specified list
        and sends a Slack notification to inform the user that they failed to respond
        to an incident notification in a timely manner. The notification includes
        a message indicating the end of the incident playbook and an invitation to
        reopen the incident if necessary.
      scriptName: OverwriteListAndNotify
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "30"
    scriptarguments:
      incident_id:
        simple: ${incident_object.incidentId}
      list_name:
        simple: ${block_list_name}
      message:
        simple: |-
          You have not responded to the ${incident_object.incidentId} incident notification in a timely manner.
          We are coming to an end of the${incident_object.incidentId} incident playbook from XSOAR.You are welcome to reopen it. Regards.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -110,
          "y": 980
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: 063e85f4-f94e-4bb1-8826-b8ad8de39de0
    type: regular
    task:
      id: 063e85f4-f94e-4bb1-8826-b8ad8de39de0
      version: -1
      name: SlackBlockBuilder
      description: SlackBlockBuilder will format a given Slack block into a format
        readable by the SlackV3 integration. The script will also send the block to
        the given destination. Make sure to mark **Trust any certificate** and fill
        the **XSOAR API Key integration** parameters if you want to get a response
        to the incident context.
      scriptName: SlackBlockBuilder
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "28"
    scriptarguments:
      list_name:
        simple: ${block_list_name}
      user:
        simple: Sachin Indoriya
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -110,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: 7a5f3209-38c4-41c4-86cb-b8e43735491e
    type: regular
    task:
      id: 7a5f3209-38c4-41c4-86cb-b8e43735491e
      version: -1
      name: OverwriteListAndNotify
      description: This automation script overwrites the value of a specified list
        and sends a Slack notification to inform the user that they failed to respond
        to an incident notification in a timely manner. The notification includes
        a message indicating the end of the incident playbook and an invitation to
        reopen the incident if necessary.
      scriptName: OverwriteListAndNotify
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "34"
    scriptarguments:
      list_name:
        simple: ${block_list_name}
      message:
        simple: 'JIRA Ticket created successfully with ID: ${Ticket.Id} on Project
          Key: ${Ticket.Key}. Associated XSOAR incident ID: ${incident.id}.'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1720,
          "y": 1325
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: 518af08e-18c5-45cb-8187-7d52fd69cf00
    type: regular
    task:
      id: 518af08e-18c5-45cb-8187-7d52fd69cf00
      version: -1
      name: SlackBlockBuilder
      description: SlackBlockBuilder will format a given Slack block into a format
        readable by the SlackV3 integration. The script will also send the block to
        the given destination. Make sure to mark **Trust any certificate** and fill
        the **XSOAR API Key integration** parameters if you want to get a response
        to the incident context.
      scriptName: SlackBlockBuilder
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "24"
    scriptarguments:
      list_name:
        simple: ${block_list_name}
      user:
        simple: Sachin Indoriya
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1250,
          "y": 1600
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: d6adb6a2-bc7f-45ec-8b81-9163304a9d28
    type: condition
    task:
      id: d6adb6a2-bc7f-45ec-8b81-9163304a9d28
      version: -1
      name: Errors occurred when retrieving the project ID list?
      description: Check whether given entry/entries returned an error. Use ${lastCompletedTaskEntries}
        to check the previous task entries. If array is provided, will return yes
        if one of the entries returned an error.
      scriptName: isError
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "27"
      "yes":
      - "37"
    scriptarguments:
      entryId:
        simple: ${lastCompletedTaskEntries}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 240,
          "y": -460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: 31dda242-912b-423a-8c04-4f1fc32868eb
    type: condition
    task:
      id: 31dda242-912b-423a-8c04-4f1fc32868eb
      version: -1
      name: 'Errors occurred when generating the Slack block list for the incident
        ID : ${incident_object.id}'
      description: Check whether given entry/entries returned an error. Use ${lastCompletedTaskEntries}
        to check the previous task entries. If array is provided, will return yes
        if one of the entries returned an error.
      scriptName: isError
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "22"
      "yes":
      - "38"
    scriptarguments:
      entryId:
        simple: ${lastCompletedTaskEntries}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -100,
          "y": -115
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: cefe1f8a-d00a-4b6a-8366-bae4ff66484d
    type: regular
    task:
      id: cefe1f8a-d00a-4b6a-8366-bae4ff66484d
      version: -1
      name: closeInvestigation
      description: Close the current incident
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    scriptarguments:
      closeNotes:
        simple: Closing the playbook before sending notification to user.
      closeReason:
        simple: Unable to fetch the list of project.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 560,
          "y": -290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: 91c67be4-a6bb-4509-80be-605157b3d8f5
    type: regular
    task:
      id: 91c67be4-a6bb-4509-80be-605157b3d8f5
      version: -1
      name: closeInvestigation
      description: Close the current incident
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    scriptarguments:
      closeNotes:
        simple: Closing the playbook before sending notification to user.
      closeReason:
        simple: Unable to create custom slack block for this incident.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 330,
          "y": 80
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: 99a640e0-9f77-455e-85d3-580782905dce
    type: condition
    task:
      id: 99a640e0-9f77-455e-85d3-580782905dce
      version: -1
      name: Did the user respond to us regarding the incident ID?
      description: Check whether given entry/entries returned an error. Use ${lastCompletedTaskEntries}
        to check the previous task entries. If array is provided, will return yes
        if one of the entries returned an error.
      scriptName: isError
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "29"
      "yes":
      - "21"
    scriptarguments:
      entryId:
        simple: ${lastCompletedTaskEntries}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -470,
          "y": 450
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: 91a29610-7c95-43d7-8bf6-08254b6aebad
    type: playbook
    task:
      id: 91a29610-7c95-43d7-8bf6-08254b6aebad
      version: -1
      name: DSPM Remediation playbook for Sensitive asset open to world.
      playbookName: DSPM Remediation playbook for Sensitive asset open to world.
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "34"
    separatecontext: false
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": -780,
          "y": 1085
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 3085,
        "width": 2660,
        "x": -1720,
        "y": -970
      }
    }
  }
inputs:
- key: Incident Name
  value:
    simple: ${incident.name}
  required: true
  description: ""
  playbookInputQuery: null
- key: Project Key
  value:
    simple: ${incident.jiraproject}
  required: false
  description: ""
  playbookInputQuery: null
- key: Summary
  value:
    simple: ${incident.jirasummary}
  required: false
  description: ""
  playbookInputQuery: null
- key: Issue Type
  value:
    simple: ${incident.jiraissuetype}
  required: false
  description: ""
  playbookInputQuery: null
- key: Issue Description
  value:
    simple: ${incident.jiradescription}
  required: false
  description: ""
  playbookInputQuery: null
- key: Action
  value:
    simple: ${incident.action}
  required: true
  description: ""
  playbookInputQuery: null
outputs: []