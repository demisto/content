id: da7fa1c4-11b7-4c6c-8afa-15d0e3e5f417
version: 93
vcShouldKeepItemLegacyProdMachine: false
name: 'DSPM Automated Incident Response: JIRA Integration and AWS S3 Security'
description: Automates incident response by integrating JIRA for issue tracking and
  AWS S3 for security. Streamlines incident handling by creating JIRA tickets, updating
  AWS S3 bucket access settings, and communicating via Slack for efficient resolution
  and compliance with security policies.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 06a9dd1c-c492-431a-8f07-a0559d73da34
    type: start
    task:
      id: 06a9dd1c-c492-431a-8f07-a0559d73da34
      version: -1
      name: ""
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "25"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 240,
          "y": -970
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: 22583693-6900-47e7-8a6b-ce6862d1a494
    type: condition
    task:
      id: 22583693-6900-47e7-8a6b-ce6862d1a494
      version: -1
      name: Check if the Action is value
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      Jira action:
      - "16"
      No Response from user:
      - "29"
      Remedition action (Sensitive asset open to world):
      - "40"
    separatecontext: false
    conditions:
    - label: Jira action
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: User.Action
            iscontext: true
          right:
            value:
              simple: jira
    - label: Remedition action (Sensitive asset open to world)
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: User.Action
            iscontext: true
          right:
            value:
              simple: remediate
    - label: No Response from user
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: User.Action
            iscontext: true
          right:
            value:
              simple: no_response
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -770,
          "y": 825
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: 06d31c35-1c1d-4a1f-8483-fbf75a97660c
    type: regular
    task:
      id: 06d31c35-1c1d-4a1f-8483-fbf75a97660c
      version: -1
      name: Update Slack Incident with JIRA details
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "33"
    scriptarguments:
      details:
        simple: 'JIRA Ticket created successfully with ID: ${Ticket.Id} and Key: ${Ticket.Key}.
          Associated Remediation ID: ${riskFindingId}.'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1720,
          "y": 1150
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: 067bb493-7aae-4bfc-8ab0-d03b3542be63
    type: regular
    task:
      id: 067bb493-7aae-4bfc-8ab0-d03b3542be63
      version: -1
      name: Closed current  Incident
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    scriptarguments:
      closeNotes:
        simple: ${incident.details}
      closeReason:
        simple: Resolved
      id:
        simple: ${incident.id}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -110,
          "y": 1685
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: 3a72194e-45e9-4f21-81ff-a46d94c500a2
    type: regular
    task:
      id: 3a72194e-45e9-4f21-81ff-a46d94c500a2
      version: -1
      name: Create Jira Issue
      description: Creates a new issue in Jira.
      script: Jira V3|||jira-create-issue
      type: regular
      iscommand: true
      brand: Jira V3
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      assignee_id:
        simple: ${AccountInfo.AccountID}
      description:
        simple: |-
          The issue created from incident Id: ${incident.id} and Incident Name: ${incident.name}
          Remediation steps :  ${incident.remediateSteps}
      issue_type_id:
        simple: ${User.JiraTicketTypeID}
      project_name:
        simple: ${User.JiraProjectName}
      summary:
        simple: 'The issue created from Incident Id: ${incident.id} for ${User.JiraProjectName}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1720,
          "y": 980
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 7a261869-ae18-4101-85cb-b390babfc15b
    type: regular
    task:
      id: 7a261869-ae18-4101-85cb-b390babfc15b
      version: -1
      name: Get Assignee ID from email
      scriptName: DSPM-Get-Jira-accountId
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "12"
    scriptarguments:
      email:
        simple: ${User.Email}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1720,
          "y": 840
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: 3f090e75-02a7-4344-84ee-9a380a1c5fbc
    type: regular
    task:
      id: 3f090e75-02a7-4344-84ee-9a380a1c5fbc
      version: -1
      name: ParseSlackBlockBuilderResponse
      scriptName: ParseSlackBlockBuilderResponse
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -770,
          "y": 640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: 35679bee-6b45-4920-8b01-e39b4f40d6ee
    type: regular
    task:
      id: 35679bee-6b45-4920-8b01-e39b4f40d6ee
      version: -1
      name: SlackBlockBuilder
      description: SlackBlockBuilder will format a given Slack block into a format
        readable by the SlackV3 integration. The script will also send the block to
        the given destination. Make sure to mark **Trust any certificate** and fill
        the **XSOAR API Key integration** parameters if you want to get a response
        to the incident context.
      scriptName: SlackBlockBuilder
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "23"
    scriptarguments:
      list_name:
        simple: ${block_list_name}
      user:
        simple: Sachin Indoriya
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -470,
          "y": 80
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: 650ad09a-fcff-4e29-89a6-03feff12c895
    type: regular
    task:
      id: 650ad09a-fcff-4e29-89a6-03feff12c895
      version: -1
      name: GetSlackBlockBuilderResponse
      description: GetSlackBlockBuilderResponse will format a SlackBlockBuilder response
        and insert it into an incident's context.
      scriptName: GetSlackBlockBuilderResponse
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "39"
    scriptarguments:
      retry-count:
        simple: "3"
      retry-interval:
        simple: "30"
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -470,
          "y": 270
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: de7433da-093b-4c09-86f9-4500cb02d4a0
    type: regular
    task:
      id: de7433da-093b-4c09-86f9-4500cb02d4a0
      version: -1
      name: DSPM_risk_status_update
      scriptName: DSPM_risk_status_update
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "28"
    scriptarguments:
      riskFindingId:
        simple: 247f5b8e-7db4-497e-86f2-0ef7d8ac479e
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1250,
          "y": 1780
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: 22a3b26c-acef-4d84-8433-dea621ca4841
    type: regular
    task:
      id: 22a3b26c-acef-4d84-8433-dea621ca4841
      version: -1
      name: DSPM_fetch_incident_details
      scriptName: DSPM_fetch_incident_details
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      get_incident_details:
        simple: ${incident}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 240,
          "y": -830
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: e5d02c0c-9196-4ab9-8f26-36d6f808e9ab
    type: regular
    task:
      id: e5d02c0c-9196-4ab9-8f26-36d6f808e9ab
      version: -1
      name: DSPM_fetch_list_of_jira_project
      scriptName: DSPM_fetch_list_of_jira_project
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "35"
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 240,
          "y": -650
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: 992b9cd0-6923-48b1-811f-158f6f687f05
    type: regular
    task:
      id: 992b9cd0-6923-48b1-811f-158f6f687f05
      version: -1
      name: CreateDSPMRiskSlackBlocks
      scriptName: CreateDSPMRiskSlackBlocks
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "36"
    scriptarguments:
      dspm_incident:
        simple: ${incident_object}
      list_of_project:
        simple: ${projects_list}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -100,
          "y": -290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 6288362f-9f6a-42ea-8433-873c13d96c68
    type: regular
    task:
      id: 6288362f-9f6a-42ea-8433-873c13d96c68
      version: -1
      name: RemoveSlackBlockList
      scriptName: RemoveSlackBlockList
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      list_name:
        simple: ${block_list_name}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -110,
          "y": 1410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: 4e85695d-3b52-4a5c-8f1f-c1dbc95dddc7
    type: regular
    task:
      id: 4e85695d-3b52-4a5c-8f1f-c1dbc95dddc7
      version: -1
      name: OverwriteListAndNotify
      description: This automation script overwrites the value of a specified list
        and sends a Slack notification to inform the user that they failed to respond
        to an incident notification in a timely manner. The notification includes
        a message indicating the end of the incident playbook and an invitation to
        reopen the incident if necessary.
      scriptName: OverwriteListAndNotify
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "30"
    scriptarguments:
      incident_id:
        simple: ${incident_object.incidentId}
      list_name:
        simple: ${block_list_name}
      message:
        simple: |-
          You have not responded to the ${incident_object.incidentId} incident notification in a timely manner.
          We are coming to an end of the${incident_object.incidentId} incident playbook from XSOAR.You are welcome to reopen it. Regards.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -110,
          "y": 980
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: 82902fbc-2813-4535-8c29-d215a3d6573b
    type: regular
    task:
      id: 82902fbc-2813-4535-8c29-d215a3d6573b
      version: -1
      name: SlackBlockBuilder
      description: SlackBlockBuilder will format a given Slack block into a format
        readable by the SlackV3 integration. The script will also send the block to
        the given destination. Make sure to mark **Trust any certificate** and fill
        the **XSOAR API Key integration** parameters if you want to get a response
        to the incident context.
      scriptName: SlackBlockBuilder
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "28"
    scriptarguments:
      list_name:
        simple: ${block_list_name}
      user:
        simple: Sachin Indoriya
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -110,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: 742cb050-03f7-46f2-8017-62dd7cd3243a
    type: regular
    task:
      id: 742cb050-03f7-46f2-8017-62dd7cd3243a
      version: -1
      name: OverwriteListAndNotify
      description: This automation script overwrites the value of a specified list
        and sends a Slack notification to inform the user that they failed to respond
        to an incident notification in a timely manner. The notification includes
        a message indicating the end of the incident playbook and an invitation to
        reopen the incident if necessary.
      scriptName: OverwriteListAndNotify
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "34"
    scriptarguments:
      list_name:
        simple: ${block_list_name}
      message:
        simple: 'JIRA Ticket created successfully with ID: ${Ticket.Id} on Project
          Key: ${Ticket.Key}. Associated XSOAR incident ID: ${incident.id}.'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1720,
          "y": 1325
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: e1a65e68-05be-4def-81a4-ca49f68c981c
    type: regular
    task:
      id: e1a65e68-05be-4def-81a4-ca49f68c981c
      version: -1
      name: SlackBlockBuilder
      description: SlackBlockBuilder will format a given Slack block into a format
        readable by the SlackV3 integration. The script will also send the block to
        the given destination. Make sure to mark **Trust any certificate** and fill
        the **XSOAR API Key integration** parameters if you want to get a response
        to the incident context.
      scriptName: SlackBlockBuilder
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "24"
    scriptarguments:
      list_name:
        simple: ${block_list_name}
      user:
        simple: Sachin Indoriya
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1250,
          "y": 1600
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: 74b8157c-fa21-4947-832c-c75b512f94e7
    type: condition
    task:
      id: 74b8157c-fa21-4947-832c-c75b512f94e7
      version: -1
      name: Are we able to get list of project IDs
      description: Check whether given entry/entries returned an error. Use ${lastCompletedTaskEntries}
        to check the previous task entries. If array is provided, will return yes
        if one of the entries returned an error.
      scriptName: isError
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "27"
      "yes":
      - "37"
    scriptarguments:
      entryId:
        simple: ${lastCompletedTaskEntries}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 240,
          "y": -460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: 24847a76-d646-43be-82dc-59f6ea015074
    type: condition
    task:
      id: 24847a76-d646-43be-82dc-59f6ea015074
      version: -1
      name: 'did we created the slack block list successfully for Incident ID : ${incident_object.id}'
      description: Check whether given entry/entries returned an error. Use ${lastCompletedTaskEntries}
        to check the previous task entries. If array is provided, will return yes
        if one of the entries returned an error.
      scriptName: isError
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "22"
      "yes":
      - "38"
    scriptarguments:
      entryId:
        simple: ${lastCompletedTaskEntries}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -100,
          "y": -115
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: 9dd15ba9-d4a7-4f2b-8144-deb012bd343e
    type: regular
    task:
      id: 9dd15ba9-d4a7-4f2b-8144-deb012bd343e
      version: -1
      name: closeInvestigation
      description: Close the current incident
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    scriptarguments:
      closeNotes:
        simple: Closing the playbook before sending notification to user.
      closeReason:
        simple: Unable to fetch the list of project.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 560,
          "y": -290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: 3365a13f-5a93-48d6-889f-16eccd737a7e
    type: regular
    task:
      id: 3365a13f-5a93-48d6-889f-16eccd737a7e
      version: -1
      name: closeInvestigation
      description: Close the current incident
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    scriptarguments:
      closeNotes:
        simple: Closing the playbook before sending notification to user.
      closeReason:
        simple: Unable to create custom slack block for this incident.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 330,
          "y": 80
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: 2487b00a-2b58-4622-87ad-7082f79da3a4
    type: condition
    task:
      id: 2487b00a-2b58-4622-87ad-7082f79da3a4
      version: -1
      name: Did we received response from user
      description: Check whether given entry/entries returned an error. Use ${lastCompletedTaskEntries}
        to check the previous task entries. If array is provided, will return yes
        if one of the entries returned an error.
      scriptName: isError
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "29"
      "yes":
      - "21"
    scriptarguments:
      entryId:
        simple: ${lastCompletedTaskEntries}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -470,
          "y": 450
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: cec2781b-44eb-4c77-8981-7b0842effc6d
    type: playbook
    task:
      id: cec2781b-44eb-4c77-8981-7b0842effc6d
      version: -1
      name: DSPM Remediation playbook for Sensitive asset open to world.
      playbookName: DSPM Remediation playbook for Sensitive asset open to world.
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "34"
    separatecontext: false
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": -780,
          "y": 1085
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 2845,
        "width": 2660,
        "x": -1720,
        "y": -970
      }
    }
  }
inputs:
- key: Incident Name
  value:
    simple: ${incident.name}
  required: true
  description: ""
  playbookInputQuery: null
- key: Project Key
  value:
    simple: ${incident.jiraproject}
  required: false
  description: ""
  playbookInputQuery: null
- key: Summary
  value:
    simple: ${incident.jirasummary}
  required: false
  description: ""
  playbookInputQuery: null
- key: Issue Type
  value:
    simple: ${incident.jiraissuetype}
  required: false
  description: ""
  playbookInputQuery: null
- key: Issue Description
  value:
    simple: ${incident.jiradescription}
  required: false
  description: ""
  playbookInputQuery: null
- key: Action
  value:
    simple: ${incident.action}
  required: true
  description: ""
  playbookInputQuery: null
outputs: []