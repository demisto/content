id: da7fa1c4-11b7-4c6c-8afa-15d0e3e5f417
version: 41
vcShouldKeepItemLegacyProdMachine: false
name: 'DSPM Automated Incident Response: JIRA Integration and AWS S3 Security'
description: Automates incident response by integrating JIRA for issue tracking and
  AWS S3 for security. Streamlines incident handling by creating JIRA tickets, updating
  AWS S3 bucket access settings, and communicating via Slack for efficient resolution
  and compliance with security policies.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 3faae195-5e01-4661-8290-db55eb8685ca
    type: start
    task:
      id: 3faae195-5e01-4661-8290-db55eb8685ca
      version: -1
      name: ""
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "25"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 240,
          "y": -970
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: 80ac86cd-5113-4587-8714-f8c9188e856e
    type: condition
    task:
      id: 80ac86cd-5113-4587-8714-f8c9188e856e
      version: -1
      name: Check if the Action is value
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      Jira action:
      - "16"
      No Response from user:
      - "29"
      Remedition action (Sensitive asset open to world):
      - "31"
    separatecontext: false
    conditions:
    - label: Jira action
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: User.Action
            iscontext: true
          right:
            value:
              simple: jira
    - label: Remedition action (Sensitive asset open to world)
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: User.Action
            iscontext: true
          right:
            value:
              simple: remediate
    - label: No Response from user
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: User.Action
            iscontext: true
          right:
            value:
              simple: no_response
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 265,
          "y": 195
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: e7390e40-6af5-4a6b-8e18-59308ab7b76b
    type: regular
    task:
      id: e7390e40-6af5-4a6b-8e18-59308ab7b76b
      version: -1
      name: Update Slack Incident with JIRA details
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "33"
    scriptarguments:
      details:
        simple: 'JIRA Ticket created successfully with ID: ${Ticket.Id} and Key: ${Ticket.Key}.
          Associated Remediation ID: ${riskFindingId}.'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -220,
          "y": 730
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: d490238c-efa2-4792-871b-bd6084b3c883
    type: regular
    task:
      id: d490238c-efa2-4792-871b-bd6084b3c883
      version: -1
      name: Closed current  Incident
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    scriptarguments:
      closeNotes:
        simple: ${incident.details}
      closeReason:
        simple: Resolved
      id:
        simple: ${incident.id}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1010,
          "y": 1350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: b15852f5-4062-47f2-8516-cfe86fa7028a
    type: regular
    task:
      id: b15852f5-4062-47f2-8516-cfe86fa7028a
      version: -1
      name: Create Jira Issue
      description: Creates a new issue in Jira.
      script: Jira V3|||jira-create-issue
      type: regular
      iscommand: true
      brand: Jira V3
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      assignee_id:
        simple: ${AccountInfo.AccountID}
      description:
        simple: |-
          The issue created from incident Id: ${incident.id} and Incident Name: ${incident.name}
          Remediation steps :  ${incident.remediateDescription}
      issue_type_id:
        simple: ${User.JiraTicketTypeID}
      project_name:
        simple: ${User.JiraProjectName}
      summary:
        simple: 'The issue created from Incident Id: ${incident.id} for ${User.JiraProjectName}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -220,
          "y": 550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 78dfd491-e613-4ecf-8851-3357c93cd3cf
    type: regular
    task:
      id: 78dfd491-e613-4ecf-8851-3357c93cd3cf
      version: -1
      name: Get Assignee ID from email
      scriptName: DSPM-Get-Jira-accountId
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "12"
    scriptarguments:
      email:
        simple: ${User.Email}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -220,
          "y": 370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: 200f7986-6603-4939-8818-3e2c3b4495aa
    type: regular
    task:
      id: 200f7986-6603-4939-8818-3e2c3b4495aa
      version: -1
      name: Update Slack Incident with AWS details
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "32"
    scriptarguments:
      details:
        simple: Successfully applied public access block to the ${incident_object.assetName}
          bucket.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 370,
          "y": 550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: f4b27385-b845-4c47-8384-43ece1434646
    type: regular
    task:
      id: f4b27385-b845-4c47-8384-43ece1434646
      version: -1
      name: ParseSlackBlockBuilderResponse
      scriptName: ParseSlackBlockBuilderResponse
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 265,
          "y": 20
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: 71f8abac-729c-439d-8ce8-7375d407b114
    type: regular
    task:
      id: 71f8abac-729c-439d-8ce8-7375d407b114
      version: -1
      name: SlackBlockBuilder
      description: SlackBlockBuilder will format a given Slack block into a format
        readable by the SlackV3 integration. The script will also send the block to
        the given destination. Make sure to mark **Trust any certificate** and fill
        the **XSOAR API Key integration** parameters if you want to get a response
        to the incident context.
      scriptName: SlackBlockBuilder
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "23"
    scriptarguments:
      list_name:
        simple: ${block_list_name}
      user:
        simple: manas
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 265,
          "y": -310
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: 5f5c7294-2202-471c-8360-a74665690f7c
    type: regular
    task:
      id: 5f5c7294-2202-471c-8360-a74665690f7c
      version: -1
      name: GetSlackBlockBuilderResponse
      description: GetSlackBlockBuilderResponse will format a SlackBlockBuilder response
        and insert it into an incident's context.
      scriptName: GetSlackBlockBuilderResponse
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "21"
    scriptarguments:
      retry-count:
        simple: "1"
      retry-interval:
        simple: "300"
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 290,
          "y": -130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: 3e98c078-04fa-4cc9-8d2c-c24b156554a0
    type: regular
    task:
      id: 3e98c078-04fa-4cc9-8d2c-c24b156554a0
      version: -1
      name: DSPM_risk_status_update
      scriptName: DSPM_risk_status_update
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "28"
    scriptarguments:
      riskFindingId:
        simple: 247f5b8e-7db4-497e-86f2-0ef7d8ac479e
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 720,
          "y": 960
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: 4d3eafb1-b89e-4f50-8535-eb3b8eaaf0fe
    type: regular
    task:
      id: 4d3eafb1-b89e-4f50-8535-eb3b8eaaf0fe
      version: -1
      name: DSPM_fetch_incident_details
      scriptName: DSPM_fetch_incident_details
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      get_incident_details:
        simple: ${incident}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 240,
          "y": -790
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: 50ea8673-0a22-404b-866f-8cbf3305912c
    type: regular
    task:
      id: 50ea8673-0a22-404b-866f-8cbf3305912c
      version: -1
      name: DSPM_fetch_list_of_jira_project
      scriptName: DSPM_fetch_list_of_jira_project
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "27"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 250,
          "y": -640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: db47ebcd-cb64-4e19-87d1-cda5f44a6c7d
    type: regular
    task:
      id: db47ebcd-cb64-4e19-87d1-cda5f44a6c7d
      version: -1
      name: CreateDSPMRiskSlackBlocks
      scriptName: CreateDSPMRiskSlackBlocks
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "22"
    scriptarguments:
      dspm_incident:
        simple: ${incident_object}
      list_of_project:
        simple: ${projects_list}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 265,
          "y": -455
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 7fed1525-ee69-4248-8bc9-5fca64ff32a4
    type: regular
    task:
      id: 7fed1525-ee69-4248-8bc9-5fca64ff32a4
      version: -1
      name: RemoveSlackBlockList
      scriptName: RemoveSlackBlockList
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      list_name:
        simple: ${block_list_name}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1000,
          "y": 1160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: 9a598a7d-6067-4404-81d0-0ca2f15a1c42
    type: regular
    task:
      id: 9a598a7d-6067-4404-81d0-0ca2f15a1c42
      version: -1
      name: OverwriteListAndNotify
      description: This automation script overwrites the value of a specified list
        and sends a Slack notification to inform the user that they failed to respond
        to an incident notification in a timely manner. The notification includes
        a message indicating the end of the incident playbook and an invitation to
        reopen the incident if necessary.
      scriptName: OverwriteListAndNotify
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "30"
    scriptarguments:
      incident_id:
        simple: ${incident_object.incidentId}
      list_name:
        simple: ${block_list_name}
      message:
        simple: |-
          You have not responded to the ${incident_object.incidentId} incident notification in a timely manner.
          We are coming to an end of the${incident_object.incidentId} incident playbook from XSOAR.You are welcome to reopen it. Regards.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 970,
          "y": 370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: 4811815c-a0a4-4aff-860c-be6000f9b923
    type: regular
    task:
      id: 4811815c-a0a4-4aff-860c-be6000f9b923
      version: -1
      name: SlackBlockBuilder
      description: SlackBlockBuilder will format a given Slack block into a format
        readable by the SlackV3 integration. The script will also send the block to
        the given destination. Make sure to mark **Trust any certificate** and fill
        the **XSOAR API Key integration** parameters if you want to get a response
        to the incident context.
      scriptName: SlackBlockBuilder
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "28"
    scriptarguments:
      list_name:
        simple: ${block_list_name}
      user:
        simple: manas
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 970,
          "y": 575
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: 97814007-89ee-4e58-8df0-42e5b4efa338
    type: regular
    task:
      id: 97814007-89ee-4e58-8df0-42e5b4efa338
      version: -1
      name: aws-s3-put-public-access-block
      description: Creates or modifies the PublicAccessBlock configuration for an
        Amazon S3 bucket.
      script: AWS - S3|||aws-s3-put-public-access-block
      type: regular
      iscommand: true
      brand: AWS - S3
    nexttasks:
      '#none#':
      - "18"
    scriptarguments:
      BlockPublicAcls:
        simple: "true"
      BlockPublicPolicy:
        simple: "true"
      IgnorePublicAcls:
        simple: "true"
      RestrictPublicBuckets:
        simple: "true"
      bucket:
        simple: dig-security-integration
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 340,
          "y": 385
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: 7e44ff80-495f-4274-8286-9fb7b37a719b
    type: regular
    task:
      id: 7e44ff80-495f-4274-8286-9fb7b37a719b
      version: -1
      name: OverwriteListAndNotify
      description: This automation script overwrites the value of a specified list
        and sends a Slack notification to inform the user that they failed to respond
        to an incident notification in a timely manner. The notification includes
        a message indicating the end of the incident playbook and an invitation to
        reopen the incident if necessary.
      scriptName: OverwriteListAndNotify
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "34"
    scriptarguments:
      list_name:
        simple: ${block_list_name}
      message:
        simple: 'For XSOAR incident ID : ${incident.id} successfully applied public
          access block to the ${incident_object.assetName} bucket.'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 370,
          "y": 700
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: fd41673f-1873-41cb-8b29-e62194cf7895
    type: regular
    task:
      id: fd41673f-1873-41cb-8b29-e62194cf7895
      version: -1
      name: OverwriteListAndNotify
      description: This automation script overwrites the value of a specified list
        and sends a Slack notification to inform the user that they failed to respond
        to an incident notification in a timely manner. The notification includes
        a message indicating the end of the incident playbook and an invitation to
        reopen the incident if necessary.
      scriptName: OverwriteListAndNotify
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "34"
    scriptarguments:
      list_name:
        simple: ${block_list_name}
      message:
        simple: 'JIRA Ticket created successfully with ID: ${Ticket.Id} on Project
          Key: ${Ticket.Key}. Associated XSOAR incident ID: ${incident.id}.'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -220,
          "y": 930
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: 7067f9e9-4a56-48d4-82f2-7334897b8cb0
    type: regular
    task:
      id: 7067f9e9-4a56-48d4-82f2-7334897b8cb0
      version: -1
      name: SlackBlockBuilder
      description: SlackBlockBuilder will format a given Slack block into a format
        readable by the SlackV3 integration. The script will also send the block to
        the given destination. Make sure to mark **Trust any certificate** and fill
        the **XSOAR API Key integration** parameters if you want to get a response
        to the incident context.
      scriptName: SlackBlockBuilder
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "24"
    scriptarguments:
      list_name:
        simple: ${block_list_name}
      user:
        simple: manas
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 200,
          "y": 1090
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 2415,
        "width": 1610,
        "x": -220,
        "y": -970
      }
    }
  }
inputs:
- key: Incident Name
  value:
    simple: ${incident.name}
  required: true
  description: ""
  playbookInputQuery: null
- key: Project Key
  value:
    simple: ${incident.jiraproject}
  required: false
  description: ""
  playbookInputQuery: null
- key: Summary
  value:
    simple: ${incident.jirasummary}
  required: false
  description: ""
  playbookInputQuery: null
- key: Issue Type
  value:
    simple: ${incident.jiraissuetype}
  required: false
  description: ""
  playbookInputQuery: null
- key: Issue Description
  value:
    simple: ${incident.jiradescription}
  required: false
  description: ""
  playbookInputQuery: null
- key: Action
  value:
    simple: ${incident.action}
  required: true
  description: ""
  playbookInputQuery: null
outputs: []