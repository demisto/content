id: DSPM Send Slack Notification to User
version: -1
name: DSPM Send Slack Notification to User
description: '"Send Slack Notification to User" playbook is designed to notify a user
  via Slack and handle their response. It begins by sending a Slack notification to
  a specified email using the SlackBlockBuilder script. Afterward, it waits for the
  user''s response until a predefined time, as configured in Prisma Cloud DSPM. Once
  the response is received, it is inserted into the incident''s context. If there
  is an error in generating the Slack block, the incident is added for a re-run. Finally,
  the playbook extracts the user''s response from the Slack block state for further
  processing.'
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: b28b18a1-c34f-4860-8cdc-bc1acfc609b1
    type: start
    task:
      id: b28b18a1-c34f-4860-8cdc-bc1acfc609b1
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "1"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 50
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: 0d63cdcf-6f72-4d7b-8365-11c2c4e54880
    type: regular
    task:
      id: 0d63cdcf-6f72-4d7b-8365-11c2c4e54880
      version: -1
      name: Send slack notification to ${userSlackEmail}
      description: SlackBlockBuilder will format a given Slack block into a format
        readable by the SlackV3 integration. The script will also send the block to
        the given destination. Make sure to mark **Trust any certificate** and fill
        the **XSOAR API Key integration** parameters if you want to get a response
        to the incident context.
      scriptName: SlackBlockBuilder
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "2"
    scriptarguments:
      list_name:
        simple: ${block_list_name}
      user:
        simple: ${userSlackEmail}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: 78f06a05-027f-4d9b-8e73-4981d4b53e56
    type: regular
    task:
      id: 78f06a05-027f-4d9b-8e73-4981d4b53e56
      version: -1
      name: Waiting for user replay till the set time in Prisma Cloud DSPM instance
        configuration.
      scriptName: DSPMWaitUntilUserSpecifiedTime
      type: regular
      iscommand: false
      brand: ""
      description: 'This task will wait until the user-specified time set in the Prisma Cloud DSPM instance.'
    nexttasks:
      '#none#':
      - "3"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: 539591aa-46fd-4790-84f3-a7f9afea2480
    type: regular
    task:
      id: 539591aa-46fd-4790-84f3-a7f9afea2480
      version: -1
      name: ' Get SlackBlockBuilder response and insert it into an incident''s context.'
      description: GetSlackBlockBuilderResponse will format a SlackBlockBuilder response
        and insert it into an incident's context.
      scriptName: GetSlackBlockBuilderResponse
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "4"
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 590
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: a6d0526e-0da1-4296-8879-2531e894d744
    type: condition
    task:
      id: a6d0526e-0da1-4296-8879-2531e894d744
      version: -1
      name: 'Are errors occurred when generating the Slack block list for the incident
        ID : ${incident_object.id}'
      description: This script checks for error entries based on provided entry IDs
        and returns "yes" if any errors are found or "no" if no errors are present.
        If errors are detected, it sets the error messages in the XSOAR context.
      scriptName: DSPMCheckAndSetErrorEntries
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "7"
      "yes":
      - "5"
    scriptarguments:
      entry_id:
        simple: ${lastCompletedTaskEntries}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: ed60ca6f-8c8f-460e-8475-191d92dc4171
    type: regular
    task:
      id: ed60ca6f-8c8f-460e-8475-191d92dc4171
      version: -1
      name: Add incident for re-run
      scriptName: DSPMIncidentList
      type: regular
      iscommand: false
      brand: ""
      description: 'Add the incident to IncidentList for re-run'
    scriptarguments:
      action:
        simple: add
      incident_data:
        simple: ${incident_object}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 180,
          "y": 980
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: c1b08019-c615-43b2-8efc-89eb4055e7df
    type: regular
    task:
      id: c1b08019-c615-43b2-8efc-89eb4055e7df
      version: -1
      name: ExtractUserResponseFromSlackBlockState
      scriptName: DSPMExtractUserResponseFromSlackBlockState
      type: regular
      iscommand: false
      brand: ""
      description: 'Extracts the user submitted response from SlackBlockState'
    scriptarguments:
      SlackBlockState:
        simple: ${SlackBlockState}
      incident_data:
        simple: ${incident_object}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 720,
          "y": 980
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 1025,
        "width": 920,
        "x": 180,
        "y": 50
      }
    }
  }
inputs: []
outputs: []
quiet: true
fromversion: 6.0.0