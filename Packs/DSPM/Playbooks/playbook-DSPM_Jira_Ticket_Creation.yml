id: DSPM Jira Ticket Creation
version: -1
name: DSPM Jira Ticket Creation
description: 'The DSPM Jira Ticket Creation is designed as a sub-playbook for Jira Ticket Creation, streamlining the process of creating a Jira ticket and providing immediate notification to the user with ticket details upon successful creation. If an error occurs during ticket creation, the user receives a notification containing relevant incident details.'
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: bf838bc6-fd32-4cfb-8907-d8ab44600b88
    type: start
    task:
      id: bf838bc6-fd32-4cfb-8907-d8ab44600b88
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "42"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 265,
          "y": 50
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: 849ba9fa-f6b4-4ea8-80be-59ab250c97c8
    type: regular
    task:
      id: 849ba9fa-f6b4-4ea8-80be-59ab250c97c8
      version: -1
      name: OverwriteListAndNotify
      description: This automation script overwrites the value of a specified list and sends a Slack notification to inform the user that they failed to respond to an incident notification in a timely manner. The notification includes a message indicating the end of the incident playbook and an invitation to reopen the incident if necessary.
      scriptName: DSPMOverwriteListAndNotify
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      list_name:
        simple: ${block_list_name}
      message:
        simple: 'JIRA Ticket created successfully with ID: ${Ticket.Id} on Project Key: ${Ticket.Key}. Associated XSOAR incident ID: ${incident.id}.'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "42":
    id: "42"
    taskid: cd8b682e-f8f4-4db3-8115-5680f9f5c28c
    type: regular
    task:
      id: cd8b682e-f8f4-4db3-8115-5680f9f5c28c
      version: -1
      name: Create Jira Issue without Assignee ID
      description: Creates a new issue in Jira.
      script: '|||jira-create-issue'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "54"
    scriptarguments:
      description:
        simple: |-
          Risk Details :
          XSOAR Incident ID: ${incident.id}
          DSPM Risk ID: ${incident.riskfindingid}
          Rule Name: ${incident.riskname}
          Risk Severity: ${incident.severity}
          Asset Name: ${incident.assetname}
          Asset ID: ${incident.assetid}
          Risk Status : ${incident.status}
          Project ID: ${incident.projectid}
          Cloud Provider: ${incident.cloud}
          serviceType: ${incident.servicetype}
          First Detected On: ${incident.firstdetectedon}
          Remediate Instruction: ${incident.remediateinstruction}
      issue_type_name:
        simple: ${User.JiraTicketType}
      project_name:
        simple: ${User.JiraProjectName}
      summary:
        simple: 'The issue created from XSOAR incident Id: ${incident.id} of DSPM risk : ${incident.riskfindingid}. Rule Name: ${incident.riskname}'
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 265,
          "y": 195
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "43":
    id: "43"
    taskid: 78a8f56b-7686-4466-826f-dcefcbb782d5
    type: regular
    task:
      id: 78a8f56b-7686-4466-826f-dcefcbb782d5
      version: -1
      name: Update Slack Incident with JIRA details
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "33"
    scriptarguments:
      details:
        simple: 'JIRA Ticket created successfully with ID: ${Ticket.Id} and Key: ${Ticket.Key}. Associated Remediation ID: ${riskFindingId}. The ticket is not assigned to anybody because an error occurred when retrieving the assignee ID for ${User.Email} from Jira.'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 545
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "54":
    id: "54"
    taskid: 6f0b05ed-e4e7-4f09-8201-263531e8ea3c
    type: condition
    task:
      id: 6f0b05ed-e4e7-4f09-8201-263531e8ea3c
      version: -1
      name: Is there an error when creating a Jira ticket?
      description: This script checks for error entries based on provided entry IDs and returns "yes" if any errors are found or "no" if no errors are present. If errors are detected, it sets the error messages in the XSOAR context.
      scriptName: DSPMCheckAndSetErrorEntries
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "43"
      "yes":
      - "55"
    scriptarguments:
      entry_id:
        simple: ${lastCompletedTaskEntries}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 265,
          "y": 370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "55":
    id: "55"
    taskid: 1c8449db-8ab5-47c1-8790-fefc9afc58d2
    type: playbook
    task:
      id: 1c8449db-8ab5-47c1-8790-fefc9afc58d2
      version: -1
      name: DSPM notify user in case of error
      playbookName: DSPM notify user in case of error
      type: playbook
      iscommand: false
      brand: ""
      description: 'This sub-playbook notify the user in case of any error'
    nexttasks:
      '#none#':
      - "56"
    separatecontext: false
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 480,
          "y": 545
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "56":
    id: "56"
    taskid: 953eaa61-e5cd-42dd-8e90-618748a296fd
    type: regular
    task:
      id: 953eaa61-e5cd-42dd-8e90-618748a296fd
      version: -1
      name: OverwriteListAndNotify
      description: This automation script overwrites the value of a specified list and sends a Slack notification to inform the user that they failed to respond to an incident notification in a timely manner. The notification includes a message indicating the end of the incident playbook and an invitation to reopen the incident if necessary.
      scriptName: DSPMOverwriteListAndNotify
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      list_name:
        simple: ${block_list_name}
      message:
        simple: 'Error while creating JIRA Ticket with ID: ${Ticket.Id} on Project Key: ${Ticket.Key}. Associated XSOAR incident ID: ${incident.id}.'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 765,
        "width": 810,
        "x": 50,
        "y": 50
      }
    }
  }
inputs: []
inputSections:
- inputs: []
  name: General (Inputs group)
  description: Generic group for inputs
outputSections:
- outputs: []
  name: General (Outputs group)
  description: Generic group for outputs
outputs: []
fromversion: 6.10.0
tests:
- No tests (auto formatted)
