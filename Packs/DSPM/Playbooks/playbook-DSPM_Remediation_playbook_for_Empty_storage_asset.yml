id: DSPM Remediation for Empty storage asset
version: -1
name: DSPM Remediation for Empty storage asset
description: This playbook is designed to remediate risks associated with empty storage
  assets across AWS, Azure, and GCP environments. It identifies the cloud provider
  for the asset and proceeds to delete the storage container or bucket accordingly.
  Additionally, it sends notifications via Slack to inform stakeholders about the
  status of the remediation process.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 06b38671-d650-4720-84e9-eb9f8aee5d67
    type: start
    task:
      id: 06b38671-d650-4720-84e9-eb9f8aee5d67
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "4"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 50
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: 072d59fe-c975-4165-8c2a-40c5cf5fdd6e
    type: regular
    task:
      id: 072d59fe-c975-4165-8c2a-40c5cf5fdd6e
      version: -1
      name: Slack block list overwritten with a success message
      description: This automation script overwrites the value of a specified list
        and sends a Slack notification to inform the user that they failed to respond
        to an incident notification in a timely manner. The notification includes
        a message indicating the end of the incident playbook and an invitation to
        reopen the incident if necessary.
      scriptName: DSPMOverwriteListAndNotify
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      list_name:
        simple: ${block_list_name}
      message:
        simple: "For XSOAR incident ID : ${incident.id} successfully applied public
          access block to the ${incident_object.assetName} bucket. Also updated risk:
          ${incident.riskfindingid} status to 'INVESTIGATION'.\nThanks. "
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1070
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: 16cec95d-bb5c-4113-81fe-87993d451a13
    type: condition
    task:
      id: 16cec95d-bb5c-4113-81fe-87993d451a13
      version: -1
      name: Check the Cloud Provider of asset
      description: Check whether the values provided in arguments are equal. If either
        of the arguments are missing, no is returned.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      AWS:
      - "10"
      Azure:
      - "8"
      GCP:
      - "9"
    separatecontext: false
    conditions:
    - label: AWS
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: ${incident_object.cloudProvider}
            iscontext: true
          right:
            value:
              simple: AWS
    - label: Azure
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: ${incident_object.cloudProvider}
            iscontext: true
          right:
            value:
              simple: AZURE
    - label: GCP
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: ${incident_object.cloudProvider}
            iscontext: true
          right:
            value:
              simple: GCP
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 195
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: 924922bd-0063-4a4d-8bdd-388d26bcd49d
    type: condition
    task:
      id: 924922bd-0063-4a4d-8bdd-388d26bcd49d
      version: -1
      name: Have you encountered any errors with mitigating asset risk?
      description: This script checks for error entries based on provided entry IDs
        and returns "yes" if any errors are found or "no" if no errors are present.
        If errors are detected, it sets the error messages in the XSOAR context.
      scriptName: DSPMCheckAndSetErrorEntries
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "11"
      "yes":
      - "7"
    scriptarguments:
      entry_id:
        simple: ${lastCompletedTaskEntries}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 545
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: 00be4379-0d3a-49ea-88d9-e9d72b4a1895
    type: regular
    task:
      id: 00be4379-0d3a-49ea-88d9-e9d72b4a1895
      version: -1
      name: Slack block list overwritten with a error message
      description: This automation script overwrites the value of a specified list
        and sends a Slack notification to inform the user that they failed to respond
        to an incident notification in a timely manner. The notification includes
        a message indicating the end of the incident playbook and an invitation to
        reopen the incident if necessary.
      scriptName: DSPMOverwriteListAndNotify
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      list_name:
        simple: ${block_list_name}
      message:
        simple: 'For XSOAR incident ID : ${incident.id} got error while applying public
          access block to the ${incident_object.assetName} bucket.'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 265,
          "y": 720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: 27db31cb-0d38-4b9b-8dd2-926679d1b441
    type: regular
    task:
      id: 27db31cb-0d38-4b9b-8dd2-926679d1b441
      version: -1
      name: azure-storage-container-delete
      description: Marks the specified Container for deletion. The Container and any
        Blobs contained within it, will be deleted during garbage collection.
      script: Azure Storage Container|||azure-storage-container-delete
      type: regular
      iscommand: true
      brand: Azure Storage Container
    nexttasks:
      '#none#':
      - "6"
    scriptarguments:
      container_name:
        simple: ${incident.assetname}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: ce0fd347-6e94-4121-8fea-dfc50dd96351
    type: regular
    task:
      id: ce0fd347-6e94-4121-8fea-dfc50dd96351
      version: -1
      name: gcs-delete-bucket
      description: Deletes a bucket.
      script: Google Cloud Storage|||gcs-delete-bucket
      type: regular
      iscommand: true
      brand: Google Cloud Storage
    nexttasks:
      '#none#':
      - "6"
    scriptarguments:
      bucket_name:
        simple: ${incident.assetname}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: 8dd96ce3-893a-418b-8c2d-6cf91158a3ff
    type: regular
    task:
      id: 8dd96ce3-893a-418b-8c2d-6cf91158a3ff
      version: -1
      name: aws-s3-delete-bucket
      description: Delete AWS S3 bucket.
      script: AWS - S3|||aws-s3-delete-bucket
      type: regular
      iscommand: true
      brand: AWS - S3
    nexttasks:
      '#none#':
      - "6"
    scriptarguments:
      bucket:
        simple: ${incident.assetname}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 910,
          "y": 370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: 177b8442-9f97-4d3b-8405-9d1a4ad186ab
    type: regular
    task:
      id: 177b8442-9f97-4d3b-8405-9d1a4ad186ab
      version: -1
      name: Updating DSPM risk - ${incident.riskFindingId} status to 'INVESTIGATING'.
      description: Updates the status of a risk finding.
      script: DSPM|||dspm-update-risk-finding-status
      type: regular
      iscommand: true
      brand: DSPM
    nexttasks:
      '#none#':
      - "12"
    scriptarguments:
      risk_finding_id:
        simple: ${incident.riskfindingid}
      riskFindingId:
        simple: ${incident.riskfindingid}
      status:
        simple: INVESTIGATING
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 695,
          "y": 720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: e99dd30b-3926-439c-8b07-0ad6d3e492b2
    type: condition
    task:
      id: e99dd30b-3926-439c-8b07-0ad6d3e492b2
      version: -1
      name: Have encountered any errors while updating risk status on DSPM portal?
      description: This script checks for error entries based on provided entry IDs
        and returns "yes" if any errors are found or "no" if no errors are present.
        If errors are detected, it sets the error messages in the XSOAR context.
      scriptName: DSPMCheckAndSetErrorEntries
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "3"
      "yes":
      - "13"
    scriptarguments:
      entry_id:
        simple: ${lastCompletedTaskEntries}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 695,
          "y": 895
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: 17dca5d1-872c-45e1-858c-fd4e2e82ce50
    type: regular
    task:
      id: 17dca5d1-872c-45e1-858c-fd4e2e82ce50
      version: -1
      name: Slack block list overwritten with a error message
      description: This automation script overwrites the value of a specified list
        and sends a Slack notification to inform the user that they failed to respond
        to an incident notification in a timely manner. The notification includes
        a message indicating the end of the incident playbook and an invitation to
        reopen the incident if necessary.
      scriptName: DSPMOverwriteListAndNotify
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      list_name:
        simple: ${block_list_name}
      message:
        simple: "For XSOAR incident ID : ${incident.id} successfully applied public
          access block to the ${incident_object.assetName} bucket. \nBut while updating
          risk: ${incident.riskfindingid} status to 'INVESTIGATION' got error.\nThanks. "
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 910,
          "y": 1070
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "14":
    id: "14"
    taskid: 09a27f78-4cf2-4cee-88fc-0f3da9271a1c
    type: regular
    task:
      id: 09a27f78-4cf2-4cee-88fc-0f3da9271a1c
      version: -1
      name: Add incident for re-run
      scriptName: DSPMIncidentList
      type: regular
      iscommand: false
      brand: ""
      description: 'Add the incident to IncidentList for re-run.'
    scriptarguments:
      incident_data:
        simple: ${incident_object}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 265,
          "y": 895
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 1115,
        "width": 1240,
        "x": 50,
        "y": 50
      }
    }
  }
inputs: []
outputs: []
sourceplaybookid: c7f9a77b-18e3-45ca-8307-b39035938abe
fromversion: 6.0.0