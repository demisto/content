description: Extract and enrich indicators
id: Extract and Create Relationships
inputs:
- description: The raw content of an article
  key: raw_content
  playbookInputQuery:
  required: false
  value: {}
- description: Report indicator value
  key: indicator_value
  playbookInputQuery:
  required: false
  value: {}
name: Extract and Create Relationships
outputs: []
starttaskid: "0"
tasks:
  "0":
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "1"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 5ed7c5df-7f48-4052-85df-17d64f15042d
      iscommand: false
      name: ""
      version: -1
    taskid: 5ed7c5df-7f48-4052-85df-17d64f15042d
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 440,
          "y": -700
        }
      }
  "1":
    id: "1"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "20"
      - "21"
      - "23"
      - "24"
      - "22"
      - "25"
    note: false
    quietmode: 0
    reputationcalc: 2
    scriptarguments:
      text:
        simple: ${inputs.raw_content}
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.extract.indicators
      id: 2bd5f59e-d3ff-485b-8322-591133ce8b5b
      iscommand: true
      name: Extract indicators from report description
      script: Builtin|||extractIndicators
      type: regular
      version: -1
    taskid: 2bd5f59e-d3ff-485b-8322-591133ce8b5b
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 440,
          "y": -500
        }
      }
  "2":
    id: "2"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    scriptarguments:
      create_indicator:
        simple: "true"
      description:
        simple: Extracted from report
      entity_a:
        simple: ${inputs.indicator_value}
      entity_a_type:
        simple: Report
      entity_b:
        simple: ${ExtractedIndicators.CVE}
      entity_b_type:
        simple: CVE
      relationship:
        simple: related-to
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: This automation creates a relationship between indicator objects.
      id: 17f9824b-c596-4a34-83a6-9604ab969426
      iscommand: false
      name: CVE Create Relationship
      script: CreateIndicatorRelationship
      type: regular
      version: -1
    taskid: 17f9824b-c596-4a34-83a6-9604ab969426
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 440,
          "y": 400
        }
      }
  "3":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: ExtractedIndicators.CVE
          operator: isNotEmpty
      label: "yes"
    id: "3"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "6"
      "yes":
      - "2"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks whether CVEs were extracted
      id: ce4e0982-8c29-4b4c-867e-9bd9db8a3ff0
      iscommand: false
      name: Are there CVEs?
      type: condition
      version: -1
    taskid: ce4e0982-8c29-4b4c-867e-9bd9db8a3ff0
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 440,
          "y": 70
        }
      }
  "4":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: ExtractedIndicators.IP
          operator: isNotEmpty
      label: "yes"
    id: "4"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "6"
      "yes":
      - "5"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks whether IPs were extracted from the report.
      id: 6ead7b4f-3d9b-4a6f-89b8-0d5fc32a57ea
      iscommand: false
      name: Are there IPs?
      type: condition
      version: -1
    taskid: 6ead7b4f-3d9b-4a6f-89b8-0d5fc32a57ea
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1290,
          "y": 70
        }
      }
  "5":
    id: "5"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    scriptarguments:
      create_indicator:
        simple: "true"
      description:
        simple: Extracted from report
      entity_a:
        simple: ${inputs.indicator_value}
      entity_a_type:
        simple: Report
      entity_b:
        simple: ${ExtractedIndicators.IP}
      entity_b_type:
        simple: IP
      relationship:
        simple: related-to
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: This automation creates a relationship between indicator objects.
      id: 7ef53744-fab8-4f29-8cc7-c1f66b28ed71
      iscommand: false
      name: IP Create Relationship
      script: CreateIndicatorRelationship
      type: regular
      version: -1
    taskid: 7ef53744-fab8-4f29-8cc7-c1f66b28ed71
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1290,
          "y": 400
        }
      }
  "6":
    id: "6"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "19"
    note: false
    quietmode: 0
    scriptarguments:
      all:
        simple: "yes"
      subplaybook:
        simple: "yes"
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: In order to isolate each report and include only the data extracted
        from the specific report.
      id: d2f2bbf6-6585-4a08-8453-c06dec80e33d
      iscommand: false
      name: Delete Context Subplaybook
      script: DeleteContext
      type: regular
      version: -1
    taskid: d2f2bbf6-6585-4a08-8453-c06dec80e33d
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 440,
          "y": 1340
        }
      }
  "7":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: ExtractedIndicators.Email
          operator: isNotEmpty
      label: "yes"
    id: "7"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "6"
      "yes":
      - "8"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks whether emails were extracted.
      id: d56559fc-cf6d-4f59-85bb-78340776297f
      iscommand: false
      name: Are there Emails?
      type: condition
      version: -1
    taskid: d56559fc-cf6d-4f59-85bb-78340776297f
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 870,
          "y": 70
        }
      }
  "8":
    id: "8"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    scriptarguments:
      create_indicator:
        simple: "true"
      description:
        simple: Extracted from report
      entity_a:
        simple: ${inputs.indicator_value}
      entity_a_type:
        simple: Report
      entity_b:
        simple: ${ExtractedIndicators.Email}
      entity_b_type:
        simple: Email
      relationship:
        simple: related-to
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: This automation creates a relationship between indicator objects.
      id: d74b2cc1-63c5-4005-8cd2-13a85e3218a2
      iscommand: false
      name: Email Create Relationship
      script: CreateIndicatorRelationship
      type: regular
      version: -1
    taskid: d74b2cc1-63c5-4005-8cd2-13a85e3218a2
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 870,
          "y": 400
        }
      }
  "10":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: ExtractedIndicators.Domain
          operator: isNotEmpty
      label: "yes"
    id: "10"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "6"
      "yes":
      - "11"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks whether domains were extracted.
      id: bba003ef-76b3-429b-862a-9548862b5ef4
      iscommand: false
      name: Are there Domains?
      type: condition
      version: -1
    taskid: bba003ef-76b3-429b-862a-9548862b5ef4
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 10,
          "y": 70
        }
      }
  "11":
    id: "11"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    scriptarguments:
      create_indicator:
        simple: "true"
      description:
        simple: Extracted from report
      entity_a:
        simple: ${inputs.indicator_value}
      entity_a_type:
        simple: Report
      entity_b:
        simple: ${ExtractedIndicators.Domain}
      entity_b_type:
        simple: Domain
      relationship:
        simple: related-to
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: This automation creates a relationship between indicator objects.
      id: c50792e9-2b79-4bbc-8be5-223f2731a60e
      iscommand: false
      name: Domain Create Relationship
      script: CreateIndicatorRelationship
      type: regular
      version: -1
    taskid: c50792e9-2b79-4bbc-8be5-223f2731a60e
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 10,
          "y": 400
        }
      }
  "12":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: ExtractedIndicators.URL
          operator: isNotEmpty
      label: "yes"
    id: "12"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "6"
      "yes":
      - "13"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks whether URLs were extracted.
      id: a3288eb7-b9f6-4f6c-8bde-e68a5fb779b2
      iscommand: false
      name: Are there URLs?
      type: condition
      version: -1
    taskid: a3288eb7-b9f6-4f6c-8bde-e68a5fb779b2
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -420,
          "y": 70
        }
      }
  "13":
    id: "13"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    scriptarguments:
      create_indicator:
        simple: "true"
      description:
        simple: Extracted from report
      entity_a:
        simple: ${inputs.indicator_value}
      entity_a_type:
        simple: Report
      entity_b:
        simple: ${ExtractedIndicators.URL}
      entity_b_type:
        simple: URL
      relationship:
        simple: related-to
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: This automation creates a relationship between indicator objects.
      id: 53ff0ad3-8b01-4c3e-816e-fe7deffa9e06
      iscommand: false
      name: URL Create Relationship
      script: CreateIndicatorRelationship
      type: regular
      version: -1
    taskid: 53ff0ad3-8b01-4c3e-816e-fe7deffa9e06
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -430,
          "y": 400
        }
      }
  "19":
    id: "19"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 5b5c468a-d9a0-478f-844b-d0313e3be872
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: 5b5c468a-d9a0-478f-844b-d0313e3be872
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 440,
          "y": 1560
        }
      }
  "20":
    id: "20"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "4"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 89139733-1763-4e1a-8fea-221d26ab593b
      iscommand: false
      name: IP
      type: title
      version: -1
    taskid: 89139733-1763-4e1a-8fea-221d26ab593b
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1290,
          "y": -100
        }
      }
  "21":
    id: "21"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "7"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 5c55a84e-5eda-42fa-8d6a-053394a8de70
      iscommand: false
      name: Email
      type: title
      version: -1
    taskid: 5c55a84e-5eda-42fa-8d6a-053394a8de70
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 870,
          "y": -100
        }
      }
  "22":
    id: "22"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "12"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 9a859d8d-eea1-4357-8484-66009c48cdd6
      iscommand: false
      name: URL
      type: title
      version: -1
    taskid: 9a859d8d-eea1-4357-8484-66009c48cdd6
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -420,
          "y": -100
        }
      }
  "23":
    id: "23"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 7fae69d8-9971-4b41-8dd1-1f4ace014a02
      iscommand: false
      name: CVE
      type: title
      version: -1
    taskid: 7fae69d8-9971-4b41-8dd1-1f4ace014a02
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 440,
          "y": -100
        }
      }
  "24":
    id: "24"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "10"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 5b2e6fa5-4aa9-417c-8b1b-ccc5621ffb71
      iscommand: false
      name: Domain
      type: title
      version: -1
    taskid: 5b2e6fa5-4aa9-417c-8b1b-ccc5621ffb71
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 10,
          "y": -100
        }
      }
  "25":
    id: "25"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "26"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 9cb541b3-16d3-431b-8f3d-59cd2a2ff666
      iscommand: false
      name: File
      type: title
      version: -1
    taskid: 9cb541b3-16d3-431b-8f3d-59cd2a2ff666
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -870,
          "y": -100
        }
      }
  "26":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: ExtractedIndicators.File
          operator: isNotEmpty
      label: "yes"
    id: "26"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "6"
      "yes":
      - "27"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks whether URLs were extracted
      id: 5f4306d2-265f-4469-8167-5e0dfa775268
      iscommand: false
      name: Are there Files hash?
      type: condition
      version: -1
    taskid: 5f4306d2-265f-4469-8167-5e0dfa775268
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -870,
          "y": 70
        }
      }
  "27":
    id: "27"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    scriptarguments:
      create_indicator:
        simple: "true"
      description:
        simple: Extracted from report
      entity_a:
        simple: ${inputs.indicator_value}
      entity_a_type:
        simple: Report
      entity_b:
        simple: ${ExtractedIndicators.File}
      entity_b_type:
        simple: File
      relationship:
        simple: related-to
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: This automation creates a relationship between indicator objects.
      id: 150a34d1-b902-4409-85a6-ce2c2f6f05f3
      iscommand: false
      name: File Create Relationship
      script: CreateIndicatorRelationship
      type: regular
      version: -1
    taskid: 150a34d1-b902-4409-85a6-ce2c2f6f05f3
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -870,
          "y": 400
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 2325,
        "width": 2540,
        "x": -870,
        "y": -700
      }
    }
  }
fromversion: 6.2.0
tests:
- No tests (auto formatted)
