category: IT Services
commonfields:
  id: AWS - IAM Identity Center
  version: -1
configuration:
- display: Role Arn
  name: roleArn
  required: false
  section: Connect
  type: 0
- display: Role Session Name
  name: roleSessionName
  required: false
  section: Connect
  type: 0
- advanced: true
  display: AWS Default Region
  name: defaultRegion
  options:
  - us-east-1
  - us-east-2
  - us-west-1
  - us-west-2
  - ca-central-1
  - eu-west-1
  - eu-central-1
  - eu-west-2
  - ap-northeast-1
  - ap-northeast-2
  - ap-southeast-1
  - ap-southeast-2
  - ap-south-1
  - sa-east-1
  - eu-north-1
  - eu-west-3
  - us-gov-east-1
  - us-gov-west-1
  required: false
  section: Collect
  type: 15
- advanced: true
  display: Role Session Duration
  name: sessionDuration
  required: false
  section: Connect
  type: 0
- display: Access Key
  displaypassword: Secret Key
  name: credentials
  required: false
  section: Connect
  type: 9
- display: Access Key
  hidden: true
  name: access_key
  required: true
  section: Connect
  type: 4
- display: Secret Key
  hidden: true
  name: secret_key
  required: true
  section: Connect
  type: 4
- additionalinfo: The time in seconds till a timeout exception is reached. You can
    specify just the read timeout (for example 60) or also the connect timeout followed
    after a comma (for example 60,10). If a connect timeout is not specified, a default
    of 10 second will be used.
  advanced: true
  defaultvalue: 60,10
  display: Timeout
  name: timeout
  required: false
  section: Connect
  type: 0
- additionalinfo: 'The maximum number of retry attempts when connection or throttling
    errors are encountered. Set to 0 to disable retries. The default value is 5 and
    the limit is 10. Note: Increasing the number of retries will increase the execution
    time.'
  advanced: true
  defaultvalue: "5"
  display: Retries
  name: retries
  required: false
  section: Connect
  type: 0
- advanced: true
  display: Trust any certificate (not secure)
  name: insecure
  required: false
  section: Connect
  type: 8
- advanced: true
  display: Use system proxy settings
  name: proxy
  required: false
  section: Connect
  type: 8
- display: Identity Store Id
  name: IdentityStoreId
  required: true
  type: 4
contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: ""
    itemVersion: ""
    packID: fc025940-2fe4-4adc-80c9-9ad7d8eb7bcd
    packName: AWS - IAM Identity Center Contribution Pack
    prevname: ""
    propagationLabels:
    - all
    toServerVersion: ""
description: Amazon Web Services IAM Identity Center
detaileddescription: |+
  ### Community Contributed Integration
   #### Integration Author: Sameh El-Hakim
   No support or maintenance is provided by the author. Customers are encouraged to engage with the user community for questions and guidance at the [Cortex XSOAR Live Discussions](https://live.paloaltonetworks.com/t5/cortex-xsoar-discussions/bd-p/Cortex_XSOAR_Discussions).
  ***
  AWS IAM Identity Center

  Author: Sameh El-Hakim

  With AWS IAM Identity Center (successor to AWS Single Sign-On), you can manage sign-in security for your workforce identities, also known as workforce users. IAM Identity Center provides one place where you can create or connect workforce users and manage their access centrally across all their AWS accounts and applications. IAM Identity Center is the recommended approach for workforce authentication and authorization in AWS, for organizations of any size and type.


  ---

  [View Integration Documentation](https://xsoar.pan.dev/docs/reference/integrations/aws-iam-identitycenter)

display: AWS - IAM Identity Center
image: data:image/png;base64,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
name: AWS - IAM Identity Center
script:
  commands:
  - arguments:
    - description: The name of the user to create.
      name: userName
      required: true
    - name: familyName
    - name: givenName
      required: true
    - name: userEmailAddress
      required: true
    - name: displayName
      required: true
    description: Creates a new IAM Identity Center user for your AWS account.
    name: aws-iam-identitycenter-create-user
    outputs:
    - contextPath: AWS.IAMIdentityCenter.Users.UserId
      description: The date and time, when the user was created.
      type: date
  - arguments:
    - description: The name of the user to get information about.
      name: userName
      required: true
    description: Retrieves information about the specified IAM user, including the
      user's creation date, path, unique ID, and ARN.
    name: aws-iam-identitycenter-get-user
    outputs:
    - contextPath: AWS.IAM.IdentityCenter.Users.UserName
      description: The friendly name identifying the user.
      type: string
    - contextPath: AWS.IAM.IdentityCenter.Users.UserId
      description: The stable and unique string identifying the user.
      type: string
  - arguments: []
    description: Lists the IAM users, returns all users in the AWS account.
    name: aws-iam-identitycenter-list-users
    outputs:
    - contextPath: AWS.IAMIdentityCenter.Users.UserName
      description: The friendly name identifying the user.
      type: string
    - contextPath: AWS.IAMIdentityCenter.Users.UserId
      description: The stable and unique string identifying the user.
      type: string
  - arguments: []
    description: Lists all the IAM groups in the AWS account
    name: aws-iam-identitycenter-list-groups
    outputs:
    - contextPath: AWS.IAM.Groups.GroupName
      description: The friendly name that identifies the group.
      type: string
    - contextPath: AWS.IAM.Groups.GroupId
      description: The stable and unique string identifying the group.
      type: string
  - arguments:
    - description: The name of the user to list groups for.
      name: userName
      required: true
    description: Lists the IAM groups that the specified IAM user belongs to.
    name: aws-iam-identitycenter-list-groups-for-user
    outputs:
    - contextPath: AWS.IAM.IdentityCenter.Users.GroupMemeberships.GroupName
      description: The friendly name that identifies the group.
      type: string
    - contextPath: AWS.IAM.IdentityCenter.Users.GroupMemeberships.GroupId
      description: The stable and unique string identifying the group
      type: string
  - arguments:
    - description: The name of the user to add.
      name: userName
      required: true
    - description: The name of the group to update.
      name: groupName
      required: true
    description: Adds the specified user to the specified group.
    name: aws-iam-identitycenter-add-user-to-group
  - arguments:
    - name: groupName
      required: true
    description: The name of the group to search.
    name: aws-iam-identitycenter-get-group
  - arguments:
    - description: Username that will be removed from all groups
      name: userName
      required: true
    description: This will remove the entered user from all groups/memberships
    name: aws-iam-identitycenter-remove-user-from-all-groups
  dockerimage: demisto/boto3py3:1.0.0.65194
  runonce: false
  script: |-
    register_module_line('AWS - IAM Identity Cetner', 'start', __line__())
    ### pack version: 1.1.34


    import botocore.exceptions

    from datetime import datetime, date
    import urllib3.util

    # Disable insecure warnings
    urllib3.disable_warnings()

    param = demisto.params()

    SERVICE = 'identitystore'
    IDENTITYSTOREID = param.get('IdentityStoreId')

    class DatetimeEncoder(json.JSONEncoder):
        # pylint: disable=method-hidden
        def default(self, obj):
            if isinstance(obj, datetime):
                return obj.strftime('%Y-%m-%dT%H:%M:%S')
            elif isinstance(obj, date):
                return obj.strftime('%Y-%m-%d')
            # Let the base class default method raise the TypeError
            return json.JSONEncoder.default(self, obj)


    def create_user(args, client):  # pragma: no cover
        username = demisto.getArg('userName')
        familyName = demisto.getArg('familyName')
        givenName = demisto.getArg('givenName')
        userEmail = demisto.getArg('userEmailAddress')
        userDisplayName = demisto.getArg('displayName')

        response = client.create_user(
            IdentityStoreId=f'{IDENTITYSTOREID}',
            UserName=f'{username}',
            Name={
                'FamilyName': f'{familyName}',
                'GivenName': f'{givenName}'
            },
            Emails=[
                {
                    'Value': f'{userEmail}',
                    'Primary': True
                },
            ],
            DisplayName=f'{userDisplayName}'
        )
        print(response)
        ec = {'AWS.IAMIdentityCenter.Users': response}
        human_readable = tableToMarkdown('AWS IAM Identity Center Users', response)
        return_outputs(human_readable, ec)


    def get_user(args, client):  # pragma: no cover
        data = []
        userName = demisto.getArg('userName')
        response = client.list_users(
            IdentityStoreId=f'{IDENTITYSTOREID}',
            Filters=[
                {
                    'AttributePath': 'UserName',
                    'AttributeValue': f'{userName}'
                },
            ]
        )
        rep = json.dumps(response)
        repJSON = json.loads(rep)
        datas = repJSON.get('Users', [])
        for da in datas:
            for user in response['Users']:
                user_details = {
                    'UserName': user['UserName'],
                    'UserId': user['UserId']
                }
                userID = user['UserId']
                data.append(user_details)
        ec = {'AWS.IAM.IdentityCenter.Users': data}
        human_readable = tableToMarkdown('AWS IAM Users', data, removeNull=True)
        return_outputs(human_readable, ec)
        return userID


    def list_users(args, client):  # pragma: no cover
        data = []
        response = client.list_users(
            IdentityStoreId=f'{IDENTITYSTOREID}',
        )
        rep = json.dumps(response)
        repJSON = json.loads(rep)
        datas = repJSON.get('Users', [])
        for da in datas:
            for user in response['Users']:
                user_details = {
                    'UserName': user['UserName'],
                    'UserId': user['UserId']
                }
                data.append(user_details)
        ec = {'AWS.IAM.IdentityCenter.Users': data}
        human_readable = tableToMarkdown('AWS IAM Identity Center Users', data, removeNull=True)
        return_outputs(human_readable, ec)


    def list_groups(args, client):  # pragma: no cover
        data = []
        response = client.list_groups(
            IdentityStoreId=f'{IDENTITYSTOREID}',
        )
        rep = json.dumps(response)
        repJSON = json.loads(rep)
        datas = repJSON.get('Groups', [])
        for da in datas:
            for group in response['Groups']:
                group_details = {
                    'DisplayName': group['DisplayName'],
                    'GroupId': group['GroupId']
                }
                data.append(group_details)
        ec = {'AWS.IAM.IdentityCenter.Groups': data}
        human_readable = tableToMarkdown('AWS IAM Identity Center Groups', data)
        return_outputs(human_readable, ec)


    def get_group(args, client):  # pragma: no cover
        data = []
        groupName = demisto.getArg('groupName')
        response = client.list_groups(
            IdentityStoreId=f'{IDENTITYSTOREID}',
            Filters=[
                {
                    'AttributePath': 'DisplayName',
                    'AttributeValue': f'{groupName}'
                },
            ]
        )
        rep = json.dumps(response)
        repJSON = json.loads(rep)
        datas = repJSON.get('Groups', [])
        for da in datas:
            for group in response['Groups']:
                group_details = {
                    'DisplayName': group['DisplayName'],
                    'GroupId': group['GroupId']
                }
                groupID = group['GroupId']
                data.append(group_details)
        ec = {'AWS.IAM.IdentityCenter.Groups': data}
        human_readable = tableToMarkdown('AWS IAM Identity Center Groups', data)
        return_outputs(human_readable, ec)
        return groupID


    def list_groups_for_user(args, client):  # pragma: no cover
        data = []
        userName = demisto.getArg('userName')
        userID = get_user(args,client)
        response = client.list_group_memberships_for_member(
            IdentityStoreId=f'{IDENTITYSTOREID}',
            MemberId={
                'UserId': f'{userID}'
            }
        )
        rep = json.dumps(response)
        repJSON = json.loads(rep)
        datas = repJSON.get('GroupMemberships', [])
        for da in datas:
            for group in response['GroupMemberships']:
                group_details = {
                    'GroupId': group['GroupId'],
                    'MembershipId': group['MembershipId']
                }
                membershipID = group['MembershipId']
                data.append(group_details)
        ec = {'AWS.IAM.IdentityCenter.Users.GroupMemeberships': data}
        human_readable = tableToMarkdown(f'AWS IAM Identity Center Group for user {userName} ', data)
        return_outputs(human_readable, ec)
        return membershipID


    def add_user_to_group(args, client):  # pragma: no cover
        userID = get_user(args,client)
        GroupID = get_group(args,client)
        response = client.create_group_membership(
            IdentityStoreId=f'{IDENTITYSTOREID}',
            GroupId=f'{GroupID}',
            MemberId={
                'UserId': f'{userID}'
            }
        )
        if response['ResponseMetadata']['HTTPStatusCode'] == 200:
            demisto.results("The user {0} was added to the IAM group: {1}".format(args.get('userName'),
                                                                                  args.get(
                                                                                      'groupName')))


    def remove_user_from_groups(args, client):  # pragma: no cover
        membershipID = list_groups_for_user(args, client)
        response = client.delete_group_membership(
            IdentityStoreId=f'{IDENTITYSTOREID}',
            MembershipId=f'{membershipID}'
        )
        if response['ResponseMetadata']['HTTPStatusCode'] == 200:
            demisto.results(
                "The User {0} has been removed from the group {1}".format(args.get('userName'),
                                                                          args.get('groupName')))


    def test_function(client):
        response = client.list_users()
        if response['ResponseMetadata']['HTTPStatusCode'] == 200:
            demisto.results('ok')


    def main():     # pragma: no cover
        params = demisto.params()
        aws_default_region = params.get('defaultRegion')
        aws_role_arn = params.get('roleArn')
        aws_role_session_name = params.get('roleSessionName')
        aws_role_session_duration = params.get('sessionDuration')
        aws_role_policy = None
        aws_access_key_id = params.get('credentials', {}).get('identifier') or params.get('access_key')
        aws_secret_access_key = params.get('credentials', {}).get('password') or params.get('secret_key')
        verify_certificate = not params.get('insecure', True)
        timeout = params.get('timeout')
        retries = params.get('retries') or 5

        validate_params(aws_default_region, aws_role_arn, aws_role_session_name, aws_access_key_id,
                        aws_secret_access_key)

        aws_client = AWSClient(aws_default_region, aws_role_arn, aws_role_session_name, aws_role_session_duration,
                               aws_role_policy, aws_access_key_id, aws_secret_access_key, verify_certificate, timeout,
                               retries)
        command = demisto.command()
        args = demisto.args()
        client = aws_client.aws_session(
            service=SERVICE,
            role_arn=args.get('roleArn'),
            role_session_name=args.get('roleSessionName'),
            role_session_duration=args.get('roleSessionDuration'),
        )

        try:
            LOG('Command being called is {command}'.format(command=command))
            if command == 'test-module':
                test_function(client)
            elif command == 'aws-iam-identitycenter-create-user':
                create_user(args, client)
            elif command == 'aws-iam-identitycenter-get-user':
                get_user(args, client)
            elif command == 'aws-iam-identitycenter-list-users':
                list_users(args, client)
            elif command == 'aws-iam-identitycenter-list-groups':
                list_groups(args, client)
            elif command == 'aws-iam-identitycenter-get-group':
                get_user(args, client)
            elif command == 'aws-iam-identitycenter-list-groups-for-user':
                list_groups_for_user(args, client)
            elif command == 'aws-iam-identitycenter-add-user-to-group':
                add_user_to_group(args, client)
            elif command == 'aws-iam-identitycenter-remove-user-from-all-groups':
                remove_user_from_groups(args, client)

        except Exception as e:
            LOG(str(e))
            return_error('Error has occurred in the AWS IAM Integration: {code}\n {message}'.format(
                code=type(e), message=str(e)))



    ### GENERATED CODE ###: from AWSApiModule import *  # noqa: E402
    # This code was inserted in place of an API module.
    register_module_line('AWSApiModule', 'start', __line__(), wrapper=-3)


    import boto3
    from botocore.config import Config


    def validate_params(aws_default_region, aws_role_arn, aws_role_session_name, aws_access_key_id, aws_secret_access_key):
        """
        Validates that the provided parameters are compatible with the appropriate authentication method.
        """
        if not aws_default_region:
            raise DemistoException('You must specify AWS default region.')

        if bool(aws_access_key_id) != bool(aws_secret_access_key):
            raise DemistoException('You must provide Access Key id and Secret key id to configure the instance with '
                                   'credentials.')
        if bool(aws_role_arn) != bool(aws_role_session_name):
            raise DemistoException('Role session name is required when using role ARN.')


    def extract_session_from_secret(secret_key, session_token):
        """
        Extract the session token from the secret_key field.
        """
        if secret_key and '@@@' in secret_key and not session_token:
            return secret_key.split('@@@')[0], secret_key.split('@@@')[1]
        else:
            return secret_key, session_token


    class AWSClient:

        def __init__(self, aws_default_region, aws_role_arn, aws_role_session_name, aws_role_session_duration,
                     aws_role_policy, aws_access_key_id, aws_secret_access_key, verify_certificate, timeout, retries,
                     aws_session_token=None, sts_endpoint_url=None, endpoint_url=None):

            self.sts_endpoint_url = sts_endpoint_url
            self.endpoint_url = endpoint_url
            self.aws_default_region = aws_default_region
            self.aws_role_arn = aws_role_arn
            self.aws_role_session_name = aws_role_session_name
            # handle cases where aws_role_session_duration can be also empty string
            self.aws_role_session_duration = aws_role_session_duration if aws_role_session_duration else None
            self.aws_role_policy = aws_role_policy
            self.aws_access_key_id = aws_access_key_id
            self.aws_secret_access_key, self.aws_session_token = extract_session_from_secret(aws_secret_access_key, aws_session_token)
            self.verify_certificate = verify_certificate

            proxies = handle_proxy(proxy_param_name='proxy', checkbox_default_value=False)
            (read_timeout, connect_timeout) = AWSClient.get_timeout(timeout)
            if int(retries) > 10:
                retries = 10
            self.config = Config(
                connect_timeout=connect_timeout,
                read_timeout=read_timeout,
                retries=dict(
                    max_attempts=int(retries)
                ),
                proxies=proxies
            )

        def update_config(self):
            command_config = {}
            retries = demisto.getArg('retries')  # Supports retries and timeout parameters on the command execution level
            if retries is not None:
                command_config['retries'] = dict(max_attempts=int(retries))
            timeout = demisto.getArg('timeout')
            if timeout is not None:
                (read_timeout, connect_timeout) = AWSClient.get_timeout(timeout)
                command_config['read_timeout'] = read_timeout
                command_config['connect_timeout'] = connect_timeout
            if retries or timeout:
                demisto.debug('Merging client config settings: {}'.format(command_config))
                self.config = self.config.merge(Config(**command_config))

        def aws_session(self, service, region=None, role_arn=None, role_session_name=None, role_session_duration=None,
                        role_policy=None):
            kwargs = {}

            self.update_config()

            if role_arn and role_session_name is not None:
                kwargs.update({
                    'RoleArn': role_arn,
                    'RoleSessionName': role_session_name,
                })
            elif self.aws_role_arn and self.aws_role_session_name is not None:
                kwargs.update({
                    'RoleArn': self.aws_role_arn,
                    'RoleSessionName': self.aws_role_session_name,
                })

            if role_session_duration is not None:
                kwargs.update({'DurationSeconds': int(role_session_duration)})
            elif self.aws_role_session_duration is not None:
                kwargs.update({'DurationSeconds': int(self.aws_role_session_duration)})

            if role_policy is not None:
                kwargs.update({'Policy': role_policy})
            elif self.aws_role_policy is not None:
                kwargs.update({'Policy': self.aws_role_policy})

            demisto.debug('{kwargs}='.format(kwargs=kwargs))

            if kwargs and not self.aws_access_key_id:  # login with Role ARN
                if not self.aws_access_key_id:
                    sts_client = boto3.client('sts', config=self.config, verify=self.verify_certificate,
                                              region_name=region if region else self.aws_default_region,
                                              endpoint_url=self.sts_endpoint_url)
                    sts_response = sts_client.assume_role(**kwargs)
                    client = boto3.client(
                        service_name=service,
                        region_name=region if region else self.aws_default_region,
                        aws_access_key_id=sts_response['Credentials']['AccessKeyId'],
                        aws_secret_access_key=sts_response['Credentials']['SecretAccessKey'],
                        aws_session_token=sts_response['Credentials']['SessionToken'],
                        verify=self.verify_certificate,
                        config=self.config,
                        endpoint_url=self.endpoint_url
                    )
            elif self.aws_access_key_id and (role_arn or self.aws_role_arn):  # login with Access Key ID and Role ARN
                sts_client = boto3.client(
                    service_name='sts',
                    aws_access_key_id=self.aws_access_key_id,
                    aws_secret_access_key=self.aws_secret_access_key,
                    verify=self.verify_certificate,
                    config=self.config,
                    endpoint_url=self.sts_endpoint_url
                )
                kwargs.update({
                    'RoleArn': role_arn or self.aws_role_arn,
                    'RoleSessionName': role_session_name or self.aws_role_session_name,
                })
                sts_response = sts_client.assume_role(**kwargs)
                client = boto3.client(
                    service_name=service,
                    region_name=region if region else self.aws_default_region,
                    aws_access_key_id=sts_response['Credentials']['AccessKeyId'],
                    aws_secret_access_key=sts_response['Credentials']['SecretAccessKey'],
                    aws_session_token=sts_response['Credentials']['SessionToken'],
                    verify=self.verify_certificate,
                    config=self.config,
                    endpoint_url=self.endpoint_url
                )
            elif self.aws_session_token and not self.aws_role_arn:  # login with session token
                client = boto3.client(
                    service_name=service,
                    region_name=region if region else self.aws_default_region,
                    aws_access_key_id=self.aws_access_key_id,
                    aws_secret_access_key=self.aws_secret_access_key,
                    aws_session_token=self.aws_session_token,
                    verify=self.verify_certificate,
                    config=self.config,
                    endpoint_url=self.endpoint_url
                )
            elif self.aws_access_key_id and not self.aws_role_arn:  # login with access key id
                client = boto3.client(
                    service_name=service,
                    region_name=region if region else self.aws_default_region,
                    aws_access_key_id=self.aws_access_key_id,
                    aws_secret_access_key=self.aws_secret_access_key,
                    verify=self.verify_certificate,
                    config=self.config,
                    endpoint_url=self.endpoint_url
                )
            else:  # login with default permissions, permissions pulled from the ec2 metadata
                client = boto3.client(service_name=service,
                                      region_name=region if region else self.aws_default_region,
                                      endpoint_url=self.endpoint_url)

            return client

        @staticmethod
        def get_timeout(timeout):
            if not timeout:
                timeout = "60,10"  # default values
            try:

                if isinstance(timeout, int):
                    read_timeout = timeout
                    connect_timeout = 10

                else:
                    timeout_vals = timeout.split(',')
                    read_timeout = int(timeout_vals[0])
                    # the default connect timeout is 10
                    connect_timeout = 10 if len(timeout_vals) == 1 else int(timeout_vals[1])

            except ValueError:
                raise DemistoException("You can specify just the read timeout (for example 60) or also the connect "
                                       "timeout followed after a comma (for example 60,10). If a connect timeout is not "
                                       "specified, a default of 10 second will be used.")
            return read_timeout, connect_timeout

    register_module_line('AWSApiModule', 'end', __line__(), wrapper=1)
    ### END GENERATED CODE ###

    if __name__ in ('__builtin__', 'builtins', '__main__'):
        main()

    register_module_line('AWS - IAM Identity Cetner', 'end', __line__())
  subtype: python3
  type: python
sourcemoduleid: AWS - IAM
