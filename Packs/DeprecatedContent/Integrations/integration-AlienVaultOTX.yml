category: Data Enrichment & Threat Intelligence
commonfields:
  id: AlienVault OTX
  version: -1
configuration:
- defaultvalue: https://otx.alienvault.com
  display: Server URL (e.g. https://192.168.0.1)
  name: server
  required: true
  type: 0
- defaultvalue: '443'
  display: Port
  name: port
  required: true
  type: 0
- defaultvalue: ''
  display: API key
  name: apikey
  required: true
  type: 4
- defaultvalue: ''
  display: Trust any certificate (not secure)
  name: insecure
  required: false
  type: 8
- defaultvalue: ''
  display: Use system proxy settings
  name: proxy
  required: false
  type: 8
deprecated: true
description: Deprecated - We recommend using AlienVault OTX v2 instead. Query IOCs
  in AlienVault
detaileddescription: 'To get Your API Key, go to [AlienVault OTX](https://otx.alienvault.com).

  After you login (or sign in), under Your profile settings You will find a OTX Key
  section.

  This section contain Your key.

  '
display: AlienVault OTX (Deprecated)
fromversion: 3.0.1
image: data:image/png;base64,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
name: AlienVault OTX
script:
  commands:
  - arguments:
    - default: true
      description: ip to query
      name: ip
      required: true
    description: Query IP in AlienVault OTX
    name: ip
    outputs:
    - contextPath: IP.Address
      description: IP Address
    - contextPath: IP.ASN
      description: IP ASN
    - contextPath: IP.Geo.Country
      description: IP country
    - contextPath: IP.Geo.Latitude
      description: IP latitude
    - contextPath: IP.Geo.Longitude
      description: IP longitude
    - contextPath: AlienVaultOTX.Reputation
      description: IP reputation
  - arguments:
    - default: true
      description: domain to query
      name: domain
      required: true
    description: Query domain in AlienVault OTX
    name: domain
    outputs:
    - contextPath: Domain.Name
      description: Domain name
    - contextPath: Domain.AlienVaultOTX.Alexa
      description: Alexa URL for domain data
    - contextPath: Domain.AlienVaultOTX.Whois
      description: Whois URL for domain data
  - arguments:
    - default: true
      description: ip to query
      name: ip
      required: true
    description: Query IP in AlienVault OTX
    name: ipv6
    outputs:
    - contextPath: IP.Address
      description: IP Address
    - contextPath: IP.ASN
      description: IP ASN
    - contextPath: IP.AlienVaultOTX.Reputation
      description: AlienVault IP reputation
  - arguments:
    - default: true
      description: hostname to query
      name: hostname
      required: true
    description: Query hostname in AlienVault OTX
    name: hostname
    outputs:
    - contextPath: Endpoint.Hostname
      description: Endpoint hostname
    - contextPath: Endpoint.AlienVaultOTX.Alexa
      description: Endpoint Alexa URL
    - contextPath: Endpoint.AlienVaultOTX.Whois
      description: Endpoint Whois URL
  - arguments:
    - default: true
      description: md5 to query
      name: file
      required: true
    description: Query file in AlienVault OTX
    name: file
    outputs:
    - contextPath: File.MD5
      description: File md5
  - arguments:
    - description: File md5
      name: md5
    - description: File sha1
      name: sha1
    - description: File sha256
      name: sha256
    description: Query file in AlienVault OTX
    name: alienvault-query-file
    outputs:
    - contextPath: File.MD5
      description: File md5
    - contextPath: File.SHA1
      description: File sha1
    - contextPath: File.SHA256
      description: File sha256
  - arguments:
    - description: The page of pulses to get
      name: page
    description: Search for pulses in AlienVault OTX
    name: alienvault-search-pulses
    outputs:
    - contextPath: AlienVault.Pulses.ID
      description: Pulse ID
    - contextPath: AlienVault.Pulses.Author.ID
      description: Author ID
    - contextPath: AlienVault.Pulses.Author.Username
      description: Author username
    - contextPath: AlienVault.Pulses.Count
      description: Pulse count
    - contextPath: AlienVault.Pulses.Modified
      description: Pulse modification date
    - contextPath: AlienVault.Pulses.Name
      description: Pulse name
    - contextPath: AlienVault.Pulses.Source
      description: Pulse source
    - contextPath: AlienVault.Pulses.SubscriberCount
      description: Pulse subscriber count
    - contextPath: AlienVault.Pulses.Tags
      description: Pulse tags
    - contextPath: AlienVault.Pulses.Description
      description: Pulse description
  - arguments:
    - description: ID of desired pules"
      name: pulse-id
      required: true
    description: Get pulse details (pulse are alian vault's entities)
    name: alienvault-get-pulse-details
    outputs:
    - contextPath: AlienVault.Pulses.Description
      description: Pulse description
    - contextPath: AlienVault.Pulses.Created
      description: Pulse created
    - contextPath: AlienVault.Pulses.Author.Username
      description: Pulse author username
    - contextPath: AlienVault.Pulses.ID
      description: Pulse ID
    - contextPath: AlienVault.Pulses.Name
      description: Pulse name
    - contextPath: AlienVault.Pulses.Tags
      description: Pulse tags
    - contextPath: AlienVault.Pulses.TargetedCountries
      description: Pulse targeted countries
    - contextPath: AlienVault.Pulses.Description
      description: Pulse description
  - arguments:
    - default: true
      description: url to query
      name: url
      required: true
    description: Query url in AlienVault OTX
    name: url
    outputs:
    - contextPath: URL.Data
      description: 'URL '
  runonce: false
  script: "function getArgName(args) {\n    options = ['md5', 'sha1', 'sha256'];\n\
    \    for (var k in options) {\n        if (args[options[k]]) {\n            return\
    \ options[k];\n        }\n    }\n    throw 'You must provide either sha1, sha256\
    \ or md5';\n}\n\nindicatorsCommands = {\n    'ip': {\n        type: 'IPv4',\n\
    \        argName: 'ip',\n        contextKey: outputPaths.ip,\n        translator:\
    \ [\n            {to: 'Address', from: 'indicator'},\n            {to: 'ASN',\
    \ from: 'asn'},\n            {to: 'Geo-Country', from: 'country_name'},\n    \
    \        {to: 'Geo-Latitude', from: 'latitude'},\n            {to: 'Geo-Longitude',\
    \ from: 'longitude'},\n            {to: 'AlienVaultOTX-Reputation', from: 'reputation'},\n\
    \        ],\n        tableTitle: 'AlienVault ip response %Address%',\n    },\n\
    \    'url': {\n        type: 'url',\n        argName: 'url',\n        contextKey:\
    \ outputPaths.url,\n        translator: [\n            {to: 'Data', from: 'indicator'},\n\
    \        ],\n        tableTitle: 'AlienVault url response %Data%',\n    },\n \
    \   'ipv6': {\n        type: 'IPv6',\n        argName: 'ip',\n        contextKey:\
    \ outputPaths.ip,\n        translator: [\n            {to: 'Address', from: 'indicator'},\n\
    \            {to: 'ASN', from: 'asn'},\n            {to: 'AlienVaultOTX-Reputation',\
    \ from: 'reputation'},\n        ],\n        tableTitle: 'AlienVault ip response\
    \ %Address%',\n    },\n    'domain': {\n        type: 'domain',\n        argName:\
    \ 'domain',\n        contextKey: outputPaths.domain,\n        translator: [\n\
    \            {to: 'Name', from: 'indicator'},\n            {to: 'AlienVaultOTX-Alexa',\
    \ from: 'alexa'},\n            {to: 'AlienVaultOTX-Whois', from: 'whois'},\n \
    \       ],\n        tableTitle: 'AlienVault domain response %Name%',\n    },\n\
    \    'hostname': {\n        type: 'hostname',\n        argName: 'hostname',\n\
    \        contextKey: 'Endpoint(val.Hostname==obj.Hostname)',\n        translator:\
    \ [\n            {to: 'Hostname', from: 'indicator'},\n            {to: 'AlienVaultOTX-Alexa',\
    \ from: 'alexa'},\n            {to: 'AlienVaultOTX-Whois', from: 'whois'},\n \
    \       ],\n        tableTitle: 'AlienVault hostname response %Hostname%',\n \
    \   },\n    'file': {\n        type: 'file',\n        argName: 'file',\n     \
    \   contextKey: outputPaths.file,\n        translator: [\n            {to: 'MD5',\
    \ from: 'indicator'},\n        ],\n        tableTitle: 'AlienVault file response\
    \ %MD5%',\n    },\n    'alienvault-query-file': {\n        type: 'file',\n   \
    \     argName: getArgName,\n        contextKey: outputPaths.file,\n        translator:\
    \ function(args) {\n            return [\n                {to: getArgName(args).toUpperCase(),\
    \ from: 'indicator'},\n            ];\n        },\n        tableTitle: function(args)\
    \ {\n            return 'AlienVault file response %' + getArgName(args).toUpperCase()\
    \ + '%';\n        },\n    },\n};\n\nsearchCommands = {\n    'alienvault-search-pulses':\
    \ {\n        url: 'search/pulses',\n        contextKey: 'AlienVault.Pulses(val.ID==obj.ID)',\n\
    \        translator: [\n            {to: 'ID', from: 'id'},\n            {to:\
    \ 'Author-ID', from: 'author.id'},\n            {to: 'Author-Username', from:\
    \ 'author.username'},\n            {to: 'Count', from: 'indicator_count'},\n \
    \           {to: 'Modified', from: 'modified'},\n            {to: 'Name', from:\
    \ 'name'},\n            {to: 'Source', from: 'pulse_source'},\n            {to:\
    \ 'SubscriberCount', from: 'subscriber_count'},\n            {to: 'Tags', from:\
    \ 'tags'},\n            {to: 'Description', from: 'description'},\n        ],\n\
    \        innerPath: 'results',\n        tableTitle: 'AlienVault pulses',\n   \
    \ },\n    'alienvault-get-pulse-details': {\n        url: 'pulses/%pulse-id%',\n\
    \        contextKey: 'AlienVault.Pulses(val.ID==obj.ID)',\n        translator:\
    \ [\n            {to: 'ID', from: 'id'},\n            {to: 'Created', from: 'created'},\n\
    \            {to: 'Author-Username', from: 'author_name'},\n            {to: 'Description',\
    \ from: 'description'},\n            {to: 'Modified', from: 'modified'},\n   \
    \         {to: 'Name', from: 'name'},\n            {to: 'Tags', from: 'tags'},\n\
    \            {to: 'TargetedCountries', from: 'targeted_countries'},\n        ],\n\
    \        tableTitle: 'AlienVault pulse %ID%',\n    },\n}\n\nvar mapObjFunction\
    \ = function(mapFields) {\n    var transformSingleObj= function(obj) {\n     \
    \   var res = {};\n        mapFields.forEach(function(f) {\n           res[f.to]\
    \ = dq(obj, f.from);\n        });\n        return res;\n    };\n    return function(obj)\
    \ {\n        if (obj instanceof Array) {\n            var res = [];\n        \
    \    for (var j=0; j < obj.length; j++) {\n                res.push(transformSingleObj(obj[j]));\n\
    \            }\n            return res;\n        }\n        return transformSingleObj(obj);\n\
    \    }\n}\n\nvar createContext = function(data) {\n    var createContextSingle\
    \ = function(obj) {\n        var res = {};\n        var keys = Object.keys(obj);\n\
    \        keys.forEach(function(k) {\n            var values = k.split('-');\n\
    \            var current = res;\n            for (var j = 0; j<values.length -\
    \ 1; j++) {\n                if (!current[values[j]]) {\n                    current[values[j]]\
    \ = {};\n                }\n                current = current[values[j]];\n  \
    \          }\n            current[values[j]] = obj[k];\n        });\n        return\
    \ res;\n    };\n    if (data instanceof Array) {\n        var res = [];\n    \
    \    for (var j=0; j < data.length; j++) {\n            res.push(createContextSingle(data[j]));\n\
    \        }\n        return res;\n    }\n    return createContextSingle(data);\n\
    }\n\nfunction domain_from_url(url) {\n    res = url.replace(/(.*:\\/\\/.*)[\\\
    ?\\/#].*/, '$1');\n    return res;\n}\n\n\nbaseUrl = params.server.replace(/[\\\
    /]+$/, '') + ':' + params.port + '/api/v1/';\nfunction sendRequest(url) {\n  \
    \  res = http(\n                baseUrl + url,\n                {\n          \
    \          Method: 'GET',\n                    Headers: {\n                  \
    \      'X-OTX-API-KEY': [params.apikey],\n                    },\n           \
    \     },\n                params.insecure,\n                params.proxy\n   \
    \ );\n    if (res.StatusCode === 404) {\n        return 'Not found'\n    }\n \
    \   if (res.StatusCode < 200 || res.StatusCode >= 300) {\n        throw 'Request\
    \ to ' + url + ' failed, request status code: ' + res.StatusCode + ' and Body:\
    \ ' + res.Body + '.';\n    }\n    // If we have a body, it should have application/json\
    \ content type.\n    if (res.Body &&\n    (!res.Headers['Content-Type'] || !res.Headers['Content-Type'][0]\
    \ || res.Headers['Content-Type'][0].indexOf('application/json') === -1) || res.Body.indexOf('Google\
    \ Tag Manager') != -1) {\n        log('Response body: ' + res.Body);\n       \
    \ throw 'Check your URL (excepting base URL) - got invalid content type, expected\
    \ application/json.';\n    }\n    return res.Body ? JSON.parse(res.Body) : 'empty';\n\
    }\n\nfunction queryIndicators(type, indicator, section) {\n    return sendRequest('indicators/'\
    \ + type + '/' + domain_from_url(indicator) + '/general');\n}\n\nif (command ===\
    \ 'test-module') {\n    res = queryIndicators('IPv4', '8.8.8.8');\n    return\
    \ res !== 'Not found' ? 'ok' : 'Not found';\n}\n\ncurrentCommand = indicatorsCommands[command]\
    \ || searchCommands[command];\nargName = currentCommand.argName instanceof Function\
    \ ? currentCommand.argName(args) : currentCommand.argName;\nvar raw;\nif (indicatorsCommands[command])\
    \ {\n    raw = queryIndicators(currentCommand.type, args[argName]);\n} else {\n\
    \    raw = sendRequest(replaceInTemplatesAndRemove(currentCommand.url, args));\n\
    }\nentry = {\n    Type: entryTypes.note,\n    Contents: raw,\n    ContentsFormat:\
    \ formats.json,\n    ReadableContentsFormat: formats.markdown,\n};\n\ntranslator\
    \ = currentCommand.translator instanceof Function ? currentCommand.translator(args)\
    \ : currentCommand.translator;\ntableTitle = currentCommand.tableTitle instanceof\
    \ Function ? currentCommand.tableTitle(args) : currentCommand.tableTitle;\ntranslated\
    \ = mapObjFunction(translator)(currentCommand.innerPath ? raw[currentCommand.innerPath]\
    \ : raw);\nentry.HumanReadable = tableToMarkdown(replaceInTemplates(tableTitle,\
    \ translated), translated);\nif (currentCommand.contextKey) {\n    ec = {};\n\
    \    contextKey = currentCommand.getContextKey instanceof Function ? currentCommand.contextKey(args)\
    \ : currentCommand.contextKey;\n    outputPath = outputPaths.file;\n    if (argName)\
    \ {\n        switch (argName) {\n            case 'ip':\n                outputPath\
    \ = outputPaths.ip;\n                break;\n            case 'domain':\n    \
    \            outputPath = outputPaths.domain;\n                break;\n      \
    \      case 'url':\n                outputPath = outputPaths.url;\n          \
    \      break;\n        }\n\n        ec[contextKey] = createContext(translated);\n\
    \    }\n    entry.EntryContext = ec;\n    if (ec && ec[contextKey] && ec[contextKey].Geo\
    \ && ec[contextKey].Geo.Latitude && ec[contextKey].Geo.Longitude) {\n        entry\
    \ = [\n            entry,\n            {\n                Type: entryTypes.map,\n\
    \                Contents: {lat: parseFloat(ec[contextKey].Geo.Latitude),\n  \
    \              lng: parseFloat(ec[contextKey].Geo.Longitude)},\n             \
    \   ContentsFormat: formats.json\n            }\n        ];\n    }\n}\n\nreturn\
    \ entry;"
  type: javascript
tests:
- AlienVaultOTX Test
toversion: 4.1.9
