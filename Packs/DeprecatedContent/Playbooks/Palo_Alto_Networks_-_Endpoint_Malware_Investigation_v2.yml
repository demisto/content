id: Palo Alto Networks - Endpoint Malware Investigation v2
version: -1
fromversion: 5.0.0
name: Palo Alto Networks - Endpoint Malware Investigation v2
description: Deprecated. Use the "Palo Alto Networks - Endpoint Malware Investigation v3"\
  \ playbook instead. This playbook is triggered by a Palo Alto Networks Cortex threat alert,\
  \ generated by Traps.  The playbook performs host enrichment for the source host\
  \ with Palo Alto Networks Traps, enriches information for the suspicious file with\
  \ Palo Alto Networks Minemeld and AutoFocus, and automatically performs file detonation\
  \ for the extracted file. It then performs IOC enrichment with Minemeld for all\
  \ related IOCs, and calculates the incident severity based on all the findings.\
  \ In addition we detonate the file for the full analysis report. \nThe analyst can\
  \ perform a manual memory dump for the suspected endpoint based on the incidentâ€™s\
  \ severity, and choose to isolate the source endpoint with Traps.\nHunting tasks\
  \ to find more endpoints that are infected is performed automatically based on a\
  \ playbook input, and after all infected endpoints are found, remediation for all\
  \ malicious IOCs is performed, including file quarantine, and IP and URLs blocking\
  \ with Palo Alto Networks FireWall components such as Dynamic Address Groups and\
  \ Custom URL Categories.\nAfter the investigation review the incident is automatically\
  \ closed.
starttaskid: "0"
hidden: true
tasks:
  "0":
    id: "0"
    taskid: 7013d486-d71b-4117-8551-801797af55ca
    type: start
    task:
      id: 7013d486-d71b-4117-8551-801797af55ca
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "114"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": -120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "5":
    id: "5"
    taskid: 6496fddc-17e5-49d0-8dcc-2372d4b75188
    type: title
    task:
      id: 6496fddc-17e5-49d0-8dcc-2372d4b75188
      version: -1
      name: File Detonation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "98"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 760,
          "y": 1020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "6":
    id: "6"
    taskid: 3dc7c828-d1d0-436f-815e-77185ec9bb13
    type: title
    task:
      id: 3dc7c828-d1d0-436f-815e-77185ec9bb13
      version: -1
      name: File Enrichment
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "77"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 230,
          "y": 1020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "10":
    id: "10"
    taskid: 2a2324c7-c345-436f-89ad-07b03c4af941
    type: title
    task:
      id: 2a2324c7-c345-436f-89ad-07b03c4af941
      version: -1
      name: False Positive
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "45"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -330,
          "y": 2015
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "12":
    id: "12"
    taskid: 2b0599cd-fbcb-4128-8e88-438c376b2c06
    type: title
    task:
      id: 2b0599cd-fbcb-4128-8e88-438c376b2c06
      version: -1
      name: Hunting for malicious indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "90"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2080
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "20":
    id: "20"
    taskid: 5905e6b1-4b54-45b0-8a49-b300a00d1ef5
    type: condition
    task:
      id: 5905e6b1-4b54-45b0-8a49-b300a00d1ef5
      version: -1
      name: Would you like to perform auto-remediation?
      description: Manual review from the analyst.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "130"
      "yes":
      - "129"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 3080
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "34":
    id: "34"
    taskid: 33cdc473-e0a8-4695-8746-8f4080540d55
    type: regular
    task:
      id: 33cdc473-e0a8-4695-8746-8f4080540d55
      version: -1
      name: AutoFocus - Retrieve Sample Analysis
      description: Returns properties, behaviors, and activities observed for a sample.
        Run the command once to get the fields and operating systems under
        HTTP, Coverage, Behavior, Registry, Files, Processes, Connections, and DNS.
      script: '|||autofocus-sample-analysis'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "121"
    scriptarguments:
      filter_data:
        simple: "False"
      os: {}
      sample_id:
        complex:
          root: inputs.SHA256
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 20,
          "y": 1350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "45":
    id: "45"
    taskid: 497f868b-82fa-42ab-870f-0af527f51cc1
    type: title
    task:
      id: 497f868b-82fa-42ab-870f-0af527f51cc1
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 4180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "48":
    id: "48"
    taskid: 01da8370-00b7-460f-8029-ff73a01405f6
    type: condition
    task:
      id: 01da8370-00b7-460f-8029-ff73a01405f6
      version: -1
      name: Continue with the investigation or Close as False Positive?
      description: Manual task for the analyst - continue with the investigation or
        close as a false positive.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      Close as False positive:
      - "10"
      continue:
      - "66"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1700
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "61":
    id: "61"
    taskid: 5cb28c07-2b83-489c-83c5-97d05e210e8d
    type: playbook
    task:
      id: 5cb28c07-2b83-489c-83c5-97d05e210e8d
      version: -1
      name: WildFire - Detonate file
      description: |-
        Detonate one or more files using the Wildfire integration. This playbook
        returns relevant reports to the War Room and file reputations to the context data.
        The detonation supports the following file types -
        APK, JAR, DOC, DOCX, RTF, XLS, XLSX, PPT, PPTX, OOXML, PE32, PDF, DMG, PKG, RAR, 7Z
      playbookName: WildFire - Detonate file
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "121"
    scriptarguments:
      File:
        complex:
          root: File
      Interval:
        simple: "1"
      ReportFileType: {}
      Timeout:
        simple: "15"
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 760,
          "y": 1350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
  "66":
    id: "66"
    taskid: 0dca4b4c-8f48-4aa5-8ebf-d95bfac2e247
    type: regular
    task:
      id: 0dca4b4c-8f48-4aa5-8ebf-d95bfac2e247
      version: -1
      name: Perform manual Malware Analysis and Forensics
      description: Manual task for the analyst - perform manual malware analysis and
        forensics.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "12"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1905
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "77":
    id: "77"
    taskid: 28fe89a9-d801-4f0c-82e7-89753f7a2efa
    type: condition
    task:
      id: 28fe89a9-d801-4f0c-82e7-89753f7a2efa
      version: -1
      name: Is AutoFocus Integration enabled?
      description: Check if the AutoFocus integration is enabled.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "121"
      "yes":
      - "34"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Autofocus
                  - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: AutoFocus V2
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                accessor: brand
            iscontext: true
    view: |-
      {
        "position": {
          "x": 230,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "90":
    id: "90"
    taskid: c0241021-4ff7-433b-8154-ad99537b8414
    type: playbook
    task:
      id: c0241021-4ff7-433b-8154-ad99537b8414
      version: -1
      name: PANW - Hunting and threat detection by indicator type V2
      description: "Integrations list: Cortex (Traps, PAN-OS, Analytics)\nThis is\
        \ a multipurpose playbook used for hunting and threat detection. The playbook\
        \ receives inputs based on hashes, IP addresses, or domain names provided\
        \ manually or from outputs by other playbooks. \nWith the received indicators,\
        \ the playbook leverages Palo Alto Cortex data received by products such as\
        \ Traps, Analytics and Pan-OS to search for IP addresses and hosts related\
        \ to that specific hash. \nThe output provided by the playbook facilitates\
        \ pivoting searches for possibly affected hosts, IP addresses, or users."
      playbookName: PANW - Hunting and threat detection by indicator type V2
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "99"
    scriptarguments:
      IPAddresses:
        complex:
          root: IP
          filters:
          - - operator: isExists
              left:
                value:
                  simple: IP.Malicious
                iscontext: true
          - - operator: IsNotInCidrRanges
              left:
                value:
                  simple: IP.Address
                iscontext: true
              right:
                value:
                  simple: inputs.InternalRange
                iscontext: true
          accessor: Address
      InternalRange:
        complex:
          root: IP
          filters:
          - - operator: IsInCidrRanges
              left:
                value:
                  simple: IP.Address
                iscontext: true
              right:
                value:
                  simple: inputs.internal_range
                iscontext: true
          accessor: Address
      MD5:
        complex:
          root: File
          filters:
          - - operator: isExists
              left:
                value:
                  simple: File.Malicious
                iscontext: true
          accessor: MD5
      SHA1:
        complex:
          root: File
          filters:
          - - operator: isExists
              left:
                value:
                  simple: File.Malicious
                iscontext: true
          accessor: SHA1
      SHA256:
        complex:
          root: File
          filters:
          - - operator: isExists
              left:
                value:
                  simple: File.Malicious
                iscontext: true
          accessor: SHA256
      URLDomain:
        complex:
          root: Domain
          accessor: Name
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: URL.Data
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
  "91":
    id: "91"
    taskid: af48ec70-6fbf-4957-8a37-ee401650c0eb
    type: regular
    task:
      id: af48ec70-6fbf-4957-8a37-ee401650c0eb
      version: -1
      name: Cortex XDR - get endpoints
      description: Gets a list of endpoints, according to the passed filters. Filtering
        by multiple fields is concatenated using AND condition (OR is not supported).
        Maximum result set size is 100. Offset is the zero-based number of endpoint
        from the start of the result set (start by counting from 0).
      script: Cortex XDR - IR|||xdr-get-endpoints
      type: regular
      iscommand: true
      brand: Cortex XDR - IR
    nexttasks:
      '#none#':
      - "121"
    scriptarguments:
      alias_name: {}
      dist_name: {}
      endpoint_id_list:
        complex:
          root: inputs.endpoint_id_list
      first_seen_gte: {}
      first_seen_lte: {}
      group_name: {}
      hostname:
        complex:
          root: Endpoint
          accessor: Hostname
      ip_list:
        complex:
          root: IP
          accessor: Address
      isolate: {}
      last_seen_gte: {}
      last_seen_lte: {}
      limit: {}
      page: {}
      platform: {}
      sort_by: {}
      sort_order: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -610,
          "y": 1350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
  "98":
    id: "98"
    taskid: 016c920d-12d4-4336-833b-2bb3988d904f
    type: regular
    task:
      id: 016c920d-12d4-4336-833b-2bb3988d904f
      version: -1
      name: Manual - Retrieve malicious file
      description: "Manual - Retrieve malicious file from the infected endpoint."
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "61"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 760,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "99":
    id: "99"
    taskid: 964259e7-58cd-415c-871b-94b561393d43
    type: title
    task:
      id: 964259e7-58cd-415c-871b-94b561393d43
      version: -1
      name: Enrich Internal Indicators found
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "100"
      - "135"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2430
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "100":
    id: "100"
    taskid: f7e27dce-2644-4b91-87a4-4057878c8f8b
    type: condition
    task:
      id: f7e27dce-2644-4b91-87a4-4057878c8f8b
      version: -1
      name: Are there users to enrich?
      description: Check if there are more IOCs to enrich?
      type: condition
      iscommand: false
      brand: Palo Alto Minemeld
    nexttasks:
      '#default#':
      - "20"
      "yes":
      - "110"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: PANWHunting
                filters:
                - - operator: isExists
                    left:
                      value:
                        simple: Domain.Name
                      iscontext: true
                accessor: DetectedUsers
            iscontext: true
    view: |-
      {
        "position": {
          "x": 910,
          "y": 2570
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "101":
    id: "101"
    taskid: 4a21c379-b289-4a4d-8ebc-50aa86eae223
    type: condition
    task:
      id: 4a21c379-b289-4a4d-8ebc-50aa86eae223
      version: -1
      name: Are there internal IP addresses to enrich?
      description: Check if there are more IOCs to enrich?
      type: condition
      iscommand: false
      brand: Palo Alto Minemeld
    nexttasks:
      '#default#':
      - "20"
      "yes":
      - "104"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: PANWHunting
                accessor: DetectedInternalIPs
            iscontext: true
    view: |-
      {
        "position": {
          "x": -140,
          "y": 2740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "104":
    id: "104"
    taskid: 4c57f357-2ac6-40d5-8d98-732d44cf6ecf
    type: regular
    task:
      id: 4c57f357-2ac6-40d5-8d98-732d44cf6ecf
      version: -1
      name: Cortex XDR - get endpoints
      description: Gets a list of endpoints, according to the passed filters. Filtering
        by multiple fields is concatenated using the AND condition (OR is not supported).
        Maximum result set size is 100. Offset is the zero-based number of endpoint
        from the start of the result set (start by counting from 0).
      script: Cortex XDR - IR|||xdr-get-endpoints
      type: regular
      iscommand: true
      brand: Cortex XDR - IR
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      alias_name: {}
      dist_name: {}
      endpoint_id_list:
        simple: 'endpoint_id '
      first_seen_gte: {}
      first_seen_lte: {}
      group_name: {}
      hostname: {}
      ip_list:
        simple: host_ip
      isolate: {}
      last_seen_gte: {}
      last_seen_lte: {}
      limit: {}
      page: {}
      platform: {}
      sort_by: {}
      sort_order: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -130,
          "y": 2910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "106":
    id: "106"
    taskid: fb54e316-d644-4345-83fa-cce81db90ece
    type: regular
    task:
      id: fb54e316-d644-4345-83fa-cce81db90ece
      version: -1
      name: Active Directory - get users
      description: Retrieves detailed information about a user account. The user can
        be specified by name, email address, or as an Active Directory Distinguished
        Name (DN). If no filter is specified, all users are returned.
      script: '|||ad-get-user'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      attributes: {}
      custom-field-data: {}
      custom-field-type: {}
      dn: {}
      email: {}
      limit: {}
      name: {}
      user-account-control-out: {}
      username:
        complex:
          root: PANWHunting
          accessor: DetectedUsers
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1310,
          "y": 2910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "110":
    id: "110"
    taskid: c10b7f49-2e74-40ab-8eb1-7c8c7e61deb5
    type: condition
    task:
      id: c10b7f49-2e74-40ab-8eb1-7c8c7e61deb5
      version: -1
      name: Is Active Directory integration enabled?
      description: "Check if the Active Directory integration is enabled."
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "20"
      "yes":
      - "106"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: a
            iscontext: true
          right:
            value:
              simple: a
    view: |-
      {
        "position": {
          "x": 1110,
          "y": 2740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "114":
    id: "114"
    taskid: 9107a1ba-597a-4e60-8ecd-3d7106f2273c
    type: title
    task:
      id: 9107a1ba-597a-4e60-8ecd-3d7106f2273c
      version: -1
      name: Get similar incidents
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "115"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 30
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "115":
    id: "115"
    taskid: 6a6aa229-361f-4149-87d3-29545422ef03
    type: regular
    task:
      id: 6a6aa229-361f-4149-87d3-29545422ef03
      version: -1
      name: Find similar incidents
      description: |-
        Finds similar incidents by common incident keys, labels, custom fields or context keys.
        It's highly recommended to use incident keys if possible (e.g., "type" for the same incident type).
        For best performance, it's recommended to avoid using context keys whenever possible (for example, if the value also appears in a label key, use label).
      scriptName: FindSimilarIncidents
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "120"
    scriptarguments:
      filterQuery: {}
      hoursBack: {}
      ignoreClosedIncidents: {}
      incidentFieldsAppliedCondition: {}
      maxNumberOfIncidents: {}
      maxResults: {}
      similarContextKeys: {}
      similarCustomFields: {}
      similarIncidentFields: {}
      similarIncidentKeys: {}
      similarLabelsKeys: {}
      skipMissingValues: {}
      timeField: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "116":
    id: "116"
    taskid: 0b422589-1147-4e86-8cbc-f5a219191674
    type: title
    task:
      id: 0b422589-1147-4e86-8cbc-f5a219191674
      version: -1
      name: Enrichment
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "126"
      - "5"
      - "6"
      - "128"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 880
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "118":
    id: "118"
    taskid: a33f2cc2-37bd-47e8-8892-3bc024a039c4
    type: condition
    task:
      id: a33f2cc2-37bd-47e8-8892-3bc024a039c4
      version: -1
      name: Link similar incidents?
      description: "Should the playbook link similar incidents?"
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "116"
      "yes":
      - "119"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.LinkSimilarIncidents
                transformers:
                - operator: toLowerCase
            iscontext: true
          right:
            value:
              simple: "yes"
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Demisto REST API
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                accessor: brand
            iscontext: true
    view: |-
      {
        "position": {
          "x": 270,
          "y": 540
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "119":
    id: "119"
    taskid: feffbf7c-28c5-45ce-80cc-7dd7f90c4876
    type: regular
    task:
      id: feffbf7c-28c5-45ce-80cc-7dd7f90c4876
      version: -1
      name: Link similar incidents
      description: Link two or more incidents
      scriptName: DemistoLinkIncidents
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "116"
    scriptarguments:
      masterID:
        complex:
          root: incident
          accessor: id
      otherIDs:
        complex:
          root: similarIncident
          accessor: rawId
      unlink: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 70,
          "y": 710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "120":
    id: "120"
    taskid: 06925b80-6977-4120-8302-766939e2aac8
    type: condition
    task:
      id: 06925b80-6977-4120-8302-766939e2aac8
      version: -1
      name: Similar incidents found?
      description: "Were similar incidents found?"
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "116"
      "yes":
      - "118"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: isSimilarIncidentFound
                transformers:
                - operator: toLowerCase
            iscontext: true
          right:
            value:
              simple: "true"
    view: |-
      {
        "position": {
          "x": 480,
          "y": 370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "121":
    id: "121"
    taskid: 102f65db-0a71-4bc3-86a4-7568c5b161f5
    type: playbook
    task:
      id: 102f65db-0a71-4bc3-86a4-7568c5b161f5
      version: -1
      name: Calculate Severity - Generic v2
      playbookName: Calculate Severity - Generic v2
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "48"
    separatecontext: true
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "122":
    id: "122"
    taskid: a84c0de9-d05b-43f9-8ae2-e322a832f94c
    type: condition
    task:
      id: a84c0de9-d05b-43f9-8ae2-e322a832f94c
      version: -1
      name: Are there hosts to enrich?
      description: Check if there are more IOCs to enrich?
      type: condition
      iscommand: false
      brand: Palo Alto Minemeld
    nexttasks:
      '#default#':
      - "20"
      "yes":
      - "123"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: PANWHunting
                accessor: DetectedInternalHosts
            iscontext: true
    view: |-
      {
        "position": {
          "x": 310,
          "y": 2740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "123":
    id: "123"
    taskid: a89d311c-f02e-4a8a-81c6-9fa318c4c393
    type: regular
    task:
      id: a89d311c-f02e-4a8a-81c6-9fa318c4c393
      version: -1
      name: Cortex XDR - get endpoints
      description: Gets a list of endpoints, according to the passed filters. Filtering
        by multiple fields is concatenated using AND condition (OR is not supported).
        Maximum result set size is 100. Offset is the zero-based number of endpoint
        from the start of the result set (start by counting from 0).
      script: Cortex XDR - IR|||xdr-get-endpoints
      type: regular
      iscommand: true
      brand: Cortex XDR - IR
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      alias_name: {}
      dist_name: {}
      endpoint_id_list:
        simple: 'endpoint_id '
      first_seen_gte: {}
      first_seen_lte: {}
      group_name: {}
      hostname: {}
      ip_list:
        simple: host_ip
      isolate: {}
      last_seen_gte: {}
      last_seen_lte: {}
      limit: {}
      page: {}
      platform: {}
      sort_by: {}
      sort_order: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 310,
          "y": 2910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "124":
    id: "124"
    taskid: e4d5cd46-9092-409d-8bac-b9e30a64fd30
    type: condition
    task:
      id: e4d5cd46-9092-409d-8bac-b9e30a64fd30
      version: -1
      name: Is Active Directory integration enabled?
      description: "Check if Active Directory integration is enabled."
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "121"
      "yes":
      - "125"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: a
            iscontext: true
          right:
            value:
              simple: a
    view: |-
      {
        "position": {
          "x": 1320,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "125":
    id: "125"
    taskid: fed6a1e4-ccd8-40c7-8449-066cea33d265
    type: regular
    task:
      id: fed6a1e4-ccd8-40c7-8449-066cea33d265
      version: -1
      name: Active Directory - get users
      description: Retrieves detailed information about a user account. The user can
        be specified by name, email address, or as an Active Directory Distinguished
        Name (DN). If no filter is specified, all users are returned.
      script: '|||ad-get-user'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "121"
    scriptarguments:
      attributes: {}
      custom-field-data: {}
      custom-field-type: {}
      dn: {}
      email: {}
      limit: {}
      name: {}
      user-account-control-out: {}
      username:
        complex:
          root: incident
          accessor: username
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1510,
          "y": 1350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "126":
    id: "126"
    taskid: cec707ab-b3b9-4c45-8025-0ebe2bb14c03
    type: title
    task:
      id: cec707ab-b3b9-4c45-8025-0ebe2bb14c03
      version: -1
      name: User
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "124"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1320,
          "y": 1020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "127":
    id: "127"
    taskid: 3be283bc-61af-49bc-8b1c-9cc2eaab60d9
    type: condition
    task:
      id: 3be283bc-61af-49bc-8b1c-9cc2eaab60d9
      version: -1
      name: Is Cortex XDR integration enabled?
      description: "Check if the Cortex XDR integration is enabled."
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "121"
      "yes":
      - "91"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: a
            iscontext: true
          right:
            value:
              simple: a
    view: |-
      {
        "position": {
          "x": -420,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "128":
    id: "128"
    taskid: 4cd717da-cf67-41f5-895e-54e219346ead
    type: title
    task:
      id: 4cd717da-cf67-41f5-895e-54e219346ead
      version: -1
      name: Endpoint
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "127"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -420,
          "y": 1020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "129":
    id: "129"
    taskid: 7eed365b-0b77-4fb9-889f-ceef990b28f4
    type: playbook
    task:
      id: 7eed365b-0b77-4fb9-889f-ceef990b28f4
      version: -1
      name: Palo Alto Networks - Malware Remediation
      description: This Playbook performs malicious IOC remediation using Palo Alto
        Networks integrations.
      playbookName: Palo Alto Networks - Malware Remediation
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "131"
    scriptarguments:
      AutoCommit:
        complex:
          root: inputs.AutoCommit
      CustomBlockRule:
        complex:
          root: inputs.CustomBlockRule
      CustomURLCategory:
        complex:
          root: inputs.CustomURLCategory
      DAG:
        complex:
          root: inputs.DAG
      DomainListName: {}
      EDLServerIP:
        complex:
          root: inputs.EDLServerIP
      EndpointId:
        complex:
          root: PANWHunting
          accessor: TrapsId
      EventId: {}
      IP:
        complex:
          root: IP
          filters:
          - - operator: isExists
              left:
                value:
                  simple: IP.Malicious
                iscontext: true
          accessor: Address
          transformers:
          - operator: uniq
      IPListName:
        complex:
          root: inputs.IPListName
      LogForwarding: {}
      Miner:
        complex:
          root: inputs.Miner
      SHA256:
        complex:
          root: File
          filters:
          - - operator: isExists
              left:
                value:
                  simple: File.Malicious
                iscontext: true
          accessor: SHA256
          transformers:
          - operator: uniq
      StaticAddressGroup:
        complex:
          root: inputs.StaticAddressGroup
      Traps:
        complex:
          root: inputs.Traps
      URL:
        complex:
          root: URL
          filters:
          - - operator: isExists
              left:
                value:
                  simple: URL.Malicious
                iscontext: true
          accessor: Data
          transformers:
          - operator: uniq
      URLListName:
        complex:
          root: inputs.URLListName
      UseXDR:
        complex:
          root: inputs.UseXDR
      xdr_endpoint_id:
        complex:
          root: PaloAltoNetworksXDR
          accessor: Endpoint.endpoint_id
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 210,
          "y": 3250
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "130":
    id: "130"
    taskid: 26c8b937-1133-4429-8b9d-44fa7e2bd7eb
    type: regular
    task:
      id: 26c8b937-1133-4429-8b9d-44fa7e2bd7eb
      version: -1
      name: Manual remediation
      description: "Perform manual remediation."
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "131"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 760,
          "y": 3250
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "131":
    id: "131"
    taskid: 5d751bfa-0e35-467d-8f90-9ca639edeec8
    type: regular
    task:
      id: 5d751bfa-0e35-467d-8f90-9ca639edeec8
      version: -1
      name: Manual review by the analyst
      description: "Manual review by the analyst."
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "132"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 3420
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "132":
    id: "132"
    taskid: 396d06f7-e8b1-4211-8ef7-20ddb5f770d3
    type: regular
    task:
      id: 396d06f7-e8b1-4211-8ef7-20ddb5f770d3
      version: -1
      name: Generate investigation summary report
      description: |-
        A script to generate the investigation summary report in an automated way.
        Can be used in post-processing flow as well.
      scriptName: GenerateInvestigationSummaryReport
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "133"
    scriptarguments:
      incidentId: {}
      name: {}
      type: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 3600
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "133":
    id: "133"
    taskid: 76434a3b-c040-4bc8-8b9a-f431ee46edaa
    type: regular
    task:
      id: 76434a3b-c040-4bc8-8b9a-f431ee46edaa
      version: -1
      name: Manual - close investigation in the source product
      description: "Manual - close investigation in the source product."
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "134"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 3790
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "134":
    id: "134"
    taskid: 5b05bf48-d9f3-47a7-8841-c94bd192a085
    type: regular
    task:
      id: 5b05bf48-d9f3-47a7-8841-c94bd192a085
      version: -1
      name: Close Investigation
      description: Closes the investigation.
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "45"
    scriptarguments:
      assetid: {}
      closeNotes: {}
      closeReason: {}
      code42alerttype: {}
      emailclassification: {}
      id: {}
      mndadone: {}
      phishingconfirmationstatus: {}
      phishingsubtype: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 3980
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "135":
    id: "135"
    taskid: 05877b03-49fc-481b-8764-c06c7f4e875a
    type: condition
    task:
      id: 05877b03-49fc-481b-8764-c06c7f4e875a
      version: -1
      name: Is Cortex XDR integration enabled?
      description: Check if the Cortex XDR integration is enabled.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "20"
      "yes":
      - "101"
      - "122"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: a
            iscontext: true
          right:
            value:
              simple: a
    view: |-
      {
        "position": {
          "x": 160,
          "y": 2570
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
view: |-
  {
    "linkLabelsPosition": {
      "100_20_#default#": 0.16,
      "101_20_#default#": 0.17,
      "110_20_#default#": 0.45,
      "118_116_#default#": 0.43,
      "118_119_yes": 0.51,
      "120_116_#default#": 0.58,
      "120_118_yes": 0.58,
      "122_123_yes": 0.39,
      "124_121_#default#": 0.12,
      "127_121_#default#": 0.11,
      "48_10_Close as False positive": 0.59,
      "77_121_#default#": 0.36,
      "77_34_yes": 0.57
    },
    "paper": {
      "dimensions": {
        "height": 4365,
        "width": 2500,
        "x": -610,
        "y": -120
      }
    }
  }
inputs:
- key: AutoIsolation
  value:
    simple: "3"
  required: false
  description: |-
    This input determines the threshold severity from which to perform auto-isolation for the infected endpoint.
    Default is High.
    Specify the severity number:
    0 - Unknown
    0.5 - Informational
    1 - Low
    2 - Medium
    3 - High
    4 - Critical
  playbookInputQuery:
- key: similarIncidentFields
  value: {}
  required: false
  description: This input accepts a comma-separated list of similar incident fields
    keys.
  playbookInputQuery:
- key: LinkSimilarIncidents
  value: {}
  required: false
  description: This input determines whether similar incidents that are found will
    be linked. Specify Yes/No.
  playbookInputQuery:
- key: SHA256
  value:
    complex:
      root: incident
      accessor: sha256
  required: false
  description: File SHA256.
  playbookInputQuery:
- key: endpoint_id_list
  value: {}
  required: false
  description: A list of XDR endpoint IDs.
  playbookInputQuery:
- key: UseXDR
  value:
    simple: "Yes"
  required: false
  description: This input determines whether Palo Alto Networks Cortex XDR remediation
    will take place. Specify Yes/No
  playbookInputQuery:
- key: DAG
  value: {}
  required: false
  description: |-
    This input determines whether Palo Alto Networks Panorama or Firewall Dynamic Address Groups are used.
    Specify Dynamic Address Group tag name for IP handling.
  playbookInputQuery:
- key: CustomURLCategory
  value: {}
  required: false
  description: |-
    This input determines whether Palo Alto Networks Panorama or Firewall Custom URL Categories are used.
    Specify Category name for URL handling.
  playbookInputQuery:
- key: CustomBlockRule
  value: {}
  required: false
  description: |-
    This input determines whether Palo Alto Networks Panorama or Firewall Custom block rules are used.
    Specify True to use Custom Block Rules.
  playbookInputQuery:
- key: IPListName
  value: {}
  required: false
  description: |-
    This input determines whether Palo Alto Networks Panorama or Firewall External Dynamic Lists are used for IP Blockage.
    Specify the EDL name for IP handling.
  playbookInputQuery:
- key: Miner
  value: {}
  required: false
  description: This input determines whether Palo Alto Networks Minemeld is used.
    Specify Miner name to update with the malicious indicators.
  playbookInputQuery:
- key: StaticAddressGroup
  value: {}
  required: false
  description: |-
    This input determines whether Palo Alto Networks Panorama or Firewall Static address groups are used.
    Specify Static address group name for IP handling.
  playbookInputQuery:
- key: AutoCommit
  value:
    simple: "No"
  required: false
  description: |-
    This input determines whether to commit the configuration automatically.
    Yes - Commit automatically.
    No - Commit manually.
  playbookInputQuery:
- key: URLListName
  value: {}
  required: false
  description: |-
    This input determines whether Palo Alto Networks Panorama or Firewall External Dynamic Lists are used for URL Blockage.
    Specify the EDL name for URL handling.
  playbookInputQuery:
- key: EDLServerIP
  value: {}
  required: false
  description: |-
    This input determines whether Palo Alto Networks Panorama or Firewall External Dynamic Lists are used:
    * The IP address of the web server on which the files are stored.
    * The web server IP address is configured in the integration instance.
  playbookInputQuery:
- key: Traps
  value:
    simple: "No"
  required: false
  description: This input determines whether Palo Alto Networks Traps remediation
    will take place. Specify Yes/No.
  playbookInputQuery:
- key: internal_range
  value: {}
  required: false
  description: 'A list of internal IP ranges to check IP addresses against. The list
    should be provided in CIDR notation, separated by commas. An example of a list
    of ranges would be: "172.16.0.0/12,10.0.0.0/8,192.168.0.0/16" (without quotes).
    If a list is not provided, will use default list provided in the IsIPInRanges
    script (the known IPv4 private address ranges).'
  playbookInputQuery:
outputs:
- contextPath: IP.Address
  description: IP addresses.
- contextPath: URL.Malicious.Description
  description: For malicious URLs, the reason that the vendor decided that the URL is malicious.
- contextPath: URL.Malicious
  description: Malicious URLs.
  type: unknown
- contextPath: File.Malicious.Description
  description: For malicious files, the reason that the vendor decided that the file is malicious.
tests:
- No test.
deprecated: true
