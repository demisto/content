category: Analytics & SIEM
commonfields:
  id: Azure Log Analytics
  version: -1
configuration:
- additionalinfo: Received from the authorization process or from the self-deployed configuration process (find the tenant ID in your app overview page in the Azure portal)
  display: Token / Tenant ID
  name: refresh_token
  hidden: true
  type: 4
  required: false
- displaypassword: Token / Tenant ID
  name: credentials_refresh_token
  hiddenusername: true
  type: 9
  required: false
- additionalinfo: Received from the authorization process or from the self-deployed configuration process.
  display: ID / Client ID
  name: credentials
  type: 9
  required: false
  displaypassword: Key / Client Secret
- additionalinfo: Used for certificate authentication. As appears in the "Certificates & secrets" page of the app.
  display: Certificate Thumbprint
  name: certificate_thumbprint
  hidden: true
  type: 4
  required: false
- displaypassword: Certificate Thumbprint
  name: credentials_certificate_thumbprint
  hiddenusername: true
  type: 9
  additionalinfo: Used for certificate authentication. As appears in the "Certificates & secrets" page of the app.
  required: false
- additionalinfo: Used for certificate authentication. The private key of the registered certificate.
  display: Private Key
  name: private_key
  type: 14
  required: false
- additionalinfo: Check when authenticating using the Authorization Code flow.
  display: Use a self-deployed Azure application - Authorization Code flow
  name: self_deployed
  type: 8
  required: false
- additionalinfo: Check when authenticating using the Client Credentials flow.
  display: Use a self-deployed Azure application - Client Credentials Flow
  name: client_credentials
  type: 8
  required: false
- display: Application redirect URI (for self-deployed mode)
  name: redirect_uri
  type: 0
  required: false
- additionalinfo: Get the Authorization code from steps 3-5 in the self deployed authorization process.
  display: Authorization code
  name: auth_code
  type: 4
  hidden: true
  required: false
- displaypassword: Authorization code
  name: credentials_auth_code
  hiddenusername: true
  type: 9
  additionalinfo: Get the Authorization code from steps 3-5 in the self deployed authorization process.
  required: false
- additionalinfo: Relevant only if the integration is running on Azure VM. If selected, authenticates based on the value provided for the Azure Managed Identities Client ID field. If no value is provided for the Azure Managed Identities Client ID field, authenticates based on the System Assigned Managed Identity. For additional information, see the Help tab.
  display: Use Azure Managed Identities
  name: use_managed_identities
  type: 8
  required: false
- additionalinfo: The Managed Identities client id for authentication - relevant only if the integration is running on Azure VM.
  displaypassword: Azure Managed Identities Client ID
  name: managed_identities_client_id
  hiddenusername: true
  type: 9
  required: false
- display: Subscription ID
  name: subscriptionID
  required: true
  type: 0
- display: Resource Group Name
  name: resourceGroupName
  required: true
  type: 0
- display: Workspace Name
  name: workspaceName
  required: true
  type: 0
- display: Workspace ID (the UUID of the workspace, e.g. 123e4567-e89b-12d3-a456-426614174000)
  name: workspaceID
  required: true
  type: 0
- display: Trust any certificate (not secure)
  name: insecure
  type: 8
  required: false
- display: Use system proxy settings
  name: proxy
  type: 8
  required: false
description: Log Analytics is a service that helps you collect and analyze data generated by resources in your cloud and on-premises environments.
display: Azure Log Analytics
name: Azure Log Analytics
script:
  commands:
  - arguments:
    - description: The query to execute.
      name: query
      required: true
    - description: The timespan over which to query data. This is an ISO8601 time period value. This timespan is applied in addition to any timespans specified in the query expression.
      name: timespan
    - defaultValue: '10'
      description: The amount of time (in seconds) that a request will wait for the query response before a timeout occurs.
      name: timeout
    description: Executes an Analytics query for data.
    name: azure-log-analytics-execute-query
    outputs:
    - contextPath: AzureLogAnalytics.Query.Query
      description: The executed query.
      type: String
    - contextPath: AzureLogAnalytics.Query.TableName
      description: The name of the query table.
      type: String
  - description: Tests connectivity to Azure Log Analytics.
    name: azure-log-analytics-test
  - arguments:
    - defaultValue: '50'
      description: The maximum number of saved searches to return. Default is 50.
      name: limit
    - defaultValue: '0'
      description: The page number from which to start a search.
      name: page
    description: Gets the saved searches of the Log Analytics workspace.
    name: azure-log-analytics-list-saved-searches
    outputs:
    - contextPath: AzureLogAnalytics.SavedSearch.id
      description: The ID of the saved search.
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.etag
      description: The ETag of the saved search.
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.category
      description: The category of the saved search. This helps users quickly find a saved search.
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.displayName
      description: Display name of the saved search.
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.functionAlias
      description: The function alias if the query serves as a function.
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.functionParameters
      description: 'The optional function parameters if the query serves as a function. Value should be in the following format: ''param-name1:type1 = default_value1, param-name2:type2 = default_value2''. For more examples and proper syntax please refer to https://docs.microsoft.com/en-us/azure/kusto/query/functions/user-defined-functions'
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.query
      description: The query expression for the saved search.
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.tags
      description: The tags attached to the saved search.
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.version
      description: The version number of the query language. The current version and default is 2.
      type: Number
    - contextPath: AzureLogAnalytics.SavedSearch.type
      description: The resource type, e.g., Microsoft.Compute/virtualMachines or Microsoft.Storage/storageAccounts.
      type: String
  - arguments:
    - description: The ID of the saved search.
      name: saved_search_id
      required: true
    description: Gets a specified saved search from the Log Analytics workspace.
    name: azure-log-analytics-get-saved-search-by-id
    outputs:
    - contextPath: AzureLogAnalytics.SavedSearch.id
      description: The ID of the saved search.
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.etag
      description: The ETag of the saved search.
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.category
      description: The category of the saved search. This helps users quickly find a saved search.
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.displayName
      description: The display name of the saved search.
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.functionAlias
      description: The function alias if the query serves as a function.
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.functionParameters
      description: 'The optional function parameters if the query serves as a function. Value should be in the following format: ''param-name1:type1 = default_value1, param-name2:type2 = default_value2''. For more examples and proper syntax see the Microsoft documentation, https://docs.microsoft.com/en-us/azure/kusto/query/functions/user-defined-functions.'
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.query
      description: The query expression for the saved search.
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.tags
      description: The tags attached to the saved search.
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.version
      description: The version number of the query language. The current version and default is 2.
      type: Number
    - contextPath: AzureLogAnalytics.SavedSearch.type
      description: The resource type, e.g., Microsoft.Compute/virtualMachines or Microsoft.Storage/storageAccounts.
      type: String
  - arguments:
    - description: The ID of the saved search.
      name: saved_search_id
      required: true
    - description: The ETag of the saved search. This argument is required for updating an existing saved search.
      name: etag
    - description: The category of the saved search. This helps users quickly find a saved search.
      name: category
      required: true
    - description: The display name of the saved search.
      name: display_name
      required: true
    - description: The function alias if the query serves as a function.
      name: function_alias
    - description: 'The optional function parameters if the query serves as a function. Value should be in the following format: ''param-name1:type1 = default_value1, param-name2:type2 = default_value2''. For more examples and proper syntax please refer to https://docs.microsoft.com/en-us/azure/kusto/query/functions/user-defined-functions.'
      name: function_parameters
    - description: The query expression for the saved search.
      name: query
      required: true
    - description: 'The tags attached to the saved search. Value should be in the following format: ''name=value;name=value''.'
      name: tags
    description: Creates or updates a saved search from the Log Analytics workspace.
    name: azure-log-analytics-create-or-update-saved-search
    outputs:
    - contextPath: AzureLogAnalytics.SavedSearch.id
      description: The ID of the saved search.
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.etag
      description: The ETag of the saved search.
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.category
      description: The category of the saved search. This helps users quickly find a saved search.
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.displayName
      description: The display name of the saved search.
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.functionAlias
      description: The function alias if the query serves as a function.
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.functionParameters
      description: 'The optional function parameters if the query serves as a function. Value should be in the following format: ''param-name1:type1 = default_value1, param-name2:type2 = default_value2''. For more examples and proper syntax please refer to https://docs.microsoft.com/en-us/azure/kusto/query/functions/user-defined-functions'
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.query
      description: The query expression for the saved search.
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.tags
      description: The tags attached to the saved search.
      type: String
    - contextPath: AzureLogAnalytics.SavedSearch.version
      description: The version number of the query language. The current version and default is 2.
      type: Number
    - contextPath: AzureLogAnalytics.SavedSearch.type
      description: The resource type, e.g., Microsoft.Compute/virtualMachines or Microsoft.Storage/storageAccounts.
      type: String
  - arguments:
    - description: The ID of the saved search.
      name: saved_search_id
      required: true
    description: Deletes a specified saved search in the Log Analytics workspace.
    name: azure-log-analytics-delete-saved-search
  - description: Generate the login url used for Authorization code flow.
    name: azure-log-analytics-generate-login-url
    arguments: []
  - description: Run this command if for some reason you need to rerun the authentication process.
    execution: false
    name: azure-log-analytics-auth-reset
    arguments: []
  - arguments:
    - description: the name of the table to add.
      name: table_name
      required: true
    - description: Maximum number of records in the result set, up to one million records.
      name: limit
      defaultValue: 50
    - description: Log query written in KQL to retrieve data. search job queries must always start with a table name. link to syntax documentation https://learn.microsoft.com/en-us/azure/data-explorer/kusto/query/whereoperator
      name: query
      required: true
    - description: Start of the time range to search. The value can either be 20 minutes, 2 weeks, or a simple ISO 8601 format such as "2023-10-31T00:00:00Z".
      name: start_search_time
      defaultValue: 1 day ago
    - description: End of the time range to search. The value can either be 20 minutes, 2 weeks, or a simple ISO 8601 format such as "2023-10-31T00:00:00Z".
      name: end_search_time
      defaultValue: now
    - description: The timeout in seconds until polling ends.
      name: timeout
      defaultValue: '600'
    - description: The interval in seconds between each poll.
      name: interval
      defaultValue: '60'
    - description: This argument is used to determine whether the current execution of the command is the initial run. After the command is executed, the argument is updated to 'false.' During polling, the code checks the status only for the first execution. This argument is for the dev, not for the user.
      name: first_run
      defaultValue: true
      hidden: true
    - description: Hide the polling message and only print the final status at the end. This argument is for the dev, not for the user.
      name: hide_polling_output
      hidden: true
    polling: true
    description: Run a search job to fetch records from large datasets into a new search results table in your workspace.
    name: azure-log-analytics-run-search-job
    outputs:
    - contextPath: AzureLogAnalytics.RunSearchJob.TableName
      description: Table name.
      type: String
  - arguments:
    - description: "The name of the table. Example value: AuditLogs_SRCH."
      name: table_name
    description: Gets a Log Analytics workspace table.
    name: azure-log-analytics-get-search-job
    outputs:
    - contextPath: AzureLogAnalytics.SearchJob.systemData.createdBy
      description: The identity that created the resource.
      type: String
    - contextPath: AzureLogAnalytics.SearchJob.systemData.createdAt
      description: The timestamp of resource creation (UTC).
      type: Date
    - contextPath: AzureLogAnalytics.SearchJob.properties.resultStatistics.progress
      description: Search job completion percentage.
      type: Number
    - contextPath: AzureLogAnalytics.SearchJob.properties.resultStatistics.ingestedRecords
      description: The number of rows that were returned by the search job.
      type: Number
    - contextPath: AzureLogAnalytics.SearchJob.properties.resultStatistics.scannedGb
      description: Amount of scanned data in the search job.
      type: Number
    - contextPath: AzureLogAnalytics.SearchJob.properties.searchResults.query
      description: Search job query.
      type: String
    - contextPath: AzureLogAnalytics.SearchJob.properties.searchResults.description
      description: Search job Description.
      type: String
    - contextPath: AzureLogAnalytics.SearchJob.properties.searchResults.limit
      description: Limit the search job to return up to specified number of rows.
      type: Number
    - contextPath: AzureLogAnalytics.SearchJob.properties.searchResults.startSearchTime
      description: The timestamp to start the search from (UTC).
      type: Date
    - contextPath: AzureLogAnalytics.SearchJob.properties.searchResults.endSearchTime
      description: The timestamp to end the search by (UTC).
      type: Date
    - contextPath: AzureLogAnalytics.SearchJob.properties.searchResults.sourceTable
      description: The table used in the search job.
      type: String
    - contextPath: AzureLogAnalytics.SearchJob.properties.schema.name
      description: Table name.
      type: String
    - contextPath: AzureLogAnalytics.SearchJob.properties.schema.tableSubType
      description: The subtype describes what APIs can be used to interact with the table, and what features are available against it. Any, Classic, DataCollectionRuleBased For more info see in the readme file.
      type: String
    - contextPath: AzureLogAnalytics.SearchJob.properties.schema.tableType
      description: Table's creator.
      type: String
    - contextPath: AzureLogAnalytics.SearchJob.properties.schema.displayName
      description: Table display name.
      type: String
    - contextPath: AzureLogAnalytics.SearchJob.properties.schema.description
      description: Table description.
      type: String
    - contextPath: AzureLogAnalytics.SearchJob.properties.schema.columns
      description: A list of table custom columns.
      type: List
    - contextPath: AzureLogAnalytics.SearchJob.properties.schema.standardColumns.isHidden
      description: Is column hidden.
      type: Boolean
    - contextPath: AzureLogAnalytics.SearchJob.properties.schema.standardColumns.name
      description: Column name.
      type: String
    - contextPath: AzureLogAnalytics.SearchJob.properties.schema.standardColumns.type
      description: Column data type (bool, datetime, dynamic, guid, int, long, real, string).
      type: String
    - contextPath: AzureLogAnalytics.SearchJob.properties.schema.standardColumns.dataTypeHint
      description: Column data type logical hint. (armPath, guid, ip, uri) for more info see in the readme file.
      type: String
    - contextPath: AzureLogAnalytics.SearchJob.properties.schema.standardColumns.displayName
      description: Column display name.
      type: String
    - contextPath: AzureLogAnalytics.SearchJob.properties.schema.standardColumns.description
      description: Column description.
      type: String
    - contextPath: AzureLogAnalytics.SearchJob.properties.schema.standardColumns.isDefaultDisplay
      description: Is displayed by default.
      type: Boolean
    - contextPath: AzureLogAnalytics.SearchJob.properties.schema.categories
      description: Table category.
      type: String
    - contextPath: AzureLogAnalytics.SearchJob.properties.schema.labels
      description: Table labels.
      type: String
    - contextPath: AzureLogAnalytics.SearchJob.properties.schema.source
      description: Table's creator. (customer, microsoft).
      type: String
    - contextPath: AzureLogAnalytics.SearchJob.properties.schema.solutions
      description: List of solutions the table is affiliated with.
      type: String
    - contextPath: AzureLogAnalytics.SearchJob.properties.provisioningState
      description: Table's current provisioning state. (Deleting, InProgress, Succeeded, Updating) If set to 'updating', indicates a resource lock due to ongoing operation, forbidding any update to the table until the ongoing operation is concluded.
      type: String
    - contextPath: AzureLogAnalytics.SearchJob.properties.retentionInDays
      description: The table retention in days, between 4 and 730. Setting this property to -1 will default to the workspace retention.
      type: Number
    - contextPath: AzureLogAnalytics.SearchJob.properties.totalRetentionInDays
      description: The table total retention in days, between 4 and 2556. Setting this property to -1 will default to table retention.
      type: Number
    - contextPath: AzureLogAnalytics.SearchJob.properties.archiveRetentionInDays
      description: The table data archive retention in days. Calculated as (totalRetentionInDays-retentionInDays).
      type: Number
    - contextPath: AzureLogAnalytics.SearchJob.properties.retentionInDaysAsDefault
      description: True - Value originates from workspace retention in days, False - Customer specific.
      type: Boolean
    - contextPath: AzureLogAnalytics.SearchJob.properties.totalRetentionInDaysAsDefault
      description: True - Value originates from retention in days, False - Customer specific.
      type: Boolean
    - contextPath: AzureLogAnalytics.SearchJob.properties.plan
      description: Instruct the system how to handle and charge the logs ingested to this table.
      type: String
    - contextPath: AzureLogAnalytics.SearchJob.id
      description: Fully qualified resource ID for the resource. Ex - /subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/{resourceProviderNamespace}/{resourceType}/{resourceName}.
      type: String
    - contextPath: AzureLogAnalytics.SearchJob.name
      description: The name of the resource.
      type: String
  - arguments:
    - description: "The name of the table. Example value: AuditLogs_SRCH."
      name: table_name
    description: Delete a Log Analytics workspace table. We recommend you delete the search job when you're done querying the table. This reduces workspace clutter and extra charges for data retention.
    name: azure-log-analytics-delete-search-job
  dockerimage: demisto/crypto:1.0.0.79946
  runonce: false
  script: '-'
  subtype: python3
  type: python
tests:
- No test
fromversion: 5.0.0
