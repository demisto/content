commonfields:
  id: Check Point
  version: -1
name: Check Point
display: Check Point Firewall
category: Network Security
image: data:image/png;base64,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
description: Manage Check Point firewall via API
configuration:
- display: Server URL (e.g. https://192.168.0.1)
  name: server
  defaultvalue: ""
  type: 0
  required: true
- display: Port
  name: port
  defaultvalue: "443"
  type: 0
  required: true
- display: Username
  name: credentials
  defaultvalue: ""
  type: 9
  required: true
- display: Trust any certificate (not secure)
  name: insecure
  defaultvalue: ""
  type: 8
  required: false
- display: Use system proxy settings
  name: proxy
  defaultvalue: ""
  type: 8
  required: false
script:
  script: |-
    //GLOBALS//
    var SERVER = params.server.replace(/[\/]+$/, '') + ':' + params.port + '/web_api/';
    var SESSION_ID;

    //DICTIONARIES//
    var entityDict = {
        CheckpointFWRule: {
            'name' :                'Name',
            'uid' :                 'UID',
            'type' :                'Type',
            'action' :              'Action',
            'action-settings' :     'ActionSetting',
            'custom-fields' :       'CustomFields',
            'data.name' :           'Data.Name',
            'data.uid' :            'Data.UID',
            'data.type' :           'Data.Type',
            'data.domain' :         'Data.Domain',
            'data-direction' :      'DataDirection',
            'data-negate' :         'DataNegate',
            'destination' :         'Destination',
            'destination-negate' :  'DestinationNegate',
            'domain.name' :         'Domain.Name',
            'domain.uid' :          'Domain.UID',
            'domain.domain-type':   'Domain.Type',
            'enabled' :             'Enabled',
            'hits.first-date' :     'Hits.FirstDate',
            'hits.last-date' :      'Hits.LastDate',
            'hits.level' :          'Hits.Level',
            'hits.percentage' :     'Hits.Percentage',
            'hits.value' :          'Hits.Value'
            },
        Endpoint: {
            'name' :            'Hostname',
            'uid' :             'UID',
            'type' :            'Type',
            'domain.name' :     'Domain.Name',
            'domain.uid' :      'Domain.UID',
            'domain.domain-type' : 'Domain.Type'
        },
        CheckpointFWTask: {
            'name' :                        'Name',
            'uid' :                         'UID',
            'type' :                        'Type',
            'domain.name' :                 'Domian.Name',
            'domain.uid' :                  'Domain.UID',
            'domain.domain-type':           'Domain.Type',
            'last-update-time.iso-8601' :   'LastUpdateTime',
            'meta-info.creation-time' :     'MetaInfo.CreationTime',
            'meta-info.creator' :           'MetaInfo.Creator',
            'meta-info.last-modifier' :     'MetaInfo.LastModifier',
            'meta-info.last-modify-time' :  'MetaInfo.LastModifyTime',
            'meta-info.lock' :              'MetaInfo.LockStatus',
            'meta-info.validation-state' :  'MetaInfo.ValidationStatus',
            'progress-percentage' :         'ProgressPercentage',
            'read-only' :                   'ReadOnly',
            'start-time' :                  'StartTime',
            'status' :                      'Status',
            'suppressed' :                  'Suppressed',
            'tags' :                        'Tags',
            'task-details' :                'Details',
            'task-id' :                     'ID',
            'task-name':                    'TaskName'
        }
    };


    //HELPERS//
    function extend(obj, src) {
        Object.keys(src).forEach(function(key) { obj[key] = src[key]; });
        return obj;
    }


    //returns single object withing entity (i.e. File[0])
    function jsonToEntityObject(origObj, newKeys) {
        //log("func started");
        var ret = {};
        var path;
        var newField;
        //var temp;
        for(var key in newKeys){
            if(newKeys[key]){
                path = newKeys[key].split('.');
                origPath = key.split('.');
                if(path.length == 1){
                    ret[newKeys[key]] = dq(origObj, '.'+key);
                }
                else{
                    newField = dq(origObj, '.'+key);
                    if(!ret[path[0]] && newField){
                        ret[path[0]] = {};
                    }
                    if(newField){
                        ret[path[0]][path[1]] = newField;
                    }
                }
            }
        }
        return ret;
    }


    //returns entire entity array (i.e. File)
    function jsonToEntity(origObj, newKeys) {
        var j;
        var ret;
        if(!Array.isArray(origObj)){
            ret = [jsonToEntityObject(origObj, newKeys)];
            return ret;
        }
        else if(origObj.length > 0){ //makes sure no empty arrays are pushed
            ret = [];
            for(j=0; j<origObj.length; j++){
                ret.push(jsonToEntityObject(origObj[j], newKeys));
            }
            return ret;
        }
    }


    function prettify_show_hosts(hosts){
        var pretty_hosts = [];
        for (i = 0; i < hosts.length; i++) {
            pretty_hosts[i] = {};
            if (hosts[i].uid) {
                pretty_hosts[i].UID = hosts[i].uid;
            }
            if (hosts[i].name) {
                pretty_hosts[i].Name = hosts[i].name;
            }
            if (hosts[i]['ipv4-address']) {
                pretty_hosts[i].IPV4 = hosts[i]['ipv4-address'];
            }
            if (hosts[i].domain) {
                pretty_hosts[i].Domain = 'Name: ' + hosts[i].domain.name + ', UID: ' + hosts[i].domain.uid + ', Type: ' + hosts[i].domain['domain-type'];
            }
        }
        return pretty_hosts;
    }


    function prettify_rule_data(rule_data) {
        var pretty_rule_data = {};
        if (rule_data.name) {
            pretty_rule_data.Name = rule_data.name;
        }
        if (rule_data.action && rule_data.action.name) {
            pretty_rule_data.Action = rule_data.action.name;
        }
        if (rule_data.enabled) {
            pretty_rule_data.Enabled = rule_data.enabled;
        }
        if (rule_data.layer) {
            pretty_rule_data.Layer = rule_data.layer;
        }
        if (rule_data['content-direction']) {
            pretty_rule_data['Content Direction'] = rule_data['content-direction'];
        }
        if (rule_data.content && rule_data.content.name) {
                pretty_rule_data.Content = rule_data.content.name;
        }
        if (rule_data['content-negate']) {
            pretty_rule_data['Content Negate'] = rule_data['content-negate'];
        }
        if (rule_data.destination && rule_data.destination.name) {
                pretty_rule_data.Destination = rule_data.destination.name;
        }
        if (rule_data['destination-negate']) {
            pretty_rule_data['Destination Negate'] = rule_data['destination-negate'];
        }
        if (rule_data.service && rule_data.service.name) {
                pretty_rule_data.Service = rule_data.service.name;
        }
        if (rule_data['service-negate']) {
            pretty_rule_data['Service Negate'] = rule_data['service-negate'];
        }
        if (rule_data.source && rule_data.source.name) {
                pretty_rule_data.Source = rule_data.source.name;
        }
        if (rule_data['source-negate']) {
            pretty_rule_data['Source Negate'] = rule_data['source-negate'];
        }
        return pretty_rule_data;
    }


    function prettify_rule_base(rule_base) {
        var pretty_rule_base = [];
        for (i = 0; i < rule_base.length; i++) {
            pretty_rule_base[i] = {};
            if (rule_base[i]['rule-number']) {
                pretty_rule_base[i]['Rule Number'] = rule_base[i]['rule-number'];
            }
            if (rule_base[i].name) {
                pretty_rule_base[i].Name = rule_base[i].name;
            }
            if (rule_base[i]['rule-number']) {
                pretty_rule_base[i].Name = rule_base[i]['rule-number'];
            }
            if (rule_base[i].uid) {
                pretty_rule_base[i].UID = rule_base[i].uid;
            }
            if (rule_base[i].action) {
                pretty_rule_base[i].Action = rule_base[i].action;
            }
            if (rule_base[i].enabled) {
                pretty_rule_base[i].Enabled = rule_base[i].enabled;
            }
            if (rule_base[i]['content-direction']) {
                pretty_rule_base[i].Content = rule_base[i]['content-direction'];
            }
        }
        return pretty_rule_base;
    }


    function sendRequest(cmdURL, body, cmdHeaders) {
        var headers = cmdHeaders? cmdHeaders : {'content-type': ['application/json'], 'X-chkp-sid' : [SESSION_ID]};
        var res = http(
            SERVER + cmdURL,
            {
                Method: 'POST',
                Headers: headers,
                Body: body
            },
            params.insecure,
            params.proxy
        );
        if (res.StatusCode < 200 || res.StatusCode >= 300) {
            throw 'Request Failed.\nStatus code: ' + res.StatusCode + '.\nBody: ' + JSON.stringify(res) + '.';
        }
        return res;
    }


    function login() {
        var res = sendRequest('login', JSON.stringify({'user':params.credentials.identifier,'password':params.credentials.password}), {'content-type': ['application/json']});
        try {
          SESSION_ID = JSON.parse(res.Body).sid;
          return SESSION_ID;
        } catch(err){
            throw 'Login failed. Answer from Checkpoint is: ' + JSON.stringify(res.Body);
        }
    }


    function logout() {
        if (SESSION_ID) {
            var res = sendRequest('logout', '{}');
            SESSION_ID = undefined;
            try {
                return JSON.parse(res.Body).message;
            } catch(err) {
                throw 'Logout failed. Answer from Checkpoint is: ' + JSON.stringify(res.Body);
            }
        }
        return 'Already logged out';
    }


    //COMMANDS//
    function add_host() {
        sendRequest('add-host', JSON.stringify({name:args.ip, 'ip-address':args.ip}));
        sendRequest('publish', '{}');
    }


    function block_ip() {
        var md = '';
        var temp = [];
        var result;
        var res;
        try{
            sendRequest('add-host', JSON.stringify({name:args.ip, 'ip-address':args.ip}));
        } catch(err){

        }
        sendRequest('publish', '{}');
        if(!args.direction){
            args.direction = 'both';
        }

        var requestBody = {
            position : '1',
            layer: 'Network',
            service: 'any',
            action: 'Drop'
        };

        if(args.direction === 'both' || args.direction === 'from'){
            requestBody.name = args.rulename + '-from-' + args.ip;
            requestBody.source = args.ip;
            requestBody.destination = 'ANY';
            result = sendRequest('add-access-rule', JSON.stringify(requestBody));
            sendRequest('publish', '{}');
            res = JSON.parse(result.Body);
            md += tableToMarkdown('Blocked Source IP Table', prettify_rule_data(res));
            temp.push(res);
        }

        if(args.direction === 'both' || args.direction === 'to'){
            requestBody.name = args.rulename + '-to-' + args.ip;
            requestBody.destination = args.ip;
            requestBody.source = 'ANY';
            result = sendRequest('add-access-rule', JSON.stringify(requestBody));
            sendRequest('publish', '{}');
            res = JSON.parse(result.Body);
            md += tableToMarkdown('Blocked Destination IP Table', prettify_rule_data(res));
            temp.push(res);
        }

        context = {CheckpointFWRule : jsonToEntity(temp,entityDict.CheckpointFWRule)};

        return {
            Type: entryTypes.note,
            Contents: result,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext: context
        };
    }


    function show_hosts() {
        var context = {};
        var res;
        var body = {limit: args.limit, offset: args.offset, order: args.order};
        var result = sendRequest('show-hosts', JSON.stringify(body));
        try{
            res = JSON.parse(result.Body);
        } catch(err){
            return result.Body;
        }
        context.Endpoint = jsonToEntity(res.objects, entityDict.Endpoint);
        var md = tableToMarkdown('Hosts table', prettify_show_hosts(res.objects), ['UID', 'Name', 'IPV4', 'Domain']);

        return {
            Type: entryTypes.note,
            Contents: result,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext: context
        };
    }


    function task_status() {
        var result = sendRequest('show-task', JSON.stringify({'task-id':args.task_id}));
        var res =  JSON.parse(result.Body);

        var md = tableToMarkdown('Task Status Table', res.tasks);
        var context = {CheckpointFWTask : jsonToEntity(res.tasks, entityDict.CheckpointFWTask)};

        return {
            Type: entryTypes.note,
            Contents: result,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext: context
        };
    }


    function set_rule() {
        var result;
        if(args.uid || args.name || args.rule_number){
            var body = {
                uid : args.uid,
                name: args.name,
                'rule-number': args.rule_number,
                layer: args.layer,
                enabled: args.enabled
            };
            result = sendRequest('set-access-rule', JSON.stringify(body));
            sendRequest('publish', '{}');
        }
        else{
            logout();
            throw 'Set rule requires at least one of the following arguments - uid, name, rule_number';
        }

        var res =  JSON.parse(result.Body);
        var md = tableToMarkdown('Set Rule', prettify_rule_data(res));
        var context = {CheckpointFWRule : jsonToEntity(res, entityDict.CheckpointFWRule)};

        return {
            Type: entryTypes.note,
            Contents: result,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext: context
        };
    }


    function delete_rule() {
        var res;
        if(args.uid || args.name || args.rule_number){
            var body = {
                uid : args.uid,
                name: args.name,
                'rule-number': args.rule_number,
                layer: args.layer
            };
            res = sendRequest('delete-access-rule', JSON.stringify(body));
            sendRequest('publish', '{}');
        }
        else{
            logout();
            throw 'Delete rule requires at least one of the following arguments - uid, name, rule_number';
        }
        return JSON.parse(res.Body);
    }


    function show_access_rule_base() {
        var result = sendRequest('show-access-rulebase', JSON.stringify({name:args.name}));
        var res = JSON.parse(result.Body);
        var md = tableToMarkdown('Access rulebase table', prettify_rule_base(res.rulebase), ['Rule Number', 'Name', 'UID', 'Action', 'Enabled', 'Content'])
        var context = {CheckpointFWRule : jsonToEntity(res.rulebase, entityDict.CheckpointFWRule)};
        return {
            Type: entryTypes.note,
            Contents: res,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext: context
        };
    }


    function checkpoint() {
        var res;
        var cmd = args.command;
        if(!cmd){
            throw 'Missing API command name';
        }
        delete args.command;
        res = sendRequest(cmd, JSON.stringify(args));
        sendRequest('publish', '{}');
        return JSON.parse(res.Body);
    }

    //EXECUTION//
    var answer;
    login();
    switch (command) {
        case 'test-module':
            show_hosts();
            logout();
            return 'ok';
        case 'checkpoint-block-ip':
            answer = block_ip();
            break;
        case 'checkpoint-show-hosts':
            answer = show_hosts();
            break;
        case 'checkpoint-task-status':
            answer = task_status();
            break;
        case 'checkpoint-show-access-rule-base':
            answer = show_access_rule_base();
            break;
        case 'checkpoint-set-rule':
            answer = set_rule();
            break;
        case 'checkpoint-delete-rule':
            answer = delete_rule();
            break;
        case 'checkpoint':
           answer = checkpoint();
            break;
    }
    logout();
    return answer;
  type: javascript
  commands:
  - name: checkpoint-show-access-rule-base
    arguments:
    - name: name
      required: true
      description: Object name. Should be unique in domain.
    - name: uid
      description: Object unique identifier.
    outputs:
    - contextPath: CheckpointFWRule.Name
      description: Object name. Should be unique in domain
      type: string
    - contextPath: CheckpointFWRule.UID
      description: Object unique identifier
      type: string
    - contextPath: CheckpointFWRule.Type
      description: Type of the object
      type: string
    - contextPath: CheckpointFWRule.Action
      description: Accept, Drop, Apply Layer, Ask, Info. How much details are returned
        depends on the details-level field of the request. This table shows the level
        of detail shown when details-level is set to standard
      type: string
    - contextPath: CheckpointFWRule.ActionSetting
      description: Action settings
      type: string
    - contextPath: CheckpointFWRule.CustomFields
      description: Custom fields
      type: string
    - contextPath: CheckpointFWRule.Data
      description: How much details are returned depends on the details-level field
        of the request. This table shows the level of detail shown when details-level
        is set to standard
      type: string
    - contextPath: CheckpointFWRule.Data.Name
      description: Object name. Should be unique in domain.
      type: string
    - contextPath: CheckpointFWRule.UID
      description: Object unique identifier
      type: string
    - contextPath: CheckpointFWRule.Type
      description: Type of the object
      type: string
    - contextPath: CheckpointFWRule.Data.Domain
      description: Information about the domain the object belongs to
      type: string
    - contextPath: CheckpointFWRule.DataDirection
      description: On which direction the file types processing is applied
      type: string
    - contextPath: CheckpointFWRule.DataNegate
      description: True if negate is set for data
      type: string
    - contextPath: CheckpointFWRule.Destination
      description: Collection of Network objects identified by the name or UID. How
        much details are returned depends on the details-level field of the request.
        This table shows the level of detail shown when details-level is set to standard
      type: string
    - contextPath: CheckpointFWRule.DestinationNegate
      description: True if negate is set for destination.
      type: string
    - contextPath: CheckpointFWRule.Domain
      description: Information about the domain the object belongs to.
      type: string
    - contextPath: CheckpointFWRule.Domain.Name
      description: Object name. Should be unique in domain.
      type: string
    - contextPath: CheckpointFWRule.Domain.UID
      description: Object unique identifier.
      type: string
    - contextPath: CheckpointFWRule.Domain.Type
      description: Domain type
      type: string
    - contextPath: CheckpointFWRule.Enabled
      description: Enable/Disable the rule
      type: string
    - contextPath: CheckpointFWRule.Hits
      description: Hits count object
      type: number
    - contextPath: CheckpointFWRule.Hits.FirstDate
      description: First of hits
      type: string
    - contextPath: CheckpointFWRule.Hits.LastDate
      description: Last date of hits
      type: string
    - contextPath: CheckpointFWRule.Hits.Level
      description: Level of hits
      type: string
    - contextPath: CheckpointFWRule.Hits.Percentage
      description: Percentage of hits
      type: string
    - contextPath: CheckpointFWRule.Hits.Value
      description: Value of hits
      type: string
    description: Show items in an access rulebase configured in Checkpoint FW
  - name: checkpoint-set-rule
    arguments:
    - name: uid
      description: Object unique identifier.
    - name: name
      description: Object name.
    - name: rule_number
      description: Rule number.
    - name: layer
      required: true
      description: Layer that the rule belongs to identified by the name or UID.
    - name: enabled
      description: true to enable the rule, false to disable it.
    outputs:
    - contextPath: CheckpointFWRule.Name
      description: Object name. Should be unique in domain
      type: string
    - contextPath: CheckpointFWRule.UID
      description: Object unique identifier
      type: string
    - contextPath: CheckpointFWRule.Type
      description: Type of the object
      type: string
    - contextPath: CheckpointFWRule.Action
      description: Accept, Drop, Apply Layer, Ask, Info. How much details are returned
        depends on the details-level field of the request. This table shows the level
        of detail shown when details-level is set to standard
      type: string
    - contextPath: CheckpointFWRule.ActionSetting
      description: Action settings
      type: string
    - contextPath: CheckpointFWRule.CustomFields
      description: Custom fields
      type: string
    - contextPath: CheckpointFWRule.Data
      description: How much details are returned depends on the details-level field
        of the request. This table shows the level of detail shown when details-level
        is set  to standard
      type: string
    - contextPath: CheckpointFWRule.Data.Name
      description: Object name. Should be unique in domain
      type: string
    - contextPath: CheckpointFWRule.UID
      description: Object unique identifier
      type: string
    - contextPath: CheckpointFWRule.Type
      description: Type of the object
      type: string
    - contextPath: CheckpointFWRule.Data.Domain
      description: Information about the domain the object belongs to
      type: string
    - contextPath: CheckpointFWRule.DataDirection
      description: On which direction the file types processing is applied
      type: string
    - contextPath: CheckpointFWRule.DataNegate
      description: True if negate is set for data
      type: string
    - contextPath: CheckpointFWRule.Destination
      description: Collection of Network objects identified by the name or UID. How
        much details are returned depends on the details-level field of the request.
        This table shows the level of detail shown when details-level is set to standard
      type: string
    - contextPath: CheckpointFWRule.DestinationNegate
      description: True if negate is set for destination
      type: string
    - contextPath: CheckpointFWRule.Domain
      description: Information about the domain the object belongs to
      type: string
    - contextPath: CheckpointFWRule.Domain.Name
      description: Object name. Should be unique in domain
      type: string
    - contextPath: CheckpointFWRule.Domain.UID
      description: Object unique identifier
      type: string
    - contextPath: CheckpointFWRule.Domain.Type
      description: Domain type
      type: string
    - contextPath: CheckpointFWRule.Enabled
      description: Enable/Disable the rule
      type: string
    - contextPath: CheckpointFWRule.Hits
      description: Hits count object
      type: number
    - contextPath: CheckpointFWRule.Hits.FirstDate
      description: First of hits
      type: string
    - contextPath: CheckpointFWRule.Hits.LastDate
      description: Last date of hits
      type: string
    - contextPath: CheckpointFWRule.Hits.Level
      description: Level of hits
      type: string
    - contextPath: CheckpointFWRule.Hits.Percentage
      description: Percentage of hits
      type: string
    - contextPath: CheckpointFWRule.Hits.Value
      description: Value of hits
      type: string
    description: Set attributes of an access rule object configured in Checkpoint
      FW
  - name: checkpoint-task-status
    arguments:
    - name: task_id
      required: true
      description: Unique identifier of one or more tasks.
    outputs:
    - contextPath: CheckpointFWTask.Name
      description: Object name. Should be unique in domain
      type: string
    - contextPath: CheckpointFWTask.UID
      description: Object unique identifier
      type: string
    - contextPath: CheckpointFWTask.Type
      description: Type of the object
      type: string
    - contextPath: CheckpointFWTask.Domain
      description: Information about the domain the object belongs to.
      type: string
    - contextPath: CheckpointFWTask.Domain.Name
      description: Object name. Should be unique in domain.
      type: string
    - contextPath: CheckpointFWTask.Domain.UID
      description: Object unique identifier
      type: string
    - contextPath: CheckpointFWTask.Domain.Type
      description: Domain type
      type: string
    - contextPath: CheckpointFWTask.LastUpdateTime
      description: Last update date and time represented in international ISO 8601
        format
      type: string
    - contextPath: CheckpointFWTask.MetaInfo.CreationTime
      description: Object creation time
      type: string
    - contextPath: CheckpointFWTask.MetaInfo.Creator
      description: Object creator
      type: string
    - contextPath: CheckpointFWTask.MetaInfo.LastModifier
      description: Last modifier of object
      type: string
    - contextPath: CheckpointFWTask.MetaInfo.LastModifyTime
      description: Object last modification time
      type: string
    - contextPath: CheckpointFWTask.MetaInfo.LockStatus
      description: Object lock state. It's not allowed to edit objects locked by other
        session.
      type: string
    - contextPath: CheckpointFWTask.MetaInfo.ValidationStatus
      description: Object validation state - ok, info, warning, error
      type: string
    - contextPath: CheckpointFWTask.ProgressPercentage
      description: Object progress percentage
      type: string
    - contextPath: CheckpointFWTask.ReadOnly
      description: Read only
      type: string
    - contextPath: CheckpointFWTask.StartTime
      description: Start time date and time represented in international ISO 8601
        format.
      type: string
    - contextPath: CheckpointFWTask.Status
      description: Task status
      type: string
    - contextPath: CheckpointFWTask.Suppressed
      description: Is suppressed
      type: string
    - contextPath: CheckpointFWTask.Tags
      description: Collection of tag objects identified by the name or UID. How much
        details are returned depends on the details-level field of the request. This
        table shows the level of detail shown when details-level is set to standard
      type: string
    - contextPath: CheckpointFWTask.Details
      description: Task details. How much details are returned depends on the details-level
        field of the request. This table shows the level of detail shown when details-level
        is set to standard
      type: string
    - contextPath: CheckpointFWTask.ID
      description: Asynchronous task unique identifier
      type: string
    - contextPath: CheckpointFWTask.TaskName
      description: Task name
      type: string
    description: Shows status of a checkpoint task by task uuid
  - name: checkpoint-show-hosts
    arguments:
    - name: limit
      description: No more than that many results will be returned.
    - name: offset
      description: Skip that many results before beginning to return them.
    - name: order
      auto: PREDEFINED
      predefined:
      - ASC
      - DESC
      description: Sorts results by the given field. The default is the random order.
    outputs:
    - contextPath: Endpoint.Hostname
      description: Object name. Should be unique in domain
      type: string
    - contextPath: Endpoint.UID
      description: Object unique identifier
      type: string
    - contextPath: Endpoint.Type
      description: Type of the object
      type: string
    - contextPath: Endpoint.Domain
      description: Information about the domain the object belongs to
      type: string
    - contextPath: Endpoint.Domain.Name
      description: Object name. Should be unique in domain
      type: string
    - contextPath: Endpoint.Domain.UID
      description: Object unique identifier
      type: string
    - contextPath: Endpoint.Domain.Type
      description: Type of the object
      type: string
    description: Show host objects configured in Checkpoint FW
  - name: checkpoint-block-ip
    arguments:
    - name: ip
      required: true
      description: IP addresse to be blocked
    - name: direction
      auto: PREDEFINED
      predefined:
      - to
      - from
      - both
      description: Whether to block traffic "to" or "from" the IPs, or "both". Default     is
        "both".
    - name: rulename
      required: true
      description: Base name for added rules inside checkpoint db
    - name: ipname
      required: true
      description: Base name for added ip/hosts inside checkpoint db
    outputs:
    - contextPath: CheckpointFWRule.Name
      description: Object name. Should be unique in domain
      type: string
    - contextPath: CheckpointFWRule.UID
      description: Object unique identifier
      type: string
    - contextPath: CheckpointFWRule.Type
      description: Type of the object
      type: string
    - contextPath: CheckpointFWRule.Action
      description: Accept, Drop, Apply Layer, Ask, Info. How much details are returned
        depends on the details-level field of the request. This table shows the level
        of detail shown when details-level is set to standard
      type: string
    - contextPath: CheckpointFWRule.ActionSetting
      description: Action settings
      type: string
    - contextPath: CheckpointFWRule.CustomFields
      description: Custom fields
      type: string
    - contextPath: CheckpointFWRule.Data
      description: How much details are returned depends on the details-level field
        of the request. This table shows the level of detail shown when details-level
        is set to standard
      type: string
    - contextPath: CheckpointFWRule.Data.Name
      description: Object name. Should be unique in domain
      type: string
    - contextPath: CheckpointFWRule.UID
      description: Object unique identifier
      type: string
    - contextPath: CheckpointFWRule.Type
      description: Type of the object
      type: string
    - contextPath: CheckpointFWRule.Data.Domain
      description: Information about the domain the object belongs to
      type: string
    - contextPath: CheckpointFWRule.DataDirection
      description: On which direction the file types processing is applied
      type: string
    - contextPath: CheckpointFWRule.DataNegate
      description: True if negate is set for data
      type: string
    - contextPath: CheckpointFWRule.Destination
      description: Collection of Network objects identified by the name or UID. How
        much details are returned depends on the details-level field of the request.
        This table shows the level of detail shown when details-level is set to standard
      type: string
    - contextPath: CheckpointFWRule.DestinationNegate
      description: True if negate is set for destination
      type: string
    - contextPath: CheckpointFWRule.Domain
      description: Information about the domain the object belongs to
      type: string
    - contextPath: CheckpointFWRule.Domain.Name
      description: Object name. Should be unique in domain
      type: string
    - contextPath: CheckpointFWRule.Domain.UID
      description: Object unique identifier
      type: string
    - contextPath: CheckpointFWRule.Domain.Type
      description: Domain type
      type: string
    - contextPath: CheckpointFWRule.Enabled
      description: Enable/Disable the rule
      type: string
    - contextPath: CheckpointFWRule.Hits
      description: Hits count object
      type: number
    - contextPath: CheckpointFWRule.Hits.FirstDate
      description: First of hits
      type: string
    - contextPath: CheckpointFWRule.Hits.LastDate
      description: Last date of hits
      type: string
    - contextPath: CheckpointFWRule.Hits.Level
      description: Level of hits
      type: string
    - contextPath: CheckpointFWRule.Hits.Percentage
      description: Percentage of hits
      type: string
    - contextPath: CheckpointFWRule.Hits.Value
      description: Value of hits
      type: string
    description: Block one or more IP addresses using Checkpoint Firewall
  - name: checkpoint
    arguments:
    - name: command
      required: true
      description: The command to execute.
    description: Use Check Point's Management API (requires management server R80
      or later). Specifying 'command'=<API command> is mandatory
  - name: checkpoint-delete-rule
    arguments:
    - name: uid
      description: uid of the rule
    - name: name
      description: name of the rule
    - name: layer
      required: true
      default: true
      description: e.g. Network
    description: Delete rule from firewall
  runonce: false
tests:
- blockip_test_playbook
- CheckpointFW-test