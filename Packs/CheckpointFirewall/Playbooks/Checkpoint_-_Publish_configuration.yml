id: Checkpoint - Publish configuration
version: -1
fromversion: 5.0.0
name: Checkpoint - Publish configuration
description: Publish the Checkpoint Firewall configuration.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 354c2814-999f-4177-8206-adb0b43e98e1
    type: start
    task:
      id: 354c2814-999f-4177-8206-adb0b43e98e1
      version: -1
      name: ""
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "2"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 120,
          "y": -560
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "2":
    id: "2"
    taskid: 0c3077f0-6bbd-4e6a-8083-a3be0476c404
    type: condition
    task:
      id: 0c3077f0-6bbd-4e6a-8083-a3be0476c404
      version: -1
      name: Is Checkpoint FW Enable ?
      description: Verify that there is a valid instance of Checkpoint Firewall enabled.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "9"
      "yes":
      - "4"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: CheckPoint_FW
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                accessor: brand
            iscontext: true
    view: |-
      {
        "position": {
          "x": 120,
          "y": -430
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "3":
    id: "3"
    taskid: 5aaffaa5-cc8b-4af1-88c5-3088044cd7b6
    type: title
    task:
      id: 5aaffaa5-cc8b-4af1-88c5-3088044cd7b6
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 120,
          "y": 1800
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "4":
    id: "4"
    taskid: e199ee33-0395-432f-8a4e-455c9f0aced9
    type: regular
    task:
      id: e199ee33-0395-432f-8a4e-455c9f0aced9
      version: -1
      name: checkpoint-publish
      description: Publish Changes to Checkpoint Firewall.
      script: '|||checkpoint-publish'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "24"
    scriptarguments:
      session_id:
        simple: ${inputs.sid}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -200,
          "y": -170
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "9":
    id: "9"
    taskid: 8cefbf82-7177-42af-8702-90580d9864af
    type: regular
    task:
      id: 8cefbf82-7177-42af-8702-90580d9864af
      version: -1
      name: checkpoint-logout
      description: Logout from a given session.
      script: CheckPoint_FW|||checkpoint-logout
      type: regular
      iscommand: true
      brand: CheckPoint_FW
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      session_id:
        simple: ${inputs.sid}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 120,
          "y": 1620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "13":
    id: "13"
    taskid: 1047dcfa-2dc4-440c-8de3-6cb8d780a97b
    type: playbook
    task:
      id: 1047dcfa-2dc4-440c-8de3-6cb8d780a97b
      version: -1
      name: GenericPolling
      description: |-
        Use this playbook as a sub-playbook to block execution of the master playbook until a remote action is complete.
        This playbook implements polling by continuously running the command in Step \#2 until the operation completes.
        The remote action should have the following structure:

        1. Initiate the operation.
        2. Poll to check if the operation completed.
        3. (optional) Get the results of the operation.
      playbookName: GenericPolling
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      AdditionalPollingCommandArgNames: {}
      AdditionalPollingCommandArgValues: {}
      Ids:
        simple: ${CheckPoint.publish.task-id}
      Interval:
        simple: "1"
      PollingCommandArgName:
        simple: task_id
      PollingCommandName:
        simple: checkpoint-show-task
      Timeout:
        simple: "10"
      dt:
        simple: CheckPoint.show-task(val.progress-percentage != '100').task-id
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
    view: |-
      {
        "position": {
          "x": -680,
          "y": 240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "14":
    id: "14"
    taskid: 33a0bb41-3653-4296-8ce5-1aa5487436ec
    type: regular
    task:
      id: 33a0bb41-3653-4296-8ce5-1aa5487436ec
      version: -1
      name: Get  Checkpoint publish status
      description: Get TaskID status for Publish.
      script: '|||checkpoint-show-task'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "15"
    scriptarguments:
      session_id:
        simple: ${inputs.sid}
      task_id:
        complex:
          root: CheckPoint
          accessor: publish
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -680,
          "y": 410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "15":
    id: "15"
    taskid: 0aa49d95-2609-4847-828a-a6b59a7677cc
    type: condition
    task:
      id: 0aa49d95-2609-4847-828a-a6b59a7677cc
      version: -1
      name: Was Checkpoint publish successful?
      description: Filter if Checkpoint publish successful.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "16"
      "yes":
      - "9"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: CheckPoint
                accessor: show-task.status
            iscontext: true
          right:
            value:
              simple: succeeded
    view: |-
      {
        "position": {
          "x": -680,
          "y": 590
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "16":
    id: "16"
    taskid: 0ae1577b-3967-4d80-8286-ea5fc8aa195d
    type: regular
    task:
      id: 0ae1577b-3967-4d80-8286-ea5fc8aa195d
      version: -1
      name: Print Publish Error
      description: Prints an error entry with a given message.
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "17"
    scriptarguments:
      message:
        simple: Checkpoint Publish Failed
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -400,
          "y": 770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "17":
    id: "17"
    taskid: dcfa9a18-2748-4e6d-81f7-5e946c0e325c
    type: regular
    task:
      id: dcfa9a18-2748-4e6d-81f7-5e946c0e325c
      version: -1
      name: Fix Error and publish manually
      description: User Manually add resolve.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "9"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -400,
          "y": 940
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "24":
    id: "24"
    taskid: 02b3925d-6ca8-494d-8369-4087983df5af
    type: condition
    task:
      id: 02b3925d-6ca8-494d-8369-4087983df5af
      version: -1
      name: Filter TaskID
      description: Filter TaskID to validate only new push configuration TaskID.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "9"
      "yes":
      - "13"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: CheckPoint
                accessor: publish.task-id
            iscontext: true
    view: |-
      {
        "position": {
          "x": -200,
          "y": 10
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 2425,
        "width": 1180,
        "x": -680,
        "y": -560
      }
    }
  }
inputs:
- key: sid
  value: {}
  required: true
  description: SID - Session unique identifier as it returned by the login request
    required for publish changes. done by this SID will be seen by all users only
    after publish is called and finish.
outputs: []
