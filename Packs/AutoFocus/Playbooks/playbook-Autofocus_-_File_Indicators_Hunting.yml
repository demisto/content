id: Autofocus - File Indicators Hunting
version: -1
contentitemexportablefields:
  contentitemfields: {}
name: Autofocus - File Indicators Hunting
description: "Queries the PANW Threat Intelligence Autofocus System. This playbook accepts SHA256, SHA1, and MD5 file indicators to run basic queries. \nNote that multiple search values should be separated by commas only (without spaces or any special characters).\n\nAdvanced search mode queries can also be used with multiple query parameters, but require all field names, parameters, and operators (JSON format) to be specified. \nIt is recommended to use the Autofocus UI to create an advanced query, export it and paste it into the relevant playbook inputs."
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: efd174b1-c3ae-48ce-8d14-52e397954612
    type: start
    task:
      id: efd174b1-c3ae-48ce-8d14-52e397954612
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "214"
      - "213"
      - "215"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1980,
          "y": 195
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: 316afab1-030b-4a22-850e-ff6a6c0b41da
    type: condition
    task:
      id: 316afab1-030b-4a22-850e-ff6a6c0b41da
      version: -1
      name: Any SHA256 file hash to hunt for?
      description: Checks whether there are any SHA256 file hashes available for searching.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "218"
      "yes":
      - "179"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: inputs.SHA256
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3000,
          "y": 480
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "153":
    id: "153"
    taskid: 3ab00780-9973-4e65-8271-1f0d598b5fbd
    type: title
    task:
      id: 3ab00780-9973-4e65-8271-1f0d598b5fbd
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1980,
          "y": 1270
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "179":
    id: "179"
    taskid: e078f3c6-99cf-4891-87d4-92236a5b24ba
    type: title
    task:
      id: e078f3c6-99cf-4891-87d4-92236a5b24ba
      version: -1
      name: Search SHA256
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "182"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3430,
          "y": 650
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "182":
    id: "182"
    taskid: 744cd122-bcd0-4a6c-8e84-f6a5769e6e4e
    type: playbook
    task:
      id: 744cd122-bcd0-4a6c-8e84-f6a5769e6e4e
      version: -1
      name: Autofocus Query Samples, Sessions and Tags
      description: |-
        This playbook is used for querying the PANW threat intelligence Autofocus system. The playbook accepts indicators such as IP's, hashes, domains to run basic queries or mode advanced queries that can leverage several query parameters. In order to run the more advanced queries its recommended to use the Autofocus UI https://autofocus.paloaltonetworks.com/#/dashboard/organization to created a query and than use the export search button. The result can be used as a playbook input.

        The playbook supports searching both the Samples API and the sessions API.
      playbookName: Autofocus Query Samples, Sessions and Tags
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "208"
      - "207"
    scriptarguments:
      Commodity:
        complex:
          root: inputs.Commodity
      Hash:
        complex:
          root: inputs.SHA256
          transformers:
          - operator: toUpperCase
          - operator: split
            args:
              delimiter:
                value:
                  simple: ','
          - operator: uniq
      Sample first seen:
        complex:
          root: inputs.Sample first seen
      Sample last modified:
        complex:
          root: inputs.Sample last modified
      SampleQuery:
        complex:
          root: inputs
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: inputs.SampleQuery
                iscontext: true
          accessor: SampleQuery
      Scope:
        complex:
          root: inputs.Scope
          filters:
          - - operator: containsGeneral
              left:
                value:
                  simple: inputs.Scope
                iscontext: true
              right:
                value:
                  simple: industry
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Scope
                iscontext: true
              right:
                value:
                  simple: organization
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Scope
                iscontext: true
              right:
                value:
                  simple: global
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Scope
                iscontext: true
              right:
                value:
                  simple: all
              ignorecase: true
      Search Type:
        complex:
          root: inputs.Search Type
          filters:
          - - operator: containsGeneral
              left:
                value:
                  simple: inputs.Search Type
                iscontext: true
              right:
                value:
                  simple: session
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Search Type
                iscontext: true
              right:
                value:
                  simple: sample
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Search Type
                iscontext: true
              right:
                value:
                  simple: tag
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Search Type
                iscontext: true
              right:
                value:
                  simple: all
              ignorecase: true
      SessionQuery:
        complex:
          root: inputs.SessionQuery
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: inputs.SessionQuery
                iscontext: true
      Sessions time after:
        complex:
          root: inputs.Sessions time after
      Sessions time before:
        complex:
          root: inputs.Sessions time before
      Tags class:
        complex:
          root: inputs.Tags class
          filters:
          - - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags class
                iscontext: true
              right:
                value:
                  simple: Actor
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags class
                iscontext: true
              right:
                value:
                  simple: Campaign
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags class
                iscontext: true
              right:
                value:
                  simple: Exploit
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags class
                iscontext: true
              right:
                value:
                  simple: Malicious Behavior
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags class
                iscontext: true
              right:
                value:
                  simple: Malware Family
              ignorecase: true
      Tags private:
        complex:
          root: inputs.Tags private
      Tags public:
        complex:
          root: inputs.Tags public
      Tags scope:
        complex:
          root: inputs.Tags scope
          filters:
          - - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags scope
                iscontext: true
              right:
                value:
                  simple: industry
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags scope
                iscontext: true
              right:
                value:
                  simple: organization
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags scope
                iscontext: true
              right:
                value:
                  simple: global
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags scope
                iscontext: true
              right:
                value:
                  simple: all
              ignorecase: true
      Unit 42:
        complex:
          root: inputs.Unit 42
      Wildfire Verdict:
        complex:
          root: inputs.wildfire_verdict
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: inputs.wildfire_verdict
                iscontext: true
          - - operator: containsGeneral
              left:
                value:
                  simple: inputs.wildfire_verdict
                iscontext: true
              right:
                value:
                  simple: Malware
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.wildfire_verdict
                iscontext: true
              right:
                value:
                  simple: Grayware
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.wildfire_verdict
                iscontext: true
              right:
                value:
                  simple: Benign
              ignorecase: true
            - operator: isEqualString
              left:
                value:
                  simple: inputs.wildfire_verdict
                iscontext: true
              right:
                value:
                  simple: Phishing
              ignorecase: true
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 3430,
          "y": 785
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "207":
    id: "207"
    taskid: fc4162e8-f305-4174-8343-d1612f5fbb5e
    type: regular
    task:
      id: fc4162e8-f305-4174-8343-d1612f5fbb5e
      version: -1
      name: Save Matching Results - Samples Results
      description: |-
        Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs.paloaltonetworks.com/cortex/cortex-xsoar/6-2/cortex-xsoar-admin/playbooks/automations.html
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "218"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Autofocus.Samples.HuntingResults
      value:
        complex:
          root: AutoFocus.SamplesResults
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: AutoFocus.SamplesResults.SHA256
                iscontext: true
            - operator: isNotEmpty
              left:
                value:
                  simple: AutoFocus.SamplesResults.SHA1
                iscontext: true
            - operator: isNotEmpty
              left:
                value:
                  simple: AutoFocus.SamplesResults.MD5
                iscontext: true
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3220,
          "y": 955
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "208":
    id: "208"
    taskid: 2a021ab5-5a56-459e-84b8-b52a81d510ed
    type: regular
    task:
      id: 2a021ab5-5a56-459e-84b8-b52a81d510ed
      version: -1
      name: Save Matching Results - Sessions Search
      description: |-
        Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs.paloaltonetworks.com/cortex/cortex-xsoar/6-2/cortex-xsoar-admin/playbooks/automations.html
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "218"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Autofocus.Sessions.HuntingResults
      value:
        complex:
          root: AutoFocus.SessionsResults
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: AutoFocus.SessionsResults.SHA256
                iscontext: true
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3620,
          "y": 955
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "213":
    id: "213"
    taskid: 9a6c1558-517c-491f-851b-58795123103e
    type: title
    task:
      id: 9a6c1558-517c-491f-851b-58795123103e
      version: -1
      name: SHA1 Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "216"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1500,
          "y": 345
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "214":
    id: "214"
    taskid: 18ca4049-9982-4ece-8004-38da3f5751fb
    type: title
    task:
      id: 18ca4049-9982-4ece-8004-38da3f5751fb
      version: -1
      name: SHA256 Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "10"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3000,
          "y": 345
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "215":
    id: "215"
    taskid: 6d335698-7916-4cde-8114-c40aafc08cd2
    type: title
    task:
      id: 6d335698-7916-4cde-8114-c40aafc08cd2
      version: -1
      name: MD5 Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "217"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1980,
          "y": 350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "216":
    id: "216"
    taskid: bb9e8300-c722-4628-8396-4b62afd96e21
    type: condition
    task:
      id: bb9e8300-c722-4628-8396-4b62afd96e21
      version: -1
      name: Any SHA1 file hash to hunt for?
      description: Checks whether there are any SHA1 file hashes available for searching.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "219"
      "yes":
      - "221"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: inputs.SHA1
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1500,
          "y": 480
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "217":
    id: "217"
    taskid: 6bcf47ff-de74-4cb2-8dc8-cae23f7eae2a
    type: condition
    task:
      id: 6bcf47ff-de74-4cb2-8dc8-cae23f7eae2a
      version: -1
      name: Any MD5 file hash to hunt for?
      description: Checks whether there are any MD5 file hashes available for searching.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "220"
      "yes":
      - "222"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: inputs.MD5
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1980,
          "y": 480
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "218":
    id: "218"
    taskid: 9b0c3642-f5ab-4509-8ea9-4f83dc2f0eb9
    type: title
    task:
      id: 9b0c3642-f5ab-4509-8ea9-4f83dc2f0eb9
      version: -1
      name: SHA256 Hunting Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "153"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3000,
          "y": 1125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "219":
    id: "219"
    taskid: d7a74eff-635c-4b92-8b1c-dfb0a45a3b00
    type: title
    task:
      id: d7a74eff-635c-4b92-8b1c-dfb0a45a3b00
      version: -1
      name: SHA1 Hunting Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "153"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1500,
          "y": 1125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "220":
    id: "220"
    taskid: d51def75-ab50-4a5f-8591-4ef87aa85b71
    type: title
    task:
      id: d51def75-ab50-4a5f-8591-4ef87aa85b71
      version: -1
      name: MD5 Hunting Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "153"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1980,
          "y": 1125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "221":
    id: "221"
    taskid: 281b1f2f-8fef-4b3a-8e4b-d606e37cb746
    type: title
    task:
      id: 281b1f2f-8fef-4b3a-8e4b-d606e37cb746
      version: -1
      name: Search SHA1
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "227"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1050,
          "y": 650
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "222":
    id: "222"
    taskid: 0aae73b1-358d-4c85-8d7e-5b7f678c6662
    type: title
    task:
      id: 0aae73b1-358d-4c85-8d7e-5b7f678c6662
      version: -1
      name: Search MD5
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "223"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2410,
          "y": 650
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "223":
    id: "223"
    taskid: efbfd3c6-b13c-4979-8a17-0ff3ccd31f83
    type: playbook
    task:
      id: efbfd3c6-b13c-4979-8a17-0ff3ccd31f83
      version: -1
      name: Autofocus Query Samples, Sessions and Tags
      description: |-
        This playbook is used for querying the PANW threat intelligence Autofocus system. The playbook accepts indicators such as IP's, hashes, domains to run basic queries or mode advanced queries that can leverage several query parameters. In order to run the more advanced queries its recommended to use the Autofocus UI https://autofocus.paloaltonetworks.com/#/dashboard/organization to created a query and than use the export search button. The result can be used as a playbook input.

        The playbook supports searching both the Samples API and the sessions API.
      playbookName: Autofocus Query Samples, Sessions and Tags
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "225"
      - "224"
    scriptarguments:
      Commodity:
        complex:
          root: inputs.Commodity
      Hash:
        complex:
          root: inputs.MD5
          transformers:
          - operator: toUpperCase
          - operator: split
            args:
              delimiter:
                value:
                  simple: ','
          - operator: uniq
      Sample first seen:
        complex:
          root: inputs.Sample first seen
      Sample last modified:
        complex:
          root: inputs.Sample last modified
      SampleQuery:
        complex:
          root: inputs
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: inputs.SampleQuery
                iscontext: true
          accessor: SampleQuery
      Scope:
        complex:
          root: inputs.Scope
          filters:
          - - operator: containsGeneral
              left:
                value:
                  simple: inputs.Scope
                iscontext: true
              right:
                value:
                  simple: industry
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Scope
                iscontext: true
              right:
                value:
                  simple: organization
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Scope
                iscontext: true
              right:
                value:
                  simple: global
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Scope
                iscontext: true
              right:
                value:
                  simple: all
              ignorecase: true
      Search Type:
        complex:
          root: inputs.Search Type
          filters:
          - - operator: containsGeneral
              left:
                value:
                  simple: inputs.Search Type
                iscontext: true
              right:
                value:
                  simple: session
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Search Type
                iscontext: true
              right:
                value:
                  simple: sample
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Search Type
                iscontext: true
              right:
                value:
                  simple: tag
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Search Type
                iscontext: true
              right:
                value:
                  simple: all
              ignorecase: true
      SessionQuery:
        complex:
          root: inputs.SessionQuery
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: inputs.SessionQuery
                iscontext: true
      Sessions time after:
        complex:
          root: inputs.Sessions time after
      Sessions time before:
        complex:
          root: inputs.Sessions time before
      Tags class:
        complex:
          root: inputs.Tags class
          filters:
          - - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags class
                iscontext: true
              right:
                value:
                  simple: Actor
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags class
                iscontext: true
              right:
                value:
                  simple: Campaign
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags class
                iscontext: true
              right:
                value:
                  simple: Exploit
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags class
                iscontext: true
              right:
                value:
                  simple: Malicious Behavior
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags class
                iscontext: true
              right:
                value:
                  simple: Malware Family
              ignorecase: true
      Tags private:
        complex:
          root: inputs.Tags private
      Tags public:
        complex:
          root: inputs.Tags public
      Tags scope:
        complex:
          root: inputs.Tags scope
          filters:
          - - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags scope
                iscontext: true
              right:
                value:
                  simple: industry
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags scope
                iscontext: true
              right:
                value:
                  simple: organization
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags scope
                iscontext: true
              right:
                value:
                  simple: global
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags scope
                iscontext: true
              right:
                value:
                  simple: all
              ignorecase: true
      Unit 42:
        complex:
          root: inputs.Unit 42
      Wildfire Verdict:
        complex:
          root: inputs.wildfire_verdict
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: inputs.wildfire_verdict
                iscontext: true
          - - operator: containsGeneral
              left:
                value:
                  simple: inputs.wildfire_verdict
                iscontext: true
              right:
                value:
                  simple: Malware
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.wildfire_verdict
                iscontext: true
              right:
                value:
                  simple: Grayware
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.wildfire_verdict
                iscontext: true
              right:
                value:
                  simple: Benign
              ignorecase: true
            - operator: isEqualString
              left:
                value:
                  simple: inputs.wildfire_verdict
                iscontext: true
              right:
                value:
                  simple: Phishing
              ignorecase: true
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 2410,
          "y": 785
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "224":
    id: "224"
    taskid: fb882370-3183-4fe2-8046-63e021303151
    type: regular
    task:
      id: fb882370-3183-4fe2-8046-63e021303151
      version: -1
      name: Save Matching Results - Samples Results
      description: |-
        Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs.paloaltonetworks.com/cortex/cortex-xsoar/6-2/cortex-xsoar-admin/playbooks/automations.html
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "220"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Autofocus.Samples.HuntingResults
      value:
        complex:
          root: AutoFocus.SamplesResults
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: AutoFocus.SamplesResults.MD5
                iscontext: true
            - operator: isNotEmpty
              left:
                value:
                  simple: AutoFocus.SamplesResults.SHA1
                iscontext: true
            - operator: isNotEmpty
              left:
                value:
                  simple: AutoFocus.SamplesResults.SHA256
                iscontext: true
          - - operator: notInList
              left:
                value:
                  simple: AutoFocus.SamplesResults.SHA256
                iscontext: true
              right:
                value:
                  simple: inputs.SHA256
                iscontext: true
              ignorecase: true
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2200,
          "y": 955
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "225":
    id: "225"
    taskid: c4a436e6-91f1-4d0e-88b9-730a9d11f5f4
    type: regular
    task:
      id: c4a436e6-91f1-4d0e-88b9-730a9d11f5f4
      version: -1
      name: Save Matching Results - Sessions Search
      description: |-
        Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs.paloaltonetworks.com/cortex/cortex-xsoar/6-2/cortex-xsoar-admin/playbooks/automations.html
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "220"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Autofocus.Sessions.HuntingResults
      value:
        complex:
          root: AutoFocus.SessionsResults
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: AutoFocus.SessionsResults.SHA256
                iscontext: true
          - - operator: notInList
              left:
                value:
                  simple: AutoFocus.SessionsResults.SHA256
                iscontext: true
              right:
                value:
                  simple: inputs.SHA256
                iscontext: true
              ignorecase: true
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2630,
          "y": 955
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "227":
    id: "227"
    taskid: 07a6028a-1dcf-4ae3-82a1-0736d3f7d8fe
    type: playbook
    task:
      id: 07a6028a-1dcf-4ae3-82a1-0736d3f7d8fe
      version: -1
      name: Autofocus Query Samples, Sessions and Tags
      description: |-
        This playbook is used for querying the PANW threat intelligence Autofocus system. The playbook accepts indicators such as IP's, hashes, domains to run basic queries or mode advanced queries that can leverage several query parameters. In order to run the more advanced queries its recommended to use the Autofocus UI https://autofocus.paloaltonetworks.com/#/dashboard/organization to created a query and than use the export search button. The result can be used as a playbook input.

        The playbook supports searching both the Samples API and the sessions API.
      playbookName: Autofocus Query Samples, Sessions and Tags
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "233"
      - "234"
    scriptarguments:
      Commodity:
        complex:
          root: inputs.Commodity
      Hash:
        complex:
          root: inputs.MD5
          transformers:
          - operator: toUpperCase
          - operator: split
            args:
              delimiter:
                value:
                  simple: ','
          - operator: uniq
      Sample first seen:
        complex:
          root: inputs.Sample first seen
      Sample last modified:
        complex:
          root: inputs.Sample last modified
      SampleQuery:
        complex:
          root: inputs
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: inputs.SampleQuery
                iscontext: true
          accessor: SampleQuery
      Scope:
        complex:
          root: inputs.Scope
          filters:
          - - operator: containsGeneral
              left:
                value:
                  simple: inputs.Scope
                iscontext: true
              right:
                value:
                  simple: industry
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Scope
                iscontext: true
              right:
                value:
                  simple: organization
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Scope
                iscontext: true
              right:
                value:
                  simple: global
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Scope
                iscontext: true
              right:
                value:
                  simple: all
              ignorecase: true
      Search Type:
        complex:
          root: inputs.Search Type
          filters:
          - - operator: containsGeneral
              left:
                value:
                  simple: inputs.Search Type
                iscontext: true
              right:
                value:
                  simple: session
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Search Type
                iscontext: true
              right:
                value:
                  simple: sample
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Search Type
                iscontext: true
              right:
                value:
                  simple: tag
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Search Type
                iscontext: true
              right:
                value:
                  simple: all
              ignorecase: true
      SessionQuery:
        complex:
          root: inputs.SessionQuery
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: inputs.SessionQuery
                iscontext: true
      Sessions time after:
        complex:
          root: inputs.Sessions time after
      Sessions time before:
        complex:
          root: inputs.Sessions time before
      Tags class:
        complex:
          root: inputs.Tags class
          filters:
          - - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags class
                iscontext: true
              right:
                value:
                  simple: Actor
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags class
                iscontext: true
              right:
                value:
                  simple: Campaign
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags class
                iscontext: true
              right:
                value:
                  simple: Exploit
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags class
                iscontext: true
              right:
                value:
                  simple: Malicious Behavior
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags class
                iscontext: true
              right:
                value:
                  simple: Malware Family
              ignorecase: true
      Tags private:
        complex:
          root: inputs.Tags private
      Tags public:
        complex:
          root: inputs.Tags public
      Tags scope:
        complex:
          root: inputs.Tags scope
          filters:
          - - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags scope
                iscontext: true
              right:
                value:
                  simple: industry
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags scope
                iscontext: true
              right:
                value:
                  simple: organization
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags scope
                iscontext: true
              right:
                value:
                  simple: global
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.Tags scope
                iscontext: true
              right:
                value:
                  simple: all
              ignorecase: true
      Unit 42:
        complex:
          root: inputs.Unit 42
      Wildfire Verdict:
        complex:
          root: inputs.wildfire_verdict
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: inputs.wildfire_verdict
                iscontext: true
          - - operator: containsGeneral
              left:
                value:
                  simple: inputs.wildfire_verdict
                iscontext: true
              right:
                value:
                  simple: Malware
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.wildfire_verdict
                iscontext: true
              right:
                value:
                  simple: Grayware
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: inputs.wildfire_verdict
                iscontext: true
              right:
                value:
                  simple: Benign
              ignorecase: true
            - operator: isEqualString
              left:
                value:
                  simple: inputs.wildfire_verdict
                iscontext: true
              right:
                value:
                  simple: Phishing
              ignorecase: true
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1050,
          "y": 785
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "233":
    id: "233"
    taskid: ada25639-fff8-4779-84e2-f5cd2ecc0bd7
    type: regular
    task:
      id: ada25639-fff8-4779-84e2-f5cd2ecc0bd7
      version: -1
      name: Save Matching Results - Sessions Search
      description: |-
        Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs.paloaltonetworks.com/cortex/cortex-xsoar/6-2/cortex-xsoar-admin/playbooks/automations.html
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "219"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Autofocus.Sessions.HuntingResults
      value:
        complex:
          root: AutoFocus.SessionsResults
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: AutoFocus.SessionsResults.SHA256
                iscontext: true
          - - operator: notInList
              left:
                value:
                  simple: AutoFocus.SessionsResults.SHA256
                iscontext: true
              right:
                value:
                  simple: inputs.SHA256
                iscontext: true
              ignorecase: true
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1270,
          "y": 955
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "234":
    id: "234"
    taskid: 399883e1-3bd8-492c-82dd-0c2548f1500a
    type: regular
    task:
      id: 399883e1-3bd8-492c-82dd-0c2548f1500a
      version: -1
      name: Save Matching Results - Samples Results
      description: |-
        Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs.paloaltonetworks.com/cortex/cortex-xsoar/6-2/cortex-xsoar-admin/playbooks/automations.html
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "219"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Autofocus.Samples.HuntingResults
      value:
        complex:
          root: AutoFocus.SamplesResults
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: AutoFocus.SamplesResults.MD5
                iscontext: true
            - operator: isNotEmpty
              left:
                value:
                  simple: AutoFocus.SamplesResults.SHA1
                iscontext: true
            - operator: isNotEmpty
              left:
                value:
                  simple: AutoFocus.SamplesResults.SHA256
                iscontext: true
          - - operator: notInList
              left:
                value:
                  simple: AutoFocus.SamplesResults.SHA256
                iscontext: true
              right:
                value:
                  simple: inputs.SHA256
                iscontext: true
              ignorecase: true
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 840,
          "y": 955
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 1140,
        "width": 3160,
        "x": 840,
        "y": 195
      }
    }
  }
inputs:
- key: MD5
  value: {}
  required: false
  description: |-
    A single or multiple MD5 file hashes to search for within Autofocus simple mode search.

    Separate multiple search values by commas only (without spaces or any special characters).
  playbookInputQuery:
- key: SHA256
  value: {}
  required: false
  description: |-
    A single or multiple SHA256 file hashes to search for within Autofocus simple mode search.

    Separate multiple search values by commas only (without spaces or any special characters).
  playbookInputQuery:
- key: SHA1
  value: {}
  required: false
  description: |-
    A single or multiple SHA1 file hashes to search for within Autofocus simple mode search.

    Separate multiple search values by commas only (without spaces or any special characters).
  playbookInputQuery:
- key: Search Type
  value: {}
  required: true
  description: "Determine which Autofocus search types should be executed. An overview of autofocus search types is provided below.\n\nVarious values can be specified, including session, sample, tag, or all. Session and sample are the recommended search types for this playbook. \n\nSample-based search is used to detect threat indicators or identifiers within samples sent to WildFire for analysis.\n\nSession-based search is used to detect threat indicators or identifiers within various context details and session data provided by samples during sample submission.\n\nTag-based search is used to identify the most popular tags."
  playbookInputQuery:
- key: Scope
  value: {}
  required: true
  description: Search scope for sample and session. Possible values are "industry", "organization", "global", or "all".
  playbookInputQuery:
- key: SampleQuery
  value: {}
  required: false
  description: |-
    Utilize the Autofocus advanced search mode to leverage a variety of query options within a sample search. Advanced search requires you to specify all field names, parameters, and operators.

    The query currently supports only JSON format which can be extracted from the Autofocus web console API radio button.
  playbookInputQuery:
- key: Sample first seen
  value: {}
  required: false
  description: |-
    A sample-based search can be narrowed down by specifying the timestamp at which samples were first uploaded to WildFire for analysis (indicators will be searched within samples after this timestamp).

    Specify the time in ISO 8601 format, for example, 2019-09-12T00:00:00.
  playbookInputQuery:
- key: Sample last modified
  value: {}
  required: false
  description: |-
    A sample-based search can be narrowed down by specifying the timestamp at which samples were last modified (indicators will be searched within samples after this timestamp).

    Specify the time in ISO 8601 format, for example, 2019-09-12T00:00:00.
  playbookInputQuery:
- key: SessionQuery
  value: {}
  required: false
  description: |-
    Utilize the Autofocus advanced search mode to leverage a variety of query options within a session search. Advanced search requires you to specify all field names, parameters, and operators.

    The query currently supports only JSON format which can be extracted from the Autofocus web console API radio button.
  playbookInputQuery:
- key: Sessions time before
  value: {}
  required: false
  description: |-
    A session-based search can be narrowed down by specifying the query end timestamp (indicators will be searched within sessions before this timestamp).

    Specify the time in ISO 8601 format, for example, 2019-09-12T00:00:00.
  playbookInputQuery:
- key: Sessions time after
  value: {}
  required: false
  description: |-
    A session-based search can be narrowed down by specifying the query start timestamp (indicators will be searched within sessions after this timestamp).

    Specify the time in ISO 8601 format, for example, 2019-09-12T00:00:00.
  playbookInputQuery:
- key: Wildfire Verdict
  value: {}
  required: false
  description: "Filter results by WildFire classification assigned to samples based on properties, behaviors, and activities observed for files or email links during static and dynamic analysis.\n\nPossible values are malware, benign, phishing, and greyware. "
  playbookInputQuery:
outputs:
- contextPath: Autofocus.Samples.HuntingResults
  description: Sample objects containing relevant fields.
  type: string
- contextPath: Autofocus.Samples.HuntingResults.Created
  description: The date that the file was created.
  type: date
- contextPath: Autofocus.Samples.HuntingResults.Finished
  description: The date the file was finished.
  type: date
- contextPath: Autofocus.Samples.HuntingResults.FileName
  description: The name of the file.
  type: string
- contextPath: Autofocus.Samples.HuntingResults.FileType
  description: The file type.
  type: string
- contextPath: Autofocus.Samples.HuntingResults.SHA1
  description: The SHA1 hash of the file.
  type: string
- contextPath: Autofocus.Samples.HuntingResults.SHA256
  description: The SHA256 hash of the file.
  type: string
- contextPath: Autofocus.Samples.HuntingResults.MD5
  description: The MD5 hash of the file.
  type: string
- contextPath: Autofocus.Samples.HuntingResults.Region
  description: The region of the sample.
  type: string
- contextPath: Autofocus.Samples.HuntingResults.Tags
  description: The tags attached to the sample.
  type: string
- contextPath: Autofocus.Samples.HuntingResults.TagGroups
  description: The groups of relevant tags.
  type: string
- contextPath: Autofocus.Samples.HuntingResults.Verdict
  description: The verdict of the sample.
  type: number
- contextPath: Autofocus.Samples.HuntingResults.Artifact.confidence
  description: How confident the decision.
  type: string
- contextPath: Autofocus.Samples.HuntingResults.Artifact.indicator
  description: The indicator that was tested.
  type: string
- contextPath: Autofocus.Samples.HuntingResults.Artifact.indicator_type
  description: 'The indicator type, for example: Mutex, User agent, IPv4, Domain.'
  type: string
- contextPath: Autofocus.Samples.HuntingResults.Artifact.b
  description: How many set the artifact as benign.
  type: string
- contextPath: Autofocus.Samples.HuntingResults.Artifact.g
  description: How many set the artifact as grayware.
  type: string
- contextPath: Autofocus.Samples.HuntingResults.Artifact.m
  description: How many set the artifact as malicious.
  type: string
- contextPath: Autofocus.Sessions.HuntingResults
  description: Session objects containing relevant fields.
  type: string
- contextPath: Autofocus.Sessions.HuntingResults.Seen
  description: The seen date.
  type: date
- contextPath: Autofocus.Sessions.HuntingResults.UploadSource
  description: The source of the uploaded sample.
  type: string
- contextPath: Autofocus.Sessions.HuntingResults.ID
  description: The ID of the session. Used to get session details.
  type: string
- contextPath: Autofocus.Sessions.HuntingResults.FileName
  description: The name of the file.
  type: string
- contextPath: Autofocus.Sessions.HuntingResults.FileURL
  description: The URL of the file.
  type: string
- contextPath: Autofocus.Sessions.HuntingResults.SHA256
  description: The SHA256 hash of the file.
  type: string
- contextPath: Autofocus.Sessions.HuntingResults.Industry
  description: The related industry.
  type: string
- contextPath: Autofocus.Sessions.HuntingResults.Region
  description: The regions of the sessions.
  type: string
- contextPath: Autofocus.Sessions.HuntingResults.Tags
  description: The relevant tags.
  type: string
- contextPath: Autofocus.Sessions.HuntingResults.app
  description: The associated application name.
  type: string
- contextPath: Autofocus.Sessions.HuntingResults.dst_ip
  description: The associated destination IP.
  type: string
- contextPath: Autofocus.Sessions.HuntingResults.src_ip
  description: The associated source IP.
  type: string
- contextPath: Autofocus.Sessions.HuntingResults.dst_countrycode
  description: The associated destination country code.
  type: string
- contextPath: Autofocus.Sessions.HuntingResults.src_countrycode
  description: The associated source country code.
  type: string
- contextPath: Autofocus.Sessions.HuntingResults.dst_port
  description: The associated destination port number.
  type: number
- contextPath: Autofocus.Sessions.HuntingResults.src_port
  description: The associated source port number.
  type: number
- contextPath: Autofocus.Sessions.HuntingResults.user_id
  description: Recipient User ID
  type: string
tests:
- No tests (auto formatted)
fromversion: 6.5.0
