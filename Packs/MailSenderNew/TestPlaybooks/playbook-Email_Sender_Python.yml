id: Mail Sender (New) Test
version: -1
name: Mail Sender (New) Test
description: |-
  Email sender - python.
  Tested against googleapps mail.
  Sends mail to user -> verify info against the client's mail.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 3a991b4c-240f-49c3-88b8-43b0ab5043b4
    type: start
    task:
      id: 3a991b4c-240f-49c3-88b8-43b0ab5043b4
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "1"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 50
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: a05cdba9-c578-4dbf-8ed9-084c27b9c48b
    type: regular
    task:
      id: a05cdba9-c578-4dbf-8ed9-084c27b9c48b
      version: -1
      name: Delete context
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "47"
    scriptarguments:
      all:
        simple: "yes"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 195
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: f4b72821-0066-4501-8f10-b92588ff0666
    type: regular
    task:
      id: f4b72821-0066-4501-8f10-b92588ff0666
      version: -1
      name: Send mail using Mail Sender With attachments
      script: Mail Sender (New)|||send-mail
      type: regular
      iscommand: true
      brand: Mail Sender (New)
      description: Send an email.
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      body:
        simple: this is a test by playbook
      subject:
        simple: special test via playbook (1)
      to:
        simple: test@demistodev.com
      transientFile:
        simple: test.txt,test.eml
      transientFileContent:
        simple: ${txt_data},${eml_data}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 895
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: 39c0ab1f-87eb-4490-8019-6b8b3a343da1
    type: regular
    task:
      id: 39c0ab1f-87eb-4490-8019-6b8b3a343da1
      version: -1
      name: Wait for mail to be received (Sleep)
      scriptName: Sleep
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      seconds:
        simple: "10"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 1070
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: a0221df8-22b7-43da-8dc5-acb6f53e9259
    type: regular
    task:
      id: a0221df8-22b7-43da-8dc5-acb6f53e9259
      version: -1
      name: Search for email sent and get ID
      description: Searches for Gmail records of a specified Google user.
      script: '|||gmail-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "5"
    scriptarguments:
      include-spam-trash:
        simple: "true"
      query:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: division
            args:
              by:
                value:
                  simple: "1000"
          - operator: floor
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'from:sr-test02@demistodev.onmicrosoft.com OR dbot@demisto.works subject:special test via playbook after:'
              suffix: {}
      user-id:
        simple: test@demistodev.com
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 1245
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: 2f9a7214-8356-4c26-8fb5-9af949dca56d
    type: condition
    task:
      id: 2f9a7214-8356-4c26-8fb5-9af949dca56d
      version: -1
      name: Check if email was found (if ID exists)
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "8"
      "yes":
      - "7"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: Gmail.ID
            iscontext: true
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 1420
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: af0a1c80-7657-4004-8046-4693fe7d7d34
    type: regular
    task:
      id: af0a1c80-7657-4004-8046-4693fe7d7d34
      version: -1
      name: Delete email list from context
      description: |-
        Because of how the googleapps integration is built, both fetching meta-data about the email ID and fetching the email itself, create record under Email key, which in turn duplicated a record with the same key&value of ID, thus preventing us from verifying our data later.

        The simple solution: delete the old entry after the ID was stored in the context.
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      key:
        simple: Gmail
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 2820
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: 11f8d392-21e4-48ab-830b-1e75020c0a69
    type: regular
    task:
      id: 11f8d392-21e4-48ab-830b-1e75020c0a69
      version: -1
      name: Save the retrieved mail's ID under a key for search in inbox
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "6"
    scriptarguments:
      key:
        simple: Testmail.ID
      value:
        complex:
          root: Gmail
          accessor: ID
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 2645
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: 57ee62eb-3826-443e-8f73-02238b629959
    type: regular
    task:
      id: 57ee62eb-3826-443e-8f73-02238b629959
      version: -1
      name: Wait for mail to receive
      scriptName: Sleep
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "39"
    scriptarguments:
      seconds:
        simple: "10"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 172.5,
          "y": 1595
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: 37c68a07-5ed8-4388-85c1-71632175b1ff
    type: condition
    task:
      id: 37c68a07-5ed8-4388-85c1-71632175b1ff
      version: -1
      name: Check if email was found
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "16"
      "yes":
      - "7"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: Gmail.ID
            iscontext: true
    view: |-
      {
        "position": {
          "x": 172.5,
          "y": 1945
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: c2aa3e61-4d99-4644-8f47-9cc09bee64c2
    type: regular
    task:
      id: c2aa3e61-4d99-4644-8f47-9cc09bee64c2
      version: -1
      name: Fetch email from google mail using message ID
      description: Retrieves the Gmail message sent to a specified user.
      script: '|||gmail-get-mail'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "12"
    scriptarguments:
      message-id:
        complex:
          root: Testmail
          accessor: ID
      user-id:
        simple: test@demistodev.com
      include-attachments:
        simple: "True"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 2995
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: 2caa9f8e-32dc-43a3-8f11-dea0d78b59a1
    type: condition
    task:
      id: 2caa9f8e-32dc-43a3-8f11-dea0d78b59a1
      version: -1
      name: Check for attachments
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "14"
      "yes":
      - "48"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: Gmail.Attachments
            iscontext: true
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 3170
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: 6b3a09d2-9307-42c1-8ae3-d06fb0973695
    type: title
    task:
      id: 6b3a09d2-9307-42c1-8ae3-d06fb0973695
      version: -1
      name: Test email was found with the attachment!
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "19"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 705,
          "y": 4220
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "14":
    id: "14"
    taskid: 4e123114-b8c5-4ba7-8baa-eaff62476507
    type: regular
    task:
      id: 4e123114-b8c5-4ba7-8baa-eaff62476507
      version: -1
      name: Email found without attachment
      type: regular
      iscommand: false
      brand: ""
      script: RaiseError
    scriptarguments:
      error:
        simple: No attachment found.
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 275,
          "y": 3345
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "15":
    id: "15"
    taskid: ca75ac43-ee74-4cfe-8326-1fb33376384c
    type: regular
    task:
      id: ca75ac43-ee74-4cfe-8326-1fb33376384c
      version: -1
      name: Test failed
      type: regular
      iscommand: false
      brand: ""
      script: RaiseError
    scriptarguments:
      error:
        simple: Mail was not found after 30 sec.
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 6640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 9a76cc77-d78a-49c7-8ef3-27df6756610b
    type: regular
    task:
      id: 9a76cc77-d78a-49c7-8ef3-27df6756610b
      version: -1
      name: Wait for mail to receive
      scriptName: Sleep
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "17"
    scriptarguments:
      seconds:
        simple: "10"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: 52ae122f-c942-40f1-8a5a-1b19f9dc7abc
    type: regular
    task:
      id: 52ae122f-c942-40f1-8a5a-1b19f9dc7abc
      version: -1
      name: Search for email sent (ID)
      description: Searches for Gmail records of a specified Google user.
      script: '|||gmail-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "18"
    scriptarguments:
      include-spam-trash:
        simple: "true"
      query:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: division
            args:
              by:
                value:
                  simple: "1000"
          - operator: floor
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'from:sr-test02@demistodev.onmicrosoft.com OR dbot@demisto.works OR mockpoc@demisto.works subject:special test via playbook after:'
              suffix: {}
      user-id:
        simple: test@demistodev.com
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2295
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: 50b0f4a0-5616-4cbe-85d3-9f8dc24c4f5e
    type: condition
    task:
      id: 50b0f4a0-5616-4cbe-85d3-9f8dc24c4f5e
      version: -1
      name: Check if email was found
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "15"
      "yes":
      - "7"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: Gmail.ID
            iscontext: true
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2470
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: 7192281b-b85a-49bd-8ed7-36a5d2c2f48a
    type: regular
    task:
      id: 7192281b-b85a-49bd-8ed7-36a5d2c2f48a
      version: -1
      name: Start Over - Send several files
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "33"
    scriptarguments:
      all:
        simple: "yes"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 705,
          "y": 4365
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: c3e76a7d-189b-420a-8334-c91d954d8369
    type: regular
    task:
      id: c3e76a7d-189b-420a-8334-c91d954d8369
      version: -1
      name: Send mail using python
      script: Mail Sender (New)|||send-mail
      type: regular
      iscommand: true
      brand: Mail Sender (New)
      description: Send an email.
    nexttasks:
      '#none#':
      - "21"
    scriptarguments:
      attachIDs:
        complex:
          root: File
          accessor: EntryID
      attachNames:
        simple: attach.txt
      body:
        simple: this is a test by playbook
      subject:
        simple: special test via playbook (2)
      to:
        simple: test@demistodev.com
      transientFile:
        simple: test.txt,test2.txt
      transientFileContent:
        simple: this is a test text inside a test attachment mail!,another mail content.
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 705,
          "y": 4715
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: d846195d-6d63-4f21-8a75-08ea99edb7a6
    type: regular
    task:
      id: d846195d-6d63-4f21-8a75-08ea99edb7a6
      version: -1
      name: Wait for mail to be received
      scriptName: Sleep
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "40"
    scriptarguments:
      seconds:
        simple: "10"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 705,
          "y": 4890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: f2814475-3437-48b7-83ab-997404850240
    type: condition
    task:
      id: f2814475-3437-48b7-83ab-997404850240
      version: -1
      name: Check if email was found (if ID exists)
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "24"
      "yes":
      - "30"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: Gmail.ID
            iscontext: true
    view: |-
      {
        "position": {
          "x": 705,
          "y": 5415
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: 105b5de8-ed3b-4590-8d02-d0c30cc8ad67
    type: regular
    task:
      id: 105b5de8-ed3b-4590-8d02-d0c30cc8ad67
      version: -1
      name: Wait for mail to be received
      scriptName: Sleep
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "43"
    scriptarguments:
      seconds:
        simple: "10"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 602.5,
          "y": 5590
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: cf4e7770-d5d8-49ea-84f7-131160da4919
    type: condition
    task:
      id: cf4e7770-d5d8-49ea-84f7-131160da4919
      version: -1
      name: Check if email was found (if ID exists)
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "28"
      "yes":
      - "30"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: Gmail.ID
            iscontext: true
    view: |-
      {
        "position": {
          "x": 602.5,
          "y": 5940
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: 6470698d-bdec-4fbf-814f-13058a712c7b
    type: condition
    task:
      id: 6470698d-bdec-4fbf-814f-13058a712c7b
      version: -1
      name: Check if email was found (if ID exists)
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "15"
      "yes":
      - "30"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: Gmail.ID
            iscontext: true
    view: |-
      {
        "position": {
          "x": 490,
          "y": 6465
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 4c43895d-b5aa-4ccc-8ade-52b50b59d88a
    type: regular
    task:
      id: 4c43895d-b5aa-4ccc-8ade-52b50b59d88a
      version: -1
      name: Wait for mail to be received
      scriptName: Sleep
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "44"
    scriptarguments:
      seconds:
        simple: "10"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 490,
          "y": 6115
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: 59dc960a-38c8-4709-849d-d8f29b9f9f20
    type: regular
    task:
      id: 59dc960a-38c8-4709-849d-d8f29b9f9f20
      version: -1
      name: Save the retrieved mail's ID under a key for search in inbox
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      key:
        simple: Testmail.ID
      value:
        complex:
          root: Gmail
          accessor: ID
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 725,
          "y": 6640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: 6c9a344d-9808-4b89-8a6a-ea58659f063e
    type: regular
    task:
      id: 6c9a344d-9808-4b89-8a6a-ea58659f063e
      version: -1
      name: Delete email list from context
      description: |-
        Because of how the gmail integration is built, both fetching meta-data about the email ID and fetching the email itself, create record under Email key, which in turn duplicated a record with the same key&value of ID, thus preventing us from verifying our data later.

        The simple solution: delete the old entry after the ID was stored in the context.
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "32"
    scriptarguments:
      key:
        simple: Email
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 725,
          "y": 6815
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: 43ea1310-7fef-4e3d-88a0-24402ee1114c
    type: regular
    task:
      id: 43ea1310-7fef-4e3d-88a0-24402ee1114c
      version: -1
      name: Fetch email from google mail using message ID
      description: Retrieves the Gmail message sent to a specified user.
      script: '|||gmail-get-mail'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "34"
    scriptarguments:
      message-id:
        complex:
          root: Testmail
          accessor: ID
      user-id:
        simple: test@demistodev.com
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 725,
          "y": 6990
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: dc37b6d4-f319-4948-8306-3fb1e9db5f5f
    type: regular
    task:
      id: dc37b6d4-f319-4948-8306-3fb1e9db5f5f
      version: -1
      name: Create a new File
      scriptName: FileCreateAndUploadV2
      type: regular
      iscommand: false
      brand: ""
      description: |
        Creates a file (using the given data input or entry ID) and uploads it to the current investigation War Room.
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      data:
        simple: WarRoom File
      filename:
        simple: attachment1.txt
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 705,
          "y": 4540
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: b3ba9e7b-4c40-460d-8f74-0a2bf13c96c9
    type: condition
    task:
      id: b3ba9e7b-4c40-460d-8f74-0a2bf13c96c9
      version: -1
      name: Check for attachments
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "35"
      "yes":
      - "37"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: Gmail.Attachments
            iscontext: true
    view: |-
      {
        "position": {
          "x": 725,
          "y": 7165
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: 0f047b64-20ba-4805-8da1-1048b6e6e8ff
    type: regular
    task:
      id: 0f047b64-20ba-4805-8da1-1048b6e6e8ff
      version: -1
      name: Email found without attachment
      type: regular
      iscommand: false
      brand: ""
      script: RaiseError
    scriptarguments:
      actual:
        complex:
          root: Email
          accessor: Attachments
          transformers:
          - operator: getField
            args:
              field:
                value:
                  simple: ID
          - operator: count
      error:
        simple: Not all attachments found.
      expected:
        simple: "3"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 510,
          "y": 7690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: 7077a00c-3c9b-4114-8362-f480536b3292
    type: title
    task:
      id: 7077a00c-3c9b-4114-8362-f480536b3292
      version: -1
      name: Finished Successfully
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 940,
          "y": 7705
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: b960e19c-88d7-4ec3-8a41-2ec7535a8680
    type: condition
    task:
      id: b960e19c-88d7-4ec3-8a41-2ec7535a8680
      version: -1
      name: Check for attachments
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "46"
      "yes":
      - "36"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: Gmail.Attachments
            iscontext: true
      - - operator: isEqualNumber
          left:
            value:
              complex:
                root: Gmail
                accessor: '[0].Attachments'
                transformers:
                - operator: count
            iscontext: true
          right:
            value:
              simple: "3"
    view: |-
      {
        "position": {
          "x": 837.5,
          "y": 7340
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: 074b4fcc-2968-4d13-8ebd-0861d33eccf7
    type: regular
    task:
      id: 074b4fcc-2968-4d13-8ebd-0861d33eccf7
      version: -1
      name: Get Time Now
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "2"
    scriptarguments:
      dateFormat:
        simple: ISO
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: ce86b1fc-8b11-41f0-8439-28c9df2759b7
    type: regular
    task:
      id: ce86b1fc-8b11-41f0-8439-28c9df2759b7
      version: -1
      name: Search for email sent and get ID
      description: Searches for Gmail records of a specified Google user.
      script: '|||gmail-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      include-spam-trash:
        simple: "true"
      query:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: division
            args:
              by:
                value:
                  simple: "1000"
          - operator: floor
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'from:sr-test02@demistodev.onmicrosoft.com OR dbot@demisto.works OR mockpoc@demisto.works subject:special test via playbook after:'
              suffix: {}
      user-id:
        simple: test@demistodev.com
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 172.5,
          "y": 1770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: 8cc20a39-8e6e-419b-8f09-2d83dd3cc19d
    type: regular
    task:
      id: 8cc20a39-8e6e-419b-8f09-2d83dd3cc19d
      version: -1
      name: Get Time Now
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "42"
    scriptarguments:
      dateFormat:
        simple: ISO
      minutesAgo:
        simple: "2"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 705,
          "y": 5065
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "42":
    id: "42"
    taskid: 5f071502-41bc-45ff-8247-b9d85a954a1e
    type: regular
    task:
      id: 5f071502-41bc-45ff-8247-b9d85a954a1e
      version: -1
      name: Search for email sent and get ID
      description: Searches for Gmail records of a specified Google user.
      script: '|||gmail-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "23"
    scriptarguments:
      include-spam-trash:
        simple: "true"
      query:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: division
            args:
              by:
                value:
                  simple: "1000"
          - operator: floor
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'from:sr-test02@demistodev.onmicrosoft.com OR dbot@demisto.works OR mockpoc@demisto.works subject:special test via playbook after:'
              suffix: {}
      user-id:
        simple: test@demistodev.com
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 705,
          "y": 5240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "43":
    id: "43"
    taskid: b6b4b7e8-236c-434c-8bf7-182b3bff0975
    type: regular
    task:
      id: b6b4b7e8-236c-434c-8bf7-182b3bff0975
      version: -1
      name: Search for email sent and get ID
      description: Searches for Gmail records of a specified Google user.
      script: '|||gmail-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      include-spam-trash:
        simple: "true"
      query:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: division
            args:
              by:
                value:
                  simple: "1000"
          - operator: floor
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'from:sr-test02@demistodev.onmicrosoft.com OR dbot@demisto.works subject:special test via playbook after:'
              suffix: {}
      user-id:
        simple: test@demistodev.com
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 602.5,
          "y": 5765
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "44":
    id: "44"
    taskid: 632ce9f7-f175-432c-84b0-239188fb1beb
    type: regular
    task:
      id: 632ce9f7-f175-432c-84b0-239188fb1beb
      version: -1
      name: Search for email sent and get ID
      description: Searches for Gmail records of a specified Google user.
      script: '|||gmail-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "27"
    scriptarguments:
      include-spam-trash:
        simple: "true"
      query:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: division
            args:
              by:
                value:
                  simple: "1000"
          - operator: floor
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'from:sr-test02@demistodev.onmicrosoft.com OR dbot@demisto.works subject:special test via playbook after:'
              suffix: {}
      user-id:
        simple: test@demistodev.com
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 490,
          "y": 6290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "46":
    id: "46"
    taskid: a38eb090-2b2f-4ea6-85b5-80bc1598674d
    type: condition
    task:
      id: a38eb090-2b2f-4ea6-85b5-80bc1598674d
      version: -1
      name: Check for attachments
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "35"
      "yes":
      - "36"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: Gmail.Attachments
            iscontext: true
      - - operator: isEqualNumber
          left:
            value:
              complex:
                root: Gmail
                accessor: '[1].Attachments'
                transformers:
                - operator: count
            iscontext: true
          right:
            value:
              simple: "3"
    view: |-
      {
        "position": {
          "x": 725,
          "y": 7515
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "47":
    id: "47"
    taskid: fbeaed8b-5cf8-449c-838e-691f31ad7391
    type: regular
    task:
      id: fbeaed8b-5cf8-449c-838e-691f31ad7391
      version: -1
      name: Set eml content
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "50"
    scriptarguments:
      key:
        simple: eml_data
      value:
        simple: "Â©\U0001F978"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "48":
    id: "48"
    taskid: da7500b0-4d4d-4b26-851c-d2761d5a60bb
    type: regular
    task:
      id: da7500b0-4d4d-4b26-851c-d2761d5a60bb
      version: -1
      name: Read txt File Attachment
      description: Load the contents of a file into context.
      scriptName: ReadFile
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "49"
    scriptarguments:
      entryID:
        complex:
          root: File
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: File.Extension
                iscontext: true
              right:
                value:
                  simple: txt
          accessor: EntryID
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 705,
          "y": 3345
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "49":
    id: "49"
    taskid: 1d2092ef-d6ce-4be3-8145-63299948ae8c
    type: condition
    task:
      id: 1d2092ef-d6ce-4be3-8145-63299948ae8c
      version: -1
      name: Verify Attachment txt File Unchanged
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "yes":
      - "52"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: FileData
            iscontext: true
          right:
            value:
              simple: txt_data
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 705,
          "y": 3520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "50":
    id: "50"
    taskid: 12b4bf74-2a01-4510-8737-768d6ea93f7d
    type: regular
    task:
      id: 12b4bf74-2a01-4510-8737-768d6ea93f7d
      version: -1
      name: Set txt content
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "38"
    scriptarguments:
      key:
        simple: txt_data
      value:
        simple: this is a test text inside a test attachment mail!
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 545
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "51":
    id: "51"
    taskid: 87d1836d-7ee0-4361-81c6-8e0b0a245a45
    type: regular
    task:
      id: 87d1836d-7ee0-4361-81c6-8e0b0a245a45
      version: -1
      name: Read eml File Attachment
      description: Load the contents of a file into context.
      scriptName: ReadFile
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "53"
    scriptarguments:
      entryID:
        complex:
          root: File
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: File.Extension
                iscontext: true
              right:
                value:
                  simple: eml
          accessor: EntryID
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 705,
          "y": 3870
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "52":
    id: "52"
    taskid: e1a3e52d-3c49-47f1-84f3-39e4319bff5f
    type: regular
    task:
      id: e1a3e52d-3c49-47f1-84f3-39e4319bff5f
      version: -1
      name: Delete Context Key FileData
      description: |-
        Delete field from context.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        - For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations 
        - For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script
        - For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "51"
    scriptarguments:
      all:
        simple: "no"
      key:
        simple: FileData
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 705,
          "y": 3695
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "53":
    id: "53"
    taskid: 613c9fd0-ca94-4891-873b-d8b5fa09317a
    type: condition
    task:
      id: 613c9fd0-ca94-4891-873b-d8b5fa09317a
      version: -1
      name: Verify Attachment eml File Unchanged
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "yes":
      - "13"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: FileData
            iscontext: true
          right:
            value:
              simple: eml_data
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 705,
          "y": 4045
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "10_16_#default#": 0.9,
      "10_7_yes": 0.34,
      "18_7_yes": 0.37
    },
    "paper": {
      "dimensions": {
        "height": 7735,
        "width": 1270,
        "x": 50,
        "y": 50
      }
    }
  }
inputs: []
outputs: []
fromversion: 5.0.0
