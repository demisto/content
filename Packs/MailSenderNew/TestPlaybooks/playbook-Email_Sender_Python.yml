id: Mail Sender (New) Test
version: -1
name: Mail Sender (New) Test
description: |-
  Email sender - python.
  Tested against googleapps mail.
  Sends mail to user -> verify info against the client's mail.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 349eb7a2-d444-4f0d-8d6a-ba203979514c
    type: start
    task:
      id: 349eb7a2-d444-4f0d-8d6a-ba203979514c
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "1"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 50
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: 186a7d07-7e23-44a1-8475-ce9ab2b98044
    type: regular
    task:
      id: 186a7d07-7e23-44a1-8475-ce9ab2b98044
      version: -1
      name: Delete context
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "47"
    scriptarguments:
      all:
        simple: "yes"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 195
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: 972aa8d4-23ac-40c8-8d7e-8f3079c5eec4
    type: regular
    task:
      id: 972aa8d4-23ac-40c8-8d7e-8f3079c5eec4
      version: -1
      name: Send mail using Mail Sender With attachments
      script: Mail Sender (New)|||send-mail
      type: regular
      iscommand: true
      brand: Mail Sender (New)
      description: Send an email.
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      body:
        simple: this is a test by playbook
      subject:
        simple: special test via playbook (1)
      to:
        simple: test@demistodev.com
      transientFile:
        simple: test.txt,test.eml
      transientFileContent:
        simple: ${txt_data},${eml_data}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 895
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: 8baccd56-c2b3-4051-8b7b-9ac399353b8a
    type: regular
    task:
      id: 8baccd56-c2b3-4051-8b7b-9ac399353b8a
      version: -1
      name: Wait for mail to be received (Sleep)
      scriptName: Sleep
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      seconds:
        simple: "10"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 1070
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: 27ed1a03-578a-4b5d-8297-6ecb397581de
    type: regular
    task:
      id: 27ed1a03-578a-4b5d-8297-6ecb397581de
      version: -1
      name: Search for email sent and get ID
      description: Searches for Gmail records of a specified Google user.
      script: '|||gmail-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "5"
    scriptarguments:
      include-spam-trash:
        simple: "true"
      query:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: division
            args:
              by:
                value:
                  simple: "1000"
          - operator: floor
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'from:sr-test02@demistodev.onmicrosoft.com OR dbot@demisto.works subject:special test via playbook after:'
              suffix: {}
      user-id:
        simple: test@demistodev.com
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 1245
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: 4f67a891-e739-4e9a-8d27-b53c83de59d4
    type: condition
    task:
      id: 4f67a891-e739-4e9a-8d27-b53c83de59d4
      version: -1
      name: Check if email was found (if ID exists)
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "8"
      "yes":
      - "7"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: Gmail.ID
            iscontext: true
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 1420
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: 6dad4817-a93e-46da-8b8d-29d09977dd29
    type: regular
    task:
      id: 6dad4817-a93e-46da-8b8d-29d09977dd29
      version: -1
      name: Delete email list from context
      description: |-
        Because of how the googleapps integration is built, both fetching meta-data about the email ID and fetching the email itself, create record under Email key, which in turn duplicated a record with the same key&value of ID, thus preventing us from verifying our data later.

        The simple solution: delete the old entry after the ID was stored in the context.
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      key:
        simple: Gmail
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 2820
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: 8da6b4c1-cda6-479f-8d14-4f35252187a8
    type: regular
    task:
      id: 8da6b4c1-cda6-479f-8d14-4f35252187a8
      version: -1
      name: Save the retrieved mail's ID under a key for search in inbox
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "6"
    scriptarguments:
      key:
        simple: Testmail.ID
      value:
        complex:
          root: Gmail
          accessor: ID
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 2645
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: c347110b-3747-40c8-8ea9-666df07befc4
    type: regular
    task:
      id: c347110b-3747-40c8-8ea9-666df07befc4
      version: -1
      name: Wait for mail to receive
      scriptName: Sleep
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "39"
    scriptarguments:
      seconds:
        simple: "10"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 172.5,
          "y": 1595
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: 55126a7c-5c19-4dcf-8ec2-dfb05b5473a6
    type: condition
    task:
      id: 55126a7c-5c19-4dcf-8ec2-dfb05b5473a6
      version: -1
      name: Check if email was found
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "16"
      "yes":
      - "7"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: Gmail.ID
            iscontext: true
    view: |-
      {
        "position": {
          "x": 172.5,
          "y": 1945
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: ed4f1584-acf1-4d44-8119-529bffea7906
    type: regular
    task:
      id: ed4f1584-acf1-4d44-8119-529bffea7906
      version: -1
      name: Fetch email from google mail using message ID
      description: Retrieves the Gmail message sent to a specified user.
      script: '|||gmail-get-mail'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "12"
    scriptarguments:
      message-id:
        complex:
          root: Testmail
          accessor: ID
      user-id:
        simple: test@demistodev.com
      include-attachments:
        simple: "True"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 2995
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: f0d34a8d-5e2a-48e4-8c2e-610350567bee
    type: condition
    task:
      id: f0d34a8d-5e2a-48e4-8c2e-610350567bee
      version: -1
      name: Check for attachments
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "14"
      "yes":
      - "48"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: Gmail.Attachments
            iscontext: true
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 3170
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: 3601f097-7e1b-4c01-89e1-259f6d888da7
    type: title
    task:
      id: 3601f097-7e1b-4c01-89e1-259f6d888da7
      version: -1
      name: Test email was found with the attachment!
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "19"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 705,
          "y": 4220
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "14":
    id: "14"
    taskid: c477e747-1bd6-4de9-82b1-a279b71dde71
    type: regular
    task:
      id: c477e747-1bd6-4de9-82b1-a279b71dde71
      version: -1
      name: Email found without attachment
      type: regular
      iscommand: false
      brand: ""
      script: RaiseError
    scriptarguments:
      error:
        simple: No attachment found.
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 275,
          "y": 3345
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "15":
    id: "15"
    taskid: 2f0799d4-93ff-42c2-8b32-5fea8b940e50
    type: regular
    task:
      id: 2f0799d4-93ff-42c2-8b32-5fea8b940e50
      version: -1
      name: Test failed
      type: regular
      iscommand: false
      brand: ""
      script: RaiseError
    scriptarguments:
      error:
        simple: Mail was not found after 30 sec.
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 6640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 242eef29-3f40-44f2-8b50-edabdabdebd0
    type: regular
    task:
      id: 242eef29-3f40-44f2-8b50-edabdabdebd0
      version: -1
      name: Wait for mail to receive
      scriptName: Sleep
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "17"
    scriptarguments:
      seconds:
        simple: "10"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: deaa034f-5bd7-4168-8ef4-d1afc3025b96
    type: regular
    task:
      id: deaa034f-5bd7-4168-8ef4-d1afc3025b96
      version: -1
      name: Search for email sent (ID)
      description: Searches for Gmail records of a specified Google user.
      script: '|||gmail-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "18"
    scriptarguments:
      include-spam-trash:
        simple: "true"
      query:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: division
            args:
              by:
                value:
                  simple: "1000"
          - operator: floor
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'from:sr-test02@demistodev.onmicrosoft.com OR dbot@demisto.works OR mockpoc@demisto.works subject:special test via playbook after:'
              suffix: {}
      user-id:
        simple: test@demistodev.com
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2295
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: b7628a7e-45b5-4a0c-89e2-9e480ca734d0
    type: condition
    task:
      id: b7628a7e-45b5-4a0c-89e2-9e480ca734d0
      version: -1
      name: Check if email was found
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "15"
      "yes":
      - "7"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: Gmail.ID
            iscontext: true
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2470
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: 3d2cc0ce-3253-451e-8b0e-023b281e9bf7
    type: regular
    task:
      id: 3d2cc0ce-3253-451e-8b0e-023b281e9bf7
      version: -1
      name: Start Over - Send several files
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "33"
    scriptarguments:
      all:
        simple: "yes"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 705,
          "y": 4365
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: da598d63-fefb-48fa-890c-420a43e097e2
    type: regular
    task:
      id: da598d63-fefb-48fa-890c-420a43e097e2
      version: -1
      name: Send mail using python
      script: Mail Sender (New)|||send-mail
      type: regular
      iscommand: true
      brand: Mail Sender (New)
      description: Send an email.
    nexttasks:
      '#none#':
      - "21"
    scriptarguments:
      attachIDs:
        complex:
          root: File
          accessor: EntryID
      attachNames:
        simple: attach.txt
      body:
        simple: this is a test by playbook
      subject:
        simple: special test via playbook (2)
      to:
        simple: test@demistodev.com
      transientFile:
        simple: test.txt,test2.txt
      transientFileContent:
        simple: this is a test text inside a test attachment mail!,another mail content.
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 705,
          "y": 4715
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: 8c726ccf-e281-4112-8e0c-8ec62ed2dcd2
    type: regular
    task:
      id: 8c726ccf-e281-4112-8e0c-8ec62ed2dcd2
      version: -1
      name: Wait for mail to be received
      scriptName: Sleep
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "40"
    scriptarguments:
      seconds:
        simple: "10"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 705,
          "y": 4890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: e756d102-75c1-428a-8d0e-f3ccce125f62
    type: condition
    task:
      id: e756d102-75c1-428a-8d0e-f3ccce125f62
      version: -1
      name: Check if email was found (if ID exists)
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "24"
      "yes":
      - "30"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: Gmail.ID
            iscontext: true
    view: |-
      {
        "position": {
          "x": 705,
          "y": 5415
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: 13d6f404-689d-4738-85c1-f1d11409afe6
    type: regular
    task:
      id: 13d6f404-689d-4738-85c1-f1d11409afe6
      version: -1
      name: Wait for mail to be received
      scriptName: Sleep
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "43"
    scriptarguments:
      seconds:
        simple: "10"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 602.5,
          "y": 5590
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: 33d2d1d3-13dc-4260-884b-f872fa97cdc3
    type: condition
    task:
      id: 33d2d1d3-13dc-4260-884b-f872fa97cdc3
      version: -1
      name: Check if email was found (if ID exists)
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "28"
      "yes":
      - "30"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: Gmail.ID
            iscontext: true
    view: |-
      {
        "position": {
          "x": 602.5,
          "y": 5940
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: 07a88123-47b3-43fe-8ec6-13a81df3a896
    type: condition
    task:
      id: 07a88123-47b3-43fe-8ec6-13a81df3a896
      version: -1
      name: Check if email was found (if ID exists)
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "15"
      "yes":
      - "30"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: Gmail.ID
            iscontext: true
    view: |-
      {
        "position": {
          "x": 490,
          "y": 6465
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 5826b16b-3a76-4422-85ee-240d9428a1e5
    type: regular
    task:
      id: 5826b16b-3a76-4422-85ee-240d9428a1e5
      version: -1
      name: Wait for mail to be received
      scriptName: Sleep
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "44"
    scriptarguments:
      seconds:
        simple: "10"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 490,
          "y": 6115
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: fe11fadc-9e06-4c85-80cb-82e41e706207
    type: regular
    task:
      id: fe11fadc-9e06-4c85-80cb-82e41e706207
      version: -1
      name: Save the retrieved mail's ID under a key for search in inbox
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      key:
        simple: Testmail.ID
      value:
        complex:
          root: Gmail
          accessor: ID
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 725,
          "y": 6640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: 360096ba-0c33-4a04-8a49-0c9a6d6797c4
    type: regular
    task:
      id: 360096ba-0c33-4a04-8a49-0c9a6d6797c4
      version: -1
      name: Delete email list from context
      description: |-
        Because of how the gmail integration is built, both fetching meta-data about the email ID and fetching the email itself, create record under Email key, which in turn duplicated a record with the same key&value of ID, thus preventing us from verifying our data later.

        The simple solution: delete the old entry after the ID was stored in the context.
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "32"
    scriptarguments:
      key:
        simple: Email
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 725,
          "y": 6815
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: b28db34e-8a66-4324-8c8a-0ebd1f21472c
    type: regular
    task:
      id: b28db34e-8a66-4324-8c8a-0ebd1f21472c
      version: -1
      name: Fetch email from google mail using message ID
      description: Retrieves the Gmail message sent to a specified user.
      script: '|||gmail-get-mail'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "34"
    scriptarguments:
      message-id:
        complex:
          root: Testmail
          accessor: ID
      user-id:
        simple: test@demistodev.com
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 725,
          "y": 6990
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: 008b8283-9c81-42c8-8607-e3bc48b30127
    type: regular
    task:
      id: 008b8283-9c81-42c8-8607-e3bc48b30127
      version: -1
      name: Create a new File
      scriptName: FileCreateAndUploadV2
      type: regular
      iscommand: false
      brand: ""
      description: |
        Creates a file (using the given data input or entry ID) and uploads it to the current investigation War Room.
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      data:
        simple: WarRoom File
      filename:
        simple: attachment1.txt
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 705,
          "y": 4540
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: 8543b006-fe28-492a-8c01-0afacd1c6190
    type: condition
    task:
      id: 8543b006-fe28-492a-8c01-0afacd1c6190
      version: -1
      name: Check for attachments
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "35"
      "yes":
      - "37"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: Gmail.Attachments
            iscontext: true
    view: |-
      {
        "position": {
          "x": 725,
          "y": 7165
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: abf3b41f-a997-47d5-813a-ec1f45c65ece
    type: regular
    task:
      id: abf3b41f-a997-47d5-813a-ec1f45c65ece
      version: -1
      name: Email found without attachment
      type: regular
      iscommand: false
      brand: ""
      script: RaiseError
    scriptarguments:
      actual:
        complex:
          root: Email
          accessor: Attachments
          transformers:
          - operator: getField
            args:
              field:
                value:
                  simple: ID
          - operator: count
      error:
        simple: Not all attachments found.
      expected:
        simple: "3"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 510,
          "y": 7690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: a1fe8b99-6918-440a-8375-fd68be3e9aa9
    type: title
    task:
      id: a1fe8b99-6918-440a-8375-fd68be3e9aa9
      version: -1
      name: Finished Successfully
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 940,
          "y": 7705
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: a23d4b02-969b-4929-88cb-34b39326ce26
    type: condition
    task:
      id: a23d4b02-969b-4929-88cb-34b39326ce26
      version: -1
      name: Check for attachments
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "46"
      "yes":
      - "36"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: Gmail.Attachments
            iscontext: true
      - - operator: isEqualNumber
          left:
            value:
              complex:
                root: Gmail
                accessor: '[0].Attachments'
                transformers:
                - operator: count
            iscontext: true
          right:
            value:
              simple: "3"
    view: |-
      {
        "position": {
          "x": 837.5,
          "y": 7340
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: a187e032-a928-4afa-890a-0ad95397506d
    type: regular
    task:
      id: a187e032-a928-4afa-890a-0ad95397506d
      version: -1
      name: Get Time Now
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "2"
    scriptarguments:
      dateFormat:
        simple: ISO
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: 5a6a99a2-c0d0-4cd4-80e3-55a22c46c58f
    type: regular
    task:
      id: 5a6a99a2-c0d0-4cd4-80e3-55a22c46c58f
      version: -1
      name: Search for email sent and get ID
      description: Searches for Gmail records of a specified Google user.
      script: '|||gmail-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      include-spam-trash:
        simple: "true"
      query:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: division
            args:
              by:
                value:
                  simple: "1000"
          - operator: floor
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'from:sr-test02@demistodev.onmicrosoft.com OR dbot@demisto.works OR mockpoc@demisto.works subject:special test via playbook after:'
              suffix: {}
      user-id:
        simple: test@demistodev.com
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 172.5,
          "y": 1770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: 9e60c2a8-ead2-4144-8d6a-95f5455607ed
    type: regular
    task:
      id: 9e60c2a8-ead2-4144-8d6a-95f5455607ed
      version: -1
      name: Get Time Now
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "42"
    scriptarguments:
      dateFormat:
        simple: ISO
      minutesAgo:
        simple: "2"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 705,
          "y": 5065
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "42":
    id: "42"
    taskid: 4971e278-265c-41b5-841b-28922844726f
    type: regular
    task:
      id: 4971e278-265c-41b5-841b-28922844726f
      version: -1
      name: Search for email sent and get ID
      description: Searches for Gmail records of a specified Google user.
      script: '|||gmail-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "23"
    scriptarguments:
      include-spam-trash:
        simple: "true"
      query:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: division
            args:
              by:
                value:
                  simple: "1000"
          - operator: floor
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'from:sr-test02@demistodev.onmicrosoft.com OR dbot@demisto.works OR mockpoc@demisto.works subject:special test via playbook after:'
              suffix: {}
      user-id:
        simple: test@demistodev.com
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 705,
          "y": 5240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "43":
    id: "43"
    taskid: aaa59540-cabf-48e7-80b1-807c057c4356
    type: regular
    task:
      id: aaa59540-cabf-48e7-80b1-807c057c4356
      version: -1
      name: Search for email sent and get ID
      description: Searches for Gmail records of a specified Google user.
      script: '|||gmail-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      include-spam-trash:
        simple: "true"
      query:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: division
            args:
              by:
                value:
                  simple: "1000"
          - operator: floor
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'from:sr-test02@demistodev.onmicrosoft.com OR dbot@demisto.works subject:special test via playbook after:'
              suffix: {}
      user-id:
        simple: test@demistodev.com
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 602.5,
          "y": 5765
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "44":
    id: "44"
    taskid: 3fd98f50-c29a-4c49-8260-e01cb641ba07
    type: regular
    task:
      id: 3fd98f50-c29a-4c49-8260-e01cb641ba07
      version: -1
      name: Search for email sent and get ID
      description: Searches for Gmail records of a specified Google user.
      script: '|||gmail-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "27"
    scriptarguments:
      include-spam-trash:
        simple: "true"
      query:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: division
            args:
              by:
                value:
                  simple: "1000"
          - operator: floor
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'from:sr-test02@demistodev.onmicrosoft.com OR dbot@demisto.works subject:special test via playbook after:'
              suffix: {}
      user-id:
        simple: test@demistodev.com
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 490,
          "y": 6290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "46":
    id: "46"
    taskid: c0c83903-d575-4ff3-85f0-19eccf4f92e7
    type: condition
    task:
      id: c0c83903-d575-4ff3-85f0-19eccf4f92e7
      version: -1
      name: Check for attachments
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "35"
      "yes":
      - "36"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: Gmail.Attachments
            iscontext: true
      - - operator: isEqualNumber
          left:
            value:
              complex:
                root: Gmail
                accessor: '[1].Attachments'
                transformers:
                - operator: count
            iscontext: true
          right:
            value:
              simple: "3"
    view: |-
      {
        "position": {
          "x": 725,
          "y": 7515
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "47":
    id: "47"
    taskid: 5abcf484-cc7b-4fca-82f6-5b6d1365832a
    type: regular
    task:
      id: 5abcf484-cc7b-4fca-82f6-5b6d1365832a
      version: -1
      name: Set eml content
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "50"
    scriptarguments:
      key:
        simple: eml_data
      value:
        simple: "Â©\U0001F978"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "48":
    id: "48"
    taskid: 0dd26e83-57f4-4c02-8090-44d711118e09
    type: regular
    task:
      id: 0dd26e83-57f4-4c02-8090-44d711118e09
      version: -1
      name: Read txt File Attachment
      description: Load the contents of a file into context.
      scriptName: ReadFile
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "49"
    scriptarguments:
      entryID:
        complex:
          root: File
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: File.Extension
                iscontext: true
              right:
                value:
                  simple: txt
          accessor: EntryID
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 705,
          "y": 3345
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "49":
    id: "49"
    taskid: 31bb831d-5bb7-4777-8a87-99ba8442b4d5
    type: condition
    task:
      id: 31bb831d-5bb7-4777-8a87-99ba8442b4d5
      version: -1
      name: Verify Attachment txt File Unchanged
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "yes":
      - "52"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: ReadFile.Data
            iscontext: true
          right:
            value:
              simple: txt_data
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 705,
          "y": 3520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "50":
    id: "50"
    taskid: e0cec10b-0a4e-463c-852e-d251ef960a8f
    type: regular
    task:
      id: e0cec10b-0a4e-463c-852e-d251ef960a8f
      version: -1
      name: Set txt content
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "38"
    scriptarguments:
      key:
        simple: txt_data
      value:
        simple: this is a test text inside a test attachment mail!
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 545
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "51":
    id: "51"
    taskid: a4df890c-583e-4eb1-8383-f0682bce1464
    type: regular
    task:
      id: a4df890c-583e-4eb1-8383-f0682bce1464
      version: -1
      name: Read eml File Attachment
      description: Load the contents of a file into context.
      scriptName: ReadFile
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "53"
    scriptarguments:
      entryID:
        complex:
          root: File
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: File.Extension
                iscontext: true
              right:
                value:
                  simple: eml
          accessor: EntryID
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 705,
          "y": 3870
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "52":
    id: "52"
    taskid: f0a77cc4-bac2-4081-8a4e-77600a9cc7c5
    type: regular
    task:
      id: f0a77cc4-bac2-4081-8a4e-77600a9cc7c5
      version: -1
      name: Delete Context Key ReadFile.Data
      description: |-
        Delete field from context.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.10/Cortex-XSOAR-Administrator-Guide/Automations
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "51"
    scriptarguments:
      all:
        simple: "no"
      key:
        simple: ReadFile.Data
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 705,
          "y": 3695
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "53":
    id: "53"
    taskid: 88c66c51-367d-48af-80b7-9535a1729258
    type: condition
    task:
      id: 88c66c51-367d-48af-80b7-9535a1729258
      version: -1
      name: Verify Attachment eml File Unchanged
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "yes":
      - "13"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: ReadFile.Data
            iscontext: true
          right:
            value:
              simple: eml_data
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 705,
          "y": 4045
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "10_16_#default#": 0.9,
      "10_7_yes": 0.34,
      "18_7_yes": 0.37
    },
    "paper": {
      "dimensions": {
        "height": 7735,
        "width": 1270,
        "x": 50,
        "y": 50
      }
    }
  }
inputs: []
outputs: []
fromversion: 5.0.0
