commonfields:
  id: VxStream
  version: -1
name: VxStream
display: CrowdStrike Falcon Sandbox
category: Forensics & Malware Analysis
image: data:image/png;base64,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
description: Fully automated malware analysis (formerly Payload Security VxStream).
configuration:
- display: Server URL (e.g. https://216.3.128.82)
  name: serverUrl
  defaultvalue: https://www.hybrid-analysis.com
  type: 0
  required: true
- display: API Key
  name: apiKey
  defaultvalue: ""
  type: 4
  required: true
- display: Secret Key (applicable only for v1)
  name: secretKey
  defaultvalue: ""
  type: 4
  required: false
- display: API Version (v1,v2)
  name: version
  defaultvalue: v1
  type: 0
  required: false
- display: Trust any certificate (not secure)
  name: insecure
  defaultvalue: ""
  type: 8
  required: false
- display: Use system proxy settings
  name: proxy
  defaultvalue: ""
  type: 8
  required: false
script:
  script: |+
    var apiKey = params.apiKey;
    var secretKey = params.secretKey;
    var serverUrl = params.serverUrl;
    var insecure = params.insecure;
    var proxy = params.proxy;
    var version = params.version;
    if (version === undefined) {
        version = 'v1';
    }
    if (version === 'v1' && !secretKey) {
        return 'No API secret key was provided.';
    }
    var HEADERS = {
        'User-Agent': ['Falcon Sandbox']
    };
    if (version === 'v1') {
        HEADERS['Authorization'] = ['Basic ' + Base64.encode(apiKey + ':' + secretKey)];
    } else { // API Version is v2
        HEADERS['api-key'] = [apiKey];
        HEADERS['accept'] = ['application/json'];
    }

    // handle '/' at the end of serverUrl
    if (serverUrl[serverUrl.length - 1] === '/') {
        serverUrl = serverUrl.substring(0, serverUrl.length - 1);
    }

    // Add `contains` to String prototype.

    if (!('contains' in String.prototype))
        String.prototype.contains = function(str, startIndex) {
            return -1 !== String.prototype.indexOf.call(this, str, startIndex);
        };

    function argToBool(arg){
        switch (typeof arg){
            case 'boolean': return arg;
            case 'string': return (arg === 'true');
            case 'undefined': return false;
        }

    }

    function entryError(errorCode, text) {
        var error = 'Falcon Sandbox returned an error (' + errorCode + ') - ' + text;
        return {Type: entryTypes.error, ContentsFormat: formats.text, Contents: error};
    }

    // return a function that maps object keys by mapper (or capitlize keys if key is not exists in mapper)
    function mapObject(mapper) {
        return function(obj) {
            var res = {};
            Object.keys(obj).forEach(function(key) {
                // map key or capitalize if not exists
                var newKey = mapper[key] || key;
                res[newKey] = obj[key];
            });
            return res;
        };
    }

    function createTableEntry(name, rawResponse, table, context, headers) {
        return {
            Type: entryTypes.note,
            ContentsFormat: formats.json,
            Contents: rawResponse,
            ReadableContentsFormat: formats.markdown,
            HumanReadable: tableToMarkdown(name, table, headers, undefined, headerTransform=underscoreToCamelCase),
            EntryContext: context
        };
    }

    function sendRequest(method, endpoint, body) {
        var requestUrl = serverUrl + endpoint;
        var res = http(
            requestUrl,
            {
                Method: method,
                Headers: HEADERS,
                Body: body
            },
            insecure,
            proxy
        );

        if (res.StatusCode < 200 || res.StatusCode >= 300) {
            throw 'Request Failed.\nStatus code: ' + res.StatusCode + '.\nBody: ' + JSON.stringify(res, null, 2) + '.';
        }
        var responseBody;
        try {
            responseBody = JSON.parse(res.Body);
        } catch (ex) {
            responseBody = res.Bytes;
        }
        return responseBody;
    }

    function scan(hash) {
        if (version === 'v1'){
            return sendRequest('GET', '/api/scan/' + hash);
        } else { // v2
            HEADERS['Content-Type'] = ['application/x-www-form-urlencoded'];
            return sendRequest('POST', '/api/v2/search/hash', 'hash='+hash);
        }

    }
    function scanToEntry(res, hash) {
        if (version === 'v1' && res.response_code !== 0) {
            return entryError(res.response_code, res.response.error);
        }
        var response = (version === 'v1') ? res.response: res;
        // Prettify response certificates
        if (response[0].certificates) {
            for (var i = 0; i < response[0].certificates.length; i++) {
                response[0].certificates[i] = JSON.stringify(response[0].certificates[i], null, 2);
            }
        }
        // create table from response
        var tableMapper = {
           threatlevel: 'threat level',
           total_network_connections: 'total network connections',
           targeturl: 'target url',
           classification_tags: 'classification tags',
           threatscore: 'threat score',
           total_processes: 'total processes',
           submitname: 'submit name',
           environmentDescription: 'environment description',
           isinteresting: 'interesting',
           environmentId: 'environment id',
           isurlanalysis: 'url analysis',
           analysis_start_time: 'analysis start time',
           total_signatures: 'total signatures'
        };

        var table = response.map(mapObject(tableMapper));

        // create context from response
        var context = {};

        var contextMapper = {
            sha1: 'SHA1',
            sha256: 'SHA256',
            md5: 'MD5',
            job_id: 'JobID',
            environment_id: 'environmentId',
            threat_score: 'threatscore',
            environment_description: 'environmentDescription',
            submit_name: 'submitname',
            url_analysis: 'isurlanalysis',
            interesting: 'isinteresting',
            vx_family: 'vxfamily'
        };
        var filePath = "File(val.hash===obj.hash)";
        fileContext = response.map(mapObject(contextMapper));
        fileContext[0].hash = hash;
        context[filePath] = fileContext;
        response.forEach(function(res) {
           if(res.threatlevel && res.threatlevel > 1) {
               addMalicious(context, outputPaths.file, {
                    MD5: res.md5,
                    SHA1: res.sha1,
                    SHA256: res.sha256,
                    Malicious: {
                        Vendor: 'Falcon Sandbox',
                        Description: 'Score above ' + res.threatscore
                    }
                });
           }
        });
        context.DBotScore = {
            Indicator: response[0].sha256,
            Type: 'hash',
            Vendor: 'CrowdStrike Falcon Sandbox',
            Score: translateScore(response[0]['threat_level'])
        }
        return createTableEntry('Scan Results:', response, table, context);
    }

    function getEnvironments() {
        var response;
        if (version === 'v1'){
            var res = sendRequest('GET', '/system/state');
            if (res.response_code !== 0) {
                return entryError(res.response_code, res.response.error);
            }
            response = res.response;
        }
        else{//v2
            response = sendRequest('GET', '/api/v2/system/environments')
        }
        return response;
    }

    function tableFromEnvironments(response) {
        var environments = response; // if v2
        if(version === 'v1'){
            if ('environment' in response) { // Single-server setup
                environments = response.environment;
            } else { // Multi-server setup
                environments = response.backend.global_environment;
            }
        }
        var environmentsKeys = Object.keys(environments);
        var table=[];
        var envContext = [];
        for (var i = 0; i < environmentsKeys.length; i++){
            var currentEnvironment = environments[environmentsKeys[i]];
            table[i] = {
                'ID': (version === 'v1') ? currentEnvironment.ID : currentEnvironment.environment_id,
                description: currentEnvironment.description,
                architecture: currentEnvironment.architecture,
                'total VMS': (version === 'v1') ? currentEnvironment.VMs_total : currentEnvironment.total_virtual_machines,
                'busy VMS': (version === 'v1') ? currentEnvironment.VMs_busy : currentEnvironment.busy_virtual_machines,
                'analysis mode': (version === 'v1') ? currentEnvironment.analysisMode : currentEnvironment.analysis_mode,
                'group icon': currentEnvironment.groupicon ? currentEnvironment.groupicon :
                currentEnvironment.group_icon ? currentEnvironment.group_icon : ''
            };
            envContext[i] = {
                'ID': (version === 'v1') ? currentEnvironment.ID : currentEnvironment.environment_id,
                'description': currentEnvironment.description,
                'architecture': currentEnvironment.architecture,
                'VMs_invalid': (version === 'v1') ? currentEnvironment.VMs_invalid : currentEnvironment.invalid_virtual_machines,
                'VMs_total': (version === 'v1') ? currentEnvironment.VMs_total : currentEnvironment.total_virtual_machines,
                'VMs_busy': (version === 'v1') ? currentEnvironment.VMs_busy : currentEnvironment.busy_virtual_machines,
                'analysisMode': (version === 'v1') ? currentEnvironment.analysisMode : currentEnvironment.analysis_mode,
                'groupicon': currentEnvironment.groupicon ? currentEnvironment.groupicon :
                currentEnvironment.group_icon ? currentEnvironment.group_icon : ''
            }
        }
        // create context from environments
        var context = {
            'VX.Environment(val.ID && val.ID == obj.ID)': envContext,
            'CrowdStrike.Environment(val.ID && val.ID == obj.ID)': envContext
        };


        return createTableEntry('All Environments:', response, table, context, ['ID', 'description', 'architecture', 'total VMS', 'busy VMS', 'analysis mode', 'group icon']);
    }

    function submitFile(entryId, environmentId) {
        var requestUrl = version === 'v1' ? serverUrl + '/api/submit' : serverUrl + '/api/v2/submit/file';
        var multipart_content = null;
        if (version === 'v2') {
            HEADERS['Content-Type'] = ['application/x-www-form-urlencoded'];
            multipart_content = {environment_id: environmentId}; // For API v2
        } else {
            multipart_content = {environmentId: environmentId}; // For API v1
        }

        // submit file
        var res = httpMultipart(
                    requestUrl, // URL
                    entryId, // Optional - FilePath / EntryID
                    {
                        Method: 'POST',
                        Headers: HEADERS
                    },
                    multipart_content,
                    insecure,
                    proxy
                );

        if (res.StatusCode < 200 || res.StatusCode >= 300) {
            throw 'Multipart Request Failed.\nStatus code: ' + res.StatusCode + '.\nBody: ' + JSON.stringify(res) + '.';
        }
        var body;

        try {
            body = JSON.parse(res.Body);
        } catch (ex) {
            throw 'Error parsing response - ' + res.Body + ' - ' + ex;
        }
        if (version === 'v1' && body.response_code !== 0) {
            return entryError(body.response_code, body.response.error);
        }
        var response = version === 'v1' ? body.response: body;

        var fileResult = {};
        if (response.sha256) {
            fileResult.SHA256 = response.sha256;
        }
        if (response.sha1) {
            fileResult.SHA1 = response.sha1;
        }
        if (response.md5) {
            fileResult.MD5 = response.md5;
        }
        if (response['job_id']) {
            fileResult.JobID = response['job_id'];
        }
        if (response['environment_id']) {
            fileResult.EnvironmentID = response['environment_id'];
        }
        return fileResult;
    }

    function submitFileEntry(file) {
        var resMessage = 'File submitted successfully';
        var fileContext = {}
        var csContext = {}
        if (file.SHA256) {
            fileContext.SHA256 = file.SHA256;
            resMessage += '\nSHA256 - ' + file.SHA256;
        }
        if (file.SHA1) {
            fileContext.SHA1 = file.SHA1;
            resMessage += '\nSHA1 - ' + file.SHA1;
        }
        if (file.MD5) {
            fileContext.MD5 = file.MD5;
            resMessage += '\nMD5 - ' + file.MD5;
        }
        if (file.JobID) {
            csContext.JobID = file.JobID;
            resMessage += '\nJob ID - ' + file.JobID;
        }
        if (file.EnvironmentID) {
            csContext.EnvironmentID = file.EnvironmentID;
            resMessage += '\nEnvironment ID - ' + file.EnvironmentID;
        }
        var context = {
            'File(val.JobID && val.JobID == obj.JobID || val.SHA256 && val.SHA256 == obj.SHA256)': fileContext
        }

        if (csContext) {
            context['CrowdStrike(val.JobID && val.JobID === obj.JobID)'] = csContext
        }

        return {
            Type: entryTypes.note,
            ContentsFormat: formats.json,
            Contents: file,
            ReadableContentsFormat: formats.markdown,
            HumanReadable: resMessage,
            EntryContext: context
        };
    }

    function searchQuery() {
        var res;
        if (version === 'v1') {
            var query = '';
            if (args.query) {
                query = args.query;
            } else {
            // Build Crowd Strike query syntax from arguments, i.e. key:value
                for (var key in args) {
                    if (key === 'verdict') {
                        var verdictNumber = translateVerdict(args[key]);
                        query += key + ':' + verdictNumber + '&';
                        continue;
                    }
                    if (key === 'country' && args[key].length != 3) {
                        throw 'Country ISO code should be 3 characters long'
                    }
                    query += key + ':' + args[key] + '&';
                }
            }
            res = sendRequest('GET', '/api/search?query=' + query);
        } else { //API Version is v2
            HEADERS['Content-Type'] = ['application/x-www-form-urlencoded'];
            body = '';
            if (args.query) {
                args.query.split(',').forEach(function(keyValue){
                   splittedObject = keyValue.split(/:(.+)/); // Split by first ':' only
                   key = splittedObject[0];
                   value = splittedObject[1];
                   body += key + '=' + value + '&'
                });
            } else {
            // Build Crowd Strike query syntax from arguments, i.e. key:value
                for (var key in args) {
                    if (key === 'verdict') {
                        var verdictNumber = translateVerdict(args[key]);
                        body += key + '=' + verdictNumber + '&';
                        continue;
                    }
                    if (key === 'country' && args[key].length != 3) {
                        throw 'Country ISO code should be 3 characters long'
                    }
                    body += key + '=' + args[key] + '&';
                }
            }
            res = sendRequest('POST', '/api/v2/search/terms', body)
        }

        if (version === 'v1' && res.response_code !== 0) {
            return entryError(res.response_code, res.response.error);
        }

        var result = version === 'v1' ? res.response.result : res.result

        // create table from search result
        var tableMapper = {
           environmentDescription: 'environment description',
           start_time: 'start time',
           submitname: 'submit name',
           threatscore: 'threat score',
           type_short: 'type short',
        };

        var table = result.map(mapObject(tableMapper));

        // create context from search result
        var contextMapper;
        var context;
        if (version === 'v1') {
            contextMapper = {
                sha1: 'SHA1',
                sha256: 'SHA256',
                md5: 'MD5',
            };

            context = {
                'File(val.MD5 && val.MD5 == obj.MD5 || val.SHA1 && val.SHA1 == obj.SHA1 || val.SHA256 && val.SHA256 == obj.SHA256)': result.map(mapObject(contextMapper)),
                'VX.Search(val.JobID && val.JobID == obj.JobID || val.SHA256 && val.SHA256 == obj.SHA256)': result.map(mapObject(contextMapper)) //VX.Search context path is for backward compatibility
            };
        } else { // v2
            contextMapper = {
                job_id: 'JobID',
                sha256: 'SHA256',
                environment_id: 'environmentId',
                threat_score: 'threatscore',
                environment_description: 'environmentDescription',
                submit_name: 'submitname',
                analysis_start_time: 'start_time'
            };

            context = {
                'File(val.JobID && val.JobID == obj.JobID || val.SHA256 && val.SHA256 == obj.SHA256)': result.map(mapObject(contextMapper)),
                'VX.Search(val.JobID && val.JobID == obj.JobID || val.SHA256 && val.SHA256 == obj.SHA256)': result.map(mapObject(contextMapper)) //VX.Search context path is for backward compatibility
            };
        }

        result.forEach(function(res) {
           if(res.threatlevel && res.threatlevel > 1) {
               addMalicious(context, outputPaths.file, {
                    MD5: res.md5,
                    SHA1: res.sha1,
                    SHA256: res.sha256,
                    Malicious: {
                        Vendor: 'Falcon Sandbox',
                        Description: 'Score above ' + res.threatscore
                    }
                });
           }
        });

        return createTableEntry('Search results:', result, table, context);
    }

    function translateVerdict(verdict) {
        var verdictNumber;
        switch (verdict) {
            case 'Whitelisted':
                verdictNumber = 1;
                break;
            case 'NoVerdict':
                verdictNumber = 2;
                break;
            case 'NoSpecificThreat':
                verdictNumber = 3;
                break;
            case 'Suspicious':
                verdictNumber = 4;
                break;
            case 'Malicious':
                verdictNumber = 4;
                break;
        }
        return verdictNumber;
    }

    function csResultCmd(hash, environmentId, fileType, jobID) {
        var res = csResult(hash, environmentId, fileType, jobID);

        if (res.response_code !== undefined && res.response_code !== 0) {
            return entryError(res.response_code, res.response.error);
        }

        if (version === 'v2') {
          var fileScan = null;
          if(hash != null){
            var fileScan = scan(hash);
          }
          return resultEntry(res, fileType, fileScan);
        } else {
            return res;
        }
    }

    function csResult(hash, environmentId, fileType, jobID) {
        var csID;
        if (version === 'v2') {
            if (hash && environmentId){
                csID = hash + ':' + environmentId;
            } else if (jobID) {
                csID = jobID;
            } else {
                return 'Job ID or SHA256 and environment ID are required.'
            }
        }
        var cmdUrl = (version === 'v1') ? '/api/result/' + hash + '?type=json&environmentId=' + args.environmentId : '/api/v2/report/' + csID + '/report/' + fileType;
        return sendRequest('GET', cmdUrl);
    }

    function resultEntry(result, fileType, scan) {
        var currentTime = new Date();
        var filename =  'CrowdStrike_report_' + currentTime.getTime();
        switch (fileType) {
            case 'pcap':
            case 'bin':
            case 'xml':
            case 'html':
                filename += '.gz';
                break;
            case 'json':
                filename += '.json';
                result = JSON.stringify(result);
                break;
            case 'misp':
            case 'stix':
                filename += '.xml';
                break;
            case 'pdf':
                filename += '.pdf';
        }
        ec = {}
        if(scan != null){
          ec = {
              DBotScore: {
                  Indicator: scan[0].sha256,
                  Type: 'hash',
                  Vendor: 'CrowdStrike Falcon Sandbox',
                  Score: translateScore(scan[0]['threat_level'])
              }
          }
        }
        return {
            Type: 9,
            FileID: saveFile(result),
            File: filename,
            Contents: filename,
            EntryContext: ec
        };
    }

    function translateScore(score) {
        /* Translates CS threat level to DBot Score */
        var scoreObject = {
            3: 0,
            2: 3,
            1: 2,
            0: 1
        }
        if (score in scoreObject) {
            return scoreObject[score];
        } else {
            return 0;
        }
    }

    function detonateFile(entryId, delay, timeout) {
        var environmentId;
        if (args.environmentID) {
            environmentId = args.environmentID;
        } else {
            var environments = getEnvironments();
            if(version === 'v1'){
                if ('environment' in environments) { // Single-server setup
                    environments = environments.environment;
                } else { // Multi-server setup
                    environments = environments.backend.global_environment;
                }
            }
            for (var i=0; i<environments.length; i++) {
                if (environments[i]['ID'] === 100) {
                    environmentId = 100;
                    break;
                 } else if (environments[i]['architecture'].toLowerCase() === 'windows') {
                    environmentId = environments[i]['ID'];
                    break;
                }
            }
        }
        if (!environmentId) {
            throw 'No environment ID was given'
        }
        var file = submitFile(entryId, environmentId.toString());
        var hash = file.SHA256;

        delayTime = parseInt(delay);
        timeOut = parseInt(timeout);
        var waitTime = delayTime;

        wait(delayTime);
        while (waitTime<timeOut) {
            var res = scan(hash);
            if ((version === 'v1' && res.response.length > 0 && res.response[0]) || (version === 'v2' && res.length > 0)) {
                return scanToEntry(res, hash);
            } else {
                waitTime = waitTime + delayTime;
                wait(delayTime);
            }
        }
        throw ('Timeout due to no answer after ' + timeOut + ' seconds.');
    }

    function submitUrlCmd(url, environmentID, dontThrowErrorOnFileDetonation) {
        if (version === 'v1') {
            throw 'This command is supported only in API v2.'
        }
        try {
          var response = submitUrl(url, environmentID);
        } catch (exception) {
              var notSupported = 'The provided URL resolves to a file.'
              if (dontThrowErrorOnFileDetonation && exception.contains(notSupported)){
                  return 'The file format is not supported, use the command "crowdstrike-submit-file-by-url" instead.';
              } else {
                  throw exception;
              }
        }
        var context = {
            'File(val.hash && val.hash === obj.hash)': {
                'SHA256': response['sha256'],
                'hash': response['sha256']
            },
            'CrowdStrike(val.JobID && val.JobID === obj.JobID)': {
                'EnvironmentID': response['environment_id'],
                'JobID': response['job_id']
            }
        };
        var title = 'URL ' + url + ' was submitted for analysis on CrowdStrike Falcon Sandbox';
        return createTableEntry(title, response, response, context);
    }

    function submitUrl(url, environmentID) {
        var cmdUrl = '/api/v2/submit/url-for-analysis';
        var body = 'url=' + encodeURIComponent(url) + '&environment_id=' + environmentID;
        HEADERS['Content-Type'] = ['application/x-www-form-urlencoded'];
        return sendRequest('POST', cmdUrl, body);
    }

    function getScreenshotsCmd(file, environmentID, jobID) {
        if (version === 'v1') {
            throw 'This command is supported only in API v2.'
        }
        var response = getScreenshots(file, environmentID, jobID);
        var images = [];
        for (var i = 0; i < response.length; i++) {
            images.push({
                Type: entryTypes.note,
                ContentsFormat: formats.json,
                Contents: '',
                ReadableContentsFormat: formats.markdown,
                HumanReadable: '![](data:image/png;base64,' + response[i]['image'] + ')'
            });
        }
        return images
    }

    function getScreenshots(file, environmentID, jobID) {
        var csID;
        if (file && environmentID){
            csID = file + ':' + environmentID;
        } else if (jobID) {
            csID = jobID;
        } else {
            return 'Job ID or SHA256 and environment ID are required.'
        }
        var cmdUrl = '/api/v2/report/' + csID +'/screenshots';
        return sendRequest('GET', cmdUrl);
    }

    function file(hash) {
        args.context = hash;
        delete args.file;
        return searchQuery();
    }

    function detonateUrl(url, delay, timeout, fileType) {
        if (version === 'v1') {
            throw 'This command is supported only in API v2.'
        }
        var environmentId;
        if (args.environmentID) {
            environmentId = args.environmentID;
        } else {
            var environments = getEnvironments();
            if(version === 'v1'){
                if ('environment' in environments) { // Single-server setup
                    environments = environments.environment;
                } else { // Multi-server setup
                    environments = environments.backend.global_environment;
                }
            }
            for (var i=0; i<environments.length; i++) {
                if (environments[i]['ID'] === 100) {
                    environmentId = 100;
                    break;
                 } else if (environments[i]['architecture'].toLowerCase() === 'windows') {
                    environmentId = environments[i]['ID'];
                    break;

                }
            }
        }
        if (!environmentId) {
            throw 'No environment ID was given'
        }
        var jobId = submitUrl(url, environmentId);
        delayTime = parseInt(delay);
        timeOut = parseInt(timeout);
        var waitTime = delayTime;

        wait(delayTime);
        while (waitTime<timeOut) {
            if (response) {
                var response = csResult(null, environmentId, fileType, jobId);
                return resultEntry(response, fileType);
            } else {
                waitTime = waitTime + delayTime;
                wait(delayTime);
            }
        }
        throw ('Timeout due to no answer after ' + timeOut + ' seconds.');
    }

    function submitFileByUrlCommad(url, environmentID) {
        if (version === 'v1') {
            throw 'This command is supported only in API v2.'
        }
        var response = submitFileByUrl(url, environmentID);
        var context = {
            'File(val.SHA256 && val.SHA256 === obj.SHA256)': {
                'SHA256': response['sha256']
            },
            'CrowdStrike(val.JobID && val.JobID === obj.JobID)': {
                'EnvironmentID': response['environment_id'],
                'JobID': response['job_id']
            }
        };
        var title = 'File ' + url + ' was submitted for analysis on CrowdStrike Falcon Sandbox';
        return createTableEntry(title, response, response, context);
    }

    function submitFileByUrl(url, environmentID) {
        var cmdUrl = '/api/v2/submit/url-to-file';
        var body = 'url=' + url + '&environment_id=' + environmentID;
        HEADERS['Content-Type'] = ['application/x-www-form-urlencoded'];
        return sendRequest('POST', cmdUrl, body);
    }

    switch (command) {
        case 'test-module':
            args.query = 'url:google';
            var entry = searchQuery();
            if (entry && entry.Type === entryTypes.note) {
               return 'ok';
            }
            return entry && entry.Contents;
        case 'vx-scan': // Deprecated
        case 'crowdstrike-scan':
            var res = scan(args.file);
            if (res.length > 0){
                return scanToEntry(res, args.file);
            } else {
                return {
                    Type: entryTypes.note,
                    ContentsFormat: formats.json,
                    Contents: {},
                    ReadableContentsFormat: formats.markdown,
                    HumanReadable: 'No results found.',
                    EntryContext: {
                        "File(val.hash==obj.hash)": {
                        "state": "NO_CONTENT",
                        "hash": args.file
                        }
                    }
                };
            }
        case 'vx-get-environments': // Deprecated
        case 'crowdstrike-get-environments':
            var response = getEnvironments();
            return tableFromEnvironments(response);
        case 'vx-submit-sample': // Deprecated
        case 'crowdstrike-submit-sample':
            var entry = submitFile(args.entryId, args.environmentID);
            // return entry if type is error
            if ('Type' in entry && entry['Type'] === entryTypes.error) {
                return entry;
            }
            return submitFileEntry(entry);
        case 'vx-search': // Deprecated
        case 'crowdstrike-search':
            return searchQuery();
        case 'vx-result': // Deprecated
        case 'crowdstrike-result':
            return csResultCmd(args.file, args.environmentId, args['file-type'], args.JobID);
        case 'vx-detonate-file': // Deprecated
        case 'crowdstrike-detonate-file':
            return detonateFile(args.entryId, args.delay, args.timeout);
        case 'crowdstrike-submit-url':
            return submitUrlCmd(args.url, args.environmentID, argToBool(args.dontThrowErrorOnFileDetonation));
        case 'crowdstrike-get-screenshots':
            return getScreenshotsCmd(args.file, args.environmentID, args.JobID);
        case 'file':
            return file(args.file);
        case 'crowdstrike-detonate-url':
            return detonateUrl(args.url, args.delay, args.timeout, args['file-type']);
        case 'crowdstrike-submit-file-by-url':
            return submitFileByUrlCommad(args.url, args.environmentID);
    }

  type: javascript
  commands:
  - name: vx-scan
    deprecated: true
    arguments:
    - name: file
      required: true
      default: true
      description: File hash (MD5, SHA1 or SHA256)
    outputs:
    - contextPath: File.SHA256
      description: SHA256 of the file
      type: string
    - contextPath: File.SHA1
      description: SHA1 of the file
      type: string
    - contextPath: File.MD5
      description: MD5 of the file
      type: string
    - contextPath: File.environmentId
      description: 'Environment id of the file '
      type: number
    - contextPath: File.analysis_start_time
      description: Analysis start time of the file
      type: string
    - contextPath: File.submitname
      description: Submission name of the file
      type: string
    - contextPath: File.classification_tags
      description: List of classification tags of the file
    - contextPath: File.vxfamily
      description: Family classification of the file
      type: string
    - contextPath: File.total_network_connections
      description: Total network connections of the file
      type: number
    - contextPath: File.total_processes
      description: Total processes count of the file
      type: number
    - contextPath: File.total_signatures
      description: Total signatures count if the file
      type: number
    - contextPath: File.hosts
      description: List of file's hosts
    - contextPath: File.isinteresting
      description: If server found this file interesting
      type: boolean
    - contextPath: File.domains
      description: List of file's related domains
    - contextPath: File.isurlanalysis
      description: If file analyzed by url
      type: boolean
    - contextPath: File.Malicious.Vendor
      description: or malicious files, the vendor that made the decision
      type: string
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason for the vendor to make the decision
      type: string
    description: Get summary information for a given MD5, SHA1 or SHA256 and all the
      reports generated for any environment ID
  - name: crowdstrike-scan
    arguments:
    - name: file
      required: true
      default: true
      description: File hash (MD5, SHA1 or SHA256)
    outputs:
    - contextPath: File.SHA256
      description: SHA256 of the file
      type: string
    - contextPath: File.SHA1
      description: SHA1 of the file
      type: string
    - contextPath: File.MD5
      description: MD5 of the file
      type: string
    - contextPath: File.environmentId
      description: Environment id of the file
      type: string
    - contextPath: File.analysis_start_time
      description: Analysis start time of the file
      type: string
    - contextPath: File.submitname
      description: Submission name of the file
      type: string
    - contextPath: File.classification_tags
      description: List of classification tags of the file
    - contextPath: File.vxfamily
      description: Family classification of the file
      type: string
    - contextPath: File.total_network_connections
      description: Total network connections of the file
      type: number
    - contextPath: File.total_processes
      description: Total processes count of the file
      type: number
    - contextPath: File.total_signatures
      description: Total signatures count if the file
      type: number
    - contextPath: File.hosts
      description: List of file's hosts
    - contextPath: File.isinteresting
      description: If server found this file interesting
      type: boolean
    - contextPath: File.domains
      description: List of file's related domains
    - contextPath: File.isurlanalysis
      description: If file analyzed by url
      type: boolean
    - contextPath: File.Malicious.Vendor
      description: or malicious files, the vendor that made the decision
      type: string
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason for the vendor to make the decision
      type: string
    - contextPath: DBotScore.Indicator
      description: The indicator we tested
      type: string
    - contextPath: DBotScore.Type
      description: The type of the indicator
      type: string
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score
      type: string
    - contextPath: DBotScore.Score
      description: The actual score
      type: number
    - contextPath: File.hash
      description: The hash used to query the file
      type: string
    - contextPath: File.state
      description: The state of the file test
      type: string
    description: Get summary information for a given MD5, SHA1 or SHA256 and all the
      reports generated for any environment ID
  - name: vx-get-environments
    deprecated: true
    arguments: []
    outputs:
    - contextPath: VX.Environment.ID
      description: Environment id
    - contextPath: VX.Environment.description
      description: Environment description
    - contextPath: VX.Environment.architecture
      description: Environment architecture
    - contextPath: VX.Environment.VMs_total
      description: Total virtual machines in environment
    - contextPath: VX.Environment.VMs_busy
      description: Busy virtual machines in environment
    - contextPath: VX.Environment.analysisMode
      description: Analysis mode of environment
    - contextPath: VX.Environment.groupicon
      description: Icon of environment
    description: Get a list of all available environments
  - name: crowdstrike-get-environments
    arguments: []
    outputs:
    - contextPath: CrowdStrike.Environment.ID
      description: Environment ID
      type: number
    - contextPath: CrowdStrike.Environment.description
      description: Environment description
      type: string
    - contextPath: CrowdStrike.Environment.architecture
      description: Environment architecture
      type: string
    - contextPath: CrowdStrike.Environment.VMs_total
      description: Total virtual machines in environment
      type: number
    - contextPath: CrowdStrike.Environment.VMs_busy
      description: Busy virtual machines in environment
      type: number
    - contextPath: CrowdStrike.Environment.analysisMode
      description: 'Analysis mode of environment '
      type: string
    - contextPath: CrowdStrike.Environment.groupicon
      description: Icon of environment
      type: string
    description: Get a list of all available environments
  - name: vx-submit-sample
    deprecated: true
    arguments:
    - name: entryId
      required: true
      default: true
      description: War-room entry ID of sample file
    - name: environmentId
      description: Environment ID to submit file to (get all IDs via crowdstrike-get-environments)
      defaultValue: "100"
    description: Submit a file from investigation to analysis server
  - name: crowdstrike-submit-sample
    arguments:
    - name: entryId
      required: true
      default: true
      description: War-room entry ID of sample file
    - name: environmentID
      required: true
      description: Environment ID to submit file to (get all IDs via crowdstrike-get-environments)
      defaultValue: "100"
    outputs:
    - contextPath: File.SHA256
      description: File SHA256 hash
      type: string
    - contextPath: File.MD5
      description: File MD5 hash
      type: string
    - contextPath: File.SHA1
      description: File SHA1 hash
      type: string
    - contextPath: CrowdStrike.JobID
      description: Sample job ID
      type: string
    - contextPath: CrowdStrike.EnvironmentID
      description: Sample environment ID
      type: number
    description: Submit a file from investigation to analysis server
  - name: vx-search
    deprecated: true
    arguments:
    - name: query
      required: true
      default: true
      description: Falcon Sandbox query syntax (see `<server url>/faq#advanced-search-options`
        for more details). examples -  url:google, host:95.181.53.78
    outputs:
    - contextPath: VX.Search.SHA256
      description: SHA256 of search result
    - contextPath: VX.Search.SHA1
      description: SHA1of search result
    - contextPath: VX.Search.MD5
      description: MD5 of search result
    - contextPath: VX.Search.environmentId
      description: Environment Id of search result
    - contextPath: VX.Search.start_time
      description: Start time of search result
    - contextPath: VX.Search.threatscore
      description: Threat score of search result by server
    - contextPath: VX.Search.verdict
      description: Verdict of search result
    - contextPath: VX.Search.environmentDescription
      description: Environment description of search result
    - contextPath: VX.Search.submitname
      description: Submission name of search result
    - contextPath: VX.Search.vxfamily
      description: Family of search result
    - contextPath: VX.Search.threatscore
      description: Threat score of search result
    - contextPath: VX.Search.type_short
      description: type of search result (url, host, etc.)
    - contextPath: VX.Search.size
      description: Size of search result
    - contextPath: File.Malicious.Vendor
      description: or malicious files, the vendor that made the decision
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason for the vendor to make the decision
    description: Search the database using the Falcon Sandbox search syntax
  - name: crowdstrike-search
    arguments:
    - name: query
      default: true
      description: Falcon Sandbox query syntax, e.g. url:google,host:95.181.53.78.
        This argument integrates all other arguments to one, and cannot be given along
        with the other arguments.
    - name: filename
      description: Filename e.g. invoice.exe
    - name: filetype
      description: Filetype e.g. docx
    - name: filetype_desc
      description: Filetype description e.g. PE32 executable
    - name: env_id
      description: Environment Id
    - name: country
      description: Country (3 digit ISO) e.g. swe, usa, fra
    - name: verdict
      auto: PREDEFINED
      predefined:
      - Whitelisted
      - NoVerdict
      - NoSpecificThreat
      - Suspicious
      - Malicious
      description: 'Verdict '
    - name: av_detect
      description: AV Multiscan range e.g. 50-70 (min 0, max 100)
    - name: vx_family
      description: AV Family Substring e.g. nemucod
    - name: tag
      description: Hashtag e.g. ransomware
    - name: port
      description: Port e.g. 8080
    - name: host
      description: Host e.g. 192.168.0.1
    - name: domain
      description: Domain e.g. checkip.dyndns.org
    - name: url
      description: HTTP Request Substring e.g. google
    - name: similar_to
      description: Similar Samples e.g. <sha256>
    - name: context
      description: Sample Context e.g. <sha256>
    - name: imp_hash
      description: Import Hash
    - name: ssdeep
      description: SSDeep
    - name: authentihash
      description: Authentication Hash
    outputs:
    - contextPath: File.SHA256
      description: SHA256 of search result
      type: string
    - contextPath: File.SHA1
      description: SHA1of search result
      type: string
    - contextPath: File.MD5
      description: MD5 of search result
      type: string
    - contextPath: File.environmentId
      description: Environment Id of search result
      type: number
    - contextPath: File.start_time
      description: Start time of search result
    - contextPath: File.threatscore
      description: Threat score of search result by server
      type: string
    - contextPath: File.verdict
      description: Verdict of search result
      type: string
    - contextPath: File.environmentDescription
      description: Environment description of search result
      type: string
    - contextPath: File.submitname
      description: Submission name of search result
      type: string
    - contextPath: File.vxfamily
      description: Family of search result
      type: string
    - contextPath: File.threatscore
      description: Threat score of search result
      type: number
    - contextPath: File.type_short
      description: type of search result (url, host, etc.)
      type: string
    - contextPath: File.size
      description: Size of search result
      type: number
    - contextPath: File.Malicious.Vendor
      description: or malicious files, the vendor that made the decision
      type: string
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason for the vendor to make the decision
      type: string
    description: Search the database using the Falcon Sandbox search syntax
  - name: vx-result
    deprecated: true
    arguments:
    - name: file
      required: true
      default: true
      description: File hash (MD5, SHA1 or SHA256)
    - name: environmentId
      description: environment ID to submit file to(get all via crowdstrike-get-environments)
    description: Retrieve result data upon a file. NOTE - This command returns a file
  - name: crowdstrike-result
    arguments:
    - name: file
      default: true
      description: File hash (MD5, SHA1 or SHA256) - Mandatory in v1
    - name: environmentId
      description: environment ID to submit file to (get all via crowdstrike-get-environments)  -
        Mandatory in v1.
      defaultValue: "100"
    - name: file-type
      auto: PREDEFINED
      predefined:
      - xml
      - json
      - html
      - pdf
      - stix
      - misp
      - bin
      - pcap
      description: File type of report to return (supported only in v2)
      defaultValue: pdf
    - name: JobID
      description: Job ID of file to generate report of (supported only in v2)
    outputs:
    - contextPath: DBotScore.Indicator
      description: The indicator we tested
      type: string
    - contextPath: DBotScore.Type
      description: The type of the indicator
      type: string
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score
      type: string
    - contextPath: DBotScore.Score
      description: The actual score
      type: number
    description: Retrieve result data upon a file. NOTE - This command returns a file
  - name: vx-detonate-file
    deprecated: true
    arguments:
    - name: entryId
      required: true
      description: War-room entry ID of sample file
    - name: environmentID
      description: environment ID to submit file to(get all via crowdstrike-get-environments).
        Default is 100, or other WINDOWS ID
    - name: delay
      description: Delay wait time between calls (in seconds)
      defaultValue: "3"
    - name: timeout
      description: Total wait time (in seconds)
      defaultValue: "60"
    description: (Deprecated - Please use CrowdStrike Falcon Sandbox - Detonate file playbook instead) Detonate file through Falcon Sandbox
  - name: crowdstrike-detonate-file
    deprecated: true
    arguments:
    - name: entryId
      required: true
      description: War-room entry ID of sample file
    - name: environmentID
      description: environment ID to submit file to(get all via crowdstrike-get-environments).
        Default is 100, or other WINDOWS ID
    - name: delay
      description: Delay wait time between calls (in seconds)
      defaultValue: "3"
    - name: timeout
      description: Total wait time (in seconds)
      defaultValue: "60"
    outputs:
    - contextPath: File.SHA256
      description: SHA256 of the file
      type: string
    - contextPath: File.SHA1
      description: SHA1 of the file
      type: string
    - contextPath: File.MD5
      description: MD5 of the file
      type: string
    - contextPath: File.environmentId
      description: Environment id of the file
      type: string
    - contextPath: File.analysis_start_time
      description: Analysis start time of the file
      type: string
    - contextPath: File.submitname
      description: Submission name of the file
      type: string
    - contextPath: File.classification_tags
      description: List of classification tags of the file
    - contextPath: File.vxfamily
      description: Family classification of the file
      type: string
    - contextPath: File.total_network_connections
      description: Total network connections of the file
      type: number
    - contextPath: File.total_processes
      description: Total processes count of the file
      type: number
    - contextPath: File.total_signatures
      description: Total signatures count if the file
      type: number
    - contextPath: File.hosts
      description: List of file's hosts
    - contextPath: File.isinteresting
      description: If server found this file interesting
      type: boolean
    - contextPath: File.domains
      description: List of file's related domains
    - contextPath: File.isurlanalysis
      description: If file analyzed by url
      type: boolean
    - contextPath: File.Malicious.Vendor
      description: or malicious files, the vendor that made the decision
      type: string
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason for the vendor to make the decision
      type: string
    - contextPath: DBotScore.Indicator
      description: The indicator we tested
      type: string
    - contextPath: DBotScore.Type
      description: The type of the indicator
      type: string
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score
      type: string
    - contextPath: DBotScore.Score
      description: The actual score
      type: number
    description: (Deprecated - Please use CrowdStrike Falcon Sandbox - Detonate file playbook instead) Detonate file through Falcon Sandbox
  - name: crowdstrike-submit-url
    arguments:
    - name: url
      required: true
      description: URL to analyze
    - name: environmentID
      required: true
      description: Environment ID to submit URL to
      defaultValue: "100"
    - name: dontThrowErrorOnFileDetonation
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Not throwing an error when sending a URL, which points to a file.
      defaultValue: "false"
    outputs:
    - contextPath: File.SHA256
      description: File SHA256
      type: string
    - contextPath: CrowdStrike.EnvironmentID
      description: Environment ID in which the URL was analysed
      type: string
    - contextPath: CrowdStrike.JobID
      description: Job ID of URL analysation
      type: string
    description: Submit a URL for analysis (Supported only in v2)
  - name: crowdstrike-get-screenshots
    arguments:
    - name: file
      description: File hash (SHA256) to retrieve screenshots of
    - name: environmentID
      description: environment ID to retrieve screenshots from
      defaultValue: "100"
    - name: JobID
      description: Job ID to retrieve screenshots of
    outputs:
    - contextPath: File.SHA256
      description: SHA256 of search result
      type: string
    - contextPath: File.SHA1
      description: SHA1of search result
      type: string
    - contextPath: File.MD5
      description: MD5 of search result
      type: string
    - contextPath: File.environmentId
      description: Environment Id of search result
      type: number
    - contextPath: File.start_time
      description: Start time of search result
    - contextPath: File.threatscore
      description: Threat score of search result by server
      type: string
    - contextPath: File.verdict
      description: Verdict of search result
      type: string
    - contextPath: File.environmentDescription
      description: Environment description of search result
      type: string
    - contextPath: File.submitname
      description: Submission name of search result
      type: string
    - contextPath: File.vxfamily
      description: Family of search result
      type: string
    - contextPath: File.threatscore
      description: Threat score of search result
      type: number
    - contextPath: File.type_short
      description: type of search result (url, host, etc.)
      type: string
    - contextPath: File.size
      description: Size of search result
      type: number
    - contextPath: File.Malicious.Vendor
      description: or malicious files, the vendor that made the decision
      type: string
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason for the vendor to make the decision
      type: string
    description: ' Retrieves screenshots from a report (Supported only in v2)'
  - name: crowdstrike-detonate-url
    deprecated: true
    arguments:
    - name: url
      required: true
      description: 'URL address to be submitted '
    - name: environmentID
      description: Environment ID to submit URL to (get all via crowdstrike-get-environments).
        Default is 100, or other WINDOWS ID
      defaultValue: "100"
    - name: delay
      description: Delay wait time between calls (in seconds)
      defaultValue: "3"
    - name: timeout
      description: Total wait time (in seconds)
      defaultValue: "60"
    - name: file-type
      auto: PREDEFINED
      predefined:
      - xml
      - json
      - html
      - pdf
      - stix
      - misp
      - bin
      - pcap
      description: File type of report to return
      defaultValue: pdf
    outputs:
    - contextPath: DBotScore.Indicator
      description: The indicator we tested
      type: string
    - contextPath: DBotScore.Type
      description: The type of the indicator
      type: string
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score
      type: string
    - contextPath: DBotScore.Score
      description: The actual score
      type: number
    description: "(Deprecated - Please use CrowdStrike Falcon Sandbox - Detonate URL playbook instead)
    Detonates URL address through Falcon Sandbox (supported only in v2)"
  - name: crowdstrike-submit-file-by-url
    arguments:
    - name: environmentID
      description: Environment ID to submit file to (get all IDs via crowdstrike-get-environments)
      defaultValue: "100"
    - name: url
      required: true
      description: URL of file to submit.
    outputs:
    - contextPath: File.SHA256
      description: File SHA256
      type: string
    - contextPath: CrowdStrike.EnvironmentID
      description: Environment ID in which the file was analysed
      type: string
    - contextPath: CrowdStrike.JobID
      description: Job ID of file analysation
      type: string
    description: Submit a file by URL for analysis (Supported only in v2).
  runonce: false
tests:
- VxStream Test
- detonate_file_-_generic_test
fromversion: 5.0.0
