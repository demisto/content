id: Test Playbook - WildFire Malware
version: -1
name: Test Playbook - WildFire Malware
description: |-
  This playbook tests the ‘WildFire Malware’ playbook which is part of the ‘Core - Investigation and Response’ pack.

  The following tests are conducted in the playbook:
  1- Confirm that the parent incident fields are populated.
  2- Ensure that the context data is correctly extracted.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 1906ae93-d78f-49ac-8336-a45189828484
    type: start
    task:
      id: 1906ae93-d78f-49ac-8336-a45189828484
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "1"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 40
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: b57186ee-d705-4640-8fd4-f7319f3b6cf9
    type: regular
    task:
      id: b57186ee-d705-4640-8fd4-f7319f3b6cf9
      version: -1
      name: Delete Context
      description: |-
        Delete field from context.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        - For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations 
        - For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script
        - For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "2"
    scriptarguments:
      all:
        simple: "yes"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 170
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: f9469a45-4e52-4db0-806a-361837f7f17e
    type: regular
    task:
      id: f9469a45-4e52-4db0-806a-361837f7f17e
      version: -1
      name: Get Endpoints
      description: Gets a list of endpoints, according to the passed filters. If there are no filters, all endpoints are returned. Filtering by multiple fields will be concatenated using AND condition (OR is not supported). Maximum result set size is 100. Offset is the zero-based number of endpoint from the start of the result set (start by counting from 0).
      script: Cortex Core - IR|||core-get-endpoints
      type: regular
      iscommand: true
      brand: Cortex Core - IR
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      alias_name:
        simple: TestPlaybook
      status:
        simple: connected
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 330
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: db14ae22-11a6-42a6-8150-b94ecca40fae
    type: condition
    task:
      id: db14ae22-11a6-42a6-8150-b94ecca40fae
      version: -1
      name: Is the EndpointID defined?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "4"
      "yes":
      - "5"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: Core.Endpoint
                accessor: endpoint_id
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 490
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: 174c8aae-0996-4cfa-8bdc-a11cdfc83f7e
    type: regular
    task:
      id: 174c8aae-0996-4cfa-8bdc-a11cdfc83f7e
      version: -1
      name: Get Endpoints Error - No Available Endpoint
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: "No available connected endpoints were found. \nThis may indicate that the following changes were made to this test playbook.\n1- The 'alias_name' input configuration was changed for the 'core-get-endpoints' automation used in the 'Get Endpoints' task. The 'alias_name' input value should be 'TestPlaybook'."
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 830,
          "y": 660
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: 8ad715ab-d3ab-4f12-88f3-c6d560d1459a
    type: regular
    task:
      id: 8ad715ab-d3ab-4f12-88f3-c6d560d1459a
      version: -1
      name: Set Alert Fields
      description: commands.local.cmd.set.incident
      script: Builtin|||setAlert
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "6"
    scriptarguments:
      domainname:
        simple: malicious domain
      filesha256:
        simple: 000001e7a228b2a7abdf7f7e404bc8522df32b725e86907dde32176bccbbbb27
      hostip:
        complex:
          root: Endpoint
          accessor: IPAddress
          transformers:
          - operator: FirstArrayElement
      name:
        simple: WildFire Malware
      url:
        simple: malicious URL
      username:
        complex:
          root: Account
          accessor: Username
          transformers:
          - operator: FirstArrayElement
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: c5bddcef-040a-49ad-8b82-d1fcc46e704e
    type: playbook
    task:
      id: c5bddcef-040a-49ad-8b82-d1fcc46e704e
      version: -1
      name: WildFire Malware
      description: |-
        This playbook handles WildFire Malware alerts.
        It performs enrichment on the different alert entities and establishes a verdict.
        For a possible true positive alert, the playbook performs further investigation for related IOCs and executes a containment plan.
      playbookName: WildFire Malware
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      AutoContainment:
        simple: "true"
      AutoRecovery:
        simple: "False"
      BlockIndicators:
        simple: "false"
      CommentToAdd:
        simple: '${alert.name}. Alert ID: ${alert.id}'
      FileRemediation:
        simple: Quarantine
      GraywarePhishingAsMalware:
        simple: "true"
      HostAutoContainment:
        simple: "true"
      OriginalFileContainment:
        simple: "true"
      Query:
        complex:
          root: alert
          transformers:
          - operator: If-Then-Else
            args:
              condition:
                value:
                  simple: lhs!=rhs
              conditionB: {}
              conditionInBetween: {}
              else:
                value:
                  simple: ${alert= 'initiatorsha256:"' + val.initiatorsha256 + '" and sourceBrand:"' + val.sourceBrand + '" and name:"' + val.name + '"'}
              equals: {}
              lhs:
                value:
                  simple: alert.filesha256
                iscontext: true
              lhsB: {}
              options: {}
              optionsB: {}
              rhs: {}
              rhsB: {}
              then:
                value:
                  simple: ${alert= '(filesha256:"' + val.filesha256 + '" and sourceBrand:"' + val.sourceBrand + '" and name:"' + val.name + '"'}
      RelatedFileContainment:
        simple: "true"
      ShouldCloseAutomatically:
        simple: "False"
      ShouldOpenTicket:
        simple: "False"
      ZendeskSubject:
        simple: XSIAM Incident ID - ${parentIncidentFields.incident_id}
      addCommentPerEndpoint:
        simple: "True"
      description:
        simple: ${parentIncidentFields.description}. ${parentIncidentFields.xdr_url}
      serviceNowShortDescription:
        simple: XSIAM Incident ID - ${parentIncidentFields.incident_id}
      sha256:
        complex:
          root: alert
          transformers:
          - operator: DT
            args:
              dt:
                value:
                  simple: .=pickvalue(val);function pickvalue(x){if(x.initiatorsha256){return x.initiatorsha256} else {return x.filesha256}}
    separatecontext: false
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 450,
          "y": 930
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: 9d9810a7-b1b7-4092-83fb-7cf1fd3b809e
    type: title
    task:
      id: 9d9810a7-b1b7-4092-83fb-7cf1fd3b809e
      version: -1
      name: Start Tests
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "11"
      - "13"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1090
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: d95fae12-67c7-4c6e-8659-191bd42ec28b
    type: title
    task:
      id: d95fae12-67c7-4c6e-8659-191bd42ec28b
      version: -1
      name: Check Parent Incident Fields
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "14"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 670,
          "y": 1230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: 019493c2-13ec-4792-811f-667a91f8b33e
    type: title
    task:
      id: 019493c2-13ec-4792-811f-667a91f8b33e
      version: -1
      name: Check Context Data
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "16"
      - "18"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 250,
          "y": 1230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "14":
    id: "14"
    taskid: 45953a2b-bc02-4a44-8854-7f4496418066
    type: condition
    task:
      id: 45953a2b-bc02-4a44-8854-7f4496418066
      version: -1
      name: Verify Manual Severity
      description: Verify that the ‘manual_severity’ parent incident field was filled out correctly.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "15"
      "yes":
      - "22"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: parentIncidentFields
                accessor: manual_severity
            iscontext: true
          right:
            value:
              simple: high
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 670,
          "y": 1370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "15":
    id: "15"
    taskid: 285f6a88-dc61-4632-8d89-cc6be4216966
    type: regular
    task:
      id: 285f6a88-dc61-4632-8d89-cc6be4216966
      version: -1
      name: Verify Parent Incident Field Error - Manual Severity
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: |-
          The 'manual_severity' parent incident field was not set correctly. This may indicate that the following change has been made to the 'WildFire Malware' playbook:
          1- The 'manual_severity' input configuration was changed for the 'setParentIncidentFields' automation used in the 'Set Alert Severity to High' task (task number 134).
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 670,
          "y": 1555
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 9507ef9a-8342-4e63-8711-de6db0bf2739
    type: condition
    task:
      id: 9507ef9a-8342-4e63-8711-de6db0bf2739
      version: -1
      name: Verify Last Day Time Now Unix
      description: Verify that the ‘LastDayTimeNowUnix’ context key was extracted correctly.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "17"
      "yes":
      - "22"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: LastDayTimeNowUnix
            iscontext: true
          right:
            value: {}
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 250,
          "y": 1370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: ec8425ad-1998-4295-81e5-07664f0dce93
    type: regular
    task:
      id: ec8425ad-1998-4295-81e5-07664f0dce93
      version: -1
      name: Verify Context Error - Last Day Time Now Unix
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: |-
          The 'LastDayTimeNowUnix' context key was not extracted properly. This may indicate that the following change has been made to the 'WildFire Malware' playbook:
          1- The 'contextKey' input configuration was changed for the 'GetTime' automation used in the 'Get time for the last day' task.
          2- The 'daysAgo' input configuration was changed for the 'GetTime' automation used in the 'Get time for the last day' task.
          3- The 'GetTime' automation outputs have been modified and no longer contain the 'LastDayTimeNowUnix' context key.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 250,
          "y": 1555
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: c9a27918-c5b5-401b-87cf-87a4086a659b
    type: condition
    task:
      id: c9a27918-c5b5-401b-87cf-87a4086a659b
      version: -1
      name: Verify Last Day Time Now
      description: Verify that the ‘LastDayTimeNow’ context key was extracted correctly.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "19"
      "yes":
      - "22"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: LastDayTimeNow
            iscontext: true
          right:
            value: {}
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -150,
          "y": 1370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: ab1126d2-9ea3-4587-85f3-562d2eff7c80
    type: regular
    task:
      id: ab1126d2-9ea3-4587-85f3-562d2eff7c80
      version: -1
      name: Verify Context Error - Last Day Time Now
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: |-
          The 'LastDayTimeNow' context key was not extracted properly. This may indicate that the following change has been made to the 'WildFire Malware' playbook:
          1- The 'contextKey' input configuration was changed for the 'GetTime' automation used in the 'Get time for the last day' task.
          2- The 'daysAgo' input configuration was changed for the 'GetTime' automation used in the 'Get time for the last day' task.
          3- The 'GetTime' automation outputs have been modified and no longer contain the 'LastDayTimeNow' context key.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -150,
          "y": 1555
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: a6f0fb56-71ab-4789-84bf-b29c3341b904
    type: title
    task:
      id: a6f0fb56-71ab-4789-84bf-b29c3341b904
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1120,
          "y": 1555
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "14_22_yes": 0.3,
      "16_22_yes": 0.1,
      "18_22_yes": 0.1
    },
    "paper": {
      "dimensions": {
        "height": 1610,
        "width": 1650,
        "x": -150,
        "y": 40
      }
    }
  }
inputs: []
outputs: []
tests:
- No tests (auto formatted)
fromversion: 6.6.0
marketplaces:
- platform
- marketplacev2