id: WildFire Malware
version: -1
name: WildFire Malware
"marketplaces": [
    "marketplacev2"
]
description: |-
  This playbook handles WildFire Malware alerts.
  It performs enrichment on the different alert entities and establishes a verdict.
  For a possible true positive alert, the playbook performs further investigation for related IOCs and executes a containment plan.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 11a57176-6631-4746-8d87-2c8d5ac617b2
    type: start
    task:
      id: 11a57176-6631-4746-8d87-2c8d5ac617b2
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "110"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -310,
          "y": -1360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "3":
    id: "3"
    taskid: d5eba40e-7195-481c-88d7-af5f92d29173
    type: condition
    task:
      id: d5eba40e-7195-481c-88d7-af5f92d29173
      version: -1
      name: Was the malware prevented? (blocked)
      description: Is there a WildFire Post-Detection alert?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "121"
      "Yes":
      - "36"
    separatecontext: false
    conditions:
    - label: "Yes"
      condition:
      - - operator: containsGeneral
          left:
            value:
              simple: alert.action
            iscontext: true
          right:
            value:
              simple: PREVENTED
        - operator: isEqualString
          left:
            value:
              simple: alert.action
            iscontext: true
          right:
            value:
              simple: BLOCKED
    view: |-
      {
        "position": {
          "x": 170,
          "y": -590
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "25":
    id: "25"
    taskid: a9d14fb6-20de-4c18-85cf-f1dd7ad1d84d
    type: title
    task:
      id: a9d14fb6-20de-4c18-85cf-f1dd7ad1d84d
      version: -1
      name: Investigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "122"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -140,
          "y": 1460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "33":
    id: "33"
    taskid: e249e98d-3fb1-4355-8097-9b47893a41ad
    type: title
    task:
      id: e249e98d-3fb1-4355-8097-9b47893a41ad
      version: -1
      name: Pre-Investigation Containment
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "131"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 730,
          "y": -60
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "36":
    id: "36"
    taskid: 3b500480-3ba3-4d88-8c70-0755876824d7
    type: condition
    task:
      id: 3b500480-3ba3-4d88-8c70-0755876824d7
      version: -1
      name: Check WildFire type
      description: "Check WildFire alert type."
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "127"
      Malware:
      - "126"
    separatecontext: false
    conditions:
    - label: Malware
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: WildFire.Verdicts
                accessor: VerdictDescription
                transformers:
                - operator: toLowerCase
            iscontext: true
          right:
            value:
              simple: malware
    view: |-
      {
        "position": {
          "x": 170,
          "y": 450
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "46":
    id: "46"
    taskid: 2d31a492-5195-4c55-89e1-5a3a4f72a469
    type: title
    task:
      id: 2d31a492-5195-4c55-89e1-5a3a4f72a469
      version: -1
      name: False Positive Alert
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "100"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -1260,
          "y": -730
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "65":
    id: "65"
    taskid: 97186ec1-fbcf-4ac0-8d77-b0e6e1e16f02
    type: condition
    task:
      id: 97186ec1-fbcf-4ac0-8d77-b0e6e1e16f02
      version: -1
      name: Should report alert to WildFire and handle as False Positive?
      description: "Should report alert to WildFire and handle as False Positive?"
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "124"
      "yes":
      - "105"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.AutoMarkFP
                transformers:
                - operator: toLowerCase
            iscontext: true
          right:
            value:
              simple: "true"
    view: |-
      {
        "position": {
          "x": -1260,
          "y": -235
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "66":
    id: "66"
    taskid: 68e3dfd4-484f-41b7-854c-65ba29772bcc
    type: condition
    task:
      id: 68e3dfd4-484f-41b7-854c-65ba29772bcc
      version: -1
      name: Manual - Review and handle alert
      description: "Manual - Review and handle alert."
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "70"
      Allow list:
      - "68"
      Block list:
      - "69"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 730,
          "y": 940
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "68":
    id: "68"
    taskid: 979144f9-e6de-4b3a-8a66-01532c0e76bb
    type: regular
    task:
      id: 979144f9-e6de-4b3a-8a66-01532c0e76bb
      version: -1
      name: Add hash to Allowed List
      description: Adds requested files to allow list if they are not already on block list or allow list.
      script: '|||core-allowlist-files'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "70"
    scriptarguments:
      comment:
        simple: Added by Cortex XSIAM.
      hash_list:
        complex:
          root: alert
          accessor: initiatorsha256
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1060,
          "y": 1120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "69":
    id: "69"
    taskid: 736c8e72-ce39-41c8-85af-5889b4c71aa4
    type: regular
    task:
      id: 736c8e72-ce39-41c8-85af-5889b4c71aa4
      version: -1
      name: Add hash to Blocked List
      description: Block lists requested files which have not already been block listed or added to allow list.
      script: '|||core-blocklist-files'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "70"
    scriptarguments:
      comment:
        simple: Added by Cortex XSIAM.
      hash_list:
        complex:
          root: alert
          accessor: initiatorsha256
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 410,
          "y": 1120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "70":
    id: "70"
    taskid: 6a8efaa2-3376-45d1-8afe-c4800887730c
    type: condition
    task:
      id: 6a8efaa2-3376-45d1-8afe-c4800887730c
      version: -1
      name: Should investigate further?
      description: "Should investigate further?"
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "114"
      "yes":
      - "25"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 730,
          "y": 1290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "84":
    id: "84"
    taskid: e6a5956d-d3e5-496b-8178-ee8e15e90f8e
    type: title
    task:
      id: e6a5956d-d3e5-496b-8178-ee8e15e90f8e
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -1260,
          "y": 3280
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "95":
    id: "95"
    taskid: b23bee88-5564-4714-8763-b4a58be43dc1
    type: title
    task:
      id: b23bee88-5564-4714-8763-b4a58be43dc1
      version: -1
      name: Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "98"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -400,
          "y": 1960
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "98":
    id: "98"
    taskid: 58bcc083-e978-4a7e-83ad-c7d463396bea
    type: playbook
    task:
      id: 58bcc083-e978-4a7e-83ad-c7d463396bea
      version: -1
      name: Containment Plan
      description: |-
        This playbook handles all the containment actions available with Cortex XSIAM, including the following tasks:
        * Isolate endpoint
        * Disable account
        * Quarantine file
        * Block indicators
        * Clear user session (currently, the playbook supports only Okta)

        Note: The playbook inputs enable manipulating the execution flow; read the input descriptions for details.
      playbookName: Containment Plan
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "114"
    scriptarguments:
      AutoContainment:
        complex:
          root: inputs.AutoContainment
      BlockIndicators:
        complex:
          root: inputs.BlockIndicators
      ClearUserSessions:
        simple: "False"
      EndpointID:
        complex:
          root: alert
          accessor: agentid
      FileContainment:
        complex:
          root: inputs.RelatedFileContainment
      FileHash:
        complex:
          root: foundIncidents.CustomFields
          filters:
          - - operator: isNotEqualString
              left:
                value:
                  simple: foundIncidents.CustomFields.initiatorpath
                iscontext: true
              right:
                value:
                  simple: C:\Windows\explorer.exe
          accessor: initiatorsha256
      FilePath:
        complex:
          root: foundIncidents.CustomFields.initiatorpath
          filters:
          - - operator: isNotEqualString
              left:
                value:
                  simple: foundIncidents.CustomFields.initiatorpath
                iscontext: true
              right:
                value:
                  simple: C:\Windows\explorer.exe
      FileRemediation:
        complex:
          root: inputs.FileRemediation
      HostAutoContainment:
        complex:
          root: inputs.HostAutoContainment
      IAMUserDomain:
        simple: '@demisto.com'
      UserContainment:
        simple: "False"
    separatecontext: true
    loop:
      iscommand: false
      scriptArguments:
        BlockIndicators:
          simple: "True"
        ContainmentType:
          simple: Auto
        EndpointContainment:
          simple: "False"
        FileContainment:
          simple: "True"
        ScheduledTaskConatinment:
          simple: "True"
        UserContainment:
          simple: "True"
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": -400,
          "y": 2110
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "100":
    id: "100"
    taskid: ff411158-cffb-487c-8407-18ada6a4c1b4
    type: regular
    task:
      id: ff411158-cffb-487c-8407-18ada6a4c1b4
      version: -1
      name: 'WildFire report  - Review  identified characteristics'
      description: "WildFire report  - Review  identified characteristics"
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "65"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -1260,
          "y": -415
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "105":
    id: "105"
    taskid: a48903b0-393c-4c74-82bd-2a2a1c2afff0
    type: regular
    task:
      id: a48903b0-393c-4c74-82bd-2a2a1c2afff0
      version: -1
      name: Report False Positive to WildFire
      description: report FP to wildfire through XDR
      script: '|||core-report-incorrect-wildfire'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "111"
    scriptarguments:
      email:
        complex:
          root: inputs.EmailAddress
      file_hash:
        complex:
          root: alert
          accessor: initiatorsha256
      new_verdict:
        simple: "0"
      reason:
        simple: Marked as False Positive in a Cortex XSIAM investigation.
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -1260,
          "y": 110
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "106":
    id: "106"
    taskid: 377be20d-9ffd-4b2d-81d1-11711fc1a769
    type: condition
    task:
      id: 377be20d-9ffd-4b2d-81d1-11711fc1a769
      version: -1
      name: Check hash execution timestamp
      description: "Check hash execution timestamp."
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "36"
      24H:
      - "33"
    separatecontext: false
    conditions:
    - label: 24H
      condition:
      - - operator: greaterThan
          left:
            value:
              simple: alert.autime
            iscontext: true
          right:
            value:
              simple: TimeNowUnix
            iscontext: true
    view: |-
      {
        "position": {
          "x": 530,
          "y": -230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "110":
    id: "110"
    taskid: 5b78e324-ed38-4740-8481-3c44a317b848
    type: title
    task:
      id: 5b78e324-ed38-4740-8481-3c44a317b848
      version: -1
      name: Verdict
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "119"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -310,
          "y": -1210
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "111":
    id: "111"
    taskid: d9f34c1e-5a36-48e3-8b2c-29bbcd5d465e
    type: playbook
    task:
      id: d9f34c1e-5a36-48e3-8b2c-29bbcd5d465e
      version: -1
      name: Handle False Positive Alerts
      description: |
        This playbook handles false positive alerts.
      playbookName: Handle False Positive Alerts
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "84"
    scriptarguments:
      FileSHA256:
        complex:
          root: inputs.sha256
      ShouldCloseAutomatically:
        complex:
          root: inputs.ShouldCloseAutomatically
      alertName:
        complex:
          root: alert
          accessor: name
      sourceIP:
        complex:
          root: alert
          accessor: hostip
      username:
        complex:
          root: alert
          accessor: username
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": -1260,
          "y": 295
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "112":
    id: "112"
    taskid: 467cd753-37e5-4118-8962-2c0bfefedbb9
    type: regular
    task:
      id: 467cd753-37e5-4118-8962-2c0bfefedbb9
      version: -1
      name: close alert
      description: Close the alert.
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "84"
    scriptarguments:
      closeReason:
        simple: Resolved - Threat Handled
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 730,
          "y": 3110
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "113":
    id: "113"
    taskid: 7d84c915-3451-4325-809d-8ea91a0134c1
    type: condition
    task:
      id: 7d84c915-3451-4325-809d-8ea91a0134c1
      version: -1
      name: Should restore affected endpoint?
      description: "Should restore affected endpoint?"
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "112"
      "yes":
      - "116"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.AutoRecovery
                transformers:
                - operator: toLowerCase
            iscontext: true
          right:
            value:
              simple: "true"
    view: |-
      {
        "position": {
          "x": 730,
          "y": 2765
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "114":
    id: "114"
    taskid: 86efbb93-4ae8-4f28-87ed-f9651e61c920
    type: condition
    task:
      id: 86efbb93-4ae8-4f28-87ed-f9651e61c920
      version: -1
      name: Should close alert automatically?
      description: "Should close alert automatically?"
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "115"
      "yes":
      - "117"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.ShouldCloseAutomatically
                transformers:
                - operator: toLowerCase
            iscontext: true
          right:
            value:
              simple: "true"
    view: |-
      {
        "position": {
          "x": 730,
          "y": 2280
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "115":
    id: "115"
    taskid: 43a5ee18-7758-4a50-8709-9e464a43f369
    type: regular
    task:
      id: 43a5ee18-7758-4a50-8709-9e464a43f369
      version: -1
      name: Continue with the incident investigation
      description: "Continue with the incident investigation."
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "117"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1060,
          "y": 2450
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "116":
    id: "116"
    taskid: 03920671-b7bd-46f9-8659-19b605c10482
    type: playbook
    task:
      id: 03920671-b7bd-46f9-8659-19b605c10482
      version: -1
      name: Recovery Plan
      description: |-
        This playbook handles all the recovery actions available with Cortex XSIAM, including the following tasks:
        * Unisolate endpoint
        * Restore quarantined file

        Note: The playbook inputs enable manipulating the execution flow; read the input descriptions for details.
      playbookName: Recovery Plan
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "112"
    scriptarguments:
      FileHash:
        complex:
          root: alert
          accessor: initiatorsha256
      endpointID:
        complex:
          root: alert
          accessor: agentid
      releaseFile:
        simple: "false"
      unIsolateEndpoint:
        simple: "true"
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 1130,
          "y": 2940
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "117":
    id: "117"
    taskid: 32f5a428-81f0-4bba-84f5-c67f27f14312
    type: title
    task:
      id: 32f5a428-81f0-4bba-84f5-c67f27f14312
      version: -1
      name: Recovery
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "113"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 730,
          "y": 2620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "119":
    id: "119"
    taskid: 1b8ab1c5-749b-4615-8da5-b0bc2b723cb9
    type: playbook
    task:
      id: 1b8ab1c5-749b-4615-8da5-b0bc2b723cb9
      version: -1
      name: Enrichment for Verdict
      playbookName: Enrichment for Verdict
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "123"
    scriptarguments:
      CloseReason:
        simple: Resolved - False Positive,Resolved - Duplicate Incident,Resolved - Known Issue
      Domain:
        complex:
          root: alert
          accessor: domainname
      FileSHA256:
        complex:
          root: alert
          accessor: initiatorsha256
      IP:
        complex:
          root: alert
          accessor: hostip
      URL:
        complex:
          root: alert
          accessor: url
      User:
        complex:
          root: alert
          accessor: username
      query:
        simple: initiatorsha256:${inputs.sha256} and sourceBrand:"${alert.sourceBrand}" and name:"${alert.name}"
      threshold:
        simple: "5"
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": -310,
          "y": -1070
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "120":
    id: "120"
    taskid: 91549068-a885-437b-878f-f3b77bf310e7
    type: playbook
    task:
      id: 91549068-a885-437b-878f-f3b77bf310e7
      version: -1
      name: Containment Plan
      description: |-
        This playbook handles all the containment actions available with Cortex XSIAM, including the following tasks:
        * Isolate endpoint
        * Disable account
        * Quarantine file
        * Block indicators
        * Clear user session (currently, the playbook supports only Okta)

        Note: The playbook inputs enable manipulating the execution flow; read the input descriptions for details.
      playbookName: Containment Plan
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "36"
    scriptarguments:
      AutoContainment:
        simple: "True"
      BlockIndicators:
        simple: "False"
      ClearUserSessions:
        simple: "False"
      EndpointID:
        complex:
          root: alert
          accessor: agentid
      FileContainment:
        complex:
          root: inputs.OriginalFileContainment
      FileHash:
        complex:
          root: inputs.sha256
      FilePath:
        complex:
          root: alert
          accessor: filepath
      FileRemediation:
        complex:
          root: inputs.FileRemediation
      HostAutoContainment:
        simple: "False"
      IAMUserDomain:
        simple: '@demisto.com'
      UserContainment:
        simple: "False"
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 730,
          "y": 280
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "121":
    id: "121"
    taskid: 7cae09e9-4e9f-4429-8bb9-0c8948b300a6
    type: regular
    task:
      id: 7cae09e9-4e9f-4429-8bb9-0c8948b300a6
      version: -1
      name: Get time for the last day
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "106"
    scriptarguments:
      contextKey:
        simple: LastDay
      daysAgo:
        simple: "1"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 530,
          "y": -420
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "122":
    id: "122"
    taskid: 3b5bd7f4-a3b2-4482-83fd-1384d3752d89
    type: playbook
    task:
      id: 3b5bd7f4-a3b2-4482-83fd-1384d3752d89
      version: -1
      name: Endpoint Investigation Plan
      description: |-
        This playbook handles all the endpoint investigation actions available with Cortex XSIAM, including the following tasks:
        * Pre-defined MITRE Tactics
        * Host fields (Host ID)
        * Attacker fields (Attacker IP, External host)
        * MITRE techniques
        * File hash (currently, the playbook supports only SHA256)

        Note: The playbook inputs enable manipulating the execution flow; read the input descriptions for details.
      playbookName: Endpoint Investigation Plan
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "133"
    scriptarguments:
      HuntCnCTechniques:
        simple: "True"
      HuntCollectionTechniques:
        simple: "True"
      HuntDefenseEvasionTechniques:
        simple: "True"
      HuntDiscoveryTechniques:
        simple: "True"
      HuntExecutionTechniques:
        simple: "True"
      HuntImpactTechniques:
        simple: "True"
      HuntInitialAccessTechniques:
        simple: "True"
      HuntLateralMovementTechniques:
        simple: "True"
      HuntPersistenceTechniques:
        simple: "True"
      HuntPrivilegeEscalationTechniques:
        simple: "True"
      HuntReconnaissanceTechniques:
        simple: "True"
      agentID:
        complex:
          root: alert
          accessor: agentid
      timeRange:
        simple: 24 hours ago
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": -140,
          "y": 1610
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "123":
    id: "123"
    taskid: 790be732-ca45-4102-84d4-cab60749cf0d
    type: condition
    task:
      id: 790be732-ca45-4102-84d4-cab60749cf0d
      version: -1
      name: Establish verdict
      description: "Establish verdict for the alert."
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "132"
      False Positive:
      - "46"
      Possible False Positive:
      - "129"
    separatecontext: false
    conditions:
    - label: False Positive
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: PreviousVerdict
            iscontext: true
          right:
            value:
              simple: False Positive
    - label: Possible False Positive
      condition:
      - - operator: isNotEqualString
          left:
            value:
              simple: FileVerdict
            iscontext: true
          right:
            value:
              simple: Suspicious
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: Core.AnalyticsPrevalence.Hash
                accessor: value
            iscontext: true
          right:
            value:
              simple: "true"
          ignorecase: true
    view: |-
      {
        "position": {
          "x": -310,
          "y": -900
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "124":
    id: "124"
    taskid: 4aff2497-2e70-4c17-8f49-761f71907f5f
    type: condition
    task:
      id: 4aff2497-2e70-4c17-8f49-761f71907f5f
      version: -1
      name: Manual - Mark alert as False Positive?
      description: "Manual - Mark alert as False Positive?"
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "25"
      "Yes":
      - "105"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -930,
          "y": -65
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "126":
    id: "126"
    taskid: 58d68deb-99a8-445e-89a4-ef6a3cc5f0bc
    type: title
    task:
      id: 58d68deb-99a8-445e-89a4-ef6a3cc5f0bc
      version: -1
      name: Malware
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "25"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -140,
          "y": 620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "127":
    id: "127"
    taskid: bb4343c4-ee10-4a3c-8805-3a086cc29f9b
    type: title
    task:
      id: bb4343c4-ee10-4a3c-8805-3a086cc29f9b
      version: -1
      name: Grayware and Phishing
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "128"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 430,
          "y": 620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "128":
    id: "128"
    taskid: be0aa583-fbf8-4740-864b-0f9dac027680
    type: condition
    task:
      id: be0aa583-fbf8-4740-864b-0f9dac027680
      version: -1
      name: Should treat grayware and phishing as malware?
      description: "Should treat grayware and phishing as malware?"
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "66"
      "yes":
      - "25"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.GraywarePhishingAsMalware
                transformers:
                - operator: toLowerCase
            iscontext: true
          right:
            value:
              simple: "true"
    view: |-
      {
        "position": {
          "x": 430,
          "y": 770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "129":
    id: "129"
    taskid: 50b6ea0b-3d7e-4427-8893-764c3a7afe27
    type: title
    task:
      id: 50b6ea0b-3d7e-4427-8893-764c3a7afe27
      version: -1
      name: Possible False Positive
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "130"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -480,
          "y": -730
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "130":
    id: "130"
    taskid: 8c62b789-f058-48cf-8804-f805b639f731
    type: condition
    task:
      id: 8c62b789-f058-48cf-8804-f805b639f731
      version: -1
      name: Manuel Review - Should continue to investigate?
      description: "Manuel Review - Should continue to investigate?"
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "100"
      "Yes":
      - "36"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -480,
          "y": -590
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "131":
    id: "131"
    taskid: d5ab1ed4-53c0-4885-8e89-a0ccc84a057b
    type: condition
    task:
      id: d5ab1ed4-53c0-4885-8e89-a0ccc84a057b
      version: -1
      name: Is auto-containment set to true?
      description: "Is auto-containment set to true?"
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "36"
      "yes":
      - "120"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.AutoContainment
                transformers:
                - operator: toLowerCase
            iscontext: true
          right:
            value:
              simple: "true"
    view: |-
      {
        "position": {
          "x": 730,
          "y": 80
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "132":
    id: "132"
    taskid: 535e2207-e112-4fe9-8d43-9686af287db7
    type: title
    task:
      id: 535e2207-e112-4fe9-8d43-9686af287db7
      version: -1
      name: Possible True Positive
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "3"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 170,
          "y": -730
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "133":
    id: "133"
    taskid: 10dae87a-97f4-43fd-8196-14386596e581
    type: condition
    task:
      id: 10dae87a-97f4-43fd-8196-14386596e581
      version: -1
      name: Are there investigation findings?
      description: "Are there investigation findings?"
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "114"
      "yes":
      - "95"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: foundIncidents
            iscontext: true
    view: |-
      {
        "position": {
          "x": -140,
          "y": 1790
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
view: |-
  {
    "linkLabelsPosition": {
      "106_36_#default#": 0.4,
      "113_112_#default#": 0.57,
      "113_116_yes": 0.42,
      "114_117_yes": 0.52,
      "124_25_#default#": 0.5,
      "128_25_yes": 0.13,
      "128_66_#default#": 0.59,
      "130_36_Yes": 0.47,
      "36_126_Malware": 0.61,
      "36_127_#default#": 0.52,
      "3_36_Yes": 0.31,
      "65_105_yes": 0.49,
      "66_68_Allow list": 0.5,
      "66_69_Block list": 0.45,
      "66_70_#default#": 0.53,
      "70_114_#default#": 0.16,
      "70_25_yes": 0.23
    },
    "paper": {
      "dimensions": {
        "height": 4705,
        "width": 2770,
        "x": -1260,
        "y": -1360
      }
    }
  }
inputs:
- key: sha256
  value:
    complex:
      root: alert
      accessor: initiatorsha256
  required: false
  description: The SHA256 hash of the suspected file.
  playbookInputQuery:
- key: GraywarePhishingAsMalware
  value:
    simple: "true"
  required: false
  description: Whether to treat grayware and phishing alerts as malware.
  playbookInputQuery:
- key: AutoContainment
  value:
    simple: "true"
  required: false
  description: |-
    Whether to execute the containment plan (except isolation) automatically.
    The specific containment playbook inputs should also be set to 'True'.
  playbookInputQuery:
- key: HostAutoContainment
  value:
    simple: "true"
  required: false
  description: Whether to automatically execute endpoint isolation in case there are investigation findings.
  playbookInputQuery:
- key: BlockIndicators
  value:
    simple: "false"
  required: false
  description: Set to True if you want to block the indicators.
  playbookInputQuery:
- key: OriginalFileContainment
  value:
    simple: "true"
  required: false
  description: Set to True if you want to quarantine the original malicious file.
  playbookInputQuery:
- key: RelatedFileContainment
  value:
    simple: "true"
  required: false
  description: Set to True to quarantine the identified files found in the investigation.
  playbookInputQuery:
- key: FileRemediation
  value:
    simple: Quarantine
  required: false
  description: "Choose 'Quarantine' or 'Delete'  to avoid file remediation conflicts. \nFor example, choosing 'Quarantine' ignores the 'Delete file' task under the eradication playbook and executes only file quarantine."
  playbookInputQuery:
- key: AutoMarkFP
  value: {}
  required: false
  description: Whether to automatically mark alerts that were found as benign by the 'Enrichment for Verdict' playbook and report false positive alerts to WildFire. True/False.
  playbookInputQuery:
- key: EmailAddress
  value: {}
  required: false
  description: User's email address to use when reporting false positive alerts to WildFire.
  playbookInputQuery:
- key: ShouldCloseAutomatically
  value: {}
  required: false
  description: Whether to automatically close the alert after investigation and remediation are finished. True/False.
  playbookInputQuery:
- key: AutoRecovery
  value: {}
  required: false
  description: Whether to execute the Recovery playbook after the investigation and remediation are finished. True/False.
  playbookInputQuery:
outputs: []
tests:
- No tests (auto formatted)
fromversion: 6.6.0
contentitemexportablefields:
  contentitemfields: {}
