description: 'This playbook is designed to handle the following alerts:


  - SSO Password Spray Threat Detected

  - SSO Password Spray Activity Observed

  - SSO Password Spray Involving a Honey User


  Playbook Stages:


  Triage:


  - The playbook checks the IP reputation and fetches the events related to the SSO
  login attempts.


  Early Containment:


  - The playbook checks if the IP is suspicious. If it is, the playbook suggests blocking
  the IP.


  Investigation:


  - The playbook assess the risk score of the user who successfully logged in and
  examines the legitimacy of the user agent. It verifies if the user has MFA configured
  and analyzes the timestamps of the login attempts to detect potential malicious
  automated patterns.


  Containment:

  - If there is a successful login attempt and the user''s risk score is high, or
  if the user agent is detected as suspicious, or if the time intervals were automated,
  the playbook clears the user''s session. If the user doesn''t have MFA, the playbook
  recommends expiring the user''s password.


  Requirements:


  For any response action, you need one of the following integrations:


  - Microsoft Graph User

  - Okta'
fromversion: 6.10.0
id: silent-SSO Password Spray test
inputSections:
- description: Generic group for inputs.
  inputs: []
  name: General (Inputs group)
inputs: []
issilent: true
marketplaces:
- marketplacev2
name: silent-SSO Password Spray test
outputSections:
- description: Generic group for outputs.
  name: General (Outputs group)
  outputs: []
outputs: []
starttaskid: '0'
tags:
- T1110.003 - Password Spraying
- T1110 - Brute Force
- T1110.001 - Password Guessing
- T1586 - Compromise Accounts
tasks:
  '0':
    continueonerrortype: ''
    id: '0'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '29'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 428e71eb-55df-4a65-8aec-d2b4a5caa5d7
      iscommand: false
      name: ''
      version: -1
    taskid: 428e71eb-55df-4a65-8aec-d2b4a5caa5d7
    timertriggers: []
    type: start
    view: "{\n  \"position\": {\n    \"x\": 1100,\n    \"y\": 110\n  }\n}"
  '12':
    continueonerrortype: ''
    id: '12'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 135f3593-a4ca-4195-8054-2b0501e3cf4e
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: 135f3593-a4ca-4195-8054-2b0501e3cf4e
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": 1100,\n    \"y\": 3220\n  }\n}"
  '13':
    continueonerrortype: ''
    id: '13'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '35'
    note: false
    quietmode: 0
    scriptarguments:
      alert_ids:
        complex:
          accessor: id
          root: alert
          transformers:
          - operator: uniq
      filter_alert_fields:
        simple: 'false'
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Returns information about each alert ID.
      id: e64d41dd-1dcc-4d40-8193-54bf4880bfca
      iscommand: true
      name: Get login event attempt information
      script: '|||core-get-cloud-original-alerts'
      type: regular
      version: -1
    taskid: e64d41dd-1dcc-4d40-8193-54bf4880bfca
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 1310,\n    \"y\": 380\n  }\n}"
  '14':
    continueonerror: true
    continueonerrortype: ''
    id: '14'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '36'
    note: false
    quietmode: 0
    scriptarguments:
      user_id:
        simple: ${SuccessfulLoginUsernames}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Gets the risk score of the users who successfully logged in.
      id: 885d1ae0-3a02-46ee-891d-0177cdce2b17
      iscommand: true
      name: Check user risk level
      script: '|||core-list-risky-users'
      type: regular
      version: -1
    taskid: 885d1ae0-3a02-46ee-891d-0177cdce2b17
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 1340,\n    \"y\": 1035\n  }\n}"
  '16':
    continueonerrortype: ''
    id: '16'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '21'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: d02e94a0-eda1-4729-804c-c17051c8c702
      iscommand: false
      name: Containment
      type: title
      version: -1
    taskid: d02e94a0-eda1-4729-804c-c17051c8c702
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": 1790,\n    \"y\": 1370\n  }\n}"
  '17':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: SuccessfulLoginUsernames
          operator: isNotEmpty
          right:
            value: {}
      label: 'Yes'
    continueonerrortype: ''
    id: '17'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '9'
      'Yes':
      - '28'
      - '14'
      - '39'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: b95fa692-f074-4cd7-868d-464005a3decb
      iscommand: false
      name: Were any successful login attempts?
      type: condition
      version: -1
    taskid: b95fa692-f074-4cd7-868d-464005a3decb
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 1100,\n    \"y\": 840\n  }\n}"
  '2':
    continueonerrortype: ''
    id: '2'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - '40'
    note: false
    quietmode: 0
    scriptarguments:
      ClearUserSessions:
        simple: 'True'
      Username:
        complex:
          root: SuspiciousUsers
          transformers:
          - args:
              delimiter:
                value:
                  simple: \
              fields:
                value:
                  simple: '2'
            operator: Cut
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ''
      description: '## Containment Plan - Clear User Sessions


        This playbook is a sub-playbook within the containment plan playbook.

        The playbook uses the ''Okta v2'' and ''MSGraph User'' integrations to clear
        user sessions.'
      id: e7916327-2ca6-4862-84c4-6562f288e56d
      iscommand: false
      name: Containment Plan - Clear User Sessions
      playbookName: Containment Plan - Clear User Sessions
      type: playbook
      version: -1
    taskid: e7916327-2ca6-4862-84c4-6562f288e56d
    timertriggers: []
    type: playbook
    view: "{\n  \"position\": {\n    \"x\": 1790,\n    \"y\": 1690\n  }\n}"
  '21':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: SuspiciousUsers
          operator: isNotEmpty
          right:
            value: {}
      label: 'Yes'
    continueonerrortype: ''
    id: '21'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '9'
      'Yes':
      - '2'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 7da596f4-aa21-49e1-8640-366e9803b7cf
      iscommand: false
      name: Are there any suspicious characteristics?
      type: condition
      version: -1
    taskid: 7da596f4-aa21-49e1-8640-366e9803b7cf
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 1790,\n    \"y\": 1500\n  }\n}"
  '22':
    continueonerror: true
    continueonerrortype: ''
    id: '22'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '38'
    note: false
    quietmode: 0
    scriptarguments:
      extend-context:
        simple: MFAResult=
      username:
        complex:
          accessor: auth_identity
          filters:
          - - left:
                iscontext: true
                value:
                  simple: Core.OriginalAlert._all_events.identity
              operator: containsGeneral
              right:
                iscontext: true
                value:
                  simple: SuspiciousUsers
          root: Core.OriginalAlert._all_events
          transformers:
          - operator: uniq
    separatecontext: false
    skipunavailable: true
    task:
      brand: ''
      description: Returns all the enrolled factors for the specified user.
      id: 8114af51-b7f4-4458-8112-b157ea743c51
      iscommand: true
      name: Get user MFA factors
      script: '|||okta-get-user-factors'
      type: regular
      version: -1
    taskid: 8114af51-b7f4-4458-8112-b157ea743c51
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 1790,\n    \"y\": 2040\n  }\n}"
  '23':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: UsersWithoutMFA
          operator: isNotEmpty
      label: 'Yes'
    continueonerrortype: ''
    id: '23'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '9'
      'Yes':
      - '24'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: b06185f2-9dba-4416-8d88-d12f3ee05c11
      iscommand: false
      name: Found users without MFA?
      type: condition
      version: -1
    taskid: b06185f2-9dba-4416-8d88-d12f3ee05c11
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 1790,\n    \"y\": 2360\n  }\n}"
  '24':
    continueonerrortype: ''
    form:
      description: Decide whether the password should be expired for users who have
        successfully logged in.
      expired: false
      questions:
      - defaultrows: []
        fieldassociated: ''
        gridcolumns: []
        id: '0'
        label: ''
        labelarg:
          simple: Select the user to set password expiration
        options: []
        optionsarg:
        - simple: ${UsersWithoutMFA}
        placeholder: ''
        readonly: false
        required: false
        tooltip: ''
        type: multiSelect
      sender: ''
      title: Select the user for which you want to set a password expiration
      totalanswers: 0
    id: '24'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    message:
      bcc: null
      body: null
      cc: null
      format: ''
      methods: []
      subject: null
      timings:
        completeafterreplies: 1
        completeaftersla: false
        completeafterv2: true
        retriescount: 2
        retriesinterval: 360
      to: null
    nexttasks:
      '#none#':
      - '25'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 167f7ac9-9848-4247-8e6a-808d3838d537
      iscommand: false
      name: Choose users for password expiration
      type: collection
      version: -1
    taskid: 167f7ac9-9848-4247-8e6a-808d3838d537
    timertriggers: []
    type: collection
    view: "{\n  \"position\": {\n    \"x\": 1980,\n    \"y\": 2530\n  }\n}"
  '25':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: Select the user for which you want to set a password expiration.Answers.0
          operator: isNotEmpty
          right:
            value: {}
      label: 'Yes'
    continueonerrortype: ''
    id: '25'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '9'
      'Yes':
      - '46'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: a30220a7-b971-43b6-8ccb-e6a003ad5a80
      iscommand: false
      name: Was any user selected?
      type: condition
      version: -1
    taskid: a30220a7-b971-43b6-8ccb-e6a003ad5a80
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 1980,\n    \"y\": 2690\n  }\n}"
  '28':
    continueonerror: true
    continueonerrortype: ''
    id: '28'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '37'
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: UsersWithSuspiciousUserAgent
      value:
        complex:
          accessor: identity
          filters:
          - - left:
                iscontext: true
                value:
                  simple: Core.OriginalAlert._all_events.action_user_agent
              operator: match
              right:
                value:
                  simple: \b(Python-urllib|libwww-perl|Scrapy|curl|Wget|sqlmap|Nikto|Xrumer|Hydra|JohnTheRipper|LOIC|HOIC|MJ12bot|Baiduspider|BlackWidow|HeadlessChrome|PhantomJS|Selenium)\b
          root: Core.OriginalAlert._all_events
          transformers:
          - operator: uniq
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: 'Set a value in context under the key you entered. If no value
        is entered, the script doesn''t do anything.


        This automation runs using the default Limited User role, unless you explicitly
        change the permissions.

        For more information, see the section about permissions here:

        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.13/Cortex-XSOAR-Administrator-Guide/Automations'
      id: cc15491b-020c-4644-886d-59e7a92e2471
      iscommand: false
      name: Check if the involved user agent is suspicious
      scriptName: SetAndHandleEmpty
      type: regular
      version: -1
    taskid: cc15491b-020c-4644-886d-59e7a92e2471
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 1790,\n    \"y\": 1035\n  }\n}"
  '29':
    continueonerrortype: ''
    id: '29'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '30'
      - '13'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 095c8cb2-59d8-45d8-80e8-da6c188cd1db
      iscommand: false
      name: 'Triage '
      type: title
      version: -1
    taskid: 095c8cb2-59d8-45d8-80e8-da6c188cd1db
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": 1100,\n    \"y\": 240\n  }\n}"
  '3':
    continueonerrortype: ''
    id: '3'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '17'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 7aecbe76-273f-4564-805f-3e022d320039
      iscommand: false
      name: Investigation
      type: title
      version: -1
    taskid: 7aecbe76-273f-4564-805f-3e022d320039
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": 1100,\n    \"y\": 710\n  }\n}"
  '30':
    continueonerrortype: ''
    id: '30'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '31'
    note: false
    quietmode: 0
    scriptarguments:
      ip:
        complex:
          accessor: localip
          root: alert
          transformers:
          - operator: uniq
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Checks the reputation of an IP address.
      id: bb7e26e7-71c9-4269-83f5-ac140ec63f99
      iscommand: true
      name: 'Check IP reputation '
      script: '|||ip'
      type: regular
      version: -1
    taskid: bb7e26e7-71c9-4269-83f5-ac140ec63f99
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 860,\n    \"y\": 380\n  }\n}"
  '31':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: DBotScore.Score
                    operator: greaterThan
                    right:
                      value:
                        simple: '2'
                - - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: DBotScore.Type
                    operator: isEqualString
                    right:
                      value:
                        simple: IP
                - - left:
                      iscontext: true
                      value:
                        simple: DBotScore.Indicator
                    operator: isEqualString
                    right:
                      iscontext: true
                      value:
                        simple: alert.localip
                root: DBotScore
          operator: isNotEmpty
      label: 'yes'
    continueonerrortype: ''
    id: '31'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '3'
      'yes':
      - '32'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 044a39e8-a5a5-42eb-8df7-f4e63eb92451
      iscommand: false
      name: 'Is the IP malicious? '
      type: condition
      version: -1
    taskid: 044a39e8-a5a5-42eb-8df7-f4e63eb92451
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 860,\n    \"y\": 540\n  }\n}"
  '32':
    continueonerrortype: ''
    id: '32'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '45'
      - '3'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 20c0aa3f-6a69-42e9-87bb-67d1ef80431c
      iscommand: false
      name: Early Containment
      type: title
      version: -1
    taskid: 20c0aa3f-6a69-42e9-87bb-67d1ef80431c
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": 650,\n    \"y\": 710\n  }\n}"
  '35':
    continueonerrortype: ''
    id: '35'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '3'
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: SuccessfulLoginUsernames
      value:
        complex:
          accessor: identity
          filters:
          - - left:
                iscontext: true
                value:
                  simple: Core.OriginalAlert._all_events.auth_outcome
              operator: isEqualString
              right:
                value:
                  simple: SUCCESS
          root: Core.OriginalAlert._all_events
          transformers:
          - operator: uniq
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: 'Set a value in context under the key you entered. If no value
        is entered, the script doesn''t do anything.


        This automation runs using the default Limited User role, unless you explicitly
        change the permissions.

        For more information, see the section about permissions here:

        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.13/Cortex-XSOAR-Administrator-Guide/Automations'
      id: 47053318-6590-4910-8f9b-5bd04eb82724
      iscommand: false
      name: Set users with successful login
      scriptName: SetAndHandleEmpty
      type: regular
      version: -1
    taskid: 47053318-6590-4910-8f9b-5bd04eb82724
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 1310,\n    \"y\": 540\n  }\n}"
  '36':
    continueonerrortype: ''
    id: '36'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '16'
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: SuspiciousUsers
      value:
        complex:
          accessor: id
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: Core.RiskyUser.risk_level
              operator: isEqualString
              right:
                value:
                  simple: HIGH
          root: Core.RiskyUser
          transformers:
          - operator: uniq
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: 'Set a value in context under the key you entered. If no value
        is entered, the script doesn''t do anything.


        This automation runs using the default Limited User role, unless you explicitly
        change the permissions.

        For more information, see the section about permissions here:

        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.13/Cortex-XSOAR-Administrator-Guide/Automations'
      id: 75fc378e-64e6-4694-89a3-cb6c81b18c32
      iscommand: false
      name: Set risky users that logged in (if exist)
      scriptName: SetAndHandleEmpty
      type: regular
      version: -1
    taskid: 75fc378e-64e6-4694-89a3-cb6c81b18c32
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 1340,\n    \"y\": 1200\n  }\n}"
  '37':
    continueonerrortype: ''
    id: '37'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '16'
    note: false
    quietmode: 0
    scriptarguments:
      append:
        simple: 'true'
      key:
        simple: SuspiciousUsers
      value:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: UsersWithSuspiciousUserAgent
              operator: in
              right:
                iscontext: true
                value:
                  simple: SuccessfulLoginUsernames
          root: UsersWithSuspiciousUserAgent
          transformers:
          - operator: uniq
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: 'Set a value in context under the key you entered. If no value
        is entered, the script doesn''t do anything.


        This automation runs using the default Limited User role, unless you explicitly
        change the permissions.

        For more information, see the section about permissions here:

        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.13/Cortex-XSOAR-Administrator-Guide/Automations'
      id: 859ffdde-c1c0-4976-836f-5d8029d80f28
      iscommand: false
      name: Set users who used a suspicious user agent
      scriptName: SetAndHandleEmpty
      type: regular
      version: -1
    taskid: 859ffdde-c1c0-4976-836f-5d8029d80f28
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 1790,\n    \"y\": 1200\n  }\n}"
  '38':
    continueonerrortype: ''
    id: '38'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '23'
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: UsersWithoutMFA
      value:
        complex:
          accessor: auth_identity
          filters:
          - - left:
                iscontext: true
                value:
                  simple: Core.OriginalAlert._all_events.auth_identity
              operator: notContainsGeneral
              right:
                iscontext: true
                value:
                  simple: Account.Factor.Profile.credentialId
          - - left:
                iscontext: true
                value:
                  simple: Core.OriginalAlert._all_events.identity
              operator: in
              right:
                iscontext: true
                value:
                  simple: SuspiciousUsers
          root: Core.OriginalAlert._all_events
          transformers:
          - operator: uniq
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: 'Set a value in context under the key you entered. If no value
        is entered, the script doesn''t do anything.


        This automation runs using the default Limited User role, unless you explicitly
        change the permissions.

        For more information, see the section about permissions here:

        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.13/Cortex-XSOAR-Administrator-Guide/Automations'
      id: a3550d82-11bd-4e53-829a-d5216a317e66
      iscommand: false
      name: Set users without MFA
      scriptName: SetAndHandleEmpty
      type: regular
      version: -1
    taskid: a3550d82-11bd-4e53-829a-d5216a317e66
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 1790,\n    \"y\": 2200\n  }\n}"
  '39':
    continueonerrortype: ''
    id: '39'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '47'
    note: false
    quietmode: 0
    scriptarguments:
      timestamps:
        simple: ${Core.OriginalAlert._all_events.event_timestamp}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Analyze a list of Unix timestamps in milliseconds, to detect simple
        patterns of consistency or high frequency. The script can aid in the investigation
        of multi-event alerts that contain a list of timestamps.
      id: 33ae71fb-e0ad-4dc5-8f48-5fbfcfb9892d
      iscommand: false
      name: Analyze intervals of login attempts
      scriptName: AnalyzeTimestampIntervals
      type: regular
      version: -1
    taskid: 33ae71fb-e0ad-4dc5-8f48-5fbfcfb9892d
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 2220,\n    \"y\": 1035\n  }\n}"
  '40':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: Core.OriginalAlert.raw_abioc.event.vendor
          operator: isEqualString
          right:
            value:
              simple: Okta
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: isEqualString
                    right:
                      value:
                        simple: Okta v2
                - - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: modules.state
                    operator: isEqualString
                    right:
                      value:
                        simple: active
                root: modules
          operator: isNotEmpty
      label: Okta
    continueonerrortype: ''
    id: '40'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '9'
      Okta:
      - '22'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: dec75ec0-4d72-49ff-8794-b14666ef5a1b
      iscommand: false
      name: 'Is integration enabled? '
      type: condition
      version: -1
    taskid: dec75ec0-4d72-49ff-8794-b14666ef5a1b
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 1790,\n    \"y\": 1850\n  }\n}"
  '45':
    continueonerrortype: ''
    id: '45'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - '9'
    note: false
    quietmode: 0
    scriptarguments:
      MaliciousIPs:
        complex:
          accessor: localip
          root: alert
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: true
    task:
      brand: ''
      description: 'This playbook blocks IP addresses with 2 optional actions:


        - Block IP addresses using Static Address Groups in Palo Alto Networks Panorama
        or Firewall. The playbook receives malicious IP addresses and an address group
        name as inputs, verifies that the addresses are not already a part of the
        address group, adds them and commits the configuration.



        - Utilize the Dynamic Address Group (DAG) capability of PAN-OS. DAG enables
        analysts to create a rule one time, where the group is the source/destination,
        and adds IP addresses dynamically without the need to commit the configuration
        every time.

        The playbook checks if the given tag already exists. If the tag exists, then
        the IP address is added to the tag.

        If the tag does not exist, a new address group is created with the given tag
        and a matching rule, and the configuration is committed.'
      id: 546da2af-656b-4826-8edb-de899cb1c14d
      iscommand: false
      name: PAN-OS - Block IP
      playbookName: PAN-OS - Block IP
      type: playbook
      version: -1
    taskid: 546da2af-656b-4826-8edb-de899cb1c14d
    timertriggers: []
    type: playbook
    view: "{\n  \"position\": {\n    \"x\": 650,\n    \"y\": 840\n  }\n}"
  '46':
    continueonerrortype: ''
    id: '46'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '9'
    note: false
    quietmode: 0
    scriptarguments:
      username:
        complex:
          accessor: '0'
          root: Select the user for which you want to set a password expiration.Answers
          transformers:
          - operator: uniq
    separatecontext: false
    skipunavailable: true
    task:
      brand: ''
      description: Expires the password for a user in Okta.
      id: 8b2f636e-8ce3-4d80-8756-a07dfafb7d4a
      iscommand: true
      name: Okta expire password
      script: '|||okta-expire-password'
      type: regular
      version: -1
    taskid: 8b2f636e-8ce3-4d80-8756-a07dfafb7d4a
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 2120,\n    \"y\": 2860\n  }\n}"
  '47':
    continueonerrortype: ''
    id: '47'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '16'
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: SuspiciousUsers
      value:
        complex:
          root: .
          transformers:
          - args:
              conditions:
                value:
                  simple: "[  {\n    \"condition\": \"#{IntervalAnalysis.IsPatternLikelyAutomated}\
                    \ == true\",\n    \"return\": #{SuccessfulLoginUsernames}\n  }\n\
                    ]"
              flags: {}
            operator: If-Elif
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: 'Set a value in context under the key you entered. If no value
        is entered, the script doesn''t do anything.


        This automation runs using the default Limited User role, unless you explicitly
        change the permissions.

        For more information, see the section about permissions here:

        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.13/Cortex-XSOAR-Administrator-Guide/Automations'
      id: 6f91f2a6-3c4e-4b48-8d39-5865c2aafd52
      iscommand: false
      name: Set users if the timestamps are automated
      scriptName: SetAndHandleEmpty
      type: regular
      version: -1
    taskid: 6f91f2a6-3c4e-4b48-8d39-5865c2aafd52
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 2220,\n    \"y\": 1200\n  }\n}"
  '9':
    continueonerrortype: ''
    id: '9'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '12'
    note: false
    quietmode: 0
    scriptarguments:
      id:
        simple: ${alert.id}
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.close.inv
      id: 60151642-80c7-4a8d-8523-e4ad49fc0c7e
      iscommand: true
      name: Close alert
      script: Builtin|||closeInvestigation
      type: regular
      version: -1
    taskid: 60151642-80c7-4a8d-8523-e4ad49fc0c7e
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 1100,\n    \"y\": 3050\n  }\n}"
tests:
- No tests (auto formatted)
version: -1
view: "{\n  \"linkLabelsPosition\": {\n    \"17_14_Yes\": 0.52,\n    \"17_28_Yes\"\
  : 0.7,\n    \"17_9_#default#\": 0.1,\n    \"21_2_Yes\": 0.57,\n    \"21_9_#default#\"\
  : 0.2,\n    \"23_9_#default#\": 0.11,\n    \"25_46_Yes\": 0.59,\n    \"25_9_#default#\"\
  : 0.15,\n    \"31_32_yes\": 0.54,\n    \"31_3_#default#\": 0.51,\n    \"40_22_Okta\"\
  : 0.45,\n    \"40_9_#default#\": 0.2\n  },\n  \"paper\": {\n    \"dimensions\":\
  \ {\n      \"height\": 3175,\n      \"width\": 1950,\n      \"x\": 650,\n      \"\
  y\": 110\n    }\n  }\n}"
