description: "This playbook is designed to handle the following alerts:\n\n- External\
  \ Login Password Spray\n- Successful External Login Password Spray\n- External Login\
  \ Password Spray on a Domain Controller\n- External Login Password Spray Involving\
  \ a Honey User\n- Successful External Login Password Spray on a Domain Controller\n\
  - Successful External Login Password Spray on a sensitive server\n\nThe playbook\
  \ is designed to investigate and respond to external login password sprays. It enriches\
  \ the external IP to enable early containment, retrieves event information, and\
  \ determines how the attack was carried out and whether it was successful.\n\nPlaybook\
  \ Stages:\n\nEarly Containment:\n\n- With analyst approval, the playbook will block\
  \ the malicious external IP address involved in the password spray attack, limiting\
  \ the attacker's ability to continue their actions.\n\nInvestigation:\n\n- The playbook\
  \ analyzes the timestamps of the login attempts to detect patterns, checks whether\
  \ any logons were successful, and retrieves the Risk Score for users who successfully\
  \ logged in as part of the attack.\n\nContainment:\n\n- Based on the user\u2019\
  s risk level, the playbook will expire the user\u2019s password to prevent further\
  \ unauthorized access and terminate any active RDP sessions for the affected user.\n\
  \nRequirements:\n\n- For response actions, the following integrations are required:\
  \ Active Directory (AD), PAN-OS, Core - IR."
fromversion: 6.10.0
id: silent-External Login Password Spray
inputs: []
issilent: true
marketplaces:
- marketplacev2
name: silent-External Login Password Spray
outputs: []
starttaskid: '0'
tags:
- T1110.003 - Password Spraying
- T1110 - Brute Force
- TA0006 - Credential Access
tasks:
  '0':
    continueonerrortype: ''
    id: '0'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '45'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 5b3b36a9-54de-46e5-8d25-977a87925b85
      iscommand: false
      name: ''
      version: -1
    taskid: 5b3b36a9-54de-46e5-8d25-977a87925b85
    timertriggers: []
    type: start
    view: "{\n  \"position\": {\n    \"x\": 450,\n    \"y\": -290\n  }\n}"
  '10':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: RiskyLogonUsernames
          operator: isNotEmpty
          right:
            value: {}
      - - left:
            iscontext: true
            value:
              simple: IntervalAnalysis.IsPatternLikelyAutomated
          operator: isTrue
        - left:
            iscontext: true
            value:
              simple: Core.OriginalAlert.stateful_raw_data.is_count_failed_users_above_baseline
          operator: isTrue
      - - left:
            iscontext: true
            value:
              simple: alert.severity
          operator: greaterThanOrEqual
          right:
            value:
              simple: '2'
      label: 'Yes'
    continueonerrortype: ''
    id: '10'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '33'
      'Yes':
      - '41'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: "Checks whether hard remediation should be performed. \n\nTo perform\
        \ hard remediation, all of the following conditions have to be met:\n\n1.\
        \ At least one user logged in successfully.\n2. At least one of the logged\
        \ in users has a High risk level (available with ITDR license).\n3. The interval\
        \ analysis suggests automation was used OR the failed logon attempts exceeded\
        \ the baseline for the host.\n4. The alert severity is Medium or above."
      id: 127f73d6-7905-4b90-8bcd-c90b22d515c5
      iscommand: false
      name: Any risky users to remediate?
      type: condition
      version: -1
    taskid: 127f73d6-7905-4b90-8bcd-c90b22d515c5
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 250,\n    \"y\": 1790\n  }\n}"
  '12':
    continueonerrortype: ''
    id: '12'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '50'
    note: false
    quietmode: 0
    scriptarguments:
      timestamps:
        simple: ${Core.OriginalAlert._all_events.event_timestamp}
      verbose:
        simple: 'false'
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Analyze a list of Unix timestamps in milliseconds, to detect simple
        patterns of consistency or high frequency. The script can aid in the investigation
        of multi-event alerts that contain a list of timestamps.
      id: 62b00df4-6f8c-42de-8a7c-b1b8bd3c6687
      iscommand: false
      name: Analyze intervals of login attempts
      scriptName: AnalyzeTimestampIntervals
      type: regular
      version: -1
    taskid: 62b00df4-6f8c-42de-8a7c-b1b8bd3c6687
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 230,\n    \"y\": 940\n  }\n}"
  '13':
    continueonerrortype: ''
    fieldMapping:
    - incidentfield: Affected Users
      output:
        complex:
          accessor: dst_identity
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: '

                    Core.OriginalAlert._all_events.outcome'
              operator: isEqualString
              right:
                value:
                  simple: SUCCESS
          root: '

            Core.OriginalAlert._all_events'
    id: '13'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '17'
    note: false
    quietmode: 0
    scriptarguments:
      append:
        simple: 'true'
      key:
        simple: SuccessfulLoginUsernames
      value:
        complex:
          accessor: dst_identity
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: Core.OriginalAlert._all_events.outcome
              operator: isEqualString
              right:
                value:
                  simple: SUCCESS
          root: Core.OriginalAlert._all_events
          transformers:
          - operator: uniq
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Saves the users who logged in successfully in a new context key.
      id: 9a1721f3-9a90-4353-8059-3ddcae71d872
      iscommand: false
      name: Save all usernames that logged in successfully
      scriptName: SetAndHandleEmpty
      type: regular
      version: -1
    taskid: 9a1721f3-9a90-4353-8059-3ddcae71d872
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 450,\n    \"y\": 635\n  }\n}"
  '14':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: SuccessfulLoginUsernames
          operator: isNotEmpty
          right:
            value: {}
      label: 'Yes'
    continueonerrortype: ''
    id: '14'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '50'
      'Yes':
      - '28'
      - '59'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Checks whether any logon attempt was successful.
      id: 249048f3-255d-46ae-8f9b-17cbeb9b41a6
      iscommand: false
      name: Any successful logins?
      type: condition
      version: -1
    taskid: 249048f3-255d-46ae-8f9b-17cbeb9b41a6
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 670,\n    \"y\": 940\n  }\n}"
  '15':
    continueonerrortype: ''
    id: '15'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '13'
    note: false
    quietmode: 0
    scriptarguments:
      alert_ids:
        simple: ${alert.id}
      filter_alert_fields:
        simple: 'false'
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Returns information about each alert ID.
      id: a3265e65-9c71-49d5-8083-f99a6e850cd9
      iscommand: true
      name: Get more information about the logon events
      script: '|||core-get-cloud-original-alerts'
      type: regular
      version: -1
    taskid: a3265e65-9c71-49d5-8083-f99a6e850cd9
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 450,\n    \"y\": 460\n  }\n}"
  '17':
    continueonerrortype: ''
    id: '17'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '14'
      - '12'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: f7b61352-1377-4bf8-8cd1-bb769476a36e
      iscommand: false
      name: Investigation
      type: title
      version: -1
    taskid: f7b61352-1377-4bf8-8cd1-bb769476a36e
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": 450,\n    \"y\": 800\n  }\n}"
  '22':
    continueonerrortype: ''
    id: '22'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '63'
      - '10'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: fcc95117-cf0a-4dfa-8c1c-4686e81b49fe
      iscommand: false
      name: Remediation
      type: title
      version: -1
    taskid: fcc95117-cf0a-4dfa-8c1c-4686e81b49fe
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": 450,\n    \"y\": 1650\n  }\n}"
  '28':
    continueonerrortype: ''
    id: '28'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '31'
    note: false
    quietmode: 0
    scriptarguments:
      user_id:
        complex:
          root: SuccessfulLoginUsernames
          transformers:
          - args:
              separator:
                value:
                  simple: ','
            operator: join
          - args:
              limit: {}
              replaceWith:
                value:
                  simple: \
              toReplace:
                value:
                  simple: \\
            operator: replace
          - args:
              delimiter:
                value:
                  simple: ','
            operator: split
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Gets the risk score of the users that successfully logged in.
      id: 43bc9013-8020-4de9-8208-394c78020139
      iscommand: true
      name: Get user risk score of logged in users
      script: '|||core-list-risky-users'
      type: regular
      version: -1
    taskid: 43bc9013-8020-4de9-8208-394c78020139
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 670,\n    \"y\": 1140\n  }\n}"
  '31':
    continueonerrortype: ''
    id: '31'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '50'
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: RiskyLogonUsernames
      value:
        complex:
          accessor: id
          filters:
          - - left:
                iscontext: true
                value:
                  simple: Core.RiskyUser.risk_level
              operator: isEqualString
              right:
                value:
                  simple: HIGH
          root: Core.RiskyUser
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Saves a separate list of users who successfully logged on as part
        of the attack, and were found risky.
      id: 6d6a74fe-0f38-4f5b-86a1-2892f7ebc777
      iscommand: false
      name: Save risky users that logged in (if exist)
      scriptName: SetAndHandleEmpty
      type: regular
      version: -1
    taskid: 6d6a74fe-0f38-4f5b-86a1-2892f7ebc777
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 670,\n    \"y\": 1300\n  }\n}"
  '33':
    continueonerrortype: ''
    id: '33'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    scriptarguments:
      id:
        simple: ${alert.id}
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: Close the current alert.
      id: 24dbf75b-e52b-4032-8786-2ad0d2749207
      iscommand: true
      name: Close alert
      script: Builtin|||closeInvestigation
      type: regular
      version: -1
    taskid: 24dbf75b-e52b-4032-8786-2ad0d2749207
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 430,\n    \"y\": 2630\n  }\n}"
  '41':
    continueonerrortype: ''
    id: '41'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '81'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 8621bbad-97f5-43c5-8cf8-e876a8d3b86b
      iscommand: false
      name: Risky User Remediation
      type: title
      version: -1
    taskid: 8621bbad-97f5-43c5-8cf8-e876a8d3b86b
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": 140,\n    \"y\": 1975\n  }\n}"
  '45':
    continueonerror: true
    continueonerrortype: ''
    id: '45'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '46'
    note: false
    quietmode: 0
    reputationcalc: 2
    scriptarguments:
      ip:
        simple: ${alert.localip}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Enriches the external source IP of the attack to check if it's
        known as malicious. Skips on errors for cases where the IP address or the
        !ip command is empty.
      id: e678030d-5c8d-4724-812e-98a36e8fbb80
      iscommand: true
      name: Check source IP reputation
      script: '|||ip'
      type: regular
      version: -1
    taskid: e678030d-5c8d-4724-812e-98a36e8fbb80
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 450,\n    \"y\": -155\n  }\n}"
  '46':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: DBotScore.Type
                    operator: isEqualString
                    right:
                      value:
                        simple: ip
                - - left:
                      iscontext: true
                      value:
                        simple: DBotScore.Score
                    operator: greaterThan
                    right:
                      value:
                        simple: '2'
                - - left:
                      iscontext: true
                      value:
                        simple: DBotScore.Indicator
                    operator: isEqualString
                    right:
                      iscontext: true
                      value:
                        simple: alert.localip.[0]
                root: DBotScore
          operator: isNotEmpty
          right:
            value: {}
      label: 'Yes'
    continueonerrortype: ''
    id: '46'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '15'
      'Yes':
      - '47'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Checks if the external Source IP is malicious (DBotScore above
        2).
      id: a1924082-41b3-47f8-8766-d268b29a9658
      iscommand: false
      name: Is the IP malicious?
      type: condition
      version: -1
    taskid: a1924082-41b3-47f8-8766-d268b29a9658
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 450,\n    \"y\": 5\n  }\n}"
  '47':
    continueonerrortype: ''
    id: '47'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '84'
      - '15'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 2ef06d13-aafd-4c49-8ad7-9a310e53e5bd
      iscommand: false
      name: Early Containment
      type: title
      version: -1
    taskid: 2ef06d13-aafd-4c49-8ad7-9a310e53e5bd
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": 200,\n    \"y\": 190\n  }\n}"
  '50':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: UsersToDisconnect
          operator: isNotEmpty
          right:
            value: {}
      - - left:
            iscontext: true
            value:
              simple: IntervalAnalysis.IsPatternLikelyAutomated
          operator: isTrue
        - left:
            iscontext: true
            value:
              simple: Core.OriginalAlert.stateful_raw_data.is_count_failed_users_above_baseline
          operator: isTrue
      label: 'Yes'
    continueonerrortype: ''
    id: '50'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '86'
      'Yes':
      - '22'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: "Checks whether soft remediation should be performed. \n\nTo perform\
        \ soft remediation, all of the following conditions have to be met:\n\n1.\
        \ At least one user logged in successfully.\n2. The interval analysis suggests\
        \ automation was used OR the failed logon attempts exceeded the baseline for\
        \ the host.\n"
      id: eec8611c-6037-420c-834f-44301675acb1
      iscommand: false
      name: Was a successful user login automated?
      type: condition
      version: -1
    taskid: eec8611c-6037-420c-834f-44301675acb1
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 450,\n    \"y\": 1480\n  }\n}"
  '59':
    continueonerrortype: ''
    id: '59'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '50'
    note: false
    quietmode: 0
    scriptarguments:
      append:
        simple: 'true'
      key:
        simple: UsersToDisconnect
      value:
        complex:
          root: SuccessfulLoginUsernames
          transformers:
          - args:
              limit: {}
              replaceWith:
                value:
                  simple: \
              toReplace:
                value:
                  simple: \\
            operator: replace
          - args:
              prefix:
                value:
                  simple: ''''
              suffix:
                value:
                  simple: ''''
            operator: concat
          - args:
              separator:
                value:
                  simple: ','
            operator: join
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Saves a general list of all the users that will require soft remediation.
        Specific types of remediation may need the names to appear in different structures
        or syntax.
      id: df38478e-ae21-469c-8454-bd65afc04aeb
      iscommand: false
      name: Prepare list of usernames for soft remediation
      scriptName: SetAndHandleEmpty
      type: regular
      version: -1
    taskid: df38478e-ae21-469c-8454-bd65afc04aeb
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 1080,\n    \"y\": 1140\n  }\n}"
  '63':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                accessor: hostos
                root: alert
                transformers:
                - operator: uniq
                - operator: FirstArrayElement
          operator: isEqualString
          right:
            value:
              simple: AGENT_OS_WINDOWS
      label: Windows
    continueonerrortype: ''
    id: '63'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '33'
      Windows:
      - '65'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Checks if the operating system reported by the agent of the machine
        to which the users logged in is Windows or another OS.
      id: a1372805-5f73-4b95-8359-7ac0c7646b9d
      iscommand: false
      name: Which OS is running on the host?
      type: condition
      version: -1
    taskid: a1372805-5f73-4b95-8359-7ac0c7646b9d
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 650,\n    \"y\": 1790\n  }\n}"
  '65':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                accessor: type
                filters:
                - - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: Core.OriginalAlert._all_events.login_data.outcome
                    operator: isEqualString
                    right:
                      value:
                        simple: SUCCESS
                root: Core.OriginalAlert._all_events.login_data
                transformers:
                - operator: uniq
          operator: containsGeneral
          right:
            value:
              simple: RemoteInteractive
      label: RemoteInteractive
    continueonerrortype: ''
    id: '65'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '33'
      RemoteInteractive:
      - '73'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Checks the logon type (E.g., Network, RemoteInteractive, etc) used
        in the attack.
      id: b6911013-8c0a-458c-8c31-77e98216dd96
      iscommand: false
      name: Which logon type was used?
      type: condition
      version: -1
    taskid: b6911013-8c0a-458c-8c31-77e98216dd96
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 650,\n    \"y\": 1960\n  }\n}"
  '67':
    continueonerrortype: ''
    id: '67'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '33'
    note: false
    quietmode: 0
    scriptarguments:
      commands:
        complex:
          root: RDPLogoffUsers
          transformers:
          - args:
              prefix:
                value:
                  simple: powershell -Command "$users = @(
              suffix:
                value:
                  simple: ) -split ';'; query user | Select-Object -Skip 1 | ForEach-Object
                    { $sessionInfo = $_ -split '\s+' | Where-Object { $_ -ne '' -and
                    $_ -notlike 'Disc' }; if ($sessionInfo.Length -ge 6) { $username
                    = $sessionInfo[0].TrimStart('>'); $sessionId = $sessionInfo[2];
                    if ($users -contains $username) { logoff $sessionId } } }"
            operator: concat
      endpoint_ids:
        simple: ${alert.agentid}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Initiates a shell command that runs a Powershell script. The script
        checks for active user sessions and terminates them in order to logoff offending
        users during interactive sessions.
      id: 868e45e4-7156-42ff-8e69-98cdd60d2a07
      iscommand: true
      name: Terminate RDP Session
      script: '|||core-run-script-execute-commands'
      type: regular
      version: -1
    taskid: 868e45e4-7156-42ff-8e69-98cdd60d2a07
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 650,\n    \"y\": 2290\n  }\n}"
  '73':
    continueonerrortype: ''
    id: '73'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '67'
    note: false
    quietmode: 0
    scriptarguments:
      append:
        simple: 'true'
      key:
        simple: RDPLogoffUsers
      value:
        complex:
          root: SuccessfulLoginUsernames
          transformers:
          - args:
              error_if_no_match: {}
              ignore_case: {}
              multi_line: {}
              period_matches_newline: {}
              regex:
                value:
                  simple: (?:\\+)(.*)
              unpack_matches: {}
            operator: RegexExtractAll
          - args:
              separator:
                value:
                  simple: ;
            operator: join
          - args:
              prefix:
                value:
                  simple: ''''
              suffix:
                value:
                  simple: ''''
            operator: concat
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: "Set a value in context under the key you entered. If no value\
        \ is entered, the script doesn't do anything.\n\nThis automation runs using\
        \ the default Limited User role, unless you explicitly change the permissions.\n\
        For more information, see the section about permissions here:\n- For Cortex\
        \ XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations\
        \ \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n\
        - For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      id: cc623958-b2a1-46ba-892e-c9e8988f72a1
      iscommand: false
      name: Prepare list of users for RDP session termination
      scriptName: SetAndHandleEmpty
      type: regular
      version: -1
    taskid: cc623958-b2a1-46ba-892e-c9e8988f72a1
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 650,\n    \"y\": 2130\n  }\n}"
  '81':
    continueonerrortype: ''
    form:
      description: Decide whether the password should be expired for users who have
        successfully logged in.
      expired: false
      questions:
      - defaultrows: []
        fieldassociated: ''
        gridcolumns: []
        id: '0'
        label: ''
        labelarg:
          simple: Choose the risky users whose passwords will be expired.
        options: []
        optionsarg:
        - complex:
            root: RiskyLogonUsernames
            transformers:
            - operator: uniq
        placeholder: ''
        readonly: false
        required: false
        tooltip: ''
        type: multiSelect
      sender: ''
      title: Password Expiration - Risky Users
      totalanswers: 0
    id: '81'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    message:
      bcc: null
      body: null
      cc: null
      format: ''
      methods: []
      subject: null
      timings:
        completeafterreplies: 1
        completeaftersla: false
        completeafterv2: true
        retriescount: 2
        retriesinterval: 360
      to: null
    nexttasks:
      '#none#':
      - '83'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Asks the analyst to choose users whose passwords will be expired.
      id: 1a4db1bf-2951-49ce-8054-2dbf6ef1be99
      iscommand: false
      name: Choose risky users for password expiration
      type: collection
      version: -1
    taskid: 1a4db1bf-2951-49ce-8054-2dbf6ef1be99
    timertriggers: []
    type: collection
    view: "{\n  \"position\": {\n    \"x\": 140,\n    \"y\": 2130\n  }\n}"
  '82':
    continueonerrortype: ''
    id: '82'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '33'
    note: false
    quietmode: 0
    scriptarguments:
      username:
        complex:
          accessor: '0'
          root: Password Expiration - Risky Users.Answers
          transformers:
          - args:
              error_if_no_match: {}
              ignore_case: {}
              multi_line: {}
              period_matches_newline: {}
              regex:
                value:
                  simple: (?:.*\\)?(.*)
              unpack_matches: {}
            operator: RegexExtractAll
          - args:
              empty_values: {}
              remove_keys:
                value:
                  simple: 'true'
            operator: RemoveEmpty
          - operator: uniq
    separatecontext: false
    skipunavailable: true
    task:
      brand: ''
      description: Expires the passwords of the selected risky users.
      id: fe2e0381-5631-4733-8e7c-4568bd50d8df
      iscommand: true
      name: Expire the user passwords
      script: '|||ad-expire-password'
      type: regular
      version: -1
    taskid: fe2e0381-5631-4733-8e7c-4568bd50d8df
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 140,\n    \"y\": 2460\n  }\n}"
  '83':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: '0'
                root: Password Expiration - Risky Users.Answers
                transformers:
                - operator: uniq
          operator: isNotEmpty
          right:
            value: {}
      label: 'yes'
    continueonerrortype: ''
    id: '83'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '33'
      'yes':
      - '82'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Checks whether any user was selected for password expiration.
      id: df8dec46-2cf0-4e44-862d-7fa7be602027
      iscommand: false
      name: Was any user selected?
      type: condition
      version: -1
    taskid: df8dec46-2cf0-4e44-862d-7fa7be602027
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 140,\n    \"y\": 2290\n  }\n}"
  '84':
    continueonerrortype: ''
    id: '84'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - '86'
    note: false
    quietmode: 0
    scriptarguments:
      MaliciousIPs:
        complex:
          accessor: localip
          root: alert
          transformers:
          - operator: uniq
          - operator: FirstArrayElement
    separatecontext: true
    skipunavailable: true
    task:
      brand: ''
      description: 'This playbook blocks IP addresses with 2 optional actions:


        - Block IP addresses using Static Address Groups in Palo Alto Networks Panorama
        or Firewall. The playbook receives malicious IP addresses and an address group
        name as inputs, verifies that the addresses are not already a part of the
        address group, adds them and commits the configuration.



        - Utilize the Dynamic Address Group (DAG) capability of PAN-OS. DAG enables
        analysts to create a rule one time, where the group is the source/destination,
        and adds IP addresses dynamically without the need to commit the configuration
        every time.

        The playbook checks if the given tag already exists. If the tag exists, then
        the IP address is added to the tag.

        If the tag does not exist, a new address group is created with the given tag
        and a matching rule, and the configuration is committed.'
      id: 7796a846-df10-4734-8974-d253ae9a6db3
      iscommand: false
      name: PAN-OS - Block IP
      playbookName: PAN-OS - Block IP
      type: playbook
      version: -1
    taskid: 7796a846-df10-4734-8974-d253ae9a6db3
    timertriggers: []
    type: playbook
    view: "{\n  \"position\": {\n    \"x\": 200,\n    \"y\": 320\n  }\n}"
  '86':
    continueonerrortype: ''
    id: '86'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '33'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: b60ffcc8-827d-4c93-897f-5811dd2aff58
      iscommand: false
      name: Continue
      type: title
      version: -1
    taskid: b60ffcc8-827d-4c93-897f-5811dd2aff58
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": -320,\n    \"y\": 2490\n  }\n}"
tests:
- no tests
version: -1
view: "{\n  \"linkLabelsPosition\": {\n    \"10_33_#default#\": 0.1,\n    \"14_50_#default#\"\
  : 0.22,\n    \"46_15_#default#\": 0.14,\n    \"46_47_Yes\": 0.4,\n    \"50_22_Yes\"\
  : 0.39,\n    \"50_86_#default#\": 0.18,\n    \"63_33_#default#\": 0.18,\n    \"\
  63_65_Windows\": 0.52,\n    \"65_33_#default#\": 0.21,\n    \"65_73_RemoteInteractive\"\
  : 0.69,\n    \"83_33_#default#\": 0.49\n  },\n  \"paper\": {\n    \"dimensions\"\
  : {\n      \"height\": 3015,\n      \"width\": 1780,\n      \"x\": -320,\n     \
  \ \"y\": -290\n    }\n  }\n}"
