id: Netcat makes or gets connections
version: -1
name: Netcat makes or gets connections
description: "# Netcat Connection Alert Response Playbook\n\n## Overview\nThis playbook is designed to automatically respond to \"Netcat makes or gets connections\" alerts. It checks for malicious reputation or previous related alerts, and takes appropriate action if necessary, such as killing the malicious process.\n\n## Use Cases\n- Detect and respond to potential network-based malicious activity using the Netcat tool.\n- Investigate and mitigate the impact of Netcat-related security incidents.\n- Streamline the response process for \"Netcat makes or gets connections\" alerts.\n\n## Playbook Flow\n1. **Trigger**: The playbook is triggered by a \"Netcat makes or gets connections\" alert.\n2. **Check Reputation**: The playbook checks the reputation of the IP address or domain associated with the Netcat connection.\n3. **Check Previous Alerts**: The playbook searches for any previous related alerts.\n4. **Evaluate Threat Level**: Based on the reputation and previous alert information, the playbook determines the threat and if a response action is needed.\n5. **Respond and Mitigate**: If the threat level is deemed high, the playbook takes the following remediation action:\n   - Killing the malicious process."
tags:
- T1090 - Proxy
- TA0011-Command and Control
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 2a5e2861-855c-46f5-8ad9-8f590911a599
    type: start
    task:
      id: 2a5e2861-855c-46f5-8ad9-8f590911a599
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "25"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": -410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: 35970fa0-12e2-4aaf-8097-0f5d8f394779
    type: title
    task:
      id: 35970fa0-12e2-4aaf-8097-0f5d8f394779
      version: -1
      name: Analysis
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "35"
      - "36"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 425
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "15":
    id: "15"
    taskid: eab8d7c1-7fc0-45ac-8035-023d7d24de8c
    type: regular
    task:
      id: eab8d7c1-7fc0-45ac-8035-023d7d24de8c
      version: -1
      name: Get IP prevalence
      description: Get the prevalence of an IP, identified by ip_address.
      script: '|||core-get-IP-analytics-prevalence'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "21"
    scriptarguments:
      ip_address:
        complex:
          root: alert
          accessor: remoteip
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 730,
          "y": 900
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 87d8ba03-c9f1-4c12-88f8-17c1a72acbbf
    type: regular
    task:
      id: 87d8ba03-c9f1-4c12-88f8-17c1a72acbbf
      version: -1
      name: Get Domain Name reputation
      description: Checks the reputation of a domain.
      script: '|||domain'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "21"
    scriptarguments:
      domain:
        simple: ${alert.dnsqueryname}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 140,
          "y": 900
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: 85dafa8d-8c75-465f-8699-27d29a01682d
    type: regular
    task:
      id: 85dafa8d-8c75-465f-8699-27d29a01682d
      version: -1
      name: Get destination IP reputation
      description: Checks the specified IP address against the AbuseIP database.
      script: '|||ip'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "15"
    scriptarguments:
      ip:
        complex:
          root: alert
          accessor: remoteip
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 730,
          "y": 715
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: 61055de3-bb9f-4984-8da3-45fdc40479ba
    type: title
    task:
      id: 61055de3-bb9f-4984-8da3-45fdc40479ba
      version: -1
      name: Execute Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "41"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1945
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: ccf44f37-71f0-4852-8606-640213d46253
    type: condition
    task:
      id: ccf44f37-71f0-4852-8606-640213d46253
      version: -1
      name: Check if Domain Name Exist?
      description: Checks if the domain name in the alert exists.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "21"
      "yes":
      - "16"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: alert.dnsqueryname
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 140,
          "y": 715
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: 55b7d40a-0f6c-4ed8-8689-c7ec3c842dbd
    type: regular
    task:
      id: 55b7d40a-0f6c-4ed8-8689-c7ec3c842dbd
      version: -1
      name: Get Commandline prevalence
      description: Get the prevalence of a process_command_line, identified by process_command_line.
      script: '|||core-get-cmd-analytics-prevalence'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "30"
    scriptarguments:
      process_command_line:
        simple: ${alert.osparentcmd}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1075
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: c6c19d37-04a8-4d09-8bca-3ef43b270e5f
    type: title
    task:
      id: c6c19d37-04a8-4d09-8bca-3ef43b270e5f
      version: -1
      name: Done
      description: commands.local.cmd.close.inv
      type: title
      iscommand: false
      brand: Builtin
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2450
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: bfbce647-7068-4dbc-8450-d3b7436aeca4
    type: title
    task:
      id: bfbce647-7068-4dbc-8450-d3b7436aeca4
      version: -1
      name: Investigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "39"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1450
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: 939d4df1-3b9d-4a02-8634-59f622bffba6
    type: regular
    task:
      id: 939d4df1-3b9d-4a02-8634-59f622bffba6
      version: -1
      name: Check Previous similar Alerts
      description: |-
        Finds past similar alerts based on alert fields' similarity. Includes an option to also display indicators similarity.
        Note: For the similarity calculation, at least one field must be provided in one of the "similarTextField", "similarCategoricalField", or "similarJsonField" arguments.
      scriptName: DBotFindSimilarAlerts
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "33"
    scriptarguments:
      query:
        simple: resolution_status:"STATUS_060_RESOLVED_FALSE_POSITIVE"
      similarTextField:
        simple: name
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": -275
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: 904dd046-4637-4204-87b8-2f5e4a4eb7dd
    type: regular
    task:
      id: 904dd046-4637-4204-87b8-2f5e4a4eb7dd
      version: -1
      name: Get Extra Data for DNS query name
      description: Returns information about each alert ID.
      script: '|||core-get-cloud-original-alerts'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "29"
    scriptarguments:
      alert_ids:
        complex:
          root: alert
          accessor: id
          transformers:
          - operator: uniq
      filter_alert_fields:
        simple: "false"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 75
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: 05b1c3b4-24f9-4033-89dc-fa548b12a39d
    type: condition
    task:
      id: 05b1c3b4-24f9-4033-89dc-fa548b12a39d
      version: -1
      name: Destination IP is External?
      description: Checks if the destination IP of the alert is external.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "32"
      External:
      - "13"
    separatecontext: false
    conditions:
    - label: External
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: Core.raw_abioc.event.dst_is_internal_ip
            iscontext: true
          right:
            value:
              simple: "False"
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: cea0114f-3b50-4d37-86ba-5c31855cdc15
    type: condition
    task:
      id: cea0114f-3b50-4d37-86ba-5c31855cdc15
      version: -1
      name: Malicious reputation found?
      description: ""
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "24"
      Malicious:
      - "19"
      Prevalent:
      - "32"
    separatecontext: false
    conditions:
    - label: Malicious
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: IP.Malicious
            iscontext: true
          right:
            value: {}
        - operator: isNotEmpty
          left:
            value:
              simple: Domain.Malicious
            iscontext: true
          ignorecase: true
    - label: Prevalent
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: Core.AnalyticsPrevalence.Ip.data.local_prevalence.value
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
      - - operator: isEqualString
          left:
            value:
              simple: Core.AnalyticsPrevalence.Cmd.data.local_prevalence.value
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1245
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: c699e8c2-a6d9-42ac-872a-e52b0cce4e09
    type: condition
    task:
      id: c699e8c2-a6d9-42ac-872a-e52b0cce4e09
      version: -1
      name: Found Relevenat Previous Alert?
      description: Checks if there are any relevant previous alerts.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "32"
      True Positive:
      - "19"
    separatecontext: false
    conditions:
    - label: True Positive
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: foundIncidents
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1760
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: 2bb1dd37-71d9-470a-83ad-0e150d64b61a
    type: title
    task:
      id: 2bb1dd37-71d9-470a-83ad-0e150d64b61a
      version: -1
      name: False Positive
      description: Set a value in context under the key you entered.
      type: title
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "40"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 950,
          "y": 1935
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: a207b768-8579-4094-817f-a4e11c6dcded
    type: condition
    task:
      id: a207b768-8579-4094-817f-a4e11c6dcded
      version: -1
      name: Similar False Positive Alerts Found?
      description: Checks if similar false positive alerts have been found. 
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "27"
      "yes":
      - "32"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isTrue
          left:
            value:
              simple: DBotFindSimilarIncidents.isSimilarIncidentFound
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": -110
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: 8f045a85-4327-4ec2-8803-b92526a20bec
    type: regular
    task:
      id: 8f045a85-4327-4ec2-8803-b92526a20bec
      version: -1
      name: Close the Alert as True Positive
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "23"
    scriptarguments:
      closeReason:
        simple: STATUS_090_RESOLVED_TRUE_POSITIVE
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2275
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: fbbb35a7-69be-46c5-8831-abec5285a2b1
    type: title
    task:
      id: fbbb35a7-69be-46c5-8831-abec5285a2b1
      version: -1
      name: IP
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "18"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 730,
          "y": 570
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: e9ada220-b859-4f78-8d5b-40684b8e5fa3
    type: title
    task:
      id: e9ada220-b859-4f78-8d5b-40684b8e5fa3
      version: -1
      name: Domain
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "20"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 140,
          "y": 570
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: a5799de6-6673-4ffb-8f04-4fc35ee16fa8
    type: regular
    task:
      id: a5799de6-6673-4ffb-8f04-4fc35ee16fa8
      version: -1
      name: Search related alerts by  MITRE technique
      description: |+
        This task searches for suspicious alerts related to incident by mitre techniques that may indicate a compromised user.
        Focus on identifying alerts associated with the following MITRE techniques & tactics:
        - T1059- Command and Scripting Interpreter
        - T1072 - Software Deployment Tools
        - TA0010 - Exfiltration
        - T0006 - Credential Access






      scriptName: SearchAlertsV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      query:
        complex:
          root: alert
          accessor: parentXDRIncident
          transformers:
          - operator: Cut
            args:
              delimiter:
                value:
                  simple: '-'
              fields:
                value:
                  simple: "2"
          - operator: concat
            args:
              prefix:
                value:
                  simple: '(mitreattcktechnique:*T1059* or mitreattcktechnique:*T1072* or mitreattcktactic:*TA0010* or mitreattcktactic:*TA0006*) and caseid:'
              suffix: {}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1600
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: f010b721-9bbf-4bd2-836d-ab0e79d3793d
    type: regular
    task:
      id: f010b721-9bbf-4bd2-836d-ab0e79d3793d
      version: -1
      name: Close the Alert as False Positive
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "23"
    scriptarguments:
      closeReason:
        simple: STATUS_060_RESOLVED_FALSE_POSITIVE
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 950,
          "y": 2275
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "41":
    id: "41"
    taskid: 796f08e4-11e5-49c2-86bc-5fcc8f734672
    type: regular
    task:
      id: 796f08e4-11e5-49c2-86bc-5fcc8f734672
      version: -1
      name: Terminate Causality (CGO)
      description: Terminate a process tree by its causality ID. Available only for XSIAM 2.4.
      script: '|||core-terminate-causality'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "34"
    scriptarguments:
      agent_id:
        simple: ${alert.agentid}
      causality_id:
        simple: ${alert.cid}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2100
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "20_16_yes": 0.54,
      "29_13_External": 0.48,
      "30_19_Malicious": 0.14,
      "30_32_Prevalent": 0.13,
      "31_19_True Positive": 0.89
    },
    "paper": {
      "dimensions": {
        "height": 2925,
        "width": 1190,
        "x": 140,
        "y": -410
      }
    }
  }
inputs:
- key: InternalRange
  value:
    complex:
      root: lists
      accessor: PrivateIPs
      transformers:
      - operator: RegexExtractAll
        args:
          error_if_no_match: {}
          ignore_case: {}
          multi_line: {}
          period_matches_newline: {}
          regex:
            value:
              simple: (\b(?:\d{1,3}\.){3}\d{1,3}\b/\d{1,2})
          unpack_matches: {}
      - operator: join
        args:
          separator:
            value:
              simple: ','
  required: false
  description: 'A list of internal IP ranges to check IP addresses against. The comma-separated list should be provided in CIDR notation. For example, a list of ranges would be: "172.16.0.0/12,10.0.0.0/8,192.168.0.0/16" (without quotes).'
  playbookInputQuery:
inputSections:
- inputs:
  - InternalRange
  name: General (Inputs group)
  description: Generic group for inputs
outputSections:
- outputs: []
  name: General (Outputs group)
  description: Generic group for outputs
outputs: []
tests:
- No tests (auto formatted)
fromversion: 6.10.0
