id: Local Analysis alert Investigation
version: -1
name: Local Analysis alert Investigation
description: |-
  When an unknown executable, DLL, or macro attempts to run on a Windows or Mac endpoint, the Cortex XDR agent uses local analysis to determine if it is likely to be malware. Local analysis uses a static set of pattern-matching rules that inspect multiple file features and attributes, and a statistical model that was developed with machine learning on WildFire threat intelligence.

  **Investigative Actions:**

  Investigate the executed process image and verify if it is malicious using:

  * XDR trusted signers
  * VT trusted signers
  * VT detection rate
  * NSRL DB

  **Response Actions**

  The playbook's first response action is a containment plan that is based on the initial data provided within the alert. In that phase, the playbook will execute:

  * Auto block indicators
  * Auto file quarantine
  * Manual endpoint isolation

  When the playbook executes, it checks for additional activity using the Endpoint Investigation Plan playbook, and another phase, which includes containment and eradication, is executed.

  This phase will execute the following containment actions:

  * Manual block indicators
  * Manual file quarantine
  * Auto endpoint isolation

  And the following eradication actions:

  * Manual process termination
  * Manual file deletion
  * Manual reset of the userâ€™s password

  External resources:

  [Malware Protection Flow](https://docs.paloaltonetworks.com/traps/4-2/traps-endpoint-security-manager-admin/malware-protection/malware-protection-flow)
starttaskid: '0'
tasks:
  '0':
    id: '0'
    taskid: a7406ab9-8ead-462b-8edb-b1a42c1ee926
    type: start
    task:
      id: a7406ab9-8ead-462b-8edb-b1a42c1ee926
      version: -1
      name: ''
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '3'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 430,
          "y": -900
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '2':
    id: '2'
    taskid: 762b80b1-46c9-4791-883d-9a23a20a373a
    type: condition
    task:
      id: 762b80b1-46c9-4791-883d-9a23a20a373a
      version: -1
      name: Continue by Verdict
      description: Checks the verdict returned by the 'Enrichment for Verdict' playbook.
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - '33'
      True Positive:
      - '6'
    separatecontext: false
    conditions:
    - label: True Positive
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: FileVerdict
            iscontext: true
          right:
            value:
              simple: Suspicious
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 430,
          "y": -480
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '3':
    id: '3'
    taskid: 95780e0a-e062-42ef-8023-633fd90a32ca
    type: title
    task:
      id: 95780e0a-e062-42ef-8023-633fd90a32ca
      version: -1
      name: Analysis
      type: title
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '61'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 430,
          "y": -765
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '6':
    id: '6'
    taskid: 7fc9ca7d-ee00-4e76-83e3-1d1ccb61e008
    type: condition
    task:
      id: 7fc9ca7d-ee00-4e76-83e3-1d1ccb61e008
      version: -1
      name: 'Was the action prevented? '
      description: Checks if the file execution was prevented.
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - '57'
      Blocked:
      - '35'
    separatecontext: false
    conditions:
    - label: Blocked
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: alert
                accessor: action
            iscontext: true
          right:
            value:
              simple: BLOCKED
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 900,
          "y": -310
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '14':
    id: '14'
    taskid: db8e53a5-0c3e-4096-805f-404bcd7a0b48
    type: condition
    task:
      id: db8e53a5-0c3e-4096-805f-404bcd7a0b48
      version: -1
      name: Check WF alert verdict
      description: Checks the WildFire verdict.
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - '39'
      Benign:
      - "77"
    separatecontext: false
    conditions:
    - label: Benign
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: WildFire.Verdicts
                accessor: Verdict
            iscontext: true
          right:
            value:
              simple: '0'
        - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.GraywareAsMalware
            iscontext: true
          right:
            value:
              simple: 'False'
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.ShouldRescanBenign
            iscontext: true
          right:
            value:
              simple: 'True'
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 900,
          "y": 875
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '33':
    id: '33'
    taskid: 365fa7b4-058c-4ff7-834a-0dcc4009fc42
    type: title
    task:
      id: 365fa7b4-058c-4ff7-834a-0dcc4009fc42
      version: -1
      name: Handle FP
      type: title
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - "75"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 430,
          "y": 1640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '34':
    id: '34'
    taskid: 1f7b5164-cccd-4e9f-8b63-0e7c79448c20
    type: condition
    task:
      id: 1f7b5164-cccd-4e9f-8b63-0e7c79448c20
      version: -1
      name: Manual review - was it your security vendor?
      description: |+
        Was it your security vendor?
        Script from your IT?

        ....

      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      No:
      - '39'
      "Yes":
      - "67"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 430,
          "y": 2075
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '35':
    id: '35'
    taskid: 3bb94a23-82c4-4c00-84fa-0228b084583b
    type: title
    task:
      id: 3bb94a23-82c4-4c00-84fa-0228b084583b
      version: -1
      name: WildFire Verdict
      type: title
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '14'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 900,
          "y": 690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '39':
    id: '39'
    taskid: 920e8ad9-ccf9-4b82-8375-b17b2c26eb42
    type: title
    task:
      id: 920e8ad9-ccf9-4b82-8375-b17b2c26eb42
      version: -1
      name: Investigate
      type: title
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '63'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 900,
          "y": 2370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '41':
    id: '41'
    taskid: ed0d81e9-adf9-41d1-84db-9087868cd0cf
    type: title
    task:
      id: ed0d81e9-adf9-41d1-84db-9087868cd0cf
      version: -1
      name: Remediation
      type: title
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '64'
      - '65'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 900,
          "y": 2910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '44':
    id: '44'
    taskid: 1131ba86-e2f3-4e90-8ab5-7281c5630145
    type: condition
    task:
      id: 1131ba86-e2f3-4e90-8ab5-7281c5630145
      version: -1
      name: Found relevant information?
      description: Checks if other alerts were found on the endpoint.
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - "47"
      yes:
      - '41'
      - "76"
    separatecontext: false
    conditions:
    - label: yes
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: FoundIncidents
            iscontext: true
          right:
            value: {}
    view: |-
      {
        "position": {
          "x": 900,
          "y": 2670
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '45':
    id: '45'
    taskid: 13ddb69e-6c8a-4a92-83e6-d77d652fd625
    type: regular
    task:
      id: 13ddb69e-6c8a-4a92-83e6-d77d652fd625
      version: -1
      name: Close alert
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - '51'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 900,
          "y": 4090
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '46':
    id: '46'
    taskid: a3c1d4d1-3242-47cd-81aa-28d10f0bd155
    type: condition
    task:
      id: a3c1d4d1-3242-47cd-81aa-28d10f0bd155
      version: -1
      name: Restore affected endpoint?
      description: Whether to execute the Recovery Plan playbook.
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - '47'
      yes:
      - '66'
    separatecontext: false
    conditions:
    - label: yes
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.AutoRecovery
            iscontext: true
          right:
            value:
              simple: 'True'
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 900,
          "y": 3410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '47':
    id: '47'
    taskid: b8a41bf5-ad48-43c0-8a8b-67ccfa036bb0
    type: condition
    task:
      id: b8a41bf5-ad48-43c0-8a8b-67ccfa036bb0
      version: -1
      name: Close alert automatically?
      description: Whether to close the alert automatically.
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - '48'
      yes:
      - '45'
    separatecontext: false
    conditions:
    - label: yes
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.AutoCloseAlert
            iscontext: true
          right:
            value:
              simple: 'True'
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 900,
          "y": 3750
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '48':
    id: '48'
    taskid: 8deecef6-2dcc-4135-8f36-540935d5020f
    type: regular
    task:
      id: 8deecef6-2dcc-4135-8f36-540935d5020f
      version: -1
      name: Continue with the incident investigation
      description: Continue manually with the alert investigation.
      type: regular
      iscommand: false
      brand: ''
    nexttasks:
      '#none#':
      - '45'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1270,
          "y": 3920
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '50':
    id: '50'
    taskid: 82f5864b-14de-428e-87c0-d04ff9ec40e4
    type: title
    task:
      id: 82f5864b-14de-428e-87c0-d04ff9ec40e4
      version: -1
      name: Recovery
      type: title
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '46'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 900,
          "y": 3255
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '51':
    id: '51'
    taskid: 7b89c9aa-8804-472e-8013-09dc91fd2901
    type: title
    task:
      id: 7b89c9aa-8804-472e-8013-09dc91fd2901
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ''
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 430,
          "y": 4270
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '54':
    id: '54'
    taskid: 5ef91412-e2ac-46b3-8558-107fe4093b00
    type: title
    task:
      id: 5ef91412-e2ac-46b3-8558-107fe4093b00
      version: -1
      name: Pre-Investigation Containment
      type: title
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '58'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1410,
          "y": 180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '55':
    id: '55'
    taskid: 2f9b0888-8966-46ed-856d-129f2e692d53
    type: condition
    task:
      id: 2f9b0888-8966-46ed-856d-129f2e692d53
      version: -1
      name: Check hash execution timestamp
      description: Checks for the hash execution timestamp.
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - '35'
      24H:
      - '54'
    separatecontext: false
    conditions:
    - label: 24H
      condition:
      - - operator: greaterThanOrEqual
          left:
            value:
              complex:
                root: alert
                accessor: autime
            iscontext: true
          right:
            value:
              complex:
                root: LastDayTimeNowUnix
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1410,
          "y": 20
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '57':
    id: '57'
    taskid: 65d493b5-8684-407f-8654-7443c95a6a15
    type: regular
    task:
      id: 65d493b5-8684-407f-8654-7443c95a6a15
      version: -1
      name: Get time for the last day
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ''
    nexttasks:
      '#none#':
      - '55'
    scriptarguments:
      contextKey:
        simple: LastDay
      daysAgo:
        simple: '1'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1410,
          "y": -140
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '58':
    id: '58'
    taskid: d0251c23-0d6f-43e5-813d-aeab89008b32
    type: condition
    task:
      id: d0251c23-0d6f-43e5-813d-aeab89008b32
      version: -1
      name: Is auto-containment set to true?
      description: Checks the AutoContainment input.
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - '35'
      yes:
      - '62'
    separatecontext: false
    conditions:
    - label: yes
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.AutoContainment
                transformers:
                - operator: toLowerCase
            iscontext: true
          right:
            value:
              simple: 'true'
    view: |-
      {
        "position": {
          "x": 1410,
          "y": 320
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '59':
    id: '59'
    taskid: 70e962f2-78c7-4e6d-8516-75f2eed67764
    type: regular
    task:
      id: 70e962f2-78c7-4e6d-8516-75f2eed67764
      version: -1
      name: Retrieve the suspected file
      description: Retrieves files from selected endpoints. You can retrieve up to 20 files, from no more than 10 endpoints. At least one endpoint ID and one file path are necessary in order to run the command. After running this command, you can use the core-action-status-get command with returned action_id, to check the action status.
      script: '|||core-retrieve-files'
      type: regular
      iscommand: true
      brand: ''
    nexttasks:
      '#none#':
      - '60'
    scriptarguments:
      endpoint_ids:
        complex:
          root: alert
          accessor: agentid
      windows_file_paths:
        complex:
          root: alert
          accessor: initiatorpath
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1280,
          "y": 1720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '60':
    id: '60'
    taskid: f8d13237-59bf-4980-8168-dc1c9a253f21
    type: regular
    task:
      id: f8d13237-59bf-4980-8168-dc1c9a253f21
      version: -1
      name: Get retrieved file
      description: View the file retrieved by the core-retrieve-files command according to the action ID. Before running this command, you can use the core-action-status-get command to check if this action completed successfully.
      script: '|||core-retrieve-file-details'
      type: regular
      iscommand: true
      brand: ''
    nexttasks:
      '#none#':
      - '68'
    scriptarguments:
      action_id:
        complex:
          root: Core.RetrievedFiles
          accessor: action_id
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1280,
          "y": 1880
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '61':
    id: '61'
    taskid: 5014f36a-3191-46f7-8caa-40f5ee33d4fd
    type: playbook
    task:
      id: 5014f36a-3191-46f7-8caa-40f5ee33d4fd
      version: -1
      name: Enrichment for Verdict
      playbookName: Enrichment for Verdict
      type: playbook
      iscommand: false
      brand: ''
      description: 'This playbook checks prior alert closing reasons and performs enrichment and prevalence checks on different IOC types. It then returns the information needed to establish the alert''s verdict.'
    nexttasks:
      '#none#':
      - '2'
    separatecontext: true
    view: |-
      {
        "position": {
          "x": 430,
          "y": -640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    scriptarguments:
      CloseReason:
        simple: Resolved - False Positive,Resolved - Duplicate Incident,Resolved - Known Issue
      Domain:
        complex:
          root: alert
          accessor: domainname
      FileSHA256:
        complex:
          root: alert
          accessor: initiatorsha256
      IP:
        complex:
          root: alert
          accessor: hostip
      URL:
        complex:
          root: alert
          accessor: url
      User:
        complex:
          root: alert
          accessor: username
      query:
        simple: (initiatorsha256:${alert.initiatorsha256.[0]} or hostip:${alert.hostip.[0]}) and sourceBrand:"${alert.sourceBrand}" and name:"${alert.name}"
      threshold:
        simple: "5"
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
  '62':
    id: '62'
    taskid: e5dad5e0-215d-4537-8912-86a93f3c5bef
    type: playbook
    task:
      id: e5dad5e0-215d-4537-8912-86a93f3c5bef
      version: -1
      name: Containment Plan
      description: "This playbook handles all the containment actions available with Cortex XSIAM, including:  \n* Isolate endpoint\n* Disable account\n* Quarantine file\n* Block indicators\n* Clear user session (currently, the playbook supports only Okta)\n\nNote: The playbook inputs enable manipulating the execution flow; read the input descriptions for details."
      playbookName: Containment Plan
      type: playbook
      iscommand: false
      brand: ''
    nexttasks:
      '#none#':
      - '35'
    scriptarguments:
      AutoContainment:
        complex:
          root: inputs.AutoContainment
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: 'true'
      BlockIndicators:
        simple: 'True'
      ClearUserSessions:
        simple: 'False'
      EndpointID:
        complex:
          root: alert
          accessor: agentid
      FileContainment:
        simple: 'True'
      FileHash:
        complex:
          root: alert
          filters:
          - - operator: isNotEqualString
              left:
                value:
                  simple: alert.initiatorpath
                iscontext: true
              right:
                value:
                  simple: c:\windows\explorer.exe
              ignorecase: true
          accessor: initiatorsha256
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: alert.targetprocesssha256
                iscontext: true
      FilePath:
        complex:
          root: alert.initiatorpath
          filters:
          - - operator: isNotEqualString
              left:
                value:
                  simple: alert.initiatorpath
                iscontext: true
              right:
                value:
                  simple: c:\windows\explorer.exe
              ignorecase: true
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: alert.targetprocesscmd
                iscontext: true
          - operator: replaceMatch
            args:
              regex:
                value:
                  simple: \"
              replaceWith: {}
      FileRemediation:
        simple: Quarantine
      HostContainment:
        simple: 'True'
      IAMUserDomain:
        simple: '@demisto.com'
      UserContainment:
        simple: 'True'
      Username:
        complex:
          root: alert
          accessor: username
          transformers:
          - operator: uniq
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ''
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1410,
          "y": 510
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '63':
    id: '63'
    taskid: fb368c9f-ccb4-40e1-8010-f664993677ab
    type: playbook
    task:
      id: fb368c9f-ccb4-40e1-8010-f664993677ab
      version: -1
      name: Endpoint Investigation Plan
      description: "This playbook handles all the endpoint investigation actions available with Cortex XSIAM, including the following tasks:\n* Pre-defined MITRE tactics\n* Host fields (Host ID)\n* Attacker fields (Attacker IP, External host)\n* MITRE techniques\n* File hash (currently, the playbook supports only SHA256)  \n\nNote: The playbook inputs enable manipulating the execution flow; read the input descriptions for details."
      playbookName: Endpoint Investigation Plan
      type: playbook
      iscommand: false
      brand: ''
    nexttasks:
      '#none#':
      - '44'
    scriptarguments:
      HuntCnCTechniques:
        simple: 'True'
      HuntCollectionTechniques:
        simple: 'True'
      HuntDefenseEvasionTechniques:
        simple: 'True'
      HuntDiscoveryTechniques:
        simple: 'True'
      HuntExecutionTechniques:
        simple: 'True'
      HuntImpactTechniques:
        simple: 'True'
      HuntInitialAccessTechniques:
        simple: 'True'
      HuntLateralMovementTechniques:
        simple: 'True'
      HuntPersistenceTechniques:
        simple: 'True'
      HuntPrivilegeEscalationTechniques:
        simple: 'True'
      HuntReconnaissanceTechniques:
        simple: 'True'
      agentID:
        complex:
          root: alert
          accessor: agentid
      timeRange:
        simple: 2 hours ago
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ''
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 900,
          "y": 2500
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '64':
    id: '64'
    taskid: d544afa6-3c28-4fb9-8320-5554953744de
    type: playbook
    task:
      id: d544afa6-3c28-4fb9-8320-5554953744de
      version: -1
      name: Containment Plan
      description: "This playbook handles all the containment actions available with Cortex XSIAM, including:  \n* Isolate endpoint\n* Disable account\n* Quarantine file\n* Block indicators\n* Clear user session (currently, the playbook supports only Okta)\n\nNote: The playbook inputs enable manipulating the execution flow; read the input descriptions for details."
      playbookName: Containment Plan
      type: playbook
      iscommand: false
      brand: ''
    nexttasks:
      '#none#':
      - '50'
    scriptarguments:
      AutoContainment:
        complex:
          root: inputs.AutoContainment
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: 'false'
      BlockIndicators:
        simple: 'True'
      ClearUserSessions:
        simple: 'True'
      EndpointID:
        complex:
          root: alert
          accessor: agentid
      FileContainment:
        simple: 'True'
      FileHash:
        complex:
          root: foundIncidents.CustomFields
          filters:
          - - operator: isNotEqualString
              left:
                value:
                  simple: foundIncidents.CustomFields.initiatorpath
                iscontext: true
              right:
                value:
                  simple: c:\windows\explorer.exe
              ignorecase: true
          accessor: initiatorsha256
      FilePath:
        complex:
          root: foundIncidents.CustomFields.initiatorpath
          filters:
          - - operator: isNotEqualString
              left:
                value:
                  simple: foundIncidents.CustomFields.initiatorpath
                iscontext: true
              right:
                value:
                  simple: c:\windows\explorer.exe
              ignorecase: true
      FileRemediation:
        complex:
          root: inputs.FileRemediation
      HostContainment:
        simple: 'True'
      IAMUserDomain:
        simple: '@demisto.com'
      UserContainment:
        simple: 'True'
      Username:
        complex:
          root: foundIncidents.CustomFields
          accessor: username
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ''
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1300,
          "y": 3050
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '65':
    id: '65'
    taskid: 6c369ff0-b57f-4227-873a-60a44c0579d1
    type: playbook
    task:
      id: 6c369ff0-b57f-4227-873a-60a44c0579d1
      version: -1
      name: Eradication Plan
      description: "This playbook handles all the eradication actions available with Cortex XSIAM, including the following tasks:\n* Reset user password\n* Delete file\n* Kill process (currently, the playbook supports terminating a process by name)  \n\nNote: The playbook inputs enable manipulating the execution flow; read the input descriptions for details."
      playbookName: Eradication Plan
      type: playbook
      iscommand: false
      brand: ''
    nexttasks:
      '#none#':
      - '50'
    scriptarguments:
      AutoEradicate:
        complex:
          root: inputs.AutoEradication
      EndpointID:
        complex:
          root: alert
          accessor: agentid
      FilePath:
        complex:
          root: foundIncidents.CustomFields
          accessor: initiatorpath
      FileRemediation:
        complex:
          root: inputs.FileRemediation
      Username:
        complex:
          root: foundIncidents.CustomFields
          accessor: username
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ''
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 900,
          "y": 3050
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '66':
    id: '66'
    taskid: 4d3c47d4-9f51-47a2-8876-bb57e5d504d7
    type: playbook
    task:
      id: 4d3c47d4-9f51-47a2-8876-bb57e5d504d7
      version: -1
      name: Recovery Plan
      description: |-
        This playbook handles all the recovery actions available with Cortex XSIAM, including the following tasks:
        * Unisolate endpoint
        * Restore quarantined file

        Note: The playbook inputs enable manipulating the execution flow; read the input descriptions for details.
      playbookName: Recovery Plan
      type: playbook
      iscommand: false
      brand: ''
    nexttasks:
      '#none#':
      - '47'
    scriptarguments:
      FileHash:
        complex:
          root: alert
          accessor: initiatorsha256
      endpointID:
        complex:
          root: alert
          accessor: agentid
      releaseFile:
        simple: 'False'
      unIsolateEndpoint:
        simple: 'False'
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ''
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1370,
          "y": 3580
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '67':
    id: '67'
    taskid: 84962fd2-6212-4fc0-8018-63b0c08b2e4f
    type: playbook
    task:
      id: 84962fd2-6212-4fc0-8018-63b0c08b2e4f
      version: -1
      name: Handle False Positive Alerts
      playbookName: Handle False Positive Alerts
      type: playbook
      iscommand: false
      brand: ''
      description: |
        This playbook handles false positive alerts.
        It creates an alert exclusion or alert exception, or adds a file to an allow list based on the alert fields and playbook inputs.
    nexttasks:
      '#none#':
      - '51'
    scriptarguments:
      FileSHA256:
        complex:
          root: alert
          accessor: initiatorsha256
      ShouldCloseAutomatically:
        complex:
          root: inputs.AutoCloseAlert
      alertName:
        complex:
          root: alert
          accessor: name
      sourceIP:
        complex:
          root: alert
          accessor: hostip
      username:
        complex:
          root: alert
          accessor: username
      ShouldHandleFPautomatically:
        complex:
          root: inputs.ShouldManualReviewFP
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ''
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 430,
          "y": 2500
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '68':
    id: '68'
    taskid: 126ffda6-c72f-486a-8068-5d58dbd6f642
    type: regular
    task:
      id: 126ffda6-c72f-486a-8068-5d58dbd6f642
      version: -1
      name: |
        Extract retrieved file
      description: Unzip a file using fileName or entryID to specify a file. Unzipped files are loaded to the War Room and names are put in the context.
      scriptName: UnzipFile
      type: regular
      iscommand: false
      brand: ''
    nexttasks:
      '#none#':
      - '69'
    scriptarguments:
      lastZipFileInWarroom:
        simple: yes
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1280,
          "y": 2040
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '69':
    id: '69'
    taskid: e0bd8f50-3e7e-4ea0-8cbf-ce066d06ae08
    type: playbook
    task:
      id: e0bd8f50-3e7e-4ea0-8cbf-ce066d06ae08
      version: -1
      name: Wildfire Detonate and Analyze File
      description: |
        This playbook uploads, detonates, and analyzes files for the Wildfire sandbox.
      playbookName: Wildfire Detonate and Analyze File
      type: playbook
      iscommand: false
      brand: ''
    nexttasks:
      '#none#':
      - "39"
    scriptarguments:
      File:
        complex:
          root: File
          filters:
          - - operator: isNotEqualString
              left:
                value:
                  simple: File.Name
                iscontext: true
              right:
                value:
                  simple: manifest.json
              ignorecase: true
          - - operator: in
              left:
                value:
                  simple: File.Name
                iscontext: true
              right:
                value:
                  simple: ExtractedFiles
                iscontext: true
    separatecontext: true
    loop:
      iscommand: false
      scriptArguments:
        File:
          complex:
            root: File
            filters:
            - - operator: isNotEqualString
                left:
                  value:
                    simple: File.Name
                  iscontext: true
                right:
                  value:
                    simple: manifest.json
                ignorecase: true
            - - operator: in
                left:
                  value:
                    simple: File.Name
                  iscontext: true
                right:
                  value:
                    simple: ExtractedFiles
                  iscontext: true
      exitCondition: ''
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1280,
          "y": 2200
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '70':
    id: '70'
    taskid: 4bdcb352-0176-4423-897b-abac5ffcc221
    type: condition
    task:
      id: 4bdcb352-0176-4423-897b-abac5ffcc221
      version: -1
      name: Check WildFire alert verdict
      description: Checks the WildFire verdict received.
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - "50"
      Benign:
      - '71'
    separatecontext: false
    conditions:
    - label: Benign
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: WildFire.Verdicts
                accessor: Verdict
            iscontext: true
          right:
            value:
              simple: '0'
    view: |-
      {
        "position": {
          "x": 1760,
          "y": 3050
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '71':
    id: '71'
    taskid: 383805c3-25cf-4f01-865f-6b7187669557
    type: regular
    task:
      id: 383805c3-25cf-4f01-865f-6b7187669557
      version: -1
      name: Flip verdict request to keep WF updated
      description: Reports to WildFire about incorrect hash verdict through Cortex.
      script: '|||core-report-incorrect-wildfire'
      type: regular
      iscommand: true
      brand: ''
    nexttasks:
      '#none#':
      - "46"
    scriptarguments:
      file_hash:
        complex:
          root: WildFire.Report
          accessor: SHA256
      new_verdict:
        simple: '1'
      reason:
        simple: Cortex XDR Local Analysis found the file to be malicious.
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1760,
          "y": 3240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "75":
    id: "75"
    taskid: a953691c-5334-47a3-821f-304f8ed1fbfd
    type: condition
    task:
      id: a953691c-5334-47a3-821f-304f8ed1fbfd
      version: -1
      name: Is manual review required?
      description: Checks whether the playbook should wait for manual review.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "67"
      "yes":
      - "34"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.ShouldManualReviewFP
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 430,
          "y": 1840
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "76":
    id: "76"
    taskid: a6fde59e-ee3e-40c4-8ba6-722934ef8be0
    type: title
    task:
      id: a6fde59e-ee3e-40c4-8ba6-722934ef8be0
      version: -1
      name: Flip WildFire Verdict
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "70"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1760,
          "y": 2910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "77":
    id: "77"
    taskid: 078887a5-4228-44f2-89d5-aa95c2bcb770
    type: regular
    task:
      id: 078887a5-4228-44f2-89d5-aa95c2bcb770
      version: -1
      name: Check for existing WF report
      description: Retrieves results for a file hash using WildFire.
      script: '|||internal-wildfire-get-report'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "78"
    scriptarguments:
      sha256:
        complex:
          root: alert
          accessor: initiatorsha256
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1280,
          "y": 1280
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "78":
    id: "78"
    taskid: 37332a6e-db70-4828-82b0-7be714a388dd
    type: condition
    task:
      id: 37332a6e-db70-4828-82b0-7be714a388dd
      version: -1
      name: Should detonate file?
      description: "Do we have a WildFire report or should we detonate the file?"
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "59"
      "no":
      - "39"
    separatecontext: false
    conditions:
    - label: "no"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: WildFire.Report
                accessor: Status
            iscontext: true
          right:
            value:
              simple: Success
    view: |-
      {
        "position": {
          "x": 1280,
          "y": 1480
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "14_39_#default#": 0.23,
      "2_33_#default#": 0.1,
      "2_6_True Positive": 0.71,
      "34_39_No": 0.58,
      "34_67_Yes": 0.54,
      "46_47_#default#": 0.54,
      "46_66_yes": 0.49,
      "47_48_#default#": 0.5,
      "55_35_#default#": 0.19,
      "58_35_#default#": 0.33,
      "6_35_Blocked": 0.12,
      "6_57_#default#": 0.58,
      "70_71_Benign": 0.63,
      "75_67_#default#": 0.67,
      "78_39_no": 0.14,
      "78_59_#default#": 0.72
    },
    "paper": {
      "dimensions": {
        "height": 5235,
        "width": 1710,
        "x": 430,
        "y": -900
      }
    }
  }
inputs:
- key: GraywareAsMalware
  value:
    simple: 'False'
  required: false
  description: 'Whether to treat Grayware verdict as Malware. '
  playbookInputQuery:
- key: AutoContainment
  value:
    simple: 'True'
  required: false
  description: |-
    Setting this input will impact both Containment Plan sub-playbooks. Without setting this input, the default values are True for the first occurrence and False for the second.
    Whether to execute automatically or manually the containment plan tasks:
    * Isolate endpoint
    * Block indicators
    * Quarantine file
    * Disable user
  playbookInputQuery:
- key: AutoEradication
  value:
    simple: 'False'
  required: false
  description: |-
    Whether to execute automatically or manually the eradication plan tasks:
    * Terminate process
    * Delete file
    * Reset the user's password
  playbookInputQuery:
- key: FileRemediation
  value:
    simple: Quarantine
  required: false
  description: Should be either 'Quarantine' or 'Delete'.
  playbookInputQuery:
- key: AutoRecovery
  value:
    simple: 'False'
  required: false
  description: Whether to execute the Recovery playbook.
  playbookInputQuery:
- key: AutoCloseAlert
  value:
    simple: 'False'
  required: false
  description: Whether to close the alert automatically or manually, after an analyst's review.
  playbookInputQuery:
- key: ShouldRescanBenign
  value:
    simple: 'True'
  required: false
  description: Whether to rescan (Using WildFire detonate file) benign files.
  playbookInputQuery:
- key: ShouldManualReviewFP
  value:
    simple: "False"
  required: false
  description: Whether to ask for a manual review before false positive handling. Should be True or False
  playbookInputQuery:
outputs: []
tests:
- No tests (auto formatted)
fromversion: 6.6.0
marketplaces:
  - marketplacev2