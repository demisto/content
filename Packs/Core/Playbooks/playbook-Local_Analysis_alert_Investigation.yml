id: Local Analysis alert Investigation
version: -1
name: Local Analysis alert Investigation
description: |-
  When an unknown executable, DLL, or macro attempts to run on a Windows or Mac endpoint, the Cortex XDR agent uses local analysis to determine if it is likely to be malware. Local analysis uses a static set of pattern-matching rules that inspect multiple file features and attributes, and a statistical model that was developed with machine learning on WildFire threat intelligence.

  **Investigative Actions:**

  Investigate the executed process image and verify if it is malicious using:

  * XDR trusted signers
  * VT trusted signers
  * VT detection rate
  * NSRL DB

  **Response Actions**

  The playbook's first response action is a containment plan which is based on the initial data provided within the alert. In that phase, the playbook will execute:

  * Auto block indicators
  * Auto file quarantine
  * Manual endpoint isolation

  When the playbook executes, it checks for additional activity using the Endpoint Investigation Plan playbook, and another phase, which includes containment and eradication, is executed.

  This phase will execute the following containment actions:

  * Manual block indicators
  * Manual file quarantine
  * Auto endpoint isolation

  And the following eradication actions:

  * Manual process termination
  * Manual file deletion
  * Manual reset of the userâ€™s password

  External resources:

  [Malware Protection Flow](https://docs.paloaltonetworks.com/traps/4-2/traps-endpoint-security-manager-admin/malware-protection/malware-protection-flow)
starttaskid: '0'
tasks:
  '0':
    id: '0'
    taskid: a7406ab9-8ead-462b-8edb-b1a42c1ee926
    type: start
    task:
      id: a7406ab9-8ead-462b-8edb-b1a42c1ee926
      version: -1
      name: ''
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '3'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 440,
          "y": -900
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '2':
    id: '2'
    taskid: 4946934b-2333-45e4-80ba-62d12ec85632
    type: condition
    task:
      id: 4946934b-2333-45e4-80ba-62d12ec85632
      version: -1
      name: Continue by Verdict
      description: Checks the verdict returned by 'Enrichment for Verdict' playbook.
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - '33'
      True Positive:
      - '6'
    separatecontext: false
    conditions:
    - label: True Positive
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: FileVerdict
            iscontext: true
          right:
            value:
              simple: Suspicious
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 440,
          "y": -480
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '3':
    id: '3'
    taskid: 95780e0a-e062-42ef-8023-633fd90a32ca
    type: title
    task:
      id: 95780e0a-e062-42ef-8023-633fd90a32ca
      version: -1
      name: Analysis
      type: title
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '61'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 440,
          "y": -765
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '6':
    id: '6'
    taskid: 7fc9ca7d-ee00-4e76-83e3-1d1ccb61e008
    type: condition
    task:
      id: 7fc9ca7d-ee00-4e76-83e3-1d1ccb61e008
      version: -1
      name: 'Was the action prevented? '
      description: Checks if the file execution was prevented.
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - '57'
      Blocked:
      - '35'
    separatecontext: false
    conditions:
    - label: Blocked
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: alert
                accessor: action
            iscontext: true
          right:
            value:
              simple: BLOCKED
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 900,
          "y": -310
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '14':
    id: '14'
    taskid: db8e53a5-0c3e-4096-805f-404bcd7a0b48
    type: condition
    task:
      id: db8e53a5-0c3e-4096-805f-404bcd7a0b48
      version: -1
      name: Check WF alert verdict
      description: Checks the WildFire verdict.
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - '39'
      Benign:
      - '59'
    separatecontext: false
    conditions:
    - label: Benign
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: WildFire.Verdicts
                accessor: Verdict
            iscontext: true
          right:
            value:
              simple: '0'
        - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.GraywareAsMalware
            iscontext: true
          right:
            value:
              simple: 'False'
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.ShouldRescanBenign
            iscontext: true
          right:
            value:
              simple: 'True'
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 900,
          "y": 815
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '33':
    id: '33'
    taskid: 365fa7b4-058c-4ff7-834a-0dcc4009fc42
    type: title
    task:
      id: 365fa7b4-058c-4ff7-834a-0dcc4009fc42
      version: -1
      name: Handle FP
      type: title
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '34'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 440,
          "y": 2030
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '34':
    id: '34'
    taskid: 1f7b5164-cccd-4e9f-8b63-0e7c79448c20
    type: condition
    task:
      id: 1f7b5164-cccd-4e9f-8b63-0e7c79448c20
      version: -1
      name: Manual review - was it your security vendor?
      description: |+
        Was it your security vendor?
        Script from your IT?

        ....

      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - '67'
      No:
      - '39'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 440,
          "y": 2150
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '35':
    id: '35'
    taskid: 3bb94a23-82c4-4c00-84fa-0228b084583b
    type: title
    task:
      id: 3bb94a23-82c4-4c00-84fa-0228b084583b
      version: -1
      name: WildFire Verdict
      type: title
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '14'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 900,
          "y": 690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '39':
    id: '39'
    taskid: 920e8ad9-ccf9-4b82-8375-b17b2c26eb42
    type: title
    task:
      id: 920e8ad9-ccf9-4b82-8375-b17b2c26eb42
      version: -1
      name: Investigate
      type: title
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '63'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 900,
          "y": 2320
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '41':
    id: '41'
    taskid: ed0d81e9-adf9-41d1-84db-9087868cd0cf
    type: title
    task:
      id: ed0d81e9-adf9-41d1-84db-9087868cd0cf
      version: -1
      name: Remediation
      type: title
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '64'
      - '65'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1440,
          "y": 2790
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '44':
    id: '44'
    taskid: 1131ba86-e2f3-4e90-8ab5-7281c5630145
    type: condition
    task:
      id: 1131ba86-e2f3-4e90-8ab5-7281c5630145
      version: -1
      name: Found relevant information?
      description: Checks if other alerts were found on the endpoint.
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - '50'
      yes:
      - '41'
    separatecontext: false
    conditions:
    - label: yes
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: FoundIncidents
            iscontext: true
          right:
            value: {}
    view: |-
      {
        "position": {
          "x": 900,
          "y": 2620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '45':
    id: '45'
    taskid: babac2c2-8bc1-4d75-8666-03042fb40c09
    type: regular
    task:
      id: babac2c2-8bc1-4d75-8666-03042fb40c09
      version: -1
      name: close alert
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - '51'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 900,
          "y": 3930
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '46':
    id: '46'
    taskid: a3c1d4d1-3242-47cd-81aa-28d10f0bd155
    type: condition
    task:
      id: a3c1d4d1-3242-47cd-81aa-28d10f0bd155
      version: -1
      name: Should restore affected endpoint?
      description: Whether to execute the Recovery Plan playbook.
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - '47'
      yes:
      - '66'
    separatecontext: false
    conditions:
    - label: yes
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.AutoRecovery
            iscontext: true
          right:
            value:
              simple: 'True'
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 900,
          "y": 3245
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '47':
    id: '47'
    taskid: b8a41bf5-ad48-43c0-8a8b-67ccfa036bb0
    type: condition
    task:
      id: b8a41bf5-ad48-43c0-8a8b-67ccfa036bb0
      version: -1
      name: Should close alert automatically?
      description: Whether to close the alert automatically.
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - '48'
      yes:
      - '45'
    separatecontext: false
    conditions:
    - label: yes
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.AutoCloseAlert
            iscontext: true
          right:
            value:
              simple: 'True'
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 900,
          "y": 3590
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '48':
    id: '48'
    taskid: 8deecef6-2dcc-4135-8f36-540935d5020f
    type: regular
    task:
      id: 8deecef6-2dcc-4135-8f36-540935d5020f
      version: -1
      name: Continue with the incident investigation
      description: Continue manually with the alert investigation.
      type: regular
      iscommand: false
      brand: ''
    nexttasks:
      '#none#':
      - '45'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1220,
          "y": 3760
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '50':
    id: '50'
    taskid: 82f5864b-14de-428e-87c0-d04ff9ec40e4
    type: title
    task:
      id: 82f5864b-14de-428e-87c0-d04ff9ec40e4
      version: -1
      name: Recovery
      type: title
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '46'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 900,
          "y": 3100
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '51':
    id: '51'
    taskid: 7b89c9aa-8804-472e-8013-09dc91fd2901
    type: title
    task:
      id: 7b89c9aa-8804-472e-8013-09dc91fd2901
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ''
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 440,
          "y": 4110
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '54':
    id: '54'
    taskid: 5ef91412-e2ac-46b3-8558-107fe4093b00
    type: title
    task:
      id: 5ef91412-e2ac-46b3-8558-107fe4093b00
      version: -1
      name: Pre-Investigation Containment
      type: title
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '58'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1380,
          "y": 190
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '55':
    id: '55'
    taskid: 91acb8fe-2717-4c3c-8295-5558efde8fa8
    type: condition
    task:
      id: 91acb8fe-2717-4c3c-8295-5558efde8fa8
      version: -1
      name: Check hash execution timestamp
      description: Checks for the hash execution timestamp.
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - '35'
      24H:
      - '54'
    separatecontext: false
    conditions:
    - label: 24H
      condition:
      - - operator: greaterThanOrEqual
          left:
            value:
              complex:
                root: alert
                accessor: autime
            iscontext: true
          right:
            value:
              complex:
                root: LastDayTimeNowUnix
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1180,
          "y": 20
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '57':
    id: '57'
    taskid: 65d493b5-8684-407f-8654-7443c95a6a15
    type: regular
    task:
      id: 65d493b5-8684-407f-8654-7443c95a6a15
      version: -1
      name: Get time for the last day
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ''
    nexttasks:
      '#none#':
      - '55'
    scriptarguments:
      contextKey:
        simple: LastDay
      daysAgo:
        simple: '1'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1180,
          "y": -140
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '58':
    id: '58'
    taskid: d0251c23-0d6f-43e5-813d-aeab89008b32
    type: condition
    task:
      id: d0251c23-0d6f-43e5-813d-aeab89008b32
      version: -1
      name: Is auto-containment set to true?
      description: Checks the AutoContainment input.
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - '35'
      yes:
      - '62'
    separatecontext: false
    conditions:
    - label: yes
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.AutoContainment
                transformers:
                - operator: toLowerCase
            iscontext: true
          right:
            value:
              simple: 'true'
    view: |-
      {
        "position": {
          "x": 1380,
          "y": 330
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '59':
    id: '59'
    taskid: 70e962f2-78c7-4e6d-8516-75f2eed67764
    type: regular
    task:
      id: 70e962f2-78c7-4e6d-8516-75f2eed67764
      version: -1
      name: Retrieve the suspected file
      description: Retrieves files from selected endpoints. You can retrieve up to 20 files, from no more than 10 endpoints. At least one endpoint ID and one file path are necessary in order to run the command. After running this command, you can use the core-action-status-get command with returned action_id, to check the action status.
      script: '|||core-retrieve-files'
      type: regular
      iscommand: true
      brand: ''
    nexttasks:
      '#none#':
      - '60'
    scriptarguments:
      endpoint_ids:
        complex:
          root: alert
          accessor: agentid
      windows_file_paths:
        complex:
          root: alert
          accessor: initiatorpath
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 660,
          "y": 1030
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '60':
    id: '60'
    taskid: f8d13237-59bf-4980-8168-dc1c9a253f21
    type: regular
    task:
      id: f8d13237-59bf-4980-8168-dc1c9a253f21
      version: -1
      name: Get retrieved file
      description: View the file retrieved by the core-retrieve-files command according to the action ID. Before running this command, you can use the core-action-status-get command to check if this action completed successfully.
      script: '|||core-retrieve-file-details'
      type: regular
      iscommand: true
      brand: ''
    nexttasks:
      '#none#':
      - '68'
    scriptarguments:
      action_id:
        complex:
          root: Core.RetrievedFiles
          accessor: action_id
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 660,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '61':
    id: '61'
    taskid: 86d64a94-142d-44fe-8c72-82034fb883d9
    type: playbook
    task:
      id: 86d64a94-142d-44fe-8c72-82034fb883d9
      version: -1
      name: Enrichment for Verdict
      playbookName: Enrichment for Verdict
      type: playbook
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '2'
    separatecontext: true
    view: |-
      {
        "position": {
          "x": 440,
          "y": -640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '62':
    id: '62'
    taskid: e5dad5e0-215d-4537-8912-86a93f3c5bef
    type: playbook
    task:
      id: e5dad5e0-215d-4537-8912-86a93f3c5bef
      version: -1
      name: Containment Plan
      description: "This playbook handles all the containment actions available with Cortex XSIAM, including:  \n* Isolate endpoint\n* Disable account\n* Quarantine file\n* Block indicators\n* Clear user session (currently, the playbook supports only Okta)\n\nNote: The playbook inputs enable manipulating the execution flow; read the input descriptions for details."
      playbookName: Containment Plan
      type: playbook
      iscommand: false
      brand: ''
    nexttasks:
      '#none#':
      - '35'
    scriptarguments:
      AutoContainment:
        complex:
          root: inputs.AutoContainment
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: 'true'
      BlockIndicators:
        simple: 'True'
      ClearUserSessions:
        simple: 'False'
      EndpointID:
        complex:
          root: alert
          accessor: agentid
      FileContainment:
        simple: 'True'
      FileHash:
        complex:
          root: alert
          filters:
          - - operator: isNotEqualString
              left:
                value:
                  simple: alert.initiatorpath
                iscontext: true
              right:
                value:
                  simple: c:\windows\explorer.exe
              ignorecase: true
          accessor: initiatorsha256
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: alert.targetprocesssha256
                iscontext: true
      FilePath:
        complex:
          root: alert.initiatorpath
          filters:
          - - operator: isNotEqualString
              left:
                value:
                  simple: alert.initiatorpath
                iscontext: true
              right:
                value:
                  simple: c:\windows\explorer.exe
              ignorecase: true
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: alert.targetprocesscmd
                iscontext: true
          - operator: replaceMatch
            args:
              regex:
                value:
                  simple: \"
              replaceWith: {}
      FileRemediation:
        simple: Quarantine
      HostContainment:
        simple: 'True'
      IAMUserDomain:
        simple: '@demisto.com'
      UserContainment:
        simple: 'True'
      Username:
        complex:
          root: alert
          accessor: username
          transformers:
          - operator: uniq
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ''
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1560,
          "y": 520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '63':
    id: '63'
    taskid: fb368c9f-ccb4-40e1-8010-f664993677ab
    type: playbook
    task:
      id: fb368c9f-ccb4-40e1-8010-f664993677ab
      version: -1
      name: Endpoint Investigation Plan
      description: "This playbook handles all the endpoint investigation actions available with Cortex XSIAM, including the following tasks:\n* Pre-defined MITRE Tactics\n* Host fields (Host ID)\n* Attacker fields (Attacker IP, External host)\n* MITRE techniques\n* File hash (currently, the playbook supports only SHA256)  \n\nNote: The playbook inputs enable manipulating the execution flow; read the input descriptions for details."
      playbookName: Endpoint Investigation Plan
      type: playbook
      iscommand: false
      brand: ''
    nexttasks:
      '#none#':
      - '44'
    scriptarguments:
      HuntCnCTechniques:
        simple: 'True'
      HuntCollectionTechniques:
        simple: 'True'
      HuntDefenseEvasionTechniques:
        simple: 'True'
      HuntDiscoveryTechniques:
        simple: 'True'
      HuntExecutionTechniques:
        simple: 'True'
      HuntImpactTechniques:
        simple: 'True'
      HuntInitialAccessTechniques:
        simple: 'True'
      HuntLateralMovementTechniques:
        simple: 'True'
      HuntPersistenceTechniques:
        simple: 'True'
      HuntPrivilegeEscalationTechniques:
        simple: 'True'
      HuntReconnaissanceTechniques:
        simple: 'True'
      agentID:
        complex:
          root: alert
          accessor: agentid
      timeRange:
        simple: 2 hours ago
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ''
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 900,
          "y": 2450
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '64':
    id: '64'
    taskid: d544afa6-3c28-4fb9-8320-5554953744de
    type: playbook
    task:
      id: d544afa6-3c28-4fb9-8320-5554953744de
      version: -1
      name: Containment Plan
      description: "This playbook handles all the containment actions available with Cortex XSIAM, including:  \n* Isolate endpoint\n* Disable account\n* Quarantine file\n* Block indicators\n* Clear user session (currently, the playbook supports only Okta)\n\nNote: The playbook inputs enable manipulating the execution flow; read the input descriptions for details."
      playbookName: Containment Plan
      type: playbook
      iscommand: false
      brand: ''
    nexttasks:
      '#none#':
      - '50'
    scriptarguments:
      AutoContainment:
        complex:
          root: inputs.AutoContainment
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: 'false'
      BlockIndicators:
        simple: 'True'
      ClearUserSessions:
        simple: 'True'
      EndpointID:
        complex:
          root: alert
          accessor: agentid
      FileContainment:
        simple: 'True'
      FileHash:
        complex:
          root: foundIncidents.CustomFields
          filters:
          - - operator: isNotEqualString
              left:
                value:
                  simple: foundIncidents.CustomFields.initiatorpath
                iscontext: true
              right:
                value:
                  simple: c:\windows\explorer.exe
              ignorecase: true
          accessor: initiatorsha256
      FilePath:
        complex:
          root: foundIncidents.CustomFields.initiatorpath
          filters:
          - - operator: isNotEqualString
              left:
                value:
                  simple: foundIncidents.CustomFields.initiatorpath
                iscontext: true
              right:
                value:
                  simple: c:\windows\explorer.exe
              ignorecase: true
      FileRemediation:
        complex:
          root: inputs.FileRemediation
      HostContainment:
        simple: 'True'
      IAMUserDomain:
        simple: '@demisto.com'
      UserContainment:
        simple: 'True'
      Username:
        complex:
          root: foundIncidents.CustomFields
          accessor: username
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ''
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1650,
          "y": 2930
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '65':
    id: '65'
    taskid: 6c369ff0-b57f-4227-873a-60a44c0579d1
    type: playbook
    task:
      id: 6c369ff0-b57f-4227-873a-60a44c0579d1
      version: -1
      name: Eradication Plan
      description: "This playbook handles all the eradication actions available with Cortex XSIAM, including the following tasks:\n* Reset user password\n* Delete file\n* Kill process (currently, the playbook supports terminating a process by name)  \n\nNote: The playbook inputs enable manipulating the execution flow; read the input descriptions for details."
      playbookName: Eradication Plan
      type: playbook
      iscommand: false
      brand: ''
    nexttasks:
      '#none#':
      - '50'
    scriptarguments:
      AutoEradicate:
        complex:
          root: inputs.AutoEradication
      EndpointID:
        complex:
          root: alert
          accessor: agentid
      FilePath:
        complex:
          root: foundIncidents.CustomFields
          accessor: initiatorpath
      FileRemediation:
        complex:
          root: inputs.FileRemediation
      Username:
        complex:
          root: foundIncidents.CustomFields
          accessor: username
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ''
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 1230,
          "y": 2930
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '66':
    id: '66'
    taskid: 4d3c47d4-9f51-47a2-8876-bb57e5d504d7
    type: playbook
    task:
      id: 4d3c47d4-9f51-47a2-8876-bb57e5d504d7
      version: -1
      name: Recovery Plan
      description: |-
        This playbook handles all the recovery actions available with Cortex XSIAM, including the following tasks:
        * Unisolate endpoint
        * Restore quarantined file

        Note: The playbook inputs enable manipulating the execution flow; read the input descriptions for details.
      playbookName: Recovery Plan
      type: playbook
      iscommand: false
      brand: ''
    nexttasks:
      '#none#':
      - '47'
    scriptarguments:
      FileHash:
        complex:
          root: alert
          accessor: initiatorsha256
      endpointID:
        complex:
          root: alert
          accessor: agentid
      releaseFile:
        simple: 'False'
      unIsolateEndpoint:
        simple: 'False'
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ''
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1220,
          "y": 3420
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '67':
    id: '67'
    taskid: e9c585d3-5b5e-4666-8db6-447293bcd70e
    type: playbook
    task:
      id: e9c585d3-5b5e-4666-8db6-447293bcd70e
      version: -1
      name: Handle False Positive Alerts
      playbookName: Handle False Positive Alerts
      type: playbook
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '51'
    scriptarguments:
      FileSHA256:
        complex:
          root: alert
          accessor: initiatorsha256
      ShouldCloseAutomatically:
        complex:
          root: inputs.AutoCloseAlert
      alertName:
        complex:
          root: alert
          accessor: name
      sourceIP:
        complex:
          root: alert
          accessor: hostip
      username:
        complex:
          root: alert
          accessor: username
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ''
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 440,
          "y": 2620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '68':
    id: '68'
    taskid: 126ffda6-c72f-486a-8068-5d58dbd6f642
    type: regular
    task:
      id: 126ffda6-c72f-486a-8068-5d58dbd6f642
      version: -1
      name: |
        Extract retrieved file
      description: Unzip a file using fileName or entryID to specify a file. Unzipped files will be loaded to the War Room and names will be put into the context.
      scriptName: UnzipFile
      type: regular
      iscommand: false
      brand: ''
    nexttasks:
      '#none#':
      - '69'
    scriptarguments:
      lastZipFileInWarroom:
        simple: yes
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 660,
          "y": 1330
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '69':
    id: '69'
    taskid: e0bd8f50-3e7e-4ea0-8cbf-ce066d06ae08
    type: playbook
    task:
      id: e0bd8f50-3e7e-4ea0-8cbf-ce066d06ae08
      version: -1
      name: Wildfire Detonate and Analyze File
      description: |
        This playbook uploads, detonates, and analyzes files for the Wildfire sandbox.
      playbookName: Wildfire Detonate and Analyze File
      type: playbook
      iscommand: false
      brand: ''
    nexttasks:
      '#none#':
      - '70'
    scriptarguments:
      File:
        complex:
          root: File
          filters:
          - - operator: isNotEqualString
              left:
                value:
                  simple: File.Name
                iscontext: true
              right:
                value:
                  simple: manifest.json
              ignorecase: true
          - - operator: in
              left:
                value:
                  simple: File.Name
                iscontext: true
              right:
                value:
                  simple: ExtractedFiles
                iscontext: true
    separatecontext: true
    loop:
      iscommand: false
      scriptArguments:
        File:
          complex:
            root: File
            filters:
            - - operator: isNotEqualString
                left:
                  value:
                    simple: File.Name
                  iscontext: true
                right:
                  value:
                    simple: manifest.json
                ignorecase: true
            - - operator: in
                left:
                  value:
                    simple: File.Name
                  iscontext: true
                right:
                  value:
                    simple: ExtractedFiles
                  iscontext: true
      exitCondition: ''
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 660,
          "y": 1480
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '70':
    id: '70'
    taskid: 4bdcb352-0176-4423-897b-abac5ffcc221
    type: condition
    task:
      id: 4bdcb352-0176-4423-897b-abac5ffcc221
      version: -1
      name: Check WildFire alert verdict
      description: cheks the WildFire verdict received.
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - '39'
      Benign:
      - '71'
    separatecontext: false
    conditions:
    - label: Benign
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: WildFire.Verdicts
                accessor: Verdict
            iscontext: true
          right:
            value:
              simple: '0'
    view: |-
      {
        "position": {
          "x": 660,
          "y": 1630
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '71':
    id: '71'
    taskid: cd14d799-ed48-415c-820a-59e35a1b3698
    type: regular
    task:
      id: cd14d799-ed48-415c-820a-59e35a1b3698
      version: -1
      name: WildFire report  - Flip verdict
      description: Reports to WildFire about incorrect hash verdict through Cortex.
      script: '|||core-report-incorrect-wildfire'
      type: regular
      iscommand: true
      brand: ''
    nexttasks:
      '#none#':
      - '33'
    scriptarguments:
      file_hash:
        complex:
          root: WildFire.Report
          accessor: SHA256
      new_verdict:
        simple: '1'
      reason:
        simple: XDR Local Analysis found the file to be malicious.
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 660,
          "y": 1860
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "14_39_#default#": 0.11,
      "14_59_Benign": 0.44,
      "2_33_#default#": 0.1,
      "2_6_True Positive": 0.71,
      "34_39_No": 0.34,
      "34_67_#default#": 0.69,
      "44_41_yes": 0.68,
      "44_50_#default#": 0.45,
      "46_47_#default#": 0.54,
      "46_66_yes": 0.49,
      "47_48_#default#": 0.5,
      "55_35_#default#": 0.19,
      "58_35_#default#": 0.33,
      "6_35_Blocked": 0.12,
      "6_57_#default#": 0.58,
      "70_39_#default#": 0.46,
      "70_71_Benign": 0.63
    },
    "paper": {
      "dimensions": {
        "height": 5075,
        "width": 1590,
        "x": 440,
        "y": -900
      }
    }
  }
inputs:
- key: GraywareAsMalware
  value:
    simple: 'False'
  required: false
  description: 'Whether to treat Grayware verdict as Malware. '
  playbookInputQuery:
- key: AutoContainment
  value:
    simple: 'True'
  required: false
  description: |-
    Setting this input will impact both Containment Plan sub-playbooks. Without setting this input, the default values are True for the first occurrence and False for the second.
    Whether to execute automatically or manually the containment plan tasks:
    * Isolate endpoint
    * Block indicators
    * Quarantine file
    * Disable user
  playbookInputQuery:
- key: AutoEradication
  value:
    simple: 'False'
  required: false
  description: |-
    Whether to execute automatically or manually the eradication plan tasks:
    * Terminate process
    * Delete file
    * Reset the user's password
  playbookInputQuery:
- key: FileRemediation
  value:
    simple: Quarantine
  required: false
  description: Should be either 'Quarantine' or 'Delete'.
  playbookInputQuery:
- key: AutoRecovery
  value:
    simple: 'False'
  required: false
  description: Whether to execute the Recovery playbook.
  playbookInputQuery:
- key: AutoCloseAlert
  value:
    simple: 'False'
  required: false
  description: Whether to close the alert automatically or manually, after an analyst's review.
  playbookInputQuery:
- key: ShouldRescanBenign
  value:
    simple: 'True'
  required: false
  description: Whether to rescan (Using WildFire detonate file) benign files.
  playbookInputQuery:
outputs: []
tests:
- No tests (auto formatted)
fromversion: 6.6.0
