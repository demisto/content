id: Create Ticket and Notify
version: -1
contentitemexportablefields:
  contentitemfields:
    packID: "CloudSecurityPostureManagement"
    packName: Cloud Security Posture Management Playbooks
    itemVersion: 1.0.0
    fromServerVersion: 6.10.0
    toServerVersion: ""
    definitionid: ""
    prevname: ""
    isoverridable: false
    supportedModules: []
vcShouldKeepItemLegacyProdMachine: false
name: Create Ticket and Notify
description: This playbook automates the handling of issues, sending them through
  ServiceNow v2 or Jira v3 and notifying stakeholders via Slack v3, Microsoft Teams,
  or email. You have the flexibility to create or update a ticket using Jira or ServiceNow,
  to notify other teams using Slack or Microsoft Teams, or to send an email. You can
  choose to only create or update a ticket and skip the notification, skip creating
  or updating a ticket and send only a notification, or both create or update a ticket
  and notify relevant parties. This playbook requires existing integrations with Jira,
  ServiceNow, Slack, or Microsoft Teams to perform these actions. If none of these
  integrations are found in your account, the playbook will send an email with the
  issue details directly to the selected issue owner.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: c1750ed1-e9e8-4ea1-89a3-3cc1e7d67945
    type: start
    task:
      id: c1750ed1-e9e8-4ea1-89a3-3cc1e7d67945
      version: -1
      name: ""
      iscommand: false
      brand: ""
      playbooktaskmissingcomponent: null
    nexttasks:
      '#none#':
      - "30"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 150,
          "y": 0
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: 768c58c2-fa1c-4caf-8419-7b49e24bae1f
    type: condition
    task:
      id: 768c58c2-fa1c-4caf-8419-7b49e24bae1f
      version: -1
      name: Use ServiceNow for Issue ticket
      type: condition
      iscommand: false
      brand: ""
      playbooktaskmissingcomponent: null
    nexttasks:
      '#default#':
      - "32"
      Create:
      - "21"
      Update:
      - "44"
    separatecontext: false
    conditions:
    - label: Create
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.Preferred ticketing platform
            iscontext: true
          right:
            value:
              simple: ServiceNow
          ignorecase: true
        - operator: isEqualString
          left:
            value:
              simple: inputs.Preferred ticketing platform
            iscontext: true
          right:
            value:
              simple: Both
          ignorecase: true
      - - operator: isEqualString
          left:
            value:
              simple: inputs.System Input - Issue State
            iscontext: true
          right:
            value:
              simple: Create
      - - operator: isEmpty
          left:
            value:
              simple: inputs.System Input -ServiceNow Ticket ID
            iscontext: true
      - - operator: inList
          left:
            value:
              simple: modules.brand
            iscontext: true
          right:
            value:
              simple: ServiceNow v2
    - label: Update
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: inputs.System Input -ServiceNow Ticket ID
            iscontext: true
      - - operator: isEqualString
          left:
            value:
              simple: inputs.Preferred ticketing platform
            iscontext: true
          right:
            value:
              simple: ServiceNow
          ignorecase: true
        - operator: isEqualString
          left:
            value:
              simple: inputs.Preferred ticketing platform
            iscontext: true
          right:
            value:
              simple: Both
          ignorecase: true
      - - operator: isEqualString
          left:
            value:
              simple: inputs.System Input - Issue State
            iscontext: true
          right:
            value:
              simple: Update
      - - operator: inList
          left:
            value:
              simple: modules.brand
            iscontext: true
          right:
            value:
              simple: ServiceNow v2
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 150,
          "y": 260
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "15":
    id: "15"
    taskid: d667c82d-72ef-4795-8182-893c647a41a8
    type: title
    task:
      id: d667c82d-72ef-4795-8182-893c647a41a8
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      playbooktaskmissingcomponent: null
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 150,
          "y": 2060
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 35d689bd-97ce-48bd-87db-975ab59d43c5
    type: condition
    task:
      id: 35d689bd-97ce-48bd-87db-975ab59d43c5
      version: -1
      name: Notify using Microsoft Teams?
      type: condition
      iscommand: false
      brand: ""
      playbooktaskmissingcomponent: null
    nexttasks:
      '#default#':
      - "40"
      Create:
      - "42"
      Update:
      - "38"
    separatecontext: false
    conditions:
    - label: Create
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.System Input - Issue State
            iscontext: true
          right:
            value:
              simple: Create
      - - operator: inList
          left:
            value:
              simple: modules.brand
            iscontext: true
          right:
            value:
              simple: Microsoft Teams
      - - operator: isEqualString
          left:
            value:
              simple: inputs.Preferred notification platform
            iscontext: true
          right:
            value:
              simple: Microsoft Teams
          ignorecase: true
    - label: Update
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.Preferred notification platform
            iscontext: true
          right:
            value:
              simple: Microsoft Teams
          ignorecase: true
      - - operator: inList
          left:
            value:
              simple: modules.brand
            iscontext: true
          right:
            value:
              simple: Microsoft Teams
      - - operator: isEqualString
          left:
            value:
              simple: inputs.System Input - Issue State
            iscontext: true
          right:
            value:
              simple: Update
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 150,
          "y": 1000
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: f6e297a7-2b6c-446d-bf6b-2fc2740c5cf4
    type: regular
    task:
      id: f6e297a7-2b6c-446d-bf6b-2fc2740c5cf4
      version: -1
      name: Create Issue ServiceNow ticket
      description: Creates new ServiceNow ticket.
      script: ServiceNow v2|||servicenow-create-ticket-quick-action
      type: regular
      iscommand: true
      brand: ServiceNow v2
      playbooktaskmissingcomponent: null
    nexttasks:
      '#none#':
      - "32"
    scriptarguments:
      description:
        simple: |-
          Issue Detected for Asset: ${inputs.System Input - Asset details.xdm__asset__type__name}

          Issue Details

          Issue Name: ${issue.name}
          Severity Level: ${issue.severity}
          Category: ${issue.alert_category}
          Asset Name: ${inputs.System Input - Asset details.xdm__asset__name}
          Asset Type: ${inputs.System Input - Asset details.xdm__asset__type__name}
          Cloud Region: ${inputs.System Input - Asset details.xdm__asset__cloud__region}
          Cloud Account ID: ${inputs.System Input - Asset details.xdm__asset__realm}
          Issue Created: ${issue.created}
          Issue URL: ${demistoUrls.server}/issue-view/${issue.id}
      severity:
        simple: ${issue.severity}
      short_description:
        simple: Detected Issue - ${issue.details}
      ticket_type:
        simple: alert
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -260,
          "y": 410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: bdef12e8-43d4-4125-85e6-00333d93d05c
    type: regular
    task:
      id: bdef12e8-43d4-4125-85e6-00333d93d05c
      version: -1
      name: Create Issue Jira ticket
      description: Creates a new issue in Jira.
      script: Jira V3|||jira-create-issue-quick-action
      type: regular
      iscommand: true
      brand: Jira V3
      playbooktaskmissingcomponent: null
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      description:
        simple: |-
          Issue Detected for Asset: ${inputs.System Input - Asset details.xdm__asset__type__name}

          Issue Details

          Issue Name: ${issue.name}
          Severity Level: ${issue.severity}
          Category: ${issue.alert_category}
          Asset Name: ${inputs.System Input - Asset details.xdm__asset__name}
          Asset Type: ${inputs.System Input - Asset details.xdm__asset__type__name}
          Cloud Region: ${inputs.System Input - Asset details.xdm__asset__cloud__region}
          Cloud Account ID: ${inputs.System Input - Asset details.xdm__asset__realm}
          Issue Created: ${issue.created}
          Issue URL: ${demistoUrls.server}/issue-view/${issue.id}
      issue_type_name:
        simple: Task
      project_key:
        simple: ${inputs.Jira Project Key}
      summary:
        simple: Detected Issue - ${issue.details}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -230,
          "y": 710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: a0033ab1-1d78-4da9-8c23-c49346010ba7
    type: condition
    task:
      id: a0033ab1-1d78-4da9-8c23-c49346010ba7
      version: -1
      name: Send email to recipients
      description: commands.server.mail.sendmail
      type: condition
      iscommand: false
      brand: Builtin
      playbooktaskmissingcomponent: null
    nexttasks:
      '#default#':
      - "15"
      Create:
      - "33"
      Update:
      - "43"
    scriptarguments:
      to:
        simple: ${issue.fw_email_recipient}
    separatecontext: false
    conditions:
    - label: Create
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: inputs.Notification email recipients
            iscontext: true
          right:
            value: {}
      - - operator: isEqualString
          left:
            value:
              simple: inputs.System Input - Issue State
            iscontext: true
          right:
            value:
              simple: Create
    - label: Update
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: inputs.Notification email recipients
            iscontext: true
      - - operator: isEqualString
          left:
            value:
              simple: inputs.System Input - Issue State
            iscontext: true
          right:
            value:
              simple: Update
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 150,
          "y": 1760
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: de9afa66-dbfc-4482-8b61-59a8ac38cae7
    type: title
    task:
      id: de9afa66-dbfc-4482-8b61-59a8ac38cae7
      version: -1
      name: Create or Update Issue ticket
      type: title
      iscommand: false
      brand: ""
      playbooktaskmissingcomponent: null
    nexttasks:
      '#none#':
      - "12"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 150,
          "y": 130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: f7ef663b-5bba-4893-8b25-2a7f62fe0e80
    type: title
    task:
      id: f7ef663b-5bba-4893-8b25-2a7f62fe0e80
      version: -1
      name: Issue Notification
      type: title
      iscommand: false
      brand: ""
      playbooktaskmissingcomponent: null
    nexttasks:
      '#none#':
      - "16"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 150,
          "y": 870
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: c13a4449-b304-4d2b-843a-e4a4ec7de905
    type: condition
    task:
      id: c13a4449-b304-4d2b-843a-e4a4ec7de905
      version: -1
      name: Use Jira for Issue ticket
      type: condition
      iscommand: false
      brand: ""
      playbooktaskmissingcomponent: null
    nexttasks:
      '#default#':
      - "31"
      Create:
      - "24"
      Update:
      - "45"
    separatecontext: false
    conditions:
    - label: Create
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.Preferred ticketing platform
            iscontext: true
          right:
            value:
              simple: Jira
          ignorecase: true
        - operator: isEqualString
          left:
            value:
              simple: inputs.Preferred ticketing platform
            iscontext: true
          right:
            value:
              simple: Both
          ignorecase: true
      - - operator: isEqualString
          left:
            value:
              simple: inputs.System Input - Issue State
            iscontext: true
          right:
            value:
              simple: Create
      - - operator: isEmpty
          left:
            value:
              simple: inputs.System Input -Jira Ticket ID
            iscontext: true
      - - operator: inList
          left:
            value:
              simple: modules.brand
            iscontext: true
          right:
            value:
              simple: Jira V3
    - label: Update
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.Preferred ticketing platform
            iscontext: true
          right:
            value:
              simple: Jira
          ignorecase: true
        - operator: isEqualString
          left:
            value:
              simple: inputs.Preferred ticketing platform
            iscontext: true
          right:
            value:
              simple: Both
          ignorecase: true
      - - operator: isEqualString
          left:
            value:
              simple: inputs.System Input - Issue State
            iscontext: true
          right:
            value:
              simple: Update
      - - operator: isNotEmpty
          left:
            value:
              simple: inputs.System Input -Jira Ticket ID
            iscontext: true
      - - operator: inList
          left:
            value:
              simple: modules.brand
            iscontext: true
          right:
            value:
              simple: Jira V3
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 150,
          "y": 560
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: cf647d05-5201-44f4-a86b-6b731d54332d
    type: regular
    task:
      id: cf647d05-5201-44f4-a86b-6b731d54332d
      version: -1
      name: Send Email Notification
      description: commands.server.mail.sendmail
      script: mail-sender|||send-mail
      type: regular
      iscommand: true
      brand: mail-sender
      playbooktaskmissingcomponent: null
    nexttasks:
      '#none#':
      - "15"
    scriptarguments:
      htmlBody:
        simple: "<html>\n<body style=\"font-family: Arial, sans-serif; background-color:
          #f6f7f9; margin: 0; padding: 30px;\">\n  <div style=\"max-width: 600px;
          margin: auto; background-color: #ffffff; border-radius: 6px; box-shadow:
          0 2px 5px rgba(0,0,0,0.1); padding: 25px 30px;\">\n\n    <div style=\"text-align:
          center; color: #0067b8; font-size: 20px; font-weight: bold; margin-bottom:
          25px;\">\n      Cortex Cloud Issue Details\n    </div>\n\n    <p style=\"font-size:
          14px; margin-bottom: 25px;\">\n      A cloud misconfiguration has been detected
          and requires your review.\n    </p>\n\n    <table style=\"width: 100%; border-collapse:
          collapse; margin-bottom: 20px; font-size: 14px; border: 1px solid #e0e0e0;\">\n
          \     <tr>\n        <td style=\"padding: 10px; border: 1px solid #e0e0e0;
          background-color: #f9f9f9; font-weight: bold; width: 40%;\">Issue Name</td>\n
          \       <td style=\"padding: 10px; border: 1px solid #e0e0e0;\">${issue.name}</td>\n
          \     </tr>\n      <tr>\n        <td style=\"padding: 10px; border: 1px
          solid #e0e0e0; background-color: #f9f9f9; font-weight: bold;\">Severity</td>\n
          \       <td style=\"padding: 10px; border: 1px solid #e0e0e0;\">${issue.severity}</td>\n
          \     </tr>\n      <tr>\n        <td style=\"padding: 10px; border: 1px
          solid #e0e0e0; background-color: #f9f9f9; font-weight: bold;\">Details</td>\n
          \       <td style=\"padding: 10px; border: 1px solid #e0e0e0;\">${issue.details}</td>\n
          \     </tr>\n      <tr>\n        <td style=\"padding: 10px; border: 1px
          solid #e0e0e0; background-color: #f9f9f9; font-weight: bold;\">Category</td>\n
          \       <td style=\"padding: 10px; border: 1px solid #e0e0e0;\">${issue.alert_category}</td>\n
          \     </tr>\n      <tr>\n        <td style=\"padding: 10px; border: 1px
          solid #e0e0e0; background-color: #f9f9f9; font-weight: bold;\">Asset Name</td>\n
          \       <td style=\"padding: 10px; border: 1px solid #e0e0e0;\">${inputs.System
          Input - Asset details.xdm__asset__name}</td>\n      </tr>\n      <tr>\n
          \       <td style=\"padding: 10px; border: 1px solid #e0e0e0; background-color:
          #f9f9f9; font-weight: bold;\">Asset Type</td>\n        <td style=\"padding:
          10px; border: 1px solid #e0e0e0;\">${inputs.System Input - Asset details.xdm__asset__type__name}</td>\n
          \     </tr>\n      <tr>\n        <td style=\"padding: 10px; border: 1px
          solid #e0e0e0; background-color: #f9f9f9; font-weight: bold;\">Cloud Region</td>\n
          \       <td style=\"padding: 10px; border: 1px solid #e0e0e0;\">${inputs.System
          Input - Asset details.xdm__asset__cloud__region}</td>\n      </tr>\n      <tr>\n
          \       <td style=\"padding: 10px; border: 1px solid #e0e0e0; background-color:
          #f9f9f9; font-weight: bold;\">Cloud Account ID</td>\n        <td style=\"padding:
          10px; border: 1px solid #e0e0e0;\">${inputs.System Input - Asset details.xdm__asset__realm}</td>\n
          \     </tr>\n      <tr>\n        <td style=\"padding: 10px; border: 1px
          solid #e0e0e0; background-color: #f9f9f9; font-weight: bold;\">Issue Created</td>\n
          \       <td style=\"padding: 10px; border: 1px solid #e0e0e0;\">${issue.created}</td>\n
          \     </tr>\n    </table>\n\n    <div style=\"font-weight: bold; font-size:
          14px; margin: 15px 0 8px;\">Asset Tags</div>\n    <div style=\"background-color:
          #f2f2f2; border-radius: 4px; font-family: monospace; font-size: 13px; color:
          #444; padding: 10px; white-space: pre-wrap;\">\n      { \"Key\": \"Purpose\",
          \"Value\": \"CortexXSIAMFlowLogs\" }\n    </div>\n\n    <div style=\"text-align:
          center; margin: 30px 0 10px;\">\n      <a href=\"${demistoUrls.server}/issue-view/${issue.id}\"
          \n         target=\"_blank\"\n         style=\"display: inline-block; padding:
          10px 24px; background-color: #0067b8; color: white !important; text-decoration:
          none !important; border-radius: 4px; font-size: 14px; font-weight: bold;\">\n
          \        View Issue\n      </a>\n    </div>\n  </div>\n</body>\n</html>"
      subject:
        simple: 'Issue Detected for Asset: ${Core.CoreAsset.xdm__asset__type__name}'
      to:
        simple: ${inputs.Notification email recipients}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -220,
          "y": 1910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: df35cf28-a20e-41a0-81b2-fe489fd55842
    type: title
    task:
      id: df35cf28-a20e-41a0-81b2-fe489fd55842
      version: -1
      name: Email Notification
      type: title
      iscommand: false
      brand: ""
      playbooktaskmissingcomponent: null
    nexttasks:
      '#none#':
      - "25"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 150,
          "y": 1610
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: 2238db1f-cb8f-402e-b251-b38e05084743
    type: regular
    task:
      id: 2238db1f-cb8f-402e-b251-b38e05084743
      version: -1
      name: Send Slack Notification
      description: Sends a message to a user, group, or channel.
      script: SlackV3|||slack-send-notification-quick-action
      type: regular
      iscommand: true
      brand: SlackV3
      playbooktaskmissingcomponent: null
    nexttasks:
      '#none#':
      - "34"
    scriptarguments:
      channel:
        simple: ${inputs.Slack Channel Name}
      message:
        simple: |-
          Issue Detected for Asset: ${inputs.System Input - Asset details.xdm__asset__type__name}

          Issue Details

          Issue Name: ${issue.name}
          Severity Level: ${issue.severity}
          Category: ${issue.alert_category}
          Asset Name: ${inputs.System Input - Asset details.xdm__asset__name}
          Asset Type: ${inputs.System Input - Asset details.xdm__asset__type__name}
          Cloud Region: ${inputs.System Input - Asset details.xdm__asset__cloud__region}
          Cloud Account ID: ${inputs.System Input - Asset details.xdm__asset__realm}
          Issue Created: ${issue.created}
          Issue URL: ${demistoUrls.server}/issue-view/${issue.id}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -230,
          "y": 1450
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: ecf2c96e-a3e4-4d73-b9e6-6d76bfe08a50
    type: regular
    task:
      id: ecf2c96e-a3e4-4d73-b9e6-6d76bfe08a50
      version: -1
      name: Update Microsoft Teams Notification
      description: Sends a message to the specified teams.
      script: Microsoft Teams|||teams-send-notification-quick-action
      type: regular
      iscommand: true
      brand: Microsoft Teams
      playbooktaskmissingcomponent: null
    nexttasks:
      '#none#':
      - "40"
    scriptarguments:
      channel:
        simple: ${inputs.Teams Channel Name}
      message:
        simple: |-
          Issue Resolved for Asset: ${inputs.System Input - Asset details.xdm__asset__type__name}

          Issue - ${issue.name}
          Category: ${issue.alert_category}
          Asset Name: ${inputs.System Input - Asset details.xdm__asset__name}
          Asset Type: ${inputs.System Input - Asset details.xdm__asset__type__name}
          Cloud Region: ${inputs.System Input - Asset details.xdm__asset__cloud__region}
          Cloud Account ID: ${inputs.System Input - Asset details.xdm__asset__realm}
          Remediation: Success
          Issue Status: Resolved
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 530,
          "y": 1150
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: 263ac54d-2a15-4078-8802-8fe45855670c
    type: condition
    task:
      id: 263ac54d-2a15-4078-8802-8fe45855670c
      version: -1
      name: Notify using Slack?
      type: condition
      iscommand: false
      brand: ""
      playbooktaskmissingcomponent: null
    nexttasks:
      '#default#':
      - "34"
      Create:
      - "36"
      Update:
      - "41"
    separatecontext: false
    conditions:
    - label: Create
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.System Input - Issue State
            iscontext: true
          right:
            value:
              simple: Create
      - - operator: inList
          left:
            value:
              simple: modules.brand
            iscontext: true
          right:
            value:
              simple: SlackV3
      - - operator: isEqualString
          left:
            value:
              simple: inputs.Preferred notification platform
            iscontext: true
          right:
            value:
              simple: Slack
          ignorecase: true
    - label: Update
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.Preferred notification platform
            iscontext: true
          right:
            value:
              simple: Slack
          ignorecase: true
      - - operator: inList
          left:
            value:
              simple: modules.brand
            iscontext: true
          right:
            value:
              simple: SlackV3
      - - operator: isEqualString
          left:
            value:
              simple: inputs.System Input - Issue State
            iscontext: true
          right:
            value:
              simple: Update
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 150,
          "y": 1300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "41":
    id: "41"
    taskid: 98c05735-7a2c-4f3a-9bb4-4955e528f2b2
    type: regular
    task:
      id: 98c05735-7a2c-4f3a-9bb4-4955e528f2b2
      version: -1
      name: Update Slack Notification
      description: Sends a message to a user, group, or channel.
      script: SlackV3|||slack-send-notification-quick-action
      type: regular
      iscommand: true
      brand: SlackV3
      playbooktaskmissingcomponent: null
    nexttasks:
      '#none#':
      - "34"
    scriptarguments:
      channel:
        simple: ${inputs.Slack Channel Name}
      message:
        simple: |-
          Issue Resolved for Asset: ${inputs.System Input - Asset details.xdm__asset__type__name}

          Issue - ${issue.name}
          Category: ${issue.alert_category}
          Asset Name: ${inputs.System Input - Asset details.xdm__asset__name}
          Asset Type: ${inputs.System Input - Asset details.xdm__asset__type__name}
          Cloud Region: ${inputs.System Input - Asset details.xdm__asset__cloud__region}
          Cloud Account ID: ${inputs.System Input - Asset details.xdm__asset__realm}
          Remediation: Success
          Issue Status: Resolved
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 530,
          "y": 1450
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "42":
    id: "42"
    taskid: 6dd8067a-66a3-4bc6-8f35-79c48fc5e125
    type: regular
    task:
      id: 6dd8067a-66a3-4bc6-8f35-79c48fc5e125
      version: -1
      name: Send Microsoft Teams Notification
      description: Sends a message to the specified teams.
      script: Microsoft Teams|||teams-send-notification-quick-action
      type: regular
      iscommand: true
      brand: Microsoft Teams
      playbooktaskmissingcomponent: null
    nexttasks:
      '#none#':
      - "40"
    scriptarguments:
      channel:
        simple: ${inputs.Teams Channel Name}
      message:
        simple: |-
          Issue Detected for Asset: ${inputs.System Input - Asset details.xdm__asset__type__name}

          Issue Details

          Issue Name: ${issue.name}
          Severity Level: ${issue.severity}
          Category: ${issue.alert_category}
          Asset Name: ${inputs.System Input - Asset details.xdm__asset__name}
          Asset Type: ${inputs.System Input - Asset details.xdm__asset__type__name}
          Cloud Region: ${inputs.System Input - Asset details.xdm__asset__cloud__region}
          Cloud Account ID: ${inputs.System Input - Asset details.xdm__asset__realm}
          Issue Created: ${issue.created}
          Issue URL: ${demistoUrls.server}/issue-view/${issue.id}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -230,
          "y": 1150
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "43":
    id: "43"
    taskid: 83dbde5e-0e55-4ce3-8c5d-c7e12ee5ff85
    type: regular
    task:
      id: 83dbde5e-0e55-4ce3-8c5d-c7e12ee5ff85
      version: -1
      name: Update Email Notification
      description: commands.server.mail.sendmail
      script: mail-sender|||send-mail
      type: regular
      iscommand: true
      brand: mail-sender
      playbooktaskmissingcomponent: null
    nexttasks:
      '#none#':
      - "15"
    scriptarguments:
      htmlBody:
        simple: "<html>\n<body style=\"font-family: Arial, sans-serif; background-color:
          #f6f7f9; margin: 0; padding: 30px;\">\n  <div style=\"max-width: 600px;
          margin: auto; background-color: #ffffff; border-radius: 6px; box-shadow:
          0 2px 5px rgba(0,0,0,0.1); padding: 25px 30px;\">\n\n    <div style=\"text-align:
          center; color: #0067b8; font-size: 20px; font-weight: bold; margin-bottom:
          25px;\">\n      Cortex Cloud Issue Details\n    </div>\n\n    <table style=\"width:
          100%; border-collapse: collapse; margin-bottom: 20px; font-size: 14px; border:
          1px solid #e0e0e0;\">\n      <tr>\n        <td style=\"padding: 10px; border:
          1px solid #e0e0e0; background-color: #f9f9f9; font-weight: bold; width:
          40%;\">Issue Name</td>\n        <td style=\"padding: 10px; border: 1px solid
          #e0e0e0;\">${issue.name}</td>\n      </tr>\n      <tr>\n        <td style=\"padding:
          10px; border: 1px solid #e0e0e0; background-color: #f9f9f9; font-weight:
          bold;\">Asset Name</td>\n        <td style=\"padding: 10px; border: 1px
          solid #e0e0e0;\">${inputs.System Input - Asset details.xdm__asset__name}</td>\n
          \     </tr>\n      <tr>\n        <td style=\"padding: 10px; border: 1px
          solid #e0e0e0; background-color: #f9f9f9; font-weight: bold;\">Asset Type</td>\n
          \       <td style=\"padding: 10px; border: 1px solid #e0e0e0;\">${inputs.System
          Input - Asset details.xdm__asset__type__name}</td>\n      </tr>\n      <tr>\n
          \       <td style=\"padding: 10px; border: 1px solid #e0e0e0; background-color:
          #f9f9f9; font-weight: bold;\">Cloud Region</td>\n        <td style=\"padding:
          10px; border: 1px solid #e0e0e0;\">${inputs.System Input - Asset details.xdm__asset__cloud__region}</td>\n
          \     </tr>\n      <tr>\n        <td style=\"padding: 10px; border: 1px
          solid #e0e0e0; background-color: #f9f9f9; font-weight: bold;\">Cloud Account
          ID</td>\n        <td style=\"padding: 10px; border: 1px solid #e0e0e0;\">${inputs.System
          Input - Asset details.xdm__asset__realm}</td>\n      </tr>\n      <tr>\n
          \       <td style=\"padding: 10px; border: 1px solid #e0e0e0; background-color:
          #f9f9f9; font-weight: bold;\">Remediation</td>\n        <td style=\"padding:
          10px; border: 1px solid #e0e0e0;\">Success</td>\n      </tr>\n    </table>\n
          \   <div style=\"text-align: center; margin: 30px 0 10px;\">\n      <a href=\"${demistoUrls.server}/issue-view/${issue.id}\"
          \n         target=\"_blank\"\n         style=\"display: inline-block; padding:
          10px 24px; background-color: #0067b8; color: white !important; text-decoration:
          none !important; border-radius: 4px; font-size: 14px; font-weight: bold;\">\n
          \        View Issue\n      </a>\n    </div>\n  </div>\n</body>\n</html>"
      subject:
        simple: Issue Resolved for Asset - ${Core.CoreAsset.xdm__asset__type__name}
      to:
        simple: ${inputs.Notification email recipients}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 530,
          "y": 1910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "44":
    id: "44"
    taskid: 61bcbd5c-c50e-48e7-b7c7-6d083e572608
    type: regular
    task:
      id: 61bcbd5c-c50e-48e7-b7c7-6d083e572608
      version: -1
      name: Update Issue ServiceNow ticket
      description: Updates the specified ticket.
      script: ServiceNow v2|||servicenow-update-ticket
      type: regular
      iscommand: true
      brand: ServiceNow v2
      playbooktaskmissingcomponent: null
    nexttasks:
      '#none#':
      - "32"
    scriptarguments:
      comments:
        simple: |-
          Issue Resolved for Asset: ${inputs.System Input - Asset details.xdm__asset__type__name}

          Issue - ${issue.name}
          Category: ${issue.alert_category}
          Asset Name: ${inputs.System Input - Asset details.xdm__asset__name}
          Asset Type: ${inputs.System Input - Asset details.xdm__asset__type__name}
          Cloud Region: ${inputs.System Input - Asset details.xdm__asset__cloud__region}
          Cloud Account ID: ${inputs.System Input - Asset details.xdm__asset__realm}
          Remediation: Success
          Issue Status: Resolved
      id:
        simple: ${inputs.System Input -ServiceNow Ticket ID}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 530,
          "y": 410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "45":
    id: "45"
    taskid: f296f6bf-57a7-4e0b-9387-87c03338ad8c
    type: regular
    task:
      id: f296f6bf-57a7-4e0b-9387-87c03338ad8c
      version: -1
      name: Update Issue Jira ticket
      description: Adds a new comment to an existing Jira issue.
      script: Jira V3|||jira-issue-add-comment
      type: regular
      iscommand: true
      brand: Jira V3
      playbooktaskmissingcomponent: null
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      comment:
        simple: |-
          Issue Resolved for Asset: ${inputs.System Input - Asset details.xdm__asset__type__name}

          Issue - ${issue.name}
          Category: ${issue.alert_category}
          Asset Name: ${inputs.System Input - Asset details.xdm__asset__name}
          Asset Type: ${inputs.System Input - Asset details.xdm__asset__type__name}
          Cloud Region: ${inputs.System Input - Asset details.xdm__asset__cloud__region}
          Cloud Account ID: ${inputs.System Input - Asset details.xdm__asset__realm}
          Remediation: Success
          Issue Status: Resolved
      issue_id:
        simple: ${inputs.System Input -Jira Ticket ID}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 530,
          "y": 710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "12_21_Create": 0.57,
      "12_44_Update": 0.6
    },
    "paper": {
      "dimensions": {
        "height": 2120,
        "width": 1170,
        "x": -260,
        "y": 0
      }
    }
  }
inputs:
- key: Preferred ticketing platform
  value: {}
  required: false
  description: |-
    Possible values:
    - Jira
    - ServiceNow
    - Both

    Note: If you leave this empty, no issue ticket will be generated, and the playbook will skip this step.
  playbookInputQuery: null
- key: Preferred notification platform
  value: {}
  required: false
  description: |-
    Possible values:
    - Microsoft Teams
    - Slack

    Note: If you leave this blank, no notification message will be sent and the playbook will skip this step.
  playbookInputQuery: null
- key: Notification email recipients
  value: {}
  required: false
  description: |-
    Provide the email address to send email notifications.

    Note: If you leave this blank, no email notification will be sent and the playbook will skip this step.
  playbookInputQuery: null
- key: System Input - Asset details
  value: {}
  required: false
  description: 'Note: No input is required here; issue asset details will be automatically
    pulled from the remediation playbook.'
  playbookInputQuery: null
- key: System Input - Issue State
  value: {}
  required: false
  description: 'Note: No input is required here; issue state value will be automatically
    entered from the remediation playbook.'
  playbookInputQuery: null
- key: System Input -ServiceNow Ticket ID
  value: {}
  required: false
  description: 'Note: No input is required here; ServiceNow ticket ID will be automatically
    pulled from the remediation playbook.'
  playbookInputQuery: null
- key: System Input -Jira Ticket ID
  value: {}
  required: false
  description: 'Note: No input is required here; Jira ticket ID will be automatically
    pulled from the remediation playbook.'
  playbookInputQuery: null
- key: Jira Project Key
  value: {}
  required: false
  description: Provide Jira project key where the issue will be created.
  playbookInputQuery: null
- key: Teams Channel Name
  value: {}
  required: false
  description: Provide Microsoft Teams channel name to which to send messages.
  playbookInputQuery: null
- key: Slack Channel Name
  value: {}
  required: false
  description: Provide Slack channel name to which to send messages.
  playbookInputQuery: null
inputSections:
- inputs:
  - Preferred ticketing platform
  - Preferred notification platform
  - Notification email recipients
  - System Input - Asset details
  - System Input - Issue State
  - System Input -ServiceNow Ticket ID
  - System Input -Jira Ticket ID
  - Jira Project Key
  - Teams Channel Name
  - Slack Channel Name
  name: General (Inputs group)
  description: Generic group for inputs
outputSections:
- outputs:
  - Ticket.Id
  - ServiceNow.Ticket.ID
  name: General (Outputs group)
  description: Generic group for outputs
outputs:
- contextPath: Ticket.Id
  description: Jira Ticket ID.
  type: string
- contextPath: ServiceNow.Ticket.ID
  description: Service Now Ticket ID.
  type: string
sourceplaybookid: Create Ticket and Notify
dirtyInputs: true
adopted: true
