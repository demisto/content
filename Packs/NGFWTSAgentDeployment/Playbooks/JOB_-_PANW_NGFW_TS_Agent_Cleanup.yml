id: 687cc5b0-416e-4587-882f-8e33cc8557cd
inputs: []
name: JOB - PANW NGFW TS Agent Cleanup
description: Run this playbook as a job to cleanup disconnected TS Agents
outputs: []
starttaskid: "0"
tasks:
  "0":
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "1"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Start
      id: 77c27c7e-a2df-4cd6-8ec1-6a177dfe190c
      iscommand: false
      name: ""
      version: -1
    taskid: 77c27c7e-a2df-4cd6-8ec1-6a177dfe190c
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 480,
          "y": 65
        }
      }
  "1":
    id: "1"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "9"
    note: false
    quietmode: 0
    scriptarguments:
      action:
        simple: get
      cmd:
        simple: <show><config><running></running></config></show>
      extend-context:
        simple: TSAgent=.=val.response.result.config.devices.entry.vsys.entry['ts-agent']
      type:
        simple: op
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Run any command supported in the API.
      id: 3943b0f0-ca0d-49dc-8940-304037f1208e
      iscommand: true
      name: Get List of TS agents
      script: '|||panorama'
      type: regular
      version: -1
    taskid: 3943b0f0-ca0d-49dc-8940-304037f1208e
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 225
        }
      }
  "5":
    id: "5"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.close.inv
      id: 109dbb9e-ed14-4e3d-8599-09c77915c636
      iscommand: true
      name: Close Investigation
      script: Builtin|||closeInvestigation
      type: regular
      version: -1
    taskid: 109dbb9e-ed14-4e3d-8599-09c77915c636
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 925
        }
      }
  "7":
    id: "7"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "5"
    note: false
    quietmode: 0
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: Commit the PAN-OS Panorama or Firewall configuration.\nIf specified
        as Panorama, it also pushes the Policies to the specified Device Group in
        the instance.
      id: a3819db3-33b1-49ec-8bac-360780b8597c
      iscommand: false
      name: PAN-OS Commit Configuration
      playbookId: PAN-OS Commit Configuration
      type: playbook
      version: -1
    taskid: a3819db3-33b1-49ec-8bac-360780b8597c
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 720,
          "y": 740
        }
      }
  "9":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: TSAgent
          operator: isExists
      label: "yes"
    id: "9"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "5"
      "yes":
      - "10"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 77a6fbc0-6e9b-45f5-83d7-67d87fd7cdb7
      iscommand: false
      name: TSAgents Exist?
      description: Check the TS Agent exists on the firewall
      type: condition
      version: -1
    taskid: 77a6fbc0-6e9b-45f5-83d7-67d87fd7cdb7
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 480,
          "y": 400
        }
      }
  "10":
    id: "10"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      forEach: true
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "7"
    note: false
    quietmode: 0
    scriptarguments:
      TSAgent:
        simple: ${TSAgent.entry}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: bf94bbf2-6db9-468f-8fa3-18d08fbc9e28
      iscommand: false
      name: NGFW Remove Offline TS Agent
      playbookId: 46756867-c011-44d0-82ee-0b3b63468a10
      description: Playbook to deregister agent
      type: playbook
      version: -1
    taskid: bf94bbf2-6db9-468f-8fa3-18d08fbc9e28
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 720,
          "y": 580
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 955,
        "width": 620,
        "x": 480,
        "y": 65
      }
    }
  }
