import json
import io
from ACTIVulnerabilityQuery import Client, vuln_command
from test_data.response_constants import *
import demistomock as demisto
from CommonServerPython import DemistoException, DBotScoreReliability
import requests_mock


API_URL = "https://test.com"


def util_load_json(path):
    with io.open(path, mode='r', encoding='utf-8') as f:
        return json.loads(f.read())


# TODO: REMOVE the following dummy unit test function
def test_vuln_command():
    """
    Given:
        - an CVE

    When:
        - running Vulnerability command and validate whether the CVE is malicious

    Then:
        - return command results containing Vulnerability, dbotscore

    """
    url = 'https://test.com/rest/vulnerability/v0?key.values=CVE-2022-23021'
    status_code = 200
    json_res = VULN_RES_JSON

    expected_output = {
        'cve': 'CVE-2022-23021'
    }

    cve_to_check = {'cve': 'CVE-2022-23021'}

    with requests_mock.Mocker() as m:
        m.get(url, status_code=status_code, json=json_res)
        client = Client(API_URL, 'api_token', True, False, '/rest/vulnerability')
        results = vuln_command(client, cve_to_check, DBotScoreReliability.B)
        print("--------------------------------test file---------------------------")
        print(results)


    assert False