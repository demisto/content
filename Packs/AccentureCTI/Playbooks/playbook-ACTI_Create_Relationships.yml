id: 5a524514-cb58-46c6-892a-521a7794a58d
version: 38
vcShouldKeepItemLegacyProdMachine: false
name: ACTI Create Report-Indicator Associations
description: Helps in creating associations between indicators and reports.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: af801ba5-d00f-48a5-8975-bbd88db4b8fd
    type: start
    task:
      id: af801ba5-d00f-48a5-8975-bbd88db4b8fd
      version: -1
      name: ""
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "9"
      - "10"
      - "11"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 900,
          "y": -460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: 788db5dd-1bc9-48f9-820b-a9f03d7e5d4f
    type: regular
    task:
      id: 788db5dd-1bc9-48f9-820b-a9f03d7e5d4f
      version: -1
      name: IP
      description: This automation creates a relationship between indicator objects.
      scriptName: CreateIndicatorRelationship
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      create_indicator:
        simple: "true"
      entity_a:
        simple: ${inputs.IP}
      entity_a_type:
        simple: IP
      entity_b:
        simple: ${inputs.IA}${inputs.IR}
      entity_b_type:
        simple: Report
      relationship:
        simple: related-to
      reverse_relationship:
        simple: attachment-of
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 900,
          "y": 610
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: c8424f49-753e-45bf-8d0c-48a6aeaec9b2
    type: regular
    task:
      id: c8424f49-753e-45bf-8d0c-48a6aeaec9b2
      version: -1
      name: Domain
      description: This automation creates a relationship between indicator objects.
      scriptName: CreateIndicatorRelationship
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      create_indicator:
        simple: "true"
      entity_a:
        simple: ${inputs.Domain}
      entity_a_type:
        simple: Domain
      entity_b:
        simple: ${inputs.IA}${inputs.IR}
      entity_b_type:
        simple: Report
      relationship:
        simple: related-to
      reverse_relationship:
        simple: attachment-of
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 460,
          "y": 610
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: b8b38e99-a4cc-4f4c-8f18-7fef54a28c70
    type: regular
    task:
      id: b8b38e99-a4cc-4f4c-8f18-7fef54a28c70
      version: -1
      name: URL
      description: This automation creates a relationship between indicator objects.
      scriptName: CreateIndicatorRelationship
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      create_indicator:
        simple: "true"
      entity_a:
        simple: ${inputs.URL}
      entity_a_type:
        simple: URL
      entity_b:
        simple: ${inputs.IA}${inputs.IR}
      entity_b_type:
        simple: Report
      relationship:
        simple: related-to
      reverse_relationship:
        simple: attachment-of
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1330,
          "y": 610
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: 30c46f97-d582-4d8e-821f-333bf1bd62d1
    type: title
    task:
      id: 30c46f97-d582-4d8e-821f-333bf1bd62d1
      version: -1
      name: END
      type: title
      iscommand: false
      brand: ""
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 900,
          "y": 1100
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: 4eb7d5a1-37b9-4157-8754-2c91f5575fb8
    type: condition
    task:
      id: 4eb7d5a1-37b9-4157-8754-2c91f5575fb8
      version: -1
      name: Is ACTI Indicator?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "4"
      Domain:
      - "2"
      IP:
      - "1"
      URL:
      - "3"
    separatecontext: false
    conditions:
    - label: IP
      condition:
      - - operator: inList
          left:
            value:
              simple: ACTI Indicator Query
          right:
            value:
              complex:
                root: DBotScore
                accessor: Vendor
                transformers:
                - operator: join
                  args:
                    separator:
                      value:
                        simple: ','
            iscontext: true
      - - operator: inList
          left:
            value:
              simple: ip
          right:
            value:
              complex:
                root: DBotScore
                accessor: Type
                transformers:
                - operator: join
                  args:
                    separator:
                      value:
                        simple: ','
            iscontext: true
    - label: Domain
      condition:
      - - operator: inList
          left:
            value:
              simple: ACTI Indicator Query
          right:
            value:
              complex:
                root: DBotScore
                accessor: Vendor
                transformers:
                - operator: join
                  args:
                    separator:
                      value:
                        simple: ','
            iscontext: true
      - - operator: inList
          left:
            value:
              simple: domain
          right:
            value:
              complex:
                root: DBotScore
                accessor: Type
                transformers:
                - operator: join
                  args:
                    separator:
                      value:
                        simple: ','
            iscontext: true
    - label: URL
      condition:
      - - operator: inList
          left:
            value:
              simple: ACTI Indicator Query
          right:
            value:
              complex:
                root: DBotScore
                accessor: Vendor
                transformers:
                - operator: join
                  args:
                    separator:
                      value:
                        simple: ','
            iscontext: true
      - - operator: inList
          left:
            value:
              simple: url
          right:
            value:
              complex:
                root: DBotScore
                accessor: Type
                transformers:
                - operator: join
                  args:
                    separator:
                      value:
                        simple: ','
            iscontext: true
    view: |-
      {
        "position": {
          "x": 900,
          "y": 350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: cf64d780-3992-4045-8dfb-498e6025de4c
    type: regular
    task:
      id: cf64d780-3992-4045-8dfb-498e6025de4c
      version: -1
      name: GetIPDBotScore
      description: Add into the incident's context the system internal DBot score
        for the input indicator.
      scriptName: GetIndicatorDBotScore
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "5"
    scriptarguments:
      indicator:
        simple: ${inputs.IP}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 460,
          "y": 50
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: cc5a19bc-75d6-48b6-82bc-465484080686
    type: regular
    task:
      id: cc5a19bc-75d6-48b6-82bc-465484080686
      version: -1
      name: GetDomainDBotScore
      description: Add into the incident's context the system internal DBot score
        for the input indicator.
      scriptName: GetIndicatorDBotScore
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "5"
    scriptarguments:
      indicator:
        simple: ${inputs.Domain}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1350,
          "y": 50
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: 8442b1fb-0ac5-4342-812d-b00c38b4fc45
    type: regular
    task:
      id: 8442b1fb-0ac5-4342-812d-b00c38b4fc45
      version: -1
      name: GetURLDBotScore
      description: Add into the incident's context the system internal DBot score
        for the input indicator.
      scriptName: GetIndicatorDBotScore
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "5"
    scriptarguments:
      indicator:
        simple: ${inputs.URL}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 900,
          "y": 50
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: adc7d9f5-5369-4d2c-8b49-85d3e084fde1
    type: condition
    task:
      id: adc7d9f5-5369-4d2c-8b49-85d3e084fde1
      version: -1
      name: IP Exists
      description: Check if a given value exists in the context. Will return 'no'
        for empty empty arrays. To be used mostly with DQ and selectors.
      scriptName: Exists
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "4"
      "yes":
      - "6"
    scriptarguments:
      value:
        simple: ${inputs.IP}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": -160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: 74c70523-86ea-4667-81ab-7e6570e9305d
    type: condition
    task:
      id: 74c70523-86ea-4667-81ab-7e6570e9305d
      version: -1
      name: Domain Exists
      description: Check if a given value exists in the context. Will return 'no'
        for empty empty arrays. To be used mostly with DQ and selectors.
      scriptName: Exists
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "4"
      "yes":
      - "7"
    scriptarguments:
      value:
        simple: ${inputs.Domain}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1350,
          "y": -160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: 6eb00825-1bd6-4dd9-8e96-ae555259811f
    type: condition
    task:
      id: 6eb00825-1bd6-4dd9-8e96-ae555259811f
      version: -1
      name: URL Exists
      description: Check if a given value exists in the context. Will return 'no'
        for empty empty arrays. To be used mostly with DQ and selectors.
      scriptName: Exists
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "4"
      "yes":
      - "8"
    scriptarguments:
      value:
        simple: ${inputs.URL}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 900,
          "y": -160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "5_1_IP": 0.59
    },
    "paper": {
      "dimensions": {
        "height": 1625,
        "width": 1270,
        "x": 460,
        "y": -460
      }
    }
  }
inputs:
- key: IP
  value:
    complex:
      root: ${IP
      accessor: Address}
      transformers:
      - operator: uniq
  required: false
  description: ""
  playbookInputQuery: null
- key: IA
  value:
    complex:
      root: ${intelligence_alerts}
      transformers:
      - operator: uniq
  required: false
  description: ""
  playbookInputQuery: null
- key: IR
  value:
    complex:
      root: ${intelligence_reports}
      transformers:
      - operator: uniq
  required: false
  description: ""
  playbookInputQuery: null
- key: URL
  value:
    complex:
      root: ${URL
      accessor: Data}
      transformers:
      - operator: uniq
  required: false
  description: ""
  playbookInputQuery: null
- key: Domain
  value:
    complex:
      root: ${Domain
      accessor: Name}
      transformers:
      - operator: uniq
  required: false
  description: ""
  playbookInputQuery: null
outputs: []
