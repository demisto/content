id: SafeBreach - Process Non-Behavioral Insights Feed
version: -1
name: SafeBreach - Process Non-Behavioral Insights Feed
description: This playbook automatically remediates all non-behavioral indicators
  generated from SafeBreach Insights. To validate the remediation, it reruns the related
  insights and classifies the indicators as Remediated or Not Remediated.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 15e139ef-24e4-494e-8fba-e37824cb11da
    type: start
    task:
      id: 15e139ef-24e4-494e-8fba-e37824cb11da
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "15"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 490,
          "y": -680
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "3":
    id: "3"
    taskid: 9cb0dfd8-0b07-4ab3-899c-c7b29fd8c17c
    type: title
    task:
      id: 9cb0dfd8-0b07-4ab3-899c-c7b29fd8c17c
      version: -1
      name: End
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 490,
          "y": 920
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "8":
    id: "8"
    taskid: 010260ad-edf5-41f4-8041-df4c1c0185f3
    type: regular
    task:
      id: 010260ad-edf5-41f4-8041-df4c1c0185f3
      version: -1
      name: Extract List of Insight Ids
      description: Sets a value into the context with the given context key
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      append: {}
      key:
        simple: InsightIds
      stringify: {}
      value:
        complex:
          root: playbookQuery
          filters:
          - - operator: isExists
              left:
                value:
                  simple: playbookQuery.CustomFields.safebreachinsightids
                iscontext: true
          accessor: CustomFields.safebreachinsightids
          transformers:
          - operator: uniq
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 490,
          "y": -65
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "15":
    id: "15"
    taskid: 610a5781-84c5-4108-83f9-0e6619079c5c
    type: playbook
    task:
      id: 610a5781-84c5-4108-83f9-0e6619079c5c
      version: -1
      name: Block Indicators - Generic v2
      description: |+
        This playbook blocks malicious Indicators using all integrations that are enabled, using the following sub-playbooks:

        - Block URL - Generic
        - Block Account - Generic
        - Block IP - Generic v2
        - Block File - Generic v2

      playbookName: Block Indicators - Generic v2
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "17"
    scriptarguments:
      AutoCommit:
        simple: "Yes"
      CustomBlockRule:
        simple: "True"
      CustomURLCategory:
        simple: SafeBreach Domains and URIs
      DAG: {}
      EDLServerIP: {}
      IP:
        complex:
          root: playbookQuery
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: playbookQuery.score
                iscontext: true
              right:
                value:
                  simple: "3"
          - - operator: isEqualString
              left:
                value:
                  simple: playbookQuery.indicator_type
                iscontext: true
              right:
                value:
                  simple: IP
              ignorecase: true
          accessor: value
          transformers:
          - operator: uniq
      IPBlacklistMiner: {}
      IPListName:
        simple: SafeBreachIpBlockList
      LogForwarding: {}
      MD5: {}
      SHA256:
        complex:
          root: playbookQuery
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: playbookQuery.indicator_type
                iscontext: true
              right:
                value:
                  simple: file
              ignorecase: true
          - - operator: isNotEmpty
              left:
                value:
                  simple: playbookQuery.CustomFields.sha256
                iscontext: true
          accessor: CustomFields.sha256
          transformers:
          - operator: uniq
      StaticAddressGroup: {}
      URL:
        complex:
          root: playbookQuery
          filters:
          - - operator: inList
              left:
                value:
                  simple: playbookQuery.indicator_type
                iscontext: true
              right:
                value:
                  simple: Domain,URL
              ignorecase: true
          - - operator: isEqualString
              left:
                value:
                  simple: playbookQuery.score
                iscontext: true
              right:
                value:
                  simple: "3"
          accessor: value
          transformers:
          - operator: uniq
      URLBlacklistMiner: {}
      URLListName:
        simple: SafeBreach List
      Username: {}
      categories: {}
      device-group: {}
      type:
        simple: '"URL List"'
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 490,
          "y": -500
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "17":
    id: "17"
    taskid: f02ad2fe-bf5e-4415-8b37-49dc20ee660e
    type: regular
    task:
      id: f02ad2fe-bf5e-4415-8b37-49dc20ee660e
      version: -1
      name: Sleep for the remediation to work
      description: Sleep for X seconds
      scriptName: Sleep
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "8"
    scriptarguments:
      seconds:
        simple: "60"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 490,
          "y": -300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "18":
    id: "18"
    taskid: a68cdd3e-0c25-44d9-8122-acc76b10654a
    type: playbook
    task:
      id: a68cdd3e-0c25-44d9-8122-acc76b10654a
      version: -1
      name: SafeBreach - Compare and Validate Insight Indicators
      description: This playbook receives an Insight and it's indicators before validation.
        Updated indicators fetched to perform the validation. Indicators are classified
        as Remediated or Not Remediated based on their validated status and the appropriate
        field (SafeBreach Remediation Status) is updated.
      playbookName: SafeBreach - Compare and Validate Insight Indicators
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      IndicatorsBefore:
        complex:
          root: playbookQuery
          accessor: value
      Insight:
        complex:
          root: SafeBreach
          accessor: Insight
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 490,
          "y": 670
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "19":
    id: "19"
    taskid: 34bdde74-e30d-4f6e-8da0-3ecede6f3e25
    type: playbook
    task:
      id: 34bdde74-e30d-4f6e-8da0-3ecede6f3e25
      version: -1
      name: SafeBreach - Rerun Insights
      description: 'This playbook reruns a SafeBreach insight based on id and waits
        until it completes. '
      playbookName: SafeBreach - Rerun Insights
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "18"
    scriptarguments:
      InsightIds:
        complex:
          root: InsightIds
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 490,
          "y": 480
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "20":
    id: "20"
    taskid: a6d2d12a-5d5d-468f-8472-5c934b07c6f8
    type: regular
    task:
      id: a6d2d12a-5d5d-468f-8472-5c934b07c6f8
      version: -1
      name: Get Insight Info
      description: Gets SafeBreach Insights for all security control categories.
      script: '|||safebreach-get-insights'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "21"
    scriptarguments:
      insightIds:
        complex:
          root: InsightIds
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 490,
          "y": 130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "21":
    id: "21"
    taskid: 4f69b1bd-18c9-4fe7-83e7-9f39ded9cb91
    type: regular
    task:
      id: 4f69b1bd-18c9-4fe7-83e7-9f39ded9cb91
      version: -1
      name: Get Insight Remediation Data
      description: Gets remediation data for a specific SafeBreach Insight.
      script: '|||safebreach-get-remediation-data'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "19"
    scriptarguments:
      insightId:
        complex:
          root: InsightIds
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 490,
          "y": 300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 1665,
        "width": 380,
        "x": 490,
        "y": -680
      }
    }
  }
inputs:
- key: ""
  value: {}
  required: false
  description: ""
  playbookInputQuery:
    query: sourceBrands:["SafeBreach*"] and -safebreachisbehavioral:T
    queryEntity: indicators
    results:
    daterange:
      fromdate: 0001-01-01T00:00:00Z
      todate: 0001-01-01T00:00:00Z
      period:
        by: ""
        byto: ""
        byfrom: ""
        tovalue:
        fromvalue:
        field: ""
      fromdatelicenseval: 0001-01-01T00:00:00Z
    runFromLastJobTime: true
outputs: []
quiet: true
fromversion: 5.0.0
tests:
- No tests (auto formatted)
