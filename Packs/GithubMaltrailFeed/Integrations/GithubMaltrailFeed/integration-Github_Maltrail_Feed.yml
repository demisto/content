category: Utilities
commonfields:
  id: Github Maltrail Feed
  version: -1
configuration:
- additionalinfo: Reliability of the source providing the intelligence data.
  defaultvalue: C - Fairly reliable
  display: Source Reliability
  name: integrationReliability
  options:
  - A+ - 3rd party enrichment
  - A - Completely reliable
  - B - Usually reliable
  - C - Fairly reliable
  - D - Not usually reliable
  - E - Unreliable
  - F - Reliability cannot be judged
  required: false
  section: Collect
  type: 15
- additionalinfo: API Token
  display: ""
  displaypassword: API Token
  hiddenusername: true
  name: api_token
  required: true
  type: 9
- display: 'Username of the repository owner, for example: github.com/repos/{user}/{repo}/issues'
  name: user
  required: true
  type: 0
- defaultvalue: https://api.github.com/repos
  display: Base URL
  name: base_url
  required: true
  type: 0
- display: 'The name of the requested repository, for example: github.com/repos/{user}/{repo}/issues'
  name: repository
  required: true
  type: 0
- advanced: true
  display: Trust any certificate (not secure)
  name: insecure
  required: false
  section: Connect
  type: 8
- advanced: true
  display: Use system proxy settings
  name: proxy
  required: false
  section: Connect
  type: 8
- defaultvalue: "15"
  display: Feed Fetch Interval
  name: feedFetchInterval
  required: false
  type: 19
- defaultvalue: "true"
  display: Fetch indicators
  name: feed
  required: false
  type: 8
- additionalinfo: Indicators from this integration instance will be marked with this
    reputation
  defaultvalue: Bad
  display: Indicator Reputation
  name: feedReputation
  options:
  - None
  - Good
  - Suspicious
  - Bad
  required: false
  type: 18
- additionalinfo: Reliability of the source providing the intelligence data
  defaultvalue: F - Reliability cannot be judged
  display: Source Reliability
  name: feedReliability
  options:
  - A - Completely reliable
  - B - Usually reliable
  - C - Fairly reliable
  - D - Not usually reliable
  - E - Unreliable
  - F - Reliability cannot be judged
  required: true
  type: 15
- defaultvalue: indicatorType
  display: ""
  name: feedExpirationPolicy
  options:
  - never
  - interval
  - indicatorType
  - suddenDeath
  required: false
  type: 17
- defaultvalue: "20160"
  display: ""
  name: feedExpirationInterval
  required: false
  type: 1
- additionalinfo: When selected, the exclusion list is ignored for indicators from
    this feed. This means that if an indicator from this feed is on the exclusion
    list, the indicator might still be added to the system.
  display: Bypass exclusion list
  name: feedBypassExclusionList
  required: false
  type: 8
- additionalinfo: Supports CSV values.
  display: Tags
  name: feedTags
  required: false
  type: 0
- additionalinfo: The Traffic Light Protocol (TLP) designation to apply to indicators
    fetched from the feed
  display: Traffic Light Protocol Color
  name: tlp_color
  options:
  - RED
  - AMBER
  - GREEN
  - WHITE
  required: false
  type: 15
contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: ""
    itemVersion: ""
    packID: 5912aac4-5532-43c3-847a-15715eb97422
    packName: Github Maltrail Feed
    prevname: ""
    propagationLabels:
    - all
    toServerVersion: ""
description: Fetches Indicators from Github Repo https://github.com/stamparm/maltrail
detaileddescription: Fetches Indicators from Github Repo https://github.com/stamparm/maltrail
display: Github Maltrail Feed
image: data:image/png;base64,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
name: Github Maltrail Feed
script:
  commands:
  - arguments:
    - name: limit
    name: get_indicators_command
  dockerimage: demisto/pyjwt3:1.0.0.76168
  feed: true
  runonce: false
  script: |-
    import requests
    import base64
    from datetime import datetime
    import regex

    # CONSTANTS
    SOURCE_NAME = "Github Maltrail Feed"
    DATE_FORMAT = '%Y-%m-%dT%H:%M:%SZ'


    # ############################## OVERWRITE REGEX FORMATTING ###############################
    regexFlags = re.M  # Multi line matching
    REGEX_IP = r"\b(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])(?:\[\.\]|\.)){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\b"

    class Client(BaseClient):

        def __init__(self, params: dict):
            self._verify: bool = not params.get('insecure', False)
            self.user = params.get('user')
            self.token = (params.get('api_token') or {}).get('password', '')
            self.repo = params.get('repository')
            self.url = params.get('base_url')
            # self.base_url = f'{self.url}/{self.user}/{self.repo}'
            self.base_url = urljoin(self.url, self.user)
            self.base_url = urljoin(self.base_url, self.repo)
            handle_proxy()

        def http_request_indicators(self):
            res = requests.get(
                url=self.base_url,
                verify=self._verify
            )
            try:
                res.raise_for_status()
            except Exception:
                LOG(f'Github Maltrail Feed - exception in request: {res.status_code!r} {res.content!r}')
                raise
            return res.text

        def getclienturl(self):
            return self.base_url

        def http_request(self, url_endpoint, params: dict = None):
            """The HTTP request for daily feeds.
            Returns:
                list. A list of indicators fetched from the feed.
            """
            self.headers = {
                'Authorization': "Bearer " + self.token
            }
            res = requests.request(
                method="GET",
                url=urljoin(self.base_url, url_endpoint),
                verify=self._verify,
                headers=self.headers,
                params=params
            )
            return res


    def fetch_indicators(client: Client, url: str, params: dict=None):
        if params:
            feed_tags = argToList(params.get('feedTags', []))
            tlp_color = params.get('tlp_color', None)
        response = client.http_request(url)
        indicator_list = []
        demisto.debug('Fetch of indicators started ###')
        # demisto.debug(client.getclienturl() + url)
        # demisto.debug(str(response))

        if response.ok:
            content = response.json()["content"]
            file_content = base64.b64decode(content).decode("utf-8")
            lines = file_content.split("\n")
            for line in lines:
                if '#' not in line and line != '':
                    type_ = auto_detect_indicator_type(line)
                    raw_data = {
                        'value': line,
                        'type': type_,
                    }
                    if regex.search(REGEX_IP, line):
                        if line.startswith('http://'):
                            line = line.strip('http://')
                        elif line.startswith('https://'):
                            line = line.strip('https://')
                        else:
                            line = line.split(':')[0]
                        type_ = "IP"
                    elif type_ == "URL":
                        if not line.startswith('http://'):
                            line = 'http://' + line
                    indicator_obj = {
                        'value': line,
                        'type': type_,
                        'service': "GitHub Maltrail Feed",
                        'fields': {},
                        'rawJSON': raw_data
                    }
                    if feed_tags:
                        indicator_obj['fields']['tags'] = feed_tags
                    if tlp_color:
                        indicator_obj['fields']['trafficlightprotocol'] = tlp_color
                    indicator_list.append(indicator_obj)
        else:
            demisto.error(f"Error: {response.status_code} - {response.json()['message']}")
        return indicator_list


    def get_last_commit_date(client):
        api_url = "/commits"
        response = client.http_request(api_url)
        last_commit_date = None
        if response.ok:
            # demisto.debug("/commits API endpoint response OK")
            commits = []
            page = 1
            while response.ok and page < 100:
                commits.extend(response.json())
                link_header = response.headers.get('Link')
                if not link_header or 'rel="next"' not in link_header:
                    break
                page += 1
                response = client.http_request(api_url, params={'page': page})
            for commit in commits:
                if 'qakbot' in commit['commit']['message']:
                    #print(commit)
                    commit_date = date_to_timestamp(parse_date_string(commit['commit']['author']['date'], DATE_FORMAT))
                    if not last_commit_date:
                        last_commit_date = commit_date
                    elif commit_date > last_commit_date:
                        last_commit_date = commit_date

        return last_commit_date


    def fetch_indicators_command(client: Client, args: dict, params: dict=None):
        integration_context = get_integration_context()
        api_url = "/contents/trails/static/malware/qakbot.txt"
        indicator_list = []

        #First Fetch
        if not integration_context:
            # page_num = 0
            time_of_first_fetch = date_to_timestamp(datetime.now(), DATE_FORMAT)
            # demisto.debug(f'### Time from first fetch {time_of_first_fetch}')
            set_integration_context({'time_of_last_fetch': time_of_first_fetch})
            # demisto.debug(f'###integration_context')
            indicator_list = fetch_indicators(client, api_url, params)
        else:
            # page_num = integration_context.get('page_num', 0)
            time_from_last_update = integration_context.get('time_of_last_fetch')
            # demisto.debug(f'### Time from last update {time_from_last_update}')
            now = date_to_timestamp(datetime.now(), DATE_FORMAT)
            # demisto.debug(f'### Time now {now}')
            last_commit_date = get_last_commit_date(client)
            # demisto.debug(f'### Last Commit Date: {last_commit_date}')
            if last_commit_date > time_from_last_update:
                indicator_list = fetch_indicators(client, api_url, params)
                set_integration_context({'time_of_last_fetch': now})
            else:
                demisto.debug(f'### Nothing to fetch')

        return indicator_list


    def get_indicators_command(client: Client, params: dict, args: dict):
        limit = args.get('limit')
        if limit:
            limit = int(limit)
        indicator_list = fetch_indicators_command(client=client, args=limit)
        human_readable = tableToMarkdown("Indicators from Github Maltrail:", indicator_list,
                                         headers=['value', 'type', 'firstseenbysource', 'lastseenbysource', 'name'],
                                         removeNull=True)
        return human_readable, {}, indicator_list


    def test_module_command(client: Client, params: dict, args: dict):
        client.http_request_indicators()
        return 'ok', {}, {}


    def main():
        params = demisto.params()
        args = demisto.args()

        command = demisto.command()
        demisto.info(f'Command being called is {command}')

        # Switch case
        commands = {
            'test-module': test_module_command,
            'get-indicators': get_indicators_command
        }

        try:
            client = Client(params)
            if command == 'fetch-indicators':
                # demisto.debug(f'Fetching Incidents!@#')
                indicators = fetch_indicators_command(client, args, params)
                for b in batch(indicators, batch_size=2000):
                    demisto.createIndicators(b)
            else:
                readable_output, outputs, raw_response = commands[command](client, params, args)
                return_outputs(readable_output, outputs, raw_response)

        except Exception as e:
            raise Exception(f'Error in {SOURCE_NAME} Integration [{e}]')



    if __name__ in ('__main__', '__builtin__', 'builtins'):
        main()
  subtype: python3
  type: python
