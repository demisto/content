id: O365-SecurityAndComplianceV2-Test
version: -1
vcShouldKeepItemLegacyProdMachine: false
name: O365-SecurityAndComplianceV2-Test
description: This playbook test SecurityAndCompliance integration
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: e169eb61-5742-4392-8d45-e5fb59c022eb
    type: start
    task:
      id: e169eb61-5742-4392-8d45-e5fb59c022eb
      version: -1
      name: ""
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "30"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 152.5,
          "y": 50
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: c511b059-cc6a-441e-837d-08cec0204011
    type: condition
    task:
      id: c511b059-cc6a-441e-837d-08cec0204011
      version: -1
      name: Validate compliance search created
      description: 'Validate compliance search creation with all additional arguments. '
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "25"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: O365.SecurityAndCompliance.ContentSearch.Search.AllowNotFoundExchangeLocationsEnabled
            iscontext: true
          right:
            value:
              simple: "true"
      - - operator: isEqualString
          left:
            value:
              simple: O365.SecurityAndCompliance.ContentSearch.Search.Description
            iscontext: true
          right:
            value:
              simple: Demisto description
      - - operator: containsGeneral
          left:
            value:
              simple: O365.SecurityAndCompliance.ContentSearch.Search.ExchangeLocation
            iscontext: true
          right:
            value:
              simple: avishai@demistodev.onmicrosoft.com
      - - operator: isEqualString
          left:
            value:
              simple: O365.SecurityAndCompliance.ContentSearch.Search.ContentMatchQuery
            iscontext: true
          right:
            value:
              simple: Rodrigo
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 152.5,
          "y": 370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: 554a5051-c227-40e7-8666-6868eb610af4
    type: regular
    task:
      id: 554a5051-c227-40e7-8666-6868eb610af4
      version: -1
      name: Remove search
      description: Remove compliance search by name from the Security & Compliance
        Center.
      script: '|||o365-sc-remove-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "29"
    scriptarguments:
      retry-count:
        simple: "10"
      search_name:
        complex:
          root: O365.SecurityAndCompliance.ContentSearch.Search
          accessor: Name
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: 29eb4505-05ec-4352-86af-14471708d3a2
    type: regular
    task:
      id: 29eb4505-05ec-4352-86af-14471708d3a2
      version: -1
      name: Get search
      description: Get compliance search from the Security & Compliance Center.
      script: '|||o365-sc-get-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "6"
    scriptarguments:
      retry-count:
        simple: "10"
      search_name:
        complex:
          root: O365.SecurityAndCompliance.ContentSearch.Search
          accessor: Name
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 357.5,
          "y": 720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: c9a5ddde-c130-435e-86e3-fb71f4e395f5
    type: condition
    task:
      id: c9a5ddde-c130-435e-86e3-fb71f4e395f5
      version: -1
      name: Validate !o365-sc-get-search and !o365-sc-set-search commands
      description: 'Validate compliance search modified with all additional arguments. '
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "32"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: notContainsGeneral
          left:
            value:
              simple: O365.SecurityAndCompliance.ContentSearch.Search.ExchangeLocation
            iscontext: true
          right:
            value:
              simple: notexists@demistodev.onmicrosoft.com
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 350,
          "y": 870
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: fe938e79-5101-423c-8427-bd16f379ca64
    type: regular
    task:
      id: fe938e79-5101-423c-8427-bd16f379ca64
      version: -1
      name: Remove search
      description: Remove compliance search by name from the Security & Compliance
        Center.
      script: '|||o365-sc-remove-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      retry-count:
        simple: "10"
      search_name:
        complex:
          root: O365.SecurityAndCompliance.ContentSearch.Search
          accessor: Name
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 60118754-7fd5-4a0c-851b-34ab665eda57
    type: regular
    task:
      id: 60118754-7fd5-4a0c-851b-34ab665eda57
      version: -1
      name: PrintErrorEntry
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: Fail executing test playbook
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2295
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: 3e9ae2ca-b6ef-4604-8763-4d17f531ccc0
    type: condition
    task:
      id: 3e9ae2ca-b6ef-4604-8763-4d17f531ccc0
      version: -1
      name: Validate !o365-sc-new-search-action (Generic polling playbook) and !o365-sc-get-search-action
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "23"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: O365.SecurityAndCompliance.ContentSearch.SearchAction.Results
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1595
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: e1e27d1e-37aa-44ef-8130-1f38db5a45d7
    type: regular
    task:
      id: e1e27d1e-37aa-44ef-8130-1f38db5a45d7
      version: -1
      name: Get search action
      description: Get compliance search action from the Security & Compliance Center.
        This command must come after executing the command o365-sc-start-search.
      script: '|||o365-sc-get-search-action'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "18"
    scriptarguments:
      results:
        simple: "true"
      retry-count:
        simple: "10"
      search_action_name:
        complex:
          root: O365.SecurityAndCompliance.ContentSearch.SearchAction
          accessor: Name
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1420
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: e2c924b0-b500-43da-8ad9-f7b332b712cd
    type: regular
    task:
      id: e2c924b0-b500-43da-8ad9-f7b332b712cd
      version: -1
      name: Remove search action
      description: Remove a compliance search action by specifying its action name.
      script: '|||o365-sc-remove-search-action'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "24"
    scriptarguments:
      retry-count:
        simple: "10"
      search_action_name:
        complex:
          root: O365.SecurityAndCompliance.ContentSearch.SearchAction
          accessor: Name
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: c6dc3c3a-5628-4029-851c-30e43c24da11
    type: regular
    task:
      id: c6dc3c3a-5628-4029-851c-30e43c24da11
      version: -1
      name: Stop search
      description: Stop running compliance search in the Security & Compliance Center.
      script: '|||o365-sc-stop-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      retry-count:
        simple: "10"
      search_name:
        complex:
          root: O365.SecurityAndCompliance.ContentSearch.Search
          accessor: Name
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1945
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: fefae982-36ce-486b-82e5-f86b3ff05a5b
    type: regular
    task:
      id: fefae982-36ce-486b-82e5-f86b3ff05a5b
      version: -1
      name: Set search
      description: Modify non-running compliance search in the Security & Compliance
        Center.
      script: '|||o365-sc-set-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "5"
    scriptarguments:
      allow_not_found_exchange_locations:
        simple: "false"
      remove_exchange_location:
        simple: notexists@demistodev.onmicrosoft.com
      retry-count:
        simple: "10"
      search_name:
        complex:
          root: O365.SecurityAndCompliance.ContentSearch.Search.Name
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 357.5,
          "y": 545
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: 34affed8-02c6-4527-8e2b-bc38fca6eb0f
    type: condition
    task:
      id: 34affed8-02c6-4527-8e2b-bc38fca6eb0f
      version: -1
      name: Check if search action created
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "16"
      "yes":
      - "27"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: O365.SecurityAndCompliance.ContentSearch.SearchAction.Name
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1945
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: 0ea17519-bb89-46a7-8c12-d7e16382c136
    type: regular
    task:
      id: 0ea17519-bb89-46a7-8c12-d7e16382c136
      version: -1
      name: Remove search action
      description: Remove a compliance search action by specifying its action name.
      script: '|||o365-sc-remove-search-action'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      retry-count:
        simple: "10"
      search_action_name:
        complex:
          root: O365.SecurityAndCompliance.ContentSearch.SearchAction
          accessor: Name
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: 6b60649b-2c2b-4f8e-8150-e99e4335c49b
    type: title
    task:
      id: 6b60649b-2c2b-4f8e-8150-e99e4335c49b
      version: -1
      name: Test playbook finished successfully
      type: title
      iscommand: false
      brand: ""
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2310
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: a4dc2221-8bea-45c6-8173-e9bf56dd0961
    type: playbook
    task:
      id: a4dc2221-8bea-45c6-8173-e9bf56dd0961
      version: -1
      name: O365 - Security And Compliance - Search
      description: |-
        This playbook performs the following steps:
        1. Creates a compliance search.
        2. Starts a compliance search.
        3. Waits for the compliance search to complete.
        4. Gets the results of the compliance search as an output.
        5. Gets the preview results, if specified.
      playbookName: O365 - Security And Compliance - Search
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "2"
    scriptarguments:
      allow_not_found_exchange_locations:
        complex:
          root: inputs.allow_not_found_exchange_locations
      description:
        complex:
          root: inputs.description
      exchange_location:
        complex:
          root: inputs.exchange_location
      force:
        simple: "true"
      kql:
        complex:
          root: inputs.kql
      polling_interval:
        simple: "1"
      polling_timeout:
        simple: "10"
      preview:
        simple: "false"
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 152.5,
          "y": 195
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: 3f949c0e-38e6-4507-80eb-d29cd62e7dfb
    type: playbook
    task:
      id: 3f949c0e-38e6-4507-80eb-d29cd62e7dfb
      version: -1
      name: O365 - Security And Compliance - Search Action - Preview
      description: |-
        This playbook perform:
        1. Creates a new compliance search action - Preview (Base on created compliance search).
        2. Waits for the preview action to complete.
        3. Retrieves the preview results.
      playbookName: O365 - Security And Compliance - Search Action - Preview
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "19"
    scriptarguments:
      polling_interval:
        simple: "1"
      polling_timeout:
        simple: "10"
      search_name:
        complex:
          root: O365.SecurityAndCompliance.ContentSearch.Search
          accessor: Name
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1285
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: d4370a08-0c2b-4f30-8388-ee009d31f1db
    type: regular
    task:
      id: d4370a08-0c2b-4f30-8388-ee009d31f1db
      version: -1
      name: Start search
      description: Starts stopped, completed, or not started compliance search in
        the Security & Compliance Center.
      script: '|||o365-sc-start-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "33"
    scriptarguments:
      search_name:
        complex:
          root: O365.SecurityAndCompliance.ContentSearch.Search
          accessor: Name
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1070
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: f62f7626-0aac-432d-bcf6-52997557e2c5
    type: regular
    task:
      id: f62f7626-0aac-432d-bcf6-52997557e2c5
      version: -1
      name: Sleep 2 Minutes
      description: Sleep for X seconds.
      scriptName: Sleep
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      seconds:
        simple: "120"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 2320,
        "width": 810,
        "x": 50,
        "y": 50
      }
    }
  }
inputs:
- key: search_name
  value:
    simple: Demisto-Test
  required: true
  description: The name of the compliance search.
  playbookInputQuery: null
- key: kql
  value:
    simple: Rodrigo
  required: true
  description: Text search string or a query that's formatted by using the Keyword
    Query Language (KQL).
  playbookInputQuery: null
- key: description
  value:
    simple: Demisto description
  required: true
  description: Description for the compliance search.
  playbookInputQuery: null
- key: allow_not_found_exchange_locations
  value:
    simple: "true"
  required: true
  description: Whether to include mailboxes other than regular user mailboxes in the
    compliance search.
  playbookInputQuery: null
- key: exchange_location
  value:
    simple: avishai@demistodev.onmicrosoft.com,notexists@demistodev.onmicrosoft.com
  required: true
  description: Mailboxes/distribution group to include, or you can use the value "All"
    to include all. (Comma separated)
  playbookInputQuery: null
outputs: []
fromversion: 5.5.0
