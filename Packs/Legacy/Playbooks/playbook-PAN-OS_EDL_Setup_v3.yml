id: PAN-OS EDL Setup v3
version: -1
fromversion: 4.0.0
name: PAN-OS EDL Setup v3
description: "Configures an external dynamic list in PAN-OS.\nIn the event that the\
  \ file exists on the web server, it will sync it to demisto. Then it will create\
  \ an EDL object and a matching rule."
starttaskid: '0'
tasks:
  '0':
    id: '0'
    taskid: 538eec6c-0915-4d2b-8442-08cf79d12a5d
    type: start
    task:
      id: 538eec6c-0915-4d2b-8442-08cf79d12a5d
      version: -1
      name: ''
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '1'
    separatecontext: false
    view: "{\n  \"position\": {\n    \"x\": 255,\n    \"y\": 50\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
  '1':
    id: '1'
    taskid: 783f85f4-5252-42d5-8388-8349db87f26e
    type: condition
    task:
      id: 783f85f4-5252-42d5-8388-8349db87f26e
      version: -1
      name: Is PAN-OS integration enabled?
      description: Checks if there is an active instance of the PAN-OS integration
        enabled.
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - '3'
      yes:
      - '2'
    separatecontext: false
    conditions:
    - label: yes
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Panorama
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                accessor: brand
            iscontext: true
    view: "{\n  \"position\": {\n    \"x\": 255,\n    \"y\": 195\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
  '2':
    id: '2'
    taskid: b5b8bd49-4510-469e-81b7-3a10c71d135e
    type: condition
    task:
      id: b5b8bd49-4510-469e-81b7-3a10c71d135e
      version: -1
      name: Is PAN-OS EDL Management integration enabled?
      description: Checks if there is an active instance of the PAN-OS EDL Management
        integration enabled.
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - '3'
      yes:
      - '7'
    separatecontext: false
    conditions:
    - label: yes
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: palo_alto_networks_pan_os_edl_management
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                accessor: brand
            iscontext: true
    view: "{\n  \"position\": {\n    \"x\": 620,\n    \"y\": 370\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
  '3':
    id: '3'
    taskid: dfbda1e5-63aa-44b2-8edc-1b9c83064f7e
    type: title
    task:
      id: dfbda1e5-63aa-44b2-8edc-1b9c83064f7e
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ''
      description: ''
    separatecontext: false
    view: "{\n  \"position\": {\n    \"x\": 620,\n    \"y\": 2140\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
  '7':
    id: '7'
    taskid: 3a71bc39-b3d6-4456-8c07-871afb06c144
    type: regular
    task:
      id: 3a71bc39-b3d6-4456-8c07-871afb06c144
      version: -1
      name: Retrieve external file
      description: Extracts metadata for the external file from the web server.
      script: '|||pan-os-edl-get-external-file-metadata'
      type: regular
      iscommand: true
      brand: ''
    nexttasks:
      '#none#':
      - '18'
    scriptarguments:
      file_path:
        complex:
          root: inputs.list-name
          transformers:
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: .txt
    continueonerror: true
    separatecontext: false
    view: "{\n  \"position\": {\n    \"x\": 1342.5,\n    \"y\": 540\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
  '16':
    id: '16'
    taskid: ba75278c-1ad0-4217-820e-36ef2e217870
    type: regular
    task:
      id: ba75278c-1ad0-4217-820e-36ef2e217870
      version: -1
      name: Add changes from external file to the internal list
      description: Fetches the content of the external file and merges it with the
        content of the internal list.
      script: '|||pan-os-edl-update-from-external-file'
      type: regular
      iscommand: true
      brand: ''
    nexttasks:
      '#none#':
      - '45'
    scriptarguments:
      file_path:
        simple: ${inputs.list-name}.txt
      list_name:
        simple: ${inputs.list-name}
      type:
        simple: merge
      verbose: {}
    separatecontext: false
    view: "{\n  \"position\": {\n    \"x\": 1710,\n    \"y\": 890\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
  '17':
    id: '17'
    taskid: 75b1d26a-62af-4c06-8a9a-9454d290f3e0
    type: regular
    task:
      id: 75b1d26a-62af-4c06-8a9a-9454d290f3e0
      version: -1
      name: Create internal list and external file
      description: Creates an internal list in Demisto and creates an external file
        on the web server.
      script: '|||pan-os-edl-update'
      type: regular
      iscommand: true
      brand: ''
    nexttasks:
      '#none#':
      - '19'
    scriptarguments:
      add_or_remove:
        simple: add
      file_path:
        simple: ${inputs.list-name}.txt
      list_items:
        simple: ${inputs.list-items}
      list_name:
        simple: ${inputs.list-name}
      verbose: {}
    separatecontext: false
    view: "{\n  \"position\": {\n    \"x\": 1060,\n    \"y\": 890\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
  '18':
    id: '18'
    taskid: 77a6dbb6-7500-4059-8120-7c1de8317b79
    type: condition
    task:
      id: 77a6dbb6-7500-4059-8120-7c1de8317b79
      version: -1
      name: Is there an external file?
      description: Checks if an external file exists on the web server.
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - '17'
      yes:
      - '16'
    separatecontext: false
    conditions:
    - label: yes
      condition:
      - - operator: containsGeneral
          left:
            value:
              simple: PANOSEDL.FileName
            iscontext: true
          right:
            value:
              complex:
                root: inputs.list-name
                transformers:
                - operator: concat
                  args:
                    prefix: {}
                    suffix:
                      value:
                        simple: .txt
            iscontext: true
    view: "{\n  \"position\": {\n    \"x\": 1342.5,\n    \"y\": 720\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
  '19':
    id: '19'
    taskid: 50bfb844-ba26-45b6-8f7e-a641d4b9af17
    type: regular
    task:
      id: 50bfb844-ba26-45b6-8f7e-a641d4b9af17
      version: -1
      name: Create EDL Object
      description: Creates an external dynamic list in PAN-OS and connects it to the
        external file.
      script: '|||panorama-create-edl'
      type: regular
      iscommand: true
      brand: ''
    nexttasks:
      '#none#':
      - '42'
    scriptarguments:
      certificate_profile: {}
      description: {}
      device-group:
        complex:
          root: inputs.device-group
      name:
        simple: ${inputs.list-name}-${inputs.ioc-type}-edl-object
      recurring:
        simple: five-minute
      type:
        simple: ${inputs.ioc-type}
      url:
        simple: ${inputs.web-server-url}${inputs.list-name}.txt
    separatecontext: false
    view: "{\n  \"position\": {\n    \"x\": 1060,\n    \"y\": 1080\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
  '23':
    id: '23'
    taskid: 9cda68f7-a99b-4b69-8ed5-f9856cce4cf7
    type: condition
    task:
      id: 9cda68f7-a99b-4b69-8ed5-f9856cce4cf7
      version: -1
      name: Is auto-commit defined?
      description: Checks if the values provided in the arguments are equal. If either
        of the arguments are missing, "no" is returned.
      scriptName: AreValuesEqual
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      no:
      - '27'
      yes:
      - '48'
    scriptarguments:
      left:
        simple: ${inputs.auto-commit}
      right:
        simple: Yes
    results:
    - AreValuesEqual
    separatecontext: false
    view: "{\n  \"position\": {\n    \"x\": 1060,\n    \"y\": 1800\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
  '27':
    id: '27'
    taskid: 65e4490d-dbba-4339-8526-2728f147d4ea
    type: regular
    task:
      id: 65e4490d-dbba-4339-8526-2728f147d4ea
      version: -1
      name: Manually commit
      description: Allows the analyst to manually commit the changes. This option
        is available when auto-commit is "false".
      type: regular
      iscommand: false
      brand: ''
    nexttasks:
      '#none#':
      - '3'
    separatecontext: false
    view: "{\n  \"position\": {\n    \"x\": 1300,\n    \"y\": 1970\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
  '35':
    id: '35'
    taskid: 60f39c33-7ef1-4ba1-8b9e-56ae84a4d02e
    type: regular
    task:
      id: 60f39c33-7ef1-4ba1-8b9e-56ae84a4d02e
      version: -1
      name: add the list items to the EDL
      description: Creates an internal list in Demisto and creates an external file
        on the web server.
      script: '|||pan-os-edl-update'
      type: regular
      iscommand: true
      brand: ''
    nexttasks:
      '#none#':
      - '3'
    scriptarguments:
      add_or_remove:
        simple: add
      file_path:
        simple: ${inputs.list-name}.txt
      list_items:
        simple: ${inputs.list-items}
      list_name:
        simple: ${inputs.list-name}
      verbose: {}
    separatecontext: false
    view: "{\n  \"position\": {\n    \"x\": 1710,\n    \"y\": 1970\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
  '41':
    id: '41'
    taskid: 86e13503-3436-4015-8507-558af6c8865b
    type: playbook
    task:
      id: 86e13503-3436-4015-8507-558af6c8865b
      version: -1
      name: PAN-OS - Create Or Edit EDL Rule
      playbookName: PAN-OS - Create Or Edit EDL Rule
      type: playbook
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '23'
    scriptarguments:
      action-type:
        complex:
          root: inputs.action-type
      device-group:
        complex:
          root: inputs.device-group
      element-to-add:
        simple: ${Panorama.EDL.Name}
      inbound-or-outbound-rule:
        complex:
          root: inputs.inbound-or-outbound-rule
      log-forwarding-object-name:
        complex:
          root: inputs.log-forwarding-object-name
      pre-post-rulebase:
        complex:
          root: inputs.pre-post-rulebase
      relative-rule-name:
        complex:
          root: inputs.relative-rule-name
      rule-position:
        complex:
          root: inputs.rule-position
      rule_name:
        complex:
          root: inputs.rule-name
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ''
      wait: 1
    view: "{\n  \"position\": {\n    \"x\": 1060,\n    \"y\": 1620\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
  '42':
    id: '42'
    taskid: b8e17e10-5c2a-489c-8b4d-7b0d4cbc0d37
    type: condition
    task:
      id: b8e17e10-5c2a-489c-8b4d-7b0d4cbc0d37
      version: -1
      name: Is auto-commit defined?
      description: Checks if the values provided in the arguments are equal. If either
        of the arguments are missing, "no" is returned.
      scriptName: AreValuesEqual
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      no:
      - '44'
      yes:
      - '49'
    scriptarguments:
      left:
        simple: ${inputs.auto-commit}
      right:
        simple: Yes
    results:
    - AreValuesEqual
    separatecontext: false
    view: "{\n  \"position\": {\n    \"x\": 1060,\n    \"y\": 1280\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
  '44':
    id: '44'
    taskid: 62672b29-2a6f-4b59-8e8c-272ddd2fde17
    type: regular
    task:
      id: 62672b29-2a6f-4b59-8e8c-272ddd2fde17
      version: -1
      name: Manually commit
      description: Allows the analyst to manually commit the changes. This option
        is available when auto-commit is "false".
      type: regular
      iscommand: false
      brand: ''
    nexttasks:
      '#none#':
      - '41'
    separatecontext: false
    view: "{\n  \"position\": {\n    \"x\": 1300,\n    \"y\": 1450\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
  '45':
    id: '45'
    taskid: b62ff95b-5121-45d6-840d-8c58585081e7
    type: regular
    task:
      id: b62ff95b-5121-45d6-840d-8c58585081e7
      version: -1
      name: Fetch Instance Info
      description: Run any command supported in the API.
      script: '|||panorama'
      type: regular
      iscommand: true
      brand: ''
    nexttasks:
      '#none#':
      - '46'
    scriptarguments:
      action: {}
      category: {}
      cmd:
        simple: <show><system><info></info></system></show>
      command: {}
      dst: {}
      element: {}
      extend-context:
        simple: panorama.model=response.result.system.model
      from: {}
      job-id: {}
      key: {}
      log-type: {}
      pcap-id: {}
      period: {}
      query: {}
      reportname: {}
      reporttype: {}
      search-time: {}
      serialno: {}
      target: {}
      to: {}
      type:
        simple: op
      where: {}
      xpath: {}
    separatecontext: false
    view: "{\n  \"position\": {\n    \"x\": 1710,\n    \"y\": 1090\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
  '46':
    id: '46'
    taskid: 9073d63e-589d-401f-80c9-2d7a61e3b8e9
    type: condition
    task:
      id: 9073d63e-589d-401f-80c9-2d7a61e3b8e9
      version: -1
      name: Is Instance type Panorama?
      type: condition
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#default#':
      - '47'
      yes:
      - '35'
    separatecontext: false
    conditions:
    - label: yes
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: panorama.model
            iscontext: true
          right:
            value:
              simple: Panorama
    view: "{\n  \"position\": {\n    \"x\": 1710,\n    \"y\": 1260\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
  '47':
    id: '47'
    taskid: 459fdac3-5805-4a0b-89b2-f2fe0f6948e4
    type: regular
    task:
      id: 459fdac3-5805-4a0b-89b2-f2fe0f6948e4
      version: -1
      name: Get EDL Object
      description: Returns information for an external dynamic list
      script: '|||panorama-get-edl'
      type: regular
      iscommand: true
      brand: ''
    nexttasks:
      '#none#':
      - '35'
    scriptarguments:
      device-group: {}
      name:
        simple: ${inputs.list-name}-${inputs.ioc-type}-edl-object
    separatecontext: false
    view: "{\n  \"position\": {\n    \"x\": 2020,\n    \"y\": 1450\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
  '48':
    id: '48'
    taskid: d998e731-6c97-4132-8b61-531f6b38c09f
    type: playbook
    task:
      id: d998e731-6c97-4132-8b61-531f6b38c09f
      version: -1
      name: PAN-OS Commit Configuration
      playbookName: PAN-OS Commit Configuration
      type: playbook
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '3'
    separatecontext: true
    view: "{\n  \"position\": {\n    \"x\": 880,\n    \"y\": 1970\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
  '49':
    id: '49'
    taskid: 13cc0c6a-4529-4a82-8235-66c8f6e47b69
    type: playbook
    task:
      id: 13cc0c6a-4529-4a82-8235-66c8f6e47b69
      version: -1
      name: PAN-OS Commit Configuration
      playbookName: PAN-OS Commit Configuration
      type: playbook
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '41'
    separatecontext: true
    view: "{\n  \"position\": {\n    \"x\": 830,\n    \"y\": 1450\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
view: "{\n  \"linkLabelsPosition\": {\n    \"18_16_yes\": 0.44,\n    \"18_17_#default#\"\
  : 0.39,\n    \"1_3_#default#\": 0.1,\n    \"2_3_#default#\": 0.1,\n    \"2_7_yes\"\
  : 0.59\n  },\n  \"paper\": {\n    \"dimensions\": {\n      \"height\": 2155,\n \
  \     \"width\": 2145,\n      \"x\": 255,\n      \"y\": 50\n    }\n  }\n}"
inputs:
- key: list-name
  value: {}
  required: true
  description: "The name of the list that will store the IOCs.\nThe name of the file\
    \ on the web server. This file name is the same as the name of the list with the\
    \ extension \".txt\" added."
- key: ioc-type
  value: {}
  required: true
  description: The type of the IOCs that the list will store. Can be "ip", "url",
    or "domain".
- key: list-items
  value: {}
  required: true
  description: comma separated values
- key: action-type
  value:
    simple: drop
  required: true
  description: "The action that will be defined in the rule:\nallow/deny/drop"
- key: auto-commit
  value:
    simple: No
  required: false
  description: Whether to commit the configuration automatically.
- key: log-forwarding-object-name
  value: {}
  required: false
  description: The server address to which to forward logs.
- key: web-server-url
  value: {}
  required: true
  description: The full URL path of the web server on which the files are stored.
- key: pre-post-rulebase
  value:
    simple: pre-rulebase
  required: true
  description: Either pre-rulebase or post-rulebase,  according to the rule structure.
- key: rule-position
  value:
    simple: bottom
  required: false
  description: "The position of the rule in the ruleset. Valid values are:\n  * top\n\
    \  * bottom\n  * before\n  * after\n\nThe default position is 'top'"
- key: relative-rule-name
  value: {}
  required: false
  description: If the rule-position that is chosen is before or after, specify the
    rule name to which it is related.
- key: inbound-or-outbound-rule
  value:
    simple: outbound
  required: false
  description: Determines if the rule is inbound or outbound.
- key: rule-name
  value: {}
  required: false
  description: The name of the rule to update, or the name of the rule that will be
    created.
- key: device-group
  value: {}
  required: false
  description: The device group to work on. Exists only in panorama!
outputs:
- contextPath: Panorama.EDL.Name
  description: Name of theEDL.
- contextPath: Panorama.Commit.Warnings
  description: Commit Warnings
  type: unknown
- contextPath: Panorama.Push.Warnings
  description: Push  warnings
sourceplaybookid: PAN-OS EDL Setup v2
tests:
- PAN-OS EDL Setup v3 Test
