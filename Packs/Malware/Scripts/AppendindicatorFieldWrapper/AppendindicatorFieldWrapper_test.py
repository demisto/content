import demistomock as demisto
import pytest


def test_run_append_indicator_field_script():
    """
    Given:
        Demisto args object containing:
            - A comma-separated list of Indicators values.
            - A comma-separated list of tags to append to the given indicators.
    When:
        Running the 'run_append_indicator_field_script' function.
    Then:
        Verify that the readable output is as expected.

    """
    from AppendindicatorFieldWrapper import run_append_indicator_field_script

    indicators_values = 'test_indicator1,test_indicator2'
    tags = 'test_tag1,test_tag2'
    args = {'indicators_values': indicators_values, 'tags': tags}
    response = run_append_indicator_field_script(args)

    assert response.readable_output == '### The following tags were added successfully:\n|Indicator|Tags|\n' \
                                       '|---|---|\n| test_indicator1 | test_tag1,<br>test_tag2 |\n| test_indicator2 |' \
                                       ' test_tag1,<br>test_tag2 |\n'


@pytest.mark.parametrize('args, expected_err_message', [
    ({'indicators_values': '', 'tags': 'test_tag1,test_tag2'}, 'Indicators values were not specified.'),
    ({'indicators_values': 'test_indicator1,test_indicator2', 'tags': ''}, 'Tags were not specified.')
])
def test_missing_arguments(mocker, args, expected_err_message):
    """
        Given:
            1. Demisto args object containing an empty string as the Indicator values argument, and a
               comma-separated list of tags to append to the indicators.
               An error message about missing indicators.

            2. Demisto args object containing an empty string as the Tags argument, and a
               comma-separated list of indicators values.
               An error message about missing tags.
        When:
            Running the 'run_append_indicator_field_script' function.

        Then:
            Verify that the expected error message is returned as the readable output.
        """
    from AppendindicatorFieldWrapper import run_append_indicator_field_script
    mocker.patch.object(demisto, 'error', return_value=None)
    response = run_append_indicator_field_script(args)

    assert response.readable_output == f'Failed to execute AppendindicatorFieldWrapper. Error: {expected_err_message}'
