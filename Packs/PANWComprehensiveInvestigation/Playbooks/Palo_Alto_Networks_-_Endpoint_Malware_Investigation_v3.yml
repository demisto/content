id: Palo Alto Networks - Endpoint Malware Investigation v3
version: -1
name: Palo Alto Networks - Endpoint Malware Investigation v3
description: "Deprecated. Use Malware Investigation and Response pack instead. For more information, refer to https://xsoar.pan.dev/docs/reference/packs/malware-investigation-and-response.This playbook is triggered by a Palo Alto Networks Cortex threat alert, generated by Traps.  The playbook performs host enrichment for the source host with Palo Alto Networks Traps, enriches information for the suspicious file with Palo Alto Networks Minemeld and AutoFocus, and automatically performs file detonation for the extracted file. It then performs IOC enrichment with Minemeld for all related IOCs, and calculates the incident severity based on all the findings. In addition we detonate the file for the full analysis report. \nThe analyst can perform a manual memory dump for the suspected endpoint based on the incidentâ€™s severity, and choose to isolate the source endpoint with Traps.\nHunting tasks to find more endpoints that are infected is performed automatically based on a playbook input, and after all infected endpoints are found, remediation for all malicious IOCs is performed, including file quarantine, and IP and URLs blocking with Palo Alto Networks FireWall components such as Dynamic Address Groups and Custom URL Categories.\nAfter the investigation review the incident is automatically closed."
deprecated: true
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 7e7348f3-8938-44d7-8852-32ea5049e761
    type: start
    task:
      id: 7e7348f3-8938-44d7-8852-32ea5049e761
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "114"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": -120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: de384587-c7b4-4206-8387-51c7518971e2
    type: title
    task:
      id: de384587-c7b4-4206-8387-51c7518971e2
      version: -1
      name: File Detonation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "98"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 760,
          "y": 1020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: 7715d69b-1366-4bdf-8509-5344a5bf8a03
    type: title
    task:
      id: 7715d69b-1366-4bdf-8509-5344a5bf8a03
      version: -1
      name: File Enrichment
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "77"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 230,
          "y": 1020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: 3d39667e-e2ae-4372-84b8-b70aca7b8f41
    type: title
    task:
      id: 3d39667e-e2ae-4372-84b8-b70aca7b8f41
      version: -1
      name: False Positive
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "45"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -330,
          "y": 2015
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: 6a41b9b1-69f6-4e1c-87ec-f1bf57987246
    type: title
    task:
      id: 6a41b9b1-69f6-4e1c-87ec-f1bf57987246
      version: -1
      name: Hunting for malicious indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "137"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2080
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: 294a5943-470f-46b0-82b7-353bb0bb7715
    type: condition
    task:
      id: 294a5943-470f-46b0-82b7-353bb0bb7715
      version: -1
      name: Would you like to perform auto-remediation?
      description: Manual review from the analyst.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "130"
      "yes":
      - "129"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 3080
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: 499e02e7-b80e-43db-8322-0ab08af88568
    type: regular
    task:
      id: 499e02e7-b80e-43db-8322-0ab08af88568
      version: -1
      name: AutoFocus - Retrieve Sample Analysis
      description: Returns properties, behaviors, and activities observed for a sample. Run the command once to get the fields and operating systems under HTTP, Coverage, Behavior, Registry, Files, Processes, Connections, and DNS.
      script: '|||autofocus-sample-analysis'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "121"
    scriptarguments:
      filter_data:
        simple: "False"
      sample_id:
        complex:
          root: inputs.SHA256
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 20,
          "y": 1350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "45":
    id: "45"
    taskid: f566f0fa-83b3-45d9-8eb7-45d78b998878
    type: title
    task:
      id: f566f0fa-83b3-45d9-8eb7-45d78b998878
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 4180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "48":
    id: "48"
    taskid: 1a5d1b4e-5b35-4969-8cea-d8d8daf2b50e
    type: condition
    task:
      id: 1a5d1b4e-5b35-4969-8cea-d8d8daf2b50e
      version: -1
      name: Continue with the investigation or Close as False Positive?
      description: Manual task for the analyst - continue with the investigation or close as a false positive.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      Close as False positive:
      - "10"
      continue:
      - "66"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1700
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "61":
    id: "61"
    taskid: a0242e49-001e-4fe1-8fff-53682ae8f41c
    type: playbook
    task:
      id: a0242e49-001e-4fe1-8fff-53682ae8f41c
      version: -1
      name: WildFire - Detonate file
      description: |-
        Detonate one or more files using the Wildfire integration. This playbook
        returns relevant reports to the War Room and file reputations to the context data.
        The detonation supports the following file types -
        APK, JAR, DOC, DOCX, RTF, XLS, XLSX, PPT, PPTX, OOXML, PE32, PDF, DMG, PKG, RAR, 7Z
      playbookName: WildFire - Detonate file
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "121"
    scriptarguments:
      File:
        complex:
          root: File
      Interval:
        simple: "1"
      Timeout:
        simple: "15"
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 760,
          "y": 1350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "66":
    id: "66"
    taskid: a8ebdc64-7543-4fb1-8bd0-6f8434e7ab49
    type: regular
    task:
      id: a8ebdc64-7543-4fb1-8bd0-6f8434e7ab49
      version: -1
      name: Perform manual Malware Analysis and Forensics
      description: Manual task for the analyst - Perform manual Malware Analysis and Forensics.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "12"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1905
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "77":
    id: "77"
    taskid: 159c7968-aeef-4692-8dac-6c44f83390d2
    type: condition
    task:
      id: 159c7968-aeef-4692-8dac-6c44f83390d2
      version: -1
      name: Is AutoFocus Integration enabled?
      description: Check if AutoFocus integration is enabled.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "121"
      "yes":
      - "34"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Autofocus
                  - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: AutoFocus V2
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                accessor: brand
            iscontext: true
    view: |-
      {
        "position": {
          "x": 230,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "91":
    id: "91"
    taskid: 93e5d156-d4ca-456b-8580-0b89cf69ec86
    type: regular
    task:
      id: 93e5d156-d4ca-456b-8580-0b89cf69ec86
      version: -1
      name: Cortex XDR - get endpoints
      description: Gets a list of endpoints, according to the passed filters. Filtering by multiple fields is concatenated using AND condition (OR is not supported). Maximum result set size is 100. Offset is the zero-based number of endpoint from the start of the result set (start by counting from 0).
      script: Cortex XDR - IR|||xdr-get-endpoints
      type: regular
      iscommand: true
      brand: Cortex XDR - IR
    nexttasks:
      '#none#':
      - "121"
    scriptarguments:
      endpoint_id_list:
        complex:
          root: inputs.endpoint_id_list
      hostname:
        complex:
          root: Endpoint
          accessor: Hostname
      ip_list:
        complex:
          root: IP
          accessor: Address
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -610,
          "y": 1350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "98":
    id: "98"
    taskid: 43a60709-a625-41b9-82ba-01f877032ee1
    type: regular
    task:
      id: 43a60709-a625-41b9-82ba-01f877032ee1
      version: -1
      name: Manual - Retrieve malicious file
      description: Manual - Retrieve malicious file from the infected endpoint.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "61"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 760,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "99":
    id: "99"
    taskid: 5b391553-cad8-4f5f-8126-83a7fa8956b3
    type: title
    task:
      id: 5b391553-cad8-4f5f-8126-83a7fa8956b3
      version: -1
      name: Enrich Internal Indicators found
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "100"
      - "135"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2430
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "100":
    id: "100"
    taskid: 529f8c4d-5d71-46fe-89ee-0570f1571a40
    type: condition
    task:
      id: 529f8c4d-5d71-46fe-89ee-0570f1571a40
      version: -1
      name: Are there users to enrich?
      description: Check if there are more IOCs to enrich?
      type: condition
      iscommand: false
      brand: Palo Alto Minemeld
    nexttasks:
      '#default#':
      - "20"
      "yes":
      - "110"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: PANWHunting
                accessor: DetectedUsers
            iscontext: true
    view: |-
      {
        "position": {
          "x": 910,
          "y": 2570
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "101":
    id: "101"
    taskid: 7eeaf3bf-8ff0-41b0-87b9-650f6b3eb9e2
    type: condition
    task:
      id: 7eeaf3bf-8ff0-41b0-87b9-650f6b3eb9e2
      version: -1
      name: Are there internal IP addresses to enrich?
      description: Check if there are more IOCs to enrich?
      type: condition
      iscommand: false
      brand: Palo Alto Minemeld
    nexttasks:
      '#default#':
      - "20"
      "yes":
      - "104"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: PANWHunting
                accessor: DetectedInternalIPs
            iscontext: true
    view: |-
      {
        "position": {
          "x": -140,
          "y": 2740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "104":
    id: "104"
    taskid: c357e9bd-4307-4bb9-8c89-6815a4eed5e1
    type: regular
    task:
      id: c357e9bd-4307-4bb9-8c89-6815a4eed5e1
      version: -1
      name: Cortex XDR - get endpoints
      description: Gets a list of endpoints, according to the passed filters. Filtering by multiple fields is concatenated using the AND condition (OR is not supported). Maximum result set size is 100. Offset is the zero-based number of endpoint from the start of the result set (start by counting from 0).
      script: Cortex XDR - IR|||xdr-get-endpoints
      type: regular
      iscommand: true
      brand: Cortex XDR - IR
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      ip_list:
        complex:
          root: PANWHunting
          accessor: DetectedExternalIPs
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -130,
          "y": 2910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "106":
    id: "106"
    taskid: b6f9d8a3-0e4e-465d-8530-a475d8f8c40a
    type: regular
    task:
      id: b6f9d8a3-0e4e-465d-8530-a475d8f8c40a
      version: -1
      name: Active Directory - get users
      description: Retrieves detailed information about a user account. The user can be specified by name, email address, or as an Active Directory Distinguished Name (DN). If no filter is specified, all users are returned.
      script: '|||ad-get-user'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      username:
        complex:
          root: PANWHunting
          accessor: DetectedUsers
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1310,
          "y": 2910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "110":
    id: "110"
    taskid: 5ad747ad-8337-4b41-8e81-0260b99c83af
    type: condition
    task:
      id: 5ad747ad-8337-4b41-8e81-0260b99c83af
      version: -1
      name: Is Active Directory integration enabled?
      description: Check if the Active Directory integration is enabled.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "20"
      "yes":
      - "106"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Active Directory Query v2
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                accessor: brand
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1110,
          "y": 2740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "114":
    id: "114"
    taskid: 608f7fc8-7a26-4b9c-8718-f468f8d77e93
    type: title
    task:
      id: 608f7fc8-7a26-4b9c-8718-f468f8d77e93
      version: -1
      name: Get similar incidents
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "115"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 30
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "115":
    id: "115"
    taskid: 39b3eb68-e1b9-44ea-818b-b6d767870047
    type: regular
    task:
      id: 39b3eb68-e1b9-44ea-818b-b6d767870047
      version: -1
      name: Find similar incidents
      description: |-
        Finds similar incidents by common incident keys, labels, custom fields or context keys.
        It's highly recommended to use incident keys if possible (e.g., "type" for the same incident type).
        For best performance, it's recommended to avoid using context keys whenever possible (for example, if the value also appears in a label key, use label).
      scriptName: FindSimilarIncidents
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "120"
    scriptarguments:
      similarIncidentFields:
        complex:
          root: inputs.similarIncidentFields
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "116":
    id: "116"
    taskid: 835033fe-67fa-4038-8a65-3a44367d75cb
    type: title
    task:
      id: 835033fe-67fa-4038-8a65-3a44367d75cb
      version: -1
      name: Enrichment
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "126"
      - "5"
      - "6"
      - "128"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 880
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "118":
    id: "118"
    taskid: eda17ed0-e004-4fb9-8c3e-32fd9a50ffd4
    type: condition
    task:
      id: eda17ed0-e004-4fb9-8c3e-32fd9a50ffd4
      version: -1
      name: Link similar incidents?
      description: Should the playbook link similar incidents?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "116"
      "yes":
      - "138"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.LinkSimilarIncidents
                transformers:
                - operator: toLowerCase
            iscontext: true
          right:
            value:
              simple: "yes"
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Core REST API
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                accessor: brand
            iscontext: true
    view: |-
      {
        "position": {
          "x": 270,
          "y": 540
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "120":
    id: "120"
    taskid: 4eac6f25-ad32-4f7d-8b14-d2b4d73f1112
    type: condition
    task:
      id: 4eac6f25-ad32-4f7d-8b14-d2b4d73f1112
      version: -1
      name: Similar incidents found?
      description: Were similar incidents found?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "116"
      "yes":
      - "118"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: isSimilarIncidentFound
                transformers:
                - operator: toLowerCase
            iscontext: true
          right:
            value:
              simple: "true"
    view: |-
      {
        "position": {
          "x": 480,
          "y": 370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "121":
    id: "121"
    taskid: 04f3e458-e77d-4f9c-8eb6-4de0b3199020
    type: playbook
    task:
      id: 04f3e458-e77d-4f9c-8eb6-4de0b3199020
      version: -1
      name: Calculate Severity - Generic v2
      playbookName: Calculate Severity - Generic v2
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "48"
    separatecontext: true
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "122":
    id: "122"
    taskid: 8f45b392-7ada-476b-862c-20b0f7fafb23
    type: condition
    task:
      id: 8f45b392-7ada-476b-862c-20b0f7fafb23
      version: -1
      name: Are there hosts to enrich?
      description: Check if there are more IOCs to enrich?
      type: condition
      iscommand: false
      brand: Palo Alto Minemeld
    nexttasks:
      '#default#':
      - "20"
      "yes":
      - "123"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: PANWHunting
                accessor: DetectedInternalHosts
            iscontext: true
    view: |-
      {
        "position": {
          "x": 310,
          "y": 2740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "123":
    id: "123"
    taskid: 38bc512b-9022-4c00-8c6f-dd41bc92b62c
    type: regular
    task:
      id: 38bc512b-9022-4c00-8c6f-dd41bc92b62c
      version: -1
      name: Cortex XDR - get endpoints
      description: Gets a list of endpoints, according to the passed filters. Filtering by multiple fields is concatenated using AND condition (OR is not supported). Maximum result set size is 100. Offset is the zero-based number of endpoint from the start of the result set (start by counting from 0).
      script: Cortex XDR - IR|||xdr-get-endpoints
      type: regular
      iscommand: true
      brand: Cortex XDR - IR
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      hostname:
        complex:
          root: PANWHunting
          accessor: DetectedInternalHosts
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 310,
          "y": 2910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "125":
    id: "125"
    taskid: 9c31c831-afff-4b16-818a-6beac3ed1d4e
    type: regular
    task:
      id: 9c31c831-afff-4b16-818a-6beac3ed1d4e
      version: -1
      name: Active Directory - get users
      description: Retrieves detailed information about a user account. The user can be specified by name, email address, or as an Active Directory Distinguished Name (DN). If no filter is specified, all users are returned.
      script: '|||ad-get-user'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "121"
    scriptarguments:
      username:
        complex:
          root: incident
          accessor: username
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1510,
          "y": 1350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "126":
    id: "126"
    taskid: dfca392a-f3e3-4221-8144-f80fd52a0e5c
    type: title
    task:
      id: dfca392a-f3e3-4221-8144-f80fd52a0e5c
      version: -1
      name: User
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "136"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1320,
          "y": 1020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "127":
    id: "127"
    taskid: 78f4cb47-ab8a-4b52-80af-6efbed8d77d6
    type: condition
    task:
      id: 78f4cb47-ab8a-4b52-80af-6efbed8d77d6
      version: -1
      name: Is Cortex XDR integration enabled?
      description: Check if the Cortex XDR integration is enabled.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "121"
      "yes":
      - "91"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Cortex XDR - IR
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                accessor: brand
            iscontext: true
    view: |-
      {
        "position": {
          "x": -420,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "128":
    id: "128"
    taskid: b55a8023-6bea-495d-8ce9-64270beedfc9
    type: title
    task:
      id: b55a8023-6bea-495d-8ce9-64270beedfc9
      version: -1
      name: Endpoint
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "127"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -420,
          "y": 1020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "129":
    id: "129"
    taskid: b4e79165-862b-4a36-838d-2f06ef9cf653
    type: playbook
    task:
      id: b4e79165-862b-4a36-838d-2f06ef9cf653
      version: -1
      name: Palo Alto Networks - Malware Remediation
      description: This Playbook performs malicious IOC remediation using Palo Alto Networks integrations.
      playbookName: Palo Alto Networks - Malware Remediation
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "131"
    scriptarguments:
      AutoCommit:
        complex:
          root: inputs.AutoCommit
      CustomBlockRule:
        complex:
          root: inputs.CustomBlockRule
      CustomURLCategory:
        complex:
          root: inputs.CustomURLCategory
      DAG:
        complex:
          root: inputs.DAG
      EDLServerIP:
        complex:
          root: inputs.EDLServerIP
      IP:
        complex:
          root: IP
          filters:
          - - operator: isExists
              left:
                value:
                  simple: IP.Malicious
                iscontext: true
          accessor: Address
          transformers:
          - operator: uniq
      IPListName:
        complex:
          root: inputs.IPListName
      Miner:
        complex:
          root: inputs.Miner
      SHA256:
        complex:
          root: File
          filters:
          - - operator: isExists
              left:
                value:
                  simple: File.Malicious
                iscontext: true
          accessor: SHA256
          transformers:
          - operator: uniq
      StaticAddressGroup:
        complex:
          root: inputs.StaticAddressGroup
      Traps:
        complex:
          root: inputs.Traps
      URL:
        complex:
          root: URL
          filters:
          - - operator: isExists
              left:
                value:
                  simple: URL.Malicious
                iscontext: true
          accessor: Data
          transformers:
          - operator: uniq
      URLListName:
        complex:
          root: inputs.URLListName
      UseXDR:
        complex:
          root: inputs.UseXDR
      xdr_endpoint_id:
        complex:
          root: PaloAltoNetworksXDR
          filters:
          - - operator: isExists
              left:
                value:
                  simple: PaloAltoNetworksXDR.Endpoint.endpoint_id
                iscontext: true
          accessor: Endpoint.endpoint_id
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 210,
          "y": 3250
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "130":
    id: "130"
    taskid: d477852b-e556-4944-8c81-68aa8d09a686
    type: regular
    task:
      id: d477852b-e556-4944-8c81-68aa8d09a686
      version: -1
      name: Manual remediation
      description: Perform manual remediation.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "131"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 760,
          "y": 3250
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "131":
    id: "131"
    taskid: 41dfb52e-e47b-41a5-8fe5-d6acaa101edf
    type: regular
    task:
      id: 41dfb52e-e47b-41a5-8fe5-d6acaa101edf
      version: -1
      name: Manual review by the analyst
      description: Manual review by the analyst.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "132"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 3420
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "132":
    id: "132"
    taskid: 77d281c0-665c-47fd-8364-530c3a8ffe1a
    type: regular
    task:
      id: 77d281c0-665c-47fd-8364-530c3a8ffe1a
      version: -1
      name: Generate investigation summary report
      description: |-
        A script to generate the investigation summary report in an automated way.
        Can be used in post-processing flow as well.
      scriptName: GenerateInvestigationSummaryReport
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "133"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 3600
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "133":
    id: "133"
    taskid: 90332ba1-ee91-4862-87ee-983bd5895705
    type: regular
    task:
      id: 90332ba1-ee91-4862-87ee-983bd5895705
      version: -1
      name: Manual - close investigation in the source product
      description: Manual - close investigation in the source product.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "134"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 3790
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "134":
    id: "134"
    taskid: bc108a8e-0c2d-413c-881b-b3655db2f28e
    type: regular
    task:
      id: bc108a8e-0c2d-413c-881b-b3655db2f28e
      version: -1
      name: Close Investigation
      description: Closes the investigation.
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "45"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 3980
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "135":
    id: "135"
    taskid: 5fa8d488-eeca-4213-8956-3a0e59872535
    type: condition
    task:
      id: 5fa8d488-eeca-4213-8956-3a0e59872535
      version: -1
      name: Is Cortex XDR integration enabled?
      description: Check if the Cortex XDR integration is enabled.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "20"
      "yes":
      - "101"
      - "122"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Cortex XDR - IR
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                accessor: brand
            iscontext: true
    view: |-
      {
        "position": {
          "x": 160,
          "y": 2570
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "136":
    id: "136"
    taskid: d5928124-2a11-4286-899b-7f39669afddc
    type: condition
    task:
      id: d5928124-2a11-4286-899b-7f39669afddc
      version: -1
      name: Is Active Directory integration enabled?
      description: Check if the Active Directory integration is enabled.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "121"
      "yes":
      - "125"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Active Directory Query v2
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                accessor: brand
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1320,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "137":
    id: "137"
    taskid: 8ae7b534-5ede-441f-8ea2-53b39b33012a
    type: playbook
    task:
      id: 8ae7b534-5ede-441f-8ea2-53b39b33012a
      version: -1
      name: Palo Alto Networks - Hunting And Threat Detection
      description: "This is a multipurpose playbook used for hunting and threat detection. The playbook receives inputs based on hashes, IP addresses, or domain names provided manually or from outputs by other playbooks. \nWith the received indicators, the playbook leverages data received by PANW products including, Strata Logging Service, Autofocus and Pan-OS to search for IP addresses, host names and users related to the provided indicators.\nThe output provided by the playbook facilitates pivoting searches for possibly affected IP addresses or users."
      playbookName: Palo Alto Networks - Hunting And Threat Detection
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "99"
    scriptarguments:
      IPAddresses:
        complex:
          root: IP
          filters:
          - - operator: isExists
              left:
                value:
                  simple: IP.Malicious
                iscontext: true
          - - operator: IsNotInCidrRanges
              left:
                value:
                  simple: IP.Adderss
                iscontext: true
              right:
                value:
                  simple: inputs.internal_range
                iscontext: true
          accessor: Address
          transformers:
          - operator: uniq
      InternalDomainName:
        complex:
          root: inputs.InternalDomainName
      InternalHostRegex:
        complex:
          root: inputs.InternalHostRegex
      InternalRange:
        complex:
          root: IP
          filters:
          - - operator: IsInCidrRanges
              left:
                value:
                  simple: IP.Address
                iscontext: true
              right:
                value:
                  simple: inputs.internal_range
          accessor: Address
          transformers:
          - operator: uniq
      MD5:
        complex:
          root: File
          filters:
          - - operator: isExists
              left:
                value:
                  simple: File.Malicious
                iscontext: true
          accessor: MD5
          transformers:
          - operator: uniq
      SHA1:
        complex:
          root: File
          filters:
          - - operator: isExists
              left:
                value:
                  simple: File.Malicious
                iscontext: true
          accessor: SHA1
          transformers:
          - operator: uniq
      SHA256:
        complex:
          root: File
          filters:
          - - operator: isExists
              left:
                value:
                  simple: File.Malicious
                iscontext: true
          accessor: SHA256
          transformers:
          - operator: uniq
      URLDomain:
        complex:
          root: Domain
          filters:
          - - operator: isExists
              left:
                value:
                  simple: Domain.Name
                iscontext: true
          accessor: Name
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: URL.Data
                iscontext: true
          - operator: uniq
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
  "138":
    id: "138"
    taskid: a93f86c9-52aa-49c7-8894-ea950f9c294e
    type: regular
    task:
      id: a93f86c9-52aa-49c7-8894-ea950f9c294e
      version: -1
      name: Link similar incidents
      description: commands.local.cmd.linkIncidents
      script: Builtin|||linkIncidents
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "116"
    scriptarguments:
      incidentId:
        complex:
          root: incident
          accessor: id
      linkedIncidentIDs:
        complex:
          root: similarIncident
          accessor: rawId
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    continueonerrortype: ""
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "100_20_#default#": 0.16,
      "101_20_#default#": 0.17,
      "110_20_#default#": 0.45,
      "118_116_#default#": 0.43,
      "120_116_#default#": 0.58,
      "120_118_yes": 0.58,
      "122_123_yes": 0.39,
      "127_121_#default#": 0.11,
      "48_10_Close as False positive": 0.59,
      "77_121_#default#": 0.36,
      "77_34_yes": 0.57
    },
    "paper": {
      "dimensions": {
        "height": 4365,
        "width": 2500,
        "x": -610,
        "y": -120
      }
    }
  }
inputs:
- key: similarIncidentFields
  value: {}
  required: false
  description: |-
    This input accepts a comma-separated list of similar incident fields keys.
  playbookInputQuery:
- key: LinkSimilarIncidents
  value: {}
  required: false
  description: This input determines whether similar incidents that are found will be linked. Specify Yes/No.
  playbookInputQuery:
- key: SHA256
  value:
    complex:
      root: incident
      accessor: sha256
  required: false
  description: File SHA256.
  playbookInputQuery:
- key: endpoint_id_list
  value: {}
  required: false
  description: A list of XDR endpoint IDs.
  playbookInputQuery:
- key: UseXDR
  value:
    simple: "Yes"
  required: false
  description: This input determines whether Palo Alto Networks Cortex XDR remediation will take place. Specify Yes/No
  playbookInputQuery:
- key: DAG
  value: {}
  required: false
  description: |-
    This input determines whether Palo Alto Networks Panorama or Firewall Dynamic Address Groups are used.
    Specify Dynamic Address Group tag name for IP handling.
  playbookInputQuery:
- key: CustomURLCategory
  value: {}
  required: false
  description: |-
    This input determines whether Palo Alto Networks Panorama or Firewall Custom URL Categories are used.
    Specify Category name for URL handling.
  playbookInputQuery:
- key: CustomBlockRule
  value: {}
  required: false
  description: |-
    This input determines whether Palo Alto Networks Panorama or Firewall Custom block rules are used.
    Specify True to use Custom Block Rules.
  playbookInputQuery:
- key: IPListName
  value: {}
  required: false
  description: |-
    This input determines whether Palo Alto Networks Panorama or Firewall External Dynamic Lists are used for IP Blockage.
    Specify the EDL name for IP handling.
  playbookInputQuery:
- key: Miner
  value: {}
  required: false
  description: |-
    This input determines whether Palo Alto Networks Minemeld is used. Specify Miner name to update with the malicious indicators.
  playbookInputQuery:
- key: StaticAddressGroup
  value: {}
  required: false
  description: |-
    This input determines whether Palo Alto Networks Panorama or Firewall Static address groups are used.
    Specify Static address group name for IP handling.
  playbookInputQuery:
- key: AutoCommit
  value:
    simple: "No"
  required: false
  description: |-
    This input determines whether to commit the configuration automatically.
    Yes - Commit automatically.
    No - Commit manually.
  playbookInputQuery:
- key: URLListName
  value: {}
  required: false
  description: |-
    This input determines whether Palo Alto Networks Panorama or Firewall External Dynamic Lists are used for URL Blockage.
    Specify the EDL name for URL handling.
  playbookInputQuery:
- key: EDLServerIP
  value: {}
  required: false
  description: |-
    This input determines whether Palo Alto Networks Panorama or Firewall External Dynamic Lists are used:
    * The IP address of the web server on which the files are stored.
    * The web server IP address is configured in the integration instance.
  playbookInputQuery:
- key: Traps
  value:
    simple: "No"
  required: false
  description: |-
    This input determines whether Palo Alto Networks Traps remediation will take place. Specify Yes/No.
  playbookInputQuery:
- key: internal_range
  value: {}
  required: false
  description: 'A list of internal IP ranges to check IP addresses against. The list should be provided in CIDR notation, separated by commas. An example of a list of ranges would be: "172.16.0.0/12,10.0.0.0/8,192.168.0.0/16" (without quotes). If a list is not provided, will use default list provided in the IsIPInRanges script (the known IPv4 private address ranges).'
  playbookInputQuery:
- key: InternalDomainName
  value: {}
  required: false
  description: 'The organizations internal domain name. This is provided for the script IsInternalHostName that checks if the detected host names are internal or external if the hosts contain the internal domains suffix. For example demisto.com. If there is more than one domain, use the | character to separate values such as (demisto.com|test.com)'
  playbookInputQuery:
- key: InternalHostRegex
  value: {}
  required: false
  description: This is provided for the script IsInternalHostName that checks if the detected host names are internal or external. If the hosts match the organization's naming convention. For example the host testpc1 will have the following regex \w{6}\d{1}
  playbookInputQuery:
outputs:
- contextPath: IP.Address
  description: IP addresses.
- contextPath: URL.Malicious.Description
  description: For malicious URLs, the reason that the vendor decided that the URL is malicious.
- contextPath: URL.Malicious
  description: Malicious URLs.
  type: unknown
- contextPath: File.Malicious.Description
  description: For malicious files, the reason that the vendor decided that the file is malicious.
tests:
- Palo Alto Networks - Malware Remediation Test
fromversion: 5.0.0
marketplaces:
- xsoar
