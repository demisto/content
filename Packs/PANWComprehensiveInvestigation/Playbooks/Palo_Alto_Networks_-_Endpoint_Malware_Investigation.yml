id: Palo Alto Networks - Endpoint Malware Investigation
version: -1
fromversion: 5.0.0
name: Palo Alto Networks - Endpoint Malware Investigation
description: "This playbook is triggered by a Palo Alto Networks Cortex threat alert,
  generated by Traps.  The playbook performs host enrichment for the source host with
  Palo Alto Networks Traps, enriches information for the suspicious file with Palo
  Alto Networks Minemeld and AutoFocus, and automatically performs file detonation
  for the extracted file. It then performs IOC enrichment with Minemeld for all
  related IOCs, and calculates the incident severity based on all the findings. In
  addition we detonate the file for the full analysis report. \nThe analyst can perform
  a manual memory dump for the suspected endpoint based on the incidentâ€™s severity,
  and choose to isolate the source endpoint with Traps.\nHunting tasks to find more
  endpoints that are infected is performed automatically based on a playbook
  input, and after all infected endpoints are found, remediation for all malicious
  IOCs is performed, including file quarantine, and IP and URLs blocking with
  Palo Alto Networks FireWall components such as Dynamic Address Groups and Custom
  URL Categories.\nAfter the investigation review the incident is automatically closed."
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 7013d486-d71b-4117-8551-801797af55ca
    type: start
    task:
      id: 7013d486-d71b-4117-8551-801797af55ca
      version: -1
      name: ""
      description: ""
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "27"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": -220
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "5":
    id: "5"
    taskid: 4b8b5b93-5cec-4431-8d0d-cb58204bef47
    type: title
    task:
      id: 4b8b5b93-5cec-4431-8d0d-cb58204bef47
      version: -1
      name: Detonation
      description: ""
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "79"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 860,
          "y": 240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "6":
    id: "6"
    taskid: 3dc7c828-d1d0-436f-815e-77185ec9bb13
    type: title
    task:
      id: 3dc7c828-d1d0-436f-815e-77185ec9bb13
      version: -1
      name: File Enrichment
      description: ""
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "77"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 100,
          "y": 240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "9":
    id: "9"
    taskid: fbb76104-1dd1-47b5-810f-a4e891405e37
    type: condition
    task:
      id: fbb76104-1dd1-47b5-810f-a4e891405e37
      version: -1
      name: Are there IP addresses to enrich?
      description: Check if there are more IOCs to enrich?
      type: condition
      iscommand: false
      brand: Palo Alto Minemeld
    nexttasks:
      '#default#':
      - "75"
      "yes":
      - "56"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: IP
                filters:
                - - operator: isExists
                    left:
                      value:
                        simple: IP.Address
                      iscontext: true
                accessor: Address
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1220,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "10":
    id: "10"
    taskid: 2a2324c7-c345-436f-89ad-07b03c4af941
    type: title
    task:
      id: 2a2324c7-c345-436f-89ad-07b03c4af941
      version: -1
      name: False Positive
      description: ""
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "83"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -120,
          "y": 2040
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "12":
    id: "12"
    taskid: 3e110991-baa2-42cf-87a4-8abb4e8fc4d7
    type: title
    task:
      id: 3e110991-baa2-42cf-87a4-8abb4e8fc4d7
      version: -1
      name: Hunting
      description: ""
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "88"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 400,
          "y": 2570
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "15":
    id: "15"
    taskid: 912d95d9-2e84-40ef-826c-48e8c868f99c
    type: title
    task:
      id: 912d95d9-2e84-40ef-826c-48e8c868f99c
      version: -1
      name: Remediation
      description: ""
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "19"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 400,
          "y": 3075
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "19":
    id: "19"
    taskid: 2d655c15-5664-4bbb-88d4-81121aca3c50
    type: condition
    task:
      id: 2d655c15-5664-4bbb-88d4-81121aca3c50
      version: -1
      name: Manual - Get analyst approval for auto-remediation
      description: ""
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "74"
      "Yes":
      - "86"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 400,
          "y": 3230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "20":
    id: "20"
    taskid: 56ecdcdc-b2f8-40b2-83d3-bd01efe4a466
    type: regular
    task:
      id: 56ecdcdc-b2f8-40b2-83d3-bd01efe4a466
      version: -1
      name: Manual review from the analyst
      description: Manual review from the analyst.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "83"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 400,
          "y": 3570
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "21":
    id: "21"
    taskid: d6f9907b-57cb-4019-818e-f6562ffa24d1
    type: regular
    task:
      id: d6f9907b-57cb-4019-818e-f6562ffa24d1
      version: -1
      name: Close Investigation
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "45"
    scriptarguments:
      assetid: {}
      closeNotes: {}
      closeReason: {}
      id: {}
      mndadone: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -120,
          "y": 4085
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "27":
    id: "27"
    taskid: ff288863-5690-432a-86ca-3a86d8350faa
    type: title
    task:
      id: ff288863-5690-432a-86ca-3a86d8350faa
      version: -1
      name: Endpoint Enrichment
      description: ""
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "78"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": -75
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "34":
    id: "34"
    taskid: 6d9f23da-75fb-4bb4-8767-b5d423a1f00e
    type: regular
    task:
      id: 6d9f23da-75fb-4bb4-8767-b5d423a1f00e
      version: -1
      name: AutoFocus - Perform Sample Analysis
      description: Returns properties, behaviors, and activities observed for a sample.
        Run the command a single time to get the fields and operating systems under
        HTTP, Coverage, Behavior, Registry, Files, Processes, Connections, and DNS.
      script: AutoFocus V2|||autofocus-sample-analysis
      type: regular
      iscommand: true
      brand: AutoFocus V2
    nexttasks:
      '#none#':
      - "73"
    scriptarguments:
      filter_data:
        simple: "False"
      os: {}
      sample_id:
        complex:
          root: inputs.SHA256
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -120,
          "y": 540
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "35":
    id: "35"
    taskid: 25fa49ed-07c9-4c65-8916-5717b90f97c6
    type: regular
    task:
      id: 25fa49ed-07c9-4c65-8916-5717b90f97c6
      version: -1
      name: Minemeld - File reputation
      description: Search for file on lists
      script: Palo Alto Minemeld|||file
      type: regular
      iscommand: true
      brand: Palo Alto Minemeld
    nexttasks:
      '#none#':
      - "53"
    scriptarguments:
      detailed: {}
      file:
        complex:
          root: incident
          accessor: filehash
      long: {}
      md5: {}
      sha256: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1030,
          "y": 880
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "45":
    id: "45"
    taskid: 497f868b-82fa-42ab-870f-0af527f51cc1
    type: title
    task:
      id: 497f868b-82fa-42ab-870f-0af527f51cc1
      version: -1
      name: Done
      description: ""
      type: title
      iscommand: false
      brand: ""
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -120,
          "y": 4260
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "47":
    id: "47"
    taskid: aeb51990-d553-41d3-80ed-83af590c9949
    type: condition
    task:
      id: aeb51990-d553-41d3-80ed-83af590c9949
      version: -1
      name: Perform auto-isolation?
      description: This task's condition establishes whether to perform auto-isolation
        based on the AutoIsolation input.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "48"
      "yes":
      - "87"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: greaterThanOrEqual
          left:
            value:
              complex:
                root: incident
                accessor: severity
            iscontext: true
          right:
            value:
              complex:
                root: inputs.AutoIsolation
            iscontext: true
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1695
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "48":
    id: "48"
    taskid: e7ddaea6-3c95-41a7-8d64-06750165004c
    type: condition
    task:
      id: e7ddaea6-3c95-41a7-8d64-06750165004c
      version: -1
      name: Continue with the investigation or Close as False Positive?
      description: Manual task for the analyst - Continue with the investigation or
        Close as False Positive?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      Close as False positive:
      - "10"
      Continue:
      - "60"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 160,
          "y": 1870
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "53":
    id: "53"
    taskid: 73104e89-00ed-4dde-85e2-9608cb339de5
    type: title
    task:
      id: 73104e89-00ed-4dde-85e2-9608cb339de5
      version: -1
      name: IOCs Enrichment
      description: ""
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "9"
      - "84"
      - "85"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1030,
          "y": 1040
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "54":
    id: "54"
    taskid: 4a81f15b-da81-4bec-8a39-794972425408
    type: regular
    task:
      id: 4a81f15b-da81-4bec-8a39-794972425408
      version: -1
      name: Minemeld - Domain Reputation
      description: Search for domain in lists
      script: Palo Alto Minemeld|||domain
      type: regular
      iscommand: true
      brand: Palo Alto Minemeld
    nexttasks:
      '#none#':
      - "75"
    scriptarguments:
      domain:
        complex:
          root: Domain
          accessor: Name
          transformers:
          - operator: uniq
      fullResponse: {}
      long: {}
      retries: {}
      sampleSize: {}
      threshold: {}
      wait: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 790,
          "y": 1350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "56":
    id: "56"
    taskid: 4da30cbd-bfaf-4d77-8917-dbc25c835f71
    type: regular
    task:
      id: 4da30cbd-bfaf-4d77-8917-dbc25c835f71
      version: -1
      name: Minemeld - IP Reputation
      description: Search for ip in miners
      script: Palo Alto Minemeld|||ip
      type: regular
      iscommand: true
      brand: Palo Alto Minemeld
    nexttasks:
      '#none#':
      - "75"
    scriptarguments:
      fullResponse: {}
      ip:
        complex:
          root: IP
          accessor: Address
          transformers:
          - operator: uniq
      long: {}
      retries: {}
      sampleSize: {}
      threshold: {}
      wait: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1220,
          "y": 1350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "57":
    id: "57"
    taskid: c8b848b7-ca94-424a-8282-dd03b8cfd6ec
    type: regular
    task:
      id: c8b848b7-ca94-424a-8282-dd03b8cfd6ec
      version: -1
      name: Minemeld - URL Reputation
      description: Search for url in lists
      script: Palo Alto Minemeld|||url
      type: regular
      iscommand: true
      brand: Palo Alto Minemeld
    nexttasks:
      '#none#':
      - "75"
    scriptarguments:
      long: {}
      retries: {}
      sampleSize: {}
      submitWait: {}
      threshold: {}
      url:
        complex:
          root: URL
          accessor: Data
          transformers:
          - operator: uniq
      wait: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1650,
          "y": 1350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "60":
    id: "60"
    taskid: dd9b1ee1-a7b2-45ea-87d4-5c835751e135
    type: condition
    task:
      id: dd9b1ee1-a7b2-45ea-87d4-5c835751e135
      version: -1
      name: Get analyst approval for local containment
      description: Get the analyst's approval to perform local containment for the
        suspected endpoint.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "66"
      "Yes":
      - "87"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 400,
          "y": 2040
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "61":
    id: "61"
    taskid: cce6b5c0-93e2-4dfd-8d8e-5ed93b71e578
    type: playbook
    task:
      id: cce6b5c0-93e2-4dfd-8d8e-5ed93b71e578
      version: -1
      name: WildFire - Detonate file
      description: ""
      playbookName: WildFire - Detonate file
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "73"
    separatecontext: true
    view: |-
      {
        "position": {
          "x": 860,
          "y": 540
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "66":
    id: "66"
    taskid: 0dca4b4c-8f48-4aa5-8ebf-d95bfac2e247
    type: regular
    task:
      id: 0dca4b4c-8f48-4aa5-8ebf-d95bfac2e247
      version: -1
      name: Perform manual Malware Analysis and Forensics
      description: Manual task for the analyst - Perform manual Malware Analysis and
        Forensics.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "12"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 400,
          "y": 2390
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "73":
    id: "73"
    taskid: 2fc9da30-b2b2-4ac6-89c2-8051f2878452
    type: condition
    task:
      id: 2fc9da30-b2b2-4ac6-89c2-8051f2878452
      version: -1
      name: Is MineMeld Integration enabled?
      description: Check if MineMeld integration is enabled.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "75"
      "yes":
      - "35"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: containsString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Palo Alto Minemeld
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                accessor: brand
            iscontext: true
    view: |-
      {
        "position": {
          "x": 480,
          "y": 710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "74":
    id: "74"
    taskid: 07c679de-b8b7-484c-88dc-fba7921c948a
    type: regular
    task:
      id: 07c679de-b8b7-484c-88dc-fba7921c948a
      version: -1
      name: Analyst manual Remediation
      description: Manual task for the analyst - Perform remediation for the incident.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 130,
          "y": 3400
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "75":
    id: "75"
    taskid: 58bd2a20-c402-4d10-8f52-bdfbda8dfa52
    type: playbook
    task:
      id: 58bd2a20-c402-4d10-8f52-bdfbda8dfa52
      version: -1
      name: Calculate Severity - Standard
      description: ""
      playbookName: Calculate Severity - Standard
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "47"
    separatecontext: true
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "77":
    id: "77"
    taskid: 28fe89a9-d801-4f0c-82e7-89753f7a2efa
    type: condition
    task:
      id: 28fe89a9-d801-4f0c-82e7-89753f7a2efa
      version: -1
      name: Is AutoFocus Integration enabled?
      description: Check if AutoFocus integration is enabled.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "73"
      "yes":
      - "34"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Autofocus
                  - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: AutoFocus V2
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                accessor: brand
            iscontext: true
    view: |-
      {
        "position": {
          "x": 100,
          "y": 370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "78":
    id: "78"
    taskid: f015002d-45f3-47be-8b13-bf2d52646534
    type: regular
    task:
      id: f015002d-45f3-47be-8b13-bf2d52646534
      version: -1
      name: Traps - Endpoint enrichment
      description: Returns details for the specified endpoint.
      script: Traps|||traps-get-endpoint-by-id
      type: regular
      iscommand: true
      brand: Traps
    nexttasks:
      '#none#':
      - "6"
      - "5"
    scriptarguments:
      endpoint_id:
        complex:
          root: inputs.traps_endpoint_id
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 65
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "79":
    id: "79"
    taskid: 61c86041-6cd4-42e7-84fd-e52a4cdf3e9a
    type: playbook
    task:
      id: 61c86041-6cd4-42e7-84fd-e52a4cdf3e9a
      version: -1
      name: Traps Retrieve And Download Files
      description: Use this playbook to retrieve and download files.
      playbookName: Traps Retrieve And Download Files
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "61"
    scriptarguments:
      endpoint_id:
        complex:
          root: incident
          accessor: agentid
      event_id:
        complex:
          root: inputs.traps_event_id
      file_name:
        complex:
          root: inputs.traps_file_name
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
    view: |-
      {
        "position": {
          "x": 860,
          "y": 370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "81":
    id: "81"
    taskid: a6888fad-d909-45e5-8911-bf3c103a0380
    type: regular
    task:
      id: a6888fad-d909-45e5-8911-bf3c103a0380
      version: -1
      name: Traps - Close event
      description: Modifies the status and adds a comment to an existing event.
      script: Traps|||traps-event-update
      type: regular
      iscommand: true
      brand: Traps
    nexttasks:
      '#none#':
      - "21"
    scriptarguments:
      comment:
        simple: Closed after Demisto investigation.
      event_id:
        complex:
          root: incident
          accessor: trapsid
      status:
        simple: closed
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -120,
          "y": 3910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "83":
    id: "83"
    taskid: b5bc0835-df12-4e6b-86fa-70a3507a9411
    type: regular
    task:
      id: b5bc0835-df12-4e6b-86fa-70a3507a9411
      version: -1
      name: Manually unisolate Traps endpoint
      description: Manually unisolate Traps endpoint after finalizing investigation and completing remediation steps.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "81"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -120,
          "y": 3740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "84":
    id: "84"
    taskid: 316b33be-fc49-4080-80c8-39a381475940
    type: condition
    task:
      id: 316b33be-fc49-4080-80c8-39a381475940
      version: -1
      name: Are there URLs to enrich?
      description: Check if there are more IOCs to enrich?
      type: condition
      iscommand: false
      brand: Palo Alto Minemeld
    nexttasks:
      '#default#':
      - "75"
      "yes":
      - "57"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: URL
                filters:
                - - operator: isExists
                    left:
                      value:
                        simple: URL.Data
                      iscontext: true
                accessor: Data
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1650,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "85":
    id: "85"
    taskid: 54e86f05-46bd-485f-8f76-68ef0f775898
    type: condition
    task:
      id: 54e86f05-46bd-485f-8f76-68ef0f775898
      version: -1
      name: Are there Domains to enrich?
      description: Check if there are more IOCs to enrich?
      type: condition
      iscommand: false
      brand: Palo Alto Minemeld
    nexttasks:
      '#default#':
      - "75"
      "yes":
      - "54"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: Domain
                filters:
                - - operator: isExists
                    left:
                      value:
                        simple: Domain.Name
                      iscontext: true
                accessor: Name
            iscontext: true
    view: |-
      {
        "position": {
          "x": 790,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "86":
    id: "86"
    taskid: 2820a9b0-cb64-42a2-8117-7be214c89fdd
    type: playbook
    task:
      id: 2820a9b0-cb64-42a2-8117-7be214c89fdd
      version: -1
      name: Palo Alto Networks - Malware Remediation
      description: This Playbook performs malicious IOC remediation using Palo Alto
        Networks integrations.
      playbookName: Palo Alto Networks - Malware Remediation
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      AutoCommit:
        complex:
          root: inputs.AutoCommit
      CustomBlockRule:
        complex:
          root: inputs.CustomBlockRule
      CustomURLCategory:
        complex:
          root: inputs.CustomURLCategory
      DAG:
        complex:
          root: inputs.DAG
      EDLServerIP:
        complex:
          root: inputs.EDLServerIP
      EndpointId:
        complex:
          root: inputs.traps_endpoint_id
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: trapsid
                iscontext: true
      EventId:
        complex:
          root: incident
          accessor: trapsid
      IP:
        complex:
          root: IP
          filters:
          - - operator: isExists
              left:
                value:
                  simple: IP.Malicious
                iscontext: true
          accessor: Address
          transformers:
          - operator: uniq
      IPListName:
        complex:
          root: inputs.IPListName
      LogForwarding: {}
      Miner:
        complex:
          root: inputs.Miner
      SHA256:
        complex:
          root: File
          filters:
          - - operator: isExists
              left:
                value:
                  simple: File.Malicious
                iscontext: true
          accessor: SHA256
          transformers:
          - operator: uniq
      StaticAddressGroup:
        complex:
          root: inputs.StaticAddressGroup
      Traps:
        complex:
          root: inputs.Traps
      URL:
        complex:
          root: URL
          filters:
          - - operator: isExists
              left:
                value:
                  simple: URL.Malicious
                iscontext: true
          accessor: Data
          transformers:
          - operator: uniq
      URLListName:
        complex:
          root: inputs.URLListName
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
    view: |-
      {
        "position": {
          "x": 680,
          "y": 3400
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "87":
    id: "87"
    taskid: 207ae31b-183d-4ba2-8fd6-5705aca11a40
    type: playbook
    task:
      id: 207ae31b-183d-4ba2-8fd6-5705aca11a40
      version: -1
      name: Isolate Endpoint - Traps
      description: This playbook accepts an endpoint ID from Traps integration and
        performs isolation on this endpoint.
      playbookName: Traps Isolate Endpoint
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "66"
    scriptarguments:
      EndpointId:
        complex:
          root: incident
          accessor: agentid
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
    view: |-
      {
        "position": {
          "x": 840,
          "y": 2215
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "88":
    id: "88"
    taskid: ac3ec2a6-605e-4776-894a-b1ed4c5e08b5
    type: playbook
    task:
      id: ac3ec2a6-605e-4776-894a-b1ed4c5e08b5
      version: -1
      name: PANW - Hunting and threat detection by indicator type
      playbookName: PANW - Hunting and threat detection by indicator type
      description: ""
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "89"
    scriptarguments:
      Domain:
        complex:
          root: Domain
          filters:
          - - operator: isExists
              left:
                value:
                  simple: Domain.Malicious
                iscontext: true
          accessor: Name
          transformers:
          - operator: uniq
      IP addresses:
        complex:
          root: IP
          filters:
          - - operator: isExists
              left:
                value:
                  simple: IP.Malicious
                iscontext: true
          accessor: Address
          transformers:
          - operator: uniq
      MD5:
        complex:
          root: File
          filters:
          - - operator: isExists
              left:
                value:
                  simple: File.Malicious
                iscontext: true
          accessor: MD5
          transformers:
          - operator: uniq
      SHA1:
        complex:
          root: File
          filters:
          - - operator: isExists
              left:
                value:
                  simple: File.Malicious
                iscontext: true
          accessor: SHA1
          transformers:
          - operator: uniq
      SHA256:
        complex:
          root: File
          filters:
          - - operator: isExists
              left:
                value:
                  simple: File.Malicious
                iscontext: true
          accessor: SHA256
          transformers:
          - operator: uniq
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
    view: |-
      {
        "position": {
          "x": 400,
          "y": 2720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "89":
    id: "89"
    taskid: 4f66c241-8aaf-41a5-8d44-44d3a997fa5d
    type: regular
    task:
      id: 4f66c241-8aaf-41a5-8d44-44d3a997fa5d
      version: -1
      name: Enrich external IP addresses - MineMeld
      description: Searches for IP addresses on miners.
      script: Palo Alto Minemeld|||ip
      type: regular
      iscommand: true
      brand: Palo Alto Minemeld
    nexttasks:
      '#none#':
      - "15"
    scriptarguments:
      fullResponse: {}
      ip:
        complex:
          root: detectedips
      long: {}
      retries: {}
      sampleSize: {}
      threshold: {}
      wait: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 400,
          "y": 2900
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
view: |-
  {
    "linkLabelsPosition": {
      "19_74_#default#": 0.67,
      "47_48_#default#": 0.5,
      "47_87_yes": 0.47,
      "60_66_#default#": 0.48,
      "60_87_Yes": 0.54,
      "73_35_yes": 0.54,
      "73_75_#default#": 0.35,
      "77_34_yes": 0.57,
      "77_73_#default#": 0.28,
      "84_75_#default#": 0.17,
      "9_75_#default#": 0.22
    },
    "paper": {
      "dimensions": {
        "height": 4545,
        "width": 2150,
        "x": -120,
        "y": -220
      }
    }
  }
inputs:
- key: AutoIsolation
  value:
    simple: "3"
  required: false
  description: |-
    This input establishes the threshold severity from which to perform auto-isolation for the infected endpoint.
    Default is High.
    Specify the severity number:
    0 - Unknown
    0.5 - Informational
    1 - Low
    2 - Medium
    3 - High
    4 - Critical
- key: traps_endpoint_id
  value:
    complex:
      root: incident
      accessor: agentid
  required: false
  description: Traps Endpoint ID.
- key: traps_file_name
  value:
    complex:
      root: incident
      accessor: filename
  required: false
  description: Traps file name.
- key: traps_event_id
  value:
    complex:
      root: incident
      accessor: trapsid
  required: false
  description: Traps event ID.
- key: SHA256
  value:
    complex:
      root: incident
      accessor: sha256
  required: false
  description: File SHA256.
- key: DAG
  value: {}
  required: false
  description: |-
    This input establishes whether Palo Alto Networks Panorama or Firewall Dynamic Address Groups are used.
    Specify Dynamic Address Group tag name for IP handling.
- key: CustomURLCategory
  value: {}
  required: false
  description: |-
    This input establishes whether Palo Alto Networks Panorama or Firewall Custom URL Categories are used.
    Specify Category name for URL handling.
- key: CustomBlockRule
  value: {}
  required: false
  description: |-
    This input establishes whether Palo Alto Networks Panorama or Firewall Custom block rules are used.
    Specify True to use Custom Block Rules.
- key: IPListName
  value: {}
  required: false
  description: |-
    This input establishes whether Palo Alto Networks Panorama or Firewall External Dynamic Lists, are used for IP Blockage.
    Specify the EDL name for IP handling.
- key: Miner
  value: {}
  required: false
  description: This input establishes whether Palo Alto Networks Minemeld is used.
    Specify Miner name to update with the malicious indicators.
- key: StaticAddressGroup
  value: {}
  required: false
  description: |-
    This input establishes whether Palo Alto Networks Panorama or Firewall Static address groups are used.
    Specify Static address group name for IP handling.
- key: AutoCommit
  value:
    simple: "no"
  required: false
  description: |-
    This input establishes whether to commit the configuration automatically.
    Yes - Commit automatically.
    No - Commit manually.
- key: URLListName
  value: {}
  required: false
  description: |-
    This input establishes whether Palo Alto Networks Panorama or Firewall External Dynamic Lists are used for URL Blockage.
    Specify the EDL name for URL handling.
- key: EDLServerIP
  value: {}
  required: false
  description: |-
    This input establishes whether Palo Alto Networks Panorama or Firewall External Dynamic Lists are used:
    * The IP address of the web server on which the files are stored.
    * The web server IP address is configured in the integration instance.
- key: Traps
  value:
    simple: "yes"
  required: false
  description: This input establishes whether Palo Alto Networks Traps remediation
    will take place. Specify Yes/No.
outputs: []
tests:
  - No Test