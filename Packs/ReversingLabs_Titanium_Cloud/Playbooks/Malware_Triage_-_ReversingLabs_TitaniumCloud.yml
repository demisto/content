id: Malware Triage - ReversingLabs TitaniumCloud
version: -1
name: Malware Triage - ReversingLabs TitaniumCloud
description: Provides the TitaniumCloud classification of a file hash, and takes remediation
  actions based on that classification.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 01bb6b67-07d0-457f-84c9-4ffeabc2c6c4
    type: start
    task:
      id: 01bb6b67-07d0-457f-84c9-4ffeabc2c6c4
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "1"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 440,
          "y": 40
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: 07c255c5-0665-4cfd-8428-72df1211000a
    type: condition
    task:
      id: 07c255c5-0665-4cfd-8428-72df1211000a
      version: -1
      name: Is ReversingLabs TitaniumCloud v2 enabled?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "3"
      "yes":
      - "4"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: ReversingLabs TitaniumCloud v2
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                accessor: brand
            iscontext: true
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 440,
          "y": 310
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: bca91921-a4f3-4b2a-8b90-a519ec676464
    type: title
    task:
      id: bca91921-a4f3-4b2a-8b90-a519ec676464
      version: -1
      name: done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -400,
          "y": 3490
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: 90a93e32-8589-470a-8399-7ce1cf8a0683
    type: condition
    task:
      id: 90a93e32-8589-470a-8399-7ce1cf8a0683
      version: -1
      name: Is there a file hash to analyze?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "3"
      "yes":
      - "5"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: inputs.hash
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 440,
          "y": 660
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: 556cb7ef-3d6c-4319-87aa-3e733cbfc3ca
    type: regular
    task:
      id: 556cb7ef-3d6c-4319-87aa-3e733cbfc3ca
      version: -1
      name: ReversingLabs - Get file reputation
      description: Retrieve File Reputation data from TitaniumCloud.
      script: '|||reversinglabs-titaniumcloud-file-reputation'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "24"
    scriptarguments:
      hash:
        simple: ${inputs.hash}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 440,
          "y": 890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: 203ee9ee-e755-43b2-84b1-cd2256ca066b
    type: condition
    task:
      id: 203ee9ee-e755-43b2-84b1-cd2256ca066b
      version: -1
      name: What is the sample's classification?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      KNOWN:
      - "25"
      MALICIOUS:
      - "29"
      SUSPICIOUS:
      - "28"
      UNKNOWN:
      - "30"
    separatecontext: false
    conditions:
    - label: MALICIOUS
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: DBotScore.Score
            iscontext: true
          right:
            value:
              simple: "3"
    - label: SUSPICIOUS
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: DBotScore.Score
            iscontext: true
          right:
            value:
              simple: "2"
    - label: KNOWN
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: DBotScore.Score
            iscontext: true
          right:
            value:
              simple: "1"
    - label: UNKNOWN
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: DBotScore.Score
            iscontext: true
          right:
            value:
              simple: "0"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 440,
          "y": 1930
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: d87238d4-4447-45d9-8aab-18de009a0b50
    type: regular
    task:
      id: d87238d4-4447-45d9-8aab-18de009a0b50
      version: -1
      name: Label for manual inspection by "Analyst"
      description: This indicator needs to be manually inspected by a SOC engineer.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    separatecontext: false
    sla:
      minutes: 0
      hours: 0
      days: 0
      weeks: 0
    defaultassigneecomplex:
      simple: Analyst
    restrictedcompletion: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 440,
          "y": 2620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: 80429df7-3328-4e13-88f6-bc64844b7198
    type: regular
    task:
      id: 80429df7-3328-4e13-88f6-bc64844b7198
      version: -1
      name: Increase incident severity to CRITICAL
      description: Optionally increases the incident severity to the new value if
        it is greater than the existing severity.
      scriptName: IncreaseIncidentSeverity
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "17"
    scriptarguments:
      severity:
        simple: Critical
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 440,
          "y": 2460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: 14d042c4-75c0-448f-819a-17361979b5c6
    type: playbook
    task:
      id: 14d042c4-75c0-448f-819a-17361979b5c6
      version: -1
      name: Isolate Endpoint
      description: |-
        This playbook isolates a given endpoint via various endpoint product integrations.
        Make sure to provide the valid playbook input for the integration you are using.
      playbookName: Isolate Endpoint - Generic V2
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      Endpoint_ip:
        simple: ${inputs.EndpointIP}
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 960,
          "y": 2460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: 49f3c414-236d-4f25-89be-2378f37694ce
    type: regular
    task:
      id: 49f3c414-236d-4f25-89be-2378f37694ce
      version: -1
      name: ReversingLabs - Upload file to TitaniumCloud
      description: Upload a file using a byte stream with a SHA1 hash of the file
        provided in the request.
      script: '|||reversinglabs-titaniumcloud-file-upload'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "22"
    scriptarguments:
      entryId:
        simple: ${inputs.file}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1210,
          "y": 1370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: 5121fba3-af32-42c8-863f-aa3398aa65f0
    type: regular
    task:
      id: 5121fba3-af32-42c8-863f-aa3398aa65f0
      version: -1
      name: ReversingLabs - Submit file for dynamic analysis
      description: Submit an existing sample for dynamic analysis.
      script: '|||reversinglabs-titaniumcloud-submit-for-dynamic-analysis'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "23"
    scriptarguments:
      platform:
        simple: windows10
      retry-count:
        simple: "20"
      retry-interval:
        simple: "30"
      sha1:
        simple: ${File.SHA1}
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": 1210,
          "y": 1545
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: aeb6a5b0-2666-4b68-86ce-700bc60dab47
    type: regular
    task:
      id: aeb6a5b0-2666-4b68-86ce-700bc60dab47
      version: -1
      name: ReversingLabs - Get dynamic analysis results
      description: Retrieve dynamic analysis results.
      script: '|||reversinglabs-titaniumcloud-get-dynamic-analysis-results'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "6"
    scriptarguments:
      retry-count:
        simple: "40"
      retry-interval:
        simple: "30"
      sha1:
        simple: ${File.SHA1}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1210,
          "y": 1730
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: fd982bbe-7f87-4f06-8562-d0ff2d2d07fb
    type: condition
    task:
      id: fd982bbe-7f87-4f06-8562-d0ff2d2d07fb
      version: -1
      name: Is there a classification for the sample?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "21"
      "yes":
      - "6"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEqualString
          left:
            value:
              simple: DBotScore.Score
            iscontext: true
          right:
            value:
              simple: "0"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 440,
          "y": 1125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: b9470efe-bf5d-47c2-8880-91b801ec1dc7
    type: regular
    task:
      id: b9470efe-bf5d-47c2-8880-91b801ec1dc7
      version: -1
      name: Indicator - Set FalsePositive tag and Benign verdict
      description: Change the properties of an indicator
      script: Builtin|||setIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      tags:
        simple: FalsePositive
      value:
        simple: ${File.SHA1}
      verdict:
        simple: Benign
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -60,
          "y": 2290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: 000fb11c-802d-4128-817e-1c59d888590f
    type: regular
    task:
      id: 000fb11c-802d-4128-817e-1c59d888590f
      version: -1
      name: Set incident severity to LOW
      description: Change the properties of an incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      severity:
        simple: "1"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -60,
          "y": 2460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 44fd457e-aa10-4784-866a-f0990735838c
    type: regular
    task:
      id: 44fd457e-aa10-4784-866a-f0990735838c
      version: -1
      name: Indicator - Set verdict to Suspicious
      description: Change the properties of an indicator
      script: Builtin|||setIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "18"
    scriptarguments:
      value:
        simple: ${File.SHA1}
      verdict:
        simple: Suspicious
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 440,
          "y": 2290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: 8c4810a3-cd46-42c9-8f3f-87dc1177c0e5
    type: regular
    task:
      id: 8c4810a3-cd46-42c9-8f3f-87dc1177c0e5
      version: -1
      name: Indicator - Set verdict to Malicious
      description: Change the properties of an indicator
      script: Builtin|||setIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "19"
    scriptarguments:
      value:
        simple: ${File.SHA1}
      verdict:
        simple: Malicious
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 960,
          "y": 2290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: 3a8706b9-3b8d-4188-81b2-88aeebe07393
    type: regular
    task:
      id: 3a8706b9-3b8d-4188-81b2-88aeebe07393
      version: -1
      name: Label for manual inspection by "Analyst"
      description: This indicator needs to be manually inspected by a SOC engineer.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    separatecontext: false
    sla:
      minutes: 0
      hours: 0
      days: 0
      weeks: 0
    defaultassigneecomplex:
      simple: Analyst
    restrictedcompletion: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1550,
          "y": 2110
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "1_3_#default#": 0.15,
      "24_21_#default#": 0.42,
      "24_6_yes": 0.56,
      "4_3_#default#": 0.11,
      "4_5_yes": 0.53,
      "6_25_KNOWN": 0.4,
      "6_29_MALICIOUS": 0.39,
      "6_30_UNKNOWN": 0.55
    },
    "paper": {
      "dimensions": {
        "height": 3515,
        "width": 2330,
        "x": -400,
        "y": 40
      }
    }
  }
inputs:
- key: hash
  value:
    simple: ${File.SHA1}
  required: false
  description: SHA1 hash of a file.
  playbookInputQuery: null
- key: file
  value:
    simple: ${File.EntryID}
  required: false
  description: The file itself.
  playbookInputQuery: null
- key: EndpointIP
  value:
    simple: ${Endpoint.IPAddress}
  required: false
  description: IP address of the endpoint from which the indicator came.
  playbookInputQuery: null
outputs:
- contextPath: File.MD5
  description: Bad hash found
- contextPath: File.SHA1
  description: Bad hash SHA1
- contextPath: File.SHA256
  description: Bad hash SHA256
- contextPath: DBotScore.Score
  description: The actual score.
- contextPath: DBotScore.Type
  description: The indicator type.
- contextPath: DBotScore.Indicator
  description: The indicator that was tested.
- contextPath: DBotScore.Vendor
  description: The vendor used to calculate the score.
- contextPath: ReversingLabs.file_reputation
  description: Report in JSON.
fromversion: 6.0.0
