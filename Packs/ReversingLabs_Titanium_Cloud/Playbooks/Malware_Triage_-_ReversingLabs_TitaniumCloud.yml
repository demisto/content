id: Malware Triage - ReversingLabs TitaniumCloud
version: -1
name: Malware Triage - ReversingLabs TitaniumCloud
description: Provides the TitaniumCloud classification of a file hash, and takes remediation
  actions based on that classification.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 02062e9f-0a5f-4059-859a-57c0c5d9719d
    type: start
    task:
      id: 02062e9f-0a5f-4059-859a-57c0c5d9719d
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "1"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 440,
          "y": 40
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: 85a1f9a1-6ca0-4803-8df1-4f57efc0de40
    type: condition
    task:
      id: 85a1f9a1-6ca0-4803-8df1-4f57efc0de40
      version: -1
      name: Is ReversingLabs TitaniumCloud v2 enabled?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "3"
      "yes":
      - "4"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: ReversingLabs TitaniumCloud v2
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                accessor: brand
            iscontext: true
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 440,
          "y": 310
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: e20cfbc9-74e5-45a3-8cf6-e1f13bb45809
    type: title
    task:
      id: e20cfbc9-74e5-45a3-8cf6-e1f13bb45809
      version: -1
      name: done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -400,
          "y": 3490
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: f2d96fa4-72d7-43e7-8d36-8adf648f27ea
    type: condition
    task:
      id: f2d96fa4-72d7-43e7-8d36-8adf648f27ea
      version: -1
      name: Is there a file hash to analyze?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "3"
      "yes":
      - "5"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: inputs.hash
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 440,
          "y": 660
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: 7db41591-379a-4e27-8e48-4a8ad0bebfe2
    type: regular
    task:
      id: 7db41591-379a-4e27-8e48-4a8ad0bebfe2
      version: -1
      name: ReversingLabs - Get file reputation
      description: Retrieve File Reputation data from TitaniumCloud.
      script: '|||reversinglabs-titaniumcloud-file-reputation'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "24"
    scriptarguments:
      hash:
        simple: ${inputs.hash}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 440,
          "y": 890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: 7e943e0f-ed92-4387-8309-9584efad3b61
    type: condition
    task:
      id: 7e943e0f-ed92-4387-8309-9584efad3b61
      version: -1
      name: What is the sample's classification?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      KNOWN:
      - "25"
      MALICIOUS:
      - "29"
      SUSPICIOUS:
      - "28"
      UNKNOWN:
      - "30"
    separatecontext: false
    conditions:
    - label: MALICIOUS
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: DBotScore.Score
            iscontext: true
          right:
            value:
              simple: "3"
    - label: SUSPICIOUS
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: DBotScore.Score
            iscontext: true
          right:
            value:
              simple: "2"
    - label: KNOWN
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: DBotScore.Score
            iscontext: true
          right:
            value:
              simple: "1"
    - label: UNKNOWN
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: DBotScore.Score
            iscontext: true
          right:
            value:
              simple: "0"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 440,
          "y": 1930
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: 492798eb-33eb-41bd-8c1a-9b144268eb75
    type: regular
    task:
      id: 492798eb-33eb-41bd-8c1a-9b144268eb75
      version: -1
      name: Label for manual inspection by "Analyst"
      description: This indicator needs to be manually inspected by a SOC engineer.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    separatecontext: false
    sla:
      minutes: 0
      hours: 0
      days: 0
      weeks: 0
    defaultassigneecomplex:
      simple: Analyst
    restrictedcompletion: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 440,
          "y": 2620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: 49d989b1-bd69-49e6-817e-db35be60cf3f
    type: regular
    task:
      id: 49d989b1-bd69-49e6-817e-db35be60cf3f
      version: -1
      name: Increase incident severity to CRITICAL
      description: Optionally increases the incident severity to the new value if
        it is greater than the existing severity.
      scriptName: IncreaseIncidentSeverity
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "17"
    scriptarguments:
      severity:
        simple: Critical
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 440,
          "y": 2460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: 8cb507a1-9b5e-473f-8356-45b3f7946e4c
    type: playbook
    task:
      id: 8cb507a1-9b5e-473f-8356-45b3f7946e4c
      version: -1
      name: Isolate Endpoint
      description: |-
        This playbook isolates a given endpoint via various endpoint product integrations.
        Make sure to provide the valid playbook input for the integration you are using.
      playbookName: Isolate Endpoint - Generic V2
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      Endpoint_ip:
        simple: ${inputs.EndpointIP}
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 960,
          "y": 2460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: ed92a9e5-ce56-43b6-85ae-e5bc5e90f81d
    type: regular
    task:
      id: ed92a9e5-ce56-43b6-85ae-e5bc5e90f81d
      version: -1
      name: ReversingLabs - Upload file to TitaniumCloud
      description: Upload a file using a byte stream with a SHA1 hash of the file
        provided in the request.
      script: '|||reversinglabs-titaniumcloud-file-upload'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "22"
    scriptarguments:
      entryId:
        simple: ${inputs.file}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1210,
          "y": 1370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: 28fa023d-3bb0-400c-89b0-c270c8199c52
    type: regular
    task:
      id: 28fa023d-3bb0-400c-89b0-c270c8199c52
      version: -1
      name: ReversingLabs - Submit file for dynamic analysis
      description: Submit an existing sample for dynamic analysis.
      script: '|||reversinglabs-titaniumcloud-submit-sample-for-dynamic-analysis'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "23"
    scriptarguments:
      platform:
        simple: windows10
      retry-count:
        simple: "20"
      retry-interval:
        simple: "30"
      sha1:
        simple: ${File.SHA1}
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": 1210,
          "y": 1545
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: c707914f-51c0-4676-8f33-14a7ab92f41d
    type: regular
    task:
      id: c707914f-51c0-4676-8f33-14a7ab92f41d
      version: -1
      name: ReversingLabs - Get dynamic analysis results
      description: Retrieve dynamic analysis results for a sample.
      script: '|||reversinglabs-titaniumcloud-get-sample-dynamic-analysis-results'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "6"
    scriptarguments:
      retry-count:
        simple: "40"
      retry-interval:
        simple: "30"
      sha1:
        simple: ${File.SHA1}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1210,
          "y": 1730
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: 499f8647-f601-4032-8eda-312f4540628b
    type: condition
    task:
      id: 499f8647-f601-4032-8eda-312f4540628b
      version: -1
      name: Is there a classification for the sample?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "21"
      "yes":
      - "6"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEqualString
          left:
            value:
              simple: DBotScore.Score
            iscontext: true
          right:
            value:
              simple: "0"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 440,
          "y": 1125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: 76c133ce-7f90-49bb-8413-fcbc8e5e8dae
    type: regular
    task:
      id: 76c133ce-7f90-49bb-8413-fcbc8e5e8dae
      version: -1
      name: Indicator - Set FalsePositive tag and Benign verdict
      description: Change the properties of an indicator
      script: Builtin|||setIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      tags:
        simple: FalsePositive
      value:
        simple: ${File.SHA1}
      verdict:
        simple: Benign
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -60,
          "y": 2290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: 6d657e14-d591-4d66-860a-75d8d180e318
    type: regular
    task:
      id: 6d657e14-d591-4d66-860a-75d8d180e318
      version: -1
      name: Set incident severity to LOW
      description: Change the properties of an incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      severity:
        simple: "1"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -60,
          "y": 2460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 7e0e387a-52bb-4a51-835b-c5c0ddcdaeb1
    type: regular
    task:
      id: 7e0e387a-52bb-4a51-835b-c5c0ddcdaeb1
      version: -1
      name: Indicator - Set verdict to Suspicious
      description: Change the properties of an indicator
      script: Builtin|||setIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "18"
    scriptarguments:
      value:
        simple: ${File.SHA1}
      verdict:
        simple: Suspicious
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 440,
          "y": 2290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: 51dd286b-c5eb-49b1-8292-b0f143228a9e
    type: regular
    task:
      id: 51dd286b-c5eb-49b1-8292-b0f143228a9e
      version: -1
      name: Indicator - Set verdict to Malicious
      description: Change the properties of an indicator
      script: Builtin|||setIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "19"
    scriptarguments:
      value:
        simple: ${File.SHA1}
      verdict:
        simple: Malicious
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 960,
          "y": 2290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: d882a045-2dc7-42f0-87d2-e6c831828a0c
    type: regular
    task:
      id: d882a045-2dc7-42f0-87d2-e6c831828a0c
      version: -1
      name: Label for manual inspection by "Analyst"
      description: This indicator needs to be manually inspected by a SOC engineer.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    separatecontext: false
    sla:
      minutes: 0
      hours: 0
      days: 0
      weeks: 0
    defaultassigneecomplex:
      simple: Analyst
    restrictedcompletion: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1550,
          "y": 2110
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "1_3_#default#": 0.15,
      "24_21_#default#": 0.42,
      "24_6_yes": 0.56,
      "4_3_#default#": 0.11,
      "4_5_yes": 0.53,
      "6_25_KNOWN": 0.4,
      "6_29_MALICIOUS": 0.39,
      "6_30_UNKNOWN": 0.55
    },
    "paper": {
      "dimensions": {
        "height": 3515,
        "width": 2330,
        "x": -400,
        "y": 40
      }
    }
  }
inputs:
- key: hash
  value:
    simple: ${File.SHA1}
  required: false
  description: SHA1 hash of a file.
  playbookInputQuery: null
- key: file
  value:
    simple: ${File.EntryID}
  required: false
  description: The file itself.
  playbookInputQuery: null
- key: EndpointIP
  value:
    simple: ${Endpoint.IPAddress}
  required: false
  description: IP address of the endpoint from which the indicator came.
  playbookInputQuery: null
outputs:
- contextPath: File.MD5
  description: Bad hash found
- contextPath: File.SHA1
  description: Bad hash SHA1
- contextPath: File.SHA256
  description: Bad hash SHA256
- contextPath: DBotScore.Score
  description: The actual score.
- contextPath: DBotScore.Type
  description: The indicator type.
- contextPath: DBotScore.Indicator
  description: The indicator that was tested.
- contextPath: DBotScore.Vendor
  description: The vendor used to calculate the score.
- contextPath: ReversingLabs.file_reputation
  description: Report in JSON.
fromversion: 6.0.0
