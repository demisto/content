commonfields:
  id: Carbon Black Defense
  version: -1
name: Carbon Black Defense
display: VMware Carbon Black Endpoint Standard (Deprecated)
deprecated: true
category: Endpoint
image: data:image/png;base64,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
description: Deprecated. Use Carbon Black Endpoint Standard instead.
detaileddescription: |-
  To get SIEM ID and SIEM Key in order to fetch incidents.
  Login to: https://defense.conferdeploy.net/
  Select the SETTING tab
  Go to API Keys and click on Add API Key
configuration:
- display: Server URL (e.g. https://192.168.0.1)
  name: url
  defaultvalue: ""
  type: 0
  required: true
- display: API Key
  name: key
  defaultvalue: ""
  type: 4
  required: true
- display: API Version
  name: version
  defaultvalue: v3
  type: 0
  required: true
- display: Connector ID
  name: connectorId
  defaultvalue: ""
  type: 0
  required: true
- display: Fetch incidents
  name: isFetch
  type: 8
  required: false
- display: Incident type
  name: incidentType
  type: 13
  required: false
- display: SIEM key. Use to fetch incidents.
  name: siemKey
  defaultvalue: ""
  type: 4
  required: false
- display: SIEM Connector ID. Use to fetch incidents.
  name: siemConnector
  defaultvalue: ""
  type: 0
  required: false
- display: Trust any certificate (not secure)
  name: insecure
  defaultvalue: ""
  type: 8
  required: false
- display: Use system proxy settings
  name: proxy
  defaultvalue: ""
  type: 8
  required: false
script:
  script: >-
    var CBDefence = function() {
        var client = (function() {
            var urlTemplae = '%url%/integrationServices/%version%/';
            var authTemplate = '%key%/%connectorId%';
            var authSiemTemplate = '%siemKey%/%siemConnector%';
            var urlFull = replaceInTemplates(urlTemplae, params);
            var AuthToken = replaceInTemplates(authTemplate, params);
            var SiemToken = replaceInTemplates(authSiemTemplate, params);
            function addAuthToHeaders(headerObj, token) {
                 if (headerObj === 'undefined') {
                    return { 'X-Auth-Token': [token] };
                }
                headerObj['X-Auth-Token'] = [token];
                return headerObj;
            }
            var addClientAuthToHeaders = function(headerObj) {
                return addAuthToHeaders(headerObj, AuthToken);
            };
            var addSiemKeyToHeaders = function(headerObj) {
                return addAuthToHeaders(headerObj, SiemToken);
            };
            return {
                url: urlFull,
                addClientAuthToHeaders: addClientAuthToHeaders,
                addSiemKeyToHeaders: addSiemKeyToHeaders
            };
        })();
        var policyData = [
            {to: 'Id', from: 'id'},
            {to: 'PriorityLevel', from: 'priorityLevel'},
            {to: 'SystemPolicy',from: 'systemPolicy'},
            {to: 'LatestRevision',from: 'latestRevision'},
            {to: 'Policy',from: 'policy'}
        ];
        var commands = {
            'cbd-get-devices-status': {
                path: 'device',
                method: 'GET',
                queryParams: {
                    start: true,
                    rows: true,
                    hostName: true,
                    hostNameExact: true,
                    ownerName: true,
                    ownerNameExact: true,
                    ipAddress: true
                },
                extended: true,
                translator:[
                    {
                        contextPath: 'CarbonBlackDefense.GetDevicesStatus.Results(val.DeviceId==obj.DeviceId)',
                        title: 'Carbon Black Defense Get Devices Status',
                        innerPath: 'results',
                        data: [
                            { to: 'Name', from: 'name'},
                            { to: 'LastReportedTime', from: 'lastReportedTime'},
                            { to: 'PolicyId', from: 'policyId'},
                            { to: 'LastShutdownTime', from: 'lastShutdownTime'},
                            { to: 'LastContact', from: 'lastContact'},
                            { to: 'LastExternalIpAddress', from: 'lastExternalIpAddress'},
                            { to: 'AvStatus', from: 'avStatus'},
                            { to: 'RegisteredTime', from: 'registeredTime'},
                            { to: 'TargetPriorityType', from: 'targetPriorityType'},
                            { to: 'OrganizationId', from: 'organizationId'},
                            { to: 'DeviceOwnerId', from: 'deviceOwnerId'},
                            { to: 'Email', from: 'email'},
                            { to: 'ActivationCodeExpiryTime', from: 'activationCodeExpiryTime'},
                            { to: 'SensorVersion', from: 'sensorVersion'},
                            { to: 'Status', from: 'status'},
                            { to: 'TestId', from: 'testId'},
                            { to: 'DeviceId', from: 'deviceId'},
                            { to: 'SensorStates', from: 'sensorStates'},
                            { to: 'PolicyName', from: 'policyName'},
                            { to: 'SensorOutOfDate', from: 'sensorOutOfDate'},
                            { to: 'LastLocation', from: 'lastLocation'},
                            { to: 'DeviceType', from: 'deviceType'},
                            { to: 'OsVersion', from: 'osVersion'},
                            { to: 'LastInternalIpAddress', from: 'lastInternalIpAddress'},
                            { to: 'OrganizationName', from: 'organizationName'}
                        ]
                    }
                ]
            },
            'cbd-get-device-status': {
                path: 'device/%deviceId%',
                method: 'GET',
                extended: true,
                translator:[
                    {
                        contextPath: 'CarbonBlackDefense.GetDeviceStatus.DeviceInfo(val.DeviceId==obj.DeviceId)',
                        title: 'Carbon Black Defense Get Device Status',
                        innerPath: 'deviceInfo',
                        data: [
                            { to: 'Name', from: 'name'},
                            { to: 'LastReportedTime', from: 'lastReportedTime'},
                            { to: 'PolicyId', from: 'policyId'},
                            { to: 'LastShutdownTime', from: 'lastShutdownTime'},
                            { to: 'LastContact', from: 'lastContact'},
                            { to: 'LastExternalIpAddress', from: 'lastExternalIpAddress'},
                            { to: 'AvStatus', from: 'avStatus'},
                            { to: 'RegisteredTime', from: 'registeredTime'},
                            { to: 'TargetPriorityType', from: 'targetPriorityType'},
                            { to: 'OrganizationId', from: 'organizationId'},
                            { to: 'DeviceOwnerId', from: 'deviceOwnerId'},
                            { to: 'Email', from: 'email'},
                            { to: 'ActivationCodeExpiryTime', from: 'activationCodeExpiryTime'},
                            { to: 'SensorVersion', from: 'sensorVersion'},
                            { to: 'Status', from: 'status'},
                            { to: 'TestId', from: 'testId'},
                            { to: 'DeviceId', from: 'deviceId'},
                            { to: 'SensorStates', from: 'sensorStates'},
                            { to: 'PolicyName', from: 'policyName'},
                            { to: 'SensorOutOfDate', from: 'sensorOutOfDate'},
                            { to: 'LastLocation', from: 'lastLocation'},
                            { to: 'DeviceType', from: 'deviceType'},
                            { to: 'OsVersion', from: 'osVersion'},
                            { to: 'LastInternalIpAddress', from: 'lastInternalIpAddress'},
                            { to: 'OrganizationName', from: 'organizationName'}
                        ]
                    }
                ]
            },
            'cbd-change-device-status': {
                path: 'device/%deviceId%',
                method: 'PATCH',
                content: {'policyName' : null},
                extended: true,
                translator:[
                    {
                        contextPath: 'CarbonBlackDefense.ChangeDeviceStatus.DeviceInfo(val.DeviceId==obj.DeviceId)',
                        title: 'Carbon Black Defense Change Device Status',
                        innerPath: 'deviceInfo',
                        data: [
                            { to: 'Name', from: 'name'},
                            { to: 'LastReportedTime', from: 'lastReportedTime'},
                            { to: 'PolicyId', from: 'policyId'},
                            { to: 'LastShutdownTime', from: 'lastShutdownTime'},
                            { to: 'LastContact', from: 'lastContact'},
                            { to: 'LastExternalIpAddress', from: 'lastExternalIpAddress'},
                            { to: 'AvStatus', from: 'avStatus'},
                            { to: 'RegisteredTime', from: 'registeredTime'},
                            { to: 'TargetPriorityType', from: 'targetPriorityType'},
                            { to: 'OrganizationId', from: 'organizationId'},
                            { to: 'DeviceOwnerId', from: 'deviceOwnerId'},
                            { to: 'Email', from: 'email'},
                            { to: 'SensorVersion', from: 'sensorVersion'},
                            { to: 'Status', from: 'status'},
                            { to: 'TestId', from: 'testId'},
                            { to: 'DeviceId', from: 'deviceId'},
                            { to: 'SensorStates', from: 'sensorStates'},
                            { to: 'PolicyName', from: 'policyName'},
                            { to: 'SensorOutOfDate', from: 'sensorOutOfDate'},
                            { to: 'LastLocation', from: 'lastLocation'},
                            { to: 'DeviceType', from: 'deviceType'},
                            { to: 'OsVersion', from: 'osVersion'},
                            { to: 'LastInternalIpAddress', from: 'lastInternalIpAddress'},
                            { to: 'OrganizationName', from: 'organizationName'}
                        ]
                    }
                    ]
            },
            'cbd-find-events': {
                path: 'event',
                method: 'GET',
                queryParams: {
                    start: true,
                    rows: true,
                    hostName: true,
                    hostNameExact: true,
                    ownerName: true,
                    ownerNameExact: true,
                    ipAddress: true,
                    sha256Hash: true,
                    applicationName: true,
                    eventType: true,
                    searchWindow: true
                },
                extended: true,
                translator: [
                    {
                        contextPath: 'CarbonBlackDefense.FindEvents.Results(val.EventId==obj.EventId)',
                        innerPath: 'results',
                        title: 'Carbon Black Defense Find Events',
                        data: [
                            { to: 'EventTime', from: 'eventTime'},
                            { to: 'LongDescription', from: 'longDescription'},
                            { to: 'EventId', from: 'eventId'},
                            { to: 'EventType', from: 'eventType'},
                            { to: 'SelectedApp.EffectiveReputationSource', from: 'selectedApp.effectiveReputationSource'},
                            { to: 'SelectedApp.ReputationProperty', from: 'selectedApp.reputationProperty'},
                            { to: 'SelectedApp.Sha256Hash', from: 'selectedApp.sha256Hash'},
                            { to: 'SelectedApp.ApplicationName', from: 'selectedApp.applicationName'},
                            { to: 'SelectedApp.ApplicationPath', from: 'selectedApp.applicationPath'},
                            { to: 'SelectedApp.EffectiveReputation', from: 'selectedApp.effectiveReputation'},
                            { to: 'SelectedApp.Md5Hash', from: 'selectedApp.md5Hash'},
                            { to: 'ProcessDetails.UserName', from: 'processDetails.userName'},
                            { to: 'ProcessDetails.MilisSinceProcessStart', from: 'processDetails.milisSinceProcessStart'},
                            { to: 'ProcessDetails.Name', from: 'processDetails.name'},
                            { to: 'ProcessDetails.TargetCommandLine', from: 'processDetails.targetCommandLine'},
                            { to: 'ProcessDetails.TargetName', from: 'processDetails.targetName'},
                            { to: 'ProcessDetails.TargetPid', from: 'processDetails.targetPid'},
                            { to: 'ProcessDetails.FullUserName', from: 'processDetails.fullUserName'},
                            { to: 'ProcessDetails.TargetPrivatePid', from: 'processDetails.targetPrivatePid'},
                            { to: 'ProcessDetails.CommandLine', from: 'processDetails.commandLine'},
                            { to: 'ProcessDetails.PrivatePid', from: 'processDetails.privatePid'},
                            { to: 'ProcessDetails.ProcessId', from: 'processDetails.processId'},
                            { to: 'CreateTime', from: 'createTime'},
                            { to: 'DeviceDetails.Email', from: 'deviceDetails.email'},
                            { to: 'DeviceDetails.DeviceLocation.Region', from: 'deviceDetails.deviceLocation.region'},
                            { to: 'DeviceDetails.DeviceLocation.City', from: 'deviceDetails.deviceLocation.city'},
                            { to: 'DeviceDetails.DeviceLocation.Latitude', from: 'deviceDetails.deviceLocation.latitude'},
                            { to: 'DeviceDetails.DeviceLocation.CountryCode', from: 'deviceDetails.deviceLocation.countryCode'},
                            { to: 'DeviceDetails.DeviceLocation.CountryName', from: 'deviceDetails.deviceLocation.countryName'},
                            { to: 'DeviceDetails.DeviceLocation.Longitude', from: 'deviceDetails.deviceLocation.longitude'},
                            { to: 'DeviceDetails.DeviceType', from: 'deviceDetails.deviceType'},
                            { to: 'DeviceDetails.TargetPriorityType', from: 'deviceDetails.targetPriorityType'},
                            { to: 'DeviceDetails.PolicyName', from: 'deviceDetails.policyName'},
                            { to: 'DeviceDetails.DeviceId', from: 'deviceDetails.deviceId'},
                            { to: 'DeviceDetails.DeviceIpAddress', from: 'deviceDetails.deviceIpAddress'},
                            { to: 'DeviceDetails.DeviceIpV4Address', from: 'deviceDetails.deviceIpV4Address'},
                            { to: 'DeviceDetails.DeviceVersion', from: 'deviceDetails.deviceVersion'},
                            { to: 'DeviceDetails.AgentLocation', from: 'deviceDetails.agentLocation'},
                            { to: 'DeviceDetails.DeviceName', from: 'deviceDetails.deviceName'},
                            { to: 'DeviceDetails.TargetPriorityCode', from: 'deviceDetails.targetPriorityCode'},
                            { to: 'ShortDescription', from: 'shortDescription'},
                            { to: 'TargetApp.EffectiveReputation', from: 'targetApp.effectiveReputation'},
                            { to: 'TargetApp.ReputationProperty', from: 'targetApp.reputationProperty'},
                            { to: 'TargetApp.Sha256Hash', from: 'targetApp.sha256Hash'},
                            { to: 'TargetApp.ApplicationName', from: 'targetApp.applicationName'},
                            { to: 'TargetApp.EffectiveReputationSource', from: 'targetApp.effectiveReputationSource'}
                        ],
                        contextTranslator : [
                            {
                                contextPath: 'Endpoint(val.Hostname==obj.Hostname)',
                                innerPath: 'results',
                                data: [
                                    {to: 'Hostname', from: 'deviceDetails.deviceName'},
                                    {to: 'Domain', from: 'deviceDetails.deviceHostName'},
                                    {to: 'OS', from: 'deviceDetails.deviceType'},
                                    {to: 'IPAddress', from: 'deviceDetails.deviceIpV4Address'},
                                ]
                            },
                            {
                                contextPath: 'Process(val.PID==obj.PID)',
                                innerPath: 'results',
                                data: [
                                    {to: 'PID', from: 'processDetails.processId'},
                                    {to: 'Name', from: 'processDetails.name'},
                                    {to: 'Endpoint', from: 'processDetails.deviceName'},
                                    {to: 'CommandLine', from: 'processDetails.commandLine'},
                                    {to: 'MD5', from: 'processDetails.md5Hash'},
                                    {to: 'SHA1', from: 'processDetails.sha256Hash'},
                                    {to: 'Path', from: 'processDetails.applicationPath'},
                                    {to: 'ParentName', from: 'processDetails.parentName'},
                                    {to: 'ParentID', from: 'processDetails.parentPid'}
                                ]
                            }
                        ]
                    },
                    {
                        contextPath: 'CarbonBlackDefense.FindEvents.TotalResults(val.TotalResults==obj.TotalResults)',
                        title: 'Carbon Black Defense Find Events - Total Results',
                        data: [{to:'TotalResults', from: 'totalResults'}]
                    }
                ]
            },
            'cbd-find-event': {
                path: 'event/%eventId%',
                method: 'GET',
                extended: true,
                translator: [
                    {
                        contextPath: 'CarbonBlackDefense.FindEvent.EventInfo(val.EventId==obj.EventId)',
                        innerPath: 'eventInfo',
                        title: 'Carbon Black Defense Find Events',
                        data: [
                          { to: 'ShortDescription', from: 'shortDescription'},
                          { to: 'TargetHash.ApplicationName', from: 'targetHash.applicationName'},
                          { to: 'TargetHash.ReputationProperty', from: 'targetHash.reputationProperty'},
                          { to: 'TargetHash.Sha256Hash', from: 'targetHash.sha256Hash'},
                          { to: 'EventType', from: 'eventType'},
                          { to: 'ProcessHash.Md5Hash', from: 'processHash.md5Hash'},
                          { to: 'ProcessHash.Sha256Hash', from: 'processHash.sha256Hash'},
                          { to: 'ProcessHash.ApplicationPath', from: 'processHash.applicationPath'},
                          { to: 'ProcessHash.ReputationProperty', from: 'processHash.reputationProperty'},
                          { to: 'ProcessHash.ApplicationName', from: 'processHash.applicationName'},
                          { to: 'OrgDetails.OrganizationId', from: 'orgDetails.organizationId'},
                          { to: 'OrgDetails.OrganizationName', from: 'orgDetails.organizationName'},
                          { to: 'OrgDetails.OrganizationType', from: 'orgDetails.organizationType'},
                          { to: 'ParentHash.ApplicationName', from: 'parentHash.applicationName'},
                          { to: 'ParentHash.Sha256Hash', from: 'parentHash.sha256Hash'},
                          { to: 'ThreatIndicators', from: 'threatIndicators'},
                          { to: 'EventId', from: 'eventId'},
                          { to: 'LongDescription', from: 'longDescription'},
                          { to: 'DeviceDetails.DeviceIpV4Address', from: 'deviceDetails.deviceIpV4Address'},
                          { to: 'DeviceDetails.DeviceType', from: 'deviceDetails.deviceType'},
                          { to: 'DeviceDetails.Email', from: 'deviceDetails.email'},
                          { to: 'DeviceDetails.TargetPriorityCode', from: 'deviceDetails.targetPriorityCode'},
                          { to: 'DeviceDetails.AgentLocation', from: 'deviceDetails.agentLocation'},
                          { to: 'DeviceDetails.DeviceHostName', from: 'deviceDetails.deviceHostName'},
                          { to: 'DeviceDetails.DeviceId', from: 'deviceDetails.deviceId'},
                          { to: 'DeviceDetails.GroupName', from: 'deviceDetails.groupName'},
                          { to: 'DeviceDetails.DeviceVersion', from: 'deviceDetails.deviceVersion'},
                          { to: 'DeviceDetails.TargetPriorityType', from: 'deviceDetails.targetPriorityType'},
                          { to: 'DeviceDetails.DeviceIpAddress', from: 'deviceDetails.deviceIpAddress'},
                          { to: 'DeviceDetails.DeviceLocation.Latitude', from: 'deviceDetails.deviceLocation.latitude'},
                          { to: 'DeviceDetails.DeviceLocation.City', from: 'deviceDetails.deviceLocation.city'},
                          { to: 'DeviceDetails.DeviceLocation.CountryCode', from: 'deviceDetails.deviceLocation.countryCode'},
                          { to: 'DeviceDetails.DeviceLocation.DmaCode', from: 'deviceDetails.deviceLocation.dmaCode'},
                          { to: 'DeviceDetails.DeviceLocation.Longitude', from: 'deviceDetails.deviceLocation.longitude'},
                          { to: 'DeviceDetails.DeviceLocation.MetroCode', from: 'deviceDetails.deviceLocation.metroCode'},
                          { to: 'DeviceDetails.DeviceLocation.PostalCode', from: 'deviceDetails.deviceLocation.postalCode'},
                          { to: 'DeviceDetails.DeviceLocation.Region', from: 'deviceDetails.deviceLocation.region'},
                          { to: 'DeviceDetails.DeviceLocation.AreaCode', from: 'deviceDetails.deviceLocation.areaCode'},
                          { to: 'DeviceDetails.DeviceLocation.CountryName', from: 'deviceDetails.deviceLocation.countryName'},
                          { to: 'DeviceDetails.DeviceName', from: 'deviceDetails.deviceName'},
                          { to: 'CreateTime', from: 'createTime'},
                          { to: 'EventTime', from: 'eventTime'},
                          { to: 'ProcessDetails.FullUserName', from: 'processDetails.fullUserName'},
                          { to: 'ProcessDetails.Name', from: 'processDetails.name'},
                          { to: 'ProcessDetails.ParentCommandLine', from: 'processDetails.parentCommandLine'},
                          { to: 'ProcessDetails.ParentName', from: 'processDetails.parentName'},
                          { to: 'ProcessDetails.ParentPid', from: 'processDetails.parentPid'},
                          { to: 'ProcessDetails.ProcessId', from: 'processDetails.processId'},
                          { to: 'ProcessDetails.CommandLine', from: 'processDetails.commandLine'},
                          { to: 'ProcessDetails.MilisSinceProcessStart', from: 'processDetails.milisSinceProcessStart'},
                          { to: 'ProcessDetails.TargetCommandLine', from: 'processDetails.targetCommandLine'},
                          { to: 'ProcessDetails.TargetPid', from: 'processDetails.targetPid'},
                          { to: 'ProcessDetails.UserName', from: 'processDetails.userName'},
                          { to: 'ProcessDetails.ParentPrivatePid', from: 'processDetails.parentPrivatePid'},
                          { to: 'ProcessDetails.PrivatePid', from: 'processDetails.privatePid'},
                          { to: 'ProcessDetails.TargetName', from: 'processDetails.targetName'},
                          { to: 'ProcessDetails.TargetPrivatePid', from: 'processDetails.targetPrivatePid'}
                        ],
                        contextTranslator: [
                            {
                                contextPath: 'Endpoint',
                                innerPath: 'deviceDetails',
                                data: [
                                    {to: 'Hostname', from: 'deviceName'},
                                    {to: 'Domain', from: 'deviceHostName'},
                                    {to: 'OS', from: 'deviceType'},
                                    {to: 'IPAddress', from: 'deviceIpV4Address'},
                                ]
                            },
                            {
                                contextPath: 'Process',
                                innerPath: 'processDetails',
                                data: [
                                    {to: 'PID', from: 'processId'},
                                    {to: 'Name', from: 'name'},
                                    {to: 'Endpoint', from: 'deviceName'},
                                    {to: 'CommandLine', from: 'commandLine'},
                                    {to: 'MD5', from: 'md5Hash'},
                                    {to: 'SHA1', from: 'sha256Hash'},
                                    {to: 'Path', from: 'applicationPath'},
                                    {to: 'ParentName', from: 'parentName'},
                                    {to: 'ParentID', from: 'parentPid'}
                                ]
                            }
                        ]
                    }
                ]
            },
            'cbd-find-processes': {
                path: 'process',
                method: 'GET',
                queryParams: {
                    start: true,
                    rows: true,
                    hostNameExact: true,
                    ownerName: true,
                    ownerNameExact: true,
                    ipAddress: true,
                    searchWindow: true
                },
                extended: true,
                translator: [
                    {
                        title: 'Carbon Black Defense Get Processes.Results',
                        contextPath:'CarbonBlackDefense.GetProcesses(val.ProcessId==obj.ProcessId)',
                        innerPath: 'results',
                        data: [
                            {to: 'ApplicationName',from: 'applicationName'},
                            {to: 'ProcessId', from: 'processId'},
                            {to: 'NumEvents', from: 'numEvents'},
                            {to: 'ApplicationPath', from: 'applicationPath'},
                            {to: 'PrivatePid', from:  'privatePid'},
                            {to: 'Sha256Hash', from: 'sha256Hash'}
                        ]
                    },
                    {
                        title: 'Carbon Black Defense Get Processes - Total Results',
                        contextPath:'CarbonBlackDefense.GetProcesses',
                        data: [{to: 'TotalResults',from: 'totalResults'}],
                    }
                ]
            },
            'cbd-get-alert-details': {
                path: 'alert/%alertId%',
                method: 'GET',
                extended: true,
                translator : [
                    {
                        contextPath: 'CarbonBlackDefense.GetAlertDetails.DeviceInfo(val.DeviceId==obj.DeviceId)',
                        title: 'Carbon Black Defense Get Alert Details',
                        data: [
                            { to: 'DeviceInfo.DeviceType', from: 'deviceInfo.deviceType'},
                            { to: 'DeviceInfo.Group', from: 'deviceInfo.adGroupName'},
                            { to: 'DeviceInfo.GroupId', from: 'deviceInfo.adGroupId'},
                            { to: 'DeviceInfo.RegisteredTime', from: 'deviceInfo.registeredTime'},
                            { to: 'DeviceInfo.DeviceId', from: 'deviceInfo.deviceId'},
                            { to: 'DeviceInfo.DeviceName', from: 'deviceInfo.deviceName'},
                            { to: 'DeviceInfo.Status', from: 'deviceInfo.status'},
                            { to: 'DeviceInfo.OsVersion', from: 'deviceInfo.osVersion'},
                            { to: 'DeviceInfo.SensorVersion', from: 'deviceInfo.sensorVersion'},
                            { to: 'DeviceInfo.UserName', from: 'deviceInfo.userName'},
                            { to: 'DeviceInfo.Importance', from: 'deviceInfo.importance'},
                            { to: 'DeviceInfo.Message', from: 'deviceInfo.message'},
                            { to: 'DeviceInfo.Success', from: 'deviceInfo.success'},
                            { to: 'Events.ParentHash', from: 'events.parentHash'},
                            { to: 'Events.PolicyState', from: 'events.policyState'},
                            { to: 'Events.LongDescription', from: 'events.longDescription'},
                            { to: 'Events.CommandLine', from: 'events.commandLine'},
                            { to: 'Events.ParentPid', from: 'events.parentPid'},
                            { to: 'Events.ProcessId', from: 'events.processId'},
                            { to: 'Events.ThreatIndicators', from: 'events.threatIndicators'},
                            { to: 'Events.ApplicationPath', from: 'events.applicationPath'},
                            { to: 'Events.ProcessHash', from: 'events.processHash'},
                            { to: 'Events.ProcessMd5Hash', from: 'events.processMd5Hash'},
                            { to: 'Events.EventId', from: 'events.eventId'},
                            { to: 'Events.EventTime', from: 'events.eventTime'},
                            { to: 'Events.EventType', from: 'events.eventType'},
                            { to: 'Events.KillChainStatus', from: 'events.killChainStatus'},
                            { to: 'Events.ParentName', from: 'events.parentName'},
                            { to: 'Events.ParentPPid', from: 'events.parentPPid'},
                            { to: 'Events.ProcessPPid', from: 'events.processPPid'},
                            { to: 'OrgId', from: 'orgId'},
                            { to: 'ThreatInfo.IncidentId', from: 'threatInfo.incidentId'},
                            { to: 'ThreatInfo.Indicators.ApplicationName', from: 'threatInfo.indicators.applicationName'},
                            { to: 'ThreatInfo.Indicators.IndicatorName', from: 'threatInfo.indicators.indicatorName'},
                            { to: 'ThreatInfo.Indicators.Sha256Hash', from: 'threatInfo.indicators.sha256Hash'},
                            { to: 'ThreatInfo.Summary', from: 'threatInfo.summary'},
                            { to: 'ThreatInfo.ThreatId', from: 'threatInfo.threatId'},
                            { to: 'ThreatInfo.ThreatScore', from: 'threatInfo.threatScore'},
                            { to: 'ThreatInfo.Time', from: 'threatInfo.time'}
                        ],
                        contextTranslator: [
                            {
                                contextPath: 'Endpoint(val.deviceName==obj.deviceName)',
                                innerPath: 'deviceInfo',
                                data: [
                                    {to: 'Hostname', from: 'deviceName'},
                                    {to: 'OS', from: 'deviceType'}
                                ]
                            },
                            {
                                contextPath: 'Process(val.processId==obj.processId)',
                                innerPath: 'events',
                                data: [
                                    {to: 'PID', from: 'processId'},
                                    {to: 'CommandLine', from: 'commandLine'},
                                    {to: 'MD5', from: 'processMd5Hash'},
                                    {to: 'Path', from: 'applicationPath'},
                                    {to: 'ParentName', from: 'parentName'},
                                    {to: 'ParentID', from: 'parentPid'}
                                ]
                            },
                            {
                                contextPath: 'Process(val.deviceName==obj.deviceName)',
                                innerPath: 'deviceInfo',
                                data: [{to: 'Endpoint', from: 'deviceName'}]
                            },
                            {
                                contextPath: 'Account(val.Email==obj.Email)',
                                innerPath: 'deviceInfo',
                                data: [
                                    {to: 'Email', from: 'userName'},
                                    {to: 'Groups', from: 'group'}
                                ]
                            }
                        ]
                    }
                ]
            },
            "cbd-get-notifications": {
                path: 'notification',
                method: 'GET',
                siemKey: true
            },
            'cbd-get-policies': {
                path: 'policy',
                method: 'GET',
                queryParams: {
                    start: true,
                    rows: true
                },
                extended: true,
                translator : [
                    {
                        title: 'Carbon Black Defense Get Policies',
                        contextPath: 'CarbonBlackDefense.GetPolicies(val.Id==obj.Id)',
                        innerPath: 'results',
                        data: policyData
                    }
                ]
            },
            'cbd-get-policy': {
                path: 'policy/%policyId%',
                method: 'GET',
                extended: true,
                translator: [
                    {
                        title: 'Carbon Black Defense Get Policy',
                        contextPath: 'CarbonBlackDefense.GetPolicy(val.Id==obj.Id)',
                        innerPath: 'policyInfo',
                        data: policyData
                    }
                ]
            },
            'cbd-create-policy': {
                path: 'policy',
                method: 'POST',
                content: {
                    'policyInfo' : {
                        'description': null,
                        'name': null,
                        'version': 2,
                        'priorityLevel': null,
                        'policy': null
                    }
                },
                extended: true,
                translator: [
                    {
                        title: 'Carbon Black Defense Create New Policy',
                        contextPath:'CarbonBlackDefense.CreatePolicy(val.PolicyId==obj.PolicyId)',
                        data:[{to: 'PolicyId', from: 'policyId'}]
                    }
                ]
            },
            'cbd-update-policy': {
                path: 'policy/%id%',
                method: 'PUT',
                content: {
                    'policyInfo' : {
                        'description': null,
                        'name': null,
                        'version': 2,
                        'priorityLevel': null,
                        'policy': null,
                        'id': null
                    }
                }
            },
            'cbd-delete-policy': {
                path: 'policy/%policyId%',
                method: 'DELETE'
            },
            'cbd-add-rule-to-policy': {
                path: 'policy/%policyId%/rule',
                method: 'POST',
                content: {
                    'ruleInfo': {
                        'action': null,
                        'application': {
                            'type': null,
                            'value': null
                        },
                        'operation': null,
                        'required': null,
                        'id': null
                    }
                }
            },
            'cbd-delete-rule-from-policy': {
                path: 'policy/%policyId%/rule/%ruleId%',
                method: 'DELETE'
            },
            'cbd-update-rule-in-policy': {
                path: 'policy/%policyId%/rule/%id%',
                method: 'PUT',
                content: {
                    'ruleInfo': {
                        'action': null,
                        'application': {
                            'type': null,
                            'value': null
                        },
                        'operation': null,
                        'required': null,
                        'id': null
                        }
                    }
                }
        };
        //Taken from common server- with modifications
        var createEntry = function(result, translator, headerTransform) {
            /* filters out all fields where humanReadable is false */
            var filter = function(obj) {
              if(obj.humanReadable !== false) {
                  return true;
              }
              return false;
            };
            var entry = {
              Type: entryTypes.note,
              Contents: result,
              ContentsType: formats.json,
              ReadableContentsFormat: formats.markdown,
              EntryContext: {}
            };
            var content = translator.innerPath ? dq(result, translator.innerPath) : result;
            var translatedContext = mapObjFunction(translator.data) (content);
            var translatedMD = mapObjFunction(translator.data, filter) (content);
            var context = createContext(translatedContext);
            entry.EntryContext[translator.contextPath] = context;
            entry.HumanReadable = tableToMarkdown(translator.title, translatedMD, undefined, undefined, headerTransform || dotToSpace);
            if (translator.contextTranslator) {
                var conTranslator = translator.contextTranslator;
                for (var i = 0; i < conTranslator.length; i++ ) {
                    addContextToEntry(result, entry, conTranslator[i]);
                }
            }
            return entry;
        };
        function addContextToEntry(result, entry, translator) {
            var content = translator.innerPath ? dq(result, translator.innerPath) : result;
            var translatedContext = mapObjFunction(translator.data) (content);
            var context = createContext(translatedContext);
            entry.EntryContext[translator.contextPath] = context;
        }
        var generateQuery = function(cmd) {
            var seperateQueryParams = (function() {
                var seperated = {};
                if (cmd.queryParams) {
                    for (var arg in args) {
                        if (cmd.queryParams[arg]) {
                           seperated[arg] = args[arg];
                        }
                    }
                }
                return seperated;
            })();
            var queryString = (function() {
                return encodeToURLQuery(seperateQueryParams);
            })();
            return {
                str: queryString,
                parameters: seperateQueryParams
            };
        };
        function sendRequest(fullurl, method, headers, body) {
            var req = {
                    Method: method,
                    Headers: headers
                };
            if (body !== 'undifiend') {
                req.Body = body;
            }
            var res = http(fullurl, req, params.insecure, params.proxy);
            return res;
        }
        function pathify(cmd) {
            return replaceInTemplates(cmd.path,args);
        }
        function buildBody(cmd) {
            content = cmd.content;
            assignContentFromArgs(content);
            return JSON.stringify(content);
        }
        function assignContentFromArgs(obj) {
            for (var key in obj) {
                if (obj[key] === null) {
                    if (args[key]) {
                        if (args[key] === 'true' || args[key] === 'false') {
                            obj[key] = (args[key] === 'true');
                        } else if (!isNaN(args[key])) {
                            obj[key] = parseInt(args[key]);
                        }
                        else {
                            obj[key] = args[key];
                        }
                    }
                } else if(typeof obj[key] === 'object' ) {
                    assignContentFromArgs(obj[key]);
                }
            }
        }
        var setPolicy = function() {
            var setter;
            var policy = args.policy;
            try {
                setter = JSON.parse(args.keyValue);
            } catch(err) {
                throw err;
            }
            for (var path in setter) {
                var val = setter[path];
                var keysArr = path.split('.');
                var obj = policy;
                var i = 0;
                while (obj && i < keysArr.length - 1) {
                    obj = obj[keysArr[i]];
                    i++;
                }
                if (!(obj && obj[keysArr[i]])) {
                    throw 'field path ' + path + ' is not defined in the policy object';
                }
                obj[keysArr[i]] = val;
            }
            return {
                Type: entryTypes.note,
                Contents: policy,
                ContentsFormat: formats.json,
                EntryContext : {'CarbonBlackDefense.SetPolicy.Policy': policy }
            };
        };
        function executeCommand(cmd) {
            var query = generateQuery(cmd);
            var uniquePath = pathify(cmd);
            var url = client.url + uniquePath + query.str;
            var headers = {};
            var body;
            if (cmd.content) {
                body = buildBody(cmd);
            }
            headers = {
                'Content-Type': ['application/json'],
                'Accept': ['application/json']
            };
            if (cmd.siemKey) {
                client.addSiemKeyToHeaders(headers);
            } else {
                client.addClientAuthToHeaders(headers);
            }
            var res = sendRequest(url, cmd.method, headers, body);
            return res;
        }
        var executeAndShowResult = function (cmdName) {
            var cmd = commands[cmdName];
            var res = executeCommand(cmd);
            var body = parseBody(res);
            if (!cmd.extended) {
                return {
                    Type: entryTypes.note,
                    ContentsFormat: formats.text,
                    Contents: 'Request Success'
                };
            }
            var entries = [];
            for (var i = 0; i < cmd.translator.length; i++) {
                entries.push(createEntry(body, cmd.translator[i]));
            }
            return entries;
        };
        function parseBody(httpResponse) {
            var body = JSON.parse(httpResponse.Body);
            if (httpResponse.StatusCode !== 200) {
                throw 'Request failed: ' + httpResponse.Status + ".\n" + body.message
            }
            return body;
        }
        var runTest = function() {
            args = { rows: '0' };
            var res = executeCommand(commands['cbd-get-devices-status']);
            if (res.StatusCode === 200) {
                return 'ok';
            }
            if (res.StatusCode === 401) {
                throw 'Test failed. Make sure that the Connector ID and API key are valid.';
            }
            throw 'Test failed for unknown reason';
        };
        function createIncidentsFromNotification(notification) {
            return {
                'name': 'event ' + notification.eventId + ', ' + notification.eventDescription,
                'rawJson': JSON.stringify(notification)
            };
        }
        var getNotifications = function() {
            if (!params.siemKey || !params.siemConnector) {
                throw 'SIEM key and SIEM connector are mandatory parameters to fetch incidents.';
            }
            var res = executeCommand(commands['cbd-get-notifications']);
            if (res.StatusCode !== 200 ) {
                throw 'Request failed with status code: ' + res.StatusCode;
            }
            var body = JSON.parse(res.Body);
            if (!body.notifications) {
                return;
            }
            var notifications = body.notifications;
            var incidents = [];
            for (var i = 0; i < notifications.length; i++) {
                var incident = createIncidentsFromNotification(notifications[i]);
                incidents.push(incident);
            }
            return JSON.stringify(incidents);
        };
        return {
            execute: executeAndShowResult,
            runTest: runTest,
            getNotifications: getNotifications,
            setPolicy: setPolicy
        };
    };

    var cbd = CBDefence();

    switch (command) {
        case 'test-module':
            return cbd.runTest();
        case 'fetch-incidents':
            return cbd.getNotifications();
        case 'cbd-set-policy':
            return cbd.setPolicy();
        default:
            if (args.policy && typeof args.policy === 'string') {
                try {
                    var p = JSON.parse(args.policy);
                    args.policy = p;
                } catch (err) {
                    return "Failed to parse policy into a JSON object.\n" + err;
                }
            }
            return cbd.execute(command);
    }
  type: javascript
  commands:
  - name: cbd-get-devices-status
    arguments:
    - name: hostName
      description: Query parameter. Filter on hostnames based on a case insensitive token search.
    - name: hostNameExact
      description: Query parameter. Filter on the exact hostname
    - name: ownerName
      description: Query parameter. Filter on owner name case insensitively.
    - name: ownerNameExact
      description: Query parameter. Same as ownerName but with case sensitivity
    - name: ipAddress
      description: Query parameter. Filter on devices with a given external or internal IP address
    - name: start
      description: Wanted first row number from the result (starting from 1).
    - name: rows
      description: Wanted maximum number of rows from the result. This parameter can be limited on the Cb Defense server side.
    outputs:
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.ActivationCodeExpiryTime
      description: Activation Code Expiry Time
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.LastExternalIpAddress
      description: Last External IpAddress
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.LastLocation
      description: Last Location
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.LastReportedTime
      description: Last Reported Time
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.LastShutdownTime
      description: Last Shutdown Time
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.OsVersion
      description: Os Version
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.PolicyId
      description: Policy Id
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.RegisteredTime
      description: Registered Time
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.Status
      description: Status
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.DeviceId
      description: Device Id
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.DeviceOwnerId
      description: Device Owner Id
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.DeviceType
      description: Device Type
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.OrganizationId
      description: Organization Id
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.SensorVersion
      description: Sensor Version
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.TargetPriorityType
      description: Target Priority Type
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.Email
      description: Email
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.LastContact
      description: Last Contact
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.OrganizationName
      description: Organization Name
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.SensorStates
      description: SensorStates
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.AvStatus
      description: AvStatus
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.LastInternalIpAddress
      description: Last Internal IpAddress
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.Name
      description: Name
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.PolicyName
      description: Policy Name
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.SensorOutOfDate
      description: Sensor Out OfDate
    - contextPath: CarbonBlackDefense.GetDevicesStatus.Results.TestId
      description: Test Id
    description: 'Get a status of all devices. Optionally you can include a query parameter to filter the results. Combining these query parameters is an implicit “AND”. '
  - name: cbd-get-device-status
    arguments:
    - name: deviceId
      required: true
      description: Individual device id.
    outputs:
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.TargetPriorityType
      description: Target Priority Type
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.OrganizationId
      description: Organization Id
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.CreateTime
      description: Create Time
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.DeviceId
      description: Device Id
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.Email
      description: Email
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.LastInternalIpAddress
      description: Last Internal IpAddress
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.LastLocation
      description: Last Location
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.OsVersion
      description: Os Version
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.AvStatus
      description: AvStatus
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.LastExternalIpAddress
      description: Last External IpAddress
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.RegisteredTime
      description: Registered Time
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.LastContact
      description: Last Contact
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.Status
      description: Status
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.TestId
      description: Test Id
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.PolicyId
      description: Policy Id
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.UpdateVersion
      description: Update Version
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.OrganizationName
      description: Organization Name
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.RootedByAnalytics
      description: Rooted ByAnalytics
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.SensorVersion
      description: Sensor Version
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.DeviceType
      description: Device Type
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.PolicyName
      description: Policy Name
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.RootedByAnalyticsTime
      description: Rooted ByAnalytics Time
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.SensorOutOfDate
      description: Sensor Out OfDate
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.SensorStates
      description: SensorStates
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.Name
      description: Name
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.Id
      description: Id
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.LastReportedTime
      description: Last Reported Time
    - contextPath: CarbonBlackDefense.GetDeviceStatus.DeviceInfo.DeviceOwnerId
      description: Device Owner Id
    description: Retrieve details for an individual device given the device ID.
  - name: cbd-change-device-status
    arguments:
    - name: deviceId
      required: true
      description: The device id.
    - name: policyId
      description: Policy id.
    - name: policyName
      description: Policy name.
    description: 'Change status of an individual device by its device ID. The requested security policy can be indicated either as a policy ID (policyId) or policy name (policyName).The current revision of the Cb Defense backend only allows one element to be changed with this call: the security policy assigned to the device. For example policyName=Restrictive_Windows_Workstation'
  - name: cbd-find-events
    arguments:
    - name: hostName
      description: 'Query parameter. Filter on hostnames case insensitive. '
    - name: hostNameExact
      description: Query parameter. Filter on the exact hostname
    - name: ownerName
      description: Query parameter. Filter on owner name case insensitive.
    - name: ownerNameExact
      description: Query parameter. Same as ownerName but with case sensitivity
    - name: ipAddress
      description: Query parameter. Filter on events generated by a device with a given external or internal IP address
    - name: sha256Hash
      description: Query parameter. Filter on events generated by a process with the given SHA-256 hash. Note that this hash must be lowercase.
    - name: applicationName
      description: Query parameter. Filter on events generated by a process with the given application name. Note that this name must be lowercase
    - name: eventType
      auto: PREDEFINED
      predefined:
      - NETWORK
      - FILE_CREATE
      - REGISTRY_ACCESS
      - SYSTEM_API_CALL
      - CREATE_PROCESS
      - DATA_ACCESS
      - INJECT_CODE
      description: Query parameter. Filter on events with a given event type.
    - name: searchWindow
      description: 'Query parameter. Filter on events generated within a given relative time frame. Note that the default is one day if a searchWindow is not specified. Note that events may not be available past 30 days due to retention policies. '
    - name: start
      description: Wanted first row number from the result (starting from 1).
    - name: rows
      description: Wanted maximum number of rows from the result. This parameter can be limited on the Cb Defense server side.
    outputs:
    - contextPath: CarbonBlackDefense.FindEvents.Results.EventType
      description: Event Type
    - contextPath: CarbonBlackDefense.FindEvents.Results.ProcessDetails.MilisSinceProcessStart
      description: Milis Since Process Start
    - contextPath: CarbonBlackDefense.FindEvents.Results.ProcessDetails.Name
      description: Name
    - contextPath: CarbonBlackDefense.FindEvents.Results.ProcessDetails.PrivatePid
      description: Private Pid
    - contextPath: CarbonBlackDefense.FindEvents.Results.ProcessDetails.ProcessId
      description: Process Id
    - contextPath: CarbonBlackDefense.FindEvents.Results.ShortDescription
      description: Short Description
    - contextPath: CarbonBlackDefense.FindEvents.Results.CreateTime
      description: Create Time
    - contextPath: CarbonBlackDefense.FindEvents.Results.DeviceDetails.DeviceName
      description: Device Name
    - contextPath: CarbonBlackDefense.FindEvents.Results.DeviceDetails.DeviceVersion
      description: Device Version
    - contextPath: CarbonBlackDefense.FindEvents.Results.DeviceDetails.PolicyName
      description: Policy Name
    - contextPath: CarbonBlackDefense.FindEvents.Results.DeviceDetails.TargetPriorityType
      description: Target Priority Type
    - contextPath: CarbonBlackDefense.FindEvents.Results.DeviceDetails.AgentLocation
      description: Agent Location
    - contextPath: CarbonBlackDefense.FindEvents.Results.DeviceDetails.DeviceId
      description: Device Id
    - contextPath: CarbonBlackDefense.FindEvents.Results.DeviceDetails.DeviceIpV4Address
      description: Device IpV4Address
    - contextPath: CarbonBlackDefense.FindEvents.Results.DeviceDetails.DeviceLocation.AreaCode
      description: Area Code
    - contextPath: CarbonBlackDefense.FindEvents.Results.DeviceDetails.DeviceLocation.CountryCode
      description: Country Code
    - contextPath: CarbonBlackDefense.FindEvents.Results.DeviceDetails.DeviceLocation.Latitude
      description: Latitude
    - contextPath: CarbonBlackDefense.FindEvents.Results.DeviceDetails.DeviceLocation.Longitude
      description: Longitude
    - contextPath: CarbonBlackDefense.FindEvents.Results.DeviceDetails.DeviceLocation.City
      description: City
    - contextPath: CarbonBlackDefense.FindEvents.Results.DeviceDetails.DeviceLocation.CountryName
      description: Country Name
    - contextPath: CarbonBlackDefense.FindEvents.Results.DeviceDetails.DeviceLocation.DmaCode
      description: Dma Code
    - contextPath: CarbonBlackDefense.FindEvents.Results.DeviceDetails.DeviceLocation.MetroCode
      description: Metro Code
    - contextPath: CarbonBlackDefense.FindEvents.Results.DeviceDetails.DeviceLocation.PostalCode
      description: Postal Code
    - contextPath: CarbonBlackDefense.FindEvents.Results.DeviceDetails.DeviceLocation.Region
      description: Region
    - contextPath: CarbonBlackDefense.FindEvents.Results.DeviceDetails.DeviceIpAddress
      description: Device IpAddress
    - contextPath: CarbonBlackDefense.FindEvents.Results.DeviceDetails.DeviceType
      description: Device Type
    - contextPath: CarbonBlackDefense.FindEvents.Results.DeviceDetails.Email
      description: Email
    - contextPath: CarbonBlackDefense.FindEvents.Results.DeviceDetails.TargetPriorityCode
      description: Target Priority Code
    - contextPath: CarbonBlackDefense.FindEvents.Results.EventId
      description: Event Id
    - contextPath: CarbonBlackDefense.FindEvents.Results.EventTime
      description: Event Time
    - contextPath: CarbonBlackDefense.FindEvents.Results.LongDescription
      description: Long Description
    - contextPath: CarbonBlackDefense.FindEvents.Results.NetFlow.DestAddress
      description: Dest Address
    - contextPath: CarbonBlackDefense.FindEvents.Results.NetFlow.DestPort
      description: Dest Port
    - contextPath: CarbonBlackDefense.FindEvents.Results.NetFlow.PeerFqdn
      description: Peer Fqdn
    - contextPath: CarbonBlackDefense.FindEvents.Results.NetFlow.PeerIpAddress
      description: Peer IpAddress
    - contextPath: CarbonBlackDefense.FindEvents.Results.NetFlow.PeerIpV4Address
      description: Peer IpV4Address
    - contextPath: CarbonBlackDefense.FindEvents.Results.NetFlow.Service
      description: Service
    - contextPath: CarbonBlackDefense.FindEvents.Results.NetFlow.SourceAddress
      description: Source Address
    - contextPath: CarbonBlackDefense.FindEvents.Results.NetFlow.SourcePort
      description: Source Port
    - contextPath: CarbonBlackDefense.FindEvents.Results.SelectedApp.ApplicationName
      description: Application Name
    - contextPath: CarbonBlackDefense.FindEvents.Results.SelectedApp.ApplicationPath
      description: Application Path
    - contextPath: CarbonBlackDefense.FindEvents.Results.SelectedApp.Md5Hash
      description: Md5Hash
    - contextPath: CarbonBlackDefense.FindEvents.Results.SelectedApp.Sha256Hash
      description: Sha256Hash
    - contextPath: CarbonBlackDefense.FindEvents.Results.ThreatIndicators
      description: Threat Indicators
    description: Retrieves all events matching the input search criteria.
  - name: cbd-find-event
    arguments:
    - name: eventId
      required: true
      description: The event id.
    outputs:
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ShortDescription
      description: Short Description
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.TargetHash.ApplicationName
      description: Application Name
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.TargetHash.ReputationProperty
      description: Reputation Property
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.TargetHash.Sha256Hash
      description: Sha256Hash
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.EventType
      description: Event Type
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ProcessHash.Md5Hash
      description: Md5Hash
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ProcessHash.Sha256Hash
      description: Sha256Hash
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ProcessHash.ApplicationPath
      description: Application Path
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ProcessHash.ReputationProperty
      description: Reputation Property
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ProcessHash.ApplicationName
      description: Application Name
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.OrgDetails.OrganizationId
      description: Organization Id
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.OrgDetails.OrganizationName
      description: Organization Name
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.OrgDetails.OrganizationType
      description: Organization Type
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ParentHash.ApplicationName
      description: Application Name
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ParentHash.Sha256Hash
      description: Sha256Hash
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.EventId
      description: Event Id
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.LongDescription
      description: Long Description
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.DeviceDetails.DeviceIpV4Address
      description: Device IpV4Address
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.DeviceDetails.DeviceType
      description: Device Type
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.DeviceDetails.Email
      description: Email
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.DeviceDetails.TargetPriorityCode
      description: Target Priority Code
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.DeviceDetails.AgentLocation
      description: Agent Location
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.DeviceDetails.DeviceHostName
      description: Device Host Name
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.DeviceDetails.DeviceId
      description: Device Id
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.DeviceDetails.GroupName
      description: Group Name
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.DeviceDetails.DeviceVersion
      description: Device Version
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.DeviceDetails.TargetPriorityType
      description: Target Priority Type
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.DeviceDetails.DeviceIpAddress
      description: Device IpAddress
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.DeviceDetails.DeviceLocation.Latitude
      description: Latitude
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.DeviceDetails.DeviceLocation.City
      description: City
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.DeviceDetails.DeviceLocation.CountryCode
      description: Country Code
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.DeviceDetails.DeviceLocation.DmaCode
      description: Dma Code
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.DeviceDetails.DeviceLocation.Longitude
      description: Longitude
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.DeviceDetails.DeviceLocation.MetroCode
      description: Metro Code
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.DeviceDetails.DeviceLocation.PostalCode
      description: Postal Code
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.DeviceDetails.DeviceLocation.Region
      description: Region
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.DeviceDetails.DeviceLocation.AreaCode
      description: Area Code
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.DeviceDetails.DeviceLocation.CountryName
      description: Country Name
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.DeviceDetails.DeviceName
      description: Device Name
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.CreateTime
      description: Create Time
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.EventTime
      description: Event Time
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ProcessDetails.FullUserName
      description: Full User Name
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ProcessDetails.Name
      description: Name
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ProcessDetails.ParentCommandLine
      description: Parent Command Line
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ProcessDetails.ParentName
      description: Parent Name
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ProcessDetails.ParentPid
      description: Parent Pid
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ProcessDetails.ProcessId
      description: Process Id
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ProcessDetails.CommandLine
      description: Command Line
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ProcessDetails.MilisSinceProcessStart
      description: Milis Since Process Start
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ProcessDetails.TargetCommandLine
      description: Target Command Line
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ProcessDetails.TargetPid
      description: Target Pid
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ProcessDetails.UserName
      description: User Name
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ProcessDetails.ParentPrivatePid
      description: Parent Private Pid
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ProcessDetails.PrivatePid
      description: Private Pid
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ProcessDetails.TargetName
      description: Target Name
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ProcessDetails.TargetPrivatePid
      description: Target Private Pid
    - contextPath: CarbonBlackDefense.GetAlertDetails.EventInfo.ThreatIndicators
      description: Threat Indicators
    description: 'Retrieve details for an individual event given the event ID '
  - name: cbd-find-processes
    arguments:
    - name: hostNameExact
      description: 'Query parameter. Filter on hostnames case insensitive. '
    - name: ownerName
      description: Query parameter. Filter on owner name case insensitive.
    - name: ownerNameExact
      description: Query parameter. Same as ownerName but with case sensitivity
    - name: ipAddress
      description: Query parameter. Filter on events generated by a device with a given external or internal IP address
    - name: searchWindow
      description: 'Query parameter. Filter on events generated within a given relative time frame. Note that the default is one day if a searchWindow is not specified. Note that events may not be available past 30 days due to retention policies. '
    - name: start
      description: Wanted first row number from the result (starting from 1).
    - name: rows
      description: Wanted maximum number of rows from the result. This parameter can be limited on the Cb Defense server side.
    outputs:
    - contextPath: CarbonBlackDefense.GetProcesses.ApplicationName
      description: Application name
    - contextPath: CarbonBlackDefense.GetProcesses.ProcessId
      description: Process id
    - contextPath: CarbonBlackDefense.GetProcesses.NumEvents
      description: Number of events
    - contextPath: CarbonBlackDefense.GetProcesses.ApplicationPath
      description: Application path
    - contextPath: CarbonBlackDefense.GetProcesses.PrivatePid
      description: Private pid
    - contextPath: CarbonBlackDefense.GetProcesses.Sha256Hash
      description: sha256Hash
    - contextPath: CarbonBlackDefense.GetProcesses.TotalResults
      description: Total results
    description: Find processes associated with a specific indicator or IP address filter. Only API keys of type “API” can call the processes API.
  - name: cbd-get-alert-details
    arguments:
    - name: alertId
      required: true
      description: The alert id
    outputs:
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.DeviceInfo.DeviceType
      description: Device Type
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.DeviceInfo.Group
      description: Group
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.DeviceInfo.GroupId
      description: Group Id
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.DeviceInfo.RegisteredTime
      description: Registered Time
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.DeviceInfo.DeviceId
      description: Device Id
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.DeviceInfo.DeviceName
      description: Device Name
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.DeviceInfo.Status
      description: Status
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.DeviceInfo.OsVersion
      description: Os Version
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.DeviceInfo.SensorVersion
      description: Sensor Version
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.DeviceInfo.UserName
      description: User Name
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.DeviceInfo.Importance
      description: Importance
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.DeviceInfo.Message
      description: Message
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.DeviceInfo.Success
      description: Success
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.Events.ParentHash
      description: Parent Hash
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.Events.PolicyState
      description: Policy State
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.Events.LongDescription
      description: Long Description
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.Events.CommandLine
      description: Command Line
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.Events.ParentPid
      description: Parent Pid
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.Events.ProcessId
      description: Process Id
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.Events.ThreatIndicators
      description: Threat Indicators
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.Events.ApplicationPath
      description: Application Path
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.Events.ProcessHash
      description: Process Hash
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.Events.ProcessMd5Hash
      description: Process Md5Hash
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.Events.EventId
      description: Event Id
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.Events.EventTime
      description: Event Time
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.Events.EventType
      description: Event Type
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.Events.KillChainStatus
      description: Kill Chain Status
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.Events.ParentName
      description: Parent Name
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.Events.ParentPPid
      description: ParentP Pid
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.Events.ProcessPPid
      description: ProcessP Pid
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.ThreatInfo.IncidentId
      description: Incident Id
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.ThreatInfo.Indicators.ApplicationName
      description: Application Name
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.ThreatInfo.Indicators.IndicatorName
      description: Indicator Name
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.ThreatInfo.Indicators.Sha256Hash
      description: Sha256Hash
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.ThreatInfo.Summary
      description: Summary
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.ThreatInfo.ThreatId
      description: Threat Id
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.ThreatInfo.ThreatScore
      description: Threat Score
    - contextPath: CarbonBlackDefense.GetAlertDetails.DeviceInfo.ThreatInfo.Time
      description: Time
    description: Get details on the events that led to an alert. This includes retrieving metadata around the alert as well as a list of all the events associated with the alert. Only API keys of type “API” can call the alerts API.
  - name: cbd-get-policies
    arguments: []
    outputs:
    - contextPath: CarbonBlackDefense.GetPolicies.Id
      description: The policy id.
    - contextPath: CarbonBlackDefense.GetPolicies.PriorityLevel
      description: The policy priority level.
    - contextPath: CarbonBlackDefense.GetPolicies.SystemPolicy
      description: Is system policy (boolean).
    - contextPath: CarbonBlackDefense.GetPolicies.LatestRevision
      description: Policy latest revision.
    - contextPath: CarbonBlackDefense.GetPolicies.Policy
      description: The policy object.
    description: Get the list of policies available in your organization.
  - name: cbd-get-policy
    arguments:
    - name: policyId
      required: true
      description: The policy id.
    outputs:
    - contextPath: CarbonBlackDefense.GetPolicy.Id
      description: The policy id.
    - contextPath: CarbonBlackDefense.GetPolicy.PriorityLevel
      description: The policy priority level.
    - contextPath: CarbonBlackDefense.GetPolicy.SystemPolicy
      description: Is system policy (boolean).
    - contextPath: CarbonBlackDefense.GetPolicy.LatestRevision
      description: Policy latest revision.
    - contextPath: CarbonBlackDefense.GetPolicy.Policy
      description: The policy object.
    description: Retrieve a policy object by ID.
  - name: cbd-create-policy
    arguments:
    - name: description
      required: true
      description: A description of the policy
    - name: name
      required: true
      description: A one-line name for the policy
    - name: priorityLevel
      required: true
      auto: PREDEFINED
      predefined:
      - HIGH
      - MEDIUM
      - LOW
      description: The priority score associated with sensors assigned to this policy.
    - name: policy
      required: true
      description: The JSON object containing the policy details. Make sure a valid policy object is passed. You may use 'get-policy' in order to receive a similar policy object, then re-set some of the policy's fields with 'set-policy'. Finally pass the mutated object.
    outputs:
    - contextPath: CarbonBlackDefense.CreatePolicy.PolicyId
      description: The new policy id.
    description: Create a new Policy on the Cb Defense backend.
  - name: cbd-update-policy
    arguments:
    - name: description
      required: true
      description: A description of the policy.
    - name: name
      required: true
      description: A one-line name for the policy.
    - name: priorityLevel
      required: true
      auto: PREDEFINED
      predefined:
      - HIGH
      - MEDIUM
      - LOW
      description: The priority score associated with sensors assigned to this policy.
    - name: id
      required: true
      description: The ID of the policy to replace.
    - name: policy
      required: true
      description: The JSON object containing the policy details. The JSON object containing the policy details. Make sure a valid policy object is passed. You may use 'get-policy' in order to receive the policy object you wish to update, then re-set some of the policy's fields with 'set-policy'. Finally pass the mutated object.
    description: Update an existing policy with a new policy. Please note that system policies cannot be modified.
  - name: cbd-delete-policy
    arguments:
    - name: policyId
      required: true
      description: The policy id.
    description: Delete a policy from the Cb Defense backend. This may return an error if devices are actively assigned to the policy id requested for deletion. Please note that system policies cannot be deleted.
  - name: cbd-add-rule-to-policy
    arguments:
    - name: action
      required: true
      description: Rule action.
    - name: operation
      required: true
      description: Rule operation.
    - name: required
      required: true
      auto: PREDEFINED
      predefined:
      - "false"
      - "true"
      description: Rule required
    - name: id
      required: true
      description: Rule id.
    - name: type
      required: true
      description: Application type.
    - name: value
      required: true
      description: Application value.
    - name: policyId
      required: true
      description: The policy id.
    description: Add a new rule to an existing policy. Please note that system policies cannot be modified.
  - name: cbd-delete-rule-from-policy
    arguments:
    - name: policyId
      required: true
      description: The policy id.
    - name: ruleId
      required: true
      description: The rule id.
    description: Removes a rule from an existing policy. Please note that system policies cannot be modified.
  - name: cbd-update-rule-in-policy
    arguments:
    - name: action
      required: true
      description: Rule action.
    - name: operation
      required: true
      description: Rule operation.
    - name: required
      required: true
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Rule required
    - name: id
      required: true
      description: Rule id.
    - name: type
      required: true
      description: Application type.
    - name: value
      required: true
      description: Application value.
    - name: policyId
      required: true
      description: The policy id.
    description: Update an existing rule with a new rule. Please note that system policies cannot be modified.
  - name: cbd-set-policy
    arguments:
    - name: keyValue
      required: true
      description: 'A json object that holds key/value pairs. Key is the field path in the policy object you wish to update with value.  '
    - name: policy
      required: true
      description: 'The policy to be set. '
    outputs:
    - contextPath: CarbonBlackDefense.SetPolicy.Policy
      description: The modified policy
    description: Re-set policy fields.
  isfetch: true
  runonce: false
tests:
- No test
fromversion: 5.0.0
