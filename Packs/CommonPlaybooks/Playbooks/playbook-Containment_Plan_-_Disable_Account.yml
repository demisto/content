id: Containment Plan - Disable Account
version: -1
name: Containment Plan - Disable Account
description: "This playbook is one of the sub-playbooks in the containment plan. \nThis playbook handles disabling the account as a crucial step in the containment action.\n"
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 9fb1ed1d-c22c-48bb-8a3c-4d58bbca6347
    type: start
    task:
      id: 9fb1ed1d-c22c-48bb-8a3c-4d58bbca6347
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "17"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": -300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: 4d874c50-7a1f-489c-8397-3fc3304eeea6
    type: title
    task:
      id: 4d874c50-7a1f-489c-8397-3fc3304eeea6
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 940
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: c35213af-fd08-44f2-8bf3-ecae94fb2e8d
    type: condition
    task:
      id: c35213af-fd08-44f2-8bf3-ecae94fb2e8d
      version: -1
      name: Is Active Directory Query v2 enabled?
      description: Returns 'yes' if integration brand is available. Otherwise returns 'no'
      scriptName: IsIntegrationAvailable
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "2"
      "yes":
      - "13"
    scriptarguments:
      brandname:
        simple: Active Directory Query v2
    results:
    - brandInstances
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 190
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: 73bc4723-d270-4e04-8a74-c13b5b1369f1
    type: regular
    task:
      id: 73bc4723-d270-4e04-8a74-c13b5b1369f1
      version: -1
      name: Set disabled users to the Incident context
      description: commands.local.cmd.set.parent.incident.context
      script: Builtin|||setParentIncidentContext
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "2"
    scriptarguments:
      key:
        simple: DisabledUsers
      value:
        complex:
          root: Blocklist
          accessor: Final
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 765
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: 073f607c-a924-43c1-8852-d480e1454fdc
    type: condition
    task:
      id: 073f607c-a924-43c1-8852-d480e1454fdc
      version: -1
      name: Should disable the account based on the incident context?
      description: Whether to disable the account based on the input values and the incident context.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "2"
      "yes":
      - "7"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEqualString
          left:
            value:
              complex:
                root: ListCompare
                accessor: LeftOnly
            iscontext: true
          right:
            value:
              simple: No Values
          ignorecase: true
      - - operator: isNotEqualString
          left:
            value:
              complex:
                root: ListCompare
                accessor: Both
            iscontext: true
          right:
            value:
              simple: No Values
          ignorecase: true
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: ListCompare
                accessor: LeftOnly
            iscontext: true
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.UserContainment
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 2
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: 32ec3207-df33-4d5f-8551-2a49ca677b62
    type: regular
    task:
      id: 32ec3207-df33-4d5f-8551-2a49ca677b62
      version: -1
      name: 'Set users to disable and not appear in Incident context '
      description: |-
        Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.11/Cortex-XSOAR-Administrator-Guide/Automations
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "18"
    scriptarguments:
      key:
        simple: UsersToDisable
      value:
        complex:
          root: ListCompare
          accessor: LeftOnly
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 400
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: 46906c55-db0e-48d1-8c1c-38cb34384cd0
    type: regular
    task:
      id: 46906c55-db0e-48d1-8c1c-38cb34384cd0
      version: -1
      name: Compare the input usernames with disabled users in the incident
      description: Compare two lists and put the differences in context.
      scriptName: CompareLists
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "12"
    scriptarguments:
      left:
        complex:
          root: inputs.Username
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: No Values
      right:
        complex:
          root: parentIncidentContext
          accessor: DisabledUsers
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: No Values
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": -160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 2
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: b35ee9bb-51f1-4f64-8df5-b490d1592b2c
    type: playbook
    task:
      id: b35ee9bb-51f1-4f64-8df5-b490d1592b2c
      version: -1
      name: Block Account - Generic v2
      playbookName: Block Account - Generic v2
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "8"
    scriptarguments:
      Tag:
        simple: Bad Account
      UserVerification:
        simple: "True"
      Username:
        complex:
          root: UsersToDisable
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 450,
          "y": 580
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "12_2_#default#": 0.16,
      "12_7_yes": 0.47,
      "7_2_#default#": 0.2
    },
    "paper": {
      "dimensions": {
        "height": 1305,
        "width": 380,
        "x": 450,
        "y": -300
      }
    }
  }
inputs:
- key: UserContainment
  value:
    simple: "True"
  required: false
  description: Set to 'True' to disable the user account.
  playbookInputQuery:
- key: Username
  value: {}
  required: false
  description: The username to disable.
  playbookInputQuery:
outputs: []
quiet: true
tests:
- No tests (auto formatted)
fromversion: 6.6.0
marketplaces:
- marketplacev2