commonfields:
  id: script-JiraListTransition
  version: -1
name: script-JiraListTransition
script: |-
  def main():
      output = {}
      # res = demisto.executeCommand('jira-list-transitions-command', {'issueId': incident.get('dbotMirrorId')})[0]["Contents"]
      try:
          incident = demisto.incidents()[0]
          incident_id = incident.get('dbotMirrorId')
          if incident_id:
              res = demisto.executeCommand('jira-list-transitions-command', {'issueId': incident.get('dbotMirrorId')})
              if isinstance(res, list):
                  res = res[0]
                  transitions_names = res.get("Contents")
                  if transitions_names:
                      if not isError(res):
                          output = {'hidden': False, 'options': sorted(transitions_names)}
                      else:
                          output = {"Type": entryTypes["error"], "ContentsFormat": formats["text"],
                                    "Contents": f"Error occurred while running jira-list-transitions-command. The response is: {transitions_names}"}
                  else:
                      output = {"Type": entryTypes["error"], "ContentsFormat": formats["text"],
                      "Contents": f"Error occurred while running script-JiraListTransition. Could not find:\"Content\" as key. The response is: {res}"}
              else:
                  output = {"Type": entryTypes["error"], "ContentsFormat": formats["text"],
                  "Contents": f"Error occurred while running script-JiraListTransition. expected a list as response but got: {type(res)}. The response is: {res}"}
          else:
              output = {"Type": entryTypes["error"], "ContentsFormat": formats["text"],
              "Contents": f"Error occurred while running script-JiraListTransition because could not get \"dbotMirrorId\" from incident."}
      except Exception as ex:
          output = {"Type": entryTypes["error"], "ContentsFormat": formats["text"],
                    "Contents": "Error occurred while running script-JiraListTransition. got the next error:\n" + str(
                        ex)}
      finally:
          demisto.results(output)


  if __name__ in ["__main__", "builtin", "builtins"]:
      main()
type: python
tags:
- field-display
enabled: true
scripttarget: 0
subtype: python3
runonce: false
dockerimage: demisto/python3:3.9.2.17246
fromversion: 5.0.0
comment: |-
  This script lists all possible transitions for a given issue.
runas: DBotWeakRole
