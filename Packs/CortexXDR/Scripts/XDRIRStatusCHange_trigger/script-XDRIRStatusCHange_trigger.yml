comment: An automatic trigger to run a playbook and re-open the incident in the case of an alert addition.
commonfields:
  id: XDRIRStatusCHange_trigger
  version: -1
name: XDRIRStatusCHange_trigger
script: >
  register_module_line('XDRIRStatusCHange_trigger', 'start', __line__())

  ### pack version: 5.1.4





  ''' STANDALONE FUNCTION '''



  def trigger_playbook():
      incident_id = demisto.incidents()[0].get('id')
      demisto.info(f"Attempting to reopen IncidentSeverity {incident_id}")
      demisto.executeCommand("reopenInvestigation", {"id": incident_id})
      # playbook_to_run = "Cortex XDR incident handling v3"
      # demisto.info(f"Attempting to run the playbook {playbook_to_run}")
      # demisto.executeCommand("setPlaybook", {"name": playbook_to_run})


  # def reopen_incident():

  #     incident_data = demisto.incidents()[0].get('CustomFields')

  #     incident_status = incident_data.get('xdrstatus', "Resolved")

  #     demisto.info(f"The incident xdrstatus is {incident_status}")

  #     opening_entry = {}

  #     if 'resolve' in incident_status:

  #         demisto.debug(f"Opening XDR incident {incident_data.get('incident_id')}")

  #         opening_entry = {

  #             'Type': EntryType.NOTE,

  #             'Contents': {

  #                 'dbotIncidentReopen': True

  #             },

  #             'ContentsFormat': EntryFormat.JSON

  #         }

  #     if opening_entry:  # noqa: RET503

  #         return GetRemoteDataResponse(

  #             mirrored_object=incident_data,

  #             entries=[opening_entry]

  #         )



  ''' MAIN FUNCTION '''



  def main():
      demisto.info("The trigger was triggered.")
      try:
          # reopen_incident()
          trigger_playbook()
      except Exception as ex:
          return_error(f'Failed to execute XDRIRStatusCHange_trigger. Error: {str(ex)}')


  ''' ENTRY POINT '''



  if __name__ in ('__main__', '__builtin__', 'builtins'):
      main()

  register_module_line('XDRIRStatusCHange_trigger', 'end', __line__())
tags:
- basescript
- field-change-triggered
timeout: '0'
type: python
subtype: python3
dockerimage: demisto/python3:3.10.12.63474
fromversion: 5.5.0
nativeimage:
- '8.3'
