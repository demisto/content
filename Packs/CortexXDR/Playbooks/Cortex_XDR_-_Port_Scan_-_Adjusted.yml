id: Cortex XDR - Port Scan - Adjusted
version: -1
name: Cortex XDR - Port Scan - Adjusted
description: "The playbook investigates Cortex XDR incidents involving port scan alerts. The playbook is designed to run as a sub-playbook of ‘Cortex XDR Alerts Handling’. \n\nThe playbook consists of the following procedures:\n- Enrichment and investigation of the scanner and scanned hostname and IP address.\n- Enrichment and investigation of the initiator user, process, file, or command if it exists.\n- Detection of related indicators and analysis of the relationship between the detected indicators.\n- Utilize the detected indicators to conduct threat hunting.\n- Blocks detected malicious indicators.\n- Allows manual blocking of successfully scanned ports.\n- Internal scanner endpoint isolation.\n\nThis playbook supports the following Cortex XDR alert names:\n- Suspicious port scan\n- Port scan by suspicious process\n- Highly suspicious port scan\n- Port scan"
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 7c46d5ad-2e77-4213-8d84-4de23934ce23
    type: start
    task:
      id: 7c46d5ad-2e77-4213-8d84-4de23934ce23
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "101"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1780,
          "y": -960
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "101":
    id: "101"
    taskid: 56c0dce3-6475-432f-8222-3eb612f97f4d
    type: title
    task:
      id: 56c0dce3-6475-432f-8222-3eb612f97f4d
      version: -1
      name: Analysis
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "121"
      - "103"
      - "149"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1780,
          "y": -830
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "102":
    id: "102"
    taskid: 6756bd3a-2ff7-4140-8816-badf1aa7b1f9
    type: playbook
    task:
      id: 6756bd3a-2ff7-4140-8816-badf1aa7b1f9
      version: -1
      name: Account Enrichment - Generic v2.1
      description: |-
        Enrich accounts using one or more integrations.
        Supported integrations:
        - Active Directory
        - SailPoint IdentityNow
        - SailPoint IdentityIQ
        - PingOne
        - Okta
        - AWS IAM
        - Cortex XDR (account enrichment and reputation)

        Also, the playbook supports the generic command 'iam-get-user' (implemented in IAM integrations. For more information, visit https://xsoar.pan.dev/docs/integrations/iam-integrations.
      playbookName: Account Enrichment - Generic v2.1
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "109"
    scriptarguments:
      Username:
        complex:
          root: inputs.Username
          transformers:
          - operator: uniq
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1380,
          "y": -390
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "103":
    id: "103"
    taskid: 0c0ea9a0-dce5-4da7-87a5-bba2b35549e8
    type: condition
    task:
      id: 0c0ea9a0-dce5-4da7-87a5-bba2b35549e8
      version: -1
      name: Was port scanning initiated by a username?
      description: Checks whether a specific username initiated the port scanning activity.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "109"
      "yes":
      - "122"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: inputs.Username
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1550,
          "y": -690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "109":
    id: "109"
    taskid: 7aa518ff-d72e-4a43-83c7-e0627584fc29
    type: title
    task:
      id: 7aa518ff-d72e-4a43-83c7-e0627584fc29
      version: -1
      name: Containment
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "147"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1780,
          "y": 570
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "112":
    id: "112"
    taskid: 75118ba5-ef70-43e8-8fd0-345f4734c797
    type: title
    task:
      id: 75118ba5-ef70-43e8-8fd0-345f4734c797
      version: -1
      name: Investigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "134"
      - "145"
      - "176"
      - "192"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1780,
          "y": 1350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "113":
    id: "113"
    taskid: ed746e97-2f73-4656-8ef7-a5305babd03d
    type: playbook
    task:
      id: ed746e97-2f73-4656-8ef7-a5305babd03d
      version: -1
      name: Block Indicators - Generic v3
      description: |+
        This playbook blocks malicious indicators using all integrations that are enabled, using the following sub-playbooks:

        - Block URL - Generic v2
        - Block Account - Generic v2
        - Block IP - Generic v3
        - Block File - Generic v2
        - Block Email - Generic v2
        - Block Domain - Generic v2

      playbookName: Block Indicators - Generic v3
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "133"
    scriptarguments:
      AutoBlockIndicators:
        simple: "True"
      AutoCommit:
        simple: "No"
      CustomBlockRule:
        simple: "True"
      CustomURLCategory:
        simple: XSOAR Remediation - Malicious URLs
      FilesToBlock:
        complex:
          root: DBotScore
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: file
          - - operator: greaterThanOrEqual
              left:
                value:
                  simple: DBotScore.Score
                iscontext: true
              right:
                value:
                  simple: "3"
          accessor: Indicator
          transformers:
          - operator: uniq
      IP:
        complex:
          root: DBotScore
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: ip
              ignorecase: true
          - - operator: greaterThanOrEqual
              left:
                value:
                  simple: DBotScore.Score
                iscontext: true
              right:
                value:
                  simple: "3"
          accessor: Indicator
          transformers:
          - operator: uniq
      InputEnrichment:
        simple: "True"
      RuleDirection:
        simple: inbound
      RuleName:
        simple: XSOAR - Block Indicators playbook - ${incident.id}
      SHA256:
        complex:
          root: DBotScore
          filters:
          - - operator: stringHasLength
              left:
                value:
                  simple: DBotScore.Indicator
                iscontext: true
              right:
                value:
                  simple: "64"
          - - operator: greaterThanOrEqual
              left:
                value:
                  simple: DBotScore.Score
                iscontext: true
              right:
                value:
                  simple: "3"
          - - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: file
            - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: hash
          accessor: Indicator
          transformers:
          - operator: uniq
      UserVerification:
        simple: "False"
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1330,
          "y": 1050
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "121":
    id: "121"
    taskid: 034add39-d2a2-46df-8207-58d2258ee440
    type: title
    task:
      id: 034add39-d2a2-46df-8207-58d2258ee440
      version: -1
      name: Network Enrichment
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "125"
      - "158"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2330,
          "y": -690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "122":
    id: "122"
    taskid: cf8e5592-f3ce-4d72-8a08-0eeaba001c94
    type: title
    task:
      id: cf8e5592-f3ce-4d72-8a08-0eeaba001c94
      version: -1
      name: Identity Enrichment
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "102"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1380,
          "y": -520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "123":
    id: "123"
    taskid: 1ea5d847-1818-4420-8804-575b6e0a6f2c
    type: playbook
    task:
      id: 1ea5d847-1818-4420-8804-575b6e0a6f2c
      version: -1
      name: IP Enrichment - Generic v2
      description: |-
        Enrich IP addresses using one or more integrations.

        - Resolve IP addresses to hostnames (DNS)
        - Provide threat information
        - Separate internal and external IP addresses
        - For internal IP addresses, get host information
      playbookName: IP Enrichment - Generic v2
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "109"
    scriptarguments:
      IP:
        complex:
          root: inputs.DstIPAddress
          transformers:
          - operator: uniq
      InternalRange:
        complex:
          root: inputs.InternalIPRanges
          transformers:
          - operator: uniq
      ResolveIP:
        simple: "True"
      UseReputationCommand:
        simple: "True"
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 2007.5,
          "y": -420
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "125":
    id: "125"
    taskid: ea0ea81e-59af-4b7a-8689-8faf389fe8d5
    type: title
    task:
      id: ea0ea81e-59af-4b7a-8689-8faf389fe8d5
      version: -1
      name: Destination IP & Host Enrichment
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "123"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2010,
          "y": -550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "128":
    id: "128"
    taskid: 9e57b28a-d1ba-4aca-8eb6-0c31b4364a88
    type: condition
    task:
      id: 9e57b28a-d1ba-4aca-8eb6-0c31b4364a88
      version: -1
      name: Any artifacts found as malicious?
      description: Checks whether any malicious artifacts should be blocked.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "112"
      "yes":
      - "113"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: greaterThanOrEqual
          left:
            value:
              complex:
                root: DBotScore
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: DBotScore.Type
                      iscontext: true
                    right:
                      value:
                        simple: IP
                    ignorecase: true
                accessor: Score
            iscontext: true
          right:
            value:
              simple: "3"
        - operator: greaterThanOrEqual
          left:
            value:
              complex:
                root: DBotScore
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: DBotScore.Type
                      iscontext: true
                    right:
                      value:
                        simple: File
                    ignorecase: true
                  - operator: isEqualString
                    left:
                      value:
                        simple: DBotScore.Type
                      iscontext: true
                    right:
                      value:
                        simple: Hash
                    ignorecase: true
                accessor: Score
            iscontext: true
          right:
            value:
              simple: "3"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1540,
          "y": 880
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "133":
    id: "133"
    taskid: f6e9fc1b-acee-424c-872c-b42f8f4f1ea6
    type: title
    task:
      id: f6e9fc1b-acee-424c-872c-b42f8f4f1ea6
      version: -1
      name: Containment Complete
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "112"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1330,
          "y": 1210
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "134":
    id: "134"
    taskid: 676497a0-9c1e-4fea-8a6b-f60219387e9e
    type: playbook
    task:
      id: 676497a0-9c1e-4fea-8a6b-f60219387e9e
      version: -1
      name: TIM - Indicator Relationships Analysis
      description: |-
        This playbook is designed to assist with a security investigation by providing an analysis of indicator relationships. The following information is included:
        - Indicators of compromise (IOCs) related to the investigation.
        - Attack patterns related to the investigation.
        - Campaigns related to the investigation.
        - IOCs associated with the identified campaigns.
        - Reports containing details on the identified campaigns.
      playbookName: TIM - Indicator Relationships Analysis
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "185"
    scriptarguments:
      Indicator:
        complex:
          root: DBotScore
          accessor: Indicator
      LimitResults:
        simple: "200"
    separatecontext: false
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1980,
          "y": 1500
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "135":
    id: "135"
    taskid: 2b4b78da-dfae-4cb4-8a6e-1858b2068389
    type: playbook
    task:
      id: 2b4b78da-dfae-4cb4-8a6e-1858b2068389
      version: -1
      name: User Investigation - Generic
      description: |-
        This playbook performs an investigation on a specific user, using queries and logs from SIEM, Identity management systems, XDR, and firewalls.

        Supported Integrations:
        -Okta
        -Splunk
        -QRadar
        -Azure Log Analytics
        -PAN-OS
        -XDR By Palo Alto Networks
      playbookName: User Investigation - Generic
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "185"
    scriptarguments:
      AzureSearchTime:
        simple: ago(3d)
      OktaSearch:
        simple: "True"
      QRadarSearchTime:
        simple: Last 3 days
      SIEMFailedLogonSearch:
        simple: "True"
      SplunkEarliestTime:
        simple: -1d
      SplunkIndex:
        simple: '*'
      SplunkLatestTime:
        simple: now
      ThreatLogSearch:
        simple: "True"
      UserEmail:
        complex:
          root: Account
          accessor: Email
          transformers:
          - operator: uniq
      Username:
        complex:
          root: inputs.Username
          transformers:
          - operator: uniq
      XDRAlertSearch:
        simple: "True"
      XDRUsernameField:
        simple: actor_effective_username
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1570,
          "y": 1660
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "140":
    id: "140"
    taskid: dcf85ced-cb7b-4ea7-8c5b-e9fa15f92b87
    type: title
    task:
      id: dcf85ced-cb7b-4ea7-8c5b-e9fa15f92b87
      version: -1
      name: Investigation - Related Indicators Hunt
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "141"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1780,
          "y": 1995
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "141":
    id: "141"
    taskid: 86934895-4874-4a7a-8935-d60faec11b25
    type: condition
    task:
      id: 86934895-4874-4a7a-8935-d60faec11b25
      version: -1
      name: Has related Indicators to hunt?
      description: Checks whether there are any indicators to hunt for.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "152"
      "yes":
      - "142"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: RelatedFiles
            iscontext: true
          right:
            value: {}
        - operator: isNotEmpty
          left:
            value:
              complex:
                root: RelatedDomains
            iscontext: true
        - operator: isNotEmpty
          left:
            value:
              complex:
                root: RelatedIPs
            iscontext: true
        - operator: isNotEmpty
          left:
            value:
              complex:
                root: RelatedURLs
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1780,
          "y": 2130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "142":
    id: "142"
    taskid: f6b64a54-4e85-4350-8a5c-375d7090a5b5
    type: playbook
    task:
      id: f6b64a54-4e85-4350-8a5c-375d7090a5b5
      version: -1
      name: Threat Hunting - Generic
      description: "This playbook enables threat hunting for IOCs in your enterprise. It currently supports the following integrations: \n- Splunk\n- Qradar\n- Pan-os \n- Cortex data lake \n- Autofocus\n- Microsoft 365 Defender"
      playbookName: Threat Hunting - Generic
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "143"
    scriptarguments:
      IPAddress:
        complex:
          root: DBotScore
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: IP
              ignorecase: true
          - - operator: greaterThanOrEqual
              left:
                value:
                  simple: DBotScore.Score
                iscontext: true
              right:
                value:
                  simple: "3"
          accessor: Indicator
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: RelatedIPs
                iscontext: true
          - operator: uniq
      InternalRange:
        complex:
          root: inputs.InternalIPRanges
      MD5:
        complex:
          root: DBotScore
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: file
              ignorecase: true
            - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: hash
              ignorecase: true
          - - operator: stringHasLength
              left:
                value:
                  simple: DBotScore.Indicator
                iscontext: true
              right:
                value:
                  simple: "32"
          - - operator: greaterThanOrEqual
              left:
                value:
                  simple: DBotScore.Score
                iscontext: true
              right:
                value:
                  simple: "3"
          accessor: Indicator
          transformers:
          - operator: uniq
      QRadarTimeFrame:
        simple: LAST 7 DAYS
      SHA1:
        complex:
          root: DBotScore
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: file
              ignorecase: true
            - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: hash
              ignorecase: true
          - - operator: stringHasLength
              left:
                value:
                  simple: DBotScore.Indicator
                iscontext: true
              right:
                value:
                  simple: "40"
          - - operator: greaterThanOrEqual
              left:
                value:
                  simple: DBotScore.Score
                iscontext: true
              right:
                value:
                  simple: "3"
          accessor: Indicator
          transformers:
          - operator: uniq
      SHA256:
        complex:
          root: DBotScore
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: file
              ignorecase: true
            - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: hash
              ignorecase: true
          - - operator: stringHasLength
              left:
                value:
                  simple: DBotScore.Indicator
                iscontext: true
              right:
                value:
                  simple: "64"
          - - operator: greaterThanOrEqual
              left:
                value:
                  simple: DBotScore.Score
                iscontext: true
              right:
                value:
                  simple: "3"
          accessor: Indicator
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: RelatedFiles
                iscontext: true
          - operator: uniq
      SplunkEarliestTime:
        simple: -7d@d
      SplunkLatestTime:
        simple: now
      URLDomain:
        complex:
          root: RelatedURLs
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: RelatedDomains
                iscontext: true
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1540,
          "y": 2300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "143":
    id: "143"
    taskid: 7df2f070-6394-4152-80ca-a485b961aaae
    type: condition
    task:
      id: 7df2f070-6394-4152-80ca-a485b961aaae
      version: -1
      name: Has hunt results?
      description: Verifies whether there are any threat hunting results.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "152"
      "yes":
      - "144"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: Splunk
            iscontext: true
          right:
            value: {}
        - operator: isNotEmpty
          left:
            value:
              complex:
                root: PANWHunting
            iscontext: true
        - operator: isNotEmpty
          left:
            value:
              complex:
                root: QRadar
            iscontext: true
        - operator: isNotEmpty
          left:
            value:
              complex:
                root: Microsoft365Defender
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1540,
          "y": 2460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "144":
    id: "144"
    taskid: 67482103-02eb-43b0-8be6-1636642362ce
    type: regular
    task:
      id: 67482103-02eb-43b0-8be6-1636642362ce
      version: -1
      name: Set hunt results true
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "152"
    scriptarguments:
      key:
        simple: HasHuntResults
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1540,
          "y": 2610
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "145":
    id: "145"
    taskid: 1f1f6c4f-2c50-4d41-8668-5dc0e95b2e21
    type: playbook
    task:
      id: 1f1f6c4f-2c50-4d41-8668-5dc0e95b2e21
      version: -1
      name: Cortex XDR - Endpoint Investigation
      description: "This playbook is part of the 'Malware Investigation And Response' pack. For more information, refer to https://xsoar.pan.dev/docs/reference/packs/malware-investigation-and-response. This playbook handles all the endpoint investigation actions available with Cortex XSOAR, including the following tasks:\n * Pre-defined MITRE Tactics\n * Host fields (Host ID)\n * Attacker fields (Attacker IP, External host)\n * MITRE techniques\n * File hash (currently, the playbook supports only SHA256)  \n\n Note: The playbook inputs enable manipulating the execution flow; read the input descriptions for details."
      playbookName: Cortex XDR - Endpoint Investigation
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "185"
    scriptarguments:
      FileSHA256:
        complex:
          root: inputs.Initiator_Process_SHA256
          transformers:
          - operator: uniq
      HuntAttacker:
        simple: "True"
      HuntByFile:
        simple: "True"
      HuntByHost:
        simple: "True"
      HuntCnCTechniques:
        simple: "True"
      HuntCollectionTechniques:
        simple: "True"
      HuntDefenseEvasionTechniques:
        simple: Fale
      HuntDiscoveryTechniques:
        simple: "True"
      HuntExecutionTechniques:
        simple: "True"
      HuntImpactTechniques:
        simple: "False"
      HuntInitialAccessTechniques:
        simple: Fale
      HuntLateralMovementTechniques:
        simple: "True"
      HuntPersistenceTechniques:
        simple: "False"
      HuntPrivilegeEscalationTechniques:
        simple: "True"
      HuntReconnaissanceTechniques:
        simple: "True"
      RunAll:
        simple: Fale
      agentID:
        complex:
          root: inputs.EndpointID
      attackerExternalHost:
        complex:
          root: inputs.SrcHostname
          transformers:
          - operator: uniq
      attackerRemoteIP:
        complex:
          root: inputs.SrcIPAddress
          transformers:
          - operator: uniq
      timeRange:
        simple: 6 hours ago
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 2387.5,
          "y": 1500
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "147":
    id: "147"
    taskid: 47ee517a-0c40-412c-8994-ee0c69ccc564
    type: condition
    task:
      id: 47ee517a-0c40-412c-8994-ee0c69ccc564
      version: -1
      name: Early containment enabled?
      description: Checks whether early containment is enabled for this playbook before executing containment.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "112"
      "yes":
      - "128"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.EarlyContainment
            iscontext: true
          right:
            value:
              simple: "true"
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1780,
          "y": 700
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "149":
    id: "149"
    taskid: 57d07af1-54fd-433d-884d-eded8e8f2453
    type: condition
    task:
      id: 57d07af1-54fd-433d-884d-eded8e8f2453
      version: -1
      name: Was port scanning initiated by a process?
      description: Checks whether a process initiated the port scanning activity.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "109"
      "yes":
      - "151"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: inputs.Initiator_Process_SHA256
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 960,
          "y": -690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "150":
    id: "150"
    taskid: a53126c1-bd98-4d1f-86c1-c75c8191f164
    type: playbook
    task:
      id: a53126c1-bd98-4d1f-86c1-c75c8191f164
      version: -1
      name: File Enrichment - Generic v2
      description: |-
        Enrich a file using one or more integrations.

        - Provide threat information
      playbookName: File Enrichment - Generic v2
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "109"
    scriptarguments:
      SHA256:
        complex:
          root: inputs.Initiator_Process_SHA256
      UseReputationCommand:
        simple: "True"
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 10
      max: 100
      forEach: true
    view: |-
      {
        "position": {
          "x": 790,
          "y": -390
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "151":
    id: "151"
    taskid: 5294a392-a72d-458e-8f90-41b73cc394b7
    type: title
    task:
      id: 5294a392-a72d-458e-8f90-41b73cc394b7
      version: -1
      name: File Enrichment
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "150"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 790,
          "y": -520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "152":
    id: "152"
    taskid: 78a08737-3646-48d0-8857-8fd5688dbd67
    type: title
    task:
      id: 78a08737-3646-48d0-8857-8fd5688dbd67
      version: -1
      name: Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "179"
      - "177"
      - "186"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1780,
          "y": 2785
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "157":
    id: "157"
    taskid: 5ad713e5-65eb-41d6-8c32-5689246a9154
    type: regular
    task:
      id: 5ad713e5-65eb-41d6-8c32-5689246a9154
      version: -1
      name: Check if attacker IP is within Internal Range
      description: Returns yes if the IP is in one of the ranges provided, returns no otherwise.
      scriptName: IsIPInRanges
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "162"
    scriptarguments:
      ip:
        complex:
          root: inputs.SrcIPAddress
          transformers:
          - operator: uniq
      ipRanges:
        complex:
          root: inputs.InternalIPRanges
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2670,
          "y": -420
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    fieldMapping:
    - incidentfield: Scan Source Type
      output:
        complex:
          root: IP
          accessor: InRange
          transformers:
          - operator: If-Then-Else
            args:
              condition:
                value:
                  simple: lhs==rhs
              conditionB: {}
              conditionInBetween: {}
              else:
                value:
                  simple: External
              equals: {}
              lhs:
                value:
                  simple: IP.InRange
                iscontext: true
              lhsB: {}
              options: {}
              optionsB: {}
              rhs:
                value:
                  simple: "yes"
              rhsB: {}
              then:
                value:
                  simple: Internal
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "158":
    id: "158"
    taskid: 3c0af0f3-57e5-4652-8049-80bf8b1c26fb
    type: title
    task:
      id: 3c0af0f3-57e5-4652-8049-80bf8b1c26fb
      version: -1
      name: Source IP & Host Enrichment
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "157"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2670,
          "y": -550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "162":
    id: "162"
    taskid: 4ad363da-c8b5-489b-86bb-57995d9fae02
    type: condition
    task:
      id: 4ad363da-c8b5-489b-86bb-57995d9fae02
      version: -1
      name: Attacker IP is Internal or External?
      description: Checks whether the attacker IP address is internal or external.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      External:
      - "164"
      Internal:
      - "163"
    separatecontext: false
    conditions:
    - label: Internal
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: IP
                accessor: InRange
            iscontext: true
          right:
            value:
              simple: "yes"
          ignorecase: true
    - label: External
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: IP
                accessor: InRange
            iscontext: true
          right:
            value:
              simple: "no"
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2670,
          "y": -260
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "163":
    id: "163"
    taskid: 9cc404c8-b73f-4203-845f-1046fe3bca07
    type: title
    task:
      id: 9cc404c8-b73f-4203-845f-1046fe3bca07
      version: -1
      name: Internal Source IP
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "167"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2880,
          "y": -90
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "164":
    id: "164"
    taskid: f29ff3cb-5572-4c4b-8fa1-3265f780f954
    type: title
    task:
      id: f29ff3cb-5572-4c4b-8fa1-3265f780f954
      version: -1
      name: External Source IP
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "184"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2470,
          "y": -90
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "167":
    id: "167"
    taskid: d1f84c37-e465-4b8d-80ac-e669d0e4d17f
    type: playbook
    task:
      id: d1f84c37-e465-4b8d-80ac-e669d0e4d17f
      version: -1
      name: IP Enrichment - Internal - Generic v2
      playbookName: IP Enrichment - Internal - Generic v2
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "168"
    scriptarguments:
      IP:
        complex:
          root: inputs.SrcIPAddress
          transformers:
          - operator: uniq
      InternalRange:
        complex:
          root: inputs.InternalIPRanges
      ResolveIP:
        simple: "True"
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 2880,
          "y": 40
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "168":
    id: "168"
    taskid: 77cf6729-2a97-4ada-888a-9b9c4072fb74
    type: regular
    task:
      id: 77cf6729-2a97-4ada-888a-9b9c4072fb74
      version: -1
      name: Get time
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "169"
    scriptarguments:
      contextKey:
        simple: Time
      dateFormat:
        simple: UTC
      daysAgo:
        simple: "3"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2880,
          "y": 205
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "169":
    id: "169"
    taskid: ab3b62a3-b0c8-430b-8cec-426a60f660d5
    type: condition
    task:
      id: ab3b62a3-b0c8-430b-8cec-426a60f660d5
      version: -1
      name: Source endpoint is new?
      description: "Checks whether the source endpoint is new on the network\nNew endpoints that use multiple ports can cause a false positive port scan alerts. "
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "109"
      "yes":
      - "170"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isAfter
          left:
            value:
              complex:
                root: PaloAltoNetworksXDR.Endpoint
                accessor: first_seen
            iscontext: true
          right:
            value:
              complex:
                root: Time
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2880,
          "y": 370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "170":
    id: "170"
    taskid: 92e84ec7-6773-4e5d-8eac-f2775eca8cdc
    type: title
    task:
      id: 92e84ec7-6773-4e5d-8eac-f2775eca8cdc
      version: -1
      name: False Positive
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "180"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2880,
          "y": 550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "176":
    id: "176"
    taskid: d9581aa7-edf0-4159-8913-dbe1b9578028
    type: playbook
    task:
      id: d9581aa7-edf0-4159-8913-dbe1b9578028
      version: -1
      name: Command-Line Analysis
      description: "This playbook takes a command line from the alert and performs the following actions:\n- Checks for base64 string and decodes if exists\n- Extracts and enriches indicators from the command line\n- Checks specific arguments for malicious usage \n\nAt the end of the playbook, it sets a possible verdict for the command line, based on the finding:\n1. Indicators found in the command line\n2. Found AMSI techniques\n3. Found suspicious parameters\n4. Usage of malicious tools\n5. Indication of network activity\n6. Indication of suspicious LOLBIN execution\n\nNote: In case you are wishing to run this playbook with a list of command lines, set this playbook to be running in a loop. To do so, navigate to the 'Loop'  and check \"For Each Input\"."
      playbookName: Command-Line Analysis
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "185"
    scriptarguments:
      Commandline:
        complex:
          root: inputs.Initiator_CMD
          transformers:
          - operator: uniq
      StringSimilarityThreshold:
        simple: "0.5"
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1170,
          "y": 1500
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "177":
    id: "177"
    taskid: 1d4bd3f6-ed02-4d93-8f90-bb994c05adf2
    type: playbook
    task:
      id: 1d4bd3f6-ed02-4d93-8f90-bb994c05adf2
      version: -1
      name: Block Indicators - Generic v3
      description: |+
        This playbook blocks malicious indicators using all integrations that are enabled, using the following sub-playbooks:

        - Block URL - Generic v2
        - Block Account - Generic v2
        - Block IP - Generic v3
        - Block File - Generic v2
        - Block Email - Generic v2
        - Block Domain - Generic v2

      playbookName: Block Indicators - Generic v3
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "180"
    scriptarguments:
      AutoBlockIndicators:
        simple: "True"
      AutoCommit:
        simple: "No"
      CustomBlockRule:
        simple: "True"
      CustomURLCategory:
        simple: XSOAR Remediation - Malicious URLs
      DomainToBlock:
        complex:
          root: DBotScore
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: domain
          - - operator: greaterThanOrEqual
              left:
                value:
                  simple: DBotScore.Score
                iscontext: true
              right:
                value:
                  simple: "3"
          accessor: Indicator
          transformers:
          - operator: uniq
      EmailToBlock:
        complex:
          root: DBotScore
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: email
          - - operator: greaterThanOrEqual
              left:
                value:
                  simple: DBotScore.Score
                iscontext: true
              right:
                value:
                  simple: "3"
          accessor: Indicator
          transformers:
          - operator: uniq
      FilesToBlock:
        complex:
          root: DBotScore.Indicator
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: file
          - - operator: greaterThanOrEqual
              left:
                value:
                  simple: DBotScore.Score
                iscontext: true
              right:
                value:
                  simple: "3"
          - - operator: notIn
              left:
                value:
                  simple: DBotScore.Indicator
                iscontext: true
              right:
                value:
                  simple: IndicatorsToBlock
                iscontext: true
          transformers:
          - operator: uniq
      IP:
        complex:
          root: DBotScore.Indicator
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: ip
              ignorecase: true
          - - operator: greaterThanOrEqual
              left:
                value:
                  simple: DBotScore.Score
                iscontext: true
              right:
                value:
                  simple: "3"
          - - operator: notIn
              left:
                value:
                  simple: DBotScore.Indicator
                iscontext: true
              right:
                value:
                  simple: IndicatorsToBlock
                iscontext: true
          transformers:
          - operator: uniq
      InputEnrichment:
        simple: "True"
      MD5:
        complex:
          root: DBotScore.Indicator
          filters:
          - - operator: stringHasLength
              left:
                value:
                  simple: DBotScore.Indicator
                iscontext: true
              right:
                value:
                  simple: "32"
          - - operator: greaterThanOrEqual
              left:
                value:
                  simple: DBotScore.Score
                iscontext: true
              right:
                value:
                  simple: "3"
          - - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: file
            - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: hash
          transformers:
          - operator: uniq
      RuleDirection:
        simple: inbound
      RuleName:
        simple: XSOAR - Block Indicators playbook - ${incident.id}
      SHA256:
        complex:
          root: DBotScore.Indicator
          filters:
          - - operator: stringHasLength
              left:
                value:
                  simple: DBotScore.Indicator
                iscontext: true
              right:
                value:
                  simple: "64"
          - - operator: greaterThanOrEqual
              left:
                value:
                  simple: DBotScore.Score
                iscontext: true
              right:
                value:
                  simple: "3"
          - - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: file
            - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: hash
          - - operator: notIn
              left:
                value:
                  simple: DBotScore.Indicator
                iscontext: true
              right:
                value:
                  simple: IndicatorsToBlock
                iscontext: true
          transformers:
          - operator: uniq
      URL:
        complex:
          root: DBotScore
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: url
              ignorecase: true
          - - operator: greaterThanOrEqual
              left:
                value:
                  simple: DBotScore.Score
                iscontext: true
              right:
                value:
                  simple: "3"
          accessor: Indicator
          transformers:
          - operator: uniq
      UserVerification:
        simple: "False"
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1997.5,
          "y": 2930
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "178":
    id: "178"
    taskid: 00f2a63f-7fff-4891-8571-7708001fd21c
    type: playbook
    task:
      id: 00f2a63f-7fff-4891-8571-7708001fd21c
      version: -1
      name: Cortex XDR - Isolate Endpoint
      description: This playbook accepts an XDR endpoint ID and isolates it using the 'Palo Alto Networks Cortex XDR - Investigation and Response' integration.
      playbookName: Cortex XDR - Isolate Endpoint
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "180"
    scriptarguments:
      endpoint_id:
        complex:
          root: inputs.EndpointID
          transformers:
          - operator: uniq
      hostname:
        complex:
          root: inputs.SrcHostname
          transformers:
          - operator: uniq
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1590,
          "y": 3100
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "179":
    id: "179"
    taskid: 8ee22451-bbe8-48cf-8dc3-f28f113cc093
    type: condition
    task:
      id: 8ee22451-bbe8-48cf-8dc3-f28f113cc093
      version: -1
      name: Should isolate endpoint?
      description: 'Determines whether the endpoint should be isolated by examining the results of the investigation stage. '
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "180"
      "yes":
      - "178"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: PortScan
                accessor: Investigation_Results
            iscontext: true
          right:
            value: {}
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.AutoIsolateEndpoint
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1590,
          "y": 2930
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "180":
    id: "180"
    taskid: b20f1501-ea86-4987-86a8-1884b8155fdd
    type: title
    task:
      id: b20f1501-ea86-4987-86a8-1884b8155fdd
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1800,
          "y": 3560
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "184":
    id: "184"
    taskid: 45bfd8b3-b384-4372-8555-70783a63b8a6
    type: playbook
    task:
      id: 45bfd8b3-b384-4372-8555-70783a63b8a6
      version: -1
      name: IP Enrichment - Generic v2
      description: |-
        Enrich IP addresses using one or more integrations.

        - Resolve IP addresses to hostnames (DNS)
        - Provide threat information
        - Separate internal and external IP addresses
        - For internal IP addresses, get host information
      playbookName: IP Enrichment - Generic v2
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "109"
    scriptarguments:
      IP:
        complex:
          root: inputs.SrcIPAddress
          transformers:
          - operator: uniq
      InternalRange:
        complex:
          root: inputs.InternalIPRanges
          transformers:
          - operator: uniq
      ResolveIP:
        simple: "True"
      UseReputationCommand:
        simple: "True"
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 2470,
          "y": 40
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "185":
    id: "185"
    taskid: 6e00ff29-32c1-4941-8225-6268ad258119
    type: regular
    task:
      id: 6e00ff29-32c1-4941-8225-6268ad258119
      version: -1
      name: Has investigation results?
      description: 'Checks whether any results have been obtained from the investigation stage. When results have been obtained for the investigation stage, the task will set the results under a new context key. '
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "140"
    scriptarguments:
      key:
        simple: PortScan.Investigation_Results
      value:
        complex:
          root: PaloAltoNetworksXDR
          accessor: Alert
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: RelatedAttackPatterns
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: RelatedCampaign
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: PaloAltoNetworksXDR.Alert
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: QRadar.Search.Result
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: Splunk.Result
                iscontext: true
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1780,
          "y": 1830
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "186":
    id: "186"
    taskid: b22a846a-1b15-4dec-86c9-c12d160ff874
    type: title
    task:
      id: b22a846a-1b15-4dec-86c9-c12d160ff874
      version: -1
      name: Port Blocking
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "188"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1110,
          "y": 2930
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "188":
    id: "188"
    taskid: 62fe8dc2-18f9-4ef7-8eaa-d20a3d45dfe8
    type: condition
    task:
      id: 62fe8dc2-18f9-4ef7-8eaa-d20a3d45dfe8
      version: -1
      name: Were ports scanned successfully?
      description: Checks whether the ports have been accessed.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "189"
      "yes":
      - "190"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: notContainsGeneral
          left:
            value:
              complex:
                root: PaloAltoNetworksXDR.Incident.alerts
                accessor: action
            iscontext: true
          right:
            value:
              simple: Detected
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1110,
          "y": 3060
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "189":
    id: "189"
    taskid: c942fd8e-0fb7-4e23-8ad6-723e85e44c8b
    type: title
    task:
      id: c942fd8e-0fb7-4e23-8ad6-723e85e44c8b
      version: -1
      name: Port Blocking Unneeded
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "180"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 710,
          "y": 3235
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "190":
    id: "190"
    taskid: 271044fd-ad74-4b93-852a-33c398992855
    type: regular
    task:
      id: 271044fd-ad74-4b93-852a-33c398992855
      version: -1
      name: Save scanned ports
      description: |-
        Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.10/Cortex-XSOAR-Administrator-Guide/Automations
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "191"
    scriptarguments:
      key:
        simple: PortScan.PortsToBlock
      value:
        complex:
          root: inputs.DstPort
          filters:
          - - operator: notIn
              left:
                value:
                  simple: inputs.DstPort
                iscontext: true
              right:
                value:
                  simple: inputs.WhitelistedPorts
                iscontext: true
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1110,
          "y": 3220
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "191":
    id: "191"
    taskid: 6ada0cf2-e44a-4227-8a88-67cb56efe827
    type: regular
    task:
      id: 6ada0cf2-e44a-4227-8a88-67cb56efe827
      version: -1
      name: Block scanned ports
      description: |+
        Manually block the following scanned ports:
        ${PortScan.PortsToBlock}

      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "180"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1110,
          "y": 3385
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "192":
    id: "192"
    taskid: 843dff09-5740-4a44-83dc-67ab61cf9376
    type: condition
    task:
      id: 843dff09-5740-4a44-83dc-67ab61cf9376
      version: -1
      name: Has user to investigate?
      description: 'Checks whether an initiator username is available for investigation. '
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "185"
      "yes":
      - "135"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: inputs.Username
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1570,
          "y": 1500
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "103_109_#default#": 0.11,
      "128_112_#default#": 0.14,
      "143_144_yes": 0.66,
      "149_109_#default#": 0.1,
      "162_163_Internal": 0.48,
      "162_164_External": 0.51,
      "169_170_yes": 0.57,
      "179_180_#default#": 0.42,
      "192_185_#default#": 0.54
    },
    "paper": {
      "dimensions": {
        "height": 4585,
        "width": 2550,
        "x": 710,
        "y": -960
      }
    }
  }
inputs:
- key: WhitelistedPorts
  value: {}
  required: false
  description: A list of comma-separated ports that should not be blocked even if used in an attack.
  playbookInputQuery:
- key: InternalIPRanges
  value: {}
  required: true
  description: 'A list of IP ranges to check the IP against. The list should be provided in CIDR notation, separated by commas. An example of a list of ranges would be: "172.16.0.0/12,10.0.0.0/8,192.168.0.0/16" (without quotes). If a list is not provided, will use default list provided in the IsIPInRanges script (the known IPv4 private address ranges).'
  playbookInputQuery:
- key: Username
  value:
    complex:
      root: PaloAltoNetworksXDR.Incident.alerts
      accessor: user_name
      transformers:
      - operator: uniq
  required: false
  description: The user name used for port scanning.
  playbookInputQuery:
- key: SrcIPAddress
  value:
    complex:
      root: PaloAltoNetworksXDR.Incident.alerts
      accessor: action_local_ip
      transformers:
      - operator: uniq
  required: false
  description: 'The source IP address from which the port scanning was initiated.'
  playbookInputQuery:
- key: DstIPAddress
  value:
    complex:
      root: PaloAltoNetworksXDR.Incident.alerts
      accessor: action_remote_ip
      transformers:
      - operator: uniq
  required: false
  description: Scanned destination IP address.
  playbookInputQuery:
- key: DstPort
  value:
    complex:
      root: PaloAltoNetworksXDR.Incident.alerts
      accessor: action_remote_port
      transformers:
      - operator: uniq
  required: false
  description: Scanned port numbers.
  playbookInputQuery:
- key: EarlyContainment
  value:
    simple: "True"
  required: true
  description: |-
    Whether early containment should be allowed when the IP address is known to be malicious.
    Possible values:True/False. Default:True.
  playbookInputQuery:
- key: SrcHostname
  value:
    complex:
      root: PaloAltoNetworksXDR.Incident.alerts
      accessor: host_name
      transformers:
      - operator: append
        args:
          item:
            value:
              simple: PaloAltoNetworksXDR.Incident.alerts.action_external_hostname
            iscontext: true
      - operator: uniq
  required: false
  description: |-
    Source host name from which port scanning was initiated.
  playbookInputQuery:
- key: EndpointID
  value:
    complex:
      root: PaloAltoNetworksXDR.Incident.alerts
      filters:
      - - operator: containsGeneral
          left:
            value:
              simple: PaloAltoNetworksXDR.Incident.alerts.name
            iscontext: true
          right:
            value:
              simple: port scan
          ignorecase: true
      accessor: endpoint_id
      transformers:
      - operator: uniq
  required: false
  description: Source endpoint ID from which port scanning was initiated.
  playbookInputQuery:
- key: Initiator_CMD
  value:
    complex:
      root: PaloAltoNetworksXDR.Incident.alerts
      accessor: action_process_image_command_line
      transformers:
      - operator: append
        args:
          item:
            value:
              simple: PaloAltoNetworksXDR.Incident.alerts.causality_actor_process_command_line
            iscontext: true
      - operator: uniq
  required: false
  description: The command used to initiate port scan activity.
  playbookInputQuery:
- key: Initiator_Process_SHA256
  value:
    complex:
      root: PaloAltoNetworksXDR.Incident.alerts
      accessor: action_process_image_sha256
      transformers:
      - operator: append
        args:
          item:
            value:
              simple: PaloAltoNetworksXDR.Incident.alerts.causality_actor_process_image_sha256
            iscontext: true
      - operator: uniq
  required: false
  description: Process SHA256 file hash initiated port scanning.
  playbookInputQuery:
- key: AutoIsolateEndpoint
  value:
    simple: "False"
  required: true
  description: Whether to automatically isolate endpoints.
  playbookInputQuery:
outputs:
- contextPath: PortScan.BlockPorts
  description: Indicates whether there's a need to block the ports used for exploitation on the scanned host.
  type: unknown
- contextPath: PortScan.AttackerIPs
  description: Attacker IPs from the port scan alert.
  type: unknown
- contextPath: PortScan.AttackerHostnames
  description: Attacker hostnames from the port scan alert.
  type: unknown
- contextPath: PortScan.AttackerUsername
  description: Attacker username from the port scan alert.
  type: unknown
- contextPath: PortScan.FileArtifacts
  description: File artifacts from the port scan alert.
  type: unknown
- contextPath: PortScan.LateralMovementFirstDatetime
  description: Lateral Movement First Date time from the port scan alert.
  type: unknown
- contextPath: PortScan.PortScanFirstDatetime
  description: Port Scan First Date time
  type: unknown
tests:
- Test XDR Playbook general commands
- Test Playbook - Cortex XDR - Endpoint Investigation
- Test XDR Playbook
fromversion: 5.0.0
contentitemexportablefields:
  contentitemfields: {}