id: Cortex XDR - Malware Investigation
version: -1
name: Cortex XDR - Malware Investigation
description: |
  Investigates a Cortex XDR incident containing internal malware alerts. The playbook:
  - Enriches the infected endpoint details.
  - Lets the analyst manually retrieve the malicious file.
  - Performs file detonation.

  The playbook is used as a sub- playbook in ‘Cortex XDR Incident Handling - v2’
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 7013d486-d71b-4117-8551-801797af55ca
    type: start
    task:
      id: 7013d486-d71b-4117-8551-801797af55ca
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "27"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1150
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "5":
    id: "5"
    taskid: 6496fddc-17e5-49d0-8dcc-2372d4b75188
    type: title
    task:
      id: 6496fddc-17e5-49d0-8dcc-2372d4b75188
      version: -1
      name: File Detonation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "98"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1610
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "27":
    id: "27"
    taskid: ff288863-5690-432a-86ca-3a86d8350faa
    type: title
    task:
      id: ff288863-5690-432a-86ca-3a86d8350faa
      version: -1
      name: Endpoint Enrichment
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "91"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1295
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "45":
    id: "45"
    taskid: 497f868b-82fa-42ab-870f-0af527f51cc1
    type: title
    task:
      id: 497f868b-82fa-42ab-870f-0af527f51cc1
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2090
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "91":
    id: "91"
    taskid: 638288f3-a778-44ea-80fe-8bc2f2eda778
    type: regular
    task:
      id: 638288f3-a778-44ea-80fe-8bc2f2eda778
      version: -1
      name: Cortex XDR - get endpoints
      description: Gets a list of endpoints, according to the passed filters. Filtering
        by multiple fields should be concatenated using the AND condition (OR is not supported).
        Maximum result set size is 100. Offset is the zero-based number of endpoint
        from the start of the result set (start by counting from 0).
      script: Cortex XDR - IR|||xdr-get-endpoints
      type: regular
      iscommand: true
      brand: Cortex XDR - IR
    nexttasks:
      '#none#':
      - "5"
    scriptarguments:
      alias_name: {}
      dist_name: {}
      endpoint_id_list: {}
      first_seen_gte: {}
      first_seen_lte: {}
      group_name: {}
      hostname: {}
      ip_list:
        complex:
          root: inputs.host_ip
      isolate: {}
      last_seen_gte: {}
      last_seen_lte: {}
      limit: {}
      page: {}
      platform: {}
      sort_by: {}
      sort_order: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1440
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "98":
    id: "98"
    taskid: 2e3adef2-12c8-49fc-8963-78b8f0cf4295
    type: condition
    task:
      id: 2e3adef2-12c8-49fc-8963-78b8f0cf4295
      version: -1
      name: Manual - Retrieve file from XDR?
      description: "Manual - Retrieve file from XDR to perform file detonation."
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "45"
      "yes":
      - "111"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1750
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "111":
    id: "111"
    taskid: 511dc88b-b3ce-4b77-838f-dfbe2d911e27
    type: playbook
    task:
      id: 511dc88b-b3ce-4b77-838f-dfbe2d911e27
      version: -1
      name: Detonate File - Generic
      playbookName: Detonate File - Generic
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "45"
    separatecontext: true
    view: |-
      {
        "position": {
          "x": 720,
          "y": 1920
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
view: |-
  {
    "linkLabelsPosition": {
      "98_45_no": 0.52
    },
    "paper": {
      "dimensions": {
        "height": 1005,
        "width": 620,
        "x": 480,
        "y": 1150
      }
    }
  }
inputs:
- key: xdr_alert_id
  value: {}
  required: false
  description: Unique ID for the XDR alert.
  playbookInputQuery:
- key: host_ip
  value: {}
  required: false
  description: Host IP involved in the alert.
  playbookInputQuery:
- key: file_name
  value: {}
  required: false
  description: The name of the malicious file.
  playbookInputQuery:
- key: file_sha256
  value: {}
  required: false
  description: SHA-256 hash of the file.
  playbookInputQuery:
outputs:
- contextPath: Joe.Analysis
  description: The Analysis object
  type: unknown
- contextPath: File
  description: The File's object.
  type: unknown
- contextPath: File.Malicious
  description: The malicious file's description.
  type: unknown
- contextPath: DBotScore
  description: The indicator's object.
  type: unknown
- contextPath: IP
  description: IP objects.
  type: unknown
- contextPath: DBotScore.Malicious
  description: Dbot Score malicious information.
  type: unknown
- contextPath: Sample
  description: Sample data object.
  type: unknown
- contextPath: InfoFile
  description: The report file's object.
  type: unknown
- contextPath: WildFire
  description: Wildfire analysis object.
  type: unknown
- contextPath: WildFire.Report
  description: The submission object.
  type: unknown
- contextPath: Joe
  description: Joe Sandbox analysis object.
  type: unknown
- contextPath: Cuckoo.Task
  description: Cuckoo task object.
  type: unknown
- contextPath: SNDBOX.Analysis
  description: SNDBOX analysis.
  type: unknown
- contextPath: HybridAnalysis.Submit
  description: The HybridAnalysis object
  type: unknown
- contextPath: ANYRUN.Task
  description: ANYRUN task object.
  type: unknown
- contextPath: ANYRUN.Task.Behavior
  description: ANYRUN task behavior.
  type: unknown
- contextPath: ANYRUN.Task.Connection
  description: ANYRUN task connection.
  type: unknown
- contextPath: ANYRUN.Task.DnsRequest
  description: ANYRUN task DNS request.
  type: unknown
- contextPath: ANYRUN.Task.Threat
  description: ANYRUN task threat.
  type: unknown
- contextPath: ANYRUN.Task.HttpRequest
  description: ANYRUN task HTTP request.
  type: unknown
- contextPath: ANYRUN.Task.Process
  description: ANYRUN task process information.
  type: unknown
- contextPath: ANYRUN.Task.Process.Version
  description: ANYRUN task process version.
  type: unknown
tests:
- No test.
fromversion: 5.0.0
