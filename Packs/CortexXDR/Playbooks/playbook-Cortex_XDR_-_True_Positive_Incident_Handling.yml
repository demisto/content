id: Cortex XDR - True Positive Incident Handling
version: 18
contentitemexportablefields:
  contentitemfields:
    packID: CortexXDR
    packName: Palo Alto Networks Cortex XDR - Investigation and Response
    itemVersion: 4.8.19
    fromServerVersion: 6.5.0
    toServerVersion: ""
    definitionid: ""
vcShouldKeepItemLegacyProdMachine: false
name: Cortex XDR - True Positive Incident Handling
description: |-
  This playbook is part of the 'Malware Investigation And Response' pack. For more information, refer to https://xsoar.pan.dev/docs/reference/packs/malware-investigation-and-response.
  This playbook handles a true-positive incident closure for Cortex XDR - Malware Investigation.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 11349e70-efd4-44e1-8f86-8e119082bd38
    type: start
    task:
      id: 11349e70-efd4-44e1-8f86-8e119082bd38
      version: -1
      name: ""
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "79"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1770,
          "y": -1430
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: 981b2cb5-803f-4fd5-81f7-2cc7e572174c
    type: title
    task:
      id: 981b2cb5-803f-4fd5-81f7-2cc7e572174c
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1770,
          "y": 1205
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: 9a9db41f-1f81-4939-89f9-4ce77e44781a
    type: regular
    task:
      id: 9a9db41f-1f81-4939-89f9-4ce77e44781a
      version: -1
      name: Close  XSOAR incident
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      closeNotes:
        simple: ${inputs.Comment}
      closeReason:
        simple: ${inputs.Classification}
      id:
        complex:
          root: foundIncidents
          accessor: id
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: incident.id
                iscontext: true
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1770,
          "y": 1055
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: c26e3e04-894f-4d26-80d3-2f0df6074981
    type: condition
    task:
      id: c26e3e04-894f-4d26-80d3-2f0df6074981
      version: -1
      name: Approve isolation
      description: Approve isolation
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "44"
      "Yes":
      - "70"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1820,
          "y": 410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to: null
      subject: null
      body:
        simple: Approve isolation
      methods: []
      format: ""
      bcc: null
      cc: null
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: false
        completeaftersla: false
      replyOptions:
      - "Yes"
      - "No"
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: f745236a-b4e2-491f-8670-2ed157810803
    type: condition
    task:
      id: f745236a-b4e2-491f-8670-2ed157810803
      version: -1
      name: Is auto isolation allowed?
      description: Is auto isolation allowed?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "19"
      "yes":
      - "70"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.AutoIsolation
            iscontext: true
          right:
            value:
              simple: "true"
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1610,
          "y": 240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: 637d780b-eed7-458a-804f-fb5bd51d6320
    type: title
    task:
      id: 637d780b-eed7-458a-804f-fb5bd51d6320
      version: -1
      name: Incident Auditing
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "22"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2860,
          "y": -20
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: 4998e2bc-c881-419d-8248-97e0744f8bff
    type: condition
    task:
      id: 4998e2bc-c881-419d-8248-97e0744f8bff
      version: -1
      name: Is a ticketing system defined?
      description: Is a ticketing system defined?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "25"
      JIRA:
      - "57"
      SNOW:
      - "56"
    separatecontext: false
    conditions:
    - label: SNOW
      condition:
      - - operator: containsString
          left:
            value:
              simple: inputs.TicketingSystemToUse
            iscontext: true
          right:
            value:
              simple: SNOW
          ignorecase: true
        - operator: containsString
          left:
            value:
              simple: inputs.TicketingSystemToUse
            iscontext: true
          right:
            value:
              simple: ServiceNow
          ignorecase: true
    - label: JIRA
      condition:
      - - operator: containsString
          left:
            value:
              simple: inputs.TicketingSystemToUse
            iscontext: true
          right:
            value:
              simple: JIRA
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2860,
          "y": 110
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: c5403268-5531-455d-8224-2c7bacde048f
    type: title
    task:
      id: c5403268-5531-455d-8224-2c7bacde048f
      version: -1
      name: Done auditing step
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "53"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2860,
          "y": 770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: dffa5a0f-848c-4c2c-8345-c1a330cdf68e
    type: title
    task:
      id: dffa5a0f-848c-4c2c-8345-c1a330cdf68e
      version: -1
      name: Block Indicators
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "27"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -990,
          "y": 120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: dc20ccc0-debb-429b-8acd-44950a7ad521
    type: collection
    task:
      id: dc20ccc0-debb-429b-8acd-44950a7ad521
      version: -1
      name: Confirm Indicators to block
      description: Confirm Indicators to block
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "75"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -990,
          "y": 240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to: null
      subject: null
      body: null
      methods: []
      format: ""
      bcc: null
      cc: null
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: Mark the indicators to block
        required: false
        gridcolumns: []
        defaultrows: []
        type: multiSelect
        options: []
        optionsarg:
        - complex:
            root: inputs.FileSha256
            transformers:
            - operator: uniq
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      title: Indicators to block
      description: ""
      sender: ""
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: a75770e3-3c63-4198-8193-7f57e39f2234
    type: regular
    task:
      id: a75770e3-3c63-4198-8193-7f57e39f2234
      version: -1
      name: Tag Indicators
      description: commands.local.cmd.set.indicators
      script: Builtin|||setIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "30"
    scriptarguments:
      indicatorsValues:
        simple: ${Indicators to block.Answers.0}
      tags:
        simple: ${inputs.BlockTag}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1200,
          "y": 580
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: d0fccaee-9158-44ad-867d-3da0cb14a62d
    type: title
    task:
      id: d0fccaee-9158-44ad-867d-3da0cb14a62d
      version: -1
      name: Done block indicators
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "53"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -990,
          "y": 770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: 9db48d58-13dc-4d2b-8fc8-f934b8a8e61d
    type: title
    task:
      id: 9db48d58-13dc-4d2b-8fc8-f934b8a8e61d
      version: -1
      name: Isolate system/s
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1610,
          "y": 120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "44":
    id: "44"
    taskid: 0fc69008-4879-44e6-8efa-f52a037d6402
    type: title
    task:
      id: 0fc69008-4879-44e6-8efa-f52a037d6402
      version: -1
      name: Done with isolating the infected device
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "53"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1610,
          "y": 770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "53":
    id: "53"
    taskid: 415a1b04-7375-4189-82dd-48f9b54d4ff9
    type: title
    task:
      id: 415a1b04-7375-4189-82dd-48f9b54d4ff9
      version: -1
      name: Final Closure
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1770,
          "y": 920
        }
      }
    note: false
    timertriggers:
    - fieldname: containmentsla
      action: stop
    - fieldname: remediationsla
      action: stop
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "54":
    id: "54"
    taskid: e7d1c80a-7f2d-4545-8ff7-c65ea67ca265
    type: regular
    task:
      id: e7d1c80a-7f2d-4545-8ff7-c65ea67ca265
      version: -1
      name: Open Snow ticket
      description: |-
        This script is used to wrap the generic create-record command in ServiceNow.
        You can add fields that you want to create the record with as script arguments or in the
        code and work with the records easily.
      scriptName: ServiceNowCreateIncident
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "25"
    scriptarguments:
      description:
        simple: ${inputs.Comment}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3070,
          "y": 460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "55":
    id: "55"
    taskid: 05db7622-4b76-443d-8c1b-969f7ab4837b
    type: regular
    task:
      id: 05db7622-4b76-443d-8c1b-969f7ab4837b
      version: -1
      name: Open Jira ticket
      description: Creates a new issue in Jira.
      script: '|||jira-create-issue'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "25"
    scriptarguments:
      projectName:
        simple: ${inputs.TicketProjectName}
      summary:
        simple: ${inputs.Comment}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2650,
          "y": 460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "56":
    id: "56"
    taskid: 741f883d-a6f0-408a-89fe-f326e39cc9da
    type: condition
    task:
      id: 741f883d-a6f0-408a-89fe-f326e39cc9da
      version: -1
      name: Is ServiceNow Available?
      description: Returns 'yes' if integration brand is available. Otherwise returns
        'no'
      scriptName: IsIntegrationAvailable
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "25"
      "yes":
      - "54"
    scriptarguments:
      brandname:
        simple: ServiceNow v2
    results:
    - brandInstances
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3070,
          "y": 280
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "57":
    id: "57"
    taskid: b6bda6ab-a83f-4e7d-804a-7c7c255db9d7
    type: condition
    task:
      id: b6bda6ab-a83f-4e7d-804a-7c7c255db9d7
      version: -1
      name: Is Jira Available?
      description: Returns 'yes' if integration brand is available. Otherwise returns
        'no'
      scriptName: IsIntegrationAvailable
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "25"
      "yes":
      - "55"
    scriptarguments:
      brandname:
        simple: jira-v2
    results:
    - brandInstances
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2650,
          "y": 280
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "64":
    id: "64"
    taskid: 48698586-b1d5-4a9a-8ed3-ee37b7e2a1ee
    type: title
    task:
      id: 48698586-b1d5-4a9a-8ed3-ee37b7e2a1ee
      version: -1
      name: Done with isolating the infected device
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "53"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2240,
          "y": 770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "66":
    id: "66"
    taskid: 084ee8e5-5651-4bf6-88ae-3360ecc1ea22
    type: title
    task:
      id: 084ee8e5-5651-4bf6-88ae-3360ecc1ea22
      version: -1
      name: Clean Malicious Files
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "74"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2240,
          "y": 120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "70":
    id: "70"
    taskid: 81b48996-c4a7-43c4-851f-77bedd1b169a
    type: playbook
    task:
      id: 81b48996-c4a7-43c4-851f-77bedd1b169a
      version: -1
      name: Cortex XDR - Isolate Endpoint
      description: This playbook accepts an XDR endpoint ID and isolates it using
        the 'Palo Alto Networks Cortex XDR - Investigation and Response' integration.
      playbookName: Cortex XDR - Isolate Endpoint
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "44"
    scriptarguments:
      endpoint_id:
        complex:
          root: inputs.HostID
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": -1610,
          "y": 580
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "71":
    id: "71"
    taskid: 480bc329-81ff-4f7e-8f55-977b58dda775
    type: playbook
    task:
      id: 480bc329-81ff-4f7e-8f55-977b58dda775
      version: -1
      name: Cortex XDR - delete file
      description: Initiates a new endpoint script execution to delete the specified
        file and retrieve the results.
      playbookName: Cortex XDR - delete file
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "64"
    scriptarguments:
      endpoint_id:
        simple: ${inputs.HostID}
      file_path:
        simple: ${Confirm which SHA1 should be deleted.Answers.0}
      polling_timeout:
        simple: "10"
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": -2030,
          "y": 580
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "72":
    id: "72"
    taskid: f46a2197-9bb8-40c4-8916-e99ca9f5e572
    type: regular
    task:
      id: f46a2197-9bb8-40c4-8916-e99ca9f5e572
      version: -1
      name: Create IOCs in Cortex XDR - Banned Hashes
      description: Block lists requested files which have not already been block listed
        or added to allow lists.
      script: '|||xdr-blocklist-files'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "30"
    scriptarguments:
      hash_list:
        simple: ${Indicators to block.Answers.0}
      incident_id:
        simple: ${incident.externalsystemid}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -780,
          "y": 580
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "74":
    id: "74"
    taskid: a796d2a1-aa24-474b-86f8-a924de9a6921
    type: collection
    task:
      id: a796d2a1-aa24-474b-86f8-a924de9a6921
      version: -1
      name: Confirm which File Path will be deleted
      description: Confirm which File Path will be deleted
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "76"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2240,
          "y": 240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to: null
      subject: null
      body: null
      methods: []
      format: ""
      bcc: null
      cc: null
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: Confirm which File Path will be deleted
        required: false
        gridcolumns: []
        defaultrows: []
        type: multiSelect
        options: []
        optionsarg:
        - simple: ${inputs.FilePaths}
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      title: Confirm which File Path will be deleted
      description: ""
      sender: ""
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "75":
    id: "75"
    taskid: feaee1c2-e038-485d-87d7-0f00dde68c1b
    type: condition
    task:
      id: feaee1c2-e038-485d-87d7-0f00dde68c1b
      version: -1
      name: Was there any hash selected?
      description: Was there any hash selected?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "30"
      "yes":
      - "29"
      - "72"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: Indicators to block.Answers.0
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -990,
          "y": 410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "76":
    id: "76"
    taskid: 910e051c-6606-49c7-85a3-9abb353c0a7c
    type: condition
    task:
      id: 910e051c-6606-49c7-85a3-9abb353c0a7c
      version: -1
      name: Was there any hash selected?
      description: Was there any hash selected?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "64"
      "yes":
      - "71"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: Confirm which File Path will be deleted.Answers.0
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2240,
          "y": 410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "77":
    id: "77"
    taskid: f3929ca1-f1fc-440b-8608-4389cf5780ba
    type: title
    task:
      id: f3929ca1-f1fc-440b-8608-4389cf5780ba
      version: -1
      name: Remediation
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "66"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2240,
          "y": -20
        }
      }
    note: false
    timertriggers:
    - fieldname: remediationsla
      action: start
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "78":
    id: "78"
    taskid: 77f60012-6352-4ecf-881f-50a16d1a519e
    type: title
    task:
      id: 77f60012-6352-4ecf-881f-50a16d1a519e
      version: -1
      name: Containment
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "26"
      - "33"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1300,
          "y": -20
        }
      }
    note: false
    timertriggers:
    - fieldname: containmentsla
      action: start
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "79":
    id: "79"
    taskid: 1a7b0178-69d8-49f9-86fa-2f8c467cea8a
    type: title
    task:
      id: 1a7b0178-69d8-49f9-86fa-2f8c467cea8a
      version: -1
      name: Threat Hunting
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "81"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1770,
          "y": -1290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "80":
    id: "80"
    taskid: f7a66394-8e43-4523-87d4-4545e9fbbc5d
    type: playbook
    task:
      id: f7a66394-8e43-4523-87d4-4545e9fbbc5d
      version: -1
      name: Threat Hunting - Generic
      description: "This playbook enables threat hunting for IOCs in your enterprise.
        It currently supports the following integrations: - Splunk\n- Qradar\n- Pan-os
        \n- Cortex data lake \n- Autofocus\n- Microsoft 365 Defender"
      playbookName: Threat Hunting - Generic
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "86"
    scriptarguments:
      IPAddress:
        complex:
          root: inputs.IP
          transformers:
          - operator: If-Then-Else
            args:
              condition:
                value:
                  simple: rhs==lhs
              else:
                value:
                  simple: Specify IOCs to hunt upon.Answers.0
                iscontext: true
              equals: {}
              lhs:
                value:
                  simple: "False"
              options: {}
              rhs:
                value:
                  simple: inputs.ManuallyChooseIOCForHunting
                iscontext: true
              then:
                value:
                  simple: inputs.IP
                iscontext: true
          - operator: uniq
      MD5:
        complex:
          root: inputs.MD5
          transformers:
          - operator: If-Then-Else
            args:
              condition:
                value:
                  simple: rhs==lhs
              else:
                value:
                  simple: Specify IOCs to hunt upon.Answers.3
                iscontext: true
              equals: {}
              lhs:
                value:
                  simple: "False"
              options: {}
              rhs:
                value:
                  simple: inputs.ManuallyChooseIOCForHunting
                iscontext: true
              then:
                value:
                  simple: inputs.MD5
                iscontext: true
          - operator: uniq
      QRadarTimeFrame:
        simple: LAST 7 DAYS
      SHA1:
        complex:
          root: inputs.FileSha1
          transformers:
          - operator: If-Then-Else
            args:
              condition:
                value:
                  simple: rhs==lhs
              else:
                value:
                  simple: Specify IOCs to hunt upon.Answers.2
                iscontext: true
              equals: {}
              lhs:
                value:
                  simple: "False"
              options: {}
              rhs:
                value:
                  simple: inputs.ManuallyChooseIOCForHunting
                iscontext: true
              then:
                value:
                  simple: inputs.FileSha1
                iscontext: true
          - operator: uniq
      SHA256:
        complex:
          root: inputs.FileSha256
          transformers:
          - operator: If-Then-Else
            args:
              condition:
                value:
                  simple: rhs==lhs
              else:
                value:
                  simple: Specify IOCs to hunt upon.Answers.1
                iscontext: true
              equals: {}
              lhs:
                value:
                  simple: "false"
              options: {}
              rhs:
                value:
                  simple: inputs.ManuallyChooseIOCForHunting
                iscontext: true
              then:
                value:
                  simple: inputs.FileSha256
          - operator: uniq
      SplunkEarliestTime:
        simple: -7d@d
      SplunkLatestTime:
        simple: now
      URLDomain:
        complex:
          root: inputs.URL_or_Domain
          transformers:
          - operator: If-Then-Else
            args:
              condition:
                value:
                  simple: rhs==lhs
              else:
                value:
                  simple: Specify IOCs to hunt upon.Answers.4
                iscontext: true
              equals: {}
              lhs:
                value:
                  simple: "False"
              options: {}
              rhs:
                value:
                  simple: inputs.ManuallyChooseIOCForHunting
                iscontext: true
              then:
                value:
                  simple: inputs.URL_or_Domain
                iscontext: true
          - operator: uniq
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": -1770,
          "y": -820
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "81":
    id: "81"
    taskid: 6523be0e-8516-40b3-8875-124ea4198fff
    type: condition
    task:
      id: 6523be0e-8516-40b3-8875-124ea4198fff
      version: -1
      name: Should the analyst choose the indicators to hunt?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "80"
      "yes":
      - "82"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.ManuallyChooseIOCForHunting
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1770,
          "y": -1160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "82":
    id: "82"
    taskid: 19985079-84e8-4e91-8551-117a0c92ce92
    type: collection
    task:
      id: 19985079-84e8-4e91-8551-117a0c92ce92
      version: -1
      name: Specify IOCs to hunt upon
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "80"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2000,
          "y": -990
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
        simple: Analyst
      subject:
        simple: Specify IOCs to hunt upon
      body: null
      methods:
      - email
      format: ""
      bcc: null
      cc: null
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: Which IPs should be hunted for?
        required: false
        gridcolumns: []
        defaultrows: []
        type: multiSelect
        options: []
        optionsarg:
        - complex:
            root: inputs.IP
            accessor: Address
            transformers:
            - operator: uniq
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      - id: "1"
        label: ""
        labelarg:
          simple: Which SHA256 files should be hunted for?
        required: false
        gridcolumns: []
        defaultrows: []
        type: multiSelect
        options: []
        optionsarg:
        - complex:
            root: inputs.FileSha256
            transformers:
            - operator: uniq
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      - id: "2"
        label: ""
        labelarg:
          simple: Which SHA1 files should be hunted for?
        required: false
        gridcolumns: []
        defaultrows: []
        type: multiSelect
        options: []
        optionsarg:
        - complex:
            root: inputs.FileSha1
            transformers:
            - operator: uniq
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      - id: "3"
        label: ""
        labelarg:
          simple: Which MD5 files should be hunted for?
        required: false
        gridcolumns: []
        defaultrows: []
        type: multiSelect
        options: []
        optionsarg:
        - complex:
            root: inputs.MD5
            transformers:
            - operator: uniq
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      - id: "4"
        label: ""
        labelarg:
          simple: Which URLs/Domains should be hunted for?
        required: false
        gridcolumns: []
        defaultrows: []
        type: multiSelect
        options: []
        optionsarg:
        - complex:
            root: inputs.URL_or_Domain
            transformers:
            - operator: uniq
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      title: Specify IOCs to hunt upon
      description: ""
      sender: ""
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "83":
    id: "83"
    taskid: d800f749-a3e8-4295-801e-b00c787ffce4
    type: title
    task:
      id: d800f749-a3e8-4295-801e-b00c787ffce4
      version: -1
      name: Done Threat Hunting
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "21"
      - "77"
      - "78"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1770,
          "y": -160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "84":
    id: "84"
    taskid: 0e528409-cd1b-4c81-89ee-07c73c8bcd2d
    type: regular
    task:
      id: 0e528409-cd1b-4c81-89ee-07c73c8bcd2d
      version: -1
      name: Tag the threat hunting results as Evidence
      description: |
        Adds provided entries to the incident Evidence Board. In playbook, can be positioned after a task to add the previous task's entries to Evidence Board automatically (with no need to provide arguments)
      scriptName: AddEvidence
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "85"
    scriptarguments:
      entryIDs:
        simple: ${lastCompletedTaskEntries}
      tags:
        simple: Threat Hunting Results
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2000,
          "y": -480
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "85":
    id: "85"
    taskid: c400f97c-ffcf-4047-8967-94478820487a
    type: regular
    task:
      id: c400f97c-ffcf-4047-8967-94478820487a
      version: -1
      name: Add 'Threat Hunting Results' tag to the incident
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "83"
    scriptarguments:
      appendTags:
        simple: "true"
      tags:
        simple: Threat Hunting Results
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2000,
          "y": -330
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "86":
    id: "86"
    taskid: 06dc62cc-6247-4803-8eb4-4dc07b0f2509
    type: condition
    task:
      id: 06dc62cc-6247-4803-8eb4-4dc07b0f2509
      version: -1
      name: Are any results?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "83"
      "yes":
      - "84"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: Splunk
            iscontext: true
        - operator: isNotEmpty
          left:
            value:
              simple: PANWHunting
            iscontext: true
        - operator: isNotEmpty
          left:
            value:
              simple: Microsoft365Defender
            iscontext: true
        - operator: isNotEmpty
          left:
            value:
              simple: QRadar
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1770,
          "y": -660
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
system: true
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 2700,
        "width": 2670,
        "x": -3070,
        "y": -1430
      }
    }
  }
inputs:
- key: Comment
  value:
    simple: 'XSOAR Incident #${incident.id}'
  required: false
  description: Add comment to close this incident.
  playbookInputQuery: null
- key: Classification
  value:
    simple: TruePositive
  required: false
  description: Choose From - "Unknown" / "TruePositive"
  playbookInputQuery: null
- key: BlockTag
  value:
    simple: BlockTag
  required: false
  description: Specify the banning tag name for founded indicators.
  playbookInputQuery: null
- key: AutoIsolation
  value:
    simple: "False"
  required: false
  description: |-
    Indicates if automatic host isolation is allowed.
    True/False
  playbookInputQuery: null
- key: TicketProjectName
  value: {}
  required: false
  description: For ticketing systems such as Jira a project name is required.
  playbookInputQuery: null
- key: TicketingSystemToUse
  value: {}
  required: false
  description: The name of the ticketing system to use, for example Jira or ServiceNow
  playbookInputQuery: null
- key: FileSha256
  value:
    complex:
      root: incident
      accessor: filesha256
      transformers:
      - operator: uniq
  required: false
  description: Enter the File Sha256 you would like to block.
  playbookInputQuery: null
- key: HostID
  value:
    simple: ${incident.deviceid}
  required: false
  description: The ID of the host for running an isolation process.
  playbookInputQuery: null
- key: FilePaths
  value:
    complex:
      root: incident
      accessor: processpaths
      transformers:
      - operator: uniq
  required: false
  description: Enter the File paths you would like to delete.
  playbookInputQuery: null
outputs: []
