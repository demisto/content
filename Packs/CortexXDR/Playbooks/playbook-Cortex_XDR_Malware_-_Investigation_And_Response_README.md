This playbook investigates Cortex XDR malware incidents. It uses:  
- Cortex XDR insights 
- Command Line Analysis 
- Dedup 
- Sandbox hash search and detonation 
- Cortex XDR enrichment - Incident Handling (true/false positive)

## Dependencies
This playbook uses the following sub-playbooks, integrations, and scripts.

### Sub-playbooks
* Cortex XDR - False Positive Incident Handling
* Cortex XDR - Endpoint Investigation
* Cortex XDR - Run script
* Cortex XDR Malware - Incident Enrichment
* Dedup - Generic v4
* Command-Line Analysis
* Search For Hash In Sandbox - Generic
* Cortex XDR - True Positive Incident Handling
* Detonate and Analyze File - Generic

### Integrations
CortexXDRIR

### Scripts
* InvestigationDetailedSummaryParse
* InvestigationSummaryParse

### Commands
* xdr-file-retrieve
* xdr-retrieve-file-details
* setIncident

## Playbook Inputs
---

| **Name** | **Description** | **Default Value** | **Required** |
| --- | --- | --- | --- |
| EnableDeduplication | Whether the deduplication playbook will be used. | False | Optional |
| AutoIsolation | Whether endpoint isolation is allowed. | False | Optional |
| RetrieveFile | Whether file retrieval from the endpoint is allowed. | True | Optional |
| TicketingSystemToUse | The name of the ticketing system to use, for example, Jira or ServiceNow. |  | Optional |
| TicketProjectName | The ticket project name (required for Jira). |  | Optional |
| MaliciousTagName | The tag to assign for indicators to block. | MaliciousTagName | Optional |
| EnableClosureSteps | Whether the indicator is closed with closure steps or automatically. | True | Optional |
| DedupSimilarTextField | A comma-separated list of incident text fields to take into account when computing similarity. For example commandline, URL. | agnetsid,users,agentsid,CMDline,Hostnames,filenames,filepaths | Optional |
| AutoUnisolation | Whether automatic un-isolation is allowed. | False | Optional |
| DedupLimit | The maximum number of incidents to query and set to context data. | 200 | Optional |
| DedupHandleSimilar | Defines how to handle Similar incidents. <br/>Possible values:<br/>* Link<br/>* Close<br/>* Link and Close<br/>Note: closing incidents requires you to define "CloseSimilar" input as well.<br/>Also, the incidents found by similar indicators or fields will be closed if their similarity score is above the CloseSimilar value.  | Link | Optional |
| DedupCloseSimilar | Defines the threshold of similarity to close a similar incident. All similar incidents with similarity above this value will be closed.<br/>   For example, if CloseSimilar is set to .8 and an incident has a similarity score of .9, the incident will be closed.<br/>The value should be between 0 and 1 [0=low similarity , 1=identical]. | 0.9 | Optional |
| DedupMinimunIncidentSimilarity | Retain incidents with a similarity score greater than the MinimunIncidentSimilarity.<br/>Value should be between 0 to 1 \[0=low similarity, 1=identical\] | 0.2 | Optional |
| BenignTagName | The name of the tag to apply for allowed indicators. | BenignTagName | Optional |
| AdvancedHunting | Whether to run Advance Hunting queries through your Cortex XDR instance by using the information on Alert Insights.<br/>Note: It may take some time. | True | Optional |
| RunAllHuntMitreTactics | Whether to run the Advanced Hunting section for all Mitre Tactics. | True | Optional |

## Playbook Outputs
---

| **Path** | **Description** | **Type** |
| --- | --- | --- |
| PaloAltoNetworksXDR.ScriptResult.results | Palo ALto Networks Script reuslts information. | unknown |

## Playbook Image
---
![Cortex XDR Malware - Investigation And Response](../doc_files/Cortex_XDR_Malware_-_Investigation_And_Response.png)
