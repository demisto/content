commonfields:
  id: Salesforce
  version: -1
name: Salesforce
display: Salesforce
category: Case Management
image: data:image/png;base64,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
description: CRM Services
detaileddescription: |-
  To set up Salesforce to work with Demisto:
  Add a new connected App in salesforce by following the instruction [here](https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/intro_defining_remote_access_applications.htm)
  If you already have a connected App, go to “Setup” -> “App Manager” -> choose the correct App from the list and press “View”.
  The Consumer Key / Secret is under “API (Enable OAuth Settings)”
  For detailed instructions see the Credentials walkthrough section at [demisto support](https://support.demisto.com/hc/en-us/articles/360001848133-Integration-Salesforce).
configuration:
- display: Instance URL
  name: InstanceURL
  defaultvalue: https://login.salesforce.com
  type: 0
  required: true
- display: Credentials
  name: credentials
  defaultvalue: ""
  type: 9
  required: true
- display: Consumer Key
  name: clientID
  defaultvalue: ""
  type: 0
  required: true
- display: Consumer Secret
  name: clientSecret
  defaultvalue: ""
  type: 4
  required: true
- display: Trust any certificate (not secure)
  name: insecure
  defaultvalue: ""
  type: 8
  required: false
- display: 'Fetch type: cases/comments (Only fetch comments when using the SalesforceAskUser automation)'
  name: fetchType
  defaultvalue: cases
  type: 0
  required: false
- display: Use system proxy settings
  name: useproxy
  defaultvalue: ""
  type: 8
  required: false
- display: Fetch incidents
  name: isFetch
  type: 8
  required: false
- display: Incident type
  name: incidentType
  type: 13
  required: false
script:
  script: >
    var URI_PREFIX = '/services/data/v39.0/';

    var SESSION_DATA = '';


    function getNewToken() {
        var request = {
            grant_type: 'password',
            client_id: params.clientID,
            client_secret: params.clientSecret,
            username: params.credentials.identifier,
            password: params.credentials.password
            };

        var body = encodeToURLQuery(request).substr(1);
        var response = http(
            params.InstanceURL + '/services/oauth2/token',
            {
                Method: 'POST',
                Headers: {'Content-Type': ['application/x-www-form-urlencoded']},
                Body: body,
            },
            params.insecure === false,
            params.useproxy
        );
        if (response.StatusCode < 200 || response.StatusCode >= 300) {
            throw 'Failed to get new token, request status code: ' + response.StatusCode + ' and Body: ' + response.Body + '.';
        }
        return JSON.parse(response.Body);
    }



    function sendRequest(method, url, body, token) {
        var headers = {};
        if (token) {
            headers['Authorization'] = ['Bearer ' + token];
        }
        if (method == 'POST' || method == 'PATCH') {
            headers['Content-Type'] = ['application/json'];
        }
        return http(
            url,
            {
                Method: method,
                Headers: headers,
                Body: body,
            },
            params.insecure === false,
            params.useproxy
        );
    }


    function sendRequestInSession(method, uri, body) {
        if (!SESSION_DATA || !SESSION_DATA.access_token) {
            throw "Faield to get access token for Salesforce integration.";
        }
        var response = sendRequest(method, SESSION_DATA.instance_url + URI_PREFIX + uri, body, SESSION_DATA.access_token);
        if (response.StatusCode === 401) {
            SESSION_DATA = getNewToken();
            response = sendRequest(method, SESSION_DATA.instance_url + URI_PREFIX + uri, body, SESSION_DATA.access_token);
        }
        if (response.StatusCode < 200 || response.StatusCode >= 300) {
                throw 'Failed to run command uri: ' + uri + ', request status code: ' + response.StatusCode + ' and Body: ' + response.Body + '.';
        }
        return response;
    }



    function getUserNames() {
        var res = queryObjects(['Id', 'Name'], 'User');
        var users = {};
        for (var i in res.records) {
            users[res.records[i].Id] = res.records[i].Name;
        }

        return users;
    }



    function commentToEntry(raw_info, title, userMapping) {
        // fix owner field
        if (userMapping) {
            for (var i in raw_info) {
                // use OwnerId if no user was found
                raw_info[i].OwnerId = userMapping[raw_info[i].OwnerId] || raw_info[i].OwnerId;
            }
        }

        return createEntry(raw_info, {
            contextPath: 'SalesForce.CaseComment(val.ID && val.ID == obj.ID)',
            title: title,
            data: [
                {to: 'ID', from: 'Id', humanReadable: false},
                {to: 'ParentId', from: 'ParentId'},
                {to: 'IsPublished', from: 'IsPublished'},
                {to: 'CommentBody', from: 'CommentBody'},
                {to: 'CreatedById', from: 'CreatedById'},
                {to: 'CreatedDate', from: 'CreatedDate'},
                {to: 'SystemModstamp', from: 'SystemModstamp'},
                {to: 'LastModifiedDate', from: 'LastModifiedDate'},
                {to: 'LastModifiedById', from: 'LastModifiedById'},
                {to: 'IsDeleted', from: 'IsDeleted'}
            ]
        });
    }



    function userToEntry(raw_info, title, userMapping) {
        // fix owner field
        if (userMapping) {
            for (var i in raw_info) {
                // use OwnerId if no user was found
                raw_info[i].OwnerId = userMapping[raw_info[i].OwnerId] || raw_info[i].OwnerId;
            }
        }

        return createEntry(raw_info, {
            contextPath: 'SalesForce.User(val.ID && val.ID == obj.ID)',
            title: title,
            data: [
                {to: 'ID', from: 'Id', humanReadable: false},
                {to: 'Alias', from: 'Alias'},
                {to: 'CommunityNickname', from: 'CommunityNickname'},
                {to: 'CreatedById', from: 'CreatedById'},
                {to: 'Email', from: 'Email'},
                {to: 'LastLoginDate', from: 'LastLoginDate'},
                {to: 'LastModifiedDate', from: 'LastModifiedDate'},
                {to: 'LastName', from: 'LastName'},
                {to: 'Name', from: 'Name'},
                {to: 'Username', from: 'Username'},
                {to: 'UserRoleId', from: 'UserRoleId'}
            ]
        });
    }



    function orgToEntry(raw_info, title, userMapping) {
        // fix owner field
        if (userMapping) {
            for (var i in raw_info) {
                // use OwnerId if no user was found
                raw_info[i].OwnerId = userMapping[raw_info[i].OwnerId] || raw_info[i].OwnerId;
            }
        }

        return createEntry(raw_info, {
            contextPath: 'SalesForce.GetOrg(val.ID && val.ID == obj.ID)',
            title: title,
            data: [
                {to: 'ID', from: 'Id', humanReadable: false},
                {to: 'Name', from: 'Name'}
            ]
        });
    }


    function casesToEntry(raw_info, title, userMapping) {
        // fix owner field
        if (userMapping) {
            for (var i in raw_info) {
                // use OwnerId if no user was found
                raw_info[i].OwnerId = userMapping[raw_info[i].OwnerId] || raw_info[i].OwnerId;
            }
        }

        return createEntry(raw_info, {
            contextPath: 'SalesForce.Case(val.ID && val.ID == obj.ID)',
            title: title,
            data: [
                {to: 'ID', from: 'Id', humanReadable: false},
                {to: 'CaseNumber', from: 'CaseNumber'},
                {to: 'Subject', from: 'Subject'},
                {to: 'Description', from: 'Description'},
                {to: 'CreatedDate', from: 'CreatedDate'},
                {to: 'ClosedDate', from: 'ClosedDate'},
                {to: 'Owner', from: 'OwnerId'},
                {to: 'Priority', from: 'Priority'},
                {to: 'Origin', from: 'Origin'},
                {to: 'Status', from: 'Status'},
                {to: 'Reason', from: 'Reason'},
                {to: 'IsEscalated', from: 'IsEscalated'},
                {to: 'SuppliedPhone', from: 'SuppliedPhone'},
                {to: 'SuppliedCompany', from: 'SuppliedCompany'},
                {to: 'SuppliedEmail', from: 'SuppliedEmail'},
                {to: 'ContactEmail', from: 'ContactEmail'},
                {to: 'ContactId', from: 'ContactId'},
                {to: 'AccountId', from: 'AccountId'},
                {to: 'Id', from: 'Id'}

            ]
        });
    }



    function contactsToEntry(raw_info, title, userMapping, accountMapping) {
        var i;
        // fix owner field
        if (userMapping) {
            for (i in raw_info) {
                // use OwnerId if no user was found
                raw_info[i].OwnerId = userMapping[raw_info[i].OwnerId] || raw_info[i].OwnerId;
            }
        }
        if (accountMapping) {
            for (i in raw_info) {
                // use AccountId if no account was found
                raw_info[i].AccountId = accountMapping[raw_info[i].AccountId] || raw_info[i].AccountId;
            }
        }

        return createEntry(raw_info, {
            contextPath: 'SalesForce.Contact(val.ID && val.ID == obj.ID)',
            title: title,
            data: [
                {to: 'ID', from: 'Id', humanReadable: false},
                {to: 'Name', from: 'Name'},
                {to: 'Account', from: 'AccountId'},
                {to: 'Title', from: 'Title'},
                {to: 'Phone', from: 'Phone'},
                {to: 'Mobile', from: 'MobilePhone'},
                {to: 'Email', from: 'Email'},
                {to: 'Owner', from: 'OwnerId'},
            ]
        });
    }


    function leadsToEntry(raw_info, title, userMapping) {
        // fix owner field
        if (userMapping) {
            for (var i in raw_info) {
                // use OwnerId if no user was found
                raw_info[i].OwnerId = userMapping[raw_info[i].OwnerId] || raw_info[i].OwnerId;
            }
        }
        return createEntry(raw_info, {
            contextPath: 'SalesForce.Lead(val.ID && val.ID == obj.ID)',
            title: title,
            data: [
                {to: 'ID', from: 'Id', humanReadable: false},
                {to: 'Name', from: 'Name'},
                {to: 'Title', from: 'Title'},
                {to: 'Company', from: 'Company'},
                {to: 'Phone', from: 'Phone'},
                {to: 'Mobile', from: 'MobilePhone'},
                {to: 'Email', from: 'Email'},
                {to: 'Owner', from: 'OwnerId'},
                {to: 'Status', from: 'Status'}
            ]
        });
    }


    function tasksToEntry(raw_info, title, lead_dict) {
        // fix owner field
        if (leadMapping) {
            for (var i in raw_info) {
                // use WhoId if no lead was found
                raw_info[i].WhoId = leadMapping[raw_info[i].WhoId] || raw_info[i].WhoId;
            }
        }

        return createEntry(raw_info, {
            contextPath: 'SalesForce.Task(val.ID && val.ID == obj.ID)',
            title: title,
            data: [
                {to: 'ID', from: 'Id', humanReadable: false},
                {to: 'Subject', from: 'Subject'},
                {to: 'Lead', from: 'WhoId'},
                {to: 'RelatedTo', from: 'RelatedTo'},
                {to: 'DueDate', from: 'ActivityDate'}
            ]
        });
    }


    function usersToEntry(raw_info, title) {
        return createEntry(raw_info, {
            contextPath: 'SalesForce.GetUsers(val.ID && val.ID == obj.ID)',
            title: title,
            data: [
                {to: 'ID', from: 'Id', humanReadable: false},
                {to: 'Name', from: 'Name'},
                {to: 'Alias', from: 'Alias'},
                {to: 'CommunityNickname', from: 'CommunityNickname'},
                {to: 'Title', from: 'Title'},
                {to: 'Phone', from: 'Phone'},
                {to: 'Email', from: 'Email'},
                {to: 'FirstName', from: 'FirstName'},
                {to: 'Username', from: 'Username'}
            ]
        });
    }


    function objectToEntry(obj_type, obj) {
        var userMapping = getUserNames();
        switch (obj_type) {
            case 'CaseComment':
                return commentToEntry([obj], 'CaseComment:', userMapping);
            case 'getOrgName':
                return orgToEntry([obj], 'getOrgName:', userMapping);
            case 'userToEntry':
                return userToEntry([obj],'getUser', userMapping);
            case 'Case':
                return casesToEntry([obj], 'Case:', userMapping);
            case 'Contact':
                accountMapping = undefined; // TODO: implement
                return contactsToEntry([obj], 'Contact:', userMapping, accountMapping);
            case 'Lead':
                return leadsToEntry([obj], 'Lead:', userMapping);
            case 'Task':
                leadMapping = undefined; // TODO: implement
                return tasksToEntry([obj], 'Lead:', leadMapping);
            case 'User':
                return usersToEntry([obj], 'User:');
            default:
                return obj;
        }
    }


    function queryToEntry(query) {
        return {
            Type : entryTypes.note,
            Contents : query.records,
            ContentsFormat: formats.json,
            ReadableContentsFormat: formats.markdown,
            HumanReadable : tableToMarkdown('Query Results', query.records)
        };
    }


    function searchToEntry(searchRecords) {
        if (searchRecords.length === 0) {
            return {
                Type : entryTypes.Note,
                Contents : 'No records matched the search.',
                // ContentsFormat: formats.json,
                ReadableContentsFormat: formats.markdown
            };
        }

        var case_ids = [];
        var contact_ids = [];
        var lead_ids = [];
        var task_ids = [];
        var user_ids = [];
        var general = [];
        var case_comment = [];
        var get_org = [];

        for (var i in searchRecords) {
            switch (searchRecords[i].attributes.type) {
                case 'CaseComment':
                    case_comment.push(searchRecords[i].Id);
                    break;
                case 'getOrgName':
                    get_org.push(searchRecords[i].Id);
                    break;
                case 'Case':
                    case_ids.push(searchRecords[i].Id);
                    break;
                case 'Contact':
                    contact_ids.push(searchRecords[i].Id);
                    break;
                case 'Lead':
                    lead_ids.push(searchRecords[i].Id);
                    break;
                case 'Task':
                    task_ids.push(searchRecords[i].Id);
                    break;
                case 'User':
                    user_ids.push(searchRecords[i].Id);
                    break;
                default:
                    // in case we don't know how to parse the object
                    general.push(searchRecords[i]);
                    break;
            }
        }

        var condition, properties;
        var entries = [];
        var userMapping = getUserNames();
        if (get_org.length > 0) {
            condition = "ID IN ('" + get_org.join("','") + "')";
            properties = ['ID', 'Name'];
            var cases = queryObjects(properties, "Account", condition).records;
            entries.push(orgToEntry(cases, 'Account:', userMapping));
        }

        if (case_ids.length > 0) {
            condition = "ID IN ('" + case_ids.join("','") + "')";
            properties = ['ID', 'CaseNumber', 'Subject', 'Description', 'CreatedDate', 'ClosedDate', 'OwnerID', 'Priority', 'Origin', 'Status', 'Reason','IsEscalated','SuppliedPhone','SuppliedCompany','SuppliedEmail','ContactEmail','ContactId','AccountId'];
            var cases = queryObjects(properties, "Case", condition).records;
            entries.push(casesToEntry(cases, 'Cases:', userMapping));
        }
         if (case_comment.length > 0) {
            condition = "ID IN ('" + case_comment.join("','") + "')";
            properties = ['ID', 'CommentBody', 'CreatedDate', 'CreatedById', 'IsPublished', 'SystemModstamp', 'LastModifiedById', 'LastModifiedDate'];
            var cases_comment = queryObjects(properties, "CaseComment", condition).records;
            entries.push(commentToEntry(cases_comment, 'CaseComment:', userMapping));
        }

        if (contact_ids.length > 0) {
            condition = "ID IN ('" + contact_ids.join("','") + "')";
            properties = ['ID', 'Name', 'Title', 'AccountId', 'Phone', 'MobilePhone', 'Email', 'OwnerId'];
            var contacts = queryObjects(properties, "Contact", condition).records;
            entries.push(contactsToEntry(contacts, 'Contacts:', userMapping));
        }
        if (lead_ids.length > 0) {
            condition = "ID IN ('" + lead_ids.join("','") + "')";
            properties = ['ID', 'Name', 'Title', 'Company', 'Phone', 'MobilePhone', 'Email', 'Status', 'OwnerId'];
            var leads = queryObjects(properties, "Lead", condition).records;
            entries.push(leadsToEntry(leads, 'Leads:', userMapping));
        }
        if (task_ids.length > 0) {
            condition = "ID IN ('" + task_ids.join("','") + "')";
            properties = ['ID', 'Subject', 'WhoId', 'ActivityDate'];
            var tasks = queryObjects(properties, "Task", condition).records;
            entries.push(tasksToEntry(tasks, 'Tasks:'));
        }
        if (user_ids.length > 0) {
            condition = "ID IN ('" + user_ids.join("','") + "')";
            properties = ['ID', 'Name', 'Title', 'Phone', 'Email'];
            var users = queryObjects(properties, "User", condition).records;
            entries.push(usersToEntry(users, 'Users:'));
        }

        if (general.length > 0) entries.push({'unparsed' : general});
        return entries;
    }


    function queryRaw(query) {
        var url = 'query/' + encodeToURLQuery({q : query});
        response = sendRequestInSession('GET', url, '');
        return JSON.parse(response.Body);
    }


    function queryObjects(fields, table, condition) {
        query = 'SELECT ' + fields.join(',') + ' FROM ' + table;
        if (condition !== undefined) {
            query += ' WHERE ' + condition;
        }

        return queryRaw(query);
    }


    function getObject(path) {
        response = sendRequestInSession('GET', 'sobjects/' + path, '');
        return objectToEntry(path.split('/')[0], JSON.parse(response.Body));
    }


    function createObject(path, json_obj) {
        response = sendRequestInSession('POST','sobjects/' + path, json_obj);
        response = JSON.parse(response.Body);

        if (response.success !== true) {
            return {
                Type: entryTypes.note,
                Contents: response,
                ContentsFormat: formats.json,
                ReadableContentsFormat: formats.markdown,
                HumanReadable : tableToMarkdown('Request failed with errors', response.errors, undefined, undefined, dotToSpace)
            };
        }

        return getObject(path + '/' + response.id);
    }


    function updateObject(path, json_obj) {
        response = sendRequestInSession('PATCH','sobjects/' + path, json_obj);
        if (response.StatusCode != 204) {
            throw 'object '+ path + ' update failed with status code: ' + response.StatusCode;
        }

        return getObject(path);
    }


    function deleteObject(path) {
        response = sendRequestInSession('DELETE', 'sobjects/' + path);
        if (response.StatusCode != 204) {
            throw 'object ' + path + ' delete failed with status code: ' + response.StatusCode;
        }

        return 'object ' + path + 'was successfully deleted.';
    }


    function getCase(oid, caseNumber) {
        if (caseNumber !== undefined) {
            var condition = "CaseNumber='" + caseNumber + "'";
            var properties = ['ID', 'CaseNumber', 'Subject', 'Description', 'CreatedDate', 'ClosedDate', 'OwnerID', 'Priority', 'Origin', 'Status', 'Reason','IsEscalated','SuppliedPhone','SuppliedCompany','SuppliedEmail','ContactEmail','ContactId','AccountId'];
            cases = queryObjects(properties, 'Case', condition).records;
            return casesToEntry(cases, 'Case #' + caseNumber + ':', getUserNames());
        }

        if (oid !== undefined) {
            return getObject('Case/' + oid);
        }

        return {
            Type : entryTypes.error,
            Contents : 'You must specify object ID or a Case Number',
            // ContentsFormat: formats.json,
            ReadableContentsFormat: formats.markdown
        };
    }



    // Add the capability to get all comment in specific case

    function getCaseComment(oid, caseNumber) {
        if (caseNumber !== undefined) {

            var condition = "CaseNumber='" + caseNumber + "'";
            cases = queryObjects(['Id', 'CaseNumber'], 'Case', condition).records;
            comments = JSON.parse(sendRequestInSession('GET', 'sobjects/Case/'+cases[0].Id+'/CaseComments').Body);
            return commentToEntry(comments.records, 'CaseComment #' + cases[0].CaseNumber + ':', getUserNames());
        }

        if (oid !== undefined) {
            comments = JSON.parse(sendRequestInSession('GET', 'sobjects/Case/'+oid+'/CaseComments').Body);
            return commentToEntry(comments.records, 'CaseComment #' + oid + ':', getUserNames());
        }

        return {
            Type : entryTypes.error,
            Contents : 'You must specify object ID or a Case Number',
            // ContentsFormat: formats.json,
            ReadableContentsFormat: formats.markdown
        };
    }


    function getUser(oid, caseNumber) {
        if (caseNumber !== undefined) {
            var condition = "CaseNumber='" + caseNumber + "'";
            cases = queryObjects(['Id', 'CaseNumber','OwnerId'], 'Case', condition).records;
            var conditionA = "Id='" +  cases[0].OwnerId + "'";
            properties = ['Id', 'Name', 'Alias', 'CommunityNickname', 'Email','FirstName','Username'];
            var users = queryObjects(properties, "User", conditionA).records;
            return usersToEntry(users, 'User #' + cases[0].OwnerId + ':', getUserNames());
        }

        if (oid !== undefined) {
            var usersOid = JSON.parse(sendRequestInSession('GET', 'sobjects/'+'User').Body);
            return usersToEntry(usersToEntry.records, 'User #' + usersOid + ':', getUserNames());
        }

        return {
            Type : entryTypes.error,
            Contents : 'You must specify object ID or a Case Number',
            // ContentsFormat: formats.json,
            ReadableContentsFormat: formats.markdown
        };
    }


    function getOrgName(caseNumber) {

        if (caseNumber !== undefined) {
            var condition = "CaseNumber='" + caseNumber + "'";
            var properties = ['ID', 'CaseNumber','AccountId'];
            var cases = queryObjects(properties, 'Case', condition).records;
            var conditionA = "Id='" +  cases[0].AccountId + "'";
            var propertiesA = ['Id', 'Name'];
            var usersA = queryObjects(propertiesA, "Account", conditionA).records;
            return orgToEntry(usersA, 'Account #' + cases[0].AccountId + ':', getUserNames());
        }

        return {
            Type : entryTypes.error,
            Contents : 'You must specify a Case Number',
            // ContentsFormat: formats.json,
            ReadableContentsFormat: formats.markdown
        };
    }



    // Add the capability to post comment in specific case

    function postCaseComment(oid,caseNumber,text ) {
        data = {
            CommentBody : text,
            ParentId: caseNumber
        };

        response = sendRequestInSession('POST', 'sobjects/CaseComment', JSON.stringify(data));
        message = JSON.parse(response.Body);
        message.body = text;
        return {
            Type : entryTypes.note,
            Contents : message,
            ContentsFormat: formats.json,
            HumanReadable: tableToMarkdown('comment', message)
        };
    }



    function createCase(subject, description, status, origin, priority, caseType) {
        var data = {
            Subject : subject,
            Description : description,
            Status : status,
            Origin : origin,
            Priority : priority,
            Type : caseType
        };

        return createObject('Case', JSON.stringify(data));
    }


    function updateCase(oid, caseNumber, subject, description, status, origin, priority, caseType) {
        if ((oid === undefined) && (caseNumber === undefined)) {
            return {
                Type : entryTypes.error,
                Contents : 'You must specify object ID or a Case Number',
                // ContentsFormat: formats.json,
                ReadableContentsFormat: formats.markdown
            };
        }

        if (oid === undefined) {
            var condition = "CaseNumber='" + caseNumber + "'";
            cases = queryObjects(['ID'], 'Case', condition).records;
            oid = (cases.length === 1) ? cases[0].Id : undefined;
        }

        var data = {
            Subject : subject,
            Description : description,
            Status : status,
            Origion : origin,
            Priority : priority,
            Type : caseType
        };

        return updateObject('Case/' + oid, JSON.stringify(data));
    }


    function getCases() {
        var properties = ['ID', 'CaseNumber', 'Subject', 'Description', 'CreatedDate', 'ClosedDate', 'OwnerID', 'Priority', 'Origin', 'Status', 'Reason'];
            cases = queryObjects(properties, 'Case').records;
            return casesToEntry(cases, 'Cases:', getUserNames());
    }



    function closeCase(oid, caseNumber) {
        return updateCase(oid, caseNumber, undefined, undefined, 'Closed');
    }


    function deleteCase(oid, caseNumber) {
        if ((oid === undefined) && (caseNumber === undefined)) {
            return {
                Type : entryTypes.error,
                Contents : 'You must specify object ID or a Case Number',
                // ContentsFormat: formats.json,
                ReadableContentsFormat: formats.markdown
            };
        }

        if (oid === undefined) {
            var condition = "CaseNumber='" + caseNumber + "'";
            cases = queryObjects(['ID'], 'Case', condition).records;
            oid = (cases.length === 1) ? cases[0].Id : undefined;
        }

        return deleteObject('Case/' + oid);
    }


    function pushComment(oid, text, linkUrl) {
        data = {
            body : {
                messageSegments : [{
                    type : 'Text',
                    text : text
                }],
            },
            feedElementType : 'FeedItem',
            subjectId : oid
        };

        if (linkUrl !== undefined) {
            data.body.messageSegments.push({
                type : 'Link',
                url : linkUrl});
        }

        response = sendRequestInSession('POST', 'chatter/feed-elements', JSON.stringify(data));
        message = JSON.parse(response.Body);

        return createEntry(message, {
            title : 'New Message',
            contextPath: 'SalesForce.Comment(val.URL && val.URL == obj.URL)',
            data : [
                {to : 'Body', from : 'body.text'},
                {to : 'CreatedDate', from : 'createdDate'},
                {to : 'Title', from : 'header.text'},
                {to : 'ParentType', from : 'parent.type'},
                {to : 'ParentName', from : 'parent.name'},
                {to : 'URL', from : 'url'},
                {to : 'Visibility', from : 'visibility'}
                ]
        });
    }


    function pushCommentThread(id, text) {
        var data = {
            body : {
                messageSegments : [{
                    type : 'Text',
                    text : text
                }]
            }
        };

        var response = sendRequestInSession('POST', 'chatter/feed-elements/'+ id +'/capabilities/comments/items', JSON.stringify(data));
        var message = JSON.parse(response.Body);
        var output = {
            Body: message.body.text,
            CreatedDate: message.createdDate,
            URL: message.url
        };

        ec = {
            'SalesForce.Comment(val.URL && val.URL == obj.URL)': {
                URL: URI_PREFIX + 'chatter/feed-elements/' + id,
                Reply: output
            }
        };

        return {
            Type: entryTypes.note,
            Contents: message,
            ContentsFormat: formats.json,
            ReadableContentsFormat: formats.markdown,
            HumanReadable: tableToMarkdown('New Reply', output),
            EntryContext: ec
        };
    }


    function casesToIncidents(raw_info, userMapping) {
        var cases = [];
        for (var i in raw_info) {
            cases.push({
                name : raw_info[i].Id + " " + raw_info[i].Subject,
                details : raw_info[i].Description,
                rawJSON : JSON.stringify(raw_info[i]),
                Reason : raw_info[i].Reason
            });
        }
        if (cases.length == 0) {
            return '[]';
        } else {
            return JSON.stringify(cases);
        }
    }



    function fetchIncident() {
        var fetchType = params.fetchType;

        lastRun = getLastRun();
        if (lastRun.last_case_time === undefined) {
            current_time = new Date();
            current_time.setMonth(current_time.getMonth() - 1); // TODO - remove this line
            lastRun.last_case_time = dateToString(current_time, "%Y-%m-%dT%H:%M:%S.%fZ");
            setLastRun(lastRun);
        }

        var condition;
        var properties;
        var incidents = '[]';

        if (fetchType === 'cases') {
            // query cases from last time
            condition = "CreatedDate>" + lastRun.last_case_time + " ORDER BY CreatedDate DESC";
            properties = ['ID', 'CaseNumber', 'Subject', 'Description', 'CreatedDate', 'ClosedDate', 'OwnerID', 'Priority', 'Origin', 'Status', 'Reason'];

            var cases = queryObjects(properties, "Case", condition).records;

            if (cases.length > 0) {
                new_time = stringToDate(cases[0].CreatedDate, "%Y-%m-%dT%H:%M:%S.%fZ");
                lastRun.last_case_time = dateToString(new_time, "%Y-%m-%dT%H:%M:%S.%fZ");

                setLastRun(lastRun);
                var userMapping = getUserNames();
                incidents = casesToIncidents(cases, userMapping);
            }

        } else { //fetchType === 'comment'

            //query comments from last time

            incidents = '[]';

            //Fetch comment replies
            properties = ['Id', 'CommentBody', 'CreatedDate'];
            condition = "CreatedDate>" + lastRun.last_case_time + " ORDER BY CreatedDate DESC LIMIT 10";
            var replies = queryObjects(properties, "FeedComment", condition).records;

            if (replies.length > 0) {

                var newTime = stringToDate(replies[0].CreatedDate, "%Y-%m-%dT%H:%M:%S.%fZ");
                lastRun.last_case_time = dateToString(newTime, "%Y-%m-%dT%H:%M:%S.%fZ");
                setLastRun(lastRun);

                for (var i = 0; i < replies.length; i++) {

                    //Get reply details
                    var replyDetails = sendRequestInSession('GET', 'chatter/comments/' + replies[i].Id);
                    var data = JSON.parse(replyDetails.Body);
                    var feedElement = data.feedElement;
                    var parentID = feedElement.id;

                    //Get parent details
                    var parentDetails = getObject('CaseFeed/' + parentID);
                    var parentText = parentDetails.Body;

                    if (parentText.indexOf('DemistoID') !== -1) {

                        var messageSegments = data.body.messageSegments;
                        for (var j = 0; j < messageSegments.length; j++)
                        if (messageSegments[j].type === 'Text') {
                            // Found the relavent comment (there's only one), so we return it
                            return JSON.stringify([{
                                name: parentText,
                                details: messageSegments[j].text
                            }]);
                        }
                    }
                }
            }
        }

        return incidents;
    }


    SESSION_DATA = getNewToken();

    // The command input arg holds the command sent from the user.

    var response;

    switch (command) {
        case 'fetch-incidents':
            return fetchIncident();
        case 'salesforce-search':
            response = sendRequestInSession('GET','search/?q=FIND+%7B' + args.pattern +'%7D','');
            return searchToEntry(JSON.parse(response.Body).searchRecords);
        case 'salesforce-query':
            return queryToEntry(queryRaw(args.query));
        case 'salesforce-get-object':
            return getObject(args.path);
        case 'salesforce-update-object':
            return updateObject(args.path, args.json);
        case 'salesforce-create-object':
            return createObject(args.path, args.json);
        case 'salesforce-get-case':
            return getCase(args.oid, args.caseNumber);
         case 'salesforce-get-user':
            return getUser(args.oid, args.caseNumber);
        case 'salesforce-get-casecomment':
            return getCaseComment(args.oid, args.caseNumber);
        case 'salesforce-get-org':
            return getOrgName(args.caseNumber);
        case 'salesforce-post-casecomment':
            return postCaseComment(args.oid, args.caseNumber, args.text);
        case 'salesforce-create-case':
            return createCase(args.subject, args.description, args.status, args.origin, args.priority, args.type);
        case 'salesforce-update-case':
            return updateCase(args.oid, args.caseNumber, args.subject, args.description, args.status, args.origin, args.priority, args.type);
        case 'salesforce-get-cases':
            return getCases();
        case 'salesforce-close-case':
            return closeCase(args.oid, args.caseNumber);
        case 'salesforce-delete-case':
            return deleteCase(args.oid, args.caseNumber);
        case 'salesforce-push-comment':
            return pushComment(args.oid, args.text, args.link);
        case 'salesforce-push-comment-threads':
            return pushCommentThread(args.id, args.text);
        case 'test-module':
            try {
                sendRequestInSession('GET', '', '');
            } catch (err) {
                return 'Connection test failed with error: ' + err + '.';
            }
            return 'ok';
        default:
    }
  type: javascript
  commands:
  - name: salesforce-search
    arguments:
    - name: pattern
      required: true
      description: The string or number to search.
    outputs:
    - contextPath: SalesForce.Case.ID
      description: The ID of the case object.
      type: string
    - contextPath: SalesForce.Case.CaseNumber
      description: The case number.
      type: string
    - contextPath: SalesForce.Case.Subject
      description: The subject of the case.
      type: string
    - contextPath: SalesForce.Case.Description
      description: The description of the case.
      type: string
    - contextPath: SalesForce.Case.CreateDate
      description: The creation date the case.
      type: date
    - contextPath: SalesForce.Case.ClosedDate
      description: The closure date of the case.
      type: date
    - contextPath: SalesForce.Case.Owner
      description: The owner of the case.
      type: string
    - contextPath: SalesForce.Case.Priority
      description: 'The priority of the Case. Can be: "Low", "Medium", or "High".'
      type: string
    - contextPath: SalesForce.Case.Origin
      description: 'The origin of the case. Can be: "Web", "Phone", or "Email".'
      type: string
    - contextPath: SalesForce.Case.Status
      description: 'The status of the case. Cam be: "New", "Escalated", "On Hold", or "Closed".'
      type: string
    - contextPath: SalesForce.Case.Reason
      description: The reason for the case creation.
      type: string
    - contextPath: SalesForce.Contact.ID
      description: ID of the contact.
      type: string
    - contextPath: SalesForce.Contact.Name
      description: The name of the contact.
      type: string
    - contextPath: SalesForce.Contact.Account
      description: The account associated with the Contact information.
      type: string
    - contextPath: SalesForce.Contact.Title
      description: The title of the contact.
      type: string
    - contextPath: SalesForce.Contact.Phone
      description: The phone number of the contact.
      type: string
    - contextPath: SalesForce.Contact.MobliePhone
      description: The mobile number of the contact.
      type: string
    - contextPath: SalesForce.Contact.Email
      description: The email of the contact.
      type: string
    - contextPath: SalesForce.Contact.Owner
      description: The owner of the contact.
      type: string
    - contextPath: SalesForce.Lead.ID
      description: The Lead ID.
      type: string
    - contextPath: SalesForce.Lead.Name
      description: The Lead name.
      type: string
    - contextPath: SalesForce.Lead.Title
      description: The title of the lead.
      type: string
    - contextPath: SalesForce.Lead.Company
      description: The Lead company.
      type: string
    - contextPath: SalesForce.Lead.Phone
      description: The Lead phone number.
      type: string
    - contextPath: SalesForce.Lead.Mobile
      description: The Lead Mobile Number.
      type: string
    - contextPath: SalesForce.Lead.Email
      description: The Lead email.
      type: string
    - contextPath: SalesForce.Lead.Owner
      description: The Lead owner.
      type: string
    - contextPath: SalesForce.Lead.Status
      description: 'The lead status. Can be: "New", "Nurturing", "Working", "Qualified", or "Unqualified".'
      type: string
    - contextPath: SalesForce.Task.ID
      description: The ID of the task.
      type: string
    - contextPath: SalesForce.Task.Subject
      description: The subject of the task.
      type: string
    - contextPath: SalesForce.Task.Lead
      description: The leader of the task.
      type: string
    - contextPath: SalesForce.Task.RelatedTo
      description: The relevant account.
      type: string
    - contextPath: SalesForce.Task.DueDate
      description: The due date of the task.
      type: date
    - contextPath: SalesForce.User.ID
      description: The ID of the user.
      type: string
    - contextPath: SalesForce.User.Name
      description: The name of the user.
      type: string
    - contextPath: SalesForce.User.Title
      description: The title of the user.
      type: string
    - contextPath: SalesForce.User.Phone
      description: The phone number of the user.
      type: string
    - contextPath: SalesForce.User.Email
      description: The email of the user.
      type: string
    - contextPath: SalesForce.Case.IsEscalated
      description: Is Escalated for Case
      type: boolean
    - contextPath: SalesForce.Case.SuppliedPhone
      description: Case Supplied Phone
      type: string
    - contextPath: SalesForce.Case.SuppliedCompany
      description: Case Supplied Company
      type: string
    - contextPath: SalesForce.Case.ContactEmail
      description: Case contact Email
      type: string
    - contextPath: SalesForce.Case.ContactId
      description: Case contact Id
      type: string
    - contextPath: SalesForce.Case.AccountId
      description: Case account ID
      type: string
    description: Search records that contain values with pattern
  - name: salesforce-query
    arguments:
    - name: query
      required: true
      description: 'Query in SOQL format: "SELECT name from Account".'
    description: Queries Salesforce in SOQL format.
    execution: true
  - name: salesforce-get-object
    arguments:
    - name: path
      required: true
      description: 'The object path. For example, "Case/5000Y000001EjzRQAS" for Object "Case" with ID "5000Y000001EjzRQAS".'
    outputs:
    - contextPath: SalesForce.Case.ID
      description: The Object ID of the case.
      type: string
    - contextPath: SalesForce.Case.CaseNumber
      description: The case number.
      type: string
    - contextPath: SalesForce.Case.Subject
      description: The subject of the case.
      type: string
    - contextPath: SalesForce.Case.Description
      description: The description of the case.
      type: string
    - contextPath: SalesForce.Case.CreateDate
      description: The creation date of the case.
      type: date
    - contextPath: SalesForce.Case.ClosedDate
      description: The closure date of the case.
      type: date
    - contextPath: SalesForce.Case.Owner
      description: The owner of the case.
      type: string
    - contextPath: SalesForce.Case.Priority
      description: 'The priority of the case. Can be: "Low", "Medium", or "High".'
      type: string
    - contextPath: SalesForce.Case.Origin
      description: 'Origin of the case. Can be: "Web", "Phone", or "Email".'
      type: string
    - contextPath: SalesForce.Case.Status
      description: 'The status of the case. Can be: "New", "Escalated", "On Hold", or "Closed".'
      type: string
    - contextPath: SalesForce.Case.Reason
      description: The reason for the case creation.
      type: string
    - contextPath: SalesForce.Contact.ID
      description: The ID of the contact.
      type: string
    - contextPath: SalesForce.Contact.Name
      description: The name of the contact.
      type: string
    - contextPath: SalesForce.Contact.Account
      description: The account associated with the Contact information.
      type: string
    - contextPath: SalesForce.Contact.Title
      description: The title of the contact.
      type: string
    - contextPath: SalesForce.Contact.Phone
      description: The phone number of the contact.
      type: string
    - contextPath: SalesForce.Contact.MobliePhone
      description: The mobile number of the contact.
      type: string
    - contextPath: SalesForce.Contact.Email
      description: The email of the contact.
      type: string
    - contextPath: SalesForce.Contact.Owner
      description: The owner of the contact.
      type: string
    - contextPath: SalesForce.Lead.ID
      description: The Lead ID.
      type: string
    - contextPath: SalesForce.Lead.Name
      description: The Lead name.
      type: string
    - contextPath: SalesForce.Lead.Title
      description: The Lead title.
      type: string
    - contextPath: SalesForce.Lead.Company
      description: The Lead company.
      type: string
    - contextPath: SalesForce.Lead.Phone
      description: The Lead phone number.
      type: string
    - contextPath: SalesForce.Lead.Mobile
      description: The Lead mobile number.
      type: string
    - contextPath: SalesForce.Lead.Email
      description: The Lead email.
      type: string
    - contextPath: SalesForce.Lead.Owner
      description: The Lead owner.
      type: string
    - contextPath: SalesForce.Lead.Status
      description: 'The Lead status. Can be: "New", "Nurturing", "Working", "Qualified", or "Unqualified".'
      type: string
    - contextPath: SalesForce.Task.ID
      description: The ID of the task.
      type: string
    - contextPath: SalesForce.Task.Subject
      description: The subject of the task.
      type: string
    - contextPath: SalesForce.Task.Lead
      description: The leader of the task.
      type: string
    - contextPath: SalesForce.Task.RelatedTo
      description: The relevant account of the task.
      type: string
    - contextPath: SalesForce.Task.DueDate
      description: The due date of the task.
      type: date
    - contextPath: SalesForce.User.ID
      description: The ID of the user.
      type: string
    - contextPath: SalesForce.User.Name
      description: The name of the user.
      type: string
    - contextPath: SalesForce.User.Title
      description: The title of the user.
      type: string
    - contextPath: SalesForce.User.Phone
      description: The phone number of the user.
      type: string
    - contextPath: SalesForce.User.Email
      description: The email of the user.
      type: string
    description: Returns an object by its path.
  - name: salesforce-update-object
    arguments:
    - name: path
      required: true
      description: 'The object path. For example, "Case/5000Y000001EjzRQAS" for Object "Case" with ID "5000Y000001EjzRQAS".'
    - name: json
      required: true
      description: The JSON file with fields and values of the object to be updated.
    outputs:
    - contextPath: SalesForce.Case.ID
      description: The object ID of the case.
      type: string
    - contextPath: SalesForce.Case.CaseNumber
      description: The case number.
      type: string
    - contextPath: SalesForce.Case.Subject
      description: The subject of the case.
      type: string
    - contextPath: SalesForce.Case.Description
      description: The description of the case.
      type: string
    - contextPath: SalesForce.Case.CreateDate
      description: The creation date of the case.
      type: date
    - contextPath: SalesForce.Case.ClosedDate
      description: The closure time of the case.
      type: date
    - contextPath: SalesForce.Case.Owner
      description: The owner of the case.
      type: string
    - contextPath: SalesForce.Case.Priority
      description: 'The priority of the case. Can be: "Low", "Medium", or "High".'
      type: string
    - contextPath: SalesForce.Case.Origin
      description: 'The origin of the Case. Can be: "Web", "Phone", or "Email".'
      type: string
    - contextPath: SalesForce.Case.Status
      description: 'The status of the case. Can be: "New", "Escalated", "On Hold" ,or "Closed".'
      type: string
    - contextPath: SalesForce.Case.Reason
      description: The reason for the case creation.
      type: string
    - contextPath: SalesForce.Contact.ID
      description: The ID of the contact.
      type: string
    - contextPath: SalesForce.Contact.Name
      description: The name of the contact.
      type: string
    - contextPath: SalesForce.Contact.Account
      description: The account associated with the Contact information.
      type: string
    - contextPath: SalesForce.Contact.Title
      description: The title of the contact.
      type: string
    - contextPath: SalesForce.Contact.Phone
      description: The phone number of the contact.
      type: string
    - contextPath: SalesForce.Contact.MobliePhone
      description: The mobile number of the contact.
      type: string
    - contextPath: SalesForce.Contact.Email
      description: The email of the contact.
      type: string
    - contextPath: SalesForce.Contact.Owner
      description: The owner of the contact.
      type: string
    - contextPath: SalesForce.Lead.ID
      description: The Lead ID.
      type: string
    - contextPath: SalesForce.Lead.Name
      description: The Lead name.
      type: string
    - contextPath: SalesForce.Lead.Title
      description: The Lead title.
      type: string
    - contextPath: SalesForce.Lead.Company
      description: The Lead company.
      type: string
    - contextPath: SalesForce.Lead.Phone
      description: The Lead phone number.
      type: string
    - contextPath: SalesForce.Lead.Mobile
      description: The Lead mobile number.
      type: string
    - contextPath: SalesForce.Lead.Email
      description: The Lead email.
      type: string
    - contextPath: SalesForce.Lead.Owner
      description: The Lead owner.
      type: string
    - contextPath: SalesForce.Lead.Status
      description: 'The Lead Status. Can be: "New", "Nurturing", "Working", "Qualified", or "Unqualified".'
      type: string
    - contextPath: SalesForce.Task.ID
      description: The ID of the task.
      type: string
    - contextPath: SalesForce.Task.Subject
      description: The subject of the task.
      type: string
    - contextPath: SalesForce.Task.Lead
      description: The leader of the task.
      type: string
    - contextPath: SalesForce.Task.RelatedTo
      description: The relevant account.
      type: string
    - contextPath: SalesForce.Task.DueDate
      description: The due date of the task.
      type: date
    - contextPath: SalesForce.User.ID
      description: The ID of the user.
      type: string
    - contextPath: SalesForce.User.Name
      description: The name of the user.
      type: string
    - contextPath: SalesForce.User.Title
      description: The title of the user.
      type: string
    - contextPath: SalesForce.User.Phone
      description: The phone number of the user.
      type: string
    - contextPath: SalesForce.User.Email
      description: The email of the user.
      type: string
    description: Updates object fields.
    execution: true
  - name: salesforce-create-object
    arguments:
    - name: path
      required: true
      description: 'The object path. For example, "Case" for Object "Case".'
    - name: json
      required: true
      description: The JSON file with fields and values of the object to be created.
    outputs:
    - contextPath: SalesForce.Case.ID
      description: The Object ID of the case.
      type: string
    - contextPath: SalesForce.Case.CaseNumber
      description: The case number.
      type: string
    - contextPath: SalesForce.Case.Subject
      description: The subject of the case.
      type: string
    - contextPath: SalesForce.Case.Description
      description: The description of the case.
      type: string
    - contextPath: SalesForce.Case.CreateDate
      description: The creation date of the case.
      type: date
    - contextPath: SalesForce.Case.ClosedDate
      description: The closure date of the case.
      type: date
    - contextPath: SalesForce.Case.Owner
      description: The owner of the case.
      type: string
    - contextPath: SalesForce.Case.Priority
      description: 'The priority of the case. Can be: "Low", "Medium", "High".'
      type: string
    - contextPath: SalesForce.Case.Origin
      description: 'Origin of the Case. Can be: "Web", "Phone", or "Email".'
      type: string
    - contextPath: SalesForce.Case.Status
      description: 'The status of the case. Can be: "New", "Escalated", "On Hold", or "Closed".'
      type: string
    - contextPath: SalesForce.Case.Reason
      description: The reason for the case creation.
      type: string
    - contextPath: SalesForce.Contact.ID
      description: The ID of the contact.
      type: string
    - contextPath: SalesForce.Contact.Name
      description: The name of the contact.
      type: string
    - contextPath: SalesForce.Contact.Account
      description: The account associated with the Contact information.
      type: string
    - contextPath: SalesForce.Contact.Title
      description: The title of the contact.
      type: string
    - contextPath: SalesForce.Contact.Phone
      description: The phone number of the contact.
      type: string
    - contextPath: SalesForce.Contact.MobliePhone
      description: The mobile number of the contact.
      type: string
    - contextPath: SalesForce.Contact.Email
      description: The email of the contact.
      type: string
    - contextPath: SalesForce.Contact.Owner
      description: The owner of the contact.
      type: string
    - contextPath: SalesForce.Lead.ID
      description: The Lead ID.
      type: string
    - contextPath: SalesForce.Lead.Name
      description: The Lead name.
      type: string
    - contextPath: SalesForce.Lead.Title
      description: The Lead title.
      type: string
    - contextPath: SalesForce.Lead.Company
      description: The Lead company.
      type: string
    - contextPath: SalesForce.Lead.Phone
      description: The Lead phone number.
      type: string
    - contextPath: SalesForce.Lead.Mobile
      description: The Lead mobile number.
      type: string
    - contextPath: SalesForce.Lead.Email
      description: The Lead email.
      type: string
    - contextPath: SalesForce.Lead.Owner
      description: The Lead owner.
      type: string
    - contextPath: SalesForce.Lead.Status
      description: 'The Lead status. Can be: "New", "Nurturing", "Working", "Qualified", or "Unqualified".'
      type: string
    - contextPath: SalesForce.Task.ID
      description: The ID of the task.
      type: string
    - contextPath: SalesForce.Task.Subject
      description: The subject of the task.
      type: string
    - contextPath: SalesForce.Task.Lead
      description: The leader of the task.
      type: string
    - contextPath: SalesForce.Task.RelatedTo
      description: The relevant account of the task.
      type: string
    - contextPath: SalesForce.Task.DueDate
      description: The due date of the task.
      type: date
    - contextPath: SalesForce.User.ID
      description: The ID of the user.
      type: string
    - contextPath: SalesForce.User.Name
      description: The name of the user.
      type: string
    - contextPath: SalesForce.User.Title
      description: The title of the user.
      type: string
    - contextPath: SalesForce.User.Phone
      description: The phone number of the user.
      type: string
    - contextPath: SalesForce.User.Email
      description: The email of the user.
      type: string
    description: Creates a new object.
    execution: true
  - name: salesforce-push-comment
    arguments:
    - name: oid
      required: true
      description: The Object ID of subject.
    - name: text
      required: true
      description: Chat text
    - name: link
      description: Adds a link to the message.
    outputs:
    - contextPath: SalesForce.Comment.Body
      description: The body of the comment.
      type: string
    - contextPath: SalesForce.Comment.CreatedDate
      description: The created date of the comment.
      type: date
    - contextPath: SalesForce.Comment.Title
      description: The title of the comment.
      type: string
    - contextPath: SalesForce.Comment.ParentType
      description: The parent type of the comment.
      type: string
    - contextPath: SalesForce.Comment.ParentName
      description: The parent name of the comment.
      type: string
    - contextPath: SalesForce.Comment.URL
      description: The URL link of the comment.
      type: string
    - contextPath: SalesForce.Comment.Visibility
      description: The visibility of the comment.
      type: string
    description: Adds a comment to Chatter.
  - name: salesforce-get-case
    arguments:
    - name: oid
      description: The Object ID of the case.
    - name: caseNumber
      description: Case number of case
    outputs:
    - contextPath: SalesForce.Case.ID
      description: The Object ID of the case.
      type: string
    - contextPath: SalesForce.Case.CaseNumber
      description: The case number.
      type: string
    - contextPath: SalesForce.Case.Subject
      description: The subject of the case.
      type: string
    - contextPath: SalesForce.Case.Description
      description: The description of the case.
      type: string
    - contextPath: SalesForce.Case.CreateDate
      description: The creation date of the case.
      type: date
    - contextPath: SalesForce.Case.ClosedDate
      description: The closure date of the case.
      type: date
    - contextPath: SalesForce.Case.Owner
      description: The owner of the case.
      type: string
    - contextPath: SalesForce.Case.Priority
      description: 'The priority of the case. Can be: "Low", "Medium", or "High".'
      type: string
    - contextPath: SalesForce.Case.Origin
      description: 'The origin of the case. Can be: "Web", "Phone", or "Email".'
      type: string
    - contextPath: SalesForce.Case.Status
      description: 'The status of the case. Can be: "New", "Escalated", "On Hold", or "Closed".'
      type: string
    - contextPath: SalesForce.Case.Reason
      description: The reason for the case creation.
      type: string
    description: Returns information on a case. All arguments are optional, but you must specify at least one for the command to execute successfully.
  - name: salesforce-create-case
    arguments:
    - name: subject
      required: true
      default: true
      description: The case subject.
    - name: description
      description: The case description.
    - name: status
      required: true
      auto: PREDEFINED
      predefined:
      - New
      - On Hold
      - Closed
      - Escalated
      description: 'The Case Status. Can be: "New", "On Hold", "Closed", or "Escalated". Default is New.'
      defaultValue: New
    - name: origin
      auto: PREDEFINED
      predefined:
      - Email
      - Phone
      - Web
      description: 'The case origin. Can be: "Email", "Phone", or "Web".'
    - name: priority
      auto: PREDEFINED
      predefined:
      - Low
      - Medium
      - High
      description: 'The case priority. Can be: "Low", "Medium", or "High".'
      defaultValue: Low
    - name: type
      auto: PREDEFINED
      predefined:
      - Question
      - Problem
      - Feature Request
      description: 'The case type. Can be: "Question", "Problem", or "Feature Request".'
    outputs:
    - contextPath: SalesForce.Case.ID
      description: The Object ID of the case.
      type: string
    - contextPath: SalesForce.Case.CaseNumber
      description: The case number.
      type: string
    - contextPath: SalesForce.Case.Subject
      description: The subject of the case.
      type: string
    - contextPath: SalesForce.Case.Description
      description: The description of the case.
      type: string
    - contextPath: SalesForce.Case.CreateDate
      description: The creation date of the case.
      type: date
    - contextPath: SalesForce.Case.ClosedDate
      description: The closure date of the case.
      type: date
    - contextPath: SalesForce.Case.Owner
      description: The owner of the case.
      type: string
    - contextPath: SalesForce.Case.Priority
      description: 'The priority of the case. Can be: "Low", "Medium", or "High".'
      type: string
    - contextPath: SalesForce.Case.Origin
      description: 'The origin of the case. Can be: "Web", "Phone", or "Email".'
      type: string
    - contextPath: SalesForce.Case.Status
      description: 'The status of the case. Can be: "New", "Escalated", "On Hold", or "Closed".'
      type: string
    - contextPath: SalesForce.Case.Reason
      description: The reason for the case creation.
      type: string
    description: Creates a new case.
  - name: salesforce-update-case
    arguments:
    - name: oid
      description: The Object ID of the case.
    - name: caseNumber
      description: The case number.
    - name: subject
      description: The case subject.
    - name: description
      description: The case description.
    - name: status
      auto: PREDEFINED
      predefined:
      - New
      - On Hold
      - Closed
      - Escalated
      description: 'The case status. Can be: "New", "On Hold", "Closed", or "Escalated".'
    - name: origin
      auto: PREDEFINED
      predefined:
      - Email
      - Phone
      - Web
      description: 'The case origin. Can be: "Email", "Phone", or "Web".'
    - name: priority
      auto: PREDEFINED
      predefined:
      - Low
      - Medium
      - High
      description: 'The case priority. Can be: "Low", "Medium", or "High".'
    - name: type
      auto: PREDEFINED
      predefined:
      - Question
      - Problem
      - Feature Request
      description: 'The case type. Can be: "Question", "Problem", or "Feature Request".'
    outputs:
    - contextPath: SalesForce.Case.ID
      description: The Object ID of the case.
      type: string
    - contextPath: SalesForce.Case.CaseNumber
      description: The number of the case.
      type: string
    - contextPath: SalesForce.Case.Subject
      description: The subject of the case.
      type: string
    - contextPath: SalesForce.Case.Description
      description: The description of the case.
      type: string
    - contextPath: SalesForce.Case.CreateDate
      description: The creation date of the case.
      type: date
    - contextPath: SalesForce.Case.ClosedDate
      description: The closure date of the case.
      type: date
    - contextPath: SalesForce.Case.Owner
      description: The owner of the case.
      type: string
    - contextPath: SalesForce.Case.Priority
      description: 'The priority of the case. Can be: "Low", "Medium", or "High".'
      type: string
    - contextPath: SalesForce.Case.Origin
      description: 'Origin of the Case. Can be: "Web", "Phone", or "Email".'
      type: string
    - contextPath: SalesForce.Case.Status
      description: 'The status of the case. Can be: "New, "Escalated", "On Hold", or "Closed".'
      type: string
    - contextPath: SalesForce.Case.Reason
      description: Reason for the case creation.
      type: string
    description: Updates case fields.
  - name: salesforce-get-cases
    arguments: []
    description: Returns all cases.
  - name: salesforce-close-case
    arguments:
    - name: oid
      description: The case Object ID.
    - name: caseNumber
      description: The case number.
    outputs:
    - contextPath: SalesForce.Case.ID
      description: The Object ID of the case.
      type: string
    - contextPath: SalesForce.Case.CaseNumber
      description: The case number.
      type: string
    - contextPath: SalesForce.Case.Subject
      description: The subject of the case.
      type: string
    - contextPath: SalesForce.Case.Description
      description: Case Description
      type: string
    - contextPath: SalesForce.Case.CreateDate
      description: Creation Time of Case
      type: date
    - contextPath: SalesForce.Case.ClosedDate
      description: Closure Time of Case
      type: date
    - contextPath: SalesForce.Case.Owner
      description: Case Owner
      type: string
    - contextPath: SalesForce.Case.Priority
      description: Priority of the Case. one of Low, Medium, High.
      type: string
    - contextPath: SalesForce.Case.Origin
      description: Origin of the Case. one of Web, Phone, Email.
      type: string
    - contextPath: SalesForce.Case.Status
      description: 'Case Status. one of the following: New, Escalated, On Hold or Closed.'
      type: string
    - contextPath: SalesForce.Case.Reason
      description: Reason for case creation
      type: string
    important:
    - contextPath: SalesForce.Case.Status
      description: Case Status. Will be 'Closed'.
      related: ""
    description: Close a case
  - name: salesforce-push-comment-threads
    arguments:
    - name: id
      required: true
      description: The Chatter comment Thread ID
    - name: text
      required: true
      description: The comment text
    outputs:
    - contextPath: SalesForce.Comment.Reply.Body
      description: Reply body
      type: string
    - contextPath: SalesForce.Comment.Reply.CreatedDate
      description: Reply created date
      type: date
    - contextPath: SalesForce.Comment.Reply.URL
      description: Reply URL link
      type: string
    description: Add the comment to the chatter thread. Use this command only after salesforce-push-comment
  - name: salesforce-delete-case
    arguments:
    - name: oid
      description: The Object ID of the case.
    - name: caseNumber
      description: The case number.
    description: Deletes a case.
  - name: salesforce-get-casecomment
    arguments:
    - name: oid
      description: Returns information of a case.
    - name: caseNumber
      description: The case number of the case.
    outputs:
    - contextPath: ID
      description: The ID of the case.
      type: string
    - contextPath: ParentId
      description: The ID of the parent case of the case comment. Required.
      type: string
    - contextPath: IsPublished
      description: Whether the case comment is visible to customers in the Self-Service portal (true). The label is published. This is the only CaseComment field that can be updated through the API.
      type: boolean
    - contextPath: CommentBody
      description: The text of the case body. Maximum size is 4,000 bytes. The label is Body.
      type: string
    - contextPath: CreatedById
      description: 'The created date by ID.'
    - contextPath: CreatedDate
      description: The created date.
      type: string
    - contextPath: SystemModstamp
      description: 'The SystemMod stamp.'
      type: string
    - contextPath: LastModifiedDate
      description: 'The last modified date. '
      type: string
    - contextPath: LastModifiedById
      description: 'The last modified date by ID.'
      type: string
    - contextPath: IsDeleted
      description: Whether the object has been moved to the Recycle Bin (true). Label is Deleted.
      type: boolean
    description: Returns a comment through the case number.
  - name: salesforce-post-casecomment
    arguments:
    - name: oid
      description: The Object ID of the case.
    - name: caseNumber
      description: The case number of the case.
    - name: text
      description: Added Text to context
    description: The post comment through the case number.
  - name: salesforce-get-user
    arguments:
    - name: oid
      description: The Object ID of the case.
    - name: caseNumber
      description: The case number of the case.
    outputs:
    - contextPath: ID
      description: The ID of the case.
      type: string
    - contextPath: Alias
      description: The user’s alias. Required. For example, jsmith.
      type: string
    - contextPath: CommunityNickname
      description: The name used to identify the user in the Community application, which includes the ideas and answers features.
      type: string
    - contextPath: CreatedById
      description: 'Created by the ID.'
      type: string
    - contextPath: Email
      description: The user’s email address. Required.
      type: string
    - contextPath: LastLoginDate
      description: The time and date when the user last successfully logged in. This value is updated if 60 seconds have elapsed since the user’s last login.
      type: string
    - contextPath: LastModifiedDate
      description: The last modified date.
      type: string
    - contextPath: LastName
      description: The user’s last name. Required.
      type: string
    - contextPath: Name
      description: Concatenation of FirstName and LastName. Limited to 121 characters.
      type: string
    - contextPath: Username
      description: Contains the name that a user enters to log in to the API or the user interface. Required. Must be in the form of an email address, all characters should be lowercase, and unique across all organizations. Each added user counts as a license. Every organization has a maximum number of licenses. If you attempt to exceed the maximum number of licenses by inserting user records, the attempt to create a user is rejected.
      type: string
    - contextPath: UserRoleId
      description: The ID of the user’s UserRole. Label is Role ID.
      type: string
    description: Returns the UserName through the case number.
  - name: salesforce-get-org
    arguments:
    - name: caseNumber
      description: The case number of the case.
    outputs:
    - contextPath: ID
      description: The unique ID of the case.
      type: string
    - contextPath: Name
      description: 'Name of the account. Required. Label is Account Name. Maximum size is 255 characters. If the account has a record type of Person Account, this value is the concatenation of the FirstName, MiddleName, LastName, and Suffix of the associated person contact. You cannot modify this value.'
      type: string
    description: 'Returns organization details from the case number. '
  isfetch: true
  runonce: false
fromversion: 5.0.0
