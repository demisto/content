id: HAFNIUM - Exchange 0-day exploits
version: -1
contentitemexportablefields:
  contentitemfields: {}
name: HAFNIUM - Exchange 0-day exploits
description: "This playbook includes the following tasks:

                           Collect indicators to be used in your threat hunting process
                           Retrieve IOCs related to HAFNIUM and the exploited exchange 0-day vulnerabilities
                           Discover IOCs related to the attack
                           Query firewall logs to detect malicious network activity
                           Search endpoint logs for malicious hashes to detect compromised hosts (Available from Cortex XSOAR 5.5.0).
                           Block indicators
                           Note: This is a beta playbook, which lets you implement and test pre-release software. Since the playbook is beta, it might contain bugs. Updates to the pack during the beta phase might include non-backward compatible features. We appreciate your feedback on the quality and usability of the pack to help us identify issues, fix them, and continually improve.
                           Read more about the attack on our Unit42 blog: https://unit42.paloaltonetworks.com/microsoft-exchange-server-vulnerabilities/
                           Sources:
                              https://www.splunk.com/en_us/blog/security/detecting-hafnium-exchange-server-zero-day-activity-in-splunk.html
                              https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/"
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 0768b855-1ac0-4690-83ca-df89537f1559
    type: start
    task:
      id: 0768b855-1ac0-4690-83ca-df89537f1559
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "2"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 40
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "2":
    id: "2"
    taskid: a52b8c78-8d5d-4e37-80c0-266a4a7b3b07
    type: title
    task:
      id: a52b8c78-8d5d-4e37-80c0-266a4a7b3b07
      version: -1
      name: Collect and Enrich IOCs
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "5"
      - "6"
      - "34"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 200
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "5":
    id: "5"
    taskid: 0a2642c3-02da-481d-8898-ebd7ad8250b4
    type: regular
    task:
      id: 0a2642c3-02da-481d-8898-ebd7ad8250b4
      version: -1
      name: Collect IOCs from Microsoft blog
      description: Sends http request. Returns the response as json to collect the
        indicators from Microsoft blog post
      scriptName: http
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      body: {}
      filename: {}
      headers: {}
      insecure: {}
      method:
        simple: GET
      password: {}
      proxy: {}
      saveAsFile: {}
      unsecure: {}
      url:
        simple: https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/
      username: {}
    reputationcalc: 2
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "6":
    id: "6"
    taskid: a7a3270d-ee3a-4bc7-8a85-8afa3f5c16bd
    type: regular
    task:
      id: a7a3270d-ee3a-4bc7-8a85-8afa3f5c16bd
      version: -1
      name: Collect IOCs from Volexity blog
      description: Sends http request. Returns the response as json to collect the
        indicators from Volexity blog post
      scriptName: http
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      body: {}
      filename: {}
      headers: {}
      insecure: {}
      method:
        simple: GET
      password: {}
      proxy: {}
      saveAsFile: {}
      unsecure: {}
      url:
        simple: https://www.volexity.com/blog/2021/03/02/active-exploitation-of-microsoft-exchange-zero-day-vulnerabilities/
      username: {}
    reputationcalc: 2
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 0,
          "y": 350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "7":
    id: "7"
    taskid: d5d871ee-a77e-4533-8ed7-af4edda31623
    type: title
    task:
      id: d5d871ee-a77e-4533-8ed7-af4edda31623
      version: -1
      name: Create Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "8"
      - "9"
      - "10"
      - "11"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 530
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "8":
    id: "8"
    taskid: d9abb9ee-b4cc-4255-822d-2e477d71df42
    type: regular
    task:
      id: d9abb9ee-b4cc-4255-822d-2e477d71df42
      version: -1
      name: Create CVE's indicators
      description: Create HAFNIUM CVE's indicators
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "12"
    scriptarguments:
      abusetype: {}
      accounttype: {}
      actor: {}
      admincountry: {}
      adminemail: {}
      adminname: {}
      adminphone: {}
      asn: {}
      assignedrole: {}
      assigneduser: {}
      associatedfilenames: {}
      associations: {}
      biosversion: {}
      campaign:
        simple: HAFNIUM
      category: {}
      chronicleassethostname: {}
      chronicleassetip: {}
      chronicleassetmac: {}
      chronicleassetproductid: {}
      chronicleassetsummary: {}
      chronicleisolatedhostname: {}
      chronicleisolatedip: {}
      chroniclepotentiallyblockedip: {}
      city: {}
      costcenter: {}
      costcentercode: {}
      countryname: {}
      creationdate: {}
      cryptocurrencyaddresstype: {}
      customFields: {}
      cvedescription: {}
      cvemodified: {}
      cvss: {}
      cyjaxindustrytypes: {}
      cyjaxtechniquestacticsprocedures: {}
      department: {}
      description: {}
      detectionengines: {}
      devicemodel: {}
      dhcpserver: {}
      displayname: {}
      dns: {}
      domainidnname: {}
      domainname: {}
      domainreferringips: {}
      domainreferringsubnets: {}
      domainstatus: {}
      downloadurl: {}
      email: {}
      emailaddress: {}
      employeehealthstatus: {}
      employeeresponsestatus: {}
      entryid: {}
      expirationdate: {}
      feedrelatedindicators: {}
      fileextension: {}
      filetype: {}
      firstname: {}
      firstseenbysource: {}
      geocountry: {}
      geolocation: {}
      givenname: {}
      groups: {}
      hostname: {}
      imphash: {}
      indicatoridentification: {}
      internal: {}
      ipaddress: {}
      jobcode: {}
      jobfamily: {}
      jobfunction: {}
      jobtitle: {}
      lastname: {}
      lastseenbysource: {}
      leadership: {}
      location: {}
      locationregion: {}
      macaddress: {}
      malwarefamily: {}
      malwaretypes: {}
      manageremailaddress: {}
      managername: {}
      md5: {}
      memory: {}
      merge: {}
      mitrealiases: {}
      mitrecontributors: {}
      mitrecreated: {}
      mitredatasources: {}
      mitredefensebypassed: {}
      mitredescription: {}
      mitredetection: {}
      mitreextendedaliases: {}
      mitreexternalreferences: {}
      mitreid: {}
      mitreimpacttype: {}
      mitrekillchainphases: {}
      mitrelabels: {}
      mitremodified: {}
      mitrename: {}
      mitrepermissionsrequired: {}
      mitreplatforms: {}
      mitresystemrequirements: {}
      mitretactics: {}
      mitretype: {}
      mitreversion: {}
      mobilephone: {}
      name: {}
      namefield: {}
      nameservers: {}
      office365category: {}
      office365expressroute: {}
      office365required: {}
      operatingsystem: {}
      operatingsystemversion: {}
      organization: {}
      organizationalunitou: {}
      osversion: {}
      path: {}
      personalemail: {}
      port: {}
      positivedetections: {}
      primarymotivation: {}
      processor: {}
      processors: {}
      published: {}
      quarantined: {}
      rawaddress: {}
      recordedfutureevidencedetails: {}
      region: {}
      registrantcountry: {}
      registrantemail: {}
      registrantname: {}
      registrantphone: {}
      registrarabuseemail: {}
      registrarabusephone: {}
      registrarname: {}
      relatedIncidents: {}
      reportedby: {}
      reportscount: {}
      reputation: {}
      riskiqassetaddedtoinventory: {}
      riskiqassetbrands: {}
      riskiqassetconfidence: {}
      riskiqassetcves: {}
      riskiqassetenterpriseasset: {}
      riskiqassetfirstseen: {}
      riskiqassetinventorystatus: {}
      riskiqassetlastseen: {}
      riskiqassetlastupdated: {}
      riskiqassetorganizations: {}
      riskiqassetpriority: {}
      riskiqassettags: {}
      riskiqassettype: {}
      riskiqassetuuid: {}
      safebreachattackids: {}
      safebreachinsightids: {}
      safebreachisbehavioral: {}
      safebreachremediationstatus: {}
      safebreachseverity: {}
      safebreachseverityscore: {}
      seenNow: {}
      service: {}
      sha1: {}
      sha256: {}
      sha512: {}
      signatureauthentihash: {}
      signaturecopyright: {}
      signaturedescription: {}
      signaturefileversion: {}
      signatureinternalname: {}
      signed: {}
      siscategory: {}
      sisexpiration: {}
      sismalwaretype: {}
      sismatchtype: {}
      sixgillactor: {}
      sixgilldescription: {}
      sixgillfeedid: {}
      sixgillfeedname: {}
      sixgillindicatorid: {}
      sixgilllanguage: {}
      sixgillmitreattcktactic: {}
      sixgillmitreattcktechnique: {}
      sixgillpostreference: {}
      sixgillposttitle: {}
      sixgillsource: {}
      sixgillvirustotaldetectionrate: {}
      sixgillvirustotalurl: {}
      size: {}
      source: {}
      sourceTimeStamp: {}
      sourceoriginalseverity: {}
      ssdeep: {}
      state: {}
      stixaliases: {}
      stixdescription: {}
      stixgoals: {}
      stixid: {}
      stixismalwarefamily: {}
      stixkillchainphases: {}
      stixmalwaretypes: {}
      stixprimarymotivation: {}
      stixresourcelevel: {}
      stixroles: {}
      stixsecondarymotivations: {}
      stixsophistication: {}
      stixthreatactortypes: {}
      stixtooltypes: {}
      stixtoolversion: {}
      streetaddress: {}
      subdomains: {}
      surname: {}
      tags:
        simple: HAFNIUM, Exchange
      threattypes: {}
      title: {}
      trafficlightprotocol: {}
      type:
        simple: CVE
      updateddate: {}
      username: {}
      value:
        complex:
          root: CVE
          accessor: ID
      workphone: {}
      xdrstatus: {}
      zipcode: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1140,
          "y": 690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "9":
    id: "9"
    taskid: 799f0f4a-97dc-4786-8859-195776824efe
    type: regular
    task:
      id: 799f0f4a-97dc-4786-8859-195776824efe
      version: -1
      name: Create IP's indicators
      description: Create HAFNIUM IP's indicators
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "13"
    scriptarguments:
      abusetype: {}
      accounttype: {}
      actor: {}
      admincountry: {}
      adminemail: {}
      adminname: {}
      adminphone: {}
      asn: {}
      assignedrole: {}
      assigneduser: {}
      associatedfilenames: {}
      associations: {}
      biosversion: {}
      campaign:
        simple: HAFNIUM
      category: {}
      chronicleassethostname: {}
      chronicleassetip: {}
      chronicleassetmac: {}
      chronicleassetproductid: {}
      chronicleassetsummary: {}
      chronicleisolatedhostname: {}
      chronicleisolatedip: {}
      chroniclepotentiallyblockedip: {}
      city: {}
      costcenter: {}
      costcentercode: {}
      countryname: {}
      creationdate: {}
      cryptocurrencyaddresstype: {}
      customFields: {}
      cvedescription: {}
      cvemodified: {}
      cvss: {}
      cyjaxindustrytypes: {}
      cyjaxtechniquestacticsprocedures: {}
      department: {}
      description: {}
      detectionengines: {}
      devicemodel: {}
      dhcpserver: {}
      displayname: {}
      dns: {}
      domainidnname: {}
      domainname: {}
      domainreferringips: {}
      domainreferringsubnets: {}
      domainstatus: {}
      downloadurl: {}
      email: {}
      emailaddress: {}
      employeehealthstatus: {}
      employeeresponsestatus: {}
      entryid: {}
      expirationdate: {}
      feedrelatedindicators: {}
      fileextension: {}
      filetype: {}
      firstname: {}
      firstseenbysource: {}
      geocountry: {}
      geolocation: {}
      givenname: {}
      groups: {}
      hostname: {}
      imphash: {}
      indicatoridentification: {}
      internal: {}
      ipaddress: {}
      jobcode: {}
      jobfamily: {}
      jobfunction: {}
      jobtitle: {}
      lastname: {}
      lastseenbysource: {}
      leadership: {}
      location: {}
      locationregion: {}
      macaddress: {}
      malwarefamily: {}
      malwaretypes: {}
      manageremailaddress: {}
      managername: {}
      md5: {}
      memory: {}
      merge: {}
      mitrealiases: {}
      mitrecontributors: {}
      mitrecreated: {}
      mitredatasources: {}
      mitredefensebypassed: {}
      mitredescription: {}
      mitredetection: {}
      mitreextendedaliases: {}
      mitreexternalreferences: {}
      mitreid: {}
      mitreimpacttype: {}
      mitrekillchainphases: {}
      mitrelabels: {}
      mitremodified: {}
      mitrename: {}
      mitrepermissionsrequired: {}
      mitreplatforms: {}
      mitresystemrequirements: {}
      mitretactics: {}
      mitretype: {}
      mitreversion: {}
      mobilephone: {}
      name: {}
      namefield: {}
      nameservers: {}
      office365category: {}
      office365expressroute: {}
      office365required: {}
      operatingsystem: {}
      operatingsystemversion: {}
      organization: {}
      organizationalunitou: {}
      osversion: {}
      path: {}
      personalemail: {}
      port: {}
      positivedetections: {}
      primarymotivation: {}
      processor: {}
      processors: {}
      published: {}
      quarantined: {}
      rawaddress: {}
      recordedfutureevidencedetails: {}
      region: {}
      registrantcountry: {}
      registrantemail: {}
      registrantname: {}
      registrantphone: {}
      registrarabuseemail: {}
      registrarabusephone: {}
      registrarname: {}
      relatedIncidents: {}
      reportedby: {}
      reportscount: {}
      reputation: {}
      riskiqassetaddedtoinventory: {}
      riskiqassetbrands: {}
      riskiqassetconfidence: {}
      riskiqassetcves: {}
      riskiqassetenterpriseasset: {}
      riskiqassetfirstseen: {}
      riskiqassetinventorystatus: {}
      riskiqassetlastseen: {}
      riskiqassetlastupdated: {}
      riskiqassetorganizations: {}
      riskiqassetpriority: {}
      riskiqassettags: {}
      riskiqassettype: {}
      riskiqassetuuid: {}
      safebreachattackids: {}
      safebreachinsightids: {}
      safebreachisbehavioral: {}
      safebreachremediationstatus: {}
      safebreachseverity: {}
      safebreachseverityscore: {}
      seenNow: {}
      service: {}
      sha1: {}
      sha256: {}
      sha512: {}
      signatureauthentihash: {}
      signaturecopyright: {}
      signaturedescription: {}
      signaturefileversion: {}
      signatureinternalname: {}
      signed: {}
      siscategory: {}
      sisexpiration: {}
      sismalwaretype: {}
      sismatchtype: {}
      sixgillactor: {}
      sixgilldescription: {}
      sixgillfeedid: {}
      sixgillfeedname: {}
      sixgillindicatorid: {}
      sixgilllanguage: {}
      sixgillmitreattcktactic: {}
      sixgillmitreattcktechnique: {}
      sixgillpostreference: {}
      sixgillposttitle: {}
      sixgillsource: {}
      sixgillvirustotaldetectionrate: {}
      sixgillvirustotalurl: {}
      size: {}
      source: {}
      sourceTimeStamp: {}
      sourceoriginalseverity: {}
      ssdeep: {}
      state: {}
      stixaliases: {}
      stixdescription: {}
      stixgoals: {}
      stixid: {}
      stixismalwarefamily: {}
      stixkillchainphases: {}
      stixmalwaretypes: {}
      stixprimarymotivation: {}
      stixresourcelevel: {}
      stixroles: {}
      stixsecondarymotivations: {}
      stixsophistication: {}
      stixthreatactortypes: {}
      stixtooltypes: {}
      stixtoolversion: {}
      streetaddress: {}
      subdomains: {}
      surname: {}
      tags:
        simple: HAFNIUM, Exhange
      threattypes: {}
      title: {}
      trafficlightprotocol: {}
      type:
        simple: IP
      updateddate: {}
      username: {}
      value:
        complex:
          root: IP
          accessor: Address
      workphone: {}
      xdrstatus: {}
      zipcode: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 680,
          "y": 690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "10":
    id: "10"
    taskid: 6ffdf1ac-98ce-4bba-8207-64f25fec6b25
    type: regular
    task:
      id: 6ffdf1ac-98ce-4bba-8207-64f25fec6b25
      version: -1
      name: Create SHA256 hashes indicators
      description: Create HAFNIUM SHA256 hashes indicators
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      abusetype: {}
      accounttype: {}
      actor: {}
      admincountry: {}
      adminemail: {}
      adminname: {}
      adminphone: {}
      asn: {}
      assignedrole: {}
      assigneduser: {}
      associatedfilenames: {}
      associations: {}
      biosversion: {}
      campaign: {}
      category: {}
      chronicleassethostname: {}
      chronicleassetip: {}
      chronicleassetmac: {}
      chronicleassetproductid: {}
      chronicleassetsummary: {}
      chronicleisolatedhostname: {}
      chronicleisolatedip: {}
      chroniclepotentiallyblockedip: {}
      city: {}
      costcenter: {}
      costcentercode: {}
      countryname: {}
      creationdate: {}
      cryptocurrencyaddresstype: {}
      customFields: {}
      cvedescription: {}
      cvemodified: {}
      cvss: {}
      cyjaxindustrytypes: {}
      cyjaxtechniquestacticsprocedures: {}
      department: {}
      description: {}
      detectionengines: {}
      devicemodel: {}
      dhcpserver: {}
      displayname: {}
      dns: {}
      domainidnname: {}
      domainname: {}
      domainreferringips: {}
      domainreferringsubnets: {}
      domainstatus: {}
      downloadurl: {}
      email: {}
      emailaddress: {}
      employeehealthstatus: {}
      employeeresponsestatus: {}
      entryid: {}
      expirationdate: {}
      feedrelatedindicators: {}
      fileextension: {}
      filetype: {}
      firstname: {}
      firstseenbysource: {}
      geocountry: {}
      geolocation: {}
      givenname: {}
      groups: {}
      hostname: {}
      imphash: {}
      indicatoridentification: {}
      internal: {}
      ipaddress: {}
      jobcode: {}
      jobfamily: {}
      jobfunction: {}
      jobtitle: {}
      lastname: {}
      lastseenbysource: {}
      leadership: {}
      location: {}
      locationregion: {}
      macaddress: {}
      malwarefamily: {}
      malwaretypes: {}
      manageremailaddress: {}
      managername: {}
      md5: {}
      memory: {}
      merge: {}
      mitrealiases: {}
      mitrecontributors: {}
      mitrecreated: {}
      mitredatasources: {}
      mitredefensebypassed: {}
      mitredescription: {}
      mitredetection: {}
      mitreextendedaliases: {}
      mitreexternalreferences: {}
      mitreid: {}
      mitreimpacttype: {}
      mitrekillchainphases: {}
      mitrelabels: {}
      mitremodified: {}
      mitrename: {}
      mitrepermissionsrequired: {}
      mitreplatforms: {}
      mitresystemrequirements: {}
      mitretactics: {}
      mitretype: {}
      mitreversion: {}
      mobilephone: {}
      name: {}
      namefield: {}
      nameservers: {}
      office365category: {}
      office365expressroute: {}
      office365required: {}
      operatingsystem: {}
      operatingsystemversion: {}
      organization: {}
      organizationalunitou: {}
      osversion: {}
      path: {}
      personalemail: {}
      port: {}
      positivedetections: {}
      primarymotivation: {}
      processor: {}
      processors: {}
      published: {}
      quarantined: {}
      rawaddress: {}
      recordedfutureevidencedetails: {}
      region: {}
      registrantcountry: {}
      registrantemail: {}
      registrantname: {}
      registrantphone: {}
      registrarabuseemail: {}
      registrarabusephone: {}
      registrarname: {}
      relatedIncidents: {}
      reportedby: {}
      reportscount: {}
      reputation: {}
      riskiqassetaddedtoinventory: {}
      riskiqassetbrands: {}
      riskiqassetconfidence: {}
      riskiqassetcves: {}
      riskiqassetenterpriseasset: {}
      riskiqassetfirstseen: {}
      riskiqassetinventorystatus: {}
      riskiqassetlastseen: {}
      riskiqassetlastupdated: {}
      riskiqassetorganizations: {}
      riskiqassetpriority: {}
      riskiqassettags: {}
      riskiqassettype: {}
      riskiqassetuuid: {}
      safebreachattackids: {}
      safebreachinsightids: {}
      safebreachisbehavioral: {}
      safebreachremediationstatus: {}
      safebreachseverity: {}
      safebreachseverityscore: {}
      seenNow: {}
      service: {}
      sha1: {}
      sha256: {}
      sha512: {}
      signatureauthentihash: {}
      signaturecopyright: {}
      signaturedescription: {}
      signaturefileversion: {}
      signatureinternalname: {}
      signed: {}
      siscategory: {}
      sisexpiration: {}
      sismalwaretype: {}
      sismatchtype: {}
      sixgillactor: {}
      sixgilldescription: {}
      sixgillfeedid: {}
      sixgillfeedname: {}
      sixgillindicatorid: {}
      sixgilllanguage: {}
      sixgillmitreattcktactic: {}
      sixgillmitreattcktechnique: {}
      sixgillpostreference: {}
      sixgillposttitle: {}
      sixgillsource: {}
      sixgillvirustotaldetectionrate: {}
      sixgillvirustotalurl: {}
      size: {}
      source: {}
      sourceTimeStamp: {}
      sourceoriginalseverity: {}
      ssdeep: {}
      state: {}
      stixaliases: {}
      stixdescription: {}
      stixgoals: {}
      stixid: {}
      stixismalwarefamily: {}
      stixkillchainphases: {}
      stixmalwaretypes: {}
      stixprimarymotivation: {}
      stixresourcelevel: {}
      stixroles: {}
      stixsecondarymotivations: {}
      stixsophistication: {}
      stixthreatactortypes: {}
      stixtooltypes: {}
      stixtoolversion: {}
      streetaddress: {}
      subdomains: {}
      surname: {}
      tags:
        simple: HAFNIUM
      threattypes: {}
      title: {}
      trafficlightprotocol: {}
      type:
        simple: File
      updateddate: {}
      username: {}
      value:
        complex:
          root: File
          accessor: SHA256
      workphone: {}
      xdrstatus: {}
      zipcode: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 240,
          "y": 690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "11":
    id: "11"
    taskid: 79dac4f5-3082-4597-8e56-1f3007eb6edc
    type: regular
    task:
      id: 79dac4f5-3082-4597-8e56-1f3007eb6edc
      version: -1
      name: Create MD5 hashes indicators
      description: Create HAFNIUM MD5 hashes indicators
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "15"
    scriptarguments:
      abusetype: {}
      accounttype: {}
      actor: {}
      admincountry: {}
      adminemail: {}
      adminname: {}
      adminphone: {}
      asn: {}
      assignedrole: {}
      assigneduser: {}
      associatedfilenames: {}
      associations: {}
      biosversion: {}
      campaign: {}
      category: {}
      chronicleassethostname: {}
      chronicleassetip: {}
      chronicleassetmac: {}
      chronicleassetproductid: {}
      chronicleassetsummary: {}
      chronicleisolatedhostname: {}
      chronicleisolatedip: {}
      chroniclepotentiallyblockedip: {}
      city: {}
      costcenter: {}
      costcentercode: {}
      countryname: {}
      creationdate: {}
      cryptocurrencyaddresstype: {}
      customFields: {}
      cvedescription: {}
      cvemodified: {}
      cvss: {}
      cyjaxindustrytypes: {}
      cyjaxtechniquestacticsprocedures: {}
      department: {}
      description: {}
      detectionengines: {}
      devicemodel: {}
      dhcpserver: {}
      displayname: {}
      dns: {}
      domainidnname: {}
      domainname: {}
      domainreferringips: {}
      domainreferringsubnets: {}
      domainstatus: {}
      downloadurl: {}
      email: {}
      emailaddress: {}
      employeehealthstatus: {}
      employeeresponsestatus: {}
      entryid: {}
      expirationdate: {}
      feedrelatedindicators: {}
      fileextension: {}
      filetype: {}
      firstname: {}
      firstseenbysource: {}
      geocountry: {}
      geolocation: {}
      givenname: {}
      groups: {}
      hostname: {}
      imphash: {}
      indicatoridentification: {}
      internal: {}
      ipaddress: {}
      jobcode: {}
      jobfamily: {}
      jobfunction: {}
      jobtitle: {}
      lastname: {}
      lastseenbysource: {}
      leadership: {}
      location: {}
      locationregion: {}
      macaddress: {}
      malwarefamily: {}
      malwaretypes: {}
      manageremailaddress: {}
      managername: {}
      md5: {}
      memory: {}
      merge: {}
      mitrealiases: {}
      mitrecontributors: {}
      mitrecreated: {}
      mitredatasources: {}
      mitredefensebypassed: {}
      mitredescription: {}
      mitredetection: {}
      mitreextendedaliases: {}
      mitreexternalreferences: {}
      mitreid: {}
      mitreimpacttype: {}
      mitrekillchainphases: {}
      mitrelabels: {}
      mitremodified: {}
      mitrename: {}
      mitrepermissionsrequired: {}
      mitreplatforms: {}
      mitresystemrequirements: {}
      mitretactics: {}
      mitretype: {}
      mitreversion: {}
      mobilephone: {}
      name: {}
      namefield: {}
      nameservers: {}
      office365category: {}
      office365expressroute: {}
      office365required: {}
      operatingsystem: {}
      operatingsystemversion: {}
      organization: {}
      organizationalunitou: {}
      osversion: {}
      path: {}
      personalemail: {}
      port: {}
      positivedetections: {}
      primarymotivation: {}
      processor: {}
      processors: {}
      published: {}
      quarantined: {}
      rawaddress: {}
      recordedfutureevidencedetails: {}
      region: {}
      registrantcountry: {}
      registrantemail: {}
      registrantname: {}
      registrantphone: {}
      registrarabuseemail: {}
      registrarabusephone: {}
      registrarname: {}
      relatedIncidents: {}
      reportedby: {}
      reportscount: {}
      reputation: {}
      riskiqassetaddedtoinventory: {}
      riskiqassetbrands: {}
      riskiqassetconfidence: {}
      riskiqassetcves: {}
      riskiqassetenterpriseasset: {}
      riskiqassetfirstseen: {}
      riskiqassetinventorystatus: {}
      riskiqassetlastseen: {}
      riskiqassetlastupdated: {}
      riskiqassetorganizations: {}
      riskiqassetpriority: {}
      riskiqassettags: {}
      riskiqassettype: {}
      riskiqassetuuid: {}
      safebreachattackids: {}
      safebreachinsightids: {}
      safebreachisbehavioral: {}
      safebreachremediationstatus: {}
      safebreachseverity: {}
      safebreachseverityscore: {}
      seenNow: {}
      service: {}
      sha1: {}
      sha256: {}
      sha512: {}
      signatureauthentihash: {}
      signaturecopyright: {}
      signaturedescription: {}
      signaturefileversion: {}
      signatureinternalname: {}
      signed: {}
      siscategory: {}
      sisexpiration: {}
      sismalwaretype: {}
      sismatchtype: {}
      sixgillactor: {}
      sixgilldescription: {}
      sixgillfeedid: {}
      sixgillfeedname: {}
      sixgillindicatorid: {}
      sixgilllanguage: {}
      sixgillmitreattcktactic: {}
      sixgillmitreattcktechnique: {}
      sixgillpostreference: {}
      sixgillposttitle: {}
      sixgillsource: {}
      sixgillvirustotaldetectionrate: {}
      sixgillvirustotalurl: {}
      size: {}
      source: {}
      sourceTimeStamp: {}
      sourceoriginalseverity: {}
      ssdeep: {}
      state: {}
      stixaliases: {}
      stixdescription: {}
      stixgoals: {}
      stixid: {}
      stixismalwarefamily: {}
      stixkillchainphases: {}
      stixmalwaretypes: {}
      stixprimarymotivation: {}
      stixresourcelevel: {}
      stixroles: {}
      stixsecondarymotivations: {}
      stixsophistication: {}
      stixthreatactortypes: {}
      stixtooltypes: {}
      stixtoolversion: {}
      streetaddress: {}
      subdomains: {}
      surname: {}
      tags:
        simple: HAFNIUM
      threattypes: {}
      title: {}
      trafficlightprotocol: {}
      type:
        simple: File
      updateddate: {}
      username: {}
      value:
        complex:
          root: File
          accessor: MD5
      workphone: {}
      xdrstatus: {}
      zipcode: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -210,
          "y": 690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "12":
    id: "12"
    taskid: 28f1224f-9bc6-405c-88c1-8901bca90fa1
    type: regular
    task:
      id: 28f1224f-9bc6-405c-88c1-8901bca90fa1
      version: -1
      name: Enrich CVE's indicators
      description: Enrich CVE's indicators
      script: Builtin|||enrichIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      indicatorsValues:
        complex:
          root: CVE
          accessor: ID
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1140,
          "y": 890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "13":
    id: "13"
    taskid: fe93ac26-93fe-437f-84e1-5a946bfe3207
    type: regular
    task:
      id: fe93ac26-93fe-437f-84e1-5a946bfe3207
      version: -1
      name: Enrich IP's indicators
      description: Enrich IP's indicators
      script: Builtin|||enrichIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      indicatorsValues:
        complex:
          root: IP
          accessor: Address
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 680,
          "y": 890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "14":
    id: "14"
    taskid: 60a355d2-8019-401e-8a8c-4a8d6dfa623c
    type: regular
    task:
      id: 60a355d2-8019-401e-8a8c-4a8d6dfa623c
      version: -1
      name: Enrich SHA256 hashes indicators
      description: Enrich SHA256 hashes indicators
      script: Builtin|||enrichIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      indicatorsValues:
        complex:
          root: File
          accessor: SHA256
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 240,
          "y": 890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "15":
    id: "15"
    taskid: 827d47ff-f8a0-4f60-82e5-879538c4adb5
    type: regular
    task:
      id: 827d47ff-f8a0-4f60-82e5-879538c4adb5
      version: -1
      name: Enrich SHA256 hashes indicators
      description: commands.local.cmd.enrich.indicators
      script: Builtin|||enrichIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      indicatorsValues:
        complex:
          root: File
          accessor: MD5
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -210,
          "y": 890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "16":
    id: "16"
    taskid: 5e01946f-4d2c-4f6e-8837-7da9bc179ab9
    type: title
    task:
      id: 5e01946f-4d2c-4f6e-8837-7da9bc179ab9
      version: -1
      name: Hunt IOCs
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "18"
      - "19"
      - "17"
      - "31"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 1080
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "17":
    id: "17"
    taskid: 64a97542-59b4-404b-8288-c351cfd2b1d3
    type: playbook
    task:
      id: 64a97542-59b4-404b-8288-c351cfd2b1d3
      version: -1
      name: Search Endpoint by CVE - Generic
      description: Hunt for assets with a given CVE using available tools
      playbookName: Search Endpoint by CVE - Generic
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      CVE_ID:
        complex:
          root: CVE
          accessor: ID
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 790,
          "y": 1370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
  "18":
    id: "18"
    taskid: f6d9c9a7-b6bd-4ce9-88d8-8294db491c2e
    type: playbook
    task:
      id: f6d9c9a7-b6bd-4ce9-88d8-8294db491c2e
      version: -1
      name: Search Endpoints By Hash - Generic V2
      description: Hunt using available tools
      playbookName: Search Endpoints By Hash - Generic V2
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      MD5Hash:
        complex:
          root: File
          accessor: MD5
      SHA1Hash:
        complex:
          root: File
          accessor: SHA1
      SHA256Hash:
        complex:
          root: File
          accessor: SHA256
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 150,
          "y": 1370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
  "19":
    id: "19"
    taskid: 99453dc3-d767-4789-826c-7b1de86c9c39
    type: playbook
    task:
      id: 99453dc3-d767-4789-826c-7b1de86c9c39
      version: -1
      name: Palo Alto Networks - Hunting And Threat Detection
      playbookName: Palo Alto Networks - Hunting And Threat Detection
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      IPAddresses:
        complex:
          root: IP
          accessor: Address
      InternalDomainName: {}
      InternalHostRegex: {}
      InternalRange: {}
      MD5:
        complex:
          root: File
          accessor: MD5
      SHA1: {}
      SHA256:
        complex:
          root: File
          accessor: SHA256
      URLDomain: {}
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 470,
          "y": 1230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
  "23":
    id: "23"
    taskid: 91bef349-a557-407b-82e8-df0f46b1743c
    type: regular
    task:
      id: 91bef349-a557-407b-82e8-df0f46b1743c
      version: -1
      name: Investigate further
      description: |
        Further investigate the incident (endpoints, the entry point, etcâ€™)
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "24"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 4305
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "24":
    id: "24"
    taskid: a3180520-e703-42e4-8b5b-f46cc3b2f67e
    type: title
    task:
      id: a3180520-e703-42e4-8b5b-f46cc3b2f67e
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 4480
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "25":
    id: "25"
    taskid: ac7745d7-f806-42ec-87ac-e72e10b5f87c
    type: regular
    task:
      id: ac7745d7-f806-42ec-87ac-e72e10b5f87c
      version: -1
      name: Search XDR incidents for HAFNIUM activity
      description: |
        Search XDR incidents for HAFNIUM
      scriptName: SearchIncidentsV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      details: {}
      fromclosedate: {}
      fromdate: {}
      fromduedate: {}
      id: {}
      level: {}
      name: {}
      notstatus: {}
      owner: {}
      page: {}
      query:
        simple: xdralerts.name:"Uncommon net group execution" or xdralerts.name:"Multiple
          Discovery Commands" or xdralerts.name:"Exchange process writing aspx files"
          or xdralerts.name:"Behavioral Threat Detected" or xdralerts.name:"Suspicious
          Process Creation" or xdralerts.name:"Uncommon remote service start via sc.exe"
          or xdralerts.name:"Rare SSH Session" or xdralerts.name:"Uncommon ARP cache
          listing via arp.exe" or xdralerts.name:"Uncommon user management via net.exe"
          or xdralerts.name:"WmiPrvSe.exe Rare Child Command Line" or xdralerts.name:"Script
          Connecting to Rare External Host" or xdralerts.name:"Remote process execution
          using WMI" or xdralerts.name:"64-bit PowerShell spawning a 32-bit PowerShell"
          or xdralerts.name:"Suspicious PowerShell Command Line" or xdralerts.name:"Dumping
          Registry hives with passwords"
      reason: {}
      size: {}
      sort: {}
      status: {}
      toclosedate: {}
      todate: {}
      toduedate: {}
      type: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1100,
          "y": 1970
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "26":
    id: "26"
    taskid: 4aa15558-b60a-4747-8502-19d2a4821f8c
    type: title
    task:
      id: 4aa15558-b60a-4747-8502-19d2a4821f8c
      version: -1
      name: 'Remediation '
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "35"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 2570
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "27":
    id: "27"
    taskid: 00ff2a72-2d0f-49eb-8fc2-c4e82befce59
    type: playbook
    task:
      id: 00ff2a72-2d0f-49eb-8fc2-c4e82befce59
      version: -1
      name: Block Indicators - Generic v2
      playbookName: Block Indicators - Generic v2
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "37"
    scriptarguments:
      AutoCommit:
        simple: "No"
      CustomBlockRule:
        simple: "True"
      CustomURLCategory:
        simple: Demisto Remediation - Malicious URLs
      DAG: {}
      EDLServerIP: {}
      IP:
        complex:
          root: IP
          accessor: Address
          transformers:
          - operator: uniq
      IPBlacklistMiner: {}
      IPListName: {}
      LogForwarding: {}
      MD5:
        complex:
          root: File
          accessor: MD5
      SHA256:
        complex:
          root: File
          accessor: SHA256
      StaticAddressGroup: {}
      URL: {}
      URLBlacklistMiner: {}
      URLListName:
        simple: Demisto Remediation - URL EDL
      Username: {}
      categories: {}
      device-group: {}
      type: {}
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 690,
          "y": 2900
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "29":
    id: "29"
    taskid: 375eb37e-83d7-4046-8d67-4e1c4dffb8c0
    type: title
    task:
      id: 375eb37e-83d7-4046-8d67-4e1c4dffb8c0
      version: -1
      name: Expanse Issues Search
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "30"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1470,
          "y": 1680
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "30":
    id: "30"
    taskid: 8962f839-3e95-44df-8890-c6a0acc61c13
    type: condition
    task:
      id: 8962f839-3e95-44df-8890-c6a0acc61c13
      version: -1
      name: 'Is Expanse enabled? '
      description: Checks if the Expanse instance is enabled.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "26"
      "yes":
      - "33"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: ExpanseV2
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: Active
                    ignorecase: true
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1470,
          "y": 1800
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "31":
    id: "31"
    taskid: 24e2de04-5ed5-4b91-81fa-49846afdeabd
    type: title
    task:
      id: 24e2de04-5ed5-4b91-81fa-49846afdeabd
      version: -1
      name: Search Activities Related To the 0-Day Exploits
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "32"
      - "29"
      - "47"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1140,
          "y": 1540
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "32":
    id: "32"
    taskid: 48df8e42-6858-42fa-8152-673dfcdb76dd
    type: title
    task:
      id: 48df8e42-6858-42fa-8152-673dfcdb76dd
      version: -1
      name: XDR Related Incidents
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "46"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 890,
          "y": 1680
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "33":
    id: "33"
    taskid: 839df495-574a-4f11-87bb-3def67e9823f
    type: regular
    task:
      id: 839df495-574a-4f11-87bb-3def67e9823f
      version: -1
      name: Search issues related to Exchange and OWA
      description: Retrieve issues
      script: '|||expanse-get-issues'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      activity_status: {}
      assignee: {}
      business_unit: {}
      content_search: {}
      created_after: {}
      created_before: {}
      domain_search: {}
      inet_search: {}
      issue_type:
        simple: Microsoft OWA Server, Microsoft Exchange Server, Insecure Microsoft
          Exchange Server
      limit: {}
      modified_after: {}
      modified_before: {}
      port_number: {}
      priority: {}
      progress_status: {}
      provider: {}
      sort: {}
      tag: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1730,
          "y": 1970
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "34":
    id: "34"
    taskid: 05a3aa59-959f-45d1-8221-6e27afdbac65
    type: regular
    task:
      id: 05a3aa59-959f-45d1-8221-6e27afdbac65
      version: -1
      name: Collect indicators from Azure GitHub
      description: Sends http request. Returns the response as json.
      scriptName: http
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      body: {}
      filename: {}
      headers: {}
      insecure: {}
      method:
        simple: GET
      password: {}
      proxy: {}
      saveAsFile: {}
      unsecure: {}
      url:
        simple: https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Sample%20Data/Feeds/MSTICIoCs-ExchangeServerVulnerabilitiesDisclosedMarch2021.csv
      username: {}
    reputationcalc: 2
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 970,
          "y": 350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "35":
    id: "35"
    taskid: 6b6d19a8-0da9-4d83-86ec-5190a33bc3b0
    type: condition
    task:
      id: 6b6d19a8-0da9-4d83-86ec-5190a33bc3b0
      version: -1
      name: Block indicators automatically?
      description: Checks whether IOCs associated with the incident can be blocked automatically.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "36"
      "yes":
      - "27"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.BlockIndicatorsAutomatically
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 470,
          "y": 2710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "36":
    id: "36"
    taskid: 12a73898-2aaf-4881-825a-e0a6f796284f
    type: regular
    task:
      id: 12a73898-2aaf-4881-825a-e0a6f796284f
      version: -1
      name: Manually block indicators
      description: Manually block the IOCs in the relevant systems.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "37"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 250,
          "y": 2900
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "37":
    id: "37"
    taskid: 92bd85c0-be39-4dee-8a8a-3f26f2667afd
    type: title
    task:
      id: 92bd85c0-be39-4dee-8a8a-3f26f2667afd
      version: -1
      name: Check Patch Level
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "38"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 3070
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "38":
    id: "38"
    taskid: ad01a248-97ee-4100-86b9-0b260f0e1633
    type: condition
    task:
      id: ad01a248-97ee-4100-86b9-0b260f0e1633
      version: -1
      name: Check patch levels of Exchange Server
      description: "Is the Exchange patched with the March 2021 security updates?\nRefer to\
              \ Microsoft post about the patches:\
              \ if needed. \nhttps://techcommunity.microsoft.com/t5/exchange-team-blog/released-march-2021-exchange-server-security-updates/ba-p/2175901\n\ "
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "No":
      - "40"
      "Yes":
      - "39"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 3220
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "39":
    id: "39"
    taskid: 7dbd8bc4-522e-4e7d-844e-c5296895b92e
    type: regular
    task:
      id: 7dbd8bc4-522e-4e7d-844e-c5296895b92e
      version: -1
      name: Set Exchange patched flag to true
      description: Sets Exchange patched flag to true.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "44"
    scriptarguments:
      append: {}
      key:
        simple: ExchangesPatched
      stringify: {}
      value:
        simple: "True"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 230,
          "y": 3400
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "40":
    id: "40"
    taskid: bb9b8dac-6c73-43a7-8580-f6a726479ff1
    type: regular
    task:
      id: bb9b8dac-6c73-43a7-8580-f6a726479ff1
      version: -1
      name: Set Exchange patched flag to false
      description: Sets Exchange patched flag to false.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "44"
    scriptarguments:
      append: {}
      key:
        simple: ExchangesPatched
      stringify: {}
      value:
        simple: "False"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 700,
          "y": 3400
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "41":
    id: "41"
    taskid: b2e7f98a-dab1-401f-875a-26eeddbf55d4
    type: condition
    task:
      id: b2e7f98a-dab1-401f-875a-26eeddbf55d4
      version: -1
      name: Is the Exchange Server patched?
      description: Checks the user answer if the Exchange Server patched
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "42"
      "yes":
      - "23"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: ExchangesPatched
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 470,
          "y": 3720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "42":
    id: "42"
    taskid: 3d1c3adb-39d7-4929-88be-98a4b6f94621
    type: condition
    task:
      id: 3d1c3adb-39d7-4929-88be-98a4b6f94621
      version: -1
      name: Is it possible to patch the Exchange Server?
      description: Check whether it is possible to patch the Exchange Server
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "No":
      - "45"
      "Yes":
      - "43"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -30,
          "y": 3900
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "43":
    id: "43"
    taskid: 66d0e094-22fe-453c-847c-9ffcf4d0f6e5
    type: regular
    task:
      id: 66d0e094-22fe-453c-847c-9ffcf4d0f6e5
      version: -1
      name: Install March 2021 Exchange security patches
      description: |-
        The March 2021 security patches found here:
        https://techcommunity.microsoft.com/t5/exchange-team-blog/released-march-2021-exchange-server-security-updates/ba-p/2175901
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "23"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 200,
          "y": 4070
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "44":
    id: "44"
    taskid: a05c6f0b-8f46-47ed-841c-f1eef5fd0f22
    type: title
    task:
      id: a05c6f0b-8f46-47ed-841c-f1eef5fd0f22
      version: -1
      name: Mitigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "41"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 3570
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "45":
    id: "45"
    taskid: b490624a-a31b-4adf-834c-b5297bd498fd
    type: regular
    task:
      id: b490624a-a31b-4adf-834c-b5297bd498fd
      version: -1
      name: Interim mitigations
      description: "Follow Microsoft blog post about the interim mitigations.\nThe\
        \ blog post explains how to configure the interim mitigations and their rollback\
        \ if needed. \nhttps://msrc-blog.microsoft.com/2021/03/05/microsoft-exchange-server-vulnerabilities-mitigations-march-2021/\n\
        \nNotes:\n- These mitigations are not a remediation if your Exchange servers\
        \ have already been compromised, nor are they full protection against attack\n\
        - This should only be used as a temporary mitigation until Exchange servers\
        \ can be fully patched. \n"
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "23"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -270,
          "y": 4070
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "46":
    id: "46"
    taskid: 615ebfaf-f195-451a-856f-37097426bcd8
    type: condition
    task:
      id: 615ebfaf-f195-451a-856f-37097426bcd8
      version: -1
      name: 'Is Cortex XDR enabled? '
      description: Checks if the Cortex XDR instance is enabled.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "26"
      "yes":
      - "25"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                    ignorecase: true
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Cortex XDR - IR
                    ignorecase: true
            iscontext: true
    view: |-
      {
        "position": {
          "x": 890,
          "y": 1800
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "47":
    id: "47"
    taskid: 3048c5cf-e7cb-4f7c-8e81-9850aa4994da
    type: title
    task:
      id: 3048c5cf-e7cb-4f7c-8e81-9850aa4994da
      version: -1
      name: Hunt Windows Event Logs
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "48"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2190,
          "y": 1680
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "48":
    id: "48"
    taskid: 2b16ec9b-aad2-487d-8b37-5d5606898674
    type: regular
    task:
      id: 2b16ec9b-aad2-487d-8b37-5d5606898674
      version: -1
      name: Nishang PowerShell framework
      description: |
        Look for Nishang Invoke-PowerShellTcpOneLine in Windows Event Logging:

        SecurityEvent  | where EventID == 4688  | where Process has_any ("powershell.exe", "PowerShell_ISE.exe")  | where CommandLine has "$client = New-Object System.Net.Sockets.TCPClient"

        Splunk query example:

        index="*" sourcetype="WinEventLog" source="WinEventLog:Security" EventCode=4104 Message="* Invoke-PowerShellTCP*"

        index="*" sourcetype="WinEventLog" source="WinEventLog:Security" EventCode=4688 Creator_Process_Name="powershell.exe" System.Net.Sockets.TCPClient
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "49"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2190,
          "y": 1830
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "49":
    id: "49"
    taskid: 9e1a270b-d51f-4ecc-82f0-d506a8e704b3
    type: regular
    task:
      id: 9e1a270b-d51f-4ecc-82f0-d506a8e704b3
      version: -1
      name: Powercat detection
      description: |
        Look for downloads of PowerCat in cmd and Powershell command line logging in Windows Event Logs:

        SecurityEvent  | where EventID == 4688  | where Process has_any ("cmd.exe", "powershell.exe", "PowerShell_ISE.exe")  | where CommandLine has "https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1"

        Splunk query example:
        index="*" sourcetype="WinEventLog" source="WinEventLog:Security" EventCode=4104 Message="*powercat*"
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "50"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2190,
          "y": 2020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "50":
    id: "50"
    taskid: 9a4d5a69-ca9d-4396-8986-d92581d31a45
    type: regular
    task:
      id: 9a4d5a69-ca9d-4396-8986-d92581d31a45
      version: -1
      name: UMWorkerProcess.exe in Exchange creating abnormal content
      description: "Look for Microsoft Exchange Serverâ€™s Unified Messaging service\
        \ creating non-standard content on disk, which could indicate web shells or\
        \ other malicious content, suggesting exploitation of CVE-2021-26858 vulnerability:\n\
        \nDeviceFileEvents | where InitiatingProcessFileName == \"UMWorkerProcess.exe\"\
        \ | where FileName != \"CacheCleanup.bin\" | where FileName !endswith \".txt\"\
        \ | where FileName !endswith \".LOG\" | where FileName !endswith \".cfg\"\
        \ | where FileName != \"cleanup.bin\"\n\nSplunk query example:\nindex=* sourcetype=WinEventLog\
        \ source=\"WinEventLog:Security\" EventCode=4663 Object_Type=\"File\" (Object_Name=\"\
        *.php\" OR Object_Name=\"*.jsp\" OR Object_Name=\"*.js\" OR Object_Name=\"\
        *.aspx\" OR Object_Name=\"*.asmx\" OR Object_Name=\"*.cfm\" OR Object_Name=\"\
        *.shtml\") (Process_Name=\"*umworkerprocess.exe*\" OR Process_Name=\"*UMService.exe*\"\
        ) \n"
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "51"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2190,
          "y": 2200
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "51":
    id: "51"
    taskid: 49ef28a5-bc22-4ea7-8a04-750cbb732308
    type: regular
    task:
      id: 49ef28a5-bc22-4ea7-8a04-750cbb732308
      version: -1
      name: UMWorkerProcess.exe spawning
      description: |-
        Look for Microsoft Exchange Serverâ€™s Unified Messaging service spawning abnormal subprocesses, suggesting exploitation of CVE-2021-26857 vulnerability:

        DeviceProcessEvents | where InitiatingProcessFileName == "UMWorkerProcess.exe" | where FileName != "wermgr.exe" | where FileName != "WerFault.exe"

        Splunk Query example:
        index=* sourcetype="WinEventLog" source="WinEventLog:Security" EventCode=4688 (Creator_Process_Name="*umworkerprocess.exe*" OR Creator_Process_Name="*UMService.exe*") NOT New_Process_Name="*UMWorkerProcess.exe*"
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "26"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2190,
          "y": 2390
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
system: true
view: |-
  {
    "linkLabelsPosition": {
      "30_26_#default#": 0.12,
      "41_23_yes": 0.21,
      "46_26_#default#": 0.16
    },
    "paper": {
      "dimensions": {
        "height": 4505,
        "width": 2840,
        "x": -270,
        "y": 40
      }
    }
  }
inputs:
- key: BlockIndicatorsAutomatically
  value:
    simple: "False"
  required: false
  description: Whether to automatically indicators involved with HAFNIUM exploits
  playbookInputQuery:
outputs: []
tests:
- No tests (auto formatted)
fromversion: 6.0.0
