id: HAFNIUM - Exchange 0-day exploits
version: -1
name: HAFNIUM - Exchange 0-day exploits
description: "This playbook includes the following tasks:

              Collect indicators to be used in your threat hunting process
              Retrieve IOCs related to HAFNIUM and the exploited exchange 0-day vulnerabilities
              Discover IOCs related to the attack
              Query firewall logs to detect malicious network activity
              Search endpoint logs for malicious hashes to detect compromised hosts (Available from Cortex XSOAR 5.5.0).
              Block indicators
              Note: This is a beta playbook, which lets you implement and test pre-release software. Since the playbook is beta, it might contain bugs. Updates to the pack during the beta phase might include non-backward compatible features. We appreciate your feedback on the quality and usability of the pack to help us identify issues, fix them, and continually improve.
              Read more about the attack on our Unit42 blog: https://unit42.paloaltonetworks.com/microsoft-exchange-server-vulnerabilities/"
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 49e163d0-f225-467e-8cc1-ae7f89d42ef3
    type: start
    task:
      id: 49e163d0-f225-467e-8cc1-ae7f89d42ef3
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "2"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 50
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "2":
    id: "2"
    taskid: 815e4860-b31b-40ec-89e0-082dc39788a6
    type: title
    task:
      id: 815e4860-b31b-40ec-89e0-082dc39788a6
      version: -1
      name: Collect and Enrich IOCs
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "5"
      - "6"
      - "28"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 210
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "5":
    id: "5"
    taskid: a216aeba-c0b4-4bdb-8a2a-0a5062e0a8ab
    type: regular
    task:
      id: a216aeba-c0b4-4bdb-8a2a-0a5062e0a8ab
      version: -1
      name: Collect IOCs from Microsoft blog
      description: Sends http request. Returns the response as json to collect the
        indicators from Microsoft blog post
      scriptName: http
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      body: {}
      filename: {}
      headers: {}
      insecure: {}
      method:
        simple: GET
      password: {}
      proxy: {}
      saveAsFile: {}
      unsecure: {}
      url:
        simple: https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/
      username: {}
    reputationcalc: 2
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "6":
    id: "6"
    taskid: 5e5bceac-dcb0-4b4c-802d-f4444eb90814
    type: regular
    task:
      id: 5e5bceac-dcb0-4b4c-802d-f4444eb90814
      version: -1
      name: Collect IOCs from Volexity blog
      description: Sends http request. Returns the response as json to collect the
        indicators from Volexity blog post
      scriptName: http
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      body: {}
      filename: {}
      headers: {}
      insecure: {}
      method:
        simple: GET
      password: {}
      proxy: {}
      saveAsFile: {}
      unsecure: {}
      url:
        simple: https://www.volexity.com/blog/2021/03/02/active-exploitation-of-microsoft-exchange-zero-day-vulnerabilities/
      username: {}
    reputationcalc: 2
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 0,
          "y": 350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "7":
    id: "7"
    taskid: 1136d48a-5949-4f05-8810-8e0f91aa7419
    type: title
    task:
      id: 1136d48a-5949-4f05-8810-8e0f91aa7419
      version: -1
      name: Create Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "8"
      - "9"
      - "10"
      - "11"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 530
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "8":
    id: "8"
    taskid: 08680eea-249b-44be-8588-89fce5c7ff42
    type: regular
    task:
      id: 08680eea-249b-44be-8588-89fce5c7ff42
      version: -1
      name: Create CVE's indicators
      description: Create HAFNIUM CVE's indicators
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "12"
    scriptarguments:
      abusetype: {}
      accounttype: {}
      actor: {}
      admincountry: {}
      adminemail: {}
      adminname: {}
      adminphone: {}
      asn: {}
      assignedrole: {}
      assigneduser: {}
      associatedfilenames: {}
      associations: {}
      biosversion: {}
      campaign:
        simple: HAFNIUM
      category: {}
      chronicleassethostname: {}
      chronicleassetip: {}
      chronicleassetmac: {}
      chronicleassetproductid: {}
      chronicleassetsummary: {}
      chronicleisolatedhostname: {}
      chronicleisolatedip: {}
      chroniclepotentiallyblockedip: {}
      city: {}
      costcenter: {}
      costcentercode: {}
      countryname: {}
      creationdate: {}
      cryptocurrencyaddresstype: {}
      customFields: {}
      cvedescription: {}
      cvemodified: {}
      cvss: {}
      cyjaxindustrytypes: {}
      cyjaxtechniquestacticsprocedures: {}
      department: {}
      description: {}
      detectionengines: {}
      devicemodel: {}
      dhcpserver: {}
      displayname: {}
      dns: {}
      domainidnname: {}
      domainname: {}
      domainreferringips: {}
      domainreferringsubnets: {}
      domainstatus: {}
      downloadurl: {}
      email: {}
      emailaddress: {}
      employeehealthstatus: {}
      employeeresponsestatus: {}
      entryid: {}
      expirationdate: {}
      feedrelatedindicators: {}
      fileextension: {}
      filetype: {}
      firstname: {}
      firstseenbysource: {}
      geocountry: {}
      geolocation: {}
      givenname: {}
      groups: {}
      hostname: {}
      imphash: {}
      indicatoridentification: {}
      internal: {}
      ipaddress: {}
      jobcode: {}
      jobfamily: {}
      jobfunction: {}
      jobtitle: {}
      lastname: {}
      lastseenbysource: {}
      leadership: {}
      location: {}
      locationregion: {}
      macaddress: {}
      malwarefamily: {}
      malwaretypes: {}
      manageremailaddress: {}
      managername: {}
      md5: {}
      memory: {}
      merge: {}
      mitrealiases: {}
      mitrecontributors: {}
      mitrecreated: {}
      mitredatasources: {}
      mitredefensebypassed: {}
      mitredescription: {}
      mitredetection: {}
      mitreextendedaliases: {}
      mitreexternalreferences: {}
      mitreid: {}
      mitreimpacttype: {}
      mitrekillchainphases: {}
      mitrelabels: {}
      mitremodified: {}
      mitrename: {}
      mitrepermissionsrequired: {}
      mitreplatforms: {}
      mitresystemrequirements: {}
      mitretactics: {}
      mitretype: {}
      mitreversion: {}
      mobilephone: {}
      name: {}
      namefield: {}
      nameservers: {}
      office365category: {}
      office365expressroute: {}
      office365required: {}
      operatingsystem: {}
      operatingsystemversion: {}
      organization: {}
      organizationalunitou: {}
      osversion: {}
      path: {}
      personalemail: {}
      port: {}
      positivedetections: {}
      primarymotivation: {}
      processor: {}
      processors: {}
      published: {}
      quarantined: {}
      rawaddress: {}
      recordedfutureevidencedetails: {}
      region: {}
      registrantcountry: {}
      registrantemail: {}
      registrantname: {}
      registrantphone: {}
      registrarabuseemail: {}
      registrarabusephone: {}
      registrarname: {}
      relatedIncidents: {}
      reportedby: {}
      reportscount: {}
      reputation: {}
      riskiqassetaddedtoinventory: {}
      riskiqassetbrands: {}
      riskiqassetconfidence: {}
      riskiqassetcves: {}
      riskiqassetenterpriseasset: {}
      riskiqassetfirstseen: {}
      riskiqassetinventorystatus: {}
      riskiqassetlastseen: {}
      riskiqassetlastupdated: {}
      riskiqassetorganizations: {}
      riskiqassetpriority: {}
      riskiqassettags: {}
      riskiqassettype: {}
      riskiqassetuuid: {}
      safebreachattackids: {}
      safebreachinsightids: {}
      safebreachisbehavioral: {}
      safebreachremediationstatus: {}
      safebreachseverity: {}
      safebreachseverityscore: {}
      seenNow: {}
      service: {}
      sha1: {}
      sha256: {}
      sha512: {}
      signatureauthentihash: {}
      signaturecopyright: {}
      signaturedescription: {}
      signaturefileversion: {}
      signatureinternalname: {}
      signed: {}
      siscategory: {}
      sisexpiration: {}
      sismalwaretype: {}
      sismatchtype: {}
      sixgillactor: {}
      sixgilldescription: {}
      sixgillfeedid: {}
      sixgillfeedname: {}
      sixgillindicatorid: {}
      sixgilllanguage: {}
      sixgillmitreattcktactic: {}
      sixgillmitreattcktechnique: {}
      sixgillpostreference: {}
      sixgillposttitle: {}
      sixgillsource: {}
      sixgillvirustotaldetectionrate: {}
      sixgillvirustotalurl: {}
      size: {}
      source: {}
      sourceTimeStamp: {}
      sourceoriginalseverity: {}
      ssdeep: {}
      state: {}
      stixaliases: {}
      stixdescription: {}
      stixgoals: {}
      stixid: {}
      stixismalwarefamily: {}
      stixkillchainphases: {}
      stixmalwaretypes: {}
      stixprimarymotivation: {}
      stixresourcelevel: {}
      stixroles: {}
      stixsecondarymotivations: {}
      stixsophistication: {}
      stixthreatactortypes: {}
      stixtooltypes: {}
      stixtoolversion: {}
      streetaddress: {}
      subdomains: {}
      surname: {}
      tags:
        simple: HAFNIUM, Exchange
      threattypes: {}
      title: {}
      trafficlightprotocol: {}
      type:
        simple: CVE
      updateddate: {}
      username: {}
      value:
        complex:
          root: CVE
          accessor: ID
      workphone: {}
      xdrstatus: {}
      zipcode: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1140,
          "y": 690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "9":
    id: "9"
    taskid: f014c00f-c0fe-4886-8baf-b30cf4abb34e
    type: regular
    task:
      id: f014c00f-c0fe-4886-8baf-b30cf4abb34e
      version: -1
      name: Create IP's indicators
      description: Create HAFNIUM IP's indicators
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "13"
    scriptarguments:
      abusetype: {}
      accounttype: {}
      actor: {}
      admincountry: {}
      adminemail: {}
      adminname: {}
      adminphone: {}
      asn: {}
      assignedrole: {}
      assigneduser: {}
      associatedfilenames: {}
      associations: {}
      biosversion: {}
      campaign:
        simple: HAFNIUM
      category: {}
      chronicleassethostname: {}
      chronicleassetip: {}
      chronicleassetmac: {}
      chronicleassetproductid: {}
      chronicleassetsummary: {}
      chronicleisolatedhostname: {}
      chronicleisolatedip: {}
      chroniclepotentiallyblockedip: {}
      city: {}
      costcenter: {}
      costcentercode: {}
      countryname: {}
      creationdate: {}
      cryptocurrencyaddresstype: {}
      customFields: {}
      cvedescription: {}
      cvemodified: {}
      cvss: {}
      cyjaxindustrytypes: {}
      cyjaxtechniquestacticsprocedures: {}
      department: {}
      description: {}
      detectionengines: {}
      devicemodel: {}
      dhcpserver: {}
      displayname: {}
      dns: {}
      domainidnname: {}
      domainname: {}
      domainreferringips: {}
      domainreferringsubnets: {}
      domainstatus: {}
      downloadurl: {}
      email: {}
      emailaddress: {}
      employeehealthstatus: {}
      employeeresponsestatus: {}
      entryid: {}
      expirationdate: {}
      feedrelatedindicators: {}
      fileextension: {}
      filetype: {}
      firstname: {}
      firstseenbysource: {}
      geocountry: {}
      geolocation: {}
      givenname: {}
      groups: {}
      hostname: {}
      imphash: {}
      indicatoridentification: {}
      internal: {}
      ipaddress: {}
      jobcode: {}
      jobfamily: {}
      jobfunction: {}
      jobtitle: {}
      lastname: {}
      lastseenbysource: {}
      leadership: {}
      location: {}
      locationregion: {}
      macaddress: {}
      malwarefamily: {}
      malwaretypes: {}
      manageremailaddress: {}
      managername: {}
      md5: {}
      memory: {}
      merge: {}
      mitrealiases: {}
      mitrecontributors: {}
      mitrecreated: {}
      mitredatasources: {}
      mitredefensebypassed: {}
      mitredescription: {}
      mitredetection: {}
      mitreextendedaliases: {}
      mitreexternalreferences: {}
      mitreid: {}
      mitreimpacttype: {}
      mitrekillchainphases: {}
      mitrelabels: {}
      mitremodified: {}
      mitrename: {}
      mitrepermissionsrequired: {}
      mitreplatforms: {}
      mitresystemrequirements: {}
      mitretactics: {}
      mitretype: {}
      mitreversion: {}
      mobilephone: {}
      name: {}
      namefield: {}
      nameservers: {}
      office365category: {}
      office365expressroute: {}
      office365required: {}
      operatingsystem: {}
      operatingsystemversion: {}
      organization: {}
      organizationalunitou: {}
      osversion: {}
      path: {}
      personalemail: {}
      port: {}
      positivedetections: {}
      primarymotivation: {}
      processor: {}
      processors: {}
      published: {}
      quarantined: {}
      rawaddress: {}
      recordedfutureevidencedetails: {}
      region: {}
      registrantcountry: {}
      registrantemail: {}
      registrantname: {}
      registrantphone: {}
      registrarabuseemail: {}
      registrarabusephone: {}
      registrarname: {}
      relatedIncidents: {}
      reportedby: {}
      reportscount: {}
      reputation: {}
      riskiqassetaddedtoinventory: {}
      riskiqassetbrands: {}
      riskiqassetconfidence: {}
      riskiqassetcves: {}
      riskiqassetenterpriseasset: {}
      riskiqassetfirstseen: {}
      riskiqassetinventorystatus: {}
      riskiqassetlastseen: {}
      riskiqassetlastupdated: {}
      riskiqassetorganizations: {}
      riskiqassetpriority: {}
      riskiqassettags: {}
      riskiqassettype: {}
      riskiqassetuuid: {}
      safebreachattackids: {}
      safebreachinsightids: {}
      safebreachisbehavioral: {}
      safebreachremediationstatus: {}
      safebreachseverity: {}
      safebreachseverityscore: {}
      seenNow: {}
      service: {}
      sha1: {}
      sha256: {}
      sha512: {}
      signatureauthentihash: {}
      signaturecopyright: {}
      signaturedescription: {}
      signaturefileversion: {}
      signatureinternalname: {}
      signed: {}
      siscategory: {}
      sisexpiration: {}
      sismalwaretype: {}
      sismatchtype: {}
      sixgillactor: {}
      sixgilldescription: {}
      sixgillfeedid: {}
      sixgillfeedname: {}
      sixgillindicatorid: {}
      sixgilllanguage: {}
      sixgillmitreattcktactic: {}
      sixgillmitreattcktechnique: {}
      sixgillpostreference: {}
      sixgillposttitle: {}
      sixgillsource: {}
      sixgillvirustotaldetectionrate: {}
      sixgillvirustotalurl: {}
      size: {}
      source: {}
      sourceTimeStamp: {}
      sourceoriginalseverity: {}
      ssdeep: {}
      state: {}
      stixaliases: {}
      stixdescription: {}
      stixgoals: {}
      stixid: {}
      stixismalwarefamily: {}
      stixkillchainphases: {}
      stixmalwaretypes: {}
      stixprimarymotivation: {}
      stixresourcelevel: {}
      stixroles: {}
      stixsecondarymotivations: {}
      stixsophistication: {}
      stixthreatactortypes: {}
      stixtooltypes: {}
      stixtoolversion: {}
      streetaddress: {}
      subdomains: {}
      surname: {}
      tags:
        simple: HAFNIUM, Exhange
      threattypes: {}
      title: {}
      trafficlightprotocol: {}
      type:
        simple: IP
      updateddate: {}
      username: {}
      value:
        complex:
          root: IP
          accessor: Address
      workphone: {}
      xdrstatus: {}
      zipcode: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 680,
          "y": 690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "10":
    id: "10"
    taskid: 57fe14bf-f7ed-404f-89a0-b2a213571325
    type: regular
    task:
      id: 57fe14bf-f7ed-404f-89a0-b2a213571325
      version: -1
      name: Create SHA256 hashes indicators
      description: Create HAFNIUM SHA256 hashes indicators
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      abusetype: {}
      accounttype: {}
      actor: {}
      admincountry: {}
      adminemail: {}
      adminname: {}
      adminphone: {}
      asn: {}
      assignedrole: {}
      assigneduser: {}
      associatedfilenames: {}
      associations: {}
      biosversion: {}
      campaign: {}
      category: {}
      chronicleassethostname: {}
      chronicleassetip: {}
      chronicleassetmac: {}
      chronicleassetproductid: {}
      chronicleassetsummary: {}
      chronicleisolatedhostname: {}
      chronicleisolatedip: {}
      chroniclepotentiallyblockedip: {}
      city: {}
      costcenter: {}
      costcentercode: {}
      countryname: {}
      creationdate: {}
      cryptocurrencyaddresstype: {}
      customFields: {}
      cvedescription: {}
      cvemodified: {}
      cvss: {}
      cyjaxindustrytypes: {}
      cyjaxtechniquestacticsprocedures: {}
      department: {}
      description: {}
      detectionengines: {}
      devicemodel: {}
      dhcpserver: {}
      displayname: {}
      dns: {}
      domainidnname: {}
      domainname: {}
      domainreferringips: {}
      domainreferringsubnets: {}
      domainstatus: {}
      downloadurl: {}
      email: {}
      emailaddress: {}
      employeehealthstatus: {}
      employeeresponsestatus: {}
      entryid: {}
      expirationdate: {}
      feedrelatedindicators: {}
      fileextension: {}
      filetype: {}
      firstname: {}
      firstseenbysource: {}
      geocountry: {}
      geolocation: {}
      givenname: {}
      groups: {}
      hostname: {}
      imphash: {}
      indicatoridentification: {}
      internal: {}
      ipaddress: {}
      jobcode: {}
      jobfamily: {}
      jobfunction: {}
      jobtitle: {}
      lastname: {}
      lastseenbysource: {}
      leadership: {}
      location: {}
      locationregion: {}
      macaddress: {}
      malwarefamily: {}
      malwaretypes: {}
      manageremailaddress: {}
      managername: {}
      md5: {}
      memory: {}
      merge: {}
      mitrealiases: {}
      mitrecontributors: {}
      mitrecreated: {}
      mitredatasources: {}
      mitredefensebypassed: {}
      mitredescription: {}
      mitredetection: {}
      mitreextendedaliases: {}
      mitreexternalreferences: {}
      mitreid: {}
      mitreimpacttype: {}
      mitrekillchainphases: {}
      mitrelabels: {}
      mitremodified: {}
      mitrename: {}
      mitrepermissionsrequired: {}
      mitreplatforms: {}
      mitresystemrequirements: {}
      mitretactics: {}
      mitretype: {}
      mitreversion: {}
      mobilephone: {}
      name: {}
      namefield: {}
      nameservers: {}
      office365category: {}
      office365expressroute: {}
      office365required: {}
      operatingsystem: {}
      operatingsystemversion: {}
      organization: {}
      organizationalunitou: {}
      osversion: {}
      path: {}
      personalemail: {}
      port: {}
      positivedetections: {}
      primarymotivation: {}
      processor: {}
      processors: {}
      published: {}
      quarantined: {}
      rawaddress: {}
      recordedfutureevidencedetails: {}
      region: {}
      registrantcountry: {}
      registrantemail: {}
      registrantname: {}
      registrantphone: {}
      registrarabuseemail: {}
      registrarabusephone: {}
      registrarname: {}
      relatedIncidents: {}
      reportedby: {}
      reportscount: {}
      reputation: {}
      riskiqassetaddedtoinventory: {}
      riskiqassetbrands: {}
      riskiqassetconfidence: {}
      riskiqassetcves: {}
      riskiqassetenterpriseasset: {}
      riskiqassetfirstseen: {}
      riskiqassetinventorystatus: {}
      riskiqassetlastseen: {}
      riskiqassetlastupdated: {}
      riskiqassetorganizations: {}
      riskiqassetpriority: {}
      riskiqassettags: {}
      riskiqassettype: {}
      riskiqassetuuid: {}
      safebreachattackids: {}
      safebreachinsightids: {}
      safebreachisbehavioral: {}
      safebreachremediationstatus: {}
      safebreachseverity: {}
      safebreachseverityscore: {}
      seenNow: {}
      service: {}
      sha1: {}
      sha256: {}
      sha512: {}
      signatureauthentihash: {}
      signaturecopyright: {}
      signaturedescription: {}
      signaturefileversion: {}
      signatureinternalname: {}
      signed: {}
      siscategory: {}
      sisexpiration: {}
      sismalwaretype: {}
      sismatchtype: {}
      sixgillactor: {}
      sixgilldescription: {}
      sixgillfeedid: {}
      sixgillfeedname: {}
      sixgillindicatorid: {}
      sixgilllanguage: {}
      sixgillmitreattcktactic: {}
      sixgillmitreattcktechnique: {}
      sixgillpostreference: {}
      sixgillposttitle: {}
      sixgillsource: {}
      sixgillvirustotaldetectionrate: {}
      sixgillvirustotalurl: {}
      size: {}
      source: {}
      sourceTimeStamp: {}
      sourceoriginalseverity: {}
      ssdeep: {}
      state: {}
      stixaliases: {}
      stixdescription: {}
      stixgoals: {}
      stixid: {}
      stixismalwarefamily: {}
      stixkillchainphases: {}
      stixmalwaretypes: {}
      stixprimarymotivation: {}
      stixresourcelevel: {}
      stixroles: {}
      stixsecondarymotivations: {}
      stixsophistication: {}
      stixthreatactortypes: {}
      stixtooltypes: {}
      stixtoolversion: {}
      streetaddress: {}
      subdomains: {}
      surname: {}
      tags:
        simple: HAFNIUM
      threattypes: {}
      title: {}
      trafficlightprotocol: {}
      type:
        simple: File
      updateddate: {}
      username: {}
      value:
        complex:
          root: File
          accessor: SHA256
      workphone: {}
      xdrstatus: {}
      zipcode: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 240,
          "y": 690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "11":
    id: "11"
    taskid: a7017706-c8be-4f52-8433-e70222703c9d
    type: regular
    task:
      id: a7017706-c8be-4f52-8433-e70222703c9d
      version: -1
      name: Create MD5 hashes indicators
      description: Create HAFNIUM MD5 hashes indicators
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "15"
    scriptarguments:
      abusetype: {}
      accounttype: {}
      actor: {}
      admincountry: {}
      adminemail: {}
      adminname: {}
      adminphone: {}
      asn: {}
      assignedrole: {}
      assigneduser: {}
      associatedfilenames: {}
      associations: {}
      biosversion: {}
      campaign: {}
      category: {}
      chronicleassethostname: {}
      chronicleassetip: {}
      chronicleassetmac: {}
      chronicleassetproductid: {}
      chronicleassetsummary: {}
      chronicleisolatedhostname: {}
      chronicleisolatedip: {}
      chroniclepotentiallyblockedip: {}
      city: {}
      costcenter: {}
      costcentercode: {}
      countryname: {}
      creationdate: {}
      cryptocurrencyaddresstype: {}
      customFields: {}
      cvedescription: {}
      cvemodified: {}
      cvss: {}
      cyjaxindustrytypes: {}
      cyjaxtechniquestacticsprocedures: {}
      department: {}
      description: {}
      detectionengines: {}
      devicemodel: {}
      dhcpserver: {}
      displayname: {}
      dns: {}
      domainidnname: {}
      domainname: {}
      domainreferringips: {}
      domainreferringsubnets: {}
      domainstatus: {}
      downloadurl: {}
      email: {}
      emailaddress: {}
      employeehealthstatus: {}
      employeeresponsestatus: {}
      entryid: {}
      expirationdate: {}
      feedrelatedindicators: {}
      fileextension: {}
      filetype: {}
      firstname: {}
      firstseenbysource: {}
      geocountry: {}
      geolocation: {}
      givenname: {}
      groups: {}
      hostname: {}
      imphash: {}
      indicatoridentification: {}
      internal: {}
      ipaddress: {}
      jobcode: {}
      jobfamily: {}
      jobfunction: {}
      jobtitle: {}
      lastname: {}
      lastseenbysource: {}
      leadership: {}
      location: {}
      locationregion: {}
      macaddress: {}
      malwarefamily: {}
      malwaretypes: {}
      manageremailaddress: {}
      managername: {}
      md5: {}
      memory: {}
      merge: {}
      mitrealiases: {}
      mitrecontributors: {}
      mitrecreated: {}
      mitredatasources: {}
      mitredefensebypassed: {}
      mitredescription: {}
      mitredetection: {}
      mitreextendedaliases: {}
      mitreexternalreferences: {}
      mitreid: {}
      mitreimpacttype: {}
      mitrekillchainphases: {}
      mitrelabels: {}
      mitremodified: {}
      mitrename: {}
      mitrepermissionsrequired: {}
      mitreplatforms: {}
      mitresystemrequirements: {}
      mitretactics: {}
      mitretype: {}
      mitreversion: {}
      mobilephone: {}
      name: {}
      namefield: {}
      nameservers: {}
      office365category: {}
      office365expressroute: {}
      office365required: {}
      operatingsystem: {}
      operatingsystemversion: {}
      organization: {}
      organizationalunitou: {}
      osversion: {}
      path: {}
      personalemail: {}
      port: {}
      positivedetections: {}
      primarymotivation: {}
      processor: {}
      processors: {}
      published: {}
      quarantined: {}
      rawaddress: {}
      recordedfutureevidencedetails: {}
      region: {}
      registrantcountry: {}
      registrantemail: {}
      registrantname: {}
      registrantphone: {}
      registrarabuseemail: {}
      registrarabusephone: {}
      registrarname: {}
      relatedIncidents: {}
      reportedby: {}
      reportscount: {}
      reputation: {}
      riskiqassetaddedtoinventory: {}
      riskiqassetbrands: {}
      riskiqassetconfidence: {}
      riskiqassetcves: {}
      riskiqassetenterpriseasset: {}
      riskiqassetfirstseen: {}
      riskiqassetinventorystatus: {}
      riskiqassetlastseen: {}
      riskiqassetlastupdated: {}
      riskiqassetorganizations: {}
      riskiqassetpriority: {}
      riskiqassettags: {}
      riskiqassettype: {}
      riskiqassetuuid: {}
      safebreachattackids: {}
      safebreachinsightids: {}
      safebreachisbehavioral: {}
      safebreachremediationstatus: {}
      safebreachseverity: {}
      safebreachseverityscore: {}
      seenNow: {}
      service: {}
      sha1: {}
      sha256: {}
      sha512: {}
      signatureauthentihash: {}
      signaturecopyright: {}
      signaturedescription: {}
      signaturefileversion: {}
      signatureinternalname: {}
      signed: {}
      siscategory: {}
      sisexpiration: {}
      sismalwaretype: {}
      sismatchtype: {}
      sixgillactor: {}
      sixgilldescription: {}
      sixgillfeedid: {}
      sixgillfeedname: {}
      sixgillindicatorid: {}
      sixgilllanguage: {}
      sixgillmitreattcktactic: {}
      sixgillmitreattcktechnique: {}
      sixgillpostreference: {}
      sixgillposttitle: {}
      sixgillsource: {}
      sixgillvirustotaldetectionrate: {}
      sixgillvirustotalurl: {}
      size: {}
      source: {}
      sourceTimeStamp: {}
      sourceoriginalseverity: {}
      ssdeep: {}
      state: {}
      stixaliases: {}
      stixdescription: {}
      stixgoals: {}
      stixid: {}
      stixismalwarefamily: {}
      stixkillchainphases: {}
      stixmalwaretypes: {}
      stixprimarymotivation: {}
      stixresourcelevel: {}
      stixroles: {}
      stixsecondarymotivations: {}
      stixsophistication: {}
      stixthreatactortypes: {}
      stixtooltypes: {}
      stixtoolversion: {}
      streetaddress: {}
      subdomains: {}
      surname: {}
      tags:
        simple: HAFNIUM
      threattypes: {}
      title: {}
      trafficlightprotocol: {}
      type:
        simple: File
      updateddate: {}
      username: {}
      value:
        complex:
          root: File
          accessor: MD5
      workphone: {}
      xdrstatus: {}
      zipcode: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -210,
          "y": 690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "12":
    id: "12"
    taskid: 4c90887e-0979-473b-80da-8ebf82fbce03
    type: regular
    task:
      id: 4c90887e-0979-473b-80da-8ebf82fbce03
      version: -1
      name: Enrich CVE's indicators
      description: Enrich CVE's indicators
      script: Builtin|||enrichIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      indicatorsValues:
        complex:
          root: CVE
          accessor: ID
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1140,
          "y": 890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "13":
    id: "13"
    taskid: b8e2e950-5502-4be0-8f42-d6f2391b4afe
    type: regular
    task:
      id: b8e2e950-5502-4be0-8f42-d6f2391b4afe
      version: -1
      name: Enrich IP's indicators
      description: Enrich IP's indicators
      script: Builtin|||enrichIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      indicatorsValues:
        complex:
          root: IP
          accessor: Address
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 680,
          "y": 890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "14":
    id: "14"
    taskid: f05fa4e9-c802-4d85-862a-226d4d2a6be9
    type: regular
    task:
      id: f05fa4e9-c802-4d85-862a-226d4d2a6be9
      version: -1
      name: Enrich SHA256 hashes indicators
      description: Enrich SHA256 hashes indicators
      script: Builtin|||enrichIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      indicatorsValues:
        complex:
          root: File
          accessor: SHA256
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 240,
          "y": 890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "15":
    id: "15"
    taskid: 68a9e3b7-9b6f-4bfe-8ed0-bf458cfaa1d6
    type: regular
    task:
      id: 68a9e3b7-9b6f-4bfe-8ed0-bf458cfaa1d6
      version: -1
      name: Enrich SHA256 hashes indicators
      description: commands.local.cmd.enrich.indicators
      script: Builtin|||enrichIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      indicatorsValues:
        complex:
          root: File
          accessor: MD5
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -210,
          "y": 890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "16":
    id: "16"
    taskid: 2d20144f-c29a-447b-8d83-bc16539182d3
    type: title
    task:
      id: 2d20144f-c29a-447b-8d83-bc16539182d3
      version: -1
      name: Hunt IOCs
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "18"
      - "19"
      - "17"
      - "40"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 1080
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "17":
    id: "17"
    taskid: e31e9e7f-0466-452f-8b40-d76962c52933
    type: playbook
    task:
      id: e31e9e7f-0466-452f-8b40-d76962c52933
      version: -1
      name: Search Endpoint by CVE - Generic
      playbookName: Search Endpoint by CVE - Generic
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      CVE_ID:
        complex:
          root: CVE
          accessor: ID
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 910,
          "y": 1230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
  "18":
    id: "18"
    taskid: 97a91e28-6ace-4e37-80ea-cacfb95311f3
    type: playbook
    task:
      id: 97a91e28-6ace-4e37-80ea-cacfb95311f3
      version: -1
      name: Search Endpoints By Hash - Generic V2
      playbookName: Search Endpoints By Hash - Generic V2
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      MD5Hash:
        complex:
          root: File
          accessor: MD5
      SHA1Hash:
        complex:
          root: File
          accessor: SHA1
      SHA256Hash:
        complex:
          root: File
          accessor: SHA256
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": -10,
          "y": 1230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
  "19":
    id: "19"
    taskid: 0a6e3fac-e709-4328-82c3-81b13db9d1e9
    type: playbook
    task:
      id: 0a6e3fac-e709-4328-82c3-81b13db9d1e9
      version: -1
      name: Palo Alto Networks - Hunting And Threat Detection
      playbookName: Palo Alto Networks - Hunting And Threat Detection
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      IPAddresses:
        complex:
          root: IP
          accessor: Address
      InternalDomainName: {}
      InternalHostRegex: {}
      InternalRange: {}
      MD5:
        complex:
          root: File
          accessor: MD5
      SHA1: {}
      SHA256:
        complex:
          root: File
          accessor: SHA256
      URLDomain: {}
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 470,
          "y": 1230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
  "23":
    id: "23"
    taskid: 6be6fa3a-62d6-4d33-85e4-bbdd29eee33e
    type: regular
    task:
      id: 6be6fa3a-62d6-4d33-85e4-bbdd29eee33e
      version: -1
      name: Investigate further
      description: |
        Further investigate the incident (endpoints, the entry point, etc’)
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "24"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 3200
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "24":
    id: "24"
    taskid: 4c8e19ac-a728-4bb0-8340-f486adb9ec05
    type: title
    task:
      id: 4c8e19ac-a728-4bb0-8340-f486adb9ec05
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 3380
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "25":
    id: "25"
    taskid: 7b223690-9d05-4515-890c-53600bee9ab4
    type: regular
    task:
      id: 7b223690-9d05-4515-890c-53600bee9ab4
      version: -1
      name: Search XDR incidents for HAFNIUM activity
      description: |
        Search XDR incidents for HAFNIUM
      scriptName: SearchIncidentsV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      details: {}
      fromclosedate: {}
      fromdate: {}
      fromduedate: {}
      id: {}
      level: {}
      name: {}
      notstatus: {}
      owner: {}
      page: {}
      query:
        simple: xdralerts.name:"Uncommon net group execution" or xdralerts.name:"Multiple
          Discovery Commands" or xdralerts.name:"Exchange process writing aspx files"
          or xdralerts.name:"Behavioral Threat Detected"
      reason: {}
      size: {}
      sort: {}
      status: {}
      toclosedate: {}
      todate: {}
      toduedate: {}
      type: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1570,
          "y": 1430
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "26":
    id: "26"
    taskid: aaf6f8e5-c9d5-4cd7-8080-18f5f40b50dc
    type: title
    task:
      id: aaf6f8e5-c9d5-4cd7-8080-18f5f40b50dc
      version: -1
      name: Block Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "29"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 1610
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "27":
    id: "27"
    taskid: 34c59c89-579e-4cd5-8497-57ae142951cf
    type: playbook
    task:
      id: 34c59c89-579e-4cd5-8497-57ae142951cf
      version: -1
      name: Block Indicators - Generic v2
      playbookName: Block Indicators - Generic v2
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      AutoCommit:
        simple: "No"
      CustomBlockRule:
        simple: "True"
      CustomURLCategory:
        simple: Demisto Remediation - Malicious URLs
      DAG: {}
      EDLServerIP: {}
      IP:
        complex:
          root: IP
          accessor: Address
          transformers:
          - operator: uniq
      IPBlacklistMiner: {}
      IPListName: {}
      LogForwarding: {}
      MD5:
        complex:
          root: File
          accessor: MD5
      SHA256:
        complex:
          root: File
          accessor: SHA256
      StaticAddressGroup: {}
      URL: {}
      URLBlacklistMiner: {}
      URLListName:
        simple: Demisto Remediation - URL EDL
      Username: {}
      categories: {}
      device-group: {}
      type: {}
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 710,
          "y": 1890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "28":
    id: "28"
    taskid: c78a31a9-74ab-4d40-85e8-7eb017fecef3
    type: regular
    task:
      id: c78a31a9-74ab-4d40-85e8-7eb017fecef3
      version: -1
      name: Collect indicators from Azure GitHub
      description: Sends http request. Returns the response as json.
      scriptName: http
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      body: {}
      filename: {}
      headers: {}
      insecure: {}
      method:
        simple: GET
      password: {}
      proxy: {}
      saveAsFile: {}
      unsecure: {}
      url:
        simple: https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Sample%20Data/Feeds/MSTICIoCs-ExchangeServerVulnerabilitiesDisclosedMarch2021.csv
      username: {}
    reputationcalc: 2
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 940,
          "y": 350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "29":
    id: "29"
    taskid: 8b9ac630-12fd-48a4-8c36-ae8609b72472
    type: condition
    task:
      id: 8b9ac630-12fd-48a4-8c36-ae8609b72472
      version: -1
      name: Block indicators automatically?
      description: Checks whether IOCs associated with the incident can be blocked
        automatically.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "30"
      "yes":
      - "27"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.BlockIndicatorsAutomatically
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "30":
    id: "30"
    taskid: b2e2013d-9b4a-44de-8081-ef54835cf136
    type: regular
    task:
      id: b2e2013d-9b4a-44de-8081-ef54835cf136
      version: -1
      name: Manually block indicators
      description: Manually block the IOCs in the relevant systems.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "31"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 240,
          "y": 1890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "31":
    id: "31"
    taskid: c946adc0-cb40-4d83-87b7-46eff6615fcc
    type: title
    task:
      id: c946adc0-cb40-4d83-87b7-46eff6615fcc
      version: -1
      name: Check Patch Level
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "32"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2065
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "32":
    id: "32"
    taskid: 9ad1059c-c7bb-46d2-8a3d-c8fc14d998d6
    type: condition
    task:
      id: 9ad1059c-c7bb-46d2-8a3d-c8fc14d998d6
      version: -1
      name: Check patch levels of Exchange Server
      description: "Is the Exchange patched with the March 2021 security updates?\nRefer to\
                    \ Microsoft post about the patches:\
                    \ if needed. \nhttps://techcommunity.microsoft.com/t5/exchange-team-blog/released-march-2021-exchange-server-security-updates/ba-p/2175901\n\ "
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "No":
      - "33"
      "Yes":
      - "34"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2190
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "33":
    id: "33"
    taskid: 70044d63-6333-43d6-8fab-54367bbf8fe1
    type: regular
    task:
      id: 70044d63-6333-43d6-8fab-54367bbf8fe1
      version: -1
      name: Set Exchange patched flag to false
      description: Sets Exchange patched flag to false.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "35"
    scriptarguments:
      append: {}
      key:
        simple: Set Exchange patched flag to false
      stringify: {}
      value:
        simple: "False"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 730,
          "y": 2360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "34":
    id: "34"
    taskid: 82a86b0c-2593-4e17-84eb-809af5a79952
    type: regular
    task:
      id: 82a86b0c-2593-4e17-84eb-809af5a79952
      version: -1
      name: Set Exchange patched flag to true
      description: Sets Exchange patched flag to true.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "35"
    scriptarguments:
      append: {}
      key:
        simple: ExchangesPatched
      stringify: {}
      value:
        simple: "True"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 230,
          "y": 2360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "35":
    id: "35"
    taskid: 0c718ac4-5b02-4c98-8d59-59bc7f246c51
    type: title
    task:
      id: 0c718ac4-5b02-4c98-8d59-59bc7f246c51
      version: -1
      name: Mitigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "36"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2530
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "36":
    id: "36"
    taskid: 9d5ba2f4-1c7a-476d-8df7-0934ceb04e6b
    type: condition
    task:
      id: 9d5ba2f4-1c7a-476d-8df7-0934ceb04e6b
      version: -1
      name: Is the Exchange Server patched?
      description: Checks the user answer if the Exchange Server patched
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "37"
      "yes":
      - "23"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: ExchangesPatched
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2670
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "37":
    id: "37"
    taskid: 0c251447-b975-4a24-8213-83aa0097192f
    type: condition
    task:
      id: 0c251447-b975-4a24-8213-83aa0097192f
      version: -1
      name: Is it possible to patch the Exchange Server?
      description: Check whether it is possible to patch the Exchange Server
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "No":
      - "39"
      "Yes":
      - "38"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 20,
          "y": 2840
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "38":
    id: "38"
    taskid: 10489e05-a7a7-41da-81db-926b2c277b86
    type: regular
    task:
      id: 10489e05-a7a7-41da-81db-926b2c277b86
      version: -1
      name: Install March 2021 Exchange security patches
      description: |-
        The March 2021 security patches found here:
        https://techcommunity.microsoft.com/t5/exchange-team-blog/released-march-2021-exchange-server-security-updates/ba-p/2175901
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "23"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 240,
          "y": 3010
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "39":
    id: "39"
    taskid: c93f62fd-9f5d-476a-8fd1-eef7a070c742
    type: regular
    task:
      id: c93f62fd-9f5d-476a-8fd1-eef7a070c742
      version: -1
      name: Interim mitigations
      description: "Follow Microsoft blog post about the interim mitigations.\nThe\
        \ blog post explains how to configure the interim mitigations and their rollback\
        \ if needed. \nhttps://msrc-blog.microsoft.com/2021/03/05/microsoft-exchange-server-vulnerabilities-mitigations-march-2021/\n\
        \nNotes:\n- These mitigations are not a remediation if your Exchange servers\
        \ have already been compromised, nor are they full protection against attack\n\
        - This should only be used as a temporary mitigation until Exchange servers\
        \ can be fully patched. \n"
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "23"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -210,
          "y": 3010
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "40":
    id: "40"
    taskid: e6d43208-c0e9-4039-87e1-2a8039379818
    type: condition
    task:
      id: e6d43208-c0e9-4039-87e1-2a8039379818
      version: -1
      name: 'Is Cortex XDR enabled? '
      description: Checks if the Cortex XDR instance is enabled
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "26"
      "yes":
      - "25"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                    ignorecase: true
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Cortex XDR - IR
                    ignorecase: true
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1380,
          "y": 1230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
view: |-
  {
    "linkLabelsPosition": {
      "36_23_yes": 0.32,
      "36_37_#default#": 0.33,
      "40_25_yes": 0.6,
      "40_26_#default#": 0.12
    },
    "paper": {
      "dimensions": {
        "height": 3395,
        "width": 2160,
        "x": -210,
        "y": 50
      }
    }
  }
inputs:
- key: BlockIndicatorsAutomatically
  value:
    simple: "False"
  required: false
  description: Whether to automatically indicators involved with HAFNIUM exploits
  playbookInputQuery:
outputs: []
tests:
- No tests
fromversion: 5.5.0
toversion: 5.9.9
