id: HAFNIUM - Exchange 0-day exploits
version: -1
name: HAFNIUM - Exchange 0-day exploits
description: "This playbook includes the following tasks:

              Collect indicators to be used in your threat hunting process
              Retrieve IOCs related to HAFNIUM and the exploited exchange 0-day vulnerabilities
              Discover IOCs related to the attack
              Query firewall logs to detect malicious network activity
              Search endpoint logs for malicious hashes to detect compromised hosts (Available from Cortex XSOAR 5.5.0).
              Block indicators
              Note: This is a beta playbook, which lets you implement and test pre-release software. Since the playbook is beta, it might contain bugs. Updates to the pack during the beta phase might include non-backward compatible features. We appreciate your feedback on the quality and usability of the pack to help us identify issues, fix them, and continually improve.
              Read more about the attack on our Unit42 blog: https://unit42.paloaltonetworks.com/microsoft-exchange-server-vulnerabilities/"
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: f0f7b30f-fda1-42c4-803b-af98b5131a9b
    type: start
    task:
      id: f0f7b30f-fda1-42c4-803b-af98b5131a9b
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "2"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 50
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "2":
    id: "2"
    taskid: 5cb2579e-340b-444d-88e5-66fc8810bbb5
    type: title
    task:
      id: 5cb2579e-340b-444d-88e5-66fc8810bbb5
      version: -1
      name: Collect and Enrich IOCs
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "5"
      - "6"
      - "28"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 210
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "5":
    id: "5"
    taskid: 7d15aeac-fef6-457c-89b7-f6bb0a926be0
    type: regular
    task:
      id: 7d15aeac-fef6-457c-89b7-f6bb0a926be0
      version: -1
      name: Collect IOCs from Microsoft blog
      description: Sends http request. Returns the response as json to collect the
        indicators from Microsoft blog post
      scriptName: http
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      body: {}
      filename: {}
      headers: {}
      insecure: {}
      method:
        simple: GET
      password: {}
      proxy: {}
      saveAsFile: {}
      unsecure: {}
      url:
        simple: https://www.microsoft.com/security/blog/2021/03/02/hafnium-targeting-exchange-servers/
      username: {}
    reputationcalc: 2
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "6":
    id: "6"
    taskid: cb9d469a-69f9-4ec2-89ec-c6ba56011095
    type: regular
    task:
      id: cb9d469a-69f9-4ec2-89ec-c6ba56011095
      version: -1
      name: Collect IOCs from Volexity blog
      description: Sends http request. Returns the response as json to collect the
        indicators from Volexity blog post
      scriptName: http
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      body: {}
      filename: {}
      headers: {}
      insecure: {}
      method:
        simple: GET
      password: {}
      proxy: {}
      saveAsFile: {}
      unsecure: {}
      url:
        simple: https://www.volexity.com/blog/2021/03/02/active-exploitation-of-microsoft-exchange-zero-day-vulnerabilities/
      username: {}
    reputationcalc: 2
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 0,
          "y": 350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "7":
    id: "7"
    taskid: 45f045ba-c95f-4bd4-8671-d9d1b0c31afd
    type: title
    task:
      id: 45f045ba-c95f-4bd4-8671-d9d1b0c31afd
      version: -1
      name: Create Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "8"
      - "9"
      - "10"
      - "11"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 530
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "8":
    id: "8"
    taskid: 5db32692-db72-4894-8fe0-49fbe9f9ef76
    type: regular
    task:
      id: 5db32692-db72-4894-8fe0-49fbe9f9ef76
      version: -1
      name: Create CVE's indicators
      description: Create HAFNIUM CVE's indicators
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "12"
    scriptarguments:
      abusetype: {}
      accounttype: {}
      actor: {}
      admincountry: {}
      adminemail: {}
      adminname: {}
      adminphone: {}
      asn: {}
      assignedrole: {}
      assigneduser: {}
      associatedfilenames: {}
      associations: {}
      biosversion: {}
      campaign:
        simple: HAFNIUM
      category: {}
      chronicleassethostname: {}
      chronicleassetip: {}
      chronicleassetmac: {}
      chronicleassetproductid: {}
      chronicleassetsummary: {}
      chronicleisolatedhostname: {}
      chronicleisolatedip: {}
      chroniclepotentiallyblockedip: {}
      city: {}
      costcenter: {}
      costcentercode: {}
      countryname: {}
      creationdate: {}
      cryptocurrencyaddresstype: {}
      customFields: {}
      cvedescription: {}
      cvemodified: {}
      cvss: {}
      cyjaxindustrytypes: {}
      cyjaxtechniquestacticsprocedures: {}
      department: {}
      description: {}
      detectionengines: {}
      devicemodel: {}
      dhcpserver: {}
      displayname: {}
      dns: {}
      domainidnname: {}
      domainname: {}
      domainreferringips: {}
      domainreferringsubnets: {}
      domainstatus: {}
      downloadurl: {}
      email: {}
      emailaddress: {}
      employeehealthstatus: {}
      employeeresponsestatus: {}
      entryid: {}
      expirationdate: {}
      feedrelatedindicators: {}
      fileextension: {}
      filetype: {}
      firstname: {}
      firstseenbysource: {}
      geocountry: {}
      geolocation: {}
      givenname: {}
      groups: {}
      hostname: {}
      imphash: {}
      indicatoridentification: {}
      internal: {}
      ipaddress: {}
      jobcode: {}
      jobfamily: {}
      jobfunction: {}
      jobtitle: {}
      lastname: {}
      lastseenbysource: {}
      leadership: {}
      location: {}
      locationregion: {}
      macaddress: {}
      malwarefamily: {}
      malwaretypes: {}
      manageremailaddress: {}
      managername: {}
      md5: {}
      memory: {}
      merge: {}
      mitrealiases: {}
      mitrecontributors: {}
      mitrecreated: {}
      mitredatasources: {}
      mitredefensebypassed: {}
      mitredescription: {}
      mitredetection: {}
      mitreextendedaliases: {}
      mitreexternalreferences: {}
      mitreid: {}
      mitreimpacttype: {}
      mitrekillchainphases: {}
      mitrelabels: {}
      mitremodified: {}
      mitrename: {}
      mitrepermissionsrequired: {}
      mitreplatforms: {}
      mitresystemrequirements: {}
      mitretactics: {}
      mitretype: {}
      mitreversion: {}
      mobilephone: {}
      name: {}
      namefield: {}
      nameservers: {}
      office365category: {}
      office365expressroute: {}
      office365required: {}
      operatingsystem: {}
      operatingsystemversion: {}
      organization: {}
      organizationalunitou: {}
      osversion: {}
      path: {}
      personalemail: {}
      port: {}
      positivedetections: {}
      primarymotivation: {}
      processor: {}
      processors: {}
      published: {}
      quarantined: {}
      rawaddress: {}
      recordedfutureevidencedetails: {}
      region: {}
      registrantcountry: {}
      registrantemail: {}
      registrantname: {}
      registrantphone: {}
      registrarabuseemail: {}
      registrarabusephone: {}
      registrarname: {}
      relatedIncidents: {}
      reportedby: {}
      reportscount: {}
      reputation: {}
      riskiqassetaddedtoinventory: {}
      riskiqassetbrands: {}
      riskiqassetconfidence: {}
      riskiqassetcves: {}
      riskiqassetenterpriseasset: {}
      riskiqassetfirstseen: {}
      riskiqassetinventorystatus: {}
      riskiqassetlastseen: {}
      riskiqassetlastupdated: {}
      riskiqassetorganizations: {}
      riskiqassetpriority: {}
      riskiqassettags: {}
      riskiqassettype: {}
      riskiqassetuuid: {}
      safebreachattackids: {}
      safebreachinsightids: {}
      safebreachisbehavioral: {}
      safebreachremediationstatus: {}
      safebreachseverity: {}
      safebreachseverityscore: {}
      seenNow: {}
      service: {}
      sha1: {}
      sha256: {}
      sha512: {}
      signatureauthentihash: {}
      signaturecopyright: {}
      signaturedescription: {}
      signaturefileversion: {}
      signatureinternalname: {}
      signed: {}
      siscategory: {}
      sisexpiration: {}
      sismalwaretype: {}
      sismatchtype: {}
      sixgillactor: {}
      sixgilldescription: {}
      sixgillfeedid: {}
      sixgillfeedname: {}
      sixgillindicatorid: {}
      sixgilllanguage: {}
      sixgillmitreattcktactic: {}
      sixgillmitreattcktechnique: {}
      sixgillpostreference: {}
      sixgillposttitle: {}
      sixgillsource: {}
      sixgillvirustotaldetectionrate: {}
      sixgillvirustotalurl: {}
      size: {}
      source: {}
      sourceTimeStamp: {}
      sourceoriginalseverity: {}
      ssdeep: {}
      state: {}
      stixaliases: {}
      stixdescription: {}
      stixgoals: {}
      stixid: {}
      stixismalwarefamily: {}
      stixkillchainphases: {}
      stixmalwaretypes: {}
      stixprimarymotivation: {}
      stixresourcelevel: {}
      stixroles: {}
      stixsecondarymotivations: {}
      stixsophistication: {}
      stixthreatactortypes: {}
      stixtooltypes: {}
      stixtoolversion: {}
      streetaddress: {}
      subdomains: {}
      surname: {}
      tags:
        simple: HAFNIUM, Exchange
      threattypes: {}
      title: {}
      trafficlightprotocol: {}
      type:
        simple: CVE
      updateddate: {}
      username: {}
      value:
        complex:
          root: CVE
          accessor: ID
      workphone: {}
      xdrstatus: {}
      zipcode: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1140,
          "y": 690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "9":
    id: "9"
    taskid: e8d5557f-4299-483c-8528-415c6dfc1ada
    type: regular
    task:
      id: e8d5557f-4299-483c-8528-415c6dfc1ada
      version: -1
      name: Create IP's indicators
      description: Create HAFNIUM IP's indicators
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "13"
    scriptarguments:
      abusetype: {}
      accounttype: {}
      actor: {}
      admincountry: {}
      adminemail: {}
      adminname: {}
      adminphone: {}
      asn: {}
      assignedrole: {}
      assigneduser: {}
      associatedfilenames: {}
      associations: {}
      biosversion: {}
      campaign:
        simple: HAFNIUM
      category: {}
      chronicleassethostname: {}
      chronicleassetip: {}
      chronicleassetmac: {}
      chronicleassetproductid: {}
      chronicleassetsummary: {}
      chronicleisolatedhostname: {}
      chronicleisolatedip: {}
      chroniclepotentiallyblockedip: {}
      city: {}
      costcenter: {}
      costcentercode: {}
      countryname: {}
      creationdate: {}
      cryptocurrencyaddresstype: {}
      customFields: {}
      cvedescription: {}
      cvemodified: {}
      cvss: {}
      cyjaxindustrytypes: {}
      cyjaxtechniquestacticsprocedures: {}
      department: {}
      description: {}
      detectionengines: {}
      devicemodel: {}
      dhcpserver: {}
      displayname: {}
      dns: {}
      domainidnname: {}
      domainname: {}
      domainreferringips: {}
      domainreferringsubnets: {}
      domainstatus: {}
      downloadurl: {}
      email: {}
      emailaddress: {}
      employeehealthstatus: {}
      employeeresponsestatus: {}
      entryid: {}
      expirationdate: {}
      feedrelatedindicators: {}
      fileextension: {}
      filetype: {}
      firstname: {}
      firstseenbysource: {}
      geocountry: {}
      geolocation: {}
      givenname: {}
      groups: {}
      hostname: {}
      imphash: {}
      indicatoridentification: {}
      internal: {}
      ipaddress: {}
      jobcode: {}
      jobfamily: {}
      jobfunction: {}
      jobtitle: {}
      lastname: {}
      lastseenbysource: {}
      leadership: {}
      location: {}
      locationregion: {}
      macaddress: {}
      malwarefamily: {}
      malwaretypes: {}
      manageremailaddress: {}
      managername: {}
      md5: {}
      memory: {}
      merge: {}
      mitrealiases: {}
      mitrecontributors: {}
      mitrecreated: {}
      mitredatasources: {}
      mitredefensebypassed: {}
      mitredescription: {}
      mitredetection: {}
      mitreextendedaliases: {}
      mitreexternalreferences: {}
      mitreid: {}
      mitreimpacttype: {}
      mitrekillchainphases: {}
      mitrelabels: {}
      mitremodified: {}
      mitrename: {}
      mitrepermissionsrequired: {}
      mitreplatforms: {}
      mitresystemrequirements: {}
      mitretactics: {}
      mitretype: {}
      mitreversion: {}
      mobilephone: {}
      name: {}
      namefield: {}
      nameservers: {}
      office365category: {}
      office365expressroute: {}
      office365required: {}
      operatingsystem: {}
      operatingsystemversion: {}
      organization: {}
      organizationalunitou: {}
      osversion: {}
      path: {}
      personalemail: {}
      port: {}
      positivedetections: {}
      primarymotivation: {}
      processor: {}
      processors: {}
      published: {}
      quarantined: {}
      rawaddress: {}
      recordedfutureevidencedetails: {}
      region: {}
      registrantcountry: {}
      registrantemail: {}
      registrantname: {}
      registrantphone: {}
      registrarabuseemail: {}
      registrarabusephone: {}
      registrarname: {}
      relatedIncidents: {}
      reportedby: {}
      reportscount: {}
      reputation: {}
      riskiqassetaddedtoinventory: {}
      riskiqassetbrands: {}
      riskiqassetconfidence: {}
      riskiqassetcves: {}
      riskiqassetenterpriseasset: {}
      riskiqassetfirstseen: {}
      riskiqassetinventorystatus: {}
      riskiqassetlastseen: {}
      riskiqassetlastupdated: {}
      riskiqassetorganizations: {}
      riskiqassetpriority: {}
      riskiqassettags: {}
      riskiqassettype: {}
      riskiqassetuuid: {}
      safebreachattackids: {}
      safebreachinsightids: {}
      safebreachisbehavioral: {}
      safebreachremediationstatus: {}
      safebreachseverity: {}
      safebreachseverityscore: {}
      seenNow: {}
      service: {}
      sha1: {}
      sha256: {}
      sha512: {}
      signatureauthentihash: {}
      signaturecopyright: {}
      signaturedescription: {}
      signaturefileversion: {}
      signatureinternalname: {}
      signed: {}
      siscategory: {}
      sisexpiration: {}
      sismalwaretype: {}
      sismatchtype: {}
      sixgillactor: {}
      sixgilldescription: {}
      sixgillfeedid: {}
      sixgillfeedname: {}
      sixgillindicatorid: {}
      sixgilllanguage: {}
      sixgillmitreattcktactic: {}
      sixgillmitreattcktechnique: {}
      sixgillpostreference: {}
      sixgillposttitle: {}
      sixgillsource: {}
      sixgillvirustotaldetectionrate: {}
      sixgillvirustotalurl: {}
      size: {}
      source: {}
      sourceTimeStamp: {}
      sourceoriginalseverity: {}
      ssdeep: {}
      state: {}
      stixaliases: {}
      stixdescription: {}
      stixgoals: {}
      stixid: {}
      stixismalwarefamily: {}
      stixkillchainphases: {}
      stixmalwaretypes: {}
      stixprimarymotivation: {}
      stixresourcelevel: {}
      stixroles: {}
      stixsecondarymotivations: {}
      stixsophistication: {}
      stixthreatactortypes: {}
      stixtooltypes: {}
      stixtoolversion: {}
      streetaddress: {}
      subdomains: {}
      surname: {}
      tags:
        simple: HAFNIUM, Exhange
      threattypes: {}
      title: {}
      trafficlightprotocol: {}
      type:
        simple: IP
      updateddate: {}
      username: {}
      value:
        complex:
          root: IP
          accessor: Address
      workphone: {}
      xdrstatus: {}
      zipcode: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 680,
          "y": 690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "10":
    id: "10"
    taskid: 5fea3426-4697-40a0-8413-4f51a87118ad
    type: regular
    task:
      id: 5fea3426-4697-40a0-8413-4f51a87118ad
      version: -1
      name: Create SHA256 hashes indicators
      description: Create HAFNIUM SHA256 hashes indicators
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      abusetype: {}
      accounttype: {}
      actor: {}
      admincountry: {}
      adminemail: {}
      adminname: {}
      adminphone: {}
      asn: {}
      assignedrole: {}
      assigneduser: {}
      associatedfilenames: {}
      associations: {}
      biosversion: {}
      campaign: {}
      category: {}
      chronicleassethostname: {}
      chronicleassetip: {}
      chronicleassetmac: {}
      chronicleassetproductid: {}
      chronicleassetsummary: {}
      chronicleisolatedhostname: {}
      chronicleisolatedip: {}
      chroniclepotentiallyblockedip: {}
      city: {}
      costcenter: {}
      costcentercode: {}
      countryname: {}
      creationdate: {}
      cryptocurrencyaddresstype: {}
      customFields: {}
      cvedescription: {}
      cvemodified: {}
      cvss: {}
      cyjaxindustrytypes: {}
      cyjaxtechniquestacticsprocedures: {}
      department: {}
      description: {}
      detectionengines: {}
      devicemodel: {}
      dhcpserver: {}
      displayname: {}
      dns: {}
      domainidnname: {}
      domainname: {}
      domainreferringips: {}
      domainreferringsubnets: {}
      domainstatus: {}
      downloadurl: {}
      email: {}
      emailaddress: {}
      employeehealthstatus: {}
      employeeresponsestatus: {}
      entryid: {}
      expirationdate: {}
      feedrelatedindicators: {}
      fileextension: {}
      filetype: {}
      firstname: {}
      firstseenbysource: {}
      geocountry: {}
      geolocation: {}
      givenname: {}
      groups: {}
      hostname: {}
      imphash: {}
      indicatoridentification: {}
      internal: {}
      ipaddress: {}
      jobcode: {}
      jobfamily: {}
      jobfunction: {}
      jobtitle: {}
      lastname: {}
      lastseenbysource: {}
      leadership: {}
      location: {}
      locationregion: {}
      macaddress: {}
      malwarefamily: {}
      malwaretypes: {}
      manageremailaddress: {}
      managername: {}
      md5: {}
      memory: {}
      merge: {}
      mitrealiases: {}
      mitrecontributors: {}
      mitrecreated: {}
      mitredatasources: {}
      mitredefensebypassed: {}
      mitredescription: {}
      mitredetection: {}
      mitreextendedaliases: {}
      mitreexternalreferences: {}
      mitreid: {}
      mitreimpacttype: {}
      mitrekillchainphases: {}
      mitrelabels: {}
      mitremodified: {}
      mitrename: {}
      mitrepermissionsrequired: {}
      mitreplatforms: {}
      mitresystemrequirements: {}
      mitretactics: {}
      mitretype: {}
      mitreversion: {}
      mobilephone: {}
      name: {}
      namefield: {}
      nameservers: {}
      office365category: {}
      office365expressroute: {}
      office365required: {}
      operatingsystem: {}
      operatingsystemversion: {}
      organization: {}
      organizationalunitou: {}
      osversion: {}
      path: {}
      personalemail: {}
      port: {}
      positivedetections: {}
      primarymotivation: {}
      processor: {}
      processors: {}
      published: {}
      quarantined: {}
      rawaddress: {}
      recordedfutureevidencedetails: {}
      region: {}
      registrantcountry: {}
      registrantemail: {}
      registrantname: {}
      registrantphone: {}
      registrarabuseemail: {}
      registrarabusephone: {}
      registrarname: {}
      relatedIncidents: {}
      reportedby: {}
      reportscount: {}
      reputation: {}
      riskiqassetaddedtoinventory: {}
      riskiqassetbrands: {}
      riskiqassetconfidence: {}
      riskiqassetcves: {}
      riskiqassetenterpriseasset: {}
      riskiqassetfirstseen: {}
      riskiqassetinventorystatus: {}
      riskiqassetlastseen: {}
      riskiqassetlastupdated: {}
      riskiqassetorganizations: {}
      riskiqassetpriority: {}
      riskiqassettags: {}
      riskiqassettype: {}
      riskiqassetuuid: {}
      safebreachattackids: {}
      safebreachinsightids: {}
      safebreachisbehavioral: {}
      safebreachremediationstatus: {}
      safebreachseverity: {}
      safebreachseverityscore: {}
      seenNow: {}
      service: {}
      sha1: {}
      sha256: {}
      sha512: {}
      signatureauthentihash: {}
      signaturecopyright: {}
      signaturedescription: {}
      signaturefileversion: {}
      signatureinternalname: {}
      signed: {}
      siscategory: {}
      sisexpiration: {}
      sismalwaretype: {}
      sismatchtype: {}
      sixgillactor: {}
      sixgilldescription: {}
      sixgillfeedid: {}
      sixgillfeedname: {}
      sixgillindicatorid: {}
      sixgilllanguage: {}
      sixgillmitreattcktactic: {}
      sixgillmitreattcktechnique: {}
      sixgillpostreference: {}
      sixgillposttitle: {}
      sixgillsource: {}
      sixgillvirustotaldetectionrate: {}
      sixgillvirustotalurl: {}
      size: {}
      source: {}
      sourceTimeStamp: {}
      sourceoriginalseverity: {}
      ssdeep: {}
      state: {}
      stixaliases: {}
      stixdescription: {}
      stixgoals: {}
      stixid: {}
      stixismalwarefamily: {}
      stixkillchainphases: {}
      stixmalwaretypes: {}
      stixprimarymotivation: {}
      stixresourcelevel: {}
      stixroles: {}
      stixsecondarymotivations: {}
      stixsophistication: {}
      stixthreatactortypes: {}
      stixtooltypes: {}
      stixtoolversion: {}
      streetaddress: {}
      subdomains: {}
      surname: {}
      tags:
        simple: HAFNIUM
      threattypes: {}
      title: {}
      trafficlightprotocol: {}
      type:
        simple: File
      updateddate: {}
      username: {}
      value:
        complex:
          root: File
          accessor: SHA256
      workphone: {}
      xdrstatus: {}
      zipcode: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 240,
          "y": 690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "11":
    id: "11"
    taskid: 9ee607da-bd11-42c6-8a70-1af41aa269b2
    type: regular
    task:
      id: 9ee607da-bd11-42c6-8a70-1af41aa269b2
      version: -1
      name: Create MD5 hashes indicators
      description: Create HAFNIUM MD5 hashes indicators
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "15"
    scriptarguments:
      abusetype: {}
      accounttype: {}
      actor: {}
      admincountry: {}
      adminemail: {}
      adminname: {}
      adminphone: {}
      asn: {}
      assignedrole: {}
      assigneduser: {}
      associatedfilenames: {}
      associations: {}
      biosversion: {}
      campaign: {}
      category: {}
      chronicleassethostname: {}
      chronicleassetip: {}
      chronicleassetmac: {}
      chronicleassetproductid: {}
      chronicleassetsummary: {}
      chronicleisolatedhostname: {}
      chronicleisolatedip: {}
      chroniclepotentiallyblockedip: {}
      city: {}
      costcenter: {}
      costcentercode: {}
      countryname: {}
      creationdate: {}
      cryptocurrencyaddresstype: {}
      customFields: {}
      cvedescription: {}
      cvemodified: {}
      cvss: {}
      cyjaxindustrytypes: {}
      cyjaxtechniquestacticsprocedures: {}
      department: {}
      description: {}
      detectionengines: {}
      devicemodel: {}
      dhcpserver: {}
      displayname: {}
      dns: {}
      domainidnname: {}
      domainname: {}
      domainreferringips: {}
      domainreferringsubnets: {}
      domainstatus: {}
      downloadurl: {}
      email: {}
      emailaddress: {}
      employeehealthstatus: {}
      employeeresponsestatus: {}
      entryid: {}
      expirationdate: {}
      feedrelatedindicators: {}
      fileextension: {}
      filetype: {}
      firstname: {}
      firstseenbysource: {}
      geocountry: {}
      geolocation: {}
      givenname: {}
      groups: {}
      hostname: {}
      imphash: {}
      indicatoridentification: {}
      internal: {}
      ipaddress: {}
      jobcode: {}
      jobfamily: {}
      jobfunction: {}
      jobtitle: {}
      lastname: {}
      lastseenbysource: {}
      leadership: {}
      location: {}
      locationregion: {}
      macaddress: {}
      malwarefamily: {}
      malwaretypes: {}
      manageremailaddress: {}
      managername: {}
      md5: {}
      memory: {}
      merge: {}
      mitrealiases: {}
      mitrecontributors: {}
      mitrecreated: {}
      mitredatasources: {}
      mitredefensebypassed: {}
      mitredescription: {}
      mitredetection: {}
      mitreextendedaliases: {}
      mitreexternalreferences: {}
      mitreid: {}
      mitreimpacttype: {}
      mitrekillchainphases: {}
      mitrelabels: {}
      mitremodified: {}
      mitrename: {}
      mitrepermissionsrequired: {}
      mitreplatforms: {}
      mitresystemrequirements: {}
      mitretactics: {}
      mitretype: {}
      mitreversion: {}
      mobilephone: {}
      name: {}
      namefield: {}
      nameservers: {}
      office365category: {}
      office365expressroute: {}
      office365required: {}
      operatingsystem: {}
      operatingsystemversion: {}
      organization: {}
      organizationalunitou: {}
      osversion: {}
      path: {}
      personalemail: {}
      port: {}
      positivedetections: {}
      primarymotivation: {}
      processor: {}
      processors: {}
      published: {}
      quarantined: {}
      rawaddress: {}
      recordedfutureevidencedetails: {}
      region: {}
      registrantcountry: {}
      registrantemail: {}
      registrantname: {}
      registrantphone: {}
      registrarabuseemail: {}
      registrarabusephone: {}
      registrarname: {}
      relatedIncidents: {}
      reportedby: {}
      reportscount: {}
      reputation: {}
      riskiqassetaddedtoinventory: {}
      riskiqassetbrands: {}
      riskiqassetconfidence: {}
      riskiqassetcves: {}
      riskiqassetenterpriseasset: {}
      riskiqassetfirstseen: {}
      riskiqassetinventorystatus: {}
      riskiqassetlastseen: {}
      riskiqassetlastupdated: {}
      riskiqassetorganizations: {}
      riskiqassetpriority: {}
      riskiqassettags: {}
      riskiqassettype: {}
      riskiqassetuuid: {}
      safebreachattackids: {}
      safebreachinsightids: {}
      safebreachisbehavioral: {}
      safebreachremediationstatus: {}
      safebreachseverity: {}
      safebreachseverityscore: {}
      seenNow: {}
      service: {}
      sha1: {}
      sha256: {}
      sha512: {}
      signatureauthentihash: {}
      signaturecopyright: {}
      signaturedescription: {}
      signaturefileversion: {}
      signatureinternalname: {}
      signed: {}
      siscategory: {}
      sisexpiration: {}
      sismalwaretype: {}
      sismatchtype: {}
      sixgillactor: {}
      sixgilldescription: {}
      sixgillfeedid: {}
      sixgillfeedname: {}
      sixgillindicatorid: {}
      sixgilllanguage: {}
      sixgillmitreattcktactic: {}
      sixgillmitreattcktechnique: {}
      sixgillpostreference: {}
      sixgillposttitle: {}
      sixgillsource: {}
      sixgillvirustotaldetectionrate: {}
      sixgillvirustotalurl: {}
      size: {}
      source: {}
      sourceTimeStamp: {}
      sourceoriginalseverity: {}
      ssdeep: {}
      state: {}
      stixaliases: {}
      stixdescription: {}
      stixgoals: {}
      stixid: {}
      stixismalwarefamily: {}
      stixkillchainphases: {}
      stixmalwaretypes: {}
      stixprimarymotivation: {}
      stixresourcelevel: {}
      stixroles: {}
      stixsecondarymotivations: {}
      stixsophistication: {}
      stixthreatactortypes: {}
      stixtooltypes: {}
      stixtoolversion: {}
      streetaddress: {}
      subdomains: {}
      surname: {}
      tags:
        simple: HAFNIUM
      threattypes: {}
      title: {}
      trafficlightprotocol: {}
      type:
        simple: File
      updateddate: {}
      username: {}
      value:
        complex:
          root: File
          accessor: MD5
      workphone: {}
      xdrstatus: {}
      zipcode: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -210,
          "y": 690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "12":
    id: "12"
    taskid: 6454dc97-2902-4a5b-8fce-82fd38e7f59c
    type: regular
    task:
      id: 6454dc97-2902-4a5b-8fce-82fd38e7f59c
      version: -1
      name: Enrich CVE's indicators
      description: Enrich CVE's indicators
      script: Builtin|||enrichIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      indicatorsValues:
        complex:
          root: CVE
          accessor: ID
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1140,
          "y": 890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "13":
    id: "13"
    taskid: 410c258c-49da-424f-8c91-b7bc97140583
    type: regular
    task:
      id: 410c258c-49da-424f-8c91-b7bc97140583
      version: -1
      name: Enrich IP's indicators
      description: Enrich IP's indicators
      script: Builtin|||enrichIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      indicatorsValues:
        complex:
          root: IP
          accessor: Address
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 680,
          "y": 890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "14":
    id: "14"
    taskid: b380bf7a-f4ba-46c5-8f20-12f4f112543e
    type: regular
    task:
      id: b380bf7a-f4ba-46c5-8f20-12f4f112543e
      version: -1
      name: Enrich SHA256 hashes indicators
      description: Enrich SHA256 hashes indicators
      script: Builtin|||enrichIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      indicatorsValues:
        complex:
          root: File
          accessor: SHA256
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 240,
          "y": 890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "15":
    id: "15"
    taskid: 67b9fced-ed80-4dce-89bf-43f035337e1b
    type: regular
    task:
      id: 67b9fced-ed80-4dce-89bf-43f035337e1b
      version: -1
      name: Enrich SHA256 hashes indicators
      description: commands.local.cmd.enrich.indicators
      script: Builtin|||enrichIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      indicatorsValues:
        complex:
          root: File
          accessor: MD5
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -210,
          "y": 890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "16":
    id: "16"
    taskid: 080d2053-2b5b-4529-8fb9-065867d5db0e
    type: title
    task:
      id: 080d2053-2b5b-4529-8fb9-065867d5db0e
      version: -1
      name: Hunt IOCs
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "18"
      - "19"
      - "17"
      - "41"
      - "64"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 1080
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "17":
    id: "17"
    taskid: b04b1b51-e6bc-4a8b-8877-4122e4893698
    type: playbook
    task:
      id: b04b1b51-e6bc-4a8b-8877-4122e4893698
      version: -1
      name: Search Endpoint by CVE - Generic
      playbookName: Search Endpoint by CVE - Generic
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      CVE_ID:
        complex:
          root: CVE
          accessor: ID
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 740,
          "y": 1360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
  "18":
    id: "18"
    taskid: 35eb6f24-8f3f-4046-80c1-2b474e55dd31
    type: playbook
    task:
      id: 35eb6f24-8f3f-4046-80c1-2b474e55dd31
      version: -1
      name: Search Endpoints By Hash - Generic V2
      playbookName: Search Endpoints By Hash - Generic V2
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      MD5Hash:
        complex:
          root: File
          accessor: MD5
      SHA1Hash:
        complex:
          root: File
          accessor: SHA1
      SHA256Hash:
        complex:
          root: File
          accessor: SHA256
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 190,
          "y": 1360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
  "19":
    id: "19"
    taskid: ea0d7d60-94ce-4dc8-8718-b4b938ca183b
    type: playbook
    task:
      id: ea0d7d60-94ce-4dc8-8718-b4b938ca183b
      version: -1
      name: Palo Alto Networks - Hunting And Threat Detection
      playbookName: Palo Alto Networks - Hunting And Threat Detection
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      IPAddresses:
        complex:
          root: IP
          accessor: Address
      InternalDomainName: {}
      InternalHostRegex: {}
      InternalRange: {}
      MD5:
        complex:
          root: File
          accessor: MD5
      SHA1: {}
      SHA256:
        complex:
          root: File
          accessor: SHA256
      URLDomain: {}
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 470,
          "y": 1230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
  "23":
    id: "23"
    taskid: 589ca3cf-4df8-4ab9-8534-4312c6e87caf
    type: regular
    task:
      id: 589ca3cf-4df8-4ab9-8534-4312c6e87caf
      version: -1
      name: Investigate further
      description: |
        Further investigate the incident (endpoints, the entry point, etcâ€™)
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "24"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 4910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "24":
    id: "24"
    taskid: faf36b96-6c01-4a37-85fb-c07ed3b56c42
    type: title
    task:
      id: faf36b96-6c01-4a37-85fb-c07ed3b56c42
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 5080
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "25":
    id: "25"
    taskid: 217657f1-333a-47d8-88cd-31cefb7575ba
    type: regular
    task:
      id: 217657f1-333a-47d8-88cd-31cefb7575ba
      version: -1
      name: Search XDR incidents for HAFNIUM activity
      description: |
        Search XDR incidents for HAFNIUM
      scriptName: SearchIncidentsV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      details: {}
      fromclosedate: {}
      fromdate: {}
      fromduedate: {}
      id: {}
      level: {}
      name: {}
      notstatus: {}
      owner: {}
      page: {}
      query:
        simple: xdralerts.name:"Uncommon net group execution" or xdralerts.name:"Multiple
          Discovery Commands" or xdralerts.name:"Exchange process writing aspx files"
          or xdralerts.name:"Behavioral Threat Detected"
      reason: {}
      size: {}
      sort: {}
      status: {}
      toclosedate: {}
      todate: {}
      toduedate: {}
      type: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1420,
          "y": 1740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "26":
    id: "26"
    taskid: 46b7a080-67a8-4671-8a1a-24e4009256d4
    type: title
    task:
      id: 46b7a080-67a8-4671-8a1a-24e4009256d4
      version: -1
      name: Done Hunting
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "67"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 3060
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "27":
    id: "27"
    taskid: 26da7f5a-b5c7-42e7-828a-2b158e0d9534
    type: playbook
    task:
      id: 26da7f5a-b5c7-42e7-828a-2b158e0d9534
      version: -1
      name: Block Indicators - Generic v2
      playbookName: Block Indicators - Generic v2
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      AutoCommit:
        simple: "No"
      CustomBlockRule:
        simple: "True"
      CustomURLCategory:
        simple: Demisto Remediation - Malicious URLs
      DAG: {}
      EDLServerIP: {}
      IP:
        complex:
          root: IP
          accessor: Address
          transformers:
          - operator: uniq
      IPBlacklistMiner: {}
      IPListName: {}
      LogForwarding: {}
      MD5:
        complex:
          root: File
          accessor: MD5
      SHA256:
        complex:
          root: File
          accessor: SHA256
      StaticAddressGroup: {}
      URL: {}
      URLBlacklistMiner: {}
      URLListName:
        simple: Demisto Remediation - URL EDL
      Username: {}
      categories: {}
      device-group: {}
      type: {}
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 700,
          "y": 3520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "28":
    id: "28"
    taskid: 3e8a4c0d-f00f-4d3a-8483-11bc7f394883
    type: regular
    task:
      id: 3e8a4c0d-f00f-4d3a-8483-11bc7f394883
      version: -1
      name: Collect indicators from Azure GitHub
      description: Sends http request. Returns the response as json.
      scriptName: http
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      body: {}
      filename: {}
      headers: {}
      insecure: {}
      method:
        simple: GET
      password: {}
      proxy: {}
      saveAsFile: {}
      unsecure: {}
      url:
        simple: https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Sample%20Data/Feeds/MSTICIoCs-ExchangeServerVulnerabilitiesDisclosedMarch2021.csv
      username: {}
    reputationcalc: 2
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 940,
          "y": 350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "29":
    id: "29"
    taskid: 1de105cc-c138-4d8d-8af7-d3c1d602c846
    type: condition
    task:
      id: 1de105cc-c138-4d8d-8af7-d3c1d602c846
      version: -1
      name: Block indicators automatically?
      description: Checks whether IOCs associated with the incident can be blocked
        automatically.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "30"
      "yes":
      - "27"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.BlockIndicatorsAutomatically
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 470,
          "y": 3340
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "30":
    id: "30"
    taskid: 8eaa4bd7-cdce-431e-8911-a77ded68b1cc
    type: regular
    task:
      id: 8eaa4bd7-cdce-431e-8911-a77ded68b1cc
      version: -1
      name: Manually block indicators
      description: Manually block the IOCs in the relevant systems.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "31"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 230,
          "y": 3520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "31":
    id: "31"
    taskid: 9e77dd59-559b-43b8-81f8-07e8cd1593c1
    type: title
    task:
      id: 9e77dd59-559b-43b8-81f8-07e8cd1593c1
      version: -1
      name: Check Patch Level
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "32"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 3700
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "32":
    id: "32"
    taskid: 85b6d68e-5172-4b97-8d80-609779a69343
    type: condition
    task:
      id: 85b6d68e-5172-4b97-8d80-609779a69343
      version: -1
      name: Check patch levels of Exchange Server
      description: "Is the Exchange patched with the March 2021 security updates?\n\
        If needed, refer to Microsoft post about the patches: \nhttps://techcommunity.microsoft.com/t5/exchange-team-blog/released-march-2021-exchange-server-security-updates/ba-p/2175901\n\
        \ "
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "No":
      - "33"
      "Yes":
      - "34"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 3845
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "33":
    id: "33"
    taskid: 16e82d70-ddfd-40ca-86de-2c00d384f2a4
    type: regular
    task:
      id: 16e82d70-ddfd-40ca-86de-2c00d384f2a4
      version: -1
      name: Set Exchange patched flag to false
      description: Sets Exchange patched flag to false.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "35"
    scriptarguments:
      append: {}
      key:
        simple: Set Exchange patched flag to false
      stringify: {}
      value:
        simple: "False"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 690,
          "y": 4020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "34":
    id: "34"
    taskid: 7b0fbd0e-454a-4bf6-8d13-343c61c25d7e
    type: regular
    task:
      id: 7b0fbd0e-454a-4bf6-8d13-343c61c25d7e
      version: -1
      name: Set Exchange patched flag to true
      description: Sets Exchange patched flag to true.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "35"
    scriptarguments:
      append: {}
      key:
        simple: ExchangesPatched
      stringify: {}
      value:
        simple: "True"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 240,
          "y": 4020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "35":
    id: "35"
    taskid: 3cc9dd63-d1dd-42d2-8ba8-2fb7f8d8182e
    type: title
    task:
      id: 3cc9dd63-d1dd-42d2-8ba8-2fb7f8d8182e
      version: -1
      name: Mitigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "36"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 4195
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "36":
    id: "36"
    taskid: 4542f6fa-4cfd-4985-850f-44181834bdbd
    type: condition
    task:
      id: 4542f6fa-4cfd-4985-850f-44181834bdbd
      version: -1
      name: Is the Exchange Server patched?
      description: Checks the user answer if the Exchange Server patched
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "37"
      "yes":
      - "23"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: ExchangesPatched
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 470,
          "y": 4335
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "37":
    id: "37"
    taskid: 2b97e0ea-8dde-4492-868b-115e7b81cecd
    type: condition
    task:
      id: 2b97e0ea-8dde-4492-868b-115e7b81cecd
      version: -1
      name: Is it possible to patch the Exchange Server?
      description: Check whether it is possible to patch the Exchange Server
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "No":
      - "39"
      "Yes":
      - "38"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 4520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "38":
    id: "38"
    taskid: df6a8c79-acaf-462b-8669-7498f8d1dd1a
    type: regular
    task:
      id: df6a8c79-acaf-462b-8669-7498f8d1dd1a
      version: -1
      name: Install March 2021 Exchange security patches
      description: |-
        The March 2021 security patches found here:
        https://techcommunity.microsoft.com/t5/exchange-team-blog/released-march-2021-exchange-server-security-updates/ba-p/2175901
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "23"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 260,
          "y": 4690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "39":
    id: "39"
    taskid: 10757794-c58f-47ea-8bc8-592e8dbfd4d2
    type: regular
    task:
      id: 10757794-c58f-47ea-8bc8-592e8dbfd4d2
      version: -1
      name: Interim mitigations
      description: "Follow Microsoft blog post about the interim mitigations.\nThe\
        \ blog post explains how to configure the interim mitigations and their rollback\
        \ if needed. \nhttps://msrc-blog.microsoft.com/2021/03/05/microsoft-exchange-server-vulnerabilities-mitigations-march-2021/\n\
        \nNotes:\n- These mitigations are not a remediation if your Exchange servers\
        \ have already been compromised, nor are they full protection against attack\n\
        - This should only be used as a temporary mitigation until Exchange servers\
        \ can be fully patched. \n"
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "23"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -170,
          "y": 4690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "40":
    id: "40"
    taskid: 449be8a7-5eac-416c-8650-05005ae08048
    type: condition
    task:
      id: 449be8a7-5eac-416c-8650-05005ae08048
      version: -1
      name: 'Is Cortex XDR enabled? '
      description: Checks if the Cortex XDR instance is enabled
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "26"
      "yes":
      - "25"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                    ignorecase: true
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Cortex XDR - IR
                    ignorecase: true
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1200,
          "y": 1560
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "41":
    id: "41"
    taskid: e3ab3796-2ceb-4a2b-8d94-6445634288a5
    type: title
    task:
      id: e3ab3796-2ceb-4a2b-8d94-6445634288a5
      version: -1
      name: Search Activities Related To the 0-Day Exploits
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "42"
      - "43"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1340,
          "y": 1260
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "42":
    id: "42"
    taskid: 831693b6-5a98-4973-8f79-61f24401b40e
    type: title
    task:
      id: 831693b6-5a98-4973-8f79-61f24401b40e
      version: -1
      name: XDR Related Incidents
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "40"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1200,
          "y": 1410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "43":
    id: "43"
    taskid: e7a27e27-8fe3-4651-8a70-c42b88b4ba08
    type: title
    task:
      id: e7a27e27-8fe3-4651-8a70-c42b88b4ba08
      version: -1
      name: Hunt Windows Events
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "44"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2360,
          "y": 1410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "44":
    id: "44"
    taskid: fe366fef-d73b-43bb-8ad4-7025b81cae42
    type: condition
    task:
      id: fe366fef-d73b-43bb-8ad4-7025b81cae42
      version: -1
      name: Is SIEM Enabled?
      description: Returns 'yes' if integration brand is available. Otherwise returns
        'no'
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "45"
      Qradar:
      - "58"
      Splunk:
      - "57"
    separatecontext: false
    conditions:
    - label: Splunk
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: SplunkPy
                accessor: state
            iscontext: true
          right:
            value:
              simple: active
          ignorecase: true
    - label: Qradar
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: QRadar_v2
                accessor: state
            iscontext: true
          right:
            value:
              simple: active
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 2360,
          "y": 1540
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "45":
    id: "45"
    taskid: 71d2997e-dd26-417e-8340-969623243a66
    type: title
    task:
      id: 71d2997e-dd26-417e-8340-969623243a66
      version: -1
      name: 'Manually Hunt Windows Event Logs '
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "46"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1840,
          "y": 1740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "46":
    id: "46"
    taskid: 6bede89e-b4e9-4c2f-8b26-ea273464cf0b
    type: regular
    task:
      id: 6bede89e-b4e9-4c2f-8b26-ea273464cf0b
      version: -1
      name: Nishang PowerShell framework
      description: |-
        Look for Nishang Invoke-PowerShellTcpOneLine in Windows Event Logging:
        SecurityEvent  | where EventID == 4688  | where Process has_any (â€œpowershell.exeâ€, â€œPowerShell_ISE.exeâ€)  | where CommandLine has â€œ$client = New-Object System.Net.Sockets.TCPClientâ€
        Splunk query example:
        index="" sourcetype=â€œWinEventLogâ€ source=â€œWinEventLog:Securityâ€ EventCode=4104 Message=" Invoke-PowerShellTCP*"
        index="*" sourcetype=â€œWinEventLogâ€ source=â€œWinEventLog:Securityâ€ EventCode=4688 Creator_Process_Name=â€œpowershell.exeâ€ System.Net.Sockets.TCPClient
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "47"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1840,
          "y": 1900
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "47":
    id: "47"
    taskid: b9a8af1d-74c8-4e50-8866-13ba3a930fa6
    type: regular
    task:
      id: b9a8af1d-74c8-4e50-8866-13ba3a930fa6
      version: -1
      name: Powercat detection
      description: |-
        Look for downloads of PowerCat in cmd and Powershell command line logging in Windows Event Logs:
        SecurityEvent  | where EventID == 4688  | where Process has_any (â€œcmd.exeâ€, â€œpowershell.exeâ€, â€œPowerShell_ISE.exeâ€)  | where CommandLine has â€œhttps://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1â€
        Splunk query example:
        index="*" sourcetype=â€œWinEventLogâ€ source=â€œWinEventLog:Securityâ€ EventCode=4104 Message=â€œpowercatâ€
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "48"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1840,
          "y": 2085
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "48":
    id: "48"
    taskid: 1c910d42-6ecb-4535-8a60-2b5765de2cc7
    type: regular
    task:
      id: 1c910d42-6ecb-4535-8a60-2b5765de2cc7
      version: -1
      name: UMWorkerProcess.exe in Exchange creating abnormal content
      description: |-
        Look for Microsoft Exchange Serverâ€™s Unified Messaging service creating non-standard content on disk, which could indicate web shells or other malicious content, suggesting exploitation of CVE-2021-26858 vulnerability:
        DeviceFileEvents | where InitiatingProcessFileName == â€œUMWorkerProcess.exeâ€ | where FileName != â€œCacheCleanup.binâ€ | where FileName !endswith â€œ.txtâ€ | where FileName !endswith â€œ.LOGâ€ | where FileName !endswith â€œ.cfgâ€ | where FileName != â€œcleanup.binâ€
        Splunk query example:
        index=* sourcetype=WinEventLog source=â€œWinEventLog:Securityâ€ EventCode=4663 Object_Type=â€œFileâ€ (Object_Name=".php" OR Object_Name=".jsp" OR Object_Name=".js" OR Object_Name=".aspx" OR Object_Name=".asmx" OR Object_Name=".cfm" OR Object_Name="*.shtml") (Process_Name=â€œumworkerprocess.exeâ€ OR Process_Name=â€œUMService.exeâ€)
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "49"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1840,
          "y": 2285
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "49":
    id: "49"
    taskid: b240c42c-f06c-4326-8060-a2b94af172d1
    type: regular
    task:
      id: b240c42c-f06c-4326-8060-a2b94af172d1
      version: -1
      name: UMWorkerProcess.exe spawning
      description: |-
        Look for Microsoft Exchange Serverâ€™s Unified Messaging service spawning abnormal subprocesses, suggesting exploitation of CVE-2021-26857 vulnerability:
        DeviceProcessEvents | where InitiatingProcessFileName == â€œUMWorkerProcess.exeâ€ | where FileName != â€œwermgr.exeâ€ | where FileName != â€œWerFault.exeâ€
        Splunk Query example:
        index=* sourcetype=â€œWinEventLogâ€ source=â€œWinEventLog:Securityâ€ EventCode=4688 (Creator_Process_Name=â€œumworkerprocess.exeâ€ OR Creator_Process_Name=â€œUMService.exeâ€) NOT New_Process_Name=â€œUMWorkerProcess.exeâ€
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "50"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1840,
          "y": 2490
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "50":
    id: "50"
    taskid: 01a95c53-bd8e-479b-8428-e7c650b23d3a
    type: regular
    task:
      id: 01a95c53-bd8e-479b-8428-e7c650b23d3a
      version: -1
      name: IIS authentication bypass vulnerability
      description: |2-

        Look for Microsoft Exchange Serverâ€™s Unified Messaging service spawning abnormal subprocesses, suggesting exploitation of CVE-2021-26857 vulnerability:
        DeviceProcessEvents | where InitiatingProcessFileName == â€œUMWorkerProcess.exeâ€ | where FileName != â€œwermgr.exeâ€ | where FileName != â€œWerFault.exeâ€
        Splunk Query example:
        index=* sourcetype=â€œWinEventLogâ€ source=â€œWinEventLog:Securityâ€ EventCode=4688 (Creator_Process_Name=â€œumworkerprocess.exeâ€ OR Creator_Process_Name=â€œUMService.exeâ€) NOT New_Process_Name=â€œUMWorkerProcess.exeâ€
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "26"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1840,
          "y": 2685
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "51":
    id: "51"
    taskid: 649820b6-c3ad-43d4-8963-50a874b690a9
    type: regular
    task:
      id: 649820b6-c3ad-43d4-8963-50a874b690a9
      version: -1
      name: Nishang PowerShell event 4104
      description: Searches Splunk for events.
      script: '|||splunk-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "52"
    scriptarguments:
      app: {}
      batch_limit: {}
      earliest_time: {}
      event_limit: {}
      latest_time: {}
      query:
        simple: index="*" sourcetype="WinEventLog" source="WinEventLog:Security" EventCode=4104
          Message="* Invoke-PowerShellTCP*"
      update_context: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2360,
          "y": 1900
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "52":
    id: "52"
    taskid: f60dae88-0985-4063-8bd6-19954f48959f
    type: regular
    task:
      id: f60dae88-0985-4063-8bd6-19954f48959f
      version: -1
      name: Nishang PowerShell event 4688
      description: Searches Splunk for events.
      script: '|||splunk-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "53"
    scriptarguments:
      app: {}
      batch_limit: {}
      earliest_time: {}
      event_limit: {}
      latest_time: {}
      query:
        simple: index="*" sourcetype="WinEventLog" source="WinEventLog:Security" EventCode=4688
          Creator_Process_Name="powershell.exe" System.Net.Sockets.TCPClient
      update_context: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2360,
          "y": 2085
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "53":
    id: "53"
    taskid: f16e45b0-df19-4d5a-8496-afa775c0dcaf
    type: regular
    task:
      id: f16e45b0-df19-4d5a-8496-afa775c0dcaf
      version: -1
      name: Powercat detection
      description: Searches Splunk for events.
      script: '|||splunk-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "54"
    scriptarguments:
      app: {}
      batch_limit: {}
      earliest_time: {}
      event_limit: {}
      latest_time: {}
      query:
        simple: index="*" sourcetype="WinEventLog" source="WinEventLog:Security" EventCode=4104
          Message="*powercat*"
      update_context: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2360,
          "y": 2285
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "54":
    id: "54"
    taskid: b2889eb6-d99a-41f9-875e-240b506e65de
    type: regular
    task:
      id: b2889eb6-d99a-41f9-875e-240b506e65de
      version: -1
      name: UMWorkerProcess.exe in Exchange creating abnormal content
      description: Searches Splunk for events.
      script: '|||splunk-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "55"
    scriptarguments:
      app: {}
      batch_limit: {}
      earliest_time: {}
      event_limit: {}
      latest_time: {}
      query:
        simple: 'index=* sourcetype=WinEventLog source="WinEventLog:Security" EventCode=4663
          Object_Type="File" (Object_Name="*.php" OR Object_Name="*.jsp" OR Object_Name="*.js"
          OR Object_Name="*.aspx" OR Object_Name="*.asmx" OR Object_Name="*.cfm" OR
          Object_Name="*.shtml") (Process_Name="*umworkerprocess.exe*" OR Process_Name="*UMService.exe*") '
      update_context: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2360,
          "y": 2490
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "55":
    id: "55"
    taskid: 4ff870df-1c53-413f-8533-6c91b33da587
    type: regular
    task:
      id: 4ff870df-1c53-413f-8533-6c91b33da587
      version: -1
      name: UMWorkerProcess.exe spawning
      description: Searches Splunk for events.
      script: '|||splunk-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "56"
    scriptarguments:
      app: {}
      batch_limit: {}
      earliest_time: {}
      event_limit: {}
      latest_time: {}
      query:
        simple: index=* sourcetype="WinEventLog" source="WinEventLog:Security" EventCode=4688
          (Creator_Process_Name="*umworkerprocess.exe*" OR Creator_Process_Name="*UMService.exe*")
          NOT New_Process_Name="*UMWorkerProcess.exe*"
      update_context: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2360,
          "y": 2685
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "56":
    id: "56"
    taskid: fd5472e3-c1ba-4d02-8c42-eaa51fdb5a35
    type: regular
    task:
      id: fd5472e3-c1ba-4d02-8c42-eaa51fdb5a35
      version: -1
      name: IIS authentication bypass vulnerability
      description: Searches Splunk for events.
      script: '|||splunk-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      app: {}
      batch_limit: {}
      earliest_time: {}
      event_limit: {}
      latest_time: {}
      query:
        simple: |-
          index=* sourcetype="ms:iis:auto" http_method=POST uri_path="/owa/auth/Current/themes/resources/*"
          | stats count by src_ip, http_user_agent, uri_path, http_method, uri_query
      update_context: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2360,
          "y": 2880
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "57":
    id: "57"
    taskid: 51bd8907-9333-4ed4-8b81-33aa526313a4
    type: title
    task:
      id: 51bd8907-9333-4ed4-8b81-33aa526313a4
      version: -1
      name: Hunt Using Splunk
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "51"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2360,
          "y": 1740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "58":
    id: "58"
    taskid: 32ce2ff2-adf7-4c2e-8a4c-e48aa3f2e702
    type: title
    task:
      id: 32ce2ff2-adf7-4c2e-8a4c-e48aa3f2e702
      version: -1
      name: Hunt Using Qradar
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "59"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2980,
          "y": 1740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "59":
    id: "59"
    taskid: 3dab3975-eba7-475b-840a-87baa18e4221
    type: playbook
    task:
      id: 3dab3975-eba7-475b-840a-87baa18e4221
      version: -1
      name: QRadarFullSearch
      playbookName: QRadarFullSearch
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "60"
    scriptarguments:
      headers: {}
      interval:
        simple: "1"
      query_expression:
        simple: select * from events WHERE LogSourceTypeName(deviceType) = 'Microsoft
          Windows Security Event Log' and UTF8(payload) LIKE '%4688%'  and UTF8(payload)
          LIKE '%powershell.exe%' and UTF8(payload) LIKE '%System.Net.Sockets.TCPClient%'  Last
          7 days
      range: {}
      timeout:
        simple: "600"
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 2980,
          "y": 1900
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "60":
    id: "60"
    taskid: 38da01fc-c8d5-460d-8bda-5106288d9c28
    type: playbook
    task:
      id: 38da01fc-c8d5-460d-8bda-5106288d9c28
      version: -1
      name: QRadarFullSearch
      playbookName: QRadarFullSearch
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "61"
    scriptarguments:
      headers: {}
      interval:
        simple: "1"
      query_expression:
        simple: select * from events WHERE LogSourceTypeName(deviceType) = 'Microsoft
          Windows Security Event Log' and UTF8(payload) LIKE '%4104%' and UTF8(payload)
          LIKE '% Invoke-PowerShellTCP%'  Last 7 days
      range: {}
      timeout:
        simple: "600"
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 2980,
          "y": 2085
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "61":
    id: "61"
    taskid: c9e5c467-c856-419b-8c23-96a2b9f54b77
    type: playbook
    task:
      id: c9e5c467-c856-419b-8c23-96a2b9f54b77
      version: -1
      name: QRadarFullSearch
      playbookName: QRadarFullSearch
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "62"
    scriptarguments:
      headers: {}
      interval:
        simple: "1"
      query_expression:
        simple: select * from events WHERE LogSourceTypeName(deviceType) = 'Microsoft
          Windows Security Event Log' and UTF8(payload) LIKE '%4104%' and UTF8(payload)
          LIKE '% powercat%' Last 7 days
      range: {}
      timeout:
        simple: "600"
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 2980,
          "y": 2285
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "62":
    id: "62"
    taskid: 02e9b0ac-4bd1-41c5-8006-4296211e32bf
    type: playbook
    task:
      id: 02e9b0ac-4bd1-41c5-8006-4296211e32bf
      version: -1
      name: QRadarFullSearch
      playbookName: QRadarFullSearch
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "63"
    scriptarguments:
      headers: {}
      interval:
        simple: "1"
      query_expression:
        simple: select * from events WHERE LogSourceTypeName(deviceType) = 'Microsoft
          Windows Security Event Log' and UTF8(payload) LIKE '%4633%' and ( UTF8(payload)
          LIKE '%.php%' or UTF8(payload) LIKE '%.jsp%' or UTF8(payload) LIKE '%.js%'
          or UTF8(payload) LIKE '%.aspx%' or UTF8(payload) LIKE '%.asmx%' or UTF8(payload)
          LIKE '%.cfm%' or UTF8(payload) LIKE '%.shtlm%') AND ( UTF8(payload) LIKE
          '%umworkerprocess.exe%' or UTF8(payload) LIKE '%UMService.exe%')  Last 7
          days
      range: {}
      timeout:
        simple: "600"
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 2980,
          "y": 2490
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "63":
    id: "63"
    taskid: efe05ae9-ea4c-431f-8857-10caefab8810
    type: playbook
    task:
      id: efe05ae9-ea4c-431f-8857-10caefab8810
      version: -1
      name: QRadarFullSearch
      playbookName: QRadarFullSearch
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      headers: {}
      interval:
        simple: "1"
      query_expression:
        simple: select * from events WHERE LogSourceTypeName(deviceType) = 'Microsoft
          IIS' and UTF8(payload) LIKE '%POST%' and UTF8(payload) LIKE '%/owa/auth/Current/themes/resources/*%'
          Last 7 days
      range: {}
      timeout:
        simple: "600"
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 2980,
          "y": 2685
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "64":
    id: "64"
    taskid: c7798cf9-e32b-4560-8c40-66a0cd6c0f52
    type: title
    task:
      id: c7798cf9-e32b-4560-8c40-66a0cd6c0f52
      version: -1
      name: SIEM Indicators Hunt
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "65"
      - "66"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -60,
          "y": 1560
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "65":
    id: "65"
    taskid: 1e019301-ca41-4edf-8b9b-9ccce255f68c
    type: playbook
    task:
      id: 1e019301-ca41-4edf-8b9b-9ccce255f68c
      version: -1
      name: Splunk Indicator Hunting
      playbookName: Splunk Indicator Hunting
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      HostFieldsToReturn: {}
      IPAddress: {}
      IPFieldsToReturn: {}
      IndexName:
        simple: '*'
      InternalDomainName: {}
      InternalHostRegex: {}
      InternalIPRange: {}
      MD5:
        complex:
          root: File
          accessor: MD5
      SHA1: {}
      SHA256:
        complex:
          root: File
          accessor: SHA256
      SelectFields:
        simple: source,timestamp
      SplunkIPField: {}
      SplunkMD5Field: {}
      SplunkSHA1Field: {}
      SplunkSHA256Field: {}
      SplunkURLDomainField: {}
      URLDomain: {}
      UserFieldsToReturn: {}
      earliest_time:
        simple: -1d
      event_limit:
        simple: "100"
      latest_time: {}
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 160,
          "y": 1725
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "66":
    id: "66"
    taskid: 292ff9b7-623b-4828-8a78-116ac764e458
    type: playbook
    task:
      id: 292ff9b7-623b-4828-8a78-116ac764e458
      version: -1
      name: QRadar Indicator Hunting V2
      playbookName: QRadar Indicator Hunting V2
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      IPAddress: {}
      InternalRange: {}
      InvestigationIPFields:
        simple: sourceip,destinationip
      InvestigationUserFields:
        simple: username
      MD5:
        complex:
          root: File
          accessor: MD5
      QradarIPfield:
        simple: sourceip,destinationip
      QradarMD5Field: {}
      QradarSHA1Field: {}
      QradarSHA256Field: {}
      QradarURLDomainField: {}
      SHA1: {}
      SHA256:
        complex:
          root: File
          accessor: SHA256
      TimeFrame:
        simple: LAST 7 DAYS
      URLDomain: {}
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": -270,
          "y": 1725
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "67":
    id: "67"
    taskid: d0aa41c2-467c-4565-855f-6283dcacd3ef
    type: title
    task:
      id: d0aa41c2-467c-4565-855f-6283dcacd3ef
      version: -1
      name: 'Block Indicators  '
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "29"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 3190
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
view: |-
  {
    "linkLabelsPosition": {
      "36_23_yes": 0.32,
      "36_37_#default#": 0.33,
      "40_25_yes": 0.6,
      "40_26_#default#": 0.12
    },
    "paper": {
      "dimensions": {
        "height": 5095,
        "width": 3630,
        "x": -270,
        "y": 50
      }
    }
  }
inputs:
- key: BlockIndicatorsAutomatically
  value:
    simple: "False"
  required: false
  description: Whether to automatically indicators involved with HAFNIUM exploits
  playbookInputQuery:
outputs: []
tests:
- No tests
fromversion: 5.5.0
toversion: 5.9.9
