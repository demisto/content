id: SolarStorm and SUNBURST Hunting and Response Playbook
version: -1
name: SolarStorm and SUNBURST Hunting and Response Playbook
description: |-
  This playbook does the following:
  - Collect indicators to aid in your threat hunting process.
     - Retrieve IOCs of SUNBURST (a trojanized version of the SolarWinds Orion plugin).
     - Retrieve C2 domains and URLs associated with Sunburst.
     - Discover IOCs of associated activity related to the infection. 
     - Generate an indicator list to block indicators with SUNBURST tags.
  - Hunt for the SUNBURST backdoor
     - Query firewall logs to detect network activity.
     - Search endpoint logs for Sunburst hashes. to detect presence on hosts.
  If compromised hosts are found:
  - Notify security team to review and trigger remediation response actions. 
  - Run sub-playbooks to isolate/quarantine infected hosts/endpoints and await further actions from the security team.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: a4b533b7-c5de-4ae4-8caf-939d281ecfcb
    type: start
    task:
      id: a4b533b7-c5de-4ae4-8caf-939d281ecfcb
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "4"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1500,
          "y": -530
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "4":
    id: "4"
    taskid: b711f4eb-e194-419b-8182-97c7be3d31e4
    type: title
    task:
      id: b711f4eb-e194-419b-8182-97c7be3d31e4
      version: -1
      name: Collect and Retrieve Indicators to Hunt
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "60"
      - "61"
      - "62"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1500,
          "y": -400
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "5":
    id: "5"
    taskid: 1ae71aa8-b40a-4ffe-8a07-f6b2f5dcddce
    type: regular
    task:
      id: 1ae71aa8-b40a-4ffe-8a07-f6b2f5dcddce
      version: -1
      name: Collect hashes from FireEye for installed SUNBURST backdoor
      description: Sends HTTP request. Returns the response as a JSON file.
      scriptName: http
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "45"
    scriptarguments:
      body: {}
      filename:
        simple: fireeye_Indicator_Release_Hashes.csv
      headers: {}
      insecure: {}
      method:
        simple: GET
      password: {}
      proxy: {}
      saveAsFile: {}
      unsecure: {}
      url:
        simple: https://raw.githubusercontent.com/fireeye/sunburst_countermeasures/main/indicator_release/Indicator_Release_Hashes.csv
      username: {}
    reputationcalc: 2
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 970,
          "y": -120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "12":
    id: "12"
    taskid: ea22e581-bb05-4fe1-8d33-5a8bd0ab320c
    type: regular
    task:
      id: ea22e581-bb05-4fe1-8d33-5a8bd0ab320c
      version: -1
      name: Close investigation
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "13"
    scriptarguments:
      assetid: {}
      closeNotes: {}
      closeReason: {}
      emailclassification: {}
      id: {}
      phishingsubtype: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1490,
          "y": 3680
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "13":
    id: "13"
    taskid: b1ee9c54-d82b-461f-8499-be35c63cf960
    type: title
    task:
      id: b1ee9c54-d82b-461f-8499-be35c63cf960
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1490,
          "y": 3860
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "16":
    id: "16"
    taskid: 614ed264-02c8-4166-8cd0-be4b55781271
    type: playbook
    task:
      id: 614ed264-02c8-4166-8cd0-be4b55781271
      version: -1
      name: Panorama search thread-ids in threat logs
      description: 'Query Panorama logs of types: traffic, threat, url, data-filtering,
        and wildfire.'
      playbookName: Panorama Query Logs
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "19"
    scriptarguments:
      action: {}
      addr-dst: {}
      addr-src: {}
      filedigest: {}
      ip: {}
      log_type:
        simple: threat
      port-dst: {}
      query:
        simple: (threatid eq 86237) or (threatid eq 86245) or (threatid eq 86242)
          or (threatid eq 86246) or (threatid eq 86249) or (threatid eq 86247) or
          (threatid eq 86243) or (threatid eq 86248) or (threatid eq 86244) or (threatid
          eq 86238) or (threatid eq 86239) or (threatid eq 86240) or (threatid eq
          86251) or (threatid eq 86250)
      rule: {}
      time-generated: {}
      url: {}
      zone-dst: {}
      zone-src: {}
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 2490,
          "y": 920
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "19":
    id: "19"
    taskid: e2dae459-0f2e-4158-8eb6-76047e745eab
    type: title
    task:
      id: e2dae459-0f2e-4158-8eb6-76047e745eab
      version: -1
      name: 'Remediation '
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "42"
      - "52"
      - "58"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1500,
          "y": 1450
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "23":
    id: "23"
    taskid: ed7dc84f-7d16-414d-879b-758b532a9f87
    type: regular
    task:
      id: ed7dc84f-7d16-414d-879b-758b532a9f87
      version: -1
      name: Investigate further
      description: Further investigate the incident (endpoints, entry point, etc.).
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "12"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1490,
          "y": 3480
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "24":
    id: "24"
    taskid: 1710d125-1c29-49e8-8081-42eddeae672f
    type: title
    task:
      id: 1710d125-1c29-49e8-8081-42eddeae672f
      version: -1
      name: Mitigation
      description: commands.local.cmd.close.inv
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "81"
      - "82"
      - "85"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1490,
          "y": 2340
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "27":
    id: "27"
    taskid: 051cd2ab-f916-4f0e-892f-d175ca33d297
    type: regular
    task:
      id: 051cd2ab-f916-4f0e-892f-d175ca33d297
      version: -1
      name: Mark hash indicators with SolarStorm tag
      description: commands.local.cmd.add.values.to.indicator.multi.select.field
      script: Builtin|||appendIndicatorField
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "53"
    scriptarguments:
      field:
        simple: tags
      fieldValue:
        simple: SolarStorm, SunBurst
      indicatorsValues:
        complex:
          root: File
          accessor: MD5
          transformers:
          - operator: uniq
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1940,
          "y": 1725
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "30":
    id: "30"
    taskid: 33853001-1282-4491-84c2-6f82f9712a70
    type: playbook
    task:
      id: 33853001-1282-4491-84c2-6f82f9712a70
      version: -1
      name: Search Endpoints By Hash - Generic V2
      description: Hunt using available tools.
      playbookName: Search Endpoints By Hash - Generic V2
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "19"
    scriptarguments:
      MD5Hash:
        complex:
          root: File
          accessor: MD5
          transformers:
          - operator: uniq
      SHA1Hash:
        complex:
          root: File
          accessor: SHA1
          transformers:
          - operator: uniq
      SHA256Hash:
        complex:
          root: File
          accessor: SHA256
          transformers:
          - operator: uniq
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 970,
          "y": 910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "31":
    id: "31"
    taskid: 371fd26b-01fd-4fca-894f-dfee2a3d8d56
    type: title
    task:
      id: 371fd26b-01fd-4fca-894f-dfee2a3d8d56
      version: -1
      name: Hunt SolarStorm and SunBurst in Network Activity
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "16"
      - "46"
      - "36"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2490,
          "y": 770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "32":
    id: "32"
    taskid: a089a743-ff97-454c-8b1a-b6e648490166
    type: title
    task:
      id: a089a743-ff97-454c-8b1a-b6e648490166
      version: -1
      name: Hunt Backdoor SolarWinds and SunBurst in Endpoints
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "30"
      - "74"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 970,
          "y": 770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "33":
    id: "33"
    taskid: 426e7b9a-ffad-4438-8e58-676fe1a3cf7c
    type: title
    task:
      id: 426e7b9a-ffad-4438-8e58-676fe1a3cf7c
      version: -1
      name: No Infections Found
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "24"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1935
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "34":
    id: "34"
    taskid: f357aaf7-c15a-44e1-899a-13f492b73771
    type: playbook
    task:
      id: f357aaf7-c15a-44e1-899a-13f492b73771
      version: -1
      name: Isolate Endpoint - Generic
      description: |-
        This playbook isolates a given endpoint using the following integrations:
        - Carbon Black Enterprise Response
        - Palo Alto Networks Traps
      playbookName: Isolate Endpoint - Generic
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "24"
    scriptarguments:
      EndpointId: {}
      Hostname:
        complex:
          root: Endpoint
          accessor: Hostname
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: foundIncidents.CustomFields.xdralerts.host_name
                iscontext: true
          - operator: uniq
      IP:
        complex:
          root: PANWHunting
          accessor: DetectedInternalIPs
      xdr_endpoint_id:
        complex:
          root: Endpoint.endpoint_id
          filters:
          - - operator: isExists
              left:
                value:
                  simple: Endpoint.endpoint_id
                iscontext: true
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1240,
          "y": 2160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "36":
    id: "36"
    taskid: b2a1265b-a788-4e03-8e55-0d35ea8b86e5
    type: playbook
    task:
      id: b2a1265b-a788-4e03-8e55-0d35ea8b86e5
      version: -1
      name: Panorama search SolarWinds App-IDs traffic logs
      description: 'Query Panorama logs of types: traffic, threat, url, data-filtering,
        and wildfire.'
      playbookName: Panorama Query Logs
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "19"
    scriptarguments:
      action: {}
      addr-dst: {}
      addr-src: {}
      filedigest: {}
      ip: {}
      log_type:
        simple: traffic
      port-dst: {}
      query:
        simple: (app eq solarwinds)or(app eq solarwinds-rmm)or(app eq solarwinds-msp-manager)or(app
          eq solarwinds-agent)or(app eq solarwinds-npm)or(app eq solarwinds-sam)or(app
          eq solarwinds-msp-anywhere)
      rule: {}
      time-generated: {}
      url: {}
      zone-dst: {}
      zone-src: {}
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 2920,
          "y": 920
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "42":
    id: "42"
    taskid: 7ed75f64-51b2-4cb7-874c-6118e1f2091c
    type: title
    task:
      id: 7ed75f64-51b2-4cb7-874c-6118e1f2091c
      version: -1
      name: Block Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "55"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2690,
          "y": 1590
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "43":
    id: "43"
    taskid: 530f28bd-bcdd-4fc0-8c7c-c445db4d045d
    type: condition
    task:
      id: 530f28bd-bcdd-4fc0-8c7c-c445db4d045d
      version: -1
      name: Any compromised hosts found?
      description: |
        Checks whether there was a compromised host found.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "33"
      "yes":
      - "50"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: Endpoint
            iscontext: true
        - operator: isNotEmpty
          left:
            value:
              complex:
                root: PANWHunting
                accessor: DetectedInternalIPs
            iscontext: true
        - operator: isNotEmpty
          left:
            value:
              complex:
                root: PANWHunting
                accessor: DetectedInternalHosts
            iscontext: true
    view: |-
      {
        "position": {
          "x": 980,
          "y": 1750
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "45":
    id: "45"
    taskid: adbcb588-358c-4a31-8aaa-78a0a2c0150e
    type: title
    task:
      id: adbcb588-358c-4a31-8aaa-78a0a2c0150e
      version: -1
      name: Hunt IOCs
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "31"
      - "32"
      - "67"
      - "79"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1500,
          "y": 620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "46":
    id: "46"
    taskid: 268cb2fe-6d84-43a4-8c82-846463e8ee83
    type: playbook
    task:
      id: 268cb2fe-6d84-43a4-8c82-846463e8ee83
      version: -1
      name: Palo Alto Networks - Hunting And Threat Detection
      playbookName: Palo Alto Networks - Hunting And Threat Detection
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "19"
    scriptarguments:
      IPAddresses:
        complex:
          root: IP
          accessor: Address
      InternalDomainName: {}
      InternalHostRegex: {}
      InternalRange: {}
      MD5:
        complex:
          root: File
          accessor: MD5
      SHA1:
        complex:
          root: File
          accessor: SHA1
      SHA256:
        complex:
          root: File
          accessor: SHA256
      URLDomain:
        complex:
          root: URL
          accessor: Data
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 2030,
          "y": 920
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "47":
    id: "47"
    taskid: 2fb47425-a802-46d2-81fd-593800e5655a
    type: regular
    task:
      id: 2fb47425-a802-46d2-81fd-593800e5655a
      version: -1
      name: Collect domains and IPs from FireEye for installed SUNBURST backdoor
      description: Sends HTTP request. Returns the response as a JSON file.
      scriptName: http
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      body: {}
      filename:
        simple: Indicator_Release_NBIs.csv
      headers: {}
      insecure: {}
      method:
        simple: GET
      password: {}
      proxy: {}
      saveAsFile: {}
      unsecure: {}
      url:
        simple: https://raw.githubusercontent.com/fireeye/sunburst_countermeasures/main/indicator_release/Indicator_Release_NBIs.csv
      username: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1500,
          "y": -120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "48":
    id: "48"
    taskid: 39ef55d8-635d-4a3f-8617-9a9f4b9074e6
    type: regular
    task:
      id: 39ef55d8-635d-4a3f-8617-9a9f4b9074e6
      version: -1
      name: UnEscape IPs from result to indicators
      description: |-
        Remove escaping chars from IP
        127[.]0[.]0[.]1 -> 127.0.0.1
      scriptName: UnEscapeIPs
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "49"
    scriptarguments:
      input:
        complex:
          root: HttpRequest.Response
          accessor: Body
          transformers:
          - operator: join
            args:
              separator:
                value:
                  simple: ','
    reputationcalc: 2
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1500,
          "y": 45
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "49":
    id: "49"
    taskid: 3861cb62-a18f-4444-8984-38db08ba0703
    type: regular
    task:
      id: 3861cb62-a18f-4444-8984-38db08ba0703
      version: -1
      name: UnEscape URLs from result to indicators
      description: |-
        Extract URLs redirected by security tools like Proofpoint.
        Changes https://urldefense.proofpoint.com/v2/url?u=https-3A__example.com_something.html -> https://example.com/something.html
        Also, un-escape URLs that are escaped for safety with formats like hxxps://www[.]demisto[.]com
      scriptName: UnEscapeURLs
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "45"
    scriptarguments:
      input:
        complex:
          root: HttpRequest.Response
          accessor: Body
          transformers:
          - operator: join
            args:
              separator:
                value:
                  simple: ','
    reputationcalc: 2
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1500,
          "y": 220
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "50":
    id: "50"
    taskid: 3b28ca78-d6db-462c-87a6-e6d07e9ca024
    type: condition
    task:
      id: 3b28ca78-d6db-462c-87a6-e6d07e9ca024
      version: -1
      name: Whether to automatically isolate compromised hosts?
      description: |
        Checks whether files associated with the incident can be blocked automatically using various EDR integrations.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "57"
      "yes":
      - "34"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.IsolateEndpointAutomatically
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 980,
          "y": 1985
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "51":
    id: "51"
    taskid: 07d4c409-d42e-4dee-8467-6dde4ea9f3c4
    type: playbook
    task:
      id: 07d4c409-d42e-4dee-8467-6dde4ea9f3c4
      version: -1
      name: Block Indicators - Generic v2
      description: |+
        This playbook blocks malicious indicators using all integrations that are enabled, using the following sub-playbooks:

        - Block URL - Generic
        - Block Account - Generic
        - Block IP - Generic v2
        - Block File - Generic v2

      playbookName: Block Indicators - Generic v2
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "24"
    scriptarguments:
      AutoCommit:
        simple: "No"
      CustomBlockRule:
        simple: "True"
      CustomURLCategory:
        simple: Demisto Remediation - Malicious URLs
      DAG: {}
      EDLServerIP: {}
      IP:
        complex:
          root: PANWHunting
          accessor: DetectedExternalIPs
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: IP.Address
                iscontext: true
      IPBlacklistMiner: {}
      IPListName: {}
      LogForwarding: {}
      MD5:
        complex:
          root: File
          accessor: MD5
      SHA256:
        complex:
          root: File
          accessor: SHA256
      StaticAddressGroup: {}
      URL:
        complex:
          root: URL
          accessor: Data
      URLBlacklistMiner: {}
      URLListName:
        simple: Demisto Remediation - URL EDL
      Username: {}
      categories: {}
      device-group: {}
      type: {}
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 2940,
          "y": 1905
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "52":
    id: "52"
    taskid: a7010738-03eb-4ce8-822b-14a3206e2c90
    type: title
    task:
      id: a7010738-03eb-4ce8-822b-14a3206e2c90
      version: -1
      name: Isolate Compromised Hosts
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "43"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 980,
          "y": 1590
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "53":
    id: "53"
    taskid: 6da60f60-c8d1-46fd-8b6a-32cb65c341f6
    type: regular
    task:
      id: 6da60f60-c8d1-46fd-8b6a-32cb65c341f6
      version: -1
      name: Mark IP indicators with SolarStorm tag
      description: commands.local.cmd.new.indicator
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "54"
    scriptarguments:
      accounttype: {}
      actor: {}
      admincountry: {}
      adminemail: {}
      adminname: {}
      adminphone: {}
      asn: {}
      assignedrole: {}
      assigneduser: {}
      associatedfilenames: {}
      associations: {}
      biosversion: {}
      campaign: {}
      category: {}
      city: {}
      costcenter: {}
      costcentercode: {}
      countryname: {}
      creationdate: {}
      customFields: {}
      cvedescription: {}
      cvemodified: {}
      cvss: {}
      department: {}
      description: {}
      detectionengines: {}
      devicemodel: {}
      dhcpserver: {}
      displayname: {}
      dns: {}
      domainidnname: {}
      domainname: {}
      domainreferringips: {}
      domainreferringsubnets: {}
      domainstatus: {}
      email: {}
      emailaddress: {}
      entryid: {}
      expirationdate: {}
      feedrelatedindicators: {}
      fileextension: {}
      filetype: {}
      firstseenbysource: {}
      geocountry: {}
      geolocation: {}
      givenname: {}
      groups: {}
      hostname: {}
      imphash: {}
      indicatoridentification: {}
      internal: {}
      ipaddress: {}
      jobcode: {}
      jobfamily: {}
      jobfunction: {}
      lastseenbysource: {}
      leadership: {}
      location: {}
      locationregion: {}
      macaddress: {}
      malwarefamily: {}
      malwaretypes: {}
      manageremailaddress: {}
      managername: {}
      md5: {}
      memory: {}
      merge:
        simple: "True"
      mobilephone: {}
      name: {}
      namefield: {}
      nameservers: {}
      office365category: {}
      office365expressroute: {}
      office365required: {}
      operatingsystem: {}
      operatingsystemversion: {}
      organization: {}
      organizationalunitou: {}
      osversion: {}
      path: {}
      personalemail: {}
      port: {}
      positivedetections: {}
      primarymotivation: {}
      processor: {}
      processors: {}
      published: {}
      quarantined: {}
      region: {}
      registrantcountry: {}
      registrantemail: {}
      registrantname: {}
      registrantphone: {}
      registrarabuseemail: {}
      registrarabusephone: {}
      registrarname: {}
      relateToIncident: {}
      relatedIncidents: {}
      reportedby: {}
      reputation: {}
      seenNow: {}
      service: {}
      sha1: {}
      sha256: {}
      sha512: {}
      signatureauthentihash: {}
      signaturecopyright: {}
      signaturedescription: {}
      signaturefileversion: {}
      signatureinternalname: {}
      signed: {}
      size: {}
      source: {}
      sourceTimeStamp: {}
      sourceoriginalseverity: {}
      ssdeep: {}
      state: {}
      stixaliases: {}
      stixdescription: {}
      stixgoals: {}
      stixid: {}
      stixismalwarefamily: {}
      stixkillchainphases: {}
      stixmalwaretypes: {}
      stixprimarymotivation: {}
      stixresourcelevel: {}
      stixroles: {}
      stixsecondarymotivations: {}
      stixsophistication: {}
      stixthreatactortypes: {}
      stixtooltypes: {}
      stixtoolversion: {}
      streetaddress: {}
      subdomains: {}
      surname: {}
      tags:
        simple: SolarStorm, SUNBURST
      threattypes: {}
      title: {}
      trafficlightprotocol: {}
      type:
        simple: IP
      updateddate: {}
      username: {}
      value:
        complex:
          root: IP
          accessor: Address
          transformers:
          - operator: uniq
      workphone: {}
      xdrstatus: {}
      zipcode: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1940,
          "y": 1905
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "54":
    id: "54"
    taskid: dccfd92f-f15b-4ba3-8370-b9df643d136e
    type: regular
    task:
      id: dccfd92f-f15b-4ba3-8370-b9df643d136e
      version: -1
      name: Mark URL indicators with SolarStorm tag
      description: commands.local.cmd.new.indicator
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "24"
    scriptarguments:
      accounttype: {}
      actor: {}
      admincountry: {}
      adminemail: {}
      adminname: {}
      adminphone: {}
      asn: {}
      assignedrole: {}
      assigneduser: {}
      associatedfilenames: {}
      associations: {}
      biosversion: {}
      campaign: {}
      category: {}
      city: {}
      costcenter: {}
      costcentercode: {}
      countryname: {}
      creationdate: {}
      customFields: {}
      cvedescription: {}
      cvemodified: {}
      cvss: {}
      department: {}
      description: {}
      detectionengines: {}
      devicemodel: {}
      dhcpserver: {}
      displayname: {}
      dns: {}
      domainidnname: {}
      domainname: {}
      domainreferringips: {}
      domainreferringsubnets: {}
      domainstatus: {}
      email: {}
      emailaddress: {}
      entryid: {}
      expirationdate: {}
      feedrelatedindicators: {}
      fileextension: {}
      filetype: {}
      firstseenbysource: {}
      geocountry: {}
      geolocation: {}
      givenname: {}
      groups: {}
      hostname: {}
      imphash: {}
      indicatoridentification: {}
      internal: {}
      ipaddress: {}
      jobcode: {}
      jobfamily: {}
      jobfunction: {}
      lastseenbysource: {}
      leadership: {}
      location: {}
      locationregion: {}
      macaddress: {}
      malwarefamily: {}
      malwaretypes: {}
      manageremailaddress: {}
      managername: {}
      md5: {}
      memory: {}
      merge:
        simple: "True"
      mobilephone: {}
      name: {}
      namefield: {}
      nameservers: {}
      office365category: {}
      office365expressroute: {}
      office365required: {}
      operatingsystem: {}
      operatingsystemversion: {}
      organization: {}
      organizationalunitou: {}
      osversion: {}
      path: {}
      personalemail: {}
      port: {}
      positivedetections: {}
      primarymotivation: {}
      processor: {}
      processors: {}
      published: {}
      quarantined: {}
      region: {}
      registrantcountry: {}
      registrantemail: {}
      registrantname: {}
      registrantphone: {}
      registrarabuseemail: {}
      registrarabusephone: {}
      registrarname: {}
      relateToIncident: {}
      relatedIncidents: {}
      reportedby: {}
      reputation: {}
      seenNow: {}
      service: {}
      sha1: {}
      sha256: {}
      sha512: {}
      signatureauthentihash: {}
      signaturecopyright: {}
      signaturedescription: {}
      signaturefileversion: {}
      signatureinternalname: {}
      signed: {}
      size: {}
      source: {}
      sourceTimeStamp: {}
      sourceoriginalseverity: {}
      ssdeep: {}
      state: {}
      stixaliases: {}
      stixdescription: {}
      stixgoals: {}
      stixid: {}
      stixismalwarefamily: {}
      stixkillchainphases: {}
      stixmalwaretypes: {}
      stixprimarymotivation: {}
      stixresourcelevel: {}
      stixroles: {}
      stixsecondarymotivations: {}
      stixsophistication: {}
      stixthreatactortypes: {}
      stixtooltypes: {}
      stixtoolversion: {}
      streetaddress: {}
      subdomains: {}
      surname: {}
      tags:
        simple: SolarStorm, SUNBURST
      threattypes: {}
      title: {}
      trafficlightprotocol: {}
      type:
        simple: URL
      updateddate: {}
      username: {}
      value:
        complex:
          root: URL
          accessor: Data
          transformers:
          - operator: uniq
      workphone: {}
      xdrstatus: {}
      zipcode: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1940,
          "y": 2090
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "55":
    id: "55"
    taskid: 74ac6d25-f103-46e5-8259-6b5d15152623
    type: condition
    task:
      id: 74ac6d25-f103-46e5-8259-6b5d15152623
      version: -1
      name: Whether to block indicators automatically?
      description: Checks whether IOCs associated with the incident can be blocked
        automatically.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "56"
      "yes":
      - "51"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.BlockIndicatorsAutomatically
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 2690,
          "y": 1725
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "56":
    id: "56"
    taskid: 00db2f05-30f7-4558-8d48-a121d7c5312d
    type: regular
    task:
      id: 00db2f05-30f7-4558-8d48-a121d7c5312d
      version: -1
      name: Manually block indicators
      description: Manually block the IOCs in the relevant systems.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "24"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2450,
          "y": 1905
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "57":
    id: "57"
    taskid: 73a29a39-896b-498f-8efc-2bd3a0c1446e
    type: regular
    task:
      id: 73a29a39-896b-498f-8efc-2bd3a0c1446e
      version: -1
      name: Manually isolate endpoints
      description: Manually isolate the compromised hosts.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "24"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 740,
          "y": 2160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "58":
    id: "58"
    taskid: 75a872a3-340d-4fb4-875a-a4ef369e4f34
    type: title
    task:
      id: 75a872a3-340d-4fb4-875a-a4ef369e4f34
      version: -1
      name: Tag SolarStorm and SUNBURST Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "27"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1940,
          "y": 1590
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "59":
    id: "59"
    taskid: e007519b-6d8a-46c0-8ead-bfb3c99b17b1
    type: regular
    task:
      id: e007519b-6d8a-46c0-8ead-bfb3c99b17b1
      version: -1
      name: Collect IOCs from UNIT42 GIT
      description: Sends HTTP request. Returns the response as a JSON file.
      scriptName: http
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "45"
    scriptarguments:
      body: {}
      filename: {}
      headers: {}
      insecure: {}
      method:
        simple: GET
      password: {}
      proxy: {}
      saveAsFile: {}
      unsecure: {}
      url:
        simple: https://github.com/pan-unit42/iocs/blob/master/SolarStorm/IOCs
      username: {}
    reputationcalc: 2
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 570,
          "y": -120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "60":
    id: "60"
    taskid: 1f8cb908-530f-4f5c-819e-b4961bf6550a
    type: title
    task:
      id: 1f8cb908-530f-4f5c-819e-b4961bf6550a
      version: -1
      name: Indicators from GIT Sources
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "5"
      - "47"
      - "59"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 970,
          "y": -260
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "61":
    id: "61"
    taskid: cd4b7159-c42b-4b2a-8780-97393eafdb9a
    type: title
    task:
      id: cd4b7159-c42b-4b2a-8780-97393eafdb9a
      version: -1
      name: Indicators from a STIX File
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "64"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2010,
          "y": -250
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "62":
    id: "62"
    taskid: b6e0ae1f-43ab-49f0-84c3-e06cfef87c8a
    type: title
    task:
      id: b6e0ae1f-43ab-49f0-84c3-e06cfef87c8a
      version: -1
      name: CVE Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "66"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2530,
          "y": -250
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "64":
    id: "64"
    taskid: 2ccb845e-a64f-448f-84ab-049d36b44df5
    type: regular
    task:
      id: 2ccb845e-a64f-448f-84ab-049d36b44df5
      version: -1
      name: Create a STIX file
      description: |
        Create a file (using the given data input or entry ID) and upload it to the current investigation in the War Room.
      scriptName: FileCreateAndUpload
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "65"
    scriptarguments:
      data:
        complex:
          root: inputs.SunBurstSTIX
      entryId: {}
      filename:
        simple: SunBurst STIX
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2010,
          "y": -120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "65":
    id: "65"
    taskid: 802f834f-b035-464c-8e2e-cdf4b2fb5a27
    type: regular
    task:
      id: 802f834f-b035-464c-8e2e-cdf4b2fb5a27
      version: -1
      name: Create indicators from STIX
      description: Creates indicators from the submitted STIX file. Supports STIX
        1.0 and STIX 2.0.
      scriptName: CreateIndicatorsFromSTIX
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "75"
    scriptarguments:
      entry_id:
        complex:
          root: File
          filters:
          - - operator: isExists
              left:
                value:
                  simple: File
                iscontext: true
          accessor: EntryID
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2010,
          "y": 45
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "66":
    id: "66"
    taskid: 84ab94f9-a661-46e1-8fbe-f92608910066
    type: playbook
    task:
      id: 84ab94f9-a661-46e1-8fbe-f92608910066
      version: -1
      name: CVE Enrichment - Generic v2
      description: |-
        This playbook performs CVE enrichment using the following integrations:
        - VulnDB
        - CVE Search
        - IBM X-Force Exchange
      playbookName: CVE Enrichment - Generic v2
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "45"
    scriptarguments:
      cve_id:
        complex:
          root: inputs.CVEs
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 2530,
          "y": 110
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "67":
    id: "67"
    taskid: 71059047-2798-4dbb-80e3-ed7281aa44a1
    type: title
    task:
      id: 71059047-2798-4dbb-80e3-ed7281aa44a1
      version: -1
      name: CVEs Hunt
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "68"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1500,
          "y": 770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "68":
    id: "68"
    taskid: 49900f99-7208-4421-8d0e-939ff1ea5535
    type: playbook
    task:
      id: 49900f99-7208-4421-8d0e-939ff1ea5535
      version: -1
      name: Search Endpoint by CVE - Generic
      playbookName: Search Endpoint by CVE - Generic
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "19"
    scriptarguments:
      CVE_ID:
        complex:
          root: inputs.CVEs
          transformers:
          - operator: uniq
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1500,
          "y": 910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "70":
    id: "70"
    taskid: 28c77a73-1202-44c8-8210-b5b6519dc2e4
    type: regular
    task:
      id: 28c77a73-1202-44c8-8210-b5b6519dc2e4
      version: -1
      name: Set hash indicators from playbook inputs
      description: commands.local.cmd.extract.indicators
      script: Builtin|||extractIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "45"
    scriptarguments:
      entryID: {}
      filePath: {}
      investigationID: {}
      text:
        complex:
          root: inputs.KnownRelatedIOCs
          transformers:
          - operator: uniq
    reputationcalc: 2
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2010,
          "y": 440
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "74":
    id: "74"
    taskid: fa5e9522-7a7f-4f59-8655-04e225f99eb4
    type: regular
    task:
      id: fa5e9522-7a7f-4f59-8655-04e225f99eb4
      version: -1
      name: Search XDR incidents for SolarStorm SUNBURST
      description: Search XDR incidents for SUNBURST.
      scriptName: SearchIncidentsV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "19"
    scriptarguments:
      details: {}
      fromclosedate: {}
      fromdate: {}
      fromduedate: {}
      id: {}
      level: {}
      name: {}
      notstatus: {}
      owner: {}
      page: {}
      query:
        simple: xdralerts.name:"SunBurst Module loaded" or xdralerts.name:"SunBurst
          domain access"
      reason: {}
      size: {}
      sort: {}
      status: {}
      toclosedate: {}
      todate: {}
      toduedate: {}
      type: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 510,
          "y": 910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "75":
    id: "75"
    taskid: 09c96b7b-c905-4050-87de-b0175841da07
    type: condition
    task:
      id: 09c96b7b-c905-4050-87de-b0175841da07
      version: -1
      name: 'Are there additional IOCs? '
      description: Checks if there are additional IOCs from the playbook input.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "45"
      "yes":
      - "70"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: inputs.KnownRelatedIOCs
            iscontext: true
    view: |-
      {
        "position": {
          "x": 2010,
          "y": 220
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "77":
    id: "77"
    taskid: d885d8be-db43-4a3d-868a-9ad824ab7fc4
    type: regular
    task:
      id: d885d8be-db43-4a3d-868a-9ad824ab7fc4
      version: -1
      name: Search XDR incidents for suspicious SolarStorm behavior
      description: Search for XDR incident related to suspicious SolarStorm behavior.
      scriptName: SearchIncidentsV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "19"
    scriptarguments:
      details: {}
      fromclosedate: {}
      fromdate: {}
      fromduedate: {}
      id: {}
      level: {}
      name: {}
      notstatus: {}
      owner: {}
      page: {}
      query:
        simple: 'xdralerts.name:"Malicious NetSetupSvc.dll loaded into svchost.exe"
          or xdralerts.name:"ADFind queries Active Directory for Exchange groups"
          or xdralerts.name:"Virtual Directory configuration access via PowerShell"
          or xdralerts.name:"PowerShell dumps users and roles from Exchange server"
          or xdralerts.name:"Unverified domain added to Azure AD" or xdralerts.name:"Domain
          federation settings have been modified" or xdralerts.name:"Uncommon PowerShell
          commands used to create or alter scheduled task parameters" '
      reason: {}
      size: {}
      sort: {}
      status: {}
      toclosedate: {}
      todate: {}
      toduedate: {}
      type: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -890,
          "y": 910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "78":
    id: "78"
    taskid: 664e0282-f996-408a-81d4-7e3958b125cc
    type: playbook
    task:
      id: 664e0282-f996-408a-81d4-7e3958b125cc
      version: -1
      name: Azure Hunting playbook
      description: 'This playbook helps you collect and investigate suspicious security
        events from the Azure AD environment. '
      playbookName: Azure Hunting playbook
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "19"
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": -20,
          "y": 910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "79":
    id: "79"
    taskid: 72cb345d-ece5-4725-8ebe-5e68c9cf8919
    type: title
    task:
      id: 72cb345d-ece5-4725-8ebe-5e68c9cf8919
      version: -1
      name: Hunt SolarStorm Activity
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "78"
      - "91"
      - "77"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -20,
          "y": 770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "80":
    id: "80"
    taskid: 3db165c4-baa0-4aaa-88ba-3206e8797b7b
    type: playbook
    task:
      id: 3db165c4-baa0-4aaa-88ba-3206e8797b7b
      version: -1
      name: Azure Configuration Analysis
      description: This playbook helps you collect, review, and find misconfigurations
        with the Azure environment.
      playbookName: Azure Configuration Analysis
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "90"
    scriptarguments:
      Limit:
        complex:
          root: inputs.Limit
      O365_AdminRolesList:
        complex:
          root: inputs.O365_AdminRolesList
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1490,
          "y": 2640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "81":
    id: "81"
    taskid: 086af982-7b5b-4ae4-89b3-71a8f2eaf0ec
    type: title
    task:
      id: 086af982-7b5b-4ae4-89b3-71a8f2eaf0ec
      version: -1
      name: Azure Mitigaion
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "80"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1490,
          "y": 2510
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "82":
    id: "82"
    taskid: 55752ac9-865a-4188-8d81-78631ae1b1b5
    type: title
    task:
      id: 55752ac9-865a-4188-8d81-78631ae1b1b5
      version: -1
      name: SolarWinds Mitigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "83"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2000,
          "y": 2510
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "83":
    id: "83"
    taskid: f6543ddb-70d3-4b23-8c46-9958a5d9199e
    type: regular
    task:
      id: f6543ddb-70d3-4b23-8c46-9958a5d9199e
      version: -1
      name: Patch Vulnerable SolarWinds Server
      description: |-
        The following are the latest SolarWinds updates designed to protect against SUNBURST and SUPERNOVA:

        2019.4 HF 6 (released December 14, 2020)
        2020.2.1 HF 2 (released December 15, 2020)
        2019.2 SUPERNOVA Patch (released December 23, 2020)
        2018.4 SUPERNOVA Patch (released December 23, 2020)
        2018.2 SUPERNOVA Patch (released December 23, 2020)
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "84"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2000,
          "y": 2640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "84":
    id: "84"
    taskid: 9c2cf674-f823-48b1-842f-cb21dd7fb956
    type: regular
    task:
      id: 9c2cf674-f823-48b1-842f-cb21dd7fb956
      version: -1
      name: Change the password for SolarWinds user
      description: |
        Change the password for the SolarWinds user.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "90"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2000,
          "y": 2810
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "85":
    id: "85"
    taskid: c2d884eb-50c8-4edf-8c9b-e28e3537c07e
    type: title
    task:
      id: c2d884eb-50c8-4edf-8c9b-e28e3537c07e
      version: -1
      name: 'Compromised Organization Entities Mitigation '
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "86"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 960,
          "y": 2510
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "86":
    id: "86"
    taskid: 4afd5b63-b756-462c-85f3-01a3550e957b
    type: regular
    task:
      id: 4afd5b63-b756-462c-85f3-01a3550e957b
      version: -1
      name: Reset all credentials used by or stored in SolarWinds software
      description: Reset all credentials used by or stored in SolarWinds software.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "87"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 960,
          "y": 2640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "87":
    id: "87"
    taskid: ad41ea3b-96ff-4568-8423-727b84442b46
    type: regular
    task:
      id: ad41ea3b-96ff-4568-8423-727b84442b46
      version: -1
      name: 'Replace the user account by Group Managed Service Account '
      description: |
        Replace the user account by Group Managed Service Account.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "88"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 960,
          "y": 2810
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "88":
    id: "88"
    taskid: aae3efe7-7dfb-414d-8b43-de86bceb1945
    type: regular
    task:
      id: aae3efe7-7dfb-414d-8b43-de86bceb1945
      version: -1
      name: Configure encryption types allowed for Kerberos
      description: |
        Set the allowable encryption types to AES256_HMAC_SHA1 and future encryption types. https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-security-configure-encryption-types-allowed-for-kerberos.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "89"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 960,
          "y": 2980
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "89":
    id: "89"
    taskid: 952de9f5-aa4e-4a1f-84cc-708791506fe1
    type: regular
    task:
      id: 952de9f5-aa4e-4a1f-84cc-708791506fe1
      version: -1
      name: Rebuild hosts monitored by the SolarWinds
      description: |
        Treat all hosts monitored by the SolarWinds Orion monitoring software as compromised by threat actors and assume that further persistence mechanisms have been deployed.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "90"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 960,
          "y": 3150
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "90":
    id: "90"
    taskid: b1bc4756-01f4-405e-8609-442151e6fbee
    type: title
    task:
      id: b1bc4756-01f4-405e-8609-442151e6fbee
      version: -1
      name: 'Mitigation Complete '
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "23"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1490,
          "y": 3320
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "91":
    id: "91"
    taskid: 30f329a4-8e66-4272-80b2-12a4bba9a6dd
    type: playbook
    task:
      id: 30f329a4-8e66-4272-80b2-12a4bba9a6dd
      version: -1
      name: SolarStorm Activity Behavior Hunting playbook
      playbookName: SolarStorm Activity Behavior Hunting playbook
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "19"
    separatecontext: true
    view: |-
      {
        "position": {
          "x": -450,
          "y": 910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
view: |-
  {
    "linkLabelsPosition": {
      "43_33_#default#": 0.23,
      "43_50_yes": 0.65,
      "50_34_yes": 0.5,
      "50_57_#default#": 0.51,
      "75_45_#default#": 0.23,
      "75_70_yes": 0.65
    },
    "paper": {
      "dimensions": {
        "height": 4455,
        "width": 4210,
        "x": -890,
        "y": -530
      }
    }
  }
inputs:
- key: ThreatIDs
  value:
    simple: 86246,86237,34801,39934,58049,38399,55378,37582,36709,37781,38388,56269
  required: false
  description: Threat IDs to hunt through NGFW Threat Logs.
  playbookInputQuery:
- key: IsolateEndpointAutomatically
  value:
    simple: "False"
  required: false
  description: Whether to automatically isolate endpoints, or opt for manual user
    approval. True means isolation will be done automatically.
  playbookInputQuery:
- key: BlockIndicatorsAutomatically
  value:
    simple: "False"
  required: false
  description: Whether to automatically block indicators involved with SolarStorm.
  playbookInputQuery:
- key: CVEs
  value:
    simple: CVE-2020-14005,CVE-2020-13169
  required: false
  description: CVEs related to SUNBURST and SolarStorm.
  playbookInputQuery:
- key: SunBurstSTIX
  value:
    simple: '{"id":"bundle--60aab587-660c-4b58-89d0-efcf9cbdf8dd","type":"bundle","spec_version":"2.0","objects":[{"created":"2020-12-17T16:50:49.000Z","id":"indicator--180de847-a4c8-4e76-b719-138ac9c9b58e","labels":["file
      sha-256"],"modified":"2020-12-17T16:50:49.000Z","pattern":"[file:hashes.sha256
      = ''019085a76ba7126fff22770d71bd901c325fc68ac55aa743327984e89f4b0134'']","score":"High","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.12709Z"},{"created":"2020-12-17T16:51:42.000Z","id":"indicator--8d217031-22f6-4d86-bd42-0519032d93bc","labels":["file
      sha-256"],"modified":"2020-12-17T16:51:42.000Z","pattern":"[file:hashes.sha256
      = ''439bcd0a17d53837bc29fb51c0abd9d52a747227f97133f8ad794d9cc0ef191e'']","score":"Medium","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.144865Z"},{"created":"2020-12-17T16:58:27.000Z","id":"indicator--ff3c830a-dbe2-45ec-bfbc-dd357ae040fc","labels":["domain"],"modified":"2020-12-17T16:58:27.000Z","pattern":"[domain-name:value
      = ''thedoccloud.com'']","score":"High","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.146129Z"},{"created":"2020-12-17T16:52:06.000Z","id":"indicator--514f2faf-9572-44e3-8f67-ea782206335f","labels":["file
      sha-256"],"modified":"2020-12-17T16:52:06.000Z","pattern":"[file:hashes.sha256
      = ''a25cadd48d70f6ea0c4a241d99c5241269e6faccb4054e62d16784640f8e53bc'']","score":"High","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.149043Z"},{"created":"2020-12-17T16:50:28.000Z","id":"indicator--2e3e39c2-757d-496f-82b1-a715e44fb682","labels":["file
      sha-256"],"modified":"2020-12-17T16:50:28.000Z","pattern":"[file:hashes.sha256
      = ''abe22cf0d78836c3ea072daeaf4c5eeaf9c29b6feb597741651979fc8fbd2417'']","score":"High","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.150253Z"},{"created":"2020-12-17T16:59:49.000Z","id":"indicator--a444b6e0-da14-4a6e-8024-15cda0061a6e","labels":["domain"],"modified":"2020-12-17T16:59:49.000Z","pattern":"[domain-name:value
      = ''databasegalore.com'']","score":"High","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.151314Z"},{"created":"2020-12-17T16:54:00.000Z","id":"indicator--1fbf05cb-270c-4c0b-aac1-1ae960fb166a","labels":["file
      sha-256"],"modified":"2020-12-17T16:54:00.000Z","pattern":"[file:hashes.sha256
      = ''c15abaf51e78ca56c0376522d699c978217bf041a3bd3c71d09193efa5717c71'']","score":"High","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.152749Z"},{"created":"2020-12-17T16:51:14.000Z","id":"indicator--18561b05-1cbe-42ab-b4ae-b315e8709c02","labels":["file
      sha-256"],"modified":"2020-12-17T16:51:14.000Z","pattern":"[file:hashes.sha256
      = ''ce77d116a074dab7a22a0fd4f2c1ab475f16eec42e1ded3c0b0aa8211fe858d6'']","score":"High","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.15395Z"},{"created":"2020-12-17T16:49:45.000Z","id":"indicator--85ebd471-202b-4086-93fb-e075f70f506d","labels":["file
      sha-256"],"modified":"2020-12-17T16:49:45.000Z","pattern":"[file:hashes.sha256
      = ''53f8dfc65169ccda021b72a62e0c22a4db7c4077f002fa742717d41b3c40f2c7'']","score":"High","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.155011Z"},{"created":"2020-12-17T16:52:27.000Z","id":"indicator--57f6e856-0188-4ab8-b563-f3633ec093fb","labels":["file
      sha-256"],"modified":"2020-12-17T16:52:27.000Z","pattern":"[file:hashes.sha256
      = ''d3c6785e18fba3749fb785bc313cf8346182f532c59172b69adfb31b96a5d0af'']","score":"High","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.156195Z"},{"created":"2020-12-17T16:57:26.000Z","id":"indicator--bf705330-2adb-4dfa-a844-d5d1176a0ad0","labels":["url"],"modified":"2020-12-17T16:57:26.000Z","pattern":"[url:value
      = ''mhdosoksaccf9sni9icp.appsync-api.eu-west-1.avsvmcloud.com \t'']","score":"Medium","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.157272Z"},{"created":"2020-12-17T16:57:06.000Z","id":"indicator--2c1cfda2-2481-498f-8123-47ac1276f799","labels":["url"],"modified":"2020-12-17T16:57:06.000Z","pattern":"[url:value
      = ''k5kcubuassl3alrf7gm3.appsync-api.eu-west-1.avsvmcloud.com \t'']","score":"Medium","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.159475Z"},{"created":"2020-12-17T16:59:33.000Z","id":"indicator--a64f9a04-d494-40ee-bb54-9b9406b76372","labels":["domain"],"modified":"2020-12-17T16:59:33.000Z","pattern":"[domain-name:value
      = ''incomeupdate.com'']","score":"High","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.160553Z"},{"created":"2020-12-17T16:52:52.000Z","id":"indicator--8683f37c-2ea9-4253-b8c5-e138ddff40c3","labels":["file
      sha-256"],"modified":"2020-12-17T16:52:52.000Z","pattern":"[file:hashes.sha256
      = ''292327e5c94afa352cc5a02ca273df543f2020d0e76368ff96c84f4e90778712'']","score":"Medium","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.161572Z"},{"created":"2020-12-17T16:46:31.000Z","id":"indicator--cc6f08e1-3475-43bc-ab4e-e5818e5b37b2","labels":["file
      sha-256"],"modified":"2020-12-17T16:46:31.000Z","pattern":"[file:hashes.sha256
      = ''32519b85c0b422e4656de6e6c41878e95fd95026267daab4215ee59c107d6c77'']","score":"High","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.162783Z"},{"created":"2020-12-17T16:47:35.000Z","id":"indicator--9ca400a7-257b-4cf3-91a8-b2c9a565266b","labels":["file
      sha-256"],"modified":"2020-12-17T16:47:35.000Z","pattern":"[file:hashes.sha256
      = ''d0d626deb3f9484e649294a8dfa814c5568f846d5aa02d4cdad5d041a29d5600'']","score":"High","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.163984Z"},{"created":"2020-12-17T17:00:14.000Z","id":"indicator--ea44dc42-e516-4307-9225-21ccb22a7cc2","labels":["domain"],"modified":"2020-12-17T17:00:14.000Z","pattern":"[domain-name:value
      = ''panhardware.com'']","score":"High","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.165095Z"},{"created":"2020-12-17T16:56:41.000Z","id":"indicator--45f9a437-c4ee-4a24-9ffa-35a1202d62d5","labels":["url"],"modified":"2020-12-17T16:56:41.000Z","pattern":"[url:value
      = ''ihvpgv9psvq02ffo77et.appsync-api.us-east-2.avsvmcloud.com'']","score":"High","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.166111Z"},{"created":"2020-12-17T16:55:40.000Z","id":"indicator--242b1ad9-6309-4752-bad4-abf73f641297","labels":["url"],"modified":"2020-12-17T16:55:40.000Z","pattern":"[url:value
      = ''7sbvaemscs0mc925tb99.appsync-api.us-west-2.avsvmcloud.com \t'']","score":"Medium","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.167169Z"},{"created":"2020-12-17T16:55:18.000Z","id":"indicator--b96ee095-a7d4-40a8-a4b4-9e7c080f5a44","labels":["url"],"modified":"2020-12-17T16:55:18.000Z","pattern":"[url:value
      = ''6a57jk2ba1d9keg15cbg.appsync-api.eu-west-1.avsvmcloud.com'']","score":"High","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.168384Z"},{"created":"2020-12-17T16:59:14.000Z","id":"indicator--e03d0075-7880-43cd-86b1-18325470be45","labels":["domain"],"modified":"2020-12-17T16:59:14.000Z","pattern":"[domain-name:value
      = ''highdatabase.com'']","score":"High","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.169586Z"},{"created":"2020-12-17T16:58:56.000Z","id":"indicator--8942bb33-e898-4a10-bfb3-64530bd973ab","labels":["domain"],"modified":"2020-12-17T16:58:56.000Z","pattern":"[domain-name:value
      = ''websitetheme.com'']","score":"High","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.170584Z"},{"created":"2020-12-17T16:56:08.000Z","id":"indicator--2be41276-00d3-4438-bbf0-4fcc56dc3076","labels":["url"],"modified":"2020-12-17T16:56:08.000Z","pattern":"[url:value
      = ''gq1h856599gqh538acqn.appsync-api.us-west-2.avsvmcloud.com'']","score":"High","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.171575Z"},{"created":"2020-12-17T16:58:10.000Z","id":"indicator--8cd838ae-6330-4fbf-b5b4-07b77d46438d","labels":["domain"],"modified":"2020-12-17T16:58:10.000Z","pattern":"[domain-name:value
      = ''freescanonline.com'']","score":"High","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.172676Z"},{"created":"2020-12-17T16:57:52.000Z","id":"indicator--646c5771-6904-4176-813f-a2ca357f0e42","labels":["domain"],"modified":"2020-12-17T16:57:52.000Z","pattern":"[domain-name:value
      = ''deftsecurity.com'']","score":"High","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.173695Z"},{"created":"2020-12-17T16:47:15.000Z","id":"indicator--4069cf11-f617-40f2-8f7f-534e225aa33b","labels":["file
      sha-256"],"modified":"2020-12-17T16:47:15.000Z","pattern":"[file:hashes.sha256
      = ''efbec6863f4330dbb702cc43a85a0a7c29d79fde0f7d66eac9a3be43493cab4f'']","score":"Medium","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.174561Z"},{"created":"2020-12-17T17:00:41.000Z","id":"indicator--026307f7-449c-4858-a112-fc4b73c31593","labels":["domain"],"modified":"2020-12-17T17:00:41.000Z","pattern":"[domain-name:value
      = ''zupertech.com'']","score":"High","source":"","type":"indicator","valid_from":"2020-12-17T17:01:35.175745Z"}]}'
  required: false
  description: Hard-coded STIX file of SUNBURST and SolarStorm indicators.
  playbookInputQuery:
- key: KnownRelatedIOCs
  value:
    simple: d0d626deb3f9484e649294a8dfa814c5568f846d5aa02d4cdad5d041a29d5600, efbec6863f4330dbb702cc43a85a0a7c29d79fde0f7d66eac9a3be43493cab4f,
      d0d626deb3f9484e649294a8dfa814c5568f846d5aa02d4cdad5d041a29d5600, efbec6863f4330dbb702cc43a85a0a7c29d79fde0f7d66eac9a3be43493cab4f,
      32519b85c0b422e4656de6e6c41878e95fd95026267daab4215ee59c107d6c77, d0d626deb3f9484e649294a8dfa814c5568f846d5aa02d4cdad5d041a29d5600,
      efbec6863f4330dbb702cc43a85a0a7c29d79fde0f7d66eac9a3be43493cab4f, 32519b85c0b422e4656de6e6c41878e95fd95026267daab4215ee59c107d6c77,
      019085a76ba7126fff22770d71bd901c325fc68ac55aa743327984e89f4b0134, ce77d116a074dab7a22a0fd4f2c1ab475f16eec42e1ded3c0b0aa8211fe858d6
  required: false
  description: Additional known IOCs related to SUNBURST and SolarStorm.
  playbookInputQuery:
- key: O365_AdminRolesList
  value: {}
  required: false
  description: Comma-separated list of Service O365 admin roles.
  playbookInputQuery:
- key: Limit
  value:
    simple: "10"
  required: false
  description: The maximum number of results to retrieve. Default is 10.
  playbookInputQuery:
outputs: []
tests:
- No tests
fromversion: 5.5.0
toversion: 5.9.9
