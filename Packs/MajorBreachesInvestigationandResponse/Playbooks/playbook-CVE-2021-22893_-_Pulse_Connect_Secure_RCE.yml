id: CVE-2021-22893 - Pulse Connect Secure RCE
version: -1
name: CVE-2021-22893 - Pulse Connect Secure RCE
description: "On April 20th, a new Remote Code Execution vulnerability in Pulse Connect Secure was disclosed.\
  \ \nThe reference number for the vulnerability is CVE-2021-22893 with the CVSS Score of 10.0.\
  \ \nThis playbook should be trigger manually and includes the following tasks:\
  \ \n\n* Enrich related known CVEs and Malware Hashes\
  \ used by the suspected APT actor.\n* Search for unpatched endpoints vulnerable\
  \ to the exploits.\n* Search network facing system using Expanse for relevant issues.\n\
  * Indicators and known webshells hunting using SIEM products.\n* Block indicators\
  \ automatically or manually.\n* Provide different mitigations that has been publicly\
  \ published such as:\n    * Patches\n    * Workarounds\n    * Yara and Snort Rules\n\
  \nNote: This is a beta playbook, which lets you implement and test pre-release software. Since the playbook is beta, it might contain bugs. Updates to the pack during the beta phase might include non-backward compatible features. We appreciate your feedback on the quality and usability of the pack to help us identify issues, fix them, and continually improve.\n\
  \nMore information:\n[Exploitation of Pulse Connect Secure Vulnerabilities](https://us-cert.cisa.gov/ncas/alerts/aa21-110a)\n"
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 118ca048-d262-410d-8087-d78ac69ee472
    type: start
    task:
      id: 118ca048-d262-410d-8087-d78ac69ee472
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "35"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 770,
          "y": -270
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "1":
    id: "1"
    taskid: 538f5c68-52bf-4250-8d0a-5a65c3645249
    type: regular
    task:
      id: 538f5c68-52bf-4250-8d0a-5a65c3645249
      version: -1
      name: Enrich CVE Indicators
      description: Enrich CVEs indicators
      script: Builtin|||enrichIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      indicatorsValues:
        complex:
          root: CVE
          accessor: ID
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 540,
          "y": 230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "2":
    id: "2"
    taskid: 2b13749a-cdf3-46a5-8350-96419476a2a8
    type: regular
    task:
      id: 2b13749a-cdf3-46a5-8350-96419476a2a8
      version: -1
      name: Enrich Hash Indicators
      description: commands.local.cmd.enrich.indicators
      script: Builtin|||enrichIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      indicatorsValues:
        complex:
          root: File
          accessor: MD5
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: ${File.SHA1}
          - operator: append
            args:
              item:
                value:
                  simple: ${File.SHA256}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 990,
          "y": 230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "3":
    id: "3"
    taskid: 738dc874-0bed-47e7-81af-7349dd299f73
    type: title
    task:
      id: 738dc874-0bed-47e7-81af-7349dd299f73
      version: -1
      name: Enrichment
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "2"
      - "1"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 770,
          "y": 70
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "4":
    id: "4"
    taskid: 1b34af4d-e5e6-43bb-8991-be5bba48dcd1
    type: title
    task:
      id: 1b34af4d-e5e6-43bb-8991-be5bba48dcd1
      version: -1
      name: Hunting
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "5"
      - "6"
      - "7"
      - "12"
      - "25"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 770,
          "y": 410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "5":
    id: "5"
    taskid: d54607ea-6e68-490f-8ec4-bd8b5d93f9e9
    type: title
    task:
      id: d54607ea-6e68-490f-8ec4-bd8b5d93f9e9
      version: -1
      name: SIEM Hunt
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "10"
      - "37"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -1040,
          "y": 620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "6":
    id: "6"
    taskid: 6ef23ed1-15ee-45e5-8618-b0469f5d684e
    type: title
    task:
      id: 6ef23ed1-15ee-45e5-8618-b0469f5d684e
      version: -1
      name: Vulnerability Scanners Hunt
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "8"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -300,
          "y": 620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "7":
    id: "7"
    taskid: 4ea49aee-da53-41b6-874e-a2cd55da9889
    type: title
    task:
      id: 4ea49aee-da53-41b6-874e-a2cd55da9889
      version: -1
      name: Palo Alto Networks Hunt
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "9"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1810,
          "y": 620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "8":
    id: "8"
    taskid: 1a8709be-110c-4354-8e57-819232c2e66d
    type: playbook
    task:
      id: 1a8709be-110c-4354-8e57-819232c2e66d
      version: -1
      name: Search Endpoint by CVE - Generic
      description: Hunt for assets with a given CVE using available tools
      playbookName: Search Endpoint by CVE - Generic
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      CVE_ID:
        complex:
          root: CVE
          accessor: ID
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": -300,
          "y": 780
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "9":
    id: "9"
    taskid: e2569c28-a2f7-4534-881d-2c9c851b873f
    type: playbook
    task:
      id: e2569c28-a2f7-4534-881d-2c9c851b873f
      version: -1
      name: Palo Alto Networks - Hunting And Threat Detection
      description: "This is a multipurpose playbook used for hunting and threat detection.\
        \ The playbook receives inputs based on hashes, IP addresses, or domain names\
        \ provided manually or from outputs by other playbooks. \nWith the received\
        \ indicators, the playbook leverages data received by PANW products including,\
        \ Cortex Data Lake, Autofocus and Pan-OS to search for IP addresses, host\
        \ names and users related to the provided indicators.\nThe output provided\
        \ by the playbook facilitates pivoting searches for possibly affected IP addresses\
        \ or users."
      playbookName: Palo Alto Networks - Hunting And Threat Detection
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      MD5:
        complex:
          root: File
          accessor: MD5
      SHA1:
        complex:
          root: File
          accessor: SHA1
      SHA256:
        complex:
          root: File
          accessor: SHA256
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1810,
          "y": 780
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
  "10":
    id: "10"
    taskid: af5f8e76-3987-4e78-8ab7-06f3ef1e3723
    type: playbook
    task:
      id: af5f8e76-3987-4e78-8ab7-06f3ef1e3723
      version: -1
      name: Splunk Indicator Hunting
      description: This playbook queries Splunk for indicators such as file hashes,
        IP addresses, domains, or urls. It outputs detected users, ip addresses, and
        hostnames related to the indicators.
      playbookName: Splunk Indicator Hunting
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      IndexName:
        simple: '*'
      MD5:
        complex:
          root: File
          accessor: MD5
      SHA1:
        complex:
          root: File
          accessor: SHA1
      SHA256:
        complex:
          root: File
          accessor: SHA256
      SelectFields:
        simple: source,timestamp
      earliest_time:
        simple: -30d
      event_limit:
        simple: "100"
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": -810,
          "y": 780
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
  "12":
    id: "12"
    taskid: 36202c7f-bb54-46d2-88f8-cbb88515282c
    type: title
    task:
      id: 36202c7f-bb54-46d2-88f8-cbb88515282c
      version: -1
      name: Expanse Issues Hunt
      description: Retrieve issues
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "16"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2470,
          "y": 620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "13":
    id: "13"
    taskid: 10e6fe5c-8f2d-4e89-89a7-c385e08c5d94
    type: regular
    task:
      id: 10e6fe5c-8f2d-4e89-89a7-c385e08c5d94
      version: -1
      name: Search for Pulse Secure VPN Devices with an open issues
      description: Retrieve issues related to Pulse Secure VPN.
      script: '|||expanse-get-issues'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      content_search:
        simple: Pulse Secure SSL VPN
      issue_type:
        simple: VPN Device
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2470,
          "y": 1175
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "14":
    id: "14"
    taskid: 36aa216c-55c2-416d-8d32-3d59e7f794eb
    type: title
    task:
      id: 36aa216c-55c2-416d-8d32-3d59e7f794eb
      version: -1
      name: Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "15"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 770,
          "y": 1350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "15":
    id: "15"
    taskid: e38d9770-146c-4cea-8c3d-e0b60edf19b3
    type: condition
    task:
      id: e38d9770-146c-4cea-8c3d-e0b60edf19b3
      version: -1
      name: Block indicators automatically?
      description: Check the playbook input (True/False) responsible for automatically
        block indicators.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "18"
      "yes":
      - "17"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.BlockAutomatically
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 770,
          "y": 1510
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "16":
    id: "16"
    taskid: f3c3008f-90f9-48c9-8d07-93695d1b7164
    type: condition
    task:
      id: f3c3008f-90f9-48c9-8d07-93695d1b7164
      version: -1
      name: Is Expanse Enabled?
      description: Check if Expanse instance is enabled.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "14"
      "yes":
      - "13"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: ExpanseV2
                accessor: state
            iscontext: true
          right:
            value:
              simple: active
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 2470,
          "y": 780
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "17":
    id: "17"
    taskid: 8d4a3778-1922-4c0d-85cd-f28da943ad9b
    type: playbook
    task:
      id: 8d4a3778-1922-4c0d-85cd-f28da943ad9b
      version: -1
      name: Block Indicators - Generic v2
      playbookName: Block Indicators - Generic v2
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "19"
    separatecontext: true
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1700
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "18":
    id: "18"
    taskid: 53b781cf-16ac-4f2c-8cf7-b9a38c905a96
    type: regular
    task:
      id: 53b781cf-16ac-4f2c-8cf7-b9a38c905a96
      version: -1
      name: Manually block indicators
      description: Ask the user to manually block the indicators.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "19"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1050,
          "y": 1700
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "19":
    id: "19"
    taskid: cdbd9ccc-696d-4922-8270-a3d427ff7721
    type: title
    task:
      id: cdbd9ccc-696d-4922-8270-a3d427ff7721
      version: -1
      name: Mitigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "20"
      - "24"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 770,
          "y": 1890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "20":
    id: "20"
    taskid: b1147f87-0a17-4e1c-8bb6-47a41e0644b3
    type: condition
    task:
      id: b1147f87-0a17-4e1c-8bb6-47a41e0644b3
      version: -1
      name: Is Pulse Secure is patched?
      description: Check the data collected manually or automatically and decide whether
        Pulse Connect Secure is patched or not.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "No":
      - "22"
      - "23"
      "Yes":
      - "21"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 770,
          "y": 2070
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "21":
    id: "21"
    taskid: 8395c5bf-def6-4ae2-8e4f-6d5a481aca4b
    type: regular
    task:
      id: 8395c5bf-def6-4ae2-8e4f-6d5a481aca4b
      version: -1
      name: 'Review all data collected '
      description: Request for final review of the data collected.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "34"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 770,
          "y": 2510
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "22":
    id: "22"
    taskid: 851ba79b-fa66-4bb1-885c-bdb7f0beb7b9
    type: regular
    task:
      id: 851ba79b-fa66-4bb1-885c-bdb7f0beb7b9
      version: -1
      name: 'Install related patches and workarounds '
      description: |-
        Related patches and workarounds:

        [1.CVE-2021-22893](https://kb.pulsesecure.net/pkb_mobile#article/l:en_US/SA44784/s)
        [2.CVE-2020-8260](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-8260)
        [3.CVE-2020-8243](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-8243)
        [4.CVE-2019-11510](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-11510)

        Deny access to the following URIs:
        ^/+dana/+meeting
        ^/+dana/+fb/+smb
        ^/+dana-cached/+fb/+smb
        ^/+dana-ws/+namedusers
        ^/+dana-ws/+metric

        **Note: SSL decryption is needed in order to deny access to the provided URIs.**
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "21"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 440,
          "y": 2310
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "23":
    id: "23"
    taskid: 1aa54391-b4ad-4b90-8639-38ef4bc4aa78
    type: regular
    task:
      id: 1aa54391-b4ad-4b90-8639-38ef4bc4aa78
      version: -1
      name: 'Run Pulse Connect Secure Integrity Tool '
      description: |-
        This tool created by the vendor will assist with determining if systems have been impacted.

        [Pulse Connect Secure Integrity Tool ](https://kb.pulsesecure.net/articles/Pulse_Secure_Article/KB44755)
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "21"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1100,
          "y": 2310
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "24":
    id: "24"
    taskid: d95dead4-461d-42a2-867c-c87d122cfeec
    type: regular
    task:
      id: d95dead4-461d-42a2-867c-c87d122cfeec
      version: -1
      name: Download Yara/Snort rules from FireEye Mandiant GitHub repository
      description: |-
        [FireEye Mandiant PulseSecure Exploitation Countermeasures](https://github.com/fireeye/pulsesecure_exploitation_countermeasures)

        These rules are provided freely to the community without warranty.

        In this GitHub repository you will find rules in multiple languages:

        Snort
        Yara
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "34"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -40,
          "y": 2070
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "25":
    id: "25"
    taskid: 7346b5b9-9edd-4071-84ae-cf11fcc51dfd
    type: title
    task:
      id: 7346b5b9-9edd-4071-84ae-cf11fcc51dfd
      version: -1
      name: Webshell Access Attempts Hunt
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "31"
      - "38"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 770,
          "y": 610
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "26":
    id: "26"
    taskid: fd5a97d3-c905-4a6a-8a8a-3194abfc485e
    type: title
    task:
      id: fd5a97d3-c905-4a6a-8a8a-3194abfc485e
      version: -1
      name: Hunt Activity Using Splunk
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "28"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1200,
          "y": 930
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "27":
    id: "27"
    taskid: d3d930ea-43fe-4e5b-80e1-bf593196cfef
    type: title
    task:
      id: d3d930ea-43fe-4e5b-80e1-bf593196cfef
      version: -1
      name: Hunt Activity Using Qradar
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "30"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 340,
          "y": 930
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "28":
    id: "28"
    taskid: 8b830a50-fd87-4eb8-8e65-ae6b0cb6465d
    type: regular
    task:
      id: 8b830a50-fd87-4eb8-8e65-ae6b0cb6465d
      version: -1
      name: Search access attempts in Pulse Secure Logs
      description: Searches Splunk for events related to the webshells names.
      script: '|||splunk-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      latest_time:
        simple: now
      query:
        complex:
          root: inputs.SplunkWebshellsQuery
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1200,
          "y": 1080
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "30":
    id: "30"
    taskid: ae0147bd-4aca-4811-89f0-3a2b20f5a00b
    type: playbook
    task:
      id: ae0147bd-4aca-4811-89f0-3a2b20f5a00b
      version: -1
      name: QRadarFullSearch
      description: This playbook runs a QRadar query and return its results to the
        context.
      playbookName: QRadarFullSearch
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      interval:
        simple: "1"
      query_expression:
        complex:
          root: inputs.QRadarWebshellsQuery
      timeout:
        simple: "600"
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 340,
          "y": 1080
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "31":
    id: "31"
    taskid: 3db07ba7-02c3-469e-85bc-a2916993cd6c
    type: condition
    task:
      id: 3db07ba7-02c3-469e-85bc-a2916993cd6c
      version: -1
      name: Is QRadar Enabled?
      description: Check if QRadar or Splunk instances are enabled.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "33"
      "No":
      - "14"
      "Yes":
      - "27"
    separatecontext: false
    conditions:
    - label: "Yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: inList
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: QRadar,QRadar_v2
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.RunWebshellsQuery
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: inputs.QRadarWebshellsQuery
            iscontext: true
    - label: "No"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: SplunkPy
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
    view: |-
      {
        "position": {
          "x": 550,
          "y": 760
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "33":
    id: "33"
    taskid: e93a5f2f-143d-4a42-83a6-ddc8974d1c7f
    type: regular
    task:
      id: e93a5f2f-143d-4a42-83a6-ddc8974d1c7f
      version: -1
      name: Hunt for the webshells names in PCS logs
      description: "Search in your Data Lake for access to one of the following URIs:\n\
        \n*Licenseserverproto.cgi*\n*Secid_canceltoken.cgi* \n*compcheckresult.cgi*\n\
        *Login.cgi*\n*Healthcheck.cgi*\n*meeting_testjs.cgi*\n*compcheckjava.cgi*\n\
        \nLook at the following example of Pulse Secure Connect message:\n\n\"Unauthenticated\
        \ request url /dana-na/meeting/meeting_testjs.cgi?id=* came from IP XX.XX.XX.XX.\""
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "14"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 770,
          "y": 970
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "34":
    id: "34"
    taskid: 7feb8511-a107-448c-8f93-ae69021a1bf5
    type: title
    task:
      id: 7feb8511-a107-448c-8f93-ae69021a1bf5
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 770,
          "y": 2730
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "35":
    id: "35"
    taskid: 1c7e827e-e20f-49a2-896f-465d692d8aed
    type: regular
    task:
      id: 1c7e827e-e20f-49a2-896f-465d692d8aed
      version: -1
      name: Extract Indicators
      description: commands.local.cmd.extract.indicators
      script: Builtin|||extractIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      text:
        complex:
          root: inputs.Related_Hashes
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: ${inputs.Related_CVEs}
    reputationcalc: 2
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 770,
          "y": -110
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "37":
    id: "37"
    taskid: bbfd1451-2e67-49a7-8d01-a81814ededc7
    type: playbook
    task:
      id: bbfd1451-2e67-49a7-8d01-a81814ededc7
      version: -1
      name: QRadar Indicator Hunting V2
      description: 'The Playbook queries QRadar SIEM for indicators such as file hashes,
        IP addresses, domains, or urls. '
      playbookName: QRadar Indicator Hunting V2
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      InvestigationIPFields:
        simple: sourceip,destinationip
      InvestigationUserFields:
        simple: username
      MD5:
        complex:
          root: File
          accessor: MD5
      QradarIPfield:
        simple: sourceip,destinationip
      QradarMD5Field:
        complex:
          root: inputs.QRadar_MD5_Field
      QradarSHA1Field:
        complex:
          root: inputs.QRadar_SHA1_Field
      QradarSHA256Field:
        complex:
          root: inputs.QRadar_SHA256_Field
      SHA1:
        complex:
          root: File
          accessor: SHA1
      SHA256:
        complex:
          root: File
          accessor: SHA256
      TimeFrame:
        simple: LAST 7 DAYS
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": -1270,
          "y": 780
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "38":
    id: "38"
    taskid: 29d6e98f-e1a1-43b2-89b4-154e83426f0c
    type: condition
    task:
      id: 29d6e98f-e1a1-43b2-89b4-154e83426f0c
      version: -1
      name: Is Splunk Enabled?
      description: Check if QRadar or Splunk instances are enabled.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "33"
      "No":
      - "14"
      "Yes":
      - "26"
    separatecontext: false
    conditions:
    - label: "Yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: SplunkPy
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.RunWebshellsQuery
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: inputs.SplunkWebshellsQuery
            iscontext: true
    - label: "No"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: inList
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Qradar,Qradar_V2
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
    view: |-
      {
        "position": {
          "x": 990,
          "y": 760
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
view: |-
  {
    "linkLabelsPosition": {
      "15_18_#default#": 0.77,
      "16_13_yes": 0.48,
      "16_14_#default#": 0.11,
      "20_22_No": 0.64,
      "31_14_No": 0.26,
      "38_14_No": 0.25,
      "38_33_#default#": 0.76
    },
    "paper": {
      "dimensions": {
        "height": 3065,
        "width": 4120,
        "x": -1270,
        "y": -270
      }
    }
  }
inputs:
- key: Related_Hashes
  value:
    simple: 06c56bd272b19bf7d7207443693cd1fc774408c4ca56744577b11fee550c23f7, 64c87520565165ac95b74d6450b3ab8379544933dd3e2f2c4dc9b03a3ec570a7,
      1322340356018696d853e0ac6f7ce3a2, 09956753b5000061524d204000000001, 88170125598a4fb801102ad56494a773895059ac8550a983fdd2ef429653f079,
      9f6ac39707822d243445e30d27b8404466aa69c61119d5308785bf4a464a9ebd, 325d6d60e24c7cfc3a782839d85ce08c8d3bb27c,
      1ab50b77dd9515f6cd9ed07d1d3176ba4627a292dc4a21b16ac9d211353818bd, 1741dc0a491fcc8d078220ac9628152668d3370b92a8eae258e34ba28c6473b9,
      cd09ec795a8f4b6ced003500a44d810f49943514e2f92c81ab96c33e1c0fbd68, d72daafedf41d484f7f9816f7f076a9249a6808f1899649b7daa22c0447bb37b,
      c9b323b9747659eac25cec078895d75f016e26a8b5858567c7fb945b7321722c, 2610d0372e0e107053bc001d278ef71f08562e5610691f18b978123c499a74d8,
      c774eca633136de35c9d2cd339a3b5d29f00f761657ea2aa438de4f33e4bbba4, 224b7c45cf6fe4547d3ea66a12c30f3cb4c601b0a80744154697094e73dbd450,
      78d7c7c9f800f6824f63a99d935a4ad0112f97953d8c100deb29dae24d7da282, 1d3ab04e21cfd40aa8d4300a359a09e3b520d39b1496be1e4bc91ae1f6730ecc,
      133631957d41eed9496ac2774793283ce26f8772de226e7f520d26667b51481a, 68743e17f393d1f85ee937dffacc91e081b5f6f43477111ac96aa9d44826e4d2,
      7fa71a7f76ef63465cfeacf58217e0b66fc71bc81d37c44380a6f572b8a3ec7a, f2b1bd703c3eb05541ff84ec375573cbdc70309ccb82aac04b72db205d718e90,
      a1dcdf62aafc36dd8cf64774dea80d79fb4e24ba2a82adf4d944d9186acd1cc1, e63ab6f82c711e4ecc8f5b36046eb7ea216f41eb90158165b82a6c90560ea415,
      b2350954b9484ae4eac42b95fae6edf7a126169d0b93d79f49d36c5e6497062a, b1c2368773259fbfef425e0bb716be958faa7e74b3282138059f511011d3afd9,
      b990f79ce80c24625c97810cb8f161eafdcb10f1b8d9d538df4ca9be387c35e4, 168976797d5af7071df257e91fcc31ce1d6e59c72ca9e2f50c8b5b3177ad83cc,
      4c5555955b2e6dc55f52b0c1a3326f3d07b325b112060329c503b294208960ec, 705cda7d1ace8f4adeec5502aa311620b8d6c64046a1aed2ae833e2f2835154f
  required: false
  description: The known hashes of different malware families associated with the
    exploitation.
  playbookInputQuery:
- key: Related_CVEs
  value:
    simple: CVE-2019-11510, CVE-2020-8260, CVE-2020-8243, CVE-2021-22893
  required: false
  description: The known CVEs associated with the exploitation.
  playbookInputQuery:
- key: BlockAutomatically
  value:
    simple: "False"
  required: false
  description: |-
    Whether to block the indicators automatically.
    Default: False.
  playbookInputQuery:
- key: QRadarWebshellsQuery
  value:
    simple: select * from events WHERE LogSourceTypeName(deviceType) = 'Pulse Secure
      Pulse Connect Secure' and ( UTF8(payload) LIKE '%Licenseserverproto.cgi%' or
      UTF8(payload) LIKE '%Secid_canceltoken.cgi%' or UTF8(payload) LIKE '%compcheckresult.cgi%'
      or UTF8(payload) LIKE '%Login.cgi%' or UTF8(payload) LIKE '%Healthcheck.cgi%'
      or UTF8(payload) LIKE '%meeting_testjs.cgi%' or UTF8(payload) LIKE '%compcheckjava.cgi%')
  required: false
  description: |-
    The QRadar search query used for "Hunt Activity Using QRadar".
    Please note that there aren't specified fields which may cause a longer run time.
  playbookInputQuery:
- key: SplunkWebshellsQuery
  value:
    simple: earliest=-30d latest=now index=* sourcetype=pulse:connectsecure "Licenseserverproto.cgi"
      OR "Secid_canceltoken.cgi" OR "compcheckresult.cgi" OR "Healthcheck.cgi" OR
      "meeting_testjs.cgi" OR "compcheckjava.cgi"
  required: false
  description: |-
    The Splunk search query used for "Hunt Activity Using Splunk".
    Please note that there are two specified fields: msg, message. the query will work for both field names.
  playbookInputQuery:
- key: RunWebshellsQuery
  value:
    simple: "True"
  required: false
  description: If you would like to skip "Hunt Activity Using Splunk" OR "Hunt Activity
    Using Qradar" please change the value to 'False'.
  playbookInputQuery:
- key: QRadar_MD5_Field
  value: {}
  required: false
  description: |-
    The name of the field for MD5 entries in QRadar.
    If not configured, QRadar Indicator Hunting may reach timeout.
  playbookInputQuery:
- key: QRadar_SHA1_Field
  value: {}
  required: false
  description: |-
    The name of the field for SHA1 entries in QRadar.
    If not configured, QRadar Indicator Hunting may reach timeout.
  playbookInputQuery:
- key: QRadar_SHA256_Field
  value: {}
  required: false
  description: |-
    The name of the field for SHA256 entries in QRadar.
    If not configured, QRadar Indicator Hunting may reach timeout.
  playbookInputQuery:
outputs: []
tests:
- No tests (auto formatted)
fromversion: 6.0.0
