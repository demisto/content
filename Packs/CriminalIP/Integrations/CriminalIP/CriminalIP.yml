category: Data Enrichment & Threat Intelligence
sectionOrder:
- Connect
commonfields:
  id: CriminalIP
  version: -1

configuration:
- displaypassword: API Key
  additionalinfo: The API Key to use for connection
  name: credentials
  required: false
  hiddenusername: true
  section: Connect
  type: 9

- display: Server URL
  name: url
  type: 0
  required: false
  defaultvalue: ""
  additionalinfo: "The base URL of the Criminal IP API. (Default: api.criminalip.io)"
  section: Connect

- display: Trust any certificate (not secure)
  name: insecure
  type: 8
  required: false
  section: Connect
  additionalinfo: When set to true, SSL certificates will not be validated.

- display: Use system proxy settings
  name: proxy
  type: 8
  required: false
  section: Connect
  additionalinfo: Use the system proxy settings to communicate with the API.

- display: Request timeout (seconds)
  name: request_timeout
  type: 0
  required: false
  section: Connect
  defaultvalue: "30"
  additionalinfo: Timeout for HTTP requests in seconds. Default is 30.

description: |
  Criminal IP is a comprehensive cyber threat intelligence solution that provides actionable insights into IP addresses, domains, and connected assets across the internet.
  It enables organizations to detect malicious indicators, assess asset reputation, and enhance threat detection by integrating enriched threat data directly into security operations via the XSOAR interface.

name: CriminalIP
display: Criminal IP

script:
  type: python
  subtype: python3
  dockerimage: demisto/python3:3.12.11.4508456
  script: '-'
  runonce: false
  isfetch: false
  commands:

  # --- IP Report ---
  - name: criminal-ip-ip-report
    description: Provides detailed information about IP addresses through Criminal IP's API.
    arguments:
    - name: ip
      description: The IP address to search.
      required: true
      default: true
      type: String
    outputs:
    - contextPath: CriminalIP.IP.ip
      description: Queried IP Address.
      type: String
    - contextPath: CriminalIP.IP.score.inbound
      description: Inbound Score.
      type: String
    - contextPath: CriminalIP.IP.score.outbound
      description: Outbound Score.
      type: String
    - contextPath: CriminalIP.IP.issues
      description: Detected Issues (VPN, Proxy, Tor, etc.)
      type: Unknown
    - contextPath: CriminalIP.IP.vulnerability
      description: Vulnerabilities detected on the IP.
      type: Unknown
    - contextPath: CriminalIP.IP.raw
      description: Full raw response from Criminal IP API.
      type: Unknown

  # --- Check Malicious IP ---
  - name: criminal-ip-check-malicious-ip
    description: Determines whether an IP is malicious or safe through Criminal IP Asset Search.
    arguments:
    - name: ip
      description: IP Address to check.
      required: true
      default: true
      type: String
    outputs:
    - contextPath: CriminalIP.Mal_IP.result
      description: Malicious / Safe decision.
      type: String
    - contextPath: CriminalIP.Mal_IP.real_ip
      description: Real IP if detected.
      type: String
    - contextPath: CriminalIP.Mal_IP.raw
      description: Full raw response.
      type: Unknown

  # --- Domain Quick Scan ---
  - name: criminal-ip-domain-quick-scan
    description: Performs a Domain Quick Scan using Criminal IP's API.
    arguments:
    - name: domain
      description: The domain to perform Quick Scan.
      required: true
      default: true
      type: String
    outputs:
    - contextPath: CriminalIP.Domain_Quick.domain
      description: Queried Domain.
      type: String
    - contextPath: CriminalIP.Domain_Quick.risk_score
      description: Risk Score.
      type: Number
    - contextPath: CriminalIP.Domain_Quick.raw
      description: Full raw response.
      type: Unknown

  # --- Domain Lite Scan ---
  - name: criminal-ip-domain-lite-scan
    description: Initiates a Domain Lite Scan and returns a scan_id.
    arguments:
    - name: domain
      description: The domain to perform Lite Scan.
      required: true
      default: true
      type: String
    outputs:
    - contextPath: CriminalIP.Domain_Lite.scan_id
      description: Scan ID returned for Lite Scan.
      type: String
    - contextPath: CriminalIP.Domain_Lite.raw
      description: Full raw response.
      type: Unknown

  - name: criminal-ip-domain-lite-scan-status
    description: Checks the progress of the Lite Scan.
    arguments:
    - name: scan_id
      description: The scan_id whose Lite Scan progress to check.
      required: true
      default: true
      type: String
    outputs:
    - contextPath: CriminalIP.Domain_Lite_Status.status
      description: Lite Scan status.
      type: String
    - contextPath: CriminalIP.Domain_Lite_Status.raw
      description: Full raw response.
      type: Unknown

  - name: criminal-ip-domain-lite-scan-result
    description: Returns the Lite Scan results for the given scan_id.
    arguments:
    - name: scan_id
      description: The scan_id whose Lite Scan result to fetch.
      required: true
      default: true
      type: String
    outputs:
    - contextPath: CriminalIP.Domain_Lite_Result.domain
      description: Queried Domain.
      type: String
    - contextPath: CriminalIP.Domain_Lite_Result.vulns
      description: CVEs detected.
      type: Unknown
    - contextPath: CriminalIP.Domain_Lite_Result.raw
      description: Full raw response.
      type: Unknown

  # --- Domain Full Scan ---
  - name: criminal-ip-domain-full-scan
    description: Initiates a Domain Full Scan and returns a scan_id.
    arguments:
    - name: domain
      description: The domain to perform Full Scan.
      required: true
      default: true
      type: String
    outputs:
    - contextPath: CriminalIP.Full_Scan.scan_id
      description: Scan ID returned for Full Scan.
      type: String
    - contextPath: CriminalIP.Full_Scan.raw
      description: Full raw response.
      type: Unknown

  - name: criminal-ip-domain-full-scan-status
    description: Checks the progress of the Full Scan.
    arguments:
    - name: scan_id
      description: The scan_id whose Full Scan status to check.
      required: true
      default: true
      type: String
    outputs:
    - contextPath: CriminalIP.Full_Scan_Status.status
      description: Full Scan status.
      type: String
    - contextPath: CriminalIP.Full_Scan_Status.raw
      description: Full raw response.
      type: Unknown

  - name: criminal-ip-domain-full-scan-result
    description: Returns the Full Scan results for the given scan_id.
    arguments:
    - name: scan_id
      description: The scan_id whose Full Scan result to fetch.
      required: true
      default: true
      type: String
    outputs:
    - contextPath: CriminalIP.Full_Scan_Result.domain
      description: Queried Domain.
      type: String
    - contextPath: CriminalIP.Full_Scan_Result.certificates
      description: Certificate Information.
      type: Unknown
    - contextPath: CriminalIP.Full_Scan_Result.vulns
      description: CVEs detected in Full Scan.
      type: Unknown
    - contextPath: CriminalIP.Full_Scan_Result.raw
      description: Full raw response.
      type: Unknown

  # --- Full Scan Email Body ---
  - name: criminal-ip-domain-full-scan-make-email-body
    description: Builds an email body summarizing notable findings from a completed Full Scan.
    arguments:
    - name: scan_id
      description: The scan_id of the completed Full Scan.
      required: true
      default: true
      type: String
    - name: domain
      description: The domain of the completed Full Scan.
      required: true
      type: String
    outputs:
    - contextPath: CriminalIP.Email_Body
      description: Generated email body string.
      type: String

  # --- Micro ASM ---
  - name: criminal-ip-micro-asm
    description: Performs a micro ASM-style summary for a domain with a completed Full Scan.
    arguments:
    - name: scan_id
      description: The scan_id of the completed Full Scan.
      required: true
      default: true
      type: String
    - name: domain
      description: The domain of the completed Full Scan.
      required: true
      type: String
    outputs:
    - contextPath: CriminalIP.Micro_ASM.summary
      description: Concise summary string of notable findings.
      type: String
    - contextPath: CriminalIP.Micro_ASM.raw
      description: Full raw response.
      type: Unknown

tests:
- Test-CriminalIP
fromversion: 6.10.0
