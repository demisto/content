id: Pull Request Creation - Github
version: 3
vcShouldKeepItemLegacyProdMachine: false
name: Pull Request Creation - Github
description: This playbook creates a pull request using Github integration.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: d31f8aa5-49f3-4695-8365-70cfdef68e79
    type: start
    task:
      id: d31f8aa5-49f3-4695-8365-70cfdef68e79
      version: -1
      name: ""
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "37"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 725
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: d8c6641b-baee-41da-8ba9-40dcb830a18d
    type: regular
    task:
      id: d8c6641b-baee-41da-8ba9-40dcb830a18d
      version: -1
      name: Get main branch
      description: Gets a branch.
      script: '|||GitHub-get-branch'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "38"
    scriptarguments:
      branch_name:
        complex:
          root: inputs.MainBranch
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: 4228e188-f500-4556-8b91-a036d7181a89
    type: regular
    task:
      id: 4228e188-f500-4556-8b91-a036d7181a89
      version: -1
      name: Create new branch
      description: Create a new branch.
      script: '|||GitHub-create-branch'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "39"
    scriptarguments:
      branch_name:
        complex:
          root: BranchName
      commit_sha:
        complex:
          root: GitHub.Branch
          accessor: CommitSHA
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 367.5,
          "y": 2410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: e657b33f-0cf1-44d6-8417-f0ea08acaa65
    type: regular
    task:
      id: e657b33f-0cf1-44d6-8417-f0ea08acaa65
      version: -1
      name: Commit files
      scriptName: CommitFiles
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      branch:
        complex:
          root: BranchName
      comment:
        complex:
          root: incident
          accessor: cicdpullrequestcomment
      files:
        complex:
          root: File
      pack:
        complex:
          root: PackName
      template:
        complex:
          root: inputs.PullRequestTemplate
      user:
        complex:
          root: DemistoUsers
          transformers:
          - operator: FirstArrayElement
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2730
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: 3df3afbe-a42e-4295-8e5a-d13ce72e851f
    type: regular
    task:
      id: 3df3afbe-a42e-4295-8e5a-d13ce72e851f
      version: -1
      name: Create pull request
      description: Creates a new pull request.
      script: '|||GitHub-create-pull-request'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      base:
        complex:
          root: inputs.MainBranch
      body:
        complex:
          root: PR_text
      draft:
        simple: "false"
      head:
        complex:
          root: BranchName
      title:
        complex:
          root: incident
          accessor: cicdpullrequesttitle
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 3400
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: 3b01149f-7b61-4ee7-82ac-416c900f8ecc
    type: regular
    task:
      id: 3b01149f-7b61-4ee7-82ac-416c900f8ecc
      version: -1
      name: Request pr review
      description: Requests reviews from GitHub users for a given pull request.
      script: '|||GitHub-request-review'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "36"
    scriptarguments:
      pull_number:
        complex:
          root: GitHub.PR
          accessor: Number
      reviewers:
        complex:
          root: incident
          accessor: cicdreviewer
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 377.5,
          "y": 3750
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: 3c224a7b-74be-4a11-8ec1-213b7f30dc50
    type: condition
    task:
      id: 3c224a7b-74be-4a11-8ec1-213b7f30dc50
      version: -1
      name: Add reviewer?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "36"
      "yes":
      - "8"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: incident.cicdreviewer
            iscontext: true
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 265,
          "y": 3575
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: dba6adae-e216-4617-8b00-20c8651a3844
    type: regular
    task:
      id: dba6adae-e216-4617-8b00-20c8651a3844
      version: -1
      name: Get branch
      description: Gets a branch.
      script: '|||GitHub-get-branch'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "19"
    scriptarguments:
      branch_name:
        complex:
          root: BranchName
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2060
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: e519ed19-024e-4f59-845a-b01f385f3918
    type: condition
    task:
      id: e519ed19-024e-4f59-845a-b01f385f3918
      version: -1
      name: Does branch exist?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "3"
      "yes":
      - "39"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: GitHub.Branch
                accessor: Name
            iscontext: true
          right:
            value:
              simple: BranchName
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2235
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: a70686aa-a86c-4c3f-837a-153f9be051b7
    type: condition
    task:
      id: a70686aa-a86c-4c3f-837a-153f9be051b7
      version: -1
      name: Does branch exist?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "40"
      "yes":
      - "41"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: GitHub.Branch
                accessor: Name
            iscontext: true
          right:
            value:
              simple: BranchName
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2905
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: 79fdc115-113b-4552-8910-343174fde0ea
    type: regular
    task:
      id: 79fdc115-113b-4552-8910-343174fde0ea
      version: -1
      name: Set branch name from CI/CD Branch field
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "2"
    scriptarguments:
      key:
        simple: BranchName
      value:
        complex:
          root: incident
          accessor: cicdbranch
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1565
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: 866c763c-0f48-4b5e-8eb7-b209609d6ee5
    type: condition
    task:
      id: 866c763c-0f48-4b5e-8eb7-b209609d6ee5
      version: -1
      name: Is CI/CD Branch field given
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "27"
      "yes":
      - "25"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: incident.cicdbranch
            iscontext: true
          right:
            value: {}
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 265,
          "y": 1215
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: 40435712-a28c-43f0-8301-64f76f944861
    type: regular
    task:
      id: 40435712-a28c-43f0-8301-64f76f944861
      version: -1
      name: Suggest branch name
      scriptName: SuggestBranchName
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "28"
    scriptarguments:
      command_get_branch:
        simple: GitHub-get-branch
      pack:
        complex:
          root: PackName
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1390
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 5d9e0cf5-2315-4dfd-8860-a3d56ca6ebd5
    type: regular
    task:
      id: 5d9e0cf5-2315-4dfd-8860-a3d56ca6ebd5
      version: -1
      name: Set branch name from SuggestBranchName output
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "2"
    scriptarguments:
      key:
        simple: BranchName
      value:
        complex:
          root: AvailableBranch
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1565
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: 9dc56dd8-7dd6-402a-8a4c-418bb0fcfcd9
    type: condition
    task:
      id: 9dc56dd8-7dd6-402a-8a4c-418bb0fcfcd9
      version: -1
      name: Is CI/CD Pull Request Branch field given
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "26"
      "yes":
      - "30"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: incident.cicdpullrequestbranch
            iscontext: true
          right:
            value: {}
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1040
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: 0dd3161a-e945-4141-8c9a-afc510d5b347
    type: regular
    task:
      id: 0dd3161a-e945-4141-8c9a-afc510d5b347
      version: -1
      name: Set branch name from CI/CD Pull Request Branch field
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "2"
    scriptarguments:
      key:
        simple: BranchName
      value:
        complex:
          root: incident
          accessor: cicdpullrequestbranch
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 910,
          "y": 1565
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: f3022e43-df56-4516-89cc-1e9d8baaf63e
    type: regular
    task:
      id: f3022e43-df56-4516-89cc-1e9d8baaf63e
      version: -1
      name: Get pull request
      description: Gets pull requests corresponding to the given branch name.
      script: '|||GitHub-list-branch-pull-requests'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "35"
    scriptarguments:
      branch_name:
        complex:
          root: BranchName
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 807.5,
          "y": 3750
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: 432a4274-10b4-47a6-835e-0a9600a4f3b6
    type: regular
    task:
      id: 432a4274-10b4-47a6-835e-0a9600a4f3b6
      version: -1
      name: Set MessageText value for update action
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      key:
        simple: MessageText
      value:
        simple: |-
          This pull request for the pack ${PackName} was updated by ${DemistoUsers.[0].username}:
          https://github.com/${GitHub.PR.Head.Repo.FullName}/pull/${GitHub.PR.Number}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 807.5,
          "y": 3925
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: 0e36469d-b4eb-4240-84c2-38cd635745b0
    type: regular
    task:
      id: 0e36469d-b4eb-4240-84c2-38cd635745b0
      version: -1
      name: Set MessageText for new pull request
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      key:
        simple: MessageText
      value:
        simple: |-
          New pull request was created by ${DemistoUsers.[0].username} for the pack ${PackName}:
          https://github.com/${GitHub.PR.Head.Repo.FullName}/pull/${GitHub.PR.Number}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 265,
          "y": 3925
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: 7d17a591-03f4-4732-850c-283ab2be3ba8
    type: title
    task:
      id: 7d17a591-03f4-4732-850c-283ab2be3ba8
      version: -1
      name: Set the branch name
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "29"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 895
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: a08b79ba-4dcd-47a9-895e-3d05972811d5
    type: title
    task:
      id: a08b79ba-4dcd-47a9-895e-3d05972811d5
      version: -1
      name: Check if branch exists and create it if not
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "18"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1915
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: 0f3925aa-7239-4202-8407-4db8c2d1804b
    type: title
    task:
      id: 0f3925aa-7239-4202-8407-4db8c2d1804b
      version: -1
      name: Commit the files
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "6"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2585
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: c11e3cce-e0bb-4b37-8c37-9d8420bc8abc
    type: title
    task:
      id: c11e3cce-e0bb-4b37-8c37-9d8420bc8abc
      version: -1
      name: Create new pull request
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "46"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 265,
          "y": 3080
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "41":
    id: "41"
    taskid: a9034a85-1612-4adf-83a5-0b5979f95150
    type: title
    task:
      id: a9034a85-1612-4adf-83a5-0b5979f95150
      version: -1
      name: Update existing pull request
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "31"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 807.5,
          "y": 3590
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "45":
    id: "45"
    taskid: f5e9fd71-c084-4e62-80ef-c8900e83c0fa
    type: regular
    task:
      id: f5e9fd71-c084-4e62-80ef-c8900e83c0fa
      version: -1
      name: Create pull request with pack name as title
      description: Creates a new pull request.
      script: '|||GitHub-create-pull-request'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      base:
        complex:
          root: inputs.MainBranch
      body:
        complex:
          root: PR_text
      draft:
        simple: "false"
      head:
        complex:
          root: BranchName
      title:
        complex:
          root: PackName
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 3400
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "46":
    id: "46"
    taskid: 7ad051a4-5d0e-4d57-83a0-7b62ea991f25
    type: condition
    task:
      id: 7ad051a4-5d0e-4d57-83a0-7b62ea991f25
      version: -1
      name: Is Pull Request title empty?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "7"
      "yes":
      - "45"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEmpty
          left:
            value:
              complex:
                root: incident
                accessor: cicdpullrequesttitle
            iscontext: true
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 265,
          "y": 3225
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 3295,
        "width": 1240,
        "x": 50,
        "y": 725
      }
    }
  }
inputs:
- key: PullRequestTemplate
  value: {}
  required: true
  description: Pull request description template.
  playbookInputQuery: null
- key: MainBranch
  value: {}
  required: true
  description: The name of the branch you want the changes pulled into, which must
    be an existing branch on the current repository.
  playbookInputQuery: null
outputs: []
