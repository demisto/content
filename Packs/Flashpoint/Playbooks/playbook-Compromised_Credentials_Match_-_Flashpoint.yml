id: Compromised Credentials Match - Flashpoint
version: -1
name: Compromised Credentials Match - Flashpoint
description: Compromised Credentials Match playbook uses the details of the compromised
  credentials ingested from the Flashpoint and authenticates using the Active Directory
  integration by providing the compromised credentials of the user, expires the credentials
  if it matches, and sends an email alert about the breach.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 32ed8963-0bc8-4748-8c53-4e92231ef842
    type: start
    task:
      id: 32ed8963-0bc8-4748-8c53-4e92231ef842
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "12"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 720,
          "y": -130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "4":
    id: "4"
    taskid: 4e50a679-76a4-4829-8437-8d68af1f9249
    type: regular
    task:
      id: 4e50a679-76a4-4829-8437-8d68af1f9249
      version: -1
      name: Authenticate user
      description: Performs a simple bind operation on the LDAP server.
      tags:
      - authenticate
      script: '|||ad-authenticate'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "13"
    scriptarguments:
      extend-context:
        simple: ad_output=.
      password:
        simple: ${inputs.password}
      username:
        complex:
          root: inputs.username
    reputationcalc: 1
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1170,
          "y": 380
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "5":
    id: "5"
    taskid: 7a4592ed-a7fc-42c2-8cb6-52acb2669fb3
    type: regular
    task:
      id: 7a4592ed-a7fc-42c2-8cb6-52acb2669fb3
      version: -1
      name: Expire current password
      description: Expires the password of an Active Directory user.
      script: '|||ad-expire-password'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      base-dn: {}
      username:
        complex:
          root: inputs.username
    reputationcalc: 1
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1330,
          "y": 980
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "6":
    id: "6"
    taskid: 7f3043b6-1bf2-4bb5-83a3-5cf3e1f9153f
    type: regular
    task:
      id: 7f3043b6-1bf2-4bb5-83a3-5cf3e1f9153f
      version: -1
      name: Send password reset mail
      description: Sends an email.
      script: '|||send-mail'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      additionalHeader: {}
      attachCIDs: {}
      attachIDs: {}
      attachNames: {}
      bcc: {}
      body:
        simple: |-
          Hi,

          Your password at ${incident.flashpointaffecteddomain} has been breached and should be changed.

          Thanks,
      cc: {}
      from: {}
      htmlBody: {}
      raw_message: {}
      replyTo: {}
      subject:
        simple: Compromised Credential
      templateParams: {}
      to:
        complex:
          root: incident
          accessor: flashpointsourceemail
      transientFile: {}
      transientFileCID: {}
      transientFileContent: {}
    reputationcalc: 1
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1070,
          "y": 1320
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "7":
    id: "7"
    taskid: d5df9e75-4fe3-47bb-8ab9-72fd0a2d647b
    type: title
    task:
      id: d5df9e75-4fe3-47bb-8ab9-72fd0a2d647b
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 630,
          "y": 1710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "8":
    id: "8"
    taskid: d6203039-526e-4fa1-8fd1-e7f7c3f9da61
    type: condition
    task:
      id: d6203039-526e-4fa1-8fd1-e7f7c3f9da61
      version: -1
      name: Is OpenLDAP integration enabled?
      description: Check whether the OpenLDAP Integration is enabled or not.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "9"
      "yes":
      - "4"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: OpenLDAP
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                accessor: brand
            iscontext: true
    view: |-
      {
        "position": {
          "x": 890,
          "y": 210
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "9":
    id: "9"
    taskid: cc60254d-57d4-44ef-8777-65fc9d57741f
    type: condition
    task:
      id: cc60254d-57d4-44ef-8777-65fc9d57741f
      version: -1
      name: Is send email as warning enabled?
      description: Check whether send email warning is enabled or not.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "14"
      "Yes":
      - "6"
    separatecontext: false
    defaultassigneecomplex:
      simple: Analyst
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: inputs.sendEmailAsWarning
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: inputs.sendEmailAsWarning
                      iscontext: true
                    right:
                      value:
                        simple: "True"
            iscontext: true
    view: |-
      {
        "position": {
          "x": 890,
          "y": 1150
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "10":
    id: "10"
    taskid: 0f1b3bc4-2020-4c48-8bfd-8ffd0be15e95
    type: condition
    task:
      id: 0f1b3bc4-2020-4c48-8bfd-8ffd0be15e95
      version: -1
      name: Is Active Directory Query V2 integration enabled?
      description: Check whether the Active Directory Query v2 Integration is enabled
        or not.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "9"
      "yes":
      - "5"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Active Directory Query v2
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                accessor: brand
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1170,
          "y": 800
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "12":
    id: "12"
    taskid: d071e4c2-b495-446c-8bef-42fcf60aecb0
    type: condition
    task:
      id: d071e4c2-b495-446c-8bef-42fcf60aecb0
      version: -1
      name: Is IncidentType Flashpoint Compromised Credentials?
      description: 'Check whether the IncidentType is Flashpoint Compromised Credentials
        or not. '
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "14"
      "yes":
      - "8"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: incident.type
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: incident.type
                      iscontext: true
                    right:
                      value:
                        simple: Flashpoint Compromised Credentials
            iscontext: true
    view: |-
      {
        "position": {
          "x": 720,
          "y": 20
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "13":
    id: "13"
    taskid: f2d367bf-a648-4c3d-89d6-dd579e71ca41
    type: condition
    task:
      id: f2d367bf-a648-4c3d-89d6-dd579e71ca41
      version: -1
      name: Is authentication successful?
      description: Check whether authentication is successful or not.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "9"
      "yes":
      - "10"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: ad_output
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: ad_output
                      iscontext: true
                    right:
                      value:
                        simple: Done
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1170,
          "y": 590
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "14":
    id: "14"
    taskid: a1997f4e-4861-46cb-81c0-54d54a102a2a
    type: regular
    task:
      id: a1997f4e-4861-46cb-81c0-54d54a102a2a
      version: -1
      name: Delete Context Key
      description: Delete ad_output field from context.
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      all: {}
      index: {}
      key:
        simple: ad_output
      keysToKeep: {}
      subplaybook: {}
    reputationcalc: 1
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 630,
          "y": 1500
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
view: |-
  {
    "linkLabelsPosition": {
      "10_5_yes": 0.76,
      "10_9_#default#": 0.31,
      "8_9_#default#": 0.26,
      "9_14_#default#": 0.16
    },
    "paper": {
      "dimensions": {
        "height": 1905,
        "width": 1080,
        "x": 630,
        "y": -130
      }
    }
  }
inputs:
- key: username
  value:
    complex:
      root: incident
      accessor: flashpointsourceemail
  required: true
  description: The username of the compromised credentials account.
  playbookInputQuery:
- key: password
  value:
    complex:
      root: incident
      accessor: flashpointpassword
  required: true
  description: The password of the compromised credentials account.
  playbookInputQuery:
- key: sendEmailAsWarning
  value:
    simple: "True"
  required: false
  description: Boolean input whether to send email or not.
  playbookInputQuery:
outputs: []
tests:
- Flashpoint_alert-Test
- Flashpoint_compromised-Test
- Flashpoint_event-Test
- Flashpoint_forum-Test
- Flashpoint_report-Test
- Flashpoint_reputation-Test
fromversion: 5.0.0
