commonfields:
  id: ShadowxSOCAI
  version: -1
name: ShadowxSOCAI
display: ShadowX SOCAI
category: Analytics & SIEM
description: ShadowX SOCAI filters sensitive data in security logs, analyzes them with GenAI (e.g. ChatGPT, Gemini, Claude), and returns enriched guidance such as AI response, recommendation, risk/result classification, and prediction score. Supports API Key (JSON /Api/ endpoints) and cookie (HTML) modes.
fromversion: 6.10.0

configuration:
# Base URL
- display: Server URL (e.g., https://app.shadowx.ai)
  name: url
  type: 0
  required: true

# API Key (Bearer) mode
- displaypassword: API Key (recommended). If set, email/password are ignored.
  name: credentials_api
  type: 9
  hiddenusername: true
  required: false

- display: API Submission Path (optional)
  name: api_submission_path
  type: 0
  required: false
  defaultvalue: /Api/SecurityTasks/Create

- display: API Check Path Format
  name: api_check_path_format
  type: 0
  required: false
  defaultvalue: /Api/SecurityTasks/Details?taskID={task_id}
  additionalinfo: "Must include {task_id} (e.g., /Api/SecurityTasks/Details?taskID={task_id})"

# Cookie (HTML) mode
- display: User Email (cookie mode)
  name: user_email
  type: 0
  required: false

- displaypassword: User Password (cookie mode)
  name: credentials_cookie
  type: 9
  hiddenusername: true
  required: false

# Optional defaults used in the submitted task payload
- display: AI Driver ID (GUID)
  name: ai_driver_id
  type: 0
  required: false

- display: Assigned User ID (GUID)
  name: assigned_user_id
  type: 0
  required: false

- display: Default Policy ID (GUID)
  name: policy_id
  type: 0
  required: false

- display: Default Task Name
  name: task_name
  type: 0
  required: false
  defaultvalue: XSOAR submit

# Network settings
- display: Use system proxy settings
  name: proxy
  type: 8
  required: false

- display: Trust any certificate (not secure)
  name: insecure
  type: 8
  required: false

script:
  type: python
  subtype: python3
  dockerimage: demisto/python3:3.11.10.116949
  script: '-'

  commands:
  - name: shadowx-submit-task
    description: Submit a log to ShadowX SOCAI for analysis. Supports API Key (Bearer) mode or cookie (HTML) mode. In API Key mode, you can optionally poll until completion and get the parsed result back immediately.
    arguments:
    - name: log
      required: true
      description: The log content to send for analysis.
    - name: ip_addr
      required: false
      description: Optional IP address associated with the log.
    - name: user_name
      required: false
      description: Optional username associated with the log (used as Subject in cookie mode).
    - name: policy_id
      required: false
      description: Policy ID to apply for analysis (overrides instance setting).
    - name: wait_seconds
      required: false
      description: Seconds to wait/poll for completion in API Key mode (0 = do not poll).
    - name: interval_seconds
      required: false
      description: Poll interval in seconds (API key mode). Default 30.
    outputs:
    - contextPath: ShadowxSOCAI.TaskSubmit
      description: Response after task submission.
      type: Unknown
    - contextPath: ShadowxSOCAI.TaskSubmit.TaskId
      description: The created task id (if available).
      type: String
    - contextPath: ShadowxSOCAI.TaskSubmit.TaskURL
      description: Direct link to the task in the ShadowX UI.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult
      description: Final task result if wait_seconds > 0 (API Key mode).
      type: Unknown
    - contextPath: ShadowxSOCAI.TaskResult.TaskId
      description: Task id.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.TaskURL
      description: Direct link to the task in the ShadowX UI.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.TaskName
      description: Task name.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.AssignedUserName
      description: Assigned user name.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.AIDriverName
      description: AI driver name.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.PolicyName
      description: Policy name.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.Subject
      description: Task subject.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.SecurityLog
      description: Original security log.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.SanitizedLog
      description: Sanitized log.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.Response
      description: AI response.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.Recommendation
      description: AI recommendation.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.Status
      description: Task status.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.RiskSeverity
      description: Risk / result classification.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.PredictionScore
      description: Prediction score.
      type: String

  - name: shadowx-get-task
    description: Get task details by Task ID (API Key mode). Parses the result and (if running inside an incident) updates incident custom fields.
    arguments:
    - name: task_id
      required: true
      description: Task GUID.
    outputs:
    - contextPath: ShadowxSOCAI.TaskResult
      description: Task details (parsed).
      type: Unknown
    - contextPath: ShadowxSOCAI.TaskResult.TaskId
      description: Task id.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.TaskURL
      description: Direct link to the task in the UI.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.TaskName
      description: Task name.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.AssignedUserName
      description: Assigned user name.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.AIDriverName
      description: AI driver name.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.PolicyName
      description: Policy name.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.Subject
      description: Task subject.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.SecurityLog
      description: Original security log.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.SanitizedLog
      description: Sanitized log.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.Response
      description: AI response.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.Recommendation
      description: AI recommendation.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.Status
      description: Task status.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.RiskSeverity
      description: Risk / result classification.
      type: String
    - contextPath: ShadowxSOCAI.TaskResult.PredictionScore
      description: Prediction score.
      type: String

  - name: shadowx-help
    description: Show usage instructions for ShadowX SOCAI.
    arguments: []
    outputs: []

tests:
- No tests (auto formatted)
