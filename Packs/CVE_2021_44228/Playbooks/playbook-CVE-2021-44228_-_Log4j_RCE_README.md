Critical RCE Vulnerability: log4j - CVE-2021-44228

On Dec. 9, 2021, a remote code execution (RCE) vulnerability in Apache log4j 2 was identified being exploited in the wild. Public proof of concept (PoC) code was released and subsequent investigation revealed that exploitation was incredibly easy to perform. 

**Affected Version**

Apache Log4j 2.x <= 2.15.0-rc1

This playbook should be triggered manually.
Please create a new incident and choose the **CVE-2021-44228 - Log4j RCE** playbook and **Rapid Breach Response** incident type.

**The playbook includes the following tasks:**

* Collect related known indicators from several sources.
* Indicators and exploitation patterns hunting using PAN-OS, Cortex XDR and SIEM products.
* Block indicators automatically or manually.

**Mitigations:**
* Apache official CVE-2021-44228 patch.
* Unit42 recommended mitigations.
* Detection Rules.
    * Snort
    * Suricata
    * Sigma
    * Yara

More information:
[Apache Log4j Vulnerability Is Actively Exploited in the Wild (CVE-2021-44228)](https://unit42.paloaltonetworks.com/apache-log4j-vulnerability-cve-2021-44228/)

Note: This is a beta playbook, which lets you implement and test pre-release software. Since the playbook is beta, it might contain bugs. Updates to the pack during the beta phase might include non-backward compatible features. We appreciate your feedback on the quality and usability of the pack to help us identify issues, fix them, and continually improve.

## Dependencies
This playbook uses the following sub-playbooks, integrations, and scripts.

### Sub-playbooks
* Block Indicators - Generic v2
* QRadarFullSearch
* PAN-OS - Block Domain - External Dynamic List
* Rapid Breach Response - Set Incident Info
* Panorama Query Logs
* QRadar Indicator Hunting V2
* Palo Alto Networks - Hunting And Threat Detection
* Splunk Indicator Hunting
* Cortex XDR - Execute commands

### Integrations
This playbook does not use any integrations.

### Scripts
* ParseHTMLIndicators
* IsIntegrationAvailable
* QRadarCreateAQLQuery
* http

### Commands
* closeInvestigation
* associateIndicatorsToIncident
* extractIndicators
* splunk-search
* createNewIndicator

## Playbook Inputs
---

| **Name** | **Description** | **Default Value** | **Required** |
| --- | --- | --- | --- |
| SplunkIndex | The Splunk index field to search in.<br/>Default is "\*" | * | Optional |
| SplunkSourcetype | The Splunk sourcetype field to search in.<br/>Default is "\*" | * | Optional |
| SplunkEarliestTime | The earliest time for Splunk query. | -1d@d | Optional |
| QRadarTimeRange | The time range for QRadar query. | Last 1 DAYS | Optional |
| XDRScriptExecution | Whether to investigate automatically the endpoint logs "/var/log" using XDR Endpoint Script Execution or manually. | False | Optional |
| XDREndpointIDs | The Endpoint IDs to search using XDR Endpoint Script Execution. |  | Optional |
| PlaybookDescription | The playbook description for Rapid Breach Response layout. | Critical RCE Vulnerability: log4j - CVE-2021-44228<br/><br/>On Dec. 9, 2021, a remote code execution (RCE) vulnerability in Apache log4j 2 was identified being exploited in the wild. Public proof of concept (PoC) code was released and subsequent investigation revealed that exploitation was incredibly easy to perform. <br/><br/>Affected Version<br/>Apache Log4j 2.x &lt;= 2.15.0-rc1<br/><br/>This playbook should be trigger manually and includes the following tasks: <br/><br/>* Collect related known indicators from several sources.<br/>* Indicators and exploitation patterns hunting using PAN-OS, Cortex XDR and SIEM products.<br/>* Block indicators automatically or manually.<br/><br/>Mitigations:<br/>* Apache official CVE-2021-44228 patch.<br/>* Unit42 recommended mitigations.<br/><br/>More information:<br/>[Apache Log4j Vulnerability Is Actively Exploited in the Wild (CVE-2021-44228)](https://unit42.paloaltonetworks.com/apache-log4j-vulnerability-cve-2021-44228/)<br/><br/>Note: This is a beta playbook, which lets you implement and test pre-release software. Since the playbook is beta, it might contain bugs. Updates to the pack during the beta phase might include non-backward compatible features. We appreciate your feedback on the quality and usability of the pack to help us identify issues, fix them, and continually improve. | Optional |
| EDLDomainBlocklist | The EDL domain blocklist name. |  | Optional |
| BlockIndicatorsAutomatically | Whether to block the indicators automatically or not. | True | Optional |

## Playbook Outputs
---
There are no outputs for this playbook.

## Playbook Image
---
![CVE-2021-44228 - Log4j RCE](https://raw.githubusercontent.com/demisto/content/a9190bcdcdf7b2fa4836ce42b21d40915ac5a9cf/Packs/CVE_2021_44228/doc_files/CVE-2021-44228_-_Log4j_RCE.png)