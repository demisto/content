id: CVE-2021-44228 - Log4j RCE
version: -1
name: CVE-2021-44228 - Log4j RCE
description: "Critical RCE Vulnerability: log4j - CVE-2021-44228\n\nOn Dec. 9, 2021,\
  \ a remote code execution (RCE) vulnerability in Apache log4j 2 was identified being\
  \ exploited in the wild. Public proof of concept (PoC) code was released and subsequent\
  \ investigation revealed that exploitation was incredibly easy to perform. \n\n\
  Affected Version\nApache Log4j 2.x <= 2.15.0-rc1\n\nThis playbook should be trigger\
  \ manually and includes the following tasks: \n\n* Collect related known indicators\
  \ from several sources.\n* Indicators and exploitation patterns hunting using PAN-OS,\
  \ Cortex XDR and SIEM products.\n* Block indicators automatically or manually.\n\
  \nMitigations:\n* Apache official CVE-2021-44228 patch.\n* Unit42 recommended mitigations.\n\
  \nMore information:\n[Apache Log4j Vulnerability Is Actively Exploited in the Wild\
  \ (CVE-2021-44228)](https://unit42.paloaltonetworks.com/apache-log4j-vulnerability-cve-2021-44228/)\n\
  \nNote: This is a beta playbook, which lets you implement and test pre-release software.\
  \ Since the playbook is beta, it might contain bugs. Updates to the pack during\
  \ the beta phase might include non-backward compatible features. We appreciate your\
  \ feedback on the quality and usability of the pack to help us identify issues,\
  \ fix them, and continually improve."
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 115864a0-53ec-4523-8c8e-84806a7158e1
    type: start
    task:
      id: 115864a0-53ec-4523-8c8e-84806a7158e1
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "1"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1240,
          "y": -1110
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: 8a10857a-f267-4994-8e45-9db51eb73a45
    type: title
    task:
      id: 8a10857a-f267-4994-8e45-9db51eb73a45
      version: -1
      name: Collect Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "2"
      - "6"
      - "7"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1240,
          "y": -950
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: b8a458e9-9b7e-4241-86e3-d8749a32a34e
    type: regular
    task:
      id: b8a458e9-9b7e-4241-86e3-d8749a32a34e
      version: -1
      name: Collect indicators from GreyNoise
      description: This script will extract indicators from HTML and will handle bad
        TLD to avoid file extensions false positives.
      scriptName: ParseHTMLIndicators
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "8"
    scriptarguments:
      unescape_domain:
        simple: "False"
      url:
        simple: https://gist.githubusercontent.com/gnremy/c546c7911d5f876f263309d7161a7217/raw/170f7d6cf92172443ecc68db0b6cbd4d8226a398/CVE-2021-44228_IPs.csv
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1240,
          "y": -800
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: bfefad5e-9eb7-4d39-8866-8b59349d39cb
    type: regular
    task:
      id: bfefad5e-9eb7-4d39-8866-8b59349d39cb
      version: -1
      name: Download Suricata Rules
      description: Download Sigma Rules
      scriptName: http
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "8"
    scriptarguments:
      filename:
        simple: emerging-exploit-snort.rules
      method:
        simple: GET
      saveAsFile:
        simple: "yes"
      url:
        simple: https://rules.emergingthreatspro.com/open/suricata-5.0/rules/emerging-exploit.rules
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1700,
          "y": -800
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: 60e41560-a9e9-4701-806f-8034370cfa5d
    type: regular
    task:
      id: 60e41560-a9e9-4701-806f-8034370cfa5d
      version: -1
      name: Download Snort Rules
      description: Download Sigma Rules
      scriptName: http
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "8"
    scriptarguments:
      filename:
        simple: emerging-exploit-snort.rules
      method:
        simple: GET
      saveAsFile:
        simple: "yes"
      url:
        simple: https://rules.emergingthreatspro.com/open/snort-2.9.0/rules/emerging-exploit.rules
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 780,
          "y": -800
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: 2990fb6e-ad3b-4ab8-8eb3-4ae250ab96d8
    type: title
    task:
      id: 2990fb6e-ad3b-4ab8-8eb3-4ae250ab96d8
      version: -1
      name: Extract Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "9"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1240,
          "y": -620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: 0bf2da79-3438-4930-8d23-4f12536a2c2e
    type: regular
    task:
      id: 0bf2da79-3438-4930-8d23-4f12536a2c2e
      version: -1
      name: Extract Indicators From Data Collected
      description: commands.local.cmd.extract.indicators
      script: Builtin|||extractIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      text:
        complex:
          root: http.parsedBlog
          accessor: indicators
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1240,
          "y": -460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: ce4704fd-06f0-41f0-803f-9ac321115cd3
    type: title
    task:
      id: ce4704fd-06f0-41f0-803f-9ac321115cd3
      version: -1
      name: Tag and Link Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "57"
      - "58"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1240,
          "y": -260
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "15":
    id: "15"
    taskid: 51a5d5e0-a1e3-4793-8ec0-54d64d866264
    type: regular
    task:
      id: 51a5d5e0-a1e3-4793-8ec0-54d64d866264
      version: -1
      name: Link Indicators To Incident
      description: commands.local.cmd.associate.indicators
      script: Builtin|||associateIndicatorsToIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "36"
    scriptarguments:
      incidentId:
        complex:
          root: incident
          accessor: id
      indicatorsValues:
        complex:
          root: ExtractedIndicators.IP
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: ExtractedIndicators.IP
                iscontext: true
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.Domain
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.URL
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.CVE
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.File
                iscontext: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1240,
          "y": 100
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 804a5a08-829f-46d2-8f29-210025186ba9
    type: title
    task:
      id: 804a5a08-829f-46d2-8f29-210025186ba9
      version: -1
      name: SIEM Hunting
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "19"
      - "20"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 770,
          "y": 740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: ce0aea93-2a13-4cde-844d-cbc6bae372dd
    type: title
    task:
      id: ce0aea93-2a13-4cde-844d-cbc6bae372dd
      version: -1
      name: Palo Alto Networks Hunting
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "27"
      - "28"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1710,
          "y": 740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: 9a399bf5-ef89-4244-8591-dc17d17d764c
    type: playbook
    task:
      id: 9a399bf5-ef89-4244-8591-dc17d17d764c
      version: -1
      name: Splunk Indicator Hunting
      description: This playbook queries Splunk for indicators such as file hashes,
        IP addresses, domains, or urls. It outputs detected users, ip addresses, and
        hostnames related to the indicators.
      playbookName: Splunk Indicator Hunting
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "37"
    scriptarguments:
      IPAddress:
        complex:
          root: ExtractedIndicators
          accessor: IP
          transformers:
          - operator: uniq
      IndexName:
        simple: index=*
      SelectFields:
        simple: source,timestamp
      URLDomain:
        complex:
          root: ExtractedIndicators
          accessor: Domain
          transformers:
          - operator: uniq
      earliest_time:
        complex:
          root: inputs.SplunkEarliestTime
      event_limit:
        simple: "100"
      latest_time:
        complex:
          root: inputs.SplunkLatestTime
    separatecontext: true
    loop:
      iscommand: false
      scriptArguments:
        IPAddress:
          complex:
            root: ExtractedIndicators
            accessor: IP
            transformers:
            - operator: uniq
        IndexName:
          simple: index=*
        MD5:
          complex:
            root: ExtractedIndicators
            filters:
            - - operator: stringHasLength
                left:
                  value:
                    simple: ExtractedIndicators
                  iscontext: true
                right:
                  value:
                    simple: "32"
            accessor: File
            transformers:
            - operator: uniq
        SHA1:
          complex:
            root: ExtractedIndicators
            filters:
            - - operator: stringHasLength
                left:
                  value:
                    simple: ExtractedIndicators
                  iscontext: true
                right:
                  value:
                    simple: "40"
            accessor: File
            transformers:
            - operator: uniq
        SHA256:
          complex:
            root: ExtractedIndicators
            filters:
            - - operator: stringHasLength
                left:
                  value:
                    simple: ExtractedIndicators
                  iscontext: true
                right:
                  value:
                    simple: "64"
            accessor: File
            transformers:
            - operator: uniq
        SelectFields:
          simple: source,timestamp
        URLDomain:
          complex:
            root: ExtractedIndicators
            accessor: Domain
            transformers:
            - operator: uniq
        earliest_time:
          complex:
            root: inputs.SplunkEarliestTime
        event_limit:
          simple: "100"
        latest_time:
          complex:
            root: inputs.SplunkLatestTime
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 980,
          "y": 900
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: 219a4e72-6655-4f9d-815b-a26a7999a9fa
    type: playbook
    task:
      id: 219a4e72-6655-4f9d-815b-a26a7999a9fa
      version: -1
      name: QRadar Indicator Hunting V2
      description: 'The Playbook queries QRadar SIEM for indicators such as file hashes,
        IP addresses, domains, or urls. '
      playbookName: QRadar Indicator Hunting V2
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "37"
    scriptarguments:
      IPAddress:
        complex:
          root: ExtractedIndicators
          accessor: IP
          transformers:
          - operator: uniq
      InvestigationIPFields:
        simple: sourceip,destinationip
      InvestigationUserFields:
        simple: username
      QradarIPfield:
        simple: sourceip,destinationip
      TimeFrame:
        complex:
          root: inputs.QRadarTimeRange
      URLDomain:
        complex:
          root: ExtractedIndicators
          accessor: Domain
          transformers:
          - operator: uniq
    separatecontext: true
    loop:
      iscommand: false
      scriptArguments:
        IPAddress:
          complex:
            root: ExtractedIndicators
            accessor: IP
            transformers:
            - operator: uniq
        InvestigationIPFields:
          simple: sourceip,destinationip
        InvestigationUserFields:
          simple: username
        MD5:
          complex:
            root: ExtractedIndicators.File
            filters:
            - - operator: stringHasLength
                left:
                  value:
                    simple: ExtractedIndicators.File
                  iscontext: true
                right:
                  value:
                    simple: "32"
            transformers:
            - operator: uniq
        QradarIPfield:
          simple: sourceip,destinationip
        SHA1:
          complex:
            root: ExtractedIndicators.File
            filters:
            - - operator: stringHasLength
                left:
                  value:
                    simple: ExtractedIndicators.File
                  iscontext: true
                right:
                  value:
                    simple: "40"
            transformers:
            - operator: uniq
        SHA256:
          complex:
            root: ExtractedIndicators.File
            filters:
            - - operator: stringHasLength
                left:
                  value:
                    simple: ExtractedIndicators.File
                  iscontext: true
                right:
                  value:
                    simple: "64"
            transformers:
            - operator: uniq
        TimeFrame:
          complex:
            root: inputs.QRadarTimeRange
        URLDomain:
          complex:
            root: ExtractedIndicators
            accessor: Domain
            transformers:
            - operator: uniq
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 560,
          "y": 900
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: 375e2dbd-d28a-48c9-8db5-ce70766e10e7
    type: title
    task:
      id: 375e2dbd-d28a-48c9-8db5-ce70766e10e7
      version: -1
      name: SIEM Advanced Hunting
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "22"
      - "24"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -270,
          "y": 740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: 9a9811f7-6a93-4998-8330-cc0df3326b5e
    type: condition
    task:
      id: 9a9811f7-6a93-4998-8330-cc0df3326b5e
      version: -1
      name: Is Splunk Enabled?
      description: Check if Splunk instance is enabled.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "37"
      "Yes":
      - "26"
    separatecontext: false
    conditions:
    - label: "Yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: SplunkPy
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
    view: |-
      {
        "position": {
          "x": 0,
          "y": 900
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: 8103d615-deff-471b-8673-5c76b87f6eaf
    type: title
    task:
      id: 8103d615-deff-471b-8673-5c76b87f6eaf
      version: -1
      name: Threat Hunting
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "17"
      - "21"
      - "16"
      - "29"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1240,
          "y": 590
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: d1589f39-7ac3-43d6-8580-95ff0dbc1021
    type: condition
    task:
      id: d1589f39-7ac3-43d6-8580-95ff0dbc1021
      version: -1
      name: Is QRadar Enabled?
      description: Check if QRadar instance is enabled.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "37"
      "Yes":
      - "25"
    separatecontext: false
    conditions:
    - label: "Yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: QRadar_v2
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
    view: |-
      {
        "position": {
          "x": -540,
          "y": 900
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: 01ab49b7-74ce-4b1d-8134-5907c434b7fa
    type: regular
    task:
      id: 01ab49b7-74ce-4b1d-8134-5907c434b7fa
      version: -1
      name: Build QRadar AQL Query
      description: Build QRadar AQL Query.
      scriptName: QRadarCreateAQLQuery
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "60"
    scriptarguments:
      base_field_match:
        simple: partial
      base_field_state:
        simple: include
      base_fields_to_search:
        simple: user_agent
      base_values_to_search:
        simple: '"${jndi:ldap:","${jndi:rmi:","${jndi:ldaps:","${jndi:dns:"'
      select_fields:
        simple: DATEFORMAT(devicetime,'dd-MM-yyyy hh:mm'),LOGSOURCENAME(logsourceid),CATEGORYNAME(category),QIDNAME(qid),sourceip,destinationip,username')
      time_frame:
        complex:
          root: inputs.QRadarTimeRange
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -540,
          "y": 1110
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: ddf7577d-ac3c-41fa-8a9e-95d9124c5691
    type: regular
    task:
      id: ddf7577d-ac3c-41fa-8a9e-95d9124c5691
      version: -1
      name: Search for exploitation patterns
      description: Searches Splunk for suspicious file creation where the file path
        is under INETCACHE.
      script: '|||splunk-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "37"
    scriptarguments:
      earliest_time:
        complex:
          root: inputs.SplunkEarliestTime
      query:
        simple: index=${SplunkIndex} sourcetype=${SplunkSourcetype} "${jndi:ldap:"
          OR "${jndi:rmi:" OR "${jndi:ldaps:" OR "${jndi:dns:"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 0,
          "y": 1110
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: 67a09f95-40de-4c6f-8218-c0cbcdd6a605
    type: playbook
    task:
      id: 67a09f95-40de-4c6f-8218-c0cbcdd6a605
      version: -1
      name: Palo Alto Networks - Hunting And Threat Detection
      description: "This is a multipurpose playbook used for hunting and threat detection.\
        \ The playbook receives inputs based on hashes, IP addresses, or domain names\
        \ provided manually or from outputs by other playbooks. \nWith the received\
        \ indicators, the playbook leverages data received by PANW products including,\
        \ Cortex Data Lake, Autofocus and Pan-OS to search for IP addresses, host\
        \ names and users related to the provided indicators.\nThe output provided\
        \ by the playbook facilitates pivoting searches for possibly affected IP addresses\
        \ or users."
      playbookName: Palo Alto Networks - Hunting And Threat Detection
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "37"
    scriptarguments:
      IPAddresses:
        complex:
          root: ExtractedIndicators
          accessor: IP
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1500,
          "y": 900
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 432d3033-0c03-4950-8c8b-2a07a75258ed
    type: playbook
    task:
      id: 432d3033-0c03-4950-8c8b-2a07a75258ed
      version: -1
      name: Panorama Query Logs
      description: 'Query Panorama Logs of types: traffic, threat, url, data-filtering
        and wildfire.'
      playbookName: Panorama Query Logs
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "37"
    scriptarguments:
      log_type:
        simple: threat
      query:
        simple: threatid eq 91991
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1920,
          "y": 900
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: 41ec0e59-aad9-4262-8910-739729a5c2f8
    type: title
    task:
      id: 41ec0e59-aad9-4262-8910-739729a5c2f8
      version: -1
      name: Cortex XDR
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "32"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2700,
          "y": 740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: bebd4881-84d2-4d92-89df-524a945d51a3
    type: regular
    task:
      id: bebd4881-84d2-4d92-89df-524a945d51a3
      version: -1
      name: Search for exploitation patterns under /var/log - Uncompressed
      description: Initiate a new endpoint script execution of shell commands.
      script: '|||xdr-run-script-execute-commands'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "34"
    scriptarguments:
      commands:
        simple: sudo egrep -i -r '\$\{jndi:(ldap[s]?|rmi|dns):/[^\n]+' /var/log
      endpoint_ids:
        simple: ${XDREndpointIDs}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2980,
          "y": 1300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: 7428a7ea-7953-4cf6-8c5d-e95678a2f011
    type: regular
    task:
      id: 7428a7ea-7953-4cf6-8c5d-e95678a2f011
      version: -1
      name: Search for exploitation patterns under /var/log - Compressed
      description: Initiate a new endpoint script execution of shell commands.
      script: '|||xdr-run-script-execute-commands'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "34"
    scriptarguments:
      commands:
        simple: sudo find /var/log -name \*.gz -print0 | xargs -0 zgrep -E -i '\$\{jndi:(ldap[s]?|rmi|dns):/[^\n]+'
      endpoint_ids:
        simple: ${XDREndpointIDs}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 3400,
          "y": 1300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: 678b1200-2d89-4e15-833a-44fcf08f6e2b
    type: condition
    task:
      id: 678b1200-2d89-4e15-833a-44fcf08f6e2b
      version: -1
      name: Should search using XDR Endpoint Script Execution?
      description: Checks whether to execute XDR shell script for exploitation hunting.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "37"
      "yes":
      - "33"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.XDRScriptExecution
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 2700,
          "y": 900
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: b2afe506-4973-43e3-8457-ce68af7e4b3f
    type: condition
    task:
      id: b2afe506-4973-43e3-8457-ce68af7e4b3f
      version: -1
      name: Were the XDR Endpoint IDs provided?
      description: Checks whether the necessary input 'XDREndpointIDs' was provided.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "37"
      "yes":
      - "30"
      - "31"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: inputs.XDREndpointIDs
            iscontext: true
    view: |-
      {
        "position": {
          "x": 2830,
          "y": 1110
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: 9e27fcbd-64f7-4732-89ba-4f5fe8ff3591
    type: regular
    task:
      id: 9e27fcbd-64f7-4732-89ba-4f5fe8ff3591
      version: -1
      name: Cortex XDR Get Execution Results
      description: Retrieve the results of a script execution action.
      script: Cortex XDR - IR|||xdr-get-script-execution-results
      type: regular
      iscommand: true
      brand: Cortex XDR - IR
    nexttasks:
      '#none#':
      - "37"
    scriptarguments:
      action_id:
        complex:
          root: PaloAltoNetworksXDR.ScriptRun
          accessor: action_id
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 3190,
          "y": 1470
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: d53c06d4-d17d-4f10-8f39-3a89979cdfd7
    type: playbook
    task:
      id: d53c06d4-d17d-4f10-8f39-3a89979cdfd7
      version: -1
      name: Rapid Breach Response - Set Incident Info
      description: This playbook is responsible for setting up the Rapid Breach Response
        Incident Info tab.
      playbookName: Rapid Breach Response - Set Incident Info
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "23"
    scriptarguments:
      SourceOfIndicators:
        complex:
          root: http.parsedBlog
          accessor: sourceLink
      countTotalIndicators:
        complex:
          root: ExtractedIndicators
          accessor: Domain
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.IP
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.URL
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.File
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.CVE
                iscontext: true
          - operator: uniq
          - operator: count
      playbookDescription:
        complex:
          root: inputs.PlaybookDescription
    separatecontext: true
    loop:
      iscommand: false
      scriptArguments:
        SourceOfIndicators:
          complex:
            root: http.parsedBlog
            accessor: sourceLink
        countTotalIndicators:
          complex:
            root: ExtractedIndicators
            accessor: Domain
            transformers:
            - operator: append
              args:
                item:
                  value:
                    simple: ExtractedIndicators.IP
                  iscontext: true
            - operator: append
              args:
                item:
                  value:
                    simple: ExtractedIndicators.URL
                  iscontext: true
            - operator: append
              args:
                item:
                  value:
                    simple: ExtractedIndicators.File
                  iscontext: true
            - operator: append
              args:
                item:
                  value:
                    simple: ExtractedIndicators.CVE
                  iscontext: true
            - operator: uniq
            - operator: count
        playbookDescription:
          complex:
            root: inputs.Description
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1240,
          "y": 430
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: fe3cdf0e-288e-40f3-8a7e-a69e591a45c7
    type: title
    task:
      id: fe3cdf0e-288e-40f3-8a7e-a69e591a45c7
      version: -1
      name: Handle Rapid Breach Response Layout
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "35"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1240,
          "y": 290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: bdfafcce-8a69-4de8-8bfc-6df56d9d0110
    type: title
    task:
      id: bdfafcce-8a69-4de8-8bfc-6df56d9d0110
      version: -1
      name: Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "39"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1240,
          "y": 1650
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: 4a7b0b83-5ceb-4e3a-80ff-d7403f823daf
    type: playbook
    task:
      id: 4a7b0b83-5ceb-4e3a-80ff-d7403f823daf
      version: -1
      name: Block Indicators - Generic v2
      description: |+
        This playbook blocks malicious Indicators using all integrations that are enabled, using the following sub-playbooks:

        - Block URL - Generic
        - Block Account - Generic
        - Block IP - Generic v2
        - Block File - Generic v2
        - Block Email - Generic
        - Block Domain - Generic

      playbookName: Block Indicators - Generic v2
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "42"
    scriptarguments:
      AutoCommit:
        simple: "No"
      CustomBlockRule:
        simple: "True"
      CustomURLCategory:
        simple: Demisto Remediation - Malicious URLs
      IP:
        complex:
          root: ExtractedIndicators
          accessor: IP
          transformers:
          - operator: uniq
      MD5:
        complex:
          root: ExtractedIndicators.File
          filters:
          - - operator: stringHasLength
              left:
                value:
                  simple: ExtractedIndicators.File
                iscontext: true
              right:
                value:
                  simple: "32"
          transformers:
          - operator: uniq
      SHA256:
        complex:
          root: ExtractedIndicators.File
          filters:
          - - operator: stringHasLength
              left:
                value:
                  simple: ExtractedIndicators.File
                iscontext: true
              right:
                value:
                  simple: "64"
          transformers:
          - operator: uniq
      URL:
        complex:
          root: ExtractedIndicators
          accessor: URL
          transformers:
          - operator: uniq
      URLListName:
        simple: Demisto Remediation - URL EDL
      Username:
        complex:
          root: DBotScore
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: username
              ignorecase: true
          - - operator: greaterThanOrEqual
              left:
                value:
                  simple: DBotScore.Score
                iscontext: true
              right:
                value:
                  simple: "3"
          accessor: Indicator
    separatecontext: true
    loop:
      iscommand: false
      scriptArguments:
        AutoCommit:
          simple: "No"
        CustomBlockRule:
          simple: "True"
        CustomURLCategory:
          simple: Demisto Remediation - Malicious URLs
        IP:
          complex:
            root: ExtractedIndicators
            accessor: IP
            transformers:
            - operator: uniq
        MD5:
          complex:
            root: ExtractedIndicators.File
            filters:
            - - operator: stringHasLength
                left:
                  value:
                    simple: ExtractedIndicators.File
                  iscontext: true
                right:
                  value:
                    simple: "32"
            transformers:
            - operator: uniq
        SHA256:
          complex:
            root: ExtractedIndicators.File
            filters:
            - - operator: stringHasLength
                left:
                  value:
                    simple: ExtractedIndicators.File
                  iscontext: true
                right:
                  value:
                    simple: "64"
            transformers:
            - operator: uniq
        URL:
          complex:
            root: ExtractedIndicators
            accessor: URL
            transformers:
            - operator: uniq
        URLListName:
          simple: Demisto Remediation - URL EDL
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 1240,
          "y": 2050
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: 48e7ecc8-afcf-4d14-8103-ed6d3ee644c3
    type: condition
    task:
      id: 48e7ecc8-afcf-4d14-8103-ed6d3ee644c3
      version: -1
      name: Block indicators automatically?
      description: Checks whether IOCs associated with the incident can be blocked
        automatically.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "40"
      "yes":
      - "41"
      - "38"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.BlockIndicatorsAutomatically
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 1240,
          "y": 1830
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: c0e5d544-60fe-4f2e-8f97-3c7d2c2b01eb
    type: regular
    task:
      id: c0e5d544-60fe-4f2e-8f97-3c7d2c2b01eb
      version: -1
      name: Block indicators manually
      description: Manually block the IOCs in the relevant systems.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "42"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1690,
          "y": 2050
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "41":
    id: "41"
    taskid: 5e08d7d7-d2c2-42f5-89c1-4f614163ed70
    type: playbook
    task:
      id: 5e08d7d7-d2c2-42f5-89c1-4f614163ed70
      version: -1
      name: PAN-OS - Block Domain - External Dynamic List
      description: |-
        This playbook blocks Domains using Palo Alto Networks Panorama or Firewall External Dynamic Lists.
        It checks if the EDL configuration is in place with the 'PAN-OS EDL Setup' sub-playbook
        (otherwise the list will be configured), and adds the input Domains to the relevant lists.
      playbookName: PAN-OS - Block Domain - External Dynamic List
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "42"
    scriptarguments:
      AutoCommit:
        simple: "No"
      Domain:
        complex:
          root: ExtractedIndicators
          accessor: Domain
      DomainListName:
        complex:
          root: inputs.EDLDomainBlocklist
      pre-post-rulebase:
        simple: pre-rulebase
    separatecontext: true
    loop:
      iscommand: false
      scriptArguments:
        AutoCommit:
          simple: "No"
        Domain:
          complex:
            root: ExtractedIndicators
            accessor: Domain
        DomainListName:
          complex:
            root: inputs.EDLDomainBlocklist
        pre-post-rulebase:
          simple: pre-rulebase
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 790,
          "y": 2050
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "42":
    id: "42"
    taskid: 32b1536e-f572-451f-85a0-9879bc75ada6
    type: title
    task:
      id: 32b1536e-f572-451f-85a0-9879bc75ada6
      version: -1
      name: Mitigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "50"
      - "52"
      - "53"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1240,
          "y": 2260
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "43":
    id: "43"
    taskid: 950c882c-c513-4775-8a68-f7bc98efc1e9
    type: regular
    task:
      id: 950c882c-c513-4775-8a68-f7bc98efc1e9
      version: -1
      name: Install log4j 2.15.0-rc2 Version
      description: |-
        [log4j 2.15.0-rc2 zip format](https://github.com/apache/logging-log4j2/archive/refs/tags/log4j-2.15.0-rc2.zip)

        [log4j 2.15.0-rc2 tar.gz format](https://github.com/apache/logging-log4j2/archive/refs/tags/log4j-2.15.0-rc2.tar.gz)
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "49"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1240,
          "y": 2560
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "44":
    id: "44"
    taskid: de29d542-9946-45de-82d0-c2548a1a4462
    type: regular
    task:
      id: de29d542-9946-45de-82d0-c2548a1a4462
      version: -1
      name: Disable JNDI lookup
      description: |+
        Disable JNDI lookup
        * Remove the JndiLookup file in the log4j-core and restart the service
        * Setup spring.jndi.ignore=true


      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "49"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1690,
          "y": 2560
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "45":
    id: "45"
    taskid: c051ec61-e3cd-4906-800f-7be75c8d1e16
    type: condition
    task:
      id: c051ec61-e3cd-4906-800f-7be75c8d1e16
      version: -1
      name: Analysis resolution - Should continue with the investigation?
      description: Check with the analyst whether to continue with the investigation.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "No":
      - "48"
      "Yes":
      - "47"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1240,
          "y": 2910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
        simple: Do you need to continue with the investigation?
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
      replyOptions:
      - "Yes"
      - "No"
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "46":
    id: "46"
    taskid: 1e16fdd6-5b62-44be-86e0-e5e50e7fa045
    type: title
    task:
      id: 1e16fdd6-5b62-44be-86e0-e5e50e7fa045
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1240,
          "y": 3370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "47":
    id: "47"
    taskid: 79f42889-be16-4b8d-8f3c-085a10908aa8
    type: regular
    task:
      id: 79f42889-be16-4b8d-8f3c-085a10908aa8
      version: -1
      name: Investigate Further
      description: Manual step for further incident investigation.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "46"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 790,
          "y": 3160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "48":
    id: "48"
    taskid: 557f24c6-338b-4d52-844d-3ba121f0748b
    type: regular
    task:
      id: 557f24c6-338b-4d52-844d-3ba121f0748b
      version: -1
      name: Close Investigation
      description: Close the current incident
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "46"
    scriptarguments:
      closeReason:
        simple: No further actions are required.
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1240,
          "y": 3160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "49":
    id: "49"
    taskid: 0f822bab-d9cd-47a6-8813-ad10cb60596a
    type: title
    task:
      id: 0f822bab-d9cd-47a6-8813-ad10cb60596a
      version: -1
      name: Resolution
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "45"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1240,
          "y": 2750
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "50":
    id: "50"
    taskid: e287cfae-32f1-4371-86cf-8f19c23e6919
    type: title
    task:
      id: e287cfae-32f1-4371-86cf-8f19c23e6919
      version: -1
      name: Unit42 Recommended Mitigations
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "51"
      - "44"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1920,
          "y": 2410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "51":
    id: "51"
    taskid: b8ea0529-f904-4252-8f09-9b429260e204
    type: regular
    task:
      id: b8ea0529-f904-4252-8f09-9b429260e204
      version: -1
      name: PANW - Disable suspicious outbound traffic
      description: |
        Disable suspicious outbound traffic, such as LDAP and RMI on the server in PANW Firewall
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "49"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2150,
          "y": 2560
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "52":
    id: "52"
    taskid: cfada905-5e8e-4dbf-8291-0c795e273c91
    type: title
    task:
      id: cfada905-5e8e-4dbf-8291-0c795e273c91
      version: -1
      name: Patch Vulnerability
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "43"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1240,
          "y": 2410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "53":
    id: "53"
    taskid: 6de90297-d0b7-41ba-8baf-16b5edcc9a78
    type: title
    task:
      id: 6de90297-d0b7-41ba-8baf-16b5edcc9a78
      version: -1
      name: Deploy IDS Rules
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "54"
      - "55"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 570,
          "y": 2410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "54":
    id: "54"
    taskid: c15c4a80-582c-4821-852a-664435fc45ec
    type: regular
    task:
      id: c15c4a80-582c-4821-852a-664435fc45ec
      version: -1
      name: Snort Rules
      description: Snort rules file has been downloaded as emerging-exploit-snort.rules
        and is available for download directly from XSOAR.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "49"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 350,
          "y": 2560
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "55":
    id: "55"
    taskid: db11fc9e-4512-419f-80b1-12614a130a1c
    type: regular
    task:
      id: db11fc9e-4512-419f-80b1-12614a130a1c
      version: -1
      name: Suricata Rules
      description: Suricata rules file has been downloaded as emerging-exploit-suricata.rules
        and is available for download directly from XSOAR.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "49"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 790,
          "y": 2560
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "57":
    id: "57"
    taskid: f31ae1e7-478b-4830-89bf-d6a36d0c54af
    type: regular
    task:
      id: f31ae1e7-478b-4830-89bf-d6a36d0c54af
      version: -1
      name: Tag IP indicators
      description: commands.local.cmd.new.indicator
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "15"
    scriptarguments:
      retry-count:
        simple: "3"
      retry-interval:
        simple: "2"
      tags:
        simple: CVE-2021-44228
      type:
        simple: IP
      value:
        complex:
          root: ExtractedIndicators.IP
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: ExtractedIndicators.IP
                iscontext: true
          transformers:
          - operator: uniq
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1020,
          "y": -90
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "58":
    id: "58"
    taskid: 73aa56d1-c1e1-4b1b-8b8f-bf5b70ea3037
    type: regular
    task:
      id: 73aa56d1-c1e1-4b1b-8b8f-bf5b70ea3037
      version: -1
      name: Tag CVE indicators
      description: commands.local.cmd.new.indicator
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "15"
    scriptarguments:
      retry-count:
        simple: "3"
      retry-interval:
        simple: "2"
      tags:
        simple: CVE-2021-44228
      type:
        simple: CVE
      value:
        simple: CVE-2021-44228
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1460,
          "y": -90
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "60":
    id: "60"
    taskid: 63813eaf-9b18-4965-8da5-0f928389863f
    type: playbook
    task:
      id: 63813eaf-9b18-4965-8da5-0f928389863f
      version: -1
      name: Search for exploitation patterns
      description: This playbook runs a QRadar query and return its results to the
        context.
      playbookName: QRadarFullSearch
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "37"
    scriptarguments:
      interval:
        simple: "1"
      query_expression:
        complex:
          root: QRadarQuery
      timeout:
        simple: "600"
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": -540,
          "y": 1300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "22_26_Yes": 0.53,
      "22_37_#default#": 0.22,
      "24_25_Yes": 0.53,
      "24_37_#default#": 0.16,
      "32_33_yes": 0.45,
      "32_37_#default#": 0.25,
      "33_37_#default#": 0.27
    },
    "paper": {
      "dimensions": {
        "height": 4545,
        "width": 4320,
        "x": -540,
        "y": -1110
      }
    }
  }
inputs:
- key: SplunkIndex
  value:
    simple: '*'
  required: false
  description: |-
    The Splunk index field to search in.
    Default is "*"
  playbookInputQuery:
- key: SplunkSourcetype
  value:
    simple: '*'
  required: false
  description: |-
    The Splunk sourcetype field to search in.
    Default is "*"
  playbookInputQuery:
- key: SplunkEarliestTime
  value:
    simple: -1d@d
  required: false
  description: The earliest time for Splunk query.
  playbookInputQuery:
- key: QRadarTimeRange
  value:
    simple: Last 1 DAYS
  required: false
  description: The time range for QRadar query.
  playbookInputQuery:
- key: XDRScriptExecution
  value:
    simple: "False"
  required: false
  description: Whether to investigate automatically the endpoint logs "/var/log" using
    XDR Endpoint Script Execution or manually.
  playbookInputQuery:
- key: XDREndpointIDs
  value: {}
  required: false
  description: The Endpoint IDs to search using XDR Endpoint Script Execution.
  playbookInputQuery:
- key: PlaybookDescription
  value:
    simple: "Critical RCE Vulnerability: log4j - CVE-2021-44228\n\nOn Dec. 9, 2021,\
      \ a remote code execution (RCE) vulnerability in Apache log4j 2 was identified\
      \ being exploited in the wild. Public proof of concept (PoC) code was released\
      \ and subsequent investigation revealed that exploitation was incredibly easy\
      \ to perform. \n\nAffected Version\nApache Log4j 2.x <= 2.15.0-rc1\n\nThis playbook\
      \ should be trigger manually and includes the following tasks: \n\n* Collect\
      \ related known indicators from several sources.\n* Indicators and exploitation\
      \ patterns hunting using PAN-OS, Cortex XDR and SIEM products.\n* Block indicators\
      \ automatically or manually.\n\nMitigations:\n* Apache official CVE-2021-44228\
      \ patch.\n* Unit42 recommended mitigations.\n\nMore information:\n[Apache Log4j\
      \ Vulnerability Is Actively Exploited in the Wild (CVE-2021-44228)](https://unit42.paloaltonetworks.com/apache-log4j-vulnerability-cve-2021-44228/)\n\
      \nNote: This is a beta playbook, which lets you implement and test pre-release\
      \ software. Since the playbook is beta, it might contain bugs. Updates to the\
      \ pack during the beta phase might include non-backward compatible features.\
      \ We appreciate your feedback on the quality and usability of the pack to help\
      \ us identify issues, fix them, and continually improve."
  required: false
  description: The playbook description for Rapid Breach Response layout.
  playbookInputQuery:
- key: EDLDomainBlocklist
  value: {}
  required: false
  description: The EDL domain blocklist name.
  playbookInputQuery:
- key: BlockIndicatorsAutomatically
  value:
    simple: "True"
  required: false
  description: Whether to block the indicators automatically or not.
  playbookInputQuery:
outputs: []
tests:
- No tests (auto formatted)
fromversion: 6.0.0
