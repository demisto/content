id: XSOAR Engineer Training - URL Alerts (Completed)
version: -1
name: XSOAR Engineer Training - URL Alerts (Completed)
description: "Example playbook for the Training - URL Clicks use case, for xsoar engineer training.  This is what it *could* look like when done. \n"
tags:
- training
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 8b711fcb-8ad8-4779-83f5-bceb5aeaea54
    type: start
    task:
      id: 8b711fcb-8ad8-4779-83f5-bceb5aeaea54
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "23"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 807.5,
          "y": 50
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: 73fab278-32d9-40fb-844a-7a79c263232e
    type: regular
    task:
      id: 73fab278-32d9-40fb-844a-7a79c263232e
      version: -1
      name: Get User details from AD
      description: Retrieves detailed information about a user account. The user can be specified by username, email address, or as an Active Directory Distinguished Name (DN).
      script: XSOAR Engineer Training|||ad-get-user
      type: regular
      iscommand: true
      brand: XSOAR Engineer Training
    nexttasks:
      '#none#':
      - "34"
    scriptarguments:
      email:
        complex:
          root: incident
          accessor: sourceusername
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 592.5,
          "y": 1040
        }
      }
    note: true
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: 794c5e99-5801-4f21-8f92-0b45b6d2598d
    type: title
    task:
      id: 794c5e99-5801-4f21-8f92-0b45b6d2598d
      version: -1
      name: 'Triage '
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "38"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 807.5,
          "y": 720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: 537d91f9-d81a-4edf-8f00-c37c010ca0ac
    type: title
    task:
      id: 537d91f9-d81a-4edf-8f00-c37c010ca0ac
      version: -1
      name: Remediation - Start Remediation SLA Timer
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "30"
      - "31"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 592.5,
          "y": 1915
        }
      }
    note: false
    timertriggers:
    - fieldname: remediationsla
      action: start
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: c64ef296-766b-4fde-87d2-c3ee8d10e1a6
    type: condition
    task:
      id: c64ef296-766b-4fde-87d2-c3ee8d10e1a6
      version: -1
      name: Analyst Review - No Malicious Indicators Found
      description: |-
        Review Incident, determine if remediation is required or not.

        Select Yes to remediate this by blocking the clicked url and engaging with the user to reset their password.

        Select No to close this as a False Positive.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "No":
      - "8"
      "Yes":
      - "6"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: 68da5c1d-9ebc-42e6-8bd6-a245ee57a716
    type: regular
    task:
      id: 68da5c1d-9ebc-42e6-8bd6-a245ee57a716
      version: -1
      name: Close Investigation - FP
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "37"
    scriptarguments:
      closeNotes:
        simple: Done.
      closeReason:
        simple: False Positive
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 3050
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: 8753642e-c211-447e-8530-e6d3ef0fa19f
    type: collection
    task:
      id: 8753642e-c211-447e-8530-e6d3ef0fa19f
      version: -1
      name: Ask user if they potentially exposed Credentials?
      description: Data Collection Task
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "13"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 377.5,
          "y": 2205
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to: {}
      subject:
        simple: Malicious URL Clicked
      body:
        simple: We've been notified you clicked a bad url, please respond to the survey.
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 0
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: Did you put your creds in that page?
        required: true
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - {}
        - simple: "Yes"
        - simple: "No"
        fieldassociated: ""
        placeholder: ""
        tooltip: Did they put creds in.
        readonly: false
      title: Malicious URL Survey
      description: Check whether the user put creds in, we can email this to the user.
      sender: Cross is Coming
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: 2b1e015a-79a3-4878-8656-64f713e13c7b
    type: condition
    task:
      id: 2b1e015a-79a3-4878-8656-64f713e13c7b
      version: -1
      name: Did user leak creds?
      description: Conditional if they answered yes to leaking creds.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "18"
      "yes":
      - "21"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: Malicious URL Survey.Answers.0
            iscontext: true
          right:
            value:
              simple: "Yes"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 377.5,
          "y": 2380
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: 305ae00f-df59-47e2-8920-7151b5e4d785
    type: title
    task:
      id: 305ae00f-df59-47e2-8920-7151b5e4d785
      version: -1
      name: Closure
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "20"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 490,
          "y": 2905
        }
      }
    note: false
    timertriggers:
    - fieldname: remediationsla
      action: stop
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: 3d300add-e4c1-4620-8ca8-faddec5dbe0b
    type: regular
    task:
      id: 3d300add-e4c1-4620-8ca8-faddec5dbe0b
      version: -1
      name: Close XSOAR Investigation (Manual)
      description: "Close the current incident:\n\nYou can goto Actions -> Close to complete the required fields. "
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "37"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 490,
          "y": 3050
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: 413ad950-51ff-4297-8397-95b3ed3f9537
    type: playbook
    task:
      id: 413ad950-51ff-4297-8397-95b3ed3f9537
      version: -1
      name: XSOAR Engineer Training - AD Password Reset  (Sub-Playbook)
      description: "This is a sub-playbook that simulates an AD Password Reset process, which can be used as a sub-playbook across a number of different playbooks simply by adding it in, and passing the proper inputs in. \n\nThis sub-playbook will output the new password, so it can be provided to the User, or maybe the users manager. "
      playbookName: XSOAR Engineer Training - AD Password Reset  (Sub-Playbook)
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "22"
    scriptarguments:
      username:
        complex:
          root: ActiveDirectory.Users
          accessor: sAMAccountName
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 490,
          "y": 2555
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: d0fbc72b-5605-483d-83de-a4ce721866dc
    type: regular
    task:
      id: d0fbc72b-5605-483d-83de-a4ce721866dc
      version: -1
      name: Manual - Provide password to User!
      description: |-
        Please call the user with their new password:

        New Password: ${NEW_PASSWORD}
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "18"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 490,
          "y": 2730
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: f467d40a-23de-4225-8644-aa7d70ccbf56
    type: regular
    task:
      id: f467d40a-23de-4225-8644-aa7d70ccbf56
      version: -1
      name: Delete Context
      description: Delete field from context
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "33"
    scriptarguments:
      all:
        simple: "yes"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 807.5,
          "y": 195
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: ef7dbd7c-2916-48e4-8bdc-f0cf418b71d2
    type: regular
    task:
      id: ef7dbd7c-2916-48e4-8bdc-f0cf418b71d2
      version: -1
      name: Tag Clicked URL Indicator for blocking on EDL
      description: commands.local.cmd.add.values.to.indicator.multi.select.field
      script: Builtin|||appendIndicatorField
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "18"
    scriptarguments:
      field:
        simple: tags
      fieldValue:
        simple: approved_block
      indicatorsValues:
        complex:
          root: incident
          accessor: details
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 920,
          "y": 2730
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: 91161e02-63a0-4e91-8576-2db89e85f1be
    type: regular
    task:
      id: 91161e02-63a0-4e91-8576-2db89e85f1be
      version: -1
      name: Check if Source IP was from an Internal or External IP with Field Mapping
      description: Returns yes if the IP is in one of the ranges provided, returns no otherwise.
      scriptName: IsIPInRanges
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "40"
    scriptarguments:
      ip:
        complex:
          root: incident
          accessor: sourceip
      ipRanges:
        simple: ${lists.Internal IP Ranges}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 377.5,
          "y": 1390
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    fieldMapping:
    - incidentfield: Detected Internal IPs
      output:
        complex:
          root: IP
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: IP.InRange
                iscontext: true
              right:
                value:
                  simple: "yes"
              ignorecase: true
          accessor: Address
    - incidentfield: Detected External IPs
      output:
        complex:
          root: IP
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: IP.InRange
                iscontext: true
              right:
                value:
                  simple: "no"
              ignorecase: true
          accessor: Address
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: 99915672-9bd7-4f17-8bf9-1fece90ca619
    type: title
    task:
      id: 99915672-9bd7-4f17-8bf9-1fece90ca619
      version: -1
      name: Engage with User
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "10"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 377.5,
          "y": 2060
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: fa16abf4-b0a3-4dec-840a-99be26b48a09
    type: title
    task:
      id: fa16abf4-b0a3-4dec-840a-99be26b48a09
      version: -1
      name: Block Malicious URL
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "24"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 920,
          "y": 2570
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: 4202f8c8-7019-4acc-8ab5-c8cbe34ec489
    type: regular
    task:
      id: 4202f8c8-7019-4acc-8ab5-c8cbe34ec489
      version: -1
      name: Print Playbook Overview
      description: Prints text to war room (Markdown supported)
      scriptName: Print
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "36"
    scriptarguments:
      value:
        simple: "## XSOAR Engineer Training - URL Clicked Playbook (Completed)\n\nExample playbook for the Training - URL Clicks use case, for xsoar engineer training.  This is what it *could* look like when done. \n\nMake sure to run it on a properly classified and mapped Incident in XSOAR, as it requires specific fields!"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 807.5,
          "y": 370
        }
      }
    note: true
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: 6e26f7f0-f22b-44e7-8397-6fcfcb0851a7
    type: condition
    task:
      id: 6e26f7f0-f22b-44e7-8397-6fcfcb0851a7
      version: -1
      name: Does the User exist in AD?
      description: Does the user exist in AD?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "35"
      "yes":
      - "26"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: ActiveDirectory.Users.sAMAccountName
            iscontext: true
          right:
            value: {}
      - - operator: isNotEmpty
          left:
            value:
              simple: ActiveDirectory.Users.sAMAccountName
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 592.5,
          "y": 1215
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: cdedfa28-486e-40f3-8bf1-f06e012d73e3
    type: regular
    task:
      id: cdedfa28-486e-40f3-8bf1-f06e012d73e3
      version: -1
      name: Close Investigation - FP - User does not exist
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "37"
    scriptarguments:
      closeNotes:
        simple: User ${incident.emailto} does not exist.
      closeReason:
        simple: False Positive
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1145,
          "y": 3050
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: fbcf7e36-6f7e-4778-8620-54bce57113c3
    type: regular
    task:
      id: fbcf7e36-6f7e-4778-8620-54bce57113c3
      version: -1
      name: Update the Incident Name
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      name:
        simple: URL Clicked - ${incident.eventtype} - ${incident.sourceusername}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 807.5,
          "y": 545
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: a7b4dd05-ab9e-4019-802c-d5f98f8218db
    type: title
    task:
      id: a7b4dd05-ab9e-4019-802c-d5f98f8218db
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 817.5,
          "y": 3225
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: a7a942c9-c8f9-4136-857b-f9de4172f6f1
    type: condition
    task:
      id: a7a942c9-c8f9-4136-857b-f9de4172f6f1
      version: -1
      name: Was the URL Blocked?
      description: Was the type = url blocked
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "1"
      "yes":
      - "39"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: incident
                accessor: eventtype
            iscontext: true
          right:
            value:
              simple: url blocked
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 807.5,
          "y": 865
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: 8f4b48d4-d4b7-4eda-8be4-20b3b72044cc
    type: regular
    task:
      id: 8f4b48d4-d4b7-4eda-8be4-20b3b72044cc
      version: -1
      name: Close - URL Blocked
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "37"
    scriptarguments:
      closeNotes:
        simple: URL blocked by firewall.  Nothing to see here.
      closeReason:
        simple: Resolved
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1575,
          "y": 3050
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: 61e9cf56-7b78-46bc-83c3-23a91ba7ef6e
    type: condition
    task:
      id: 61e9cf56-7b78-46bc-83c3-23a91ba7ef6e
      version: -1
      name: Are there Malicious/Suspicious Indicators Found?
      description: Checks if the investigation found any malicious indicators (file, URL, IP address, domain, or email). Returns "yes" if at least one malicious indicator is found.
      scriptName: IsMaliciousIndicatorFound
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "7"
      "yes":
      - "6"
    scriptarguments:
      includeManual:
        simple: "yes"
      includeSuspicious:
        simple: "yes"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 377.5,
          "y": 1565
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 3240,
        "width": 1905,
        "x": 50,
        "y": 50
      }
    }
  }
inputs: []
outputs: []
fromversion: 6.8.0
tests:
- No tests (auto formatted)
