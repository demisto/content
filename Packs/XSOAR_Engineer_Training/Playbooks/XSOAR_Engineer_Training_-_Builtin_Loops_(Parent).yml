id: XSOAR Engineer Training - Builtin Loops (Parent)
version: -1
name: XSOAR Engineer Training - Builtin Loops (Parent)
description: "This playbook demonstrates how to do sub-playbook looping using the Builtin method.  Basically looping over the embedded sub-playbook until results are returned (or not). \n"
tags:
- training
- xet
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: bab9a809-a2db-4752-827d-56e06594697a
    type: start
    task:
      id: bab9a809-a2db-4752-827d-56e06594697a
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "1"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 265,
          "y": 50
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: 1715a206-a52e-4b55-8f02-d31c157610c8
    type: regular
    task:
      id: 1715a206-a52e-4b55-8f02-d31c157610c8
      version: -1
      name: 'Delete Context '
      description: Delete field from context
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      all:
        simple: "yes"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 265,
          "y": 195
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: 86188cc9-66c6-4475-8ba8-2c037acdae49
    type: regular
    task:
      id: 86188cc9-66c6-4475-8ba8-2c037acdae49
      version: -1
      name: Pause to explain
      description: "We are going to loop using our sub-playbook, checking to see if we have results from splunk, and if not we back off and wait and then run again.  The loop will exit when there are results returned OR 5 loops have run. \n\nNote the loop setup, where we want to loop 5 times until data is returned.  However if the condition is not satisfied the playbook will error.  We handle this by looping 6 times, and setting the condition on the 5th loop if no results are returned.  This means on the 6th loop, the condition will be checked at the beginning and our loop will exit gracefully. \n\n"
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 265,
          "y": 545
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: 88677e37-7976-4c76-8961-4b0d4bc1baeb
    type: playbook
    task:
      id: 88677e37-7976-4c76-8961-4b0d4bc1baeb
      version: -1
      name: XSOAR Engineer Training - Builtin Loops (Sub-Playbook)
      description: This sub-playbook runs a SIEM search, and also increments a counter to track how many loops were performed while waiting for a search result.  Used with the parent playbook to demonstrate the Builtin looping method.
      playbookName: XSOAR Engineer Training - Builtin Loops (Sub-Playbook)
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      query:
        simple: 'laptop=crossiscoming* '
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      builtincondition:
      - - operator: isNotEmpty
          left:
            value:
              simple: SIEM.Result
            iscontext: true
          right:
            value: {}
      exitCondition: ""
      wait: 2
      max: 6
    view: |-
      {
        "position": {
          "x": 265,
          "y": 730
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: 31333517-973c-4dad-8c62-fdafcde2db2c
    type: condition
    task:
      id: 31333517-973c-4dad-8c62-fdafcde2db2c
      version: -1
      name: Was there a SIEM Result?
      description: Check if there was a result.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "8"
      "yes":
      - "5"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: SIEM.Result
            iscontext: true
          right:
            value: {}
      - - operator: isNotEmpty
          left:
            value:
              simple: SIEM.Result
            iscontext: true
      - - operator: notContainsGeneral
          left:
            value:
              simple: SIEM.Result
            iscontext: true
          right:
            value:
              simple: NO RESULTS
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 265,
          "y": 895
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: 299ac90e-b9d6-400c-8feb-e1cdfc21f4ce
    type: regular
    task:
      id: 299ac90e-b9d6-400c-8feb-e1cdfc21f4ce
      version: -1
      name: SIEM search successful!
      description: Prints text to war room (Markdown supported)
      scriptName: Print
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      value:
        complex:
          root: LoopCounter
          transformers:
          - operator: LastArrayElement
          - operator: Stringify
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'Results returned after '
              suffix:
                value:
                  simple: ' loops'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1070
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: 2d8389ed-5dab-4846-8c1f-811f6d1ef50b
    type: title
    task:
      id: 2d8389ed-5dab-4846-8c1f-811f6d1ef50b
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 265,
          "y": 1245
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: a7b5ae0e-a6c9-4d42-8caf-4deb91c490ed
    type: regular
    task:
      id: a7b5ae0e-a6c9-4d42-8caf-4deb91c490ed
      version: -1
      name: SIEM search did not return results
      description: Prints text to war room (Markdown supported)
      scriptName: Print
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      value:
        complex:
          root: LoopCounter
          transformers:
          - operator: LastArrayElement
          - operator: Stringify
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'No results returned after '
              suffix:
                value:
                  simple: ' loops'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1070
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: bdf620eb-a92c-4603-88d3-1935facaa2d4
    type: regular
    task:
      id: bdf620eb-a92c-4603-88d3-1935facaa2d4
      version: -1
      name: Print Playbook Overview
      description: Prints text to war room (Markdown supported)
      scriptName: Print
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "2"
    scriptarguments:
      value:
        simple: "## XSOAR Engineer Training - Builtin Loops (Parent)\n\nThis playbook demonstrates how to do sub-playbook looping using the Builtin method.  Basically looping over the embedded sub-playbook until results are returned (or not). \n\nNote the setup, where we want to loop 5 times until data is returned.  However if the condition is not satisfied the playbook will error.  We handle this by looping 6 times, and setting the condition on the 5th loop if no results are returned.  This means on the 6th loop, the condition will be checked at the beginning and our loop will exit gracefully. \n"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 265,
          "y": 370
        }
      }
    note: true
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 1260,
        "width": 810,
        "x": 50,
        "y": 50
      }
    }
  }
inputs: []
outputs: []
fromversion: 6.8.0
tests:
- No tests (auto formatted)
