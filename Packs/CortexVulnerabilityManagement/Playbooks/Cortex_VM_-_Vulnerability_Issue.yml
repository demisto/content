contentitemexportablefields:
  contentitemfields: {}
description: This playbook handles vulnerability issues by enriching assets to find potential remediation owners.
id: Cortex VM - Vulnerability Issue
inputs: []
name: Cortex VM - Vulnerability Issue
outputs: []
starttaskid: "0"
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 5b7293b5-4b5f-4fa1-8fe8-54f93a4b1736
      iscommand: false
      name: ""
      version: -1
      description: ''
    taskid: 5b7293b5-4b5f-4fa1-8fe8-54f93a4b1736
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 440,
          "y": -310
        }
      }
  "1":
    continueonerrortype: ""
    id: "1"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "8"
    note: false
    quietmode: 0
    scriptarguments:
      asset_id:
        simple: ${alert.asset_ids}
    separatecontext: false
    skipunavailable: false
    task:
      brand: Cortex Core - IR
      description: Get UAI asset info.
      id: ff1bc67d-8dca-4ed7-9cc7-1efadcb7be3b
      iscommand: true
      name: core-get-asset-details
      script: Cortex Core - IR|||core-get-asset-details
      type: regular
      version: -1
    taskid: ff1bc67d-8dca-4ed7-9cc7-1efadcb7be3b
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 440,
          "y": 140
        }
      }
  "2":
    continueonerrortype: ""
    id: "2"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 6d2b9017-6ca7-4d60-86f8-e64ea7481bf0
      iscommand: false
      name: Complete
      type: title
      version: -1
      description: ''
    taskid: 6d2b9017-6ca7-4d60-86f8-e64ea7481bf0
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 840,
          "y": 2611
        }
      }
  "3":
    continueonerrortype: ""
    id: "3"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    scriptarguments:
      all:
        simple: "yes"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Delete field from context.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        For Cortex.13, see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.13/Cortex-XSOAR-Administrator-Guide/Automations
        For Cortex Cloud, see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Scripts
        For Cortex on-prem, see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Scripts
        For Cortex XSIAM, see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSIAM/Cortex-XSIAM-Documentation/Automations
      id: 7b519123-1e10-4b1e-808b-85f627d1044a
      iscommand: false
      name: DeleteContext
      script: DeleteContext
      type: regular
      version: -1
    taskid: 7b519123-1e10-4b1e-808b-85f627d1044a
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 440,
          "y": -180
        }
      }
  "4":
    continueonerrortype: ""
    id: "4"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "7"
    note: false
    quietmode: 0
    reputationcalc: 1
    scriptarguments:
      text:
        simple: ${Core}
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: Extract all indicators according to the server indicators configuration.
      id: a3d0eeeb-33c7-4e60-8624-201282ff6039
      iscommand: true
      name: extractIndicators
      script: Builtin|||extractIndicators
      type: regular
      version: -1
    taskid: a3d0eeeb-33c7-4e60-8624-201282ff6039
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 195,
          "y": 1532
        }
      }
  "6":
    continueonerrortype: ""
    id: "6"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "1"
    note: false
    quietmode: 0
    scriptarguments:
      vmassetowner:
        simple: '[]'
      vmassetownerunrankedraw:
        simple: '[]'
      xdmremediationowners:
        simple: '[]'
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: Clear grid fields in case the playbook is rerun.
      id: 0e26e887-8b24-48f3-942e-b48cd8268ce4
      iscommand: true
      name: Initialize grid fields
      script: Builtin|||setIssue
      type: regular
      version: -1
    taskid: 0e26e887-8b24-48f3-942e-b48cd8268ce4
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 440,
          "y": -20
        }
      }
  "7":
    continueonerrortype: ""
    id: "7"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "13"
    note: false
    quietmode: 0
    scriptarguments:
      FQDN:
        complex:
          accessor: xdm__host__fqdn}
          root: ${Core.CoreAsset
          transformers:
          - args:
              applyIfEmpty: {}
              defaultValue:
                iscontext: true
                value:
                  simple: ${ExtractedIndicators.Domain}
            operator: SetIfEmpty
      HostName:
        simple: ${Core.CoreAsset.xdm__asset__name}${Core.CoreAsset.xdm__host__hostname}
      IPv4:
        complex:
          accessor: Platform Discovery}
          root: ${Core.CoreAsset.xdm__asset__normalized_fields
          transformers:
          - args:
              field:
                value:
                  simple: xdm.host.ipv4_addresses
            operator: getField
          - args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: ${ExtractedIndicators.IP}
            operator: SetIfEmpty
      IPv6:
        complex:
          accessor: Platform Discovery}
          root: ${Core.CoreAsset.xdm__asset__normalized_fields
          transformers:
          - args:
              field:
                value:
                  simple: xdm.host.ipv6_addresses
            operator: getField
          - args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: ${ExtractedIndicators.IPv6}
            operator: SetIfEmpty
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: 'Given provided indicators (IPs, Hostnames, FQDNs, etc.), enriches ServiceNow CMDB information relevant to vulnerability issues.'
      id: d0d04145-a411-4f7d-b188-7a6360451177
      iscommand: false
      name: Cortex VM - ServiceNow CMDB
      playbookId: Cortex VM - ServiceNow CMDB
      type: playbook
      version: -1
    taskid: d0d04145-a411-4f7d-b188-7a6360451177
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 195,
          "y": 1683
        }
      }
  "8":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: Core.CoreAsset
          operator: isExists
          right:
            value: {}
      label: "yes"
    continueonerrortype: ""
    id: "8"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "9"
      "yes":
      - "15"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks if an asset was returned from the last command.
      id: 4658a7c4-0c63-4b3e-8606-2809121612b0
      iscommand: false
      name: Was an asset found?
      type: condition
      version: -1
    taskid: 4658a7c4-0c63-4b3e-8606-2809121612b0
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 440,
          "y": 300
        }
      }
  "9":
    continueonerrortype: ""
    id: "9"
    ignoreworker: true
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "10"
    note: false
    quietmode: 0
    scriptarguments:
      execution-timeout:
        simple: "3660"
      seconds:
        simple: "3600"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Sleep for X seconds.
      id: 4fad88cd-d0cf-4800-813e-e54f5591359a
      iscommand: false
      name: Sleep for 1 hour
      script: Sleep
      type: regular
      version: -1
    taskid: 4fad88cd-d0cf-4800-813e-e54f5591359a
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 840,
          "y": 470
        }
      }
  "10":
    continueonerrortype: ""
    id: "10"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "11"
    note: false
    quietmode: 0
    scriptarguments:
      asset_id:
        simple: ${alert.asset_ids}
    separatecontext: false
    skipunavailable: false
    task:
      brand: Cortex Core - IR
      description: Get UAI asset info.
      id: 4d193fad-296f-4231-87ae-10e30432ae65
      iscommand: true
      name: core-get-asset-details
      script: Cortex Core - IR|||core-get-asset-details
      type: regular
      version: -1
    taskid: 4d193fad-296f-4231-87ae-10e30432ae65
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 840,
          "y": 630
        }
      }
  "11":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: Core.CoreAsset
          operator: isExists
          right:
            value: {}
      label: "yes"
    continueonerrortype: ""
    id: "11"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "2"
      "yes":
      - "15"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks if an asset was returned from the last command.
      id: e6375dd8-9e13-4e24-83f1-324edeb35817
      iscommand: false
      name: Was an asset found?
      type: condition
      version: -1
    taskid: e6375dd8-9e13-4e24-83f1-324edeb35817
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 840,
          "y": 790
        }
      }
  "12":
    continueonerrortype: ""
    id: "12"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "20"
      - "21"
    note: false
    quietmode: 0
    scriptarguments:
      asmsystemids:
        simple: ${Core.CoreAsset.xdm__asset__name}
      ownerrelatedfield:
        simple: vmassetowner
      owners:
        simple: ${alert.vmassetownerunrankedraw}
      tenantcommand:
        simple: "True"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Recommend most likely service owners from those surfaced by Cortex ASM Enrichment.
      id: 38a61712-4372-438f-a608-ac8982bfe9f4
      iscommand: false
      name: RankServiceOwners
      script: RankServiceOwners
      type: regular
      version: -1
    taskid: 38a61712-4372-438f-a608-ac8982bfe9f4
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 195,
          "y": 2022
        }
      }
  "13":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: alert.vmassetownerunrankedraw
          operator: isNotEmpty
          right:
            value: {}
      label: "yes"
    continueonerrortype: ""
    id: "13"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "2"
      "yes":
      - "12"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks if an asset was returned from the last command.
      id: e9690b87-3f71-4360-b7f0-a824fdde9618
      iscommand: false
      name: Were remediation owner(s) found?
      type: condition
      version: -1
    taskid: e9690b87-3f71-4360-b7f0-a824fdde9618
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 195,
          "y": 1824
        }
      }
  "14":
    continueonerrortype: ""
    id: "14"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "16"
    note: false
    quietmode: 0
    reputationcalc: 1
    scriptarguments:
      ignore-outputs:
        simple: "false"
      text:
        simple: ${Core.CoreAsset.xdm__asset__tags}
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: Extract all indicators according to the server indicators configuration.
      id: 0f4d83f4-7ee7-4e7f-b886-bb2965f9f027
      iscommand: true
      name: extractIndicators
      script: Builtin|||extractIndicators
      type: regular
      version: -1
    taskid: 0f4d83f4-7ee7-4e7f-b886-bb2965f9f027
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 438,
          "y": 1098
        }
      }
  "15":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: ${Core.CoreAsset.xdm__asset__tags}
          operator: isNotEmpty
          right:
            value: {}
      label: "yes"
    continueonerrortype: ""
    id: "15"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "4"
      "yes":
      - "14"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks if an asset has tags to extract indicators from.
      id: 7145e88e-17f9-41f8-99b4-0fad58cfbb0c
      iscommand: false
      name: Are there tags?
      type: condition
      version: -1
    taskid: 7145e88e-17f9-41f8-99b4-0fad58cfbb0c
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 438,
          "y": 924
        }
      }
  "16":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: ExtractedIndicators.Email
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "16"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "4"
      "yes":
      - "17"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks if emails were extracted from asset tags.
      id: 90ed944f-623d-451b-a75f-e947442d64a1
      iscommand: false
      name: Were emails found?
      type: condition
      version: -1
    taskid: 90ed944f-623d-451b-a75f-e947442d64a1
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 438,
          "y": 1247
        }
      }
  "17":
    continueonerrortype: ""
    id: "17"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "4"
    note: false
    quietmode: 0
    scriptarguments:
      gridfield:
        simple: vmassetownerunrankedraw
      keys:
        simple: name,email,source,timestamp
      val1:
        simple: n/a
      val2:
        simple: ${ExtractedIndicators.Email}
      val3:
        simple: ${Core.CoreAsset.xdm__asset__provider}
      val4:
        simple: TIMESTAMP
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      id: 86485c5d-e273-41cb-a86b-b46a8640cd35
      iscommand: false
      name: Set asset owner grid field (email)
      script: GridFieldSetup
      type: regular
      version: -1
    taskid: 86485c5d-e273-41cb-a86b-b46a8640cd35
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 438,
          "y": 1392
        }
      }
  "18":
    continueonerrortype: ""
    id: "18"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "22"
    note: false
    quietmode: 0
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: temp_owners
      value:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: alert.vmassetowner.email
              operator: isNotEqualString
              right:
                value:
                  simple: n/a
          root: alert.vmassetowner.email
          transformers:
          - operator: StringToArray
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set a value in context under the key you entered.
      id: 0b25a9f4-8b9d-4d26-9990-f8b2cf0b5289
      iscommand: false
      name: Set temporary context (email)
      script: Set
      type: regular
      version: -1
    taskid: 0b25a9f4-8b9d-4d26-9990-f8b2cf0b5289
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 414,
          "y": 2350
        }
      }
  "19":
    continueonerrortype: ""
    id: "19"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "22"
    note: false
    quietmode: 0
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: temp_owners
      value:
        complex:
          accessor: vmassetowner.name
          filters:
          - - left:
                iscontext: true
                value:
                  simple: alert.vmassetowner.email
              operator: isEqualString
              right:
                value:
                  simple: n/a
          root: alert
          transformers:
          - operator: StringToArray
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set a value in context under the key you entered.
      id: 83e60207-881b-477c-8219-90e75f6306f8
      iscommand: false
      name: Set temporary context (name)
      script: Set
      type: regular
      version: -1
    taskid: 83e60207-881b-477c-8219-90e75f6306f8
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -16,
          "y": 2350
        }
      }
  "20":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: alert.vmassetowner.email
                    operator: isEqualString
                    right:
                      value:
                        simple: n/a
                root: alert.vmassetowner.email
          operator: isNotEmpty
          right:
            value: {}
      label: "yes"
    continueonerrortype: ""
    id: "20"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "2"
      "yes":
      - "19"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks if there an email that is n/a
      id: a23edc0f-d5da-4e69-82ce-499cdb27a94c
      iscommand: false
      name: Is there an email that is n/a?
      type: condition
      version: -1
    taskid: a23edc0f-d5da-4e69-82ce-499cdb27a94c
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -23,
          "y": 2165
        }
      }
  "21":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: alert.vmassetowner.email
                    operator: isNotEqualString
                    right:
                      value:
                        simple: n/a
                root: alert.vmassetowner.email
          operator: isNotEmpty
          right:
            value: {}
      label: "yes"
    continueonerrortype: ""
    id: "21"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "2"
      "yes":
      - "18"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Checks if there an email that is not n/a
      id: 0487fb52-c6d1-4d76-bd01-b7976a29341f
      iscommand: false
      name: Is there an email that is not n/a?
      type: condition
      version: -1
    taskid: 0487fb52-c6d1-4d76-bd01-b7976a29341f
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 407,
          "y": 2165
        }
      }
  "22":
    continueonerrortype: ""
    id: "22"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "2"
    note: false
    quietmode: 0
    scriptarguments:
      xdmremediationowners:
        simple: ${temp_owners}
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.set.incident
      id: 04eb61a1-8e54-4f49-aacd-6c4738aa9e71
      iscommand: true
      name: Set remediation owners field
      script: Builtin|||setIssue
      type: regular
      version: -1
    taskid: 04eb61a1-8e54-4f49-aacd-6c4738aa9e71
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 207,
          "y": 2488
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "11_2_#default#": 0.11,
      "13_12_yes": 0.42,
      "13_2_#default#": 0.35,
      "15_14_yes": 0.42,
      "15_4_#default#": 0.59,
      "16_17_yes": 0.59,
      "16_4_#default#": 0.37,
      "20_2_#default#": 0.23,
      "21_2_#default#": 0.38
    },
    "paper": {
      "dimensions": {
        "height": 2981,
        "width": 1244,
        "x": -23,
        "y": -310
      }
    }
  }
tests:
- No tests (auto formatted)
fromversion: 6.10.0
