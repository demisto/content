id: silent-CVE-2025-31324 - SAP NetWeaver Visual Composer
version: -1
issilent: true
name: silent-CVE-2025-31324 - SAP NetWeaver Visual Composer
description: "CVE-2025-31324 is a critical zero-day vulnerability affecting the Metadata Uploader component of SAP NetWeaver Visual Composer. The vulnerability arises from missing authorization checks, allowing unauthenticated attackers to upload malicious executable binaries. Exploitation of this flaw can lead to full remote code execution (RCE) on affected systems, posing a significant risk to confidentiality, integrity, and availability.\n\n## CVE-2025-31324 - SAP NetWeaver RCE Vulnerability\n\n##   Vulnerability Overview\n\n- **Component Affected**: SAP NetWeaver Visual Composer Metadata Uploader  \n- **Endpoint**: `/developmentserver/metadatauploader`  \n- **CVE ID**: CVE-2025-31324  \n- **CVSS Score**: 10.0 (Critical)  \n- **Exploitability**: Unauthenticated remote attackers can exploit this without user interaction  \n\nThis flaw allows unauthenticated attackers to upload arbitrary files (e.g., JSP web shells), enabling remote code execution with the same privileges as the SAP application server process.  \n[Source: Unit42 - Palo Alto Networks](https://unit42.paloaltonetworks.com/threat-brief-sap-netweaver-cve-2025-31324/)\n\n\n##  Mitigation and Recommendations\n\n- **Apply Patch**: SAP Note #3594142 (released April 24, 2025)  \n- **Disable Visual Composer** if not in use  \n- **Restrict Access** to the vulnerable endpoint  \n- **Monitor for IoCs** in `/irj/servlet_jsp/irj/root/` and suspicious traffic  \n\n##  Conclusion\n\nCVE-2025-31324 is actively exploited and is critically severe. Organizations should patch immediately, monitor for compromise, and disable or restrict vulnerable components.\n\n[View official CVE details on NIST](https://nvd.nist.gov/vuln/detail/CVE-2025-31324)\n\n##  Playbook Triggers\n- Manually\n- \"CVE Exploitation - 986328356\" Agent rule\n\n##  Playbook Flow\n1. Using XQL, identify potential SAP NetWeaver instances in your environment.\n2. Using XQL, check if there are events that point to any potential webshells downloaded in the directories.\n3. Directory enumeration to identify if there are already any suspicious files that might indicate a webshell.\n4. *Collect* IOCs from a Unit42 blog, *search* them using the \"Threat Hunting - Generic\" playbook (supports Palo Alto networks products, Qradar, and Splunk), and *block* those indicators using the \"Containment Plan - Block Indicators\" playbook.\n5. Provides Mitigation recommendations.\n"
tags:
- Rapid Breach Response
- 'CVE-2025-31324'
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 7990bdd5-17f3-43d3-844f-c8b7d92311fa
    type: start
    task:
      id: 7990bdd5-17f3-43d3-844f-c8b7d92311fa
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "26"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3703,
          "y": -350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: 19778934-a5fa-4bca-8392-e99e382099e5
    type: regular
    task:
      id: 19778934-a5fa-4bca-8392-e99e382099e5
      version: -1
      name: XQL Query - For possible compromised hosts
      description: |-
        Execute an XQL query and retrieve results of an executed XQL query API. The command will be executed every 10 seconds until results are retrieved or until a timeout error is raised.
        When more than 1000 results are retrieved, the command will return a compressed gzipped JSON format file,
        unless the argument 'parse_result_file_to_context' is set to true and then the results will be extracted to the context.
      script: '|||xdr-xql-generic-query'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      max_fields:
        simple: "100"
      query:
        simple: 'config timeframe=7d | dataset = xdr_data | filter event_type = ENUM.FILE  and lowercase(actor_process_image_name) = "jstart.exe" and lowercase(action_file_path) contains  "visualcomposer" | fields  agent_id,agent_hostname,agent_ip_addresses | dedup agent_id  '
      query_name:
        simple: Check for SAP NetWeaver Visual Composer
      time_frame:
        simple: 1 week ago
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3211.5,
          "y": 642
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: 0f808daf-5e80-401e-8c0e-22a9abe1e5ac
    type: regular
    task:
      id: 0f808daf-5e80-401e-8c0e-22a9abe1e5ac
      version: -1
      name: 'Manual – Search possible hosts'
      description: "Dear Analyst,\n\nEnsure that the 'XQL Query Engine' integration is active. If it's not enabled, activate the integration or manually run the following XQL query to determine if any hosts are running a potentially vulnerable product.\n\nQuery:\n\nconfig timeframe=7d | dataset = xdr_data | filter event_type = ENUM.FILE and lowercase(actor_process_image_name) = \"jstart.exe\" and lowercase(action_file_path) contains  \"visualcomposer\" | fields  agent_id,agent_hostname,agent_ip_addresses | dedup agent_id"
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "103"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3702.25,
          "y": 642
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: 772097c1-ff6c-4d60-86f9-3e6b4242981f
    type: condition
    task:
      id: 772097c1-ff6c-4d60-86f9-3e6b4242981f
      version: -1
      name: Is the integration of 'XQL Query Engine' available?
      description: Returns 'yes' if integration brand 'XQL Query Engine' is available. Otherwise returns 'no'.
      scriptName: IsIntegrationAvailable
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "2"
      "yes":
      - "5"
    scriptarguments:
      brandname:
        simple: XQL Query Engine
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3703,
          "y": 136
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: 97f99ae1-94b2-4cab-8bea-d47b93c8c9a1
    type: condition
    task:
      id: 97f99ae1-94b2-4cab-8bea-d47b93c8c9a1
      version: -1
      name: Any results from XQL?
      description: Any results from the XQL Query?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "9"
      "yes":
      - "92"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: PaloAltoNetworksXQL.GenericQuery.results
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3211.5,
          "y": 764
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: 2ba235b5-c69e-4605-8f22-54d387705f1f
    type: regular
    task:
      id: 2ba235b5-c69e-4605-8f22-54d387705f1f
      version: -1
      name: Check XQL quota
      description: Retrieve the amount of query quota available and used.
      script: '|||xdr-xql-get-quota'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "6"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3324.25,
          "y": 295
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: ee8f4d4c-839c-4564-8e92-b4637453c59d
    type: condition
    task:
      id: ee8f4d4c-839c-4564-8e92-b4637453c59d
      version: -1
      name: Is there enough quota?
      description: Check if there is enough quota to run the query.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "2"
      "yes":
      - "1"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: greaterThanOrEqual
          left:
            value:
              complex:
                root: PaloAltoNetworksXQL.Quota
                accessor: license_quota
                transformers:
                - operator: subtraction
                  args:
                    by:
                      value:
                        simple: PaloAltoNetworksXQL.Quota.used_quota
                      iscontext: true
            iscontext: true
          right:
            value:
              simple: "1"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3324.25,
          "y": 437
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: 3bf18c4e-991c-44df-845a-11062b6517fd
    type: title
    task:
      id: 3bf18c4e-991c-44df-845a-11062b6517fd
      version: -1
      name: 'XQL: Identify SAP NetWeaver Instances'
      description: This section identifies SAP NetWeaver Visual Composer instances.
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3703,
          "y": 11
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: 045d923d-5998-4258-804f-84e0dbfe7be4
    type: title
    task:
      id: 045d923d-5998-4258-804f-84e0dbfe7be4
      version: -1
      name: Investigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "11"
      - "12"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4191.5,
          "y": 1105
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: a6cf32eb-19e7-45bc-8b7a-3de6f52fdc69
    type: title
    task:
      id: a6cf32eb-19e7-45bc-8b7a-3de6f52fdc69
      version: -1
      name: Hunt For IOCs
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "15"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2771,
          "y": 1283
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: 830d8314-dbca-45d5-820c-bcae8326a32d
    type: title
    task:
      id: 830d8314-dbca-45d5-820c-bcae8326a32d
      version: -1
      name: Anlysis Endpoints
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "72"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4191.5,
          "y": 1283
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "15":
    id: "15"
    taskid: 50b0307d-07da-42e9-8bd9-03c0bdd6bfc3
    type: title
    task:
      id: 50b0307d-07da-42e9-8bd9-03c0bdd6bfc3
      version: -1
      name: Collect Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "17"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2771,
          "y": 1560
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: 5dec7a48-e151-473b-8992-145baaae477d
    type: regular
    task:
      id: 5dec7a48-e151-473b-8992-145baaae477d
      version: -1
      name: Collect indicators from Unit42 blog
      description: This script extracts indicators from HTML and handles bad TLDs to avoid file extension false positives.
      scriptName: ParseHTMLIndicators
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "25"
    scriptarguments:
      unescape_domain:
        simple: "False"
      url:
        simple: https://unit42.paloaltonetworks.com/threat-brief-sap-netweaver-cve-2025-31324/
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2771,
          "y": 1670
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: 7c5b96b8-2042-40f7-87ea-1dca56591380
    type: regular
    task:
      id: 7c5b96b8-2042-40f7-87ea-1dca56591380
      version: -1
      name: Extract indicators from data collected
      description: commands.local.cmd.extract.indicators
      script: Builtin|||extractIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "22"
    scriptarguments:
      text:
        complex:
          root: http.parsedBlog
          accessor: indicators
          transformers:
          - operator: RemoveEmpty
            args:
              empty_values: {}
              remove_keys:
                value:
                  simple: "true"
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2771,
          "y": 1913
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: 76f9da6c-93d7-48f4-8d2f-c55e4035f471
    type: title
    task:
      id: 76f9da6c-93d7-48f4-8d2f-c55e4035f471
      version: -1
      name: Tag and Link Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "23"
      - "24"
      - "52"
      - "51"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2771,
          "y": 2060
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: 3b3ad752-89a4-4416-8f5a-ee714a5ebdb5
    type: regular
    task:
      id: 3b3ad752-89a4-4416-8f5a-ee714a5ebdb5
      version: -1
      name: Tag IP indicators
      description: commands.local.cmd.new.indicator
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      retry-count:
        simple: "3"
      retry-interval:
        simple: "2"
      tags:
        simple: CVE-2025-31324
      type:
        simple: IP
      value:
        complex:
          root: ExtractedIndicators.IP
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: ExtractedIndicators.IP
                iscontext: true
          transformers:
          - operator: uniq
      verdict:
        simple: Malicious
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2183.25,
          "y": 2199
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: 53fd69d5-e3c3-40c0-848c-dcbfd453b4e2
    type: regular
    task:
      id: 53fd69d5-e3c3-40c0-848c-dcbfd453b4e2
      version: -1
      name: Tag CVE indicators
      description: commands.local.cmd.new.indicator
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      retry-count:
        simple: "3"
      retry-interval:
        simple: "2"
      tags:
        simple: SAP NetWeaver's Visual Composer Framework
      type:
        simple: CVE
      value:
        complex:
          root: ExtractedIndicators
          accessor: CVE
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2577.25,
          "y": 2199
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: 5cf42d6a-891e-43c8-863a-289dc383346c
    type: title
    task:
      id: 5cf42d6a-891e-43c8-863a-289dc383346c
      version: -1
      name: Extract Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "21"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2771,
          "y": 1790
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: ee36f036-0dcc-4395-8dcc-f28784085872
    type: condition
    task:
      id: ee36f036-0dcc-4395-8dcc-f28784085872
      version: -1
      name: Triggered manually or via alert?
      description: Was this alert triggered manually or via an alert trigger?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "27"
      Manually:
      - "7"
    separatecontext: false
    conditions:
    - label: Manually
      condition:
      - - operator: isNotEqualString
          left:
            value:
              simple: alert.name
            iscontext: true
          right:
            value:
              simple: CVE Exploitation - 986328356
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3703,
          "y": -216
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: 006a6132-8c6c-4ea4-838a-8fb7b0792eea
    type: title
    task:
      id: 006a6132-8c6c-4ea4-838a-8fb7b0792eea
      version: -1
      name: Alert
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "9"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4191.5,
          "y": 11
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 846387b1-5f00-42f8-8c91-92a5681ffac5
    type: title
    task:
      id: 846387b1-5f00-42f8-8c91-92a5681ffac5
      version: -1
      name: 'Remediation'
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "93"
      - "84"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3730,
          "y": 2786
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: 30c8c3c6-35a9-4cfc-81a7-7872e3329892
    type: title
    task:
      id: 30c8c3c6-35a9-4cfc-81a7-7872e3329892
      version: -1
      name: Mitigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "87"
      - "99"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3728,
          "y": 3204
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: b476f770-bec4-40ec-816e-a4137d65dedd
    type: condition
    task:
      id: b476f770-bec4-40ec-816e-a4137d65dedd
      version: -1
      name: Analysis Resolution - Should continue with the investigation?
      description: |+
        ## Check with the analyst whether to continue with the investigation.

        - Verify that SAP NetWeaver's Visual Composer Framework is version 7.50 (the vulnerable version).

        - Check the Threat Hunting steps returned results (if any).

        - Validate that there are no other affected systems, and the Potential WebShells are investigated.


      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "No":
      - "37"
      "Yes":
      - "36"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3727,
          "y": 3745
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
        simple: Do you need to continue with the investigation?
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
      replyOptions:
      - "Yes"
      - "No"
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: 367be2a0-8ebb-4d39-8662-9166243830dc
    type: title
    task:
      id: 367be2a0-8ebb-4d39-8662-9166243830dc
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3729.5,
          "y": 4026
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: cffbb852-ff7b-4f6a-8aaa-866f102b66d4
    type: regular
    task:
      id: cffbb852-ff7b-4f6a-8aaa-866f102b66d4
      version: -1
      name: Investigate Further
      description: |
        ## Manual step for further alert investigation.
        For example, use the following opensource tool from Onapsis.

        Onapsis and Mandiant have collaborated to release an open-source tool to help SAP customers identify potential compromises related to CVE-2025-31324, a critical zero-day vulnerability in SAP NetWeaver Java systems.

        For more information, see https://github.com/Onapsis/Onapsis-Mandiant-CVE-2025-31324-Vuln-Compromise-Assessment

        **Note**: Running this script is a manual action. You are responsible for any outcomes or issues that may arise from its execution.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "35"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3526.75,
          "y": 3893
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: 8e1dca46-2813-4e91-8271-c27da304c5bb
    type: regular
    task:
      id: 8e1dca46-2813-4e91-8271-c27da304c5bb
      version: -1
      name: Close investigation
      description: Close the current alert
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "35"
    scriptarguments:
      closeReason:
        simple: No further actions are required.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3947.5,
          "y": 3893
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: 411aa6c9-926c-4230-8efe-8267b95c5b0b
    type: title
    task:
      id: 411aa6c9-926c-4230-8efe-8267b95c5b0b
      version: -1
      name: Resolution
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "34"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3727,
          "y": 3633
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "48":
    id: "48"
    taskid: 6899f7ac-62bc-4727-8dec-6bad67e56e3d
    type: regular
    task:
      id: 6899f7ac-62bc-4727-8dec-6bad67e56e3d
      version: -1
      name: Link indicators to alert
      description: commands.local.cmd.associate.indicators
      script: Builtin|||associateIndicatorsToAlert
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "68"
    scriptarguments:
      alertId:
        simple: ${alert.id}
      indicatorsValues:
        complex:
          root: ExtractedIndicators.IP
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: ExtractedIndicators.IP
                iscontext: true
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.Domain
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.URL
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.CVE
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.File
                iscontext: true
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2771,
          "y": 2330
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "51":
    id: "51"
    taskid: 7ef7f298-2a61-4024-86cd-24a83a93663a
    type: regular
    task:
      id: 7ef7f298-2a61-4024-86cd-24a83a93663a
      version: -1
      name: Tag File indicators
      description: commands.local.cmd.new.indicator
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      retry-count:
        simple: "3"
      retry-interval:
        simple: "2"
      tags:
        simple: CVE-2025-31324
      type:
        simple: File
      value:
        complex:
          root: ExtractedIndicators.File
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: ExtractedIndicators.File
                iscontext: true
          transformers:
          - operator: uniq
      verdict:
        simple: Malicious
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3356.25,
          "y": 2199
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "52":
    id: "52"
    taskid: 3f734eda-e58c-4d69-8f5e-2137e07f706b
    type: regular
    task:
      id: 3f734eda-e58c-4d69-8f5e-2137e07f706b
      version: -1
      name: Tag Domain indicators
      description: commands.local.cmd.new.indicator
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      retry-count:
        simple: "3"
      retry-interval:
        simple: "2"
      tags:
        simple: CVE-2025-31324
      type:
        simple: Domain
      value:
        complex:
          root: ExtractedIndicators.Domain
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: ExtractedIndicators.Domain
                iscontext: true
          transformers:
          - operator: uniq
      verdict:
        simple: Malicious
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2963.25,
          "y": 2199
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "68":
    id: "68"
    taskid: 96e944c2-92ed-4cfa-8215-34fe0f01f6a7
    type: title
    task:
      id: 96e944c2-92ed-4cfa-8215-34fe0f01f6a7
      version: -1
      name: Threat Hunting
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "98"
      - "71"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2771,
          "y": 2470
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "71":
    id: "71"
    taskid: 89ede6a5-c5f9-48d7-86ea-4a72c232c20e
    type: playbook
    task:
      id: 89ede6a5-c5f9-48d7-86ea-4a72c232c20e
      version: -1
      name: Panorama Query Logs for Related Session
      description: 'Query Panorama Logs of types: traffic, threat, url, data-filtering and wildfire.'
      playbookName: Panorama Query Logs
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "28"
    scriptarguments:
      log_type:
        simple: threat
      query:
        simple: '(threatid eq 96181) '
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 2551.5,
          "y": 2594
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "72":
    id: "72"
    taskid: 9475991d-f634-4ade-8d31-d7cd49cb7cc8
    type: condition
    task:
      id: 9475991d-f634-4ade-8d31-d7cd49cb7cc8
      version: -1
      name: Are there any compromised hosts?
      description: Are there any compromised hosts?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "15"
      "yes":
      - "73"
      - "81"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: alert.agentsid
            iscontext: true
          right:
            value: {}
        - operator: isNotEmpty
          left:
            value:
              simple: alert.agentid
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4191.5,
          "y": 1412
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "73":
    id: "73"
    taskid: 5a2859eb-c13b-4620-80d4-d95db0b2ee0f
    type: title
    task:
      id: 5a2859eb-c13b-4620-80d4-d95db0b2ee0f
      version: -1
      name: WebShell XQL Hunt
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "75"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4191.5,
          "y": 1620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "74":
    id: "74"
    taskid: f254bdab-5bdf-41a4-86a7-da6f5c55e43c
    type: regular
    task:
      id: f254bdab-5bdf-41a4-86a7-da6f5c55e43c
      version: -1
      name: XQL Query - Search possible webshells
      description: |-
        Execute an XQL query and retrieve results of an executed XQL query API. The command will be executed every 10 seconds until results are retrieved or until a timeout error is raised.
        When more than 1000 results are retrieved, the command will return a compressed gzipped JSON format file,
        unless the argument 'parse_result_file_to_context' is set to true and then the results will be extracted to the context.
      script: '|||xdr-xql-generic-query'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "94"
    scriptarguments:
      extend-context:
        simple: XQLPossibleMaliciousFiles=
      ignore-outputs:
        simple: "true"
      max_fields:
        simple: "100"
      query:
        simple: |-
          config case_sensitive = false timeframe=7d
          | dataset = xdr_data
          | filter event_type = ENUM.FILE and event_sub_type in (ENUM.FILE_WRITE, ENUM.FILE_CREATE_NEW, ENUM.FILE_RENAME, ENUM.FILE_REMOVE)
          | filter lowercase(action_file_extension) in ("jsp","class","jar","jspx","war","jnlp") and lowercase(action_file_path) contains  "\servlet_jsp\irj\" | fields agent_id,agent_hostname,action_file_path | dedup action_file_path
      query_name:
        simple: Check for possibles malicious payload
      time_frame:
        simple: 7 days ago
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3770.75,
          "y": 2199
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "75":
    id: "75"
    taskid: bbe3309a-40a6-4d9d-81bd-c85d2a61e733
    type: condition
    task:
      id: bbe3309a-40a6-4d9d-81bd-c85d2a61e733
      version: -1
      name: Is the integration of 'XQL Query Engine' available?
      description: Returns 'yes' if integration brand 'XQL Query Engine' is available. Otherwise returns 'no'.
      scriptName: IsIntegrationAvailable
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "97"
      "yes":
      - "77"
    scriptarguments:
      brandname:
        simple: XQL Query Engine
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4191.5,
          "y": 1720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "77":
    id: "77"
    taskid: 8f40a7be-78d7-4e78-8c78-4040101898f1
    type: regular
    task:
      id: 8f40a7be-78d7-4e78-8c78-4040101898f1
      version: -1
      name: Check XQL quota
      description: Retrieve the amount of query quota available and used.
      script: '|||xdr-xql-get-quota'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "78"
    scriptarguments:
      extend-context:
        simple: PaloAltoNetworksXQL.Quota2=
      ignore-outputs:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3770.75,
          "y": 1913
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "78":
    id: "78"
    taskid: 1343d86f-3c87-4385-84ca-fbd832b4addf
    type: condition
    task:
      id: 1343d86f-3c87-4385-84ca-fbd832b4addf
      version: -1
      name: Is there enough quota?
      description: Is there enough quota?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "79"
      "yes":
      - "74"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: greaterThanOrEqual
          left:
            value:
              complex:
                root: PaloAltoNetworksXQL.Quota2
                accessor: license_quota
                transformers:
                - operator: LastArrayElement
                - operator: subtraction
                  args:
                    by:
                      value:
                        simple: PaloAltoNetworksXQL.Quota2.used_quota
                      iscontext: true
            iscontext: true
          right:
            value:
              simple: "1"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3770.75,
          "y": 2050
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "79":
    id: "79"
    taskid: 5607d483-8ee1-4c36-8774-2cdb26a587b4
    type: regular
    task:
      id: 5607d483-8ee1-4c36-8774-2cdb26a587b4
      version: -1
      name: 'Manual – Search webshells using XQL query and quarantine the files'
      description: |-
        Dear Analyst,

        Ensure that the 'XQL Query Engine' integration is active. If it's not enabled, activate the integration or manually run the following XQL query to determine if any webshells have been downloaded.

        Query:

        config case_sensitive = false timeframe=7d
        | dataset = xdr_data
        | filter event_type = ENUM.FILE and event_sub_type in (ENUM.FILE_WRITE, ENUM.FILE_CREATE_NEW, ENUM.FILE_RENAME, ENUM.FILE_REMOVE)
        | filter lowercase(action_file_extension) in ("jsp","class","jar","jspx","war","jnlp") and lowercase(action_file_path) contains  "\servlet_jsp\irj\" | fields agent_id,agent_hostname,action_file_path | dedup action_file_path

        If the query output indicates on possible activity with file/s, investigate those files and quarantine/remove them per your need.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "97"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4191.5,
          "y": 2199
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "81":
    id: "81"
    taskid: 3d6cc7de-d2d2-4cbd-872c-c9dd98d31f1e
    type: title
    task:
      id: 3d6cc7de-d2d2-4cbd-872c-c9dd98d31f1e
      version: -1
      name: Potential Webshells via Script
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "105"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4605.5,
          "y": 1615
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "84":
    id: "84"
    taskid: bf4c0006-2aa7-416d-88e2-0344416f685f
    type: playbook
    task:
      id: bf4c0006-2aa7-416d-88e2-0344416f685f
      version: -1
      name: Containment Plan - Block Indicators
      description: |-
        ## Containment Plan - Block Indicators

        This playbook is a sub-playbook within the containment plan playbook.

        ### Indicator Blocking

        The playbook block indicators by two methods:

        1. It adds the malicious hashes into the XSIAM hash block list
        2. It utilizes the sub-playbook "Block Indicators - Generic v3"
      playbookName: Containment Plan - Block Indicators
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      AutoBlockIndicators:
        simple: "True"
      AutoContainment:
        simple: "True"
      BlockIndicators:
        simple: "True"
      Domain:
        complex:
          root: ExtractedIndicators
          accessor: Domain
          transformers:
          - operator: uniq
      FileHash:
        complex:
          root: ExtractedIndicators.File
          filters:
          - - operator: stringHasLength
              left:
                value:
                  simple: ExtractedIndicators.File
                iscontext: true
              right:
                value:
                  simple: "64"
          transformers:
          - operator: uniq
      IP:
        complex:
          root: ExtractedIndicators
          accessor: IP
          transformers:
          - operator: uniq
      URL:
        complex:
          root: ExtractedIndicators
          accessor: URL
          transformers:
          - operator: uniq
      UserVerification:
        simple: "False"
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 3526.75,
          "y": 2898
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "87":
    id: "87"
    taskid: 6ee5a586-06e3-41ff-878a-c4e20c1b1001
    type: regular
    task:
      id: 6ee5a586-06e3-41ff-878a-c4e20c1b1001
      version: -1
      name: Mitigation Actions
      description: "# Suggested Mitigation Steps\n\n## Patch Recommendations For SAP Visual Composer: \n\n[See the Onapsis blog](https://onapsis.com/blog/active-exploitation-of-sap-vulnerability-cve-2025-31324/)\n\n\n#### Go to the following link to download and patch your SAP product according to the vendor's advisory:  \n[SAP Security Note #3594142](https://me.sap.com/notes/3594142)\n\n#### For more information about SAP's FAQ:\n[SAP Note #3596125](https://me.sap.com/notes/3596125/E)\n\n#### For workaround mitigation steps for customers that cannot apply the patch, see:\n[SAP Note #3593336](https://me.sap.com/notes/3593336/E)\n\n\n## Sigma Rules:\n**Note**\nThe Sigma rules are not yet merged into the public repository. You can browse and apply them from this Pull Request: \nhttps://github.com/SigmaHQ/sigma/pull/5387/files\n\n\n## You can implement the following YARA rule: \n\n[Link to the blog for this Yara rule](https://onapsis.com/blog/active-exploitation-of-sap-vulnerability-cve-2025-31324/)\n\nrule detect_CVE202531324_webshells_by_name\n`{\n    meta:\n        description = “Detects the known webshell file names that are uploaded in the root directory”\n        author = “Emanuela Ionas, Onapsis Research Labs”\n        date = “2025-05-05”\n        tags = “CVE-2025-31324”\n    strings:\n        $webshell_1 = “/irj/cache.jsp” nocase\n        $webshell_2 = “/irj/helper.jsp” nocase\n        $webshell_3 = “/irj/forwardsap.jsp” nocase\n        $webshell_4 = “/irj/coresap.jsp” nocase\n        $webshell_5 = “/irj/webhelp.jsp” nocase\n        $webshell_6 = “/irj/.webhelper.jsp” nocase\n        $webshell_7 = “/irj/usage.jsp” nocase\n        $webshell_8 = “/irj/usage1.jsp” nocase\n        $webshell_9 = “/irj/404_error.jsp” nocase\n        $webshell_10 = “/irj/.h.jsp” nocase\n        $webshell_regex = /\\/irj\\/[._a-zA-Z0-9]{2,10}\\.jsp/\n        $status = /HTTP\\/[12]\\.[012]\\s+200/\n    condition:\n        ($webshell_1 or $webshell_2 or $webshell_3 or $webshell_4 or $webshell_5 or $webshell_6 or $webshell_7 or $webshell_8 or $webshell_9 or $webshell_10 or $webshell_regex) and $status\n}`\n\n## Monitor Creation of Suspicious Files with XQL: \nUse the following XQL to identify any suspicious activity created \n\n``` config case_sensitive = false timeframe=30d\n| dataset = xdr_data\n| filter event_type = ENUM.FILE and event_sub_type in (ENUM.FILE_WRITE, ENUM.FILE_CREATE_NEW, ENUM.FILE_RENAME, ENUM.FILE_REMOVE)\n| filter lowercase(action_file_extension) in (\"jsp\",\"class\",\"jar\",\"jspx\",\"war\",\"jnlp\") and lowercase(action_file_path) contains  \"\\servlet_jsp\\irj\\\" ```"
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "38"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3526.75,
          "y": 3342
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "89":
    id: "89"
    taskid: 77b00c97-e61b-4d1e-8c37-34357f6b9317
    type: regular
    task:
      id: 77b00c97-e61b-4d1e-8c37-34357f6b9317
      version: -1
      name: Get script results
      description: Retrieve the results of a script execution action.
      script: '|||core-get-script-execution-results'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "90"
    scriptarguments:
      action_id:
        simple: ${Core.ScriptRun.action_id}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4872.5,
          "y": 2215
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "90":
    id: "90"
    taskid: 84192770-41d9-494d-8cca-4b9948f2fa91
    type: regular
    task:
      id: 84192770-41d9-494d-8cca-4b9948f2fa91
      version: -1
      name: Extract the script's potential files
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "97"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Potential_suspicious_files
      value:
        complex:
          root: Core.ScriptResult.results
          accessor: standard_output
          transformers:
          - operator: toLowerCase
          - operator: RegexExtractAll
            args:
              error_if_no_match: {}
              ignore_case: {}
              multi_line: {}
              period_matches_newline: {}
              regex:
                value:
                  simple: \b([^\s\\/]+?\.(?:jsp|class|jar|jspx|war|jnlp))\b
              unpack_matches:
                value:
                  simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4872.5,
          "y": 2359
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "92":
    id: "92"
    taskid: 1985ddc1-db57-45fd-86bf-870259bfcb62
    type: regular
    task:
      id: 1985ddc1-db57-45fd-86bf-870259bfcb62
      version: -1
      name: Set agent IDs to alert context
      description: commands.local.cmd.set.incident
      script: Builtin|||setAlert
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      agentsid:
        simple: ${PaloAltoNetworksXQL.GenericQuery.results.agent_id}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2975.25,
          "y": 899
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "93":
    id: "93"
    taskid: e8a258db-6e29-44c7-8d1c-c0c86c3aa104
    type: condition
    task:
      id: e8a258db-6e29-44c7-8d1c-c0c86c3aa104
      version: -1
      name: Are there any potential webshells found?
      description: Are there any potential WebShells found?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "31"
      "yes":
      - "95"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: Potential_suspicious_files
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3926.5,
          "y": 2898
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "94":
    id: "94"
    taskid: 9dfb59b7-5298-4c27-8a95-d324912f5c31
    type: regular
    task:
      id: 9dfb59b7-5298-4c27-8a95-d324912f5c31
      version: -1
      name: Set potential files paths
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "97"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Potential_suspicious_files
      value:
        simple: ${XQLPossibleMaliciousFiles.results.action_file_path}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3770.75,
          "y": 2460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "95":
    id: "95"
    taskid: 5fed7b8d-31e9-425e-86a5-fa6dfdda1390
    type: regular
    task:
      id: 5fed7b8d-31e9-425e-86a5-fa6dfdda1390
      version: -1
      name: Manual Action - Quarantine
      description: "As a part of the playbook, we have determined potential webshells that might be in the same directory *\"...servlet_jsp\\irj\\....\"*.\nSince we can't determine with strong confidence that those files are webshells, we suggest that you investigate them and quarantine as needed. \n\nList of files:\n${Potential_suspicious_files}\n\nList of agent IDs:\n${alert.agentid}\n${alert.agentsid}"
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "31"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4136,
          "y": 3074
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "96":
    id: "96"
    taskid: 7a2c4fab-3c0c-4eb9-ae58-dc7f672e1c53
    type: condition
    task:
      id: 7a2c4fab-3c0c-4eb9-ae58-dc7f672e1c53
      version: -1
      name: Is there a file path?
      description: Is there a alert.filepath in context data.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "97"
      "yes":
      - "106"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: Core.DynamicAnalysis.internals.attributes.file_path
            iscontext: true
          right:
            value: {}
      - - operator: containsGeneral
          left:
            value:
              simple: alert.hostos
            iscontext: true
          right:
            value:
              simple: windows
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4605.5,
          "y": 1880
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "97":
    id: "97"
    taskid: a6e3ff59-61f2-4274-8617-0a61186d9995
    type: title
    task:
      id: a6e3ff59-61f2-4274-8617-0a61186d9995
      version: -1
      name: Finished Analysis
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "28"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4605.5,
          "y": 2599
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "98":
    id: "98"
    taskid: 026ae6ff-613d-4ed5-8451-76d735bab7ca
    type: playbook
    task:
      id: 026ae6ff-613d-4ed5-8451-76d735bab7ca
      version: -1
      name: Threat Hunting - Generic
      description: "This playbook enables threat hunting for IOCs in your enterprise. It currently supports the following integrations: \n- Splunk\n- Qradar\n- Pan-os \n- Cortex Data Lake \n- Autofocus\n- Microsoft 365 Defender"
      playbookName: Threat Hunting - Generic
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "28"
    scriptarguments:
      IPAddress:
        complex:
          root: ExtractedIndicators
          accessor: IP
          transformers:
          - operator: uniq
      InternalRange:
        complex:
          root: lists
          accessor: PrivateIPs
          transformers:
          - operator: RegexExtractAll
            args:
              error_if_no_match: {}
              ignore_case: {}
              multi_line: {}
              period_matches_newline: {}
              regex:
                value:
                  simple: (\b(?:\d{1,3}\.){3}\d{1,3}\b/\d{1,2})
              unpack_matches: {}
          - operator: join
            args:
              separator:
                value:
                  simple: ','
      QRadarTimeFrame:
        simple: ${inputs.QRadarTimeRange}
      SHA256:
        complex:
          root: ExtractedIndicators.File
          filters:
          - - operator: hasLength
              left:
                value:
                  simple: ExtractedIndicators.File
                iscontext: true
              right:
                value:
                  simple: "64"
          transformers:
          - operator: uniq
      SplunkEarliestTime:
        simple: ${inputs.SplunkEarliestTime}
      SplunkLatestTime:
        simple: ${inputs.SplunkLatestTime}
      URLDomain:
        complex:
          root: ExtractedIndicators
          accessor: URL
          transformers:
          - operator: AppendIfNotEmpty
            args:
              item:
                value:
                  simple: ExtractedIndicators.Domain
                iscontext: true
              raw: {}
          - operator: uniq
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 3001,
          "y": 2594
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "99":
    id: "99"
    taskid: b9f9f1a6-c33b-4df9-83cc-aaba859f1fa7
    type: condition
    task:
      id: b9f9f1a6-c33b-4df9-83cc-aaba859f1fa7
      version: -1
      name: Any results from threat hunting?
      description: Any results from Threat Hunting?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "38"
      "yes":
      - "102"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: Splunk
            iscontext: true
          right:
            value: {}
        - operator: isNotEmpty
          left:
            value:
              simple: PANWHunting
            iscontext: true
        - operator: isNotEmpty
          left:
            value:
              simple: QRadar
            iscontext: true
        - operator: isNotEmpty
          left:
            value:
              simple: Microsoft365Defender
            iscontext: true
        - operator: isNotEmpty
          left:
            value:
              simple: Panorama.Monitor.Logs
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3947.5,
          "y": 3342
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "102":
    id: "102"
    taskid: d81f81a5-4a1f-478a-836f-6eca246eb675
    type: regular
    task:
      id: d81f81a5-4a1f-478a-836f-6eca246eb675
      version: -1
      name: Review threat hunting results
      description: Review the Threat Hunting - Generic playbook outputs and take appropriate action.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "38"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4136,
          "y": 3499
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "103":
    id: "103"
    taskid: 825e14e4-5be0-45a2-8789-379b96e2c027
    type: collection
    task:
      id: 825e14e4-5be0-45a2-8789-379b96e2c027
      version: -1
      name: Any results from the manual XQL?
      description: Any results from the manual XQL?
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "104"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3702.25,
          "y": 764
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
        simple: Are there any SAP NetWeaver Visual Composer instances in your env?
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
      replyOptions:
      - "Yes"
      - "No"
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: Please provide the agent IDs for those machines. If you have multiple endpoints, enter them as comma-separated values.
        required: false
        gridcolumns: []
        defaultrows: []
        type: shortText
        options: []
        optionsarg:
        - simple: "Yes"
        - simple: "No"
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      title: Have you find any instances of SAP NetWaver?
      description: ""
      sender: ""
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "104":
    id: "104"
    taskid: 5a8c8538-1bfe-4af8-8fe6-e92e877af4eb
    type: regular
    task:
      id: 5a8c8538-1bfe-4af8-8fe6-e92e877af4eb
      version: -1
      name: Set agent IDs to alert context
      description: commands.local.cmd.set.incident
      script: Builtin|||setAlert
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      agentsid:
        complex:
          root: Have you find any instances of SAP NetWaver?.Answers
          accessor: "0"
          transformers:
          - operator: split
            args:
              delimiter:
                value:
                  simple: ','
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3702.25,
          "y": 882
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "105":
    id: "105"
    taskid: af41ea1e-ba5f-4e4a-abe7-770e2872c306
    type: regular
    task:
      id: af41ea1e-ba5f-4e4a-abe7-770e2872c306
      version: -1
      name: Get alert's extra data
      description: Returns dynamic analysis of each alert ID.
      script: '|||core-get-dynamic-analysis'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "96"
    scriptarguments:
      alert_ids:
        simple: ${alert.id}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4605.5,
          "y": 1740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "106":
    id: "106"
    taskid: 106e9612-7d10-4cba-98d0-3544cbc10831
    type: regular
    task:
      id: 106e9612-7d10-4cba-98d0-3544cbc10831
      version: -1
      name: Check for any other files in that directory
      description: Initiate a new endpoint script execution of shell commands.
      script: '|||core-run-script-execute-commands'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "89"
    scriptarguments:
      commands:
        complex:
          root: Core.DynamicAnalysis.internals.attributes.file_path
          filters:
          - - operator: containsGeneral
              left:
                value:
                  simple: Core.DynamicAnalysis.internals.attributes.file_path
                iscontext: true
              right:
                value:
                  simple: \servlet_jsp\irj\
          transformers:
          - operator: RegexExtractAll
            args:
              error_if_no_match: {}
              ignore_case: {}
              multi_line: {}
              period_matches_newline: {}
              regex:
                value:
                  simple: ^(.*\\)[^\\]+$
              unpack_matches: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'dir '
              suffix: {}
      endpoint_ids:
        complex:
          root: alert
          accessor: agentid
          transformers:
          - operator: AppendIfNotEmpty
            args:
              item:
                value:
                  simple: alert.agentsid
                iscontext: true
              raw: {}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4872.5,
          "y": 2082
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 4436,
        "width": 3070.25,
        "x": 2183.25,
        "y": -350
      }
    }
  }
inputs:
- key: SplunkEarliestTime
  value:
    simple: -7d@d
  required: false
  description: The earliest time for Splunk query.
  playbookInputQuery:
- key: SplunkLatestTime
  value:
    simple: now
  required: false
  description: The latest time for the Splunk search query.
  playbookInputQuery:
- key: QRadarTimeRange
  value:
    simple: Last 7 DAYS
  required: false
  description: The time range for QRadar query.
  playbookInputQuery:
inputSections:
- inputs:
  - SplunkEarliestTime
  - SplunkLatestTime
  - QRadarTimeRange
  name: General (Inputs group)
  description: Generic group for inputs
outputSections:
- outputs: []
  name: General (Outputs group)
  description: Generic group for outputs
outputs: []
tests:
- No tests (auto formatted)
fromversion: 8.9.0
