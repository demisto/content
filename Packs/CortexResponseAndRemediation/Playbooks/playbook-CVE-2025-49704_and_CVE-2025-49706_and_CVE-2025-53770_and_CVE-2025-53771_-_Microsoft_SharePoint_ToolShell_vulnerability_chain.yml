id: CVE-2025-49704 and CVE-2025-49706 and CVE-2025-53770 and CVE-2025-53771 - Microsoft SharePoint ToolShell vulnerability chain
version: -1
name: CVE-2025-49704 and CVE-2025-49706 and CVE-2025-53770 and CVE-2025-53771 - Microsoft SharePoint ToolShell vulnerability chain
description: "CVE-2025-49706 and CVE-2025-49704 and CVE-2025-53770 and CVE-2025-53771 — Microsoft SharePoint Identity Spoofing & RCE Chain - ToolShell\n\n---\n\nCVE-2025-49704, CVE-2025-49706, CVE-2025-53770, and CVE-2025-53771 are a set of vulnerabilities that impact Microsoft SharePoint. CVE-2025-49704 and CVE-2025-49706, or CVE-2025-53770 and CVE-2025-53771, may be chained together, allowing unauthenticated threat actors to access functionality that is normally restricted, to run arbitrary commands on vulnerable instances of Microsoft SharePoint.\n\n### Vulnerability Overview\n\n* **Platform Affected**: Microsoft SharePoint Server 2016 / 2019 / Subscription Edition\n* **CVE IDs**:\n  * CVE-2025-49706 – Improper authentication in Microsoft Office SharePoint allows an authorized attacker to perform spoofing over a network.\t\n  * CVE-2025-49704 – Improper control of generation of code ('code injection') in Microsoft Office SharePoint allows an authorized attacker to execute code over a network.\n  * CVE-2025-53770 – Deserialization of untrusted data in on-premises Microsoft SharePoint Server allows an unauthorized attacker to execute code over a network.\t\n  * CVE-2025-53771 – Improper limitation of a pathname to a restricted directory (path traversal) in Microsoft Office SharePoint allows an authorized attacker to perform spoofing over a network.\t\n\n* **CVSS Scores**: 7.1, 8.8, 9.8 ,7.1\n\n* **Impact**:When chained together, they allow an attacker to run arbitrary commands on vulnerable instances of Microsoft SharePoint.\n\nThese flaws enable an attacker to:\n- Spoof authentication\n- Bypass security boundaries\n- Gain remote execution\n\n\n### Mitigation & Recommendations\n\n* Apply Patches Immediately:\n  * [CVE-2025-49706](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-49706)\n  * [CVE-2025-49704](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-49704)\n  * [CVE-2025-53770](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-53770)\n  * [CVE-2025-53771](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-53771)\n\n* Harden SharePoint diagnostic/debug endpoints\n* Rotate SharePoint Server ASP.NET machine keys\n* Check IIS logs for suspicious activity\n* Disable/Isolate unnecessary SharePoint services or endpoints (at least until those servers are patched)\n\n---\n\n### References\n\n* [CVE-2025-49706 - NVD](https://nvd.nist.gov/vuln/detail/CVE-2025-49706)\n* [CVE-2025-49704 - NVD](https://nvd.nist.gov/vuln/detail/CVE-2025-49704)\n* [CVE-2025-53770 - NVD](https://nvd.nist.gov/vuln/detail/CVE-2025-53770)\n* [CVE-2025-53771 - NVD](https://nvd.nist.gov/vuln/detail/CVE-2025-53771)\n* [Microsoft Security Update – July 2025](https://msrc.microsoft.com/update-guide/)\n* [Unit42 Blog](https://unit42.paloaltonetworks.com/microsoft-sharepoint-cve-2025-49704-cve-2025-49706-cve-2025-53770/)\n\n---\n\n### How to trigger the playbook\n\nTriggered via:\n- Cortex XDR alerts: `\"CVE Exploitation - 685768089\"` or `\"CVE Exploitation - 818854253\"` or `\"CVE Exploitation - 903162508\"`\n- Manual creation of an incident with this playbook.\n\n---\n\n### Playbook Flow\n\n1. Run XQL Queries to detect possible affected servers running Microsoft SharePoint.\n2. Search for downloaded or created webshell files using XQL (especially for the known file name artifacts).\n3. Run XQL on network events and XDR .net events to determine if there was any usage of the CVEs in the organization.\n4. Check for malicious activity on the possible affected hosts for post-exploitation activities (such as running PowerShell encoded commands on the hosts) via additional alerts on the same host.\n5. Retrieve  IOCs from the Unit42 blog, hunt for those IOCs with XQL, and block malicious indicators.\n6. Instruct the analyst on relevant response actions and mitigation steps.\n\n---\n\n**Note:** \nThis is a beta playbook. Updates to the pack during the beta phase might include non-backward-compatible features. We appreciate your feedback on the quality and usability of the pack to help us identify issues, fix them, and continually improve.\n"
tags:
- Rapid Breach Response
- CVE-2025-49704
- CVE-2025-49706
- CVE-2025-53771
- CVE-2025-53770
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 4f736e78-7eb6-41fa-81ed-bbeca58eacae
    type: start
    task:
      id: 4f736e78-7eb6-41fa-81ed-bbeca58eacae
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "26"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3710,
          "y": -327
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: f73cab89-9c95-473f-8930-57b5536fef2b
    type: regular
    task:
      id: f73cab89-9c95-473f-8930-57b5536fef2b
      version: -1
      name: XQL Query - Search for any SharePoint servers that might be vulnerable
      description: |-
        Execute an XQL query and retrieve results of an executed XQL query API. The command will be executed every 10 seconds until results are retrieved or until a timeout error is raised.
        When more than 1000 results are retrieved, the command will return a compressed gzipped JSON format file,
        unless the argument 'parse_result_file_to_context' is set to true and then the results will be extracted to the context.
      script: '|||xdr-xql-generic-query'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#error#':
      - "2"
      '#none#':
      - "4"
    scriptarguments:
      extend-context:
        simple: PossibleSPServers=
      ignore-outputs:
        simple: "true"
      max_fields:
        simple: "100"
      query:
        simple: "config timeframe = 7d case_sensitive = false \n| dataset = xdr_data \n| filter event_type = ENUM.LOAD_IMAGE and event_sub_type = ENUM.LOAD_IMAGE_MODULE and (action_file_path contains \"Program Files\\Common Files\\microsoft shared\\Web Server Extensions\\*\" or actor_process_image_path contains \"Program Files\\Common Files\\microsoft shared\\Web Server Extensions\\*\" or causality_actor_process_image_path contains \"Program Files\\Common Files\\microsoft shared\\Web Server Extensions\\*\" or event_thread_context contains \"Program Files\\Common Files\\microsoft shared\\Web Server Extensions\\*\")\n| fields agent_id\n| dedup agent_id"
      query_name:
        simple: Search for any SharePoint servers that might be vulnerable
      time_frame:
        simple: 1 week ago
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": 3185,
          "y": 547
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: 3df0597e-b22e-49e9-867a-98afae4ea2f6
    type: regular
    task:
      id: 3df0597e-b22e-49e9-867a-98afae4ea2f6
      version: -1
      name: Manual – Search possible hosts
      description: "Dear Analyst,\n\nEnsure that the 'XQL Query Engine' integration is active. If it's not enabled, activate the integration or manually run the following XQL query to determine if any hosts are running a potentially vulnerable product.\n\nXQL Query:\n\n```config timeframe = 7d case_sensitive = false \ndataset = xdr_data \n| filter event_type = ENUM.LOAD_IMAGE and event_sub_type = ENUM.LOAD_IMAGE_MODULE and (action_file_path contains \"Program Files\\Common Files\\microsoft shared\\Web Server Extensions\\*\" or actor_process_image_path contains \"Program Files\\Common Files\\microsoft shared\\Web Server Extensions\\*\" or causality_actor_process_image_path contains \"Program Files\\Common Files\\microsoft shared\\Web Server Extensions\\*\" or event_thread_context contains \"Program Files\\Common Files\\microsoft shared\\Web Server Extensions\\*\")\n| fields agent_id\n| dedup agent_id ```\n\n-------\n\nOptional check using Beta PowerShell script ( on dedicated machines ):\n\n``` function Get-SharePointVulnStatus {\n    $farmVersion = (Get-SPFarm).BuildVersion\n    Write-Output \"Detected SharePoint Build: $farmVersion\"\n\n    if (($farmVersion.Major -eq 16) -and ($farmVersion.Minor -eq 0)) {\n        $build = $farmVersion.Build\n        $revision = $farmVersion.Revision\n\n        if (\n            ($build -lt 5508) -or\n            ($build -eq 5508 -and $revision -lt 1000)\n        ) {\n            Write-Output \"❌ SharePoint 2016 is vulnerable to CVE-2025-49704/49706\"\n        }\n        elseif (\n            ($build -lt 10417) -or\n            ($build -eq 10417 -and $revision -lt 20027)\n        ) {\n            Write-Output \"❌ SharePoint 2019 is vulnerable to CVE-2025-49704/49706\"\n        }\n        elseif ($build -lt 18526) {\n            Write-Output \"❌ SharePoint SE may be vulnerable (check July 2025 patch level)\"\n        }\n        else {\n            Write-Output \"✅ SharePoint appears patched\"\n        }\n    } else {\n        Write-Output \"⚠️ Unknown SharePoint version or product\"\n    }\n}\nGet-SharePointVulnStatus ```"
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "103"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3710,
          "y": 701
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: 4b4d51d5-6185-4ad7-8470-7c3e42f75484
    type: condition
    task:
      id: 4b4d51d5-6185-4ad7-8470-7c3e42f75484
      version: -1
      name: Is the integration of 'XQL Query Engine' available?
      description: Returns 'yes' if integration brand 'XQL Query Engine' is available. Otherwise returns 'no'.
      scriptName: IsIntegrationAvailable
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "2"
      "yes":
      - "5"
    scriptarguments:
      brandname:
        simple: XQL Query Engine
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3710,
          "y": 104
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: 62a6f908-e713-4724-8789-9a88b2ca6ec2
    type: condition
    task:
      id: 62a6f908-e713-4724-8789-9a88b2ca6ec2
      version: -1
      name: Any results from XQL?
      description: Any results from the XQL Query?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "9"
      "yes":
      - "92"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: PossibleSPServers.results.agent_id
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3185,
          "y": 701
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: 856e6639-a55f-4516-9942-25f6a2891080
    type: regular
    task:
      id: 856e6639-a55f-4516-9942-25f6a2891080
      version: -1
      name: Check XQL Quota
      description: Retrieve the amount of query quota available and used.
      script: '|||xdr-xql-get-quota'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "6"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3331.25,
          "y": 228
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: 0d9f5369-c673-4281-8f9d-5b918c3a7451
    type: condition
    task:
      id: 0d9f5369-c673-4281-8f9d-5b918c3a7451
      version: -1
      name: Is there enough quota?
      description: Check if there is enough quota to run the query.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "2"
      "yes":
      - "1"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: greaterThanOrEqual
          left:
            value:
              complex:
                root: PaloAltoNetworksXQL.Quota
                accessor: license_quota
                transformers:
                - operator: subtraction
                  args:
                    by:
                      value:
                        simple: PaloAltoNetworksXQL.Quota.used_quota
                      iscontext: true
            iscontext: true
          right:
            value:
              simple: "1"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3331.25,
          "y": 366
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: 2fe284b9-0c28-4c81-80a2-d578b4e6fb8b
    type: title
    task:
      id: 2fe284b9-0c28-4c81-80a2-d578b4e6fb8b
      version: -1
      name: 'XQL: Identify SharePoint Instances'
      description: This section identifies Microsoft SharePoint instances.
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3710,
          "y": -21
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: 9604649d-96ad-4e7c-8b1a-00e286ce1981
    type: title
    task:
      id: 9604649d-96ad-4e7c-8b1a-00e286ce1981
      version: -1
      name: Investigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "11"
      - "12"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4191.5,
          "y": 1105
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: 0a4820ee-fc2f-4843-87b1-ee4e5e124d47
    type: title
    task:
      id: 0a4820ee-fc2f-4843-87b1-ee4e5e124d47
      version: -1
      name: Hunt For IOCs
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "15"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2771,
          "y": 1283
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: b91e46f0-2c7a-4ab9-83aa-018592b4ebbf
    type: title
    task:
      id: b91e46f0-2c7a-4ab9-83aa-018592b4ebbf
      version: -1
      name: Anlysis Endpoints
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "133"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4191.5,
          "y": 1223
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "15":
    id: "15"
    taskid: 239d8f48-891c-4520-88b2-47c7bf73e039
    type: title
    task:
      id: 239d8f48-891c-4520-88b2-47c7bf73e039
      version: -1
      name: Collect Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "124"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2771,
          "y": 1620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: 3d831be1-6556-4faf-88b0-2e8b481cb2eb
    type: regular
    task:
      id: 3d831be1-6556-4faf-88b0-2e8b481cb2eb
      version: -1
      name: Extract indicators from collected data
      description: commands.local.cmd.extract.indicators
      script: Builtin|||extractIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "22"
    scriptarguments:
      text:
        complex:
          root: http.parsedBlog
          accessor: indicators
          transformers:
          - operator: RemoveEmpty
            args:
              empty_values: {}
              remove_keys:
                value:
                  simple: "true"
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2771,
          "y": 1964
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: 220a4b75-0667-4734-8c12-021056d92c17
    type: title
    task:
      id: 220a4b75-0667-4734-8c12-021056d92c17
      version: -1
      name: Tag and Link Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "23"
      - "24"
      - "51"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2771,
          "y": 2090
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: 77ec9999-7fc2-4566-a32c-b7dd9f320029
    type: regular
    task:
      id: 77ec9999-7fc2-4566-a32c-b7dd9f320029
      version: -1
      name: Tag IP Indicators
      description: commands.local.cmd.new.indicator
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      retry-count:
        simple: "3"
      retry-interval:
        simple: "2"
      tags:
        simple: CVE-2025-49704,CVE-2025-49706,CVE-2025-53770,CVE-2025-53771
      type:
        simple: IP
      value:
        complex:
          root: ExtractedIndicators.IP
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: ExtractedIndicators.IP
                iscontext: true
          transformers:
          - operator: uniq
      verdict:
        simple: Malicious
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2369.25,
          "y": 2210
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: 4114e55f-237b-480b-a748-d233752ca403
    type: regular
    task:
      id: 4114e55f-237b-480b-a748-d233752ca403
      version: -1
      name: Tag CVE Indicators
      description: commands.local.cmd.new.indicator
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      retry-count:
        simple: "3"
      retry-interval:
        simple: "2"
      tags:
        simple: Microsoft SharePoint ToolShell vulnerability chain
      type:
        simple: CVE
      value:
        complex:
          root: ExtractedIndicators
          accessor: CVE
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2771,
          "y": 2210
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: 5ba25eb1-0569-482c-859b-4206b489a674
    type: title
    task:
      id: 5ba25eb1-0569-482c-859b-4206b489a674
      version: -1
      name: Extract Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "21"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2771,
          "y": 1861
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: 2a821a19-6b71-4184-8053-35864f0d4a8e
    type: condition
    task:
      id: 2a821a19-6b71-4184-8053-35864f0d4a8e
      version: -1
      name: Triggered manually or via alert?
      description: This task checks if the playbook was triggered manually or by an alert.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "7"
      Alert:
      - "27"
    separatecontext: false
    conditions:
    - label: Alert
      condition:
      - - operator: containsGeneral
          left:
            value:
              simple: alert.name
            iscontext: true
          right:
            value:
              simple: CVE Exploitation - 685768089
          ignorecase: true
        - operator: containsGeneral
          left:
            value:
              simple: alert.name
            iscontext: true
          right:
            value:
              simple: CVE Exploitation - 818854253
          ignorecase: true
        - operator: containsGeneral
          left:
            value:
              simple: alert.name
            iscontext: true
          right:
            value:
              simple: CVE Exploitation - 903162508
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3710,
          "y": -191
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: cd7d9aa4-d0ed-4e9d-8764-7037e7c5cd10
    type: title
    task:
      id: cd7d9aa4-d0ed-4e9d-8764-7037e7c5cd10
      version: -1
      name: Alert
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "9"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4191.5,
          "y": -21
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 8c57d83d-bfad-4566-88f4-e9269479223b
    type: title
    task:
      id: 8c57d83d-bfad-4566-88f4-e9269479223b
      version: -1
      name: Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "93"
      - "84"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3787,
          "y": 3418
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: 3079d164-b58b-4367-853d-bbdd8f0494ca
    type: title
    task:
      id: 3079d164-b58b-4367-853d-bbdd8f0494ca
      version: -1
      name: Mitigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "87"
      - "99"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3785,
          "y": 3836
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: 0ca14f47-39ad-49a8-acf9-74dc17f3c3cf
    type: condition
    task:
      id: 0ca14f47-39ad-49a8-acf9-74dc17f3c3cf
      version: -1
      name: Analysis Resolution - Should continue with the investigation?
      description: |+
        ## Check with the analyst to determine whether to continue the investigation.

        - Verify that Microsoft SharePoint is on the affected servers and the patches are implemented.

        - Check if the Threat Hunting steps returned results (if any).

        - Validate that there are no other affected systems, and the Potential WebShells are investigated.


      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "No":
      - "37"
      "Yes":
      - "36"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3784,
          "y": 4377
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
        simple: Do you need to continue with the investigation?
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
      replyOptions:
      - "Yes"
      - "No"
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: afc3aacb-3bcd-41c4-89e3-86037762d900
    type: title
    task:
      id: afc3aacb-3bcd-41c4-89e3-86037762d900
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3786.5,
          "y": 4658
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: c6509f02-9969-4e33-88ad-addc499c8d55
    type: regular
    task:
      id: c6509f02-9969-4e33-88ad-addc499c8d55
      version: -1
      name: Investigate Further
      description: |
        ## Manual step for further alert investigation.

        - Keep monitoring IOCs for suspicious actions.
        - Check if there are any other suspicious artifacts created with the investigated webshell and continue your investigation on them.
        - Keep monitoring for new [hot-fixes and KBs released by Microsoft](https://msrc.microsoft.com/blog/2025/07/customer-guidance-for-sharepoint-vulnerability-cve-2025-53770/) related to these CVEs.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "35"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3583.75,
          "y": 4525
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: f5964053-5bf0-44a8-ac59-64f2828f0db5
    type: regular
    task:
      id: f5964053-5bf0-44a8-ac59-64f2828f0db5
      version: -1
      name: Close Investigation
      description: Close the current alert
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "35"
    scriptarguments:
      closeReason:
        simple: No further actions are required.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4004.5,
          "y": 4525
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: 4c900ab8-62d9-4cf8-8a04-82a9b4f24176
    type: title
    task:
      id: 4c900ab8-62d9-4cf8-8a04-82a9b4f24176
      version: -1
      name: Resolution
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "34"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3784,
          "y": 4265
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "48":
    id: "48"
    taskid: 620ab941-a509-4995-92b4-b801af8105fe
    type: regular
    task:
      id: 620ab941-a509-4995-92b4-b801af8105fe
      version: -1
      name: Link Indicators to Alert
      description: commands.local.cmd.associate.indicators
      script: Builtin|||associateIndicatorsToAlert
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "68"
    scriptarguments:
      alertId:
        simple: ${alert.id}
      indicatorsValues:
        complex:
          root: ExtractedIndicators.IP
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: ExtractedIndicators.IP
                iscontext: true
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.Domain
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.URL
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.CVE
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.File
                iscontext: true
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2771,
          "y": 2341
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "51":
    id: "51"
    taskid: 071300da-06cb-47da-b42f-e1ea18947716
    type: regular
    task:
      id: 071300da-06cb-47da-b42f-e1ea18947716
      version: -1
      name: Tag File Indicators
      description: commands.local.cmd.new.indicator
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      retry-count:
        simple: "3"
      retry-interval:
        simple: "2"
      tags:
        simple: CVE-2025-49704,CVE-2025-49706,CVE-2025-53770,CVE-2025-53771
      type:
        simple: File
      value:
        complex:
          root: ExtractedIndicators.File
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: ExtractedIndicators.File
                iscontext: true
          transformers:
          - operator: uniq
      verdict:
        simple: Malicious
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3175,
          "y": 2210
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "68":
    id: "68"
    taskid: 610fa080-9091-4c33-86f3-22df5edd1693
    type: title
    task:
      id: 610fa080-9091-4c33-86f3-22df5edd1693
      version: -1
      name: Threat Hunting
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "109"
      - "138"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2771,
          "y": 2453
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "72":
    id: "72"
    taskid: 4aa746e1-a9f0-4f7b-9b74-6709e53770c1
    type: condition
    task:
      id: 4aa746e1-a9f0-4f7b-9b74-6709e53770c1
      version: -1
      name: Are there any SharePoint hosts?
      description: This task checks if any SharePoint hosts are found.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "15"
      "yes":
      - "73"
      - "114"
      - "125"
      - "134"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: agentsidstocheck
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4191.5,
          "y": 1454
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "73":
    id: "73"
    taskid: 1a7be23d-2409-42ab-a7c6-06f034429ed4
    type: title
    task:
      id: 1a7be23d-2409-42ab-a7c6-06f034429ed4
      version: -1
      name: Web Shell XQL Hunt
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "75"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4191.5,
          "y": 1620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "74":
    id: "74"
    taskid: a216e827-3659-487f-91f3-ed4418af7eeb
    type: regular
    task:
      id: a216e827-3659-487f-91f3-ed4418af7eeb
      version: -1
      name: XQL Query - Search possible web shells
      description: |-
        Execute an XQL query and retrieve results of an executed XQL query API. The command will be executed every 10 seconds until results are retrieved or until a timeout error is raised.
        When more than 1000 results are retrieved, the command will return a compressed gzipped JSON format file,
        unless the argument 'parse_result_file_to_context' is set to true and then the results will be extracted to the context.
      script: '|||xdr-xql-generic-query'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#error#':
      - "79"
      '#none#':
      - "94"
    scriptarguments:
      extend-context:
        simple: XQLPossibleMaliciousFiles=
      ignore-outputs:
        simple: "true"
      max_fields:
        simple: "100"
      query:
        simple: |-
          config case_sensitive = false timeframe=7d
          | dataset = xdr_data
          | filter agent_id in (${agentsidstocheck})
          | filter event_type = ENUM.FILE and event_sub_type in (ENUM.FILE_WRITE, ENUM.FILE_CREATE_NEW)
          | filter action_file_path contains "program files\common files\microsoft shared\web server extensions\*\template\layouts\"
          | alter is_known_exploit = if(action_file_path contains "spinstall0.aspx" or action_file_path contains "debug_dev.js" , "Yes" , "Unknown file")
          | fields agent_id,agent_hostname,action_file_path,is_known_exploit
          | dedup action_file_path
      query_name:
        simple: Check for possibles malicious payload
      time_frame:
        simple: 7 days ago
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": 4191.5,
          "y": 2285
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "75":
    id: "75"
    taskid: 91a0d16b-b0b9-4982-8072-b5ae13b75e29
    type: condition
    task:
      id: 91a0d16b-b0b9-4982-8072-b5ae13b75e29
      version: -1
      name: Is the integration of 'XQL Query Engine' available?
      description: Returns 'yes' if integration brand 'XQL Query Engine' is available. Otherwise returns 'no'.
      scriptName: IsIntegrationAvailable
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "79"
      "yes":
      - "77"
    scriptarguments:
      brandname:
        simple: XQL Query Engine
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4191.5,
          "y": 1739
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "77":
    id: "77"
    taskid: 5ae33882-f53f-4b11-b62e-db738fed5189
    type: regular
    task:
      id: 5ae33882-f53f-4b11-b62e-db738fed5189
      version: -1
      name: Check XQL Quota
      description: Retrieve the amount of query quota available and used.
      script: '|||xdr-xql-get-quota'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "78"
    scriptarguments:
      extend-context:
        simple: PaloAltoNetworksXQL.Quota2=
      ignore-outputs:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4191.5,
          "y": 1996
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "78":
    id: "78"
    taskid: dbd38e07-62c0-42c2-a259-a839720fbe5f
    type: condition
    task:
      id: dbd38e07-62c0-42c2-a259-a839720fbe5f
      version: -1
      name: Is there enough quota?
      description: Is there enough quota?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "79"
      "yes":
      - "74"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: greaterThanOrEqual
          left:
            value:
              complex:
                root: PaloAltoNetworksXQL.Quota2
                accessor: license_quota
                transformers:
                - operator: LastArrayElement
                - operator: subtraction
                  args:
                    by:
                      value:
                        simple: PaloAltoNetworksXQL.Quota2.used_quota
                      iscontext: true
            iscontext: true
          right:
            value:
              simple: "1"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4191.5,
          "y": 2120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "79":
    id: "79"
    taskid: da1885ab-386e-4c71-856b-8435d75889c5
    type: regular
    task:
      id: da1885ab-386e-4c71-856b-8435d75889c5
      version: -1
      name: Manual – Search web shells using XQL query and quarantine the files
      description: |-
        Dear Analyst,

        Ensure that the 'XQL Query Engine' integration is active. If it's not enabled, activate the integration or manually run the following XQL query to determine if any webshells have been downloaded.

        For determining if there is usage of the vulnerability on your servers, you can use the following XQL query (**ensure to enter the Agent IDs list in the right place**):

        Query:

        ```config case_sensitive = false timeframe=7d
        | dataset = xdr_data
        | filter agent_id in (${agentsidstocheck})
        | filter event_type = ENUM.FILE and event_sub_type in (ENUM.FILE_WRITE, ENUM.FILE_CREATE_NEW)
        | filter action_file_path contains "program files\common files\microsoft shared\web server extensions\*\template\layouts\"
        | alter is_known_exploit = if(action_file_path contains "spinstall0.aspx" or action_file_path contains "debug_dev.js" , "Yes" , "Unknown file")
        | fields agent_id,agent_hostname,action_file_path,is_known_exploit
        | dedup action_file_path```

        If the query output indicates possible activity with file/s, investigate those files and quarantine/remove them as needed.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "97"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3738,
          "y": 2411
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "84":
    id: "84"
    taskid: 2c9ee458-7772-4591-8535-9d9fe7b509b5
    type: playbook
    task:
      id: 2c9ee458-7772-4591-8535-9d9fe7b509b5
      version: -1
      name: Containment Plan - Block Indicators
      description: |-
        ## Containment Plan - Block Indicators

        This playbook is a sub-playbook within the containment plan playbook.

        ### Indicator Blocking

        The playbook block indicators by two methods:

        1. It adds the malicious hashes into the XSIAM hash block list
        2. It utilizes the sub-playbook "Block Indicators - Generic v3"
      playbookName: Containment Plan - Block Indicators
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      AutoBlockIndicators:
        simple: "True"
      AutoContainment:
        simple: "True"
      BlockIndicators:
        simple: "True"
      Domain:
        complex:
          root: ExtractedIndicators
          accessor: Domain
          transformers:
          - operator: uniq
      FileHash:
        complex:
          root: ExtractedIndicators.File
          filters:
          - - operator: stringHasLength
              left:
                value:
                  simple: ExtractedIndicators.File
                iscontext: true
              right:
                value:
                  simple: "64"
          transformers:
          - operator: uniq
      IP:
        complex:
          root: ExtractedIndicators
          accessor: IP
          transformers:
          - operator: uniq
      URL:
        complex:
          root: ExtractedIndicators
          accessor: URL
          transformers:
          - operator: uniq
      UserVerification:
        simple: "False"
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 3583.75,
          "y": 3530
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "87":
    id: "87"
    taskid: d98a85ad-156b-4eb7-a2ec-c18416bf0650
    type: regular
    task:
      id: d98a85ad-156b-4eb7-a2ec-c18416bf0650
      version: -1
      name: Mitigation Actions
      description: "## Suggested Mitigation Steps\n\n### Patch Recommendations For Microsoft SharePoint: \n\n**Apply Patches Immediately**\n\nNote: If any vulnerable servers are found, it is recommended to isolate them until patching is complete.\n\n  * [CVE-2025-49706](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-49706)\n  * [CVE-2025-49704](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-49704)\n  * [CVE-2025-53770](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-53770)\n* [CVE-2025-53771](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-53771)\n * [Recommendation from Microsoft regarding  CVE-2025-53770](https://msrc.microsoft.com/blog/2025/07/customer-guidance-for-sharepoint-vulnerability-cve-2025-53770/)\n\n\n#### For CVE-2025-53770, there are additional instructions that should be taken as well:\n\n**Rotate SharePoint Server ASP.NET machine keys**\n\nAfter applying the latest security updates above or enabling AMSI, it is critical that customers rotate SharePoint server ASP.NET machine keys and restart IIS on all SharePoint servers. Follow the PowerShell guidance in Improved ASP.NET view state security and key management.\n\nTo update the machine keys for a web application using PowerShell:\n\nGenerate the machine key in PowerShell using Set-SPMachineKey -WebApplication <SPWebApplicationPipeBind>.\nDeploy the machine key to the farm in PowerShell using Update-SPMachineKey -WebApplication <SPWebApplicationPipeBind>.\nAfter the rotation has completed, restart IIS on all SharePoint servers using iisreset.exe.\n\nIf you cannot enable AMSI, you will need to rotate your keys after you install the new security update.\n\n\n### Detection Rules - Snort and Sigma: \n*[Reference](https://www.reddit.com/r/cybersecurity/comments/1m4i3oi/microsoft_sharepoint_server_rce_vulnerability/)*\n\n#### Snort Rule:\n```\nalert tcp any any -> any 80 (msg:\"Possible SharePoint Deserialization Attack\"; \ncontent:\"POST\"; http_method; content:\"/_layouts/\"; http_uri; \ncontent:\"application/json\"; http_header; sid:1000001; rev:1;)\n```\n\n#### Sigma Rule:\n```\ntitle: SharePoint Deserialization Attack\nstatus: experimental\ndescription: Detects potential SharePoint deserialization attacks\nlogsource:\n    category: webserver\ndetection:\n    selection:\n        cs-method: 'POST'\n        cs-uri-stem|contains: '/_layouts/'\n        c-ip|cidr: '!10.0.0.0/8'\n    condition: selection\nfalsepositives:\n    - Legitimate SharePoint usage\nlevel: high\n```\n\n\n#### YARA\n[Find corresponding Yara rules](https://github.com/Neo23x0/signature-base/blob/master/yara/expl_sharepoint_jul25.yar)"
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "38"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3583.75,
          "y": 3974
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "92":
    id: "92"
    taskid: 0464b840-88f6-479c-94ca-86bdbe0081d5
    type: regular
    task:
      id: 0464b840-88f6-479c-94ca-86bdbe0081d5
      version: -1
      name: Set agent IDs to alert context
      description: commands.local.cmd.set.incident
      script: Builtin|||setAlert
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      agentsid:
        simple: ${PossibleSPServers.results.agent_id}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2950.25,
          "y": 823
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "93":
    id: "93"
    taskid: 786dd562-d14a-4d01-b8c5-22820e7ef18c
    type: condition
    task:
      id: 786dd562-d14a-4d01-b8c5-22820e7ef18c
      version: -1
      name: ' Are there any suspicious findings?'
      description: Check if there are any suspicious findings collected during the investigation
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "31"
      "yes":
      - "95"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: Potential_suspicious_files
            iscontext: true
          right:
            value: {}
        - operator: containsGeneral
          left:
            value:
              simple: UsedExploit
            iscontext: true
          right:
            value:
              simple: "true"
        - operator: containsGeneral
          left:
            value:
              simple: FoundAlerts
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
        - operator: containsGeneral
          left:
            value:
              simple: AlertsDetectedOnHosts
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3983.5,
          "y": 3530
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "94":
    id: "94"
    taskid: b32d4a29-90ec-465b-8d70-b73942805a8a
    type: regular
    task:
      id: b32d4a29-90ec-465b-8d70-b73942805a8a
      version: -1
      name: Set Potential File Paths
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "97"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Potential_suspicious_files
      value:
        simple: ${XQLPossibleMaliciousFiles.results.action_file_path}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4191.5,
          "y": 2411
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "95":
    id: "95"
    taskid: d536b72f-32a4-4f19-8364-24dbb7839852
    type: regular
    task:
      id: d536b72f-32a4-4f19-8364-24dbb7839852
      version: -1
      name: Manual Actions - Analyst attention required
      description: "As part of the playbook, we have identified possible malicious activity related to the above-mentioned CVEs. Therefore, we strongly suggest reviewing the finding:\n\n### Network Events \nIn this section, we provide any found of the CVEs as a part of network hunting. The list below (if there are any findings, otherwise this section remains empty):\n\n```${NetworkArtifacts.results.exploit_type}```\n```${DotNetTelemetry.results.event_thread_context}```\n\nFor more information, check the \"XQL Network Artifacts query\" task results.\n\n### Webshell Artifacts \npotential webshells (aspx) that might be in the same directory **\"/_layouts\"** or **\"/_catalogs\"**.\nSince we can't determine with strong confidence that those files are webshells, we suggest that you investigate them and quarantine as needed. For more information, check the \"XQL Query - Search possible webshells\" task results.\n\nList of files (if there are any findings; otherwise this section remains empty):\n\n```${Potential_suspicious_files}```\n\n### Suspicious activity detected on hosts\nAs part of the investigation, we've searched for malicious activity that can indicate the use of the exploit. Here is the list of alert names detected on investigated hosts (if there are any findings; otherwise this section remains empty):\n\n```${foundIncidents.name}```\n\n For more information, check the \"Search Related Alerts on Hosts\" task results.\n\n### List of agent IDs identified (If any found):\n```${agentsidstocheck}```\n\n**Recommended action: Isolate vulnerable servers until patching is complete.**"
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "31"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4191.5,
          "y": 3706
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "97":
    id: "97"
    taskid: 37965d1e-34ff-43f9-80bf-765d9f22045b
    type: title
    task:
      id: 37965d1e-34ff-43f9-80bf-765d9f22045b
      version: -1
      name: Finished Analysis
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "28"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4405,
          "y": 2980
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "99":
    id: "99"
    taskid: 49e13f14-377f-4110-a19c-fa25550ca6e7
    type: condition
    task:
      id: 49e13f14-377f-4110-a19c-fa25550ca6e7
      version: -1
      name: Any results from threat hunting?
      description: Any results from Threat Hunting?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "38"
      "yes":
      - "102"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: containsGeneral
          left:
            value:
              simple: IOCFound
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
        - operator: isNotEmpty
          left:
            value:
              simple: Panorama.Monitor.Logs.ID
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4004.5,
          "y": 3974
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "102":
    id: "102"
    taskid: cedc02c4-8037-4c49-bd8a-6ceb7d42f5ba
    type: regular
    task:
      id: cedc02c4-8037-4c49-bd8a-6ceb7d42f5ba
      version: -1
      name: Review Threat Hunting Results
      description: "As part of our IOC hunting, we've identified results that need your attention:\nThe results can be found in the Context under `HuntIOCs.Results` key \nor check the results of the task - \"XQL Query - IOCs Hunt\"\n"
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "38"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4191.5,
          "y": 4119
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "103":
    id: "103"
    taskid: 725bd9cd-1e8c-449b-aeda-a19e42edbf99
    type: collection
    task:
      id: 725bd9cd-1e8c-449b-aeda-a19e42edbf99
      version: -1
      name: Any results from the manual XQL?
      description: Display any results from the manual XQL query.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "104"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3710,
          "y": 823
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body: {}
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
      replyOptions:
      - "Yes"
      - "No"
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: Provide the agent IDs for those machines. If you have multiple endpoints, enter them as comma-separated values.
        required: false
        gridcolumns: []
        defaultrows: []
        type: shortText
        options: []
        optionsarg:
        - simple: "Yes"
        - simple: "No"
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      title: Have you found any SharePoint servers that might be vulnerable?
      description: ""
      sender: ""
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "104":
    id: "104"
    taskid: a5c0d724-0f8d-42d1-8891-b768f330bc55
    type: regular
    task:
      id: a5c0d724-0f8d-42d1-8891-b768f330bc55
      version: -1
      name: Set Agent IDs to Alert Context
      description: commands.local.cmd.set.incident
      script: Builtin|||setAlert
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      agentsid:
        complex:
          root: Have you found any SharePoint servers that might be vulnerable?.Answers
          accessor: "0"
          transformers:
          - operator: split
            args:
              delimiter:
                value:
                  simple: ','
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3710,
          "y": 941
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "108":
    id: "108"
    taskid: 39ff299e-9011-4606-accc-c25f7354d11d
    type: regular
    task:
      id: 39ff299e-9011-4606-accc-c25f7354d11d
      version: -1
      name: XQL Query - IOCs Hunt
      description: |-
        Execute an XQL query and retrieve results of an executed XQL query API. The command will be executed every 10 seconds until results are retrieved or until a timeout error is raised.
        When more than 1000 results are retrieved, the command will return a compressed gzipped JSON format file,
        unless the argument 'parse_result_file_to_context' is set to true and then the results will be extracted to the context.
      script: '|||xdr-xql-generic-query'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#error#':
      - "121"
      '#none#':
      - "110"
    scriptarguments:
      extend-context:
        simple: HuntIOCs=
      ignore-outputs:
        simple: "true"
      max_fields:
        simple: "100"
      query:
        simple: config timeframe = 1h case_sensitive = false | datamodel dataset=* | FILTER   XDM_ALIAS.ip in (${ExtractedIndicators.IP=>'"'+val.join('","')+'"'}) or ( XDM_ALIAS.file_hash in (${ExtractedIndicators.File=>'"'+val.join('","')+'"'})) | fields fieldset.xdm_core, xdm.intermediate.ipv4, xdm.source.host.ipv4_addresses, xdm.target.host.ipv4_addresses, xdm.intermediate.host.ipv4_addresses, xdm.network.dhcp.ciaddr, xdm.network.dhcp.yiaddr, xdm.network.dhcp.siaddr, xdm.network.dhcp.giaddr, xdm.network.vpn.allocated_ipv4, xdm.source.ipv6, xdm.target.ipv6, xdm.intermediate.ipv6, xdm.source.host.ipv6_addresses, xdm.target.host.ipv6_addresses, xdm.intermediate.host.ipv6_addresses, xdm.network.vpn.allocated_ipv6, xdm.source.process.executable.md5, xdm.source.process.executable.sha256, xdm.target.process.executable.md5, xdm.target.process.executable.sha256, xdm.intermediate.process.executable.md5, xdm.intermediate.process.executable.sha256, xdm.target.module.md5, xdm.target.module.sha256, xdm.target.file.md5, xdm.target.file.sha256, xdm.target.file_before.md5, xdm.target.file_before.sha256
      query_name:
        simple: IOCs search
      time_frame:
        simple: 1 week ago
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": 2543,
          "y": 3006
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "109":
    id: "109"
    taskid: 35355acb-10e6-417e-8d1f-92b073b5e9e1
    type: condition
    task:
      id: 35355acb-10e6-417e-8d1f-92b073b5e9e1
      version: -1
      name: Is the integration of 'XQL Query Engine' available?
      description: Returns 'yes' if integration brand 'XQL Query Engine' is available. Otherwise returns 'no'.
      scriptName: IsIntegrationAvailable
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "121"
      "yes":
      - "111"
    scriptarguments:
      brandname:
        simple: XQL Query Engine
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2545,
          "y": 2571
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "110":
    id: "110"
    taskid: 07a1ddb4-c0c8-4e51-adc0-282fcdadc664
    type: condition
    task:
      id: 07a1ddb4-c0c8-4e51-adc0-282fcdadc664
      version: -1
      name: Any results from XQL?
      description: ' Checks if Threat Hunting found threats.'
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "28"
      "yes":
      - "113"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: HuntIOCs.results
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2543,
          "y": 3119
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "111":
    id: "111"
    taskid: 25d6382c-b056-4747-b116-33a03b686c36
    type: regular
    task:
      id: 25d6382c-b056-4747-b116-33a03b686c36
      version: -1
      name: Check XQL Quota
      description: Retrieve the amount of query quota available and used.
      script: '|||xdr-xql-get-quota'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "112"
    scriptarguments:
      extend-context:
        simple: PaloAltoNetworksXQL.Quota4=
      ignore-outputs:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2543,
          "y": 2732
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "112":
    id: "112"
    taskid: 2f635d9f-d719-4541-a0aa-f91bda9d29f6
    type: condition
    task:
      id: 2f635d9f-d719-4541-a0aa-f91bda9d29f6
      version: -1
      name: Is there enough quota?
      description: Check if there is enough quota to run the query.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "121"
      "yes":
      - "108"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: greaterThanOrEqual
          left:
            value:
              complex:
                root: PaloAltoNetworksXQL.Quota4
                accessor: license_quota
                transformers:
                - operator: LastArrayElement
                - operator: subtraction
                  args:
                    by:
                      value:
                        simple: PaloAltoNetworksXQL.Quota4.used_quota
                      iscontext: true
            iscontext: true
          right:
            value:
              simple: "1"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2543,
          "y": 2850
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "113":
    id: "113"
    taskid: 1c184bf5-22a9-4bad-9df1-5ca06ed0da72
    type: regular
    task:
      id: 1c184bf5-22a9-4bad-9df1-5ca06ed0da72
      version: -1
      name: Set Context key on Found IOCs
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "28"
    scriptarguments:
      key:
        simple: IOCFound
      value:
        simple: "True"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2390,
          "y": 3286
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "114":
    id: "114"
    taskid: 3192b8b2-af5b-4578-adee-03e4cd08dbc9
    type: title
    task:
      id: 3192b8b2-af5b-4578-adee-03e4cd08dbc9
      version: -1
      name: Exploitation via Network Events
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "116"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4648,
          "y": 1612
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "115":
    id: "115"
    taskid: 93408eeb-db38-44d0-a0f4-9974703413ed
    type: regular
    task:
      id: 93408eeb-db38-44d0-a0f4-9974703413ed
      version: -1
      name: XQL Query - Network Events
      description: |-
        Execute an XQL query and retrieve results of an executed XQL query API. The command will be executed every 10 seconds until results are retrieved or until a timeout error is raised.
        When more than 1000 results are retrieved, the command will return a compressed gzipped JSON format file,
        unless the argument 'parse_result_file_to_context' is set to true and then the results will be extracted to the context.
      script: '|||xdr-xql-generic-query'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#error#':
      - "123"
      '#none#':
      - "117"
    scriptarguments:
      extend-context:
        simple: NetworkArtifacts=
      ignore-outputs:
        simple: "true"
      max_fields:
        simple: "100"
      query:
        simple: "config timeframe = 7d case_sensitive = false \n| dataset = *\n| filter (http_method = \"POST\" and http_req_uri contains \"/_layouts/*/ToolPane.aspx\")\nor (http_method = \"GET\" and http_req_uri contains \"/_layouts/*/spinstall0.aspx\")\n| alter exploit_type = if(http_referer contains \"/_layouts/SignOut.aspx\", \"RCE and unauthenticated\" , \"RCE\")\n| fields agent_hostname, http_referer, http_method, actor_process_image_name, _time  ,http_req_uri\n| sort desc _time "
      query_name:
        simple: Check if there was an attempt to use the exploit
      time_frame:
        simple: 1 week ago
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": 4648,
          "y": 2140
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "116":
    id: "116"
    taskid: 503e467d-6f0b-4454-8fa1-11e65d1ba3b6
    type: condition
    task:
      id: 503e467d-6f0b-4454-8fa1-11e65d1ba3b6
      version: -1
      name: Is the integration of 'XQL Query Engine' available?
      description: Returns 'yes' if integration brand 'XQL Query Engine' is available. Otherwise returns 'no'.
      scriptName: IsIntegrationAvailable
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "123"
      "yes":
      - "118"
    scriptarguments:
      brandname:
        simple: XQL Query Engine
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4648,
          "y": 1731
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "117":
    id: "117"
    taskid: 53197364-a977-492e-ab07-12d0e3e2f822
    type: condition
    task:
      id: 53197364-a977-492e-ab07-12d0e3e2f822
      version: -1
      name: Any results from XQL?
      description: Any results from the XQL Query?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "97"
      "yes":
      - "120"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: NetworkArtifacts.results
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4648,
          "y": 2261
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "118":
    id: "118"
    taskid: 97c681f1-ce85-44c2-9d14-9d823ebb9802
    type: regular
    task:
      id: 97c681f1-ce85-44c2-9d14-9d823ebb9802
      version: -1
      name: Check XQL Quota
      description: Retrieve the amount of query quota available and used.
      script: '|||xdr-xql-get-quota'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "119"
    scriptarguments:
      extend-context:
        simple: PaloAltoNetworksXQL.Quota3=
      ignore-outputs:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4648,
          "y": 1867
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "119":
    id: "119"
    taskid: 65dc99c5-fa58-4fe5-9601-688bd61fdc59
    type: condition
    task:
      id: 65dc99c5-fa58-4fe5-9601-688bd61fdc59
      version: -1
      name: Is there enough quota?
      description: Check if there is enough quota to run the query.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "123"
      "yes":
      - "115"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: greaterThanOrEqual
          left:
            value:
              complex:
                root: PaloAltoNetworksXQL.Quota3
                accessor: license_quota
                transformers:
                - operator: LastArrayElement
                - operator: subtraction
                  args:
                    by:
                      value:
                        simple: PaloAltoNetworksXQL.Quota3.used_quota
                      iscontext: true
            iscontext: true
          right:
            value:
              simple: "1"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4648,
          "y": 1988
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "120":
    id: "120"
    taskid: caec2b03-c497-4b5f-926b-ec80216efb7f
    type: regular
    task:
      id: caec2b03-c497-4b5f-926b-ec80216efb7f
      version: -1
      name: Set Found Exploit Activity
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "97"
    scriptarguments:
      key:
        simple: UsedExploit
      value:
        simple: "True"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4648,
          "y": 2411
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "121":
    id: "121"
    taskid: c4aeccde-5351-47e5-9e6d-68bda0fe13e1
    type: regular
    task:
      id: c4aeccde-5351-47e5-9e6d-68bda0fe13e1
      version: -1
      name: Manual – Search For IOCs
      description: |
        Dear Analyst,

        Ensure that the 'XQL Query Engine' integration is active. If it's not enabled, activate the integration or manually run the following XQL query to determine if any IOCs are found within your environment. Otherwise, you can go ahead and search manually for the following indicators:

        #### List of IPs:
        ${ExtractedIndicators.IP=>val.join(',')}

        #### List of Hashes:
        ${ExtractedIndicators.File=>val.join(',')}



        XQL Query:
        ```
        config timeframe = 1h case_sensitive = false | datamodel dataset=* | FILTER   XDM_ALIAS.ip in(${ExtractedIndicators.IP=>val.join(',')}) or  ( XDM_ALIAS.file_hash in(${ExtractedIndicators.File=>val.join(',')}) | fields fieldset.xdm_core, xdm.intermediate.ipv4, xdm.source.host.ipv4_addresses, xdm.target.host.ipv4_addresses, xdm.intermediate.host.ipv4_addresses, xdm.network.dhcp.ciaddr, xdm.network.dhcp.yiaddr, xdm.network.dhcp.siaddr, xdm.network.dhcp.giaddr, xdm.network.vpn.allocated_ipv4, xdm.source.ipv6, xdm.target.ipv6, xdm.intermediate.ipv6, xdm.source.host.ipv6_addresses, xdm.target.host.ipv6_addresses, xdm.intermediate.host.ipv6_addresses, xdm.network.vpn.allocated_ipv6, xdm.source.process.executable.md5, xdm.source.process.executable.sha256, xdm.target.process.executable.md5, xdm.target.process.executable.sha256, xdm.intermediate.process.executable.md5, xdm.intermediate.process.executable.sha256, xdm.target.module.md5, xdm.target.module.sha256, xdm.target.file.md5, xdm.target.file.sha256, xdm.target.file_before.md5, xdm.target.file_before.sha256
        ```
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "28"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2963,
          "y": 3119
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "123":
    id: "123"
    taskid: 0d2389c9-3372-4c9b-a952-166f1387cb2f
    type: regular
    task:
      id: 0d2389c9-3372-4c9b-a952-166f1387cb2f
      version: -1
      name: Manual – Check for exploitation in your environment
      description: "Dear Analyst,\n\nEnsure that the 'XQL Query Engine' integration is active. If it's not enabled, activate the integration or manually run the following XQL query to determine if there was an attempt to use one of the CVEs.\n\n\nXQL Query:\n```\nconfig timeframe = 7d case_sensitive = false \n| dataset = *\n| filter (http_method = \"POST\" and http_req_uri contains \"/_layouts/*/ToolPane.aspx\")\nor (http_method = \"GET\" and http_req_uri contains \"/_layouts/*/spinstall0.aspx\")\n| alter exploit_type = if(http_referer contains \"/_layouts/SignOut.aspx\", \"RCE and unauthenticated\" , \"RCE\")\n| fields agent_hostname, http_referer, http_method, actor_process_image_name, _time  ,http_req_uri\n| sort desc _time \n```\n"
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "97"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 5052,
          "y": 2267
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "124":
    id: "124"
    taskid: 04537d38-4a14-4a7d-b714-dfc23a7d2bfb
    type: regular
    task:
      id: 04537d38-4a14-4a7d-b714-dfc23a7d2bfb
      version: -1
      name: Collect Indicators from Unit42 Blog
      description: This script extracts indicators from HTML and handles bad TLDs to avoid file extension false positives.
      scriptName: ParseHTMLIndicators
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "25"
    scriptarguments:
      unescape_domain:
        simple: "False"
      url:
        simple: https://unit42.paloaltonetworks.com/microsoft-sharepoint-cve-2025-49704-cve-2025-49706-cve-2025-53770/
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2771,
          "y": 1739
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "125":
    id: "125"
    taskid: c3691118-2865-4aec-a02b-7f57231a9bf1
    type: title
    task:
      id: c3691118-2865-4aec-a02b-7f57231a9bf1
      version: -1
      name: Exploitation via .Net Telemetry
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "127"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 5568,
          "y": 1612
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "126":
    id: "126"
    taskid: 6d2d246f-8b10-4561-91ef-1efd71e2126c
    type: regular
    task:
      id: 6d2d246f-8b10-4561-91ef-1efd71e2126c
      version: -1
      name: XQL Query - .Net Telemetry
      description: This XQL query leverages DotNet telemetry to identify references to ToolPane.exe, and extracts fields to provide additional context.
      script: '|||xdr-xql-generic-query'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#error#':
      - "132"
      '#none#':
      - "128"
    scriptarguments:
      extend-context:
        simple: DotNetTelemetry=
      ignore-outputs:
        simple: "true"
      max_fields:
        simple: "100"
      query:
        simple: |-
          dataset = xdr_data
          | fields _time, agent_hostname, actor_effective_username, actor_process_image_name, actor_process_image_path, actor_process_command_line, dynamic_event_string_map, event_thread_context, event_type
          | filter event_type = ENUM.DOT_NET and actor_process_image_name = "w3wp.exe" and event_thread_context contains "ToolPane.aspx"
          | alter IIS_appName = arrayindex(regextract(actor_process_command_line, "\-ap\s+\"([^\"]+)\""), 0)
          | alter EventSrcIP = trim(json_extract(dynamic_event_string_map, "$.27"), "\""),
                  RequestURI = trim(json_extract(dynamic_event_string_map, "$.26"), "\""),
                  Payload = trim(json_extract(dynamic_event_string_map, "$.30"), "\""),
                  Headers = trim(json_extract(dynamic_event_string_map, "$.32"), "\"")
          | alter x_forwarded_for_header = regextract(lowercase(Headers), "\|(?:client-ip|x-forwarded-for)\:((?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[1-9])(?:\.(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])){3})\|")
          | fields _time, agent_hostname, actor_effective_username, actor_process_image_path, actor_process_command_line, IIS_appName, dynamic_event_string_map, event_thread_context, EventSrcIP, x_forwarded_for_header, RequestURI, Payload, Headers
      query_name:
        simple: Check if there was an attempt to use the exploit via DotNet telemetry
      time_frame:
        simple: 1 week ago
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": 5568,
          "y": 2142
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "127":
    id: "127"
    taskid: a0bfacc3-8edf-46f4-8e67-540c9bf59157
    type: condition
    task:
      id: a0bfacc3-8edf-46f4-8e67-540c9bf59157
      version: -1
      name: Is the integration of 'XQL Query Engine' available?
      description: Returns 'yes' if integration brand 'XQL Query Engine' is available. Otherwise returns 'no'.
      scriptName: IsIntegrationAvailable
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "132"
      "yes":
      - "129"
    scriptarguments:
      brandname:
        simple: XQL Query Engine
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 5568,
          "y": 1731
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "128":
    id: "128"
    taskid: 6f926c9b-4222-4329-9d39-99066e6ff98e
    type: condition
    task:
      id: 6f926c9b-4222-4329-9d39-99066e6ff98e
      version: -1
      name: Any results from XQL?
      description: Any results from the XQL Query?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "97"
      "yes":
      - "131"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: DotNetTelemetry.results
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 5568,
          "y": 2261
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "129":
    id: "129"
    taskid: 1c27f2b6-5133-4a59-845c-781ccf8138b4
    type: regular
    task:
      id: 1c27f2b6-5133-4a59-845c-781ccf8138b4
      version: -1
      name: Check XQL Quota
      description: Retrieve the amount of query quota available and used.
      script: '|||xdr-xql-get-quota'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "130"
    scriptarguments:
      extend-context:
        simple: PaloAltoNetworksXQL.Quota5=
      ignore-outputs:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 5568,
          "y": 1867
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "130":
    id: "130"
    taskid: 0f37038e-ede3-45e5-95cc-5c81f64dd8ba
    type: condition
    task:
      id: 0f37038e-ede3-45e5-95cc-5c81f64dd8ba
      version: -1
      name: Is there enough quota?
      description: Check if there is enough quota to run the query.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "132"
      "yes":
      - "126"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: greaterThanOrEqual
          left:
            value:
              complex:
                root: PaloAltoNetworksXQL.Quota5
                accessor: license_quota
                transformers:
                - operator: LastArrayElement
                - operator: subtraction
                  args:
                    by:
                      value:
                        simple: PaloAltoNetworksXQL.Quota5.used_quota
                      iscontext: true
            iscontext: true
          right:
            value:
              simple: "1"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 5568,
          "y": 1988
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "131":
    id: "131"
    taskid: a87a6a83-0b44-489d-8121-58982a045b70
    type: regular
    task:
      id: a87a6a83-0b44-489d-8121-58982a045b70
      version: -1
      name: Set Found Exploit Activity
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "97"
    scriptarguments:
      key:
        simple: UsedExploit
      value:
        simple: "True"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 5738,
          "y": 2443
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "132":
    id: "132"
    taskid: 5832468b-7856-4a08-8902-6f267e7a38d3
    type: regular
    task:
      id: 5832468b-7856-4a08-8902-6f267e7a38d3
      version: -1
      name: Manual – Check for exploitation in your environment
      description: |
        Dear Analyst,

        Ensure that the 'XQL Query Engine' integration is active. If it's not enabled, activate the integration or manually run the following XQL query to determine if there was an attempt to use one of the CVEs.



        XQL Query:
        ```
        // Description: This query leverages DotNet telemetry to identify references to ToolPane.exe, and extracts fields to provide additional context.
        dataset = xdr_data
        | fields _time, agent_hostname, actor_effective_username, actor_process_image_name, actor_process_image_path, actor_process_command_line, dynamic_event_string_map, event_thread_context, event_type
        | filter event_type = ENUM.DOT_NET and actor_process_image_name = "w3wp.exe" and event_thread_context contains "ToolPane.aspx"

        // Extract the IIS application pool name from command line
        | alter IIS_appName = arrayindex(regextract(actor_process_command_line, "\-ap\s+\"([^\"]+)\""), 0)

        // Extract fields from the dynamic_string_string_map:
        // EventSrcIP - Logged IP address by the IIS server
        // RequestURI - The requested URL by the threat actor
        // Payload - The time he decoded .NET payload from exploitation
        // Headers - HTTP request headers
        | alter EventSrcIP = trim(json_extract(dynamic_event_string_map, "$.27"), "\""),
                RequestURI = trim(json_extract(dynamic_event_string_map, "$.26"), "\""),
                Payload = trim(json_extract(dynamic_event_string_map, "$.30"), "\""),
                Headers = trim(json_extract(dynamic_event_string_map, "$.32"), "\"")

        // Extract the X-Forwarded-For headers from the Headers field in an attempt to identify the source of exploitation
        | alter x_forwarded_for_header = regextract(lowercase(Headers), "\|(?:client-ip|x-forwarded-for)\:((?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[1-9])(?:\.(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])){3})\|")

        | fields _time, agent_hostname, actor_effective_username, actor_process_image_path, actor_process_command_line, IIS_appName, dynamic_event_string_map, event_thread_context, EventSrcIP, x_forwarded_for_header, RequestURI, Payload, Headers
        ```
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "97"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 6109,
          "y": 2261
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "133":
    id: "133"
    taskid: 89a8fb10-2f09-4dbd-9dd2-99212bfda609
    type: regular
    task:
      id: 89a8fb10-2f09-4dbd-9dd2-99212bfda609
      version: -1
      name: Set Potential Agent IDs to search on
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "72"
    scriptarguments:
      key:
        simple: agentsidstocheck
      value:
        complex:
          root: alert
          accessor: agentid
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: alert.agentsid
                iscontext: true
          - operator: RemoveEmpty
            args:
              empty_values: {}
              remove_keys:
                value:
                  simple: "true"
          - operator: join
            args:
              separator:
                value:
                  simple: '","'
          - operator: concat
            args:
              prefix:
                value:
                  simple: '"'
              suffix:
                value:
                  simple: '"'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4191.5,
          "y": 1343
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "134":
    id: "134"
    taskid: bfa17ab0-dc13-497d-a40c-43c12f5fec36
    type: title
    task:
      id: bfa17ab0-dc13-497d-a40c-43c12f5fec36
      version: -1
      name: Search For Related Alerts On Hosts
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "139"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3443,
          "y": 1620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "135":
    id: "135"
    taskid: c1d336fb-267b-420a-9701-098cdb03f81d
    type: regular
    task:
      id: c1d336fb-267b-420a-9701-098cdb03f81d
      version: -1
      name: Search For Related Alerts On Hosts
      description: This task searches for related alerts by agent IDs and possible related alert names that can point to a potential usage of the exploits.
      scriptName: SearchAlertsV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "136"
    scriptarguments:
      extend-context:
        simple: SrcHostRelatedAlerts=
      fromdate:
        simple: 3 hours ago
      ignore-outputs:
        simple: "true"
      includeinformational:
        simple: "false"
      query:
        simple: ${agentsidstocheck2=>"(agentid:"+val.join( or agentid:)+")"} and (name:"IIS Protection - 1068402429" or name:"SYNC - Webserver Exploitation - 881462404" or ((severity:"HIGH" or severity:"MEDIUM" or severity:"CRITICAL") and mitreattcktechnique:"T1059.001"))
      todate:
        simple: now
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3443,
          "y": 1937
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "136":
    id: "136"
    taskid: 5417252b-d793-446d-805b-0106a33835c6
    type: condition
    task:
      id: 5417252b-d793-446d-805b-0106a33835c6
      version: -1
      name: Any related alerts found?
      description: Check if there are any related alerts found from the previous search that could indicate potential exploit activities.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "97"
      "yes":
      - "137"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: foundIncidents.name
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3443,
          "y": 2559
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "137":
    id: "137"
    taskid: 901413d2-c497-4d9d-8445-13dc9dfa0c80
    type: regular
    task:
      id: 901413d2-c497-4d9d-8445-13dc9dfa0c80
      version: -1
      name: Set Evidence Key To context
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "97"
    scriptarguments:
      key:
        simple: AlertsDetectedOnHosts
      value:
        simple: "True"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3672,
          "y": 2802
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "138":
    id: "138"
    taskid: 33a80fa0-0b5c-4586-8878-ae77d9f99c26
    type: playbook
    task:
      id: 33a80fa0-0b5c-4586-8878-ae77d9f99c26
      version: -1
      name: Panorama Query Logs for Related Session
      description: 'Query Panorama Logs of types: traffic, threat, url, data-filtering and wildfire.'
      playbookName: Panorama Query Logs
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "28"
    scriptarguments:
      log_type:
        simple: threat
      query:
        simple: '(threatid eq 96436) or (threatid eq 96481) '
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 3016,
          "y": 2571
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "139":
    id: "139"
    taskid: c9d1c9b3-1bb5-4e34-829f-d52cebe152a5
    type: regular
    task:
      id: c9d1c9b3-1bb5-4e34-829f-d52cebe152a5
      version: -1
      name: Set Potential Agent IDs to search on
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "135"
    scriptarguments:
      key:
        simple: agentsidstocheck2
      value:
        complex:
          root: alert
          accessor: agentid
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: alert.agentsid
                iscontext: true
          - operator: RemoveEmpty
            args:
              empty_values: {}
              remove_keys:
                value:
                  simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3443,
          "y": 1758
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "109_121_#default#": 0.42,
      "110_113_yes": 0.4,
      "110_28_#default#": 0.13,
      "112_121_#default#": 0.52,
      "115_123_#error#": 0.61,
      "116_118_yes": 0.38,
      "116_123_#default#": 0.32,
      "117_97_#default#": 0.22,
      "119_115_yes": 0.31,
      "119_123_#default#": 0.49,
      "126_132_#error#": 0.63,
      "127_129_yes": 0.41,
      "127_132_#default#": 0.37,
      "128_97_#default#": 0.13,
      "130_126_yes": 0.39,
      "130_132_#default#": 0.55,
      "136_97_#default#": 0.15,
      "1_2_#error#": 0.33,
      "26_7_#default#": 0.36,
      "4_9_#default#": 0.12,
      "6_2_#default#": 0.28,
      "72_73_yes": 0.61,
      "74_79_#error#": 0.31,
      "75_79_#default#": 0.45,
      "78_79_#default#": 0.64
    },
    "paper": {
      "dimensions": {
        "height": 5045,
        "width": 4120.75,
        "x": 2369.25,
        "y": -327
      }
    }
  }
inputs: []
inputSections:
- inputs: []
  name: General (Inputs group)
  description: Generic group for inputs
outputSections:
- outputs: []
  name: General (Outputs group)
  description: Generic group for outputs
outputs: []
tests:
- No tests (auto formatted)
fromversion: 8.9.0
supportedModules:
- X1
- X3
- X5
- ENT_PLUS
