id: silent-SSO Password Spray Test
version: -1
name: silent-SSO Password Spray Test
description: |-
  This playbook is designed to handle the following alerts:

  - SSO Password Spray Threat Detected
  - SSO Password Spray Activity Observed
  - SSO Password Spray Involving a Honey User

  Playbook Stages:

  Triage:

  - The playbook checks the IP reputation and fetches the events related to the SSO login attempts.

  Early Containment:

  - The playbook checks if the IP is suspicious. If it is, the playbook suggests blocking the IP.

  Investigation:

  - The playbook assess the risk score of the user who successfully logged in and examines the legitimacy of the user agent. It verifies if the user has MFA configured and analyzes the timestamps of the login attempts to detect potential malicious automated patterns.

  Containment:
  - If there is a successful login attempt and the user's risk score is high, or if the user agent is detected as suspicious, or if the time intervals were automated, the playbook clears the user's session. If the user doesn't have MFA, the playbook recommends expiring the user's password.

  Requirements:

  For any response action, you need one of the following integrations:

  - Microsoft Graph User
  - Okta.
tags:
- T1110.003 - Password Spraying
- T1110 - Brute Force
- T1110.001 - Password Guessing
- T1586 - Compromise Accounts
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 428e71eb-55df-4a65-8aec-d2b4a5caa5d7
    type: start
    task:
      id: 428e71eb-55df-4a65-8aec-d2b4a5caa5d7
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "29"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1100,
          "y": 131
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: 7aecbe76-273f-4564-805f-3e022d320039
    type: title
    task:
      id: 7aecbe76-273f-4564-805f-3e022d320039
      version: -1
      name: Investigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "17"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1126,
          "y": 652
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: 3354831c-97ae-4cfb-8949-6fc6e09d99e4
    type: regular
    task:
      id: 3354831c-97ae-4cfb-8949-6fc6e09d99e4
      version: -1
      name: Close alert as true positive
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "12"
    scriptarguments:
      id:
        simple: ${alert.id}
      closeNotes:
        simple: Handled by the playbook "SSO Password Spray".
      closeReason:
        simple: Resolved - True Positive
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1792,
          "y": 2488
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: 135f3593-a4ca-4195-8054-2b0501e3cf4e
    type: title
    task:
      id: 135f3593-a4ca-4195-8054-2b0501e3cf4e
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1382,
          "y": 2616
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: 189b88a1-a9b6-4fb4-b515-c414855a49e5
    type: regular
    task:
      id: 189b88a1-a9b6-4fb4-b515-c414855a49e5
      version: -1
      name: Get login event information
      description: Returns information about each alert ID.
      script: '|||core-get-cloud-original-alerts'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "35"
    scriptarguments:
      alert_ids:
        complex:
          root: alert
          accessor: id
          transformers:
          - operator: uniq
      filter_alert_fields:
        simple: "false"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1310,
          "y": 362
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: d02e94a0-eda1-4729-804c-c17051c8c702
    type: title
    task:
      id: d02e94a0-eda1-4729-804c-c17051c8c702
      version: -1
      name: Containment
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "21"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1792,
          "y": 1168
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: b95fa692-f074-4cd7-868d-464005a3decb
    type: condition
    task:
      id: b95fa692-f074-4cd7-868d-464005a3decb
      version: -1
      name: Were any successful login attempts?
      description: ""
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "52"
      "Yes":
      - "28"
      - "39"
      - "48"
    separatecontext: false
    conditions:
    - label: "Yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: SuccessfulLoginUsernames
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1126,
          "y": 766
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: 1d0fd82a-fc7f-4c84-8ef4-2aa7a35fb9ed
    type: condition
    task:
      id: 1d0fd82a-fc7f-4c84-8ef4-2aa7a35fb9ed
      version: -1
      name: Evaluate suspicious behaviors
      description: ""
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "12"
      "Yes":
      - "50"
    separatecontext: false
    conditions:
    - label: "Yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: SuspiciousUsers
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1792,
          "y": 1289
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: f6531942-ab96-49ad-99ff-a82f93313075
    type: regular
    task:
      id: f6531942-ab96-49ad-99ff-a82f93313075
      version: -1
      name: Get user MFA factors
      description: Returns all the enrolled factors for the specified user.
      script: '|||okta-get-user-factors'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "38"
    scriptarguments:
      extend-context:
        simple: MFAResult=
      username:
        complex:
          root: Core.OriginalAlert._all_events
          filters:
          - - operator: containsGeneral
              left:
                value:
                  simple: Core.OriginalAlert._all_events.identity
                iscontext: true
              right:
                value:
                  simple: SuspiciousUsers
                iscontext: true
              ignorecase: true
          accessor: auth_identity
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1792,
          "y": 1768
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: b06185f2-9dba-4416-8d88-d12f3ee05c11
    type: condition
    task:
      id: b06185f2-9dba-4416-8d88-d12f3ee05c11
      version: -1
      name: Found users without MFA?
      description: ""
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "12"
      "Yes":
      - "24"
    separatecontext: false
    conditions:
    - label: "Yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: UsersWithoutMFA
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1792,
          "y": 2008
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: 9ecbb4ff-5712-48a9-94e9-3703e43fe9bb
    type: collection
    task:
      id: 9ecbb4ff-5712-48a9-94e9-3703e43fe9bb
      version: -1
      name: Choose users for password expiration
      description: ""
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "25"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1995,
          "y": 2131
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: Select the user to set password expiration
        required: false
        gridcolumns: []
        defaultrows: []
        type: multiSelect
        options: []
        optionsarg:
        - simple: ${UsersWithoutMFA}
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      title: Select the user for which you want to set a password expiration
      description: Decide whether the password should be expired for users who have successfully logged in.
      sender: ""
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: a30220a7-b971-43b6-8ccb-e6a003ad5a80
    type: condition
    task:
      id: a30220a7-b971-43b6-8ccb-e6a003ad5a80
      version: -1
      name: Was any user selected?
      description: ""
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "12"
      "Yes":
      - "46"
    separatecontext: false
    conditions:
    - label: "Yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: Select the user for which you want to set a password expiration.Answers.0
            iscontext: true
          right:
            value: {}
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1995,
          "y": 2245
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: fde99658-bd5b-41c7-9bc5-eedcec04fdb5
    type: regular
    task:
      id: fde99658-bd5b-41c7-9bc5-eedcec04fdb5
      version: -1
      name: Check if the involved user agent is suspicious
      description: |-
        Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.13/Cortex-XSOAR-Administrator-Guide/Automations
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "37"
    scriptarguments:
      key:
        simple: UsersWithSuspiciousUserAgent
      value:
        complex:
          root: Core.OriginalAlert._all_events
          filters:
          - - operator: match
              left:
                value:
                  simple: Core.OriginalAlert._all_events.action_user_agent
                iscontext: true
              right:
                value:
                  simple: \b(Python-urllib|libwww-perl|Scrapy|curl|Wget|sqlmap|Nikto|Xrumer|Hydra|JohnTheRipper|LOIC|HOIC|MJ12bot|Baiduspider|BlackWidow|HeadlessChrome|PhantomJS|Selenium)\b
          accessor: identity
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1792,
          "y": 916
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: 095c8cb2-59d8-45d8-80e8-da6c188cd1db
    type: title
    task:
      id: 095c8cb2-59d8-45d8-80e8-da6c188cd1db
      version: -1
      name: 'Triage '
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "30"
      - "13"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1100,
          "y": 240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: 8a6bbebb-ce48-442e-857c-8959dd81ddb7
    type: regular
    task:
      id: 8a6bbebb-ce48-442e-857c-8959dd81ddb7
      version: -1
      name: 'Check IP reputation '
      description: This script gathers IP reputation data from multiple integrations and returns an IP entity with consolidated information in the context.
      type: regular
      iscommand: false
      brand: ""
      scriptName: ip-enrichment
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      external_enrichment:
        simple: "true"
      ip_list:
        complex:
          root: alert
          accessor: localip
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 886,
          "y": 362
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: e9b26997-1ffa-448e-86be-9d44d635fe4a
    type: condition
    task:
      id: e9b26997-1ffa-448e-86be-9d44d635fe4a
      version: -1
      name: 'Is the IP malicious? '
      description: ""
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "3"
      "yes":
      - "32"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: IPEnrichment
                filters:
                - - operator: greaterThanOrEqual
                    left:
                      value:
                        simple: IPEnrichment.TIMScore
                      iscontext: true
                    right:
                      value:
                        simple: "3"
                accessor: Value
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 886,
          "y": 482
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: 20c0aa3f-6a69-42e9-87bb-67d1ef80431c
    type: title
    task:
      id: 20c0aa3f-6a69-42e9-87bb-67d1ef80431c
      version: -1
      name: Early Containment
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "3"
      - "51"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 676,
          "y": 652
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: 47053318-6590-4910-8f9b-5bd04eb82724
    type: regular
    task:
      id: 47053318-6590-4910-8f9b-5bd04eb82724
      version: -1
      name: Set users with successful login
      description: |-
        Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.13/Cortex-XSOAR-Administrator-Guide/Automations
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      key:
        simple: SuccessfulLoginUsernames
      value:
        complex:
          root: Core.OriginalAlert._all_events
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: Core.OriginalAlert._all_events.auth_outcome
                iscontext: true
              right:
                value:
                  simple: SUCCESS
          accessor: identity
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1310,
          "y": 482
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: e4d1fa63-3e2a-4f9d-8734-0d5e8330cc4d
    type: regular
    task:
      id: e4d1fa63-3e2a-4f9d-8734-0d5e8330cc4d
      version: -1
      name: Set risky user
      description: |-
        Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.13/Cortex-XSOAR-Administrator-Guide/Automations
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      key:
        simple: SuspiciousUsers
      value:
        complex:
          root: UserData
          filters:
          - - operator: containsGeneral
              left:
                value:
                  simple: UserData.RiskLevel
                iscontext: true
              right:
                value:
                  simple: HIGH
              ignorecase: true
          accessor: Username
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1392,
          "y": 1037
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: 859ffdde-c1c0-4976-836f-5d8029d80f28
    type: regular
    task:
      id: 859ffdde-c1c0-4976-836f-5d8029d80f28
      version: -1
      name: Set users who used a suspicious user agent
      description: |-
        Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.13/Cortex-XSOAR-Administrator-Guide/Automations
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: SuspiciousUsers
      value:
        complex:
          root: UsersWithSuspiciousUserAgent
          filters:
          - - operator: in
              left:
                value:
                  simple: UsersWithSuspiciousUserAgent
                iscontext: true
              right:
                value:
                  simple: SuccessfulLoginUsernames
                iscontext: true
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1792,
          "y": 1037
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: 40f09bcd-7e22-4ec1-bff1-abcc09d80d09
    type: regular
    task:
      id: 40f09bcd-7e22-4ec1-bff1-abcc09d80d09
      version: -1
      name: Set users without MFA
      description: |-
        Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.13/Cortex-XSOAR-Administrator-Guide/Automations
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "23"
    scriptarguments:
      key:
        simple: UsersWithoutMFA
      value:
        complex:
          root: Core.OriginalAlert._all_events
          filters:
          - - operator: notContainsGeneral
              left:
                value:
                  simple: Core.OriginalAlert._all_events.auth_identity
                iscontext: true
              right:
                value:
                  simple: Account.Factor.Profile.credentialId
                iscontext: true
              ignorecase: true
          - - operator: in
              left:
                value:
                  simple: Core.OriginalAlert._all_events.identity
                iscontext: true
              right:
                value:
                  simple: SuspiciousUsers
                iscontext: true
              ignorecase: true
          accessor: auth_identity
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1793,
          "y": 1887
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: 33ae71fb-e0ad-4dc5-8f48-5fbfcfb9892d
    type: regular
    task:
      id: 33ae71fb-e0ad-4dc5-8f48-5fbfcfb9892d
      version: -1
      name: Analyze intervals of login attempts
      description: Analyze a list of Unix timestamps in milliseconds, to detect simple patterns of consistency or high frequency. The script can aid in the investigation of multi-event alerts that contain a list of timestamps.
      scriptName: AnalyzeTimestampIntervals
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "47"
    scriptarguments:
      timestamps:
        simple: ${Core.OriginalAlert._all_events.event_timestamp}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2202,
          "y": 916
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: dec75ec0-4d72-49ff-8794-b14666ef5a1b
    type: condition
    task:
      id: dec75ec0-4d72-49ff-8794-b14666ef5a1b
      version: -1
      name: 'Is integration enabled? '
      description: ""
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "12"
      Okta:
      - "22"
    separatecontext: false
    conditions:
    - label: Okta
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: Core.OriginalAlert.raw_abioc.event.vendor
            iscontext: true
          right:
            value:
              simple: Okta
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Okta v2
                    ignorecase: true
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                    ignorecase: true
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1792,
          "y": 1644
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "46":
    id: "46"
    taskid: 8b2f636e-8ce3-4d80-8756-a07dfafb7d4a
    type: regular
    task:
      id: 8b2f636e-8ce3-4d80-8756-a07dfafb7d4a
      version: -1
      name: Okta expire password
      description: Expires the password for a user in Okta.
      script: '|||okta-expire-password'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      username:
        complex:
          root: Select the user for which you want to set a password expiration.Answers
          accessor: "0"
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2191,
          "y": 2367
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "47":
    id: "47"
    taskid: 6f91f2a6-3c4e-4b48-8d39-5865c2aafd52
    type: regular
    task:
      id: 6f91f2a6-3c4e-4b48-8d39-5865c2aafd52
      version: -1
      name: Set users if the timestamps are automated
      description: |-
        Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.13/Cortex-XSOAR-Administrator-Guide/Automations
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      key:
        simple: SuspiciousUsers
      value:
        complex:
          root: .
          transformers:
          - operator: If-Elif
            args:
              conditions:
                value:
                  simple: |-
                    [  {
                        "condition": "#{IntervalAnalysis.IsPatternLikelyAutomated} == true",
                        "return": #{SuccessfulLoginUsernames}
                      }
                    ]
              flags: {}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2202,
          "y": 1037
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "48":
    id: "48"
    taskid: cfdc736a-7bd7-4bf2-ba51-4962218f0c0a
    type: regular
    task:
      id: cfdc736a-7bd7-4bf2-ba51-4962218f0c0a
      version: -1
      name: Get user risk score
      description: This script gathers user data from multiple integrations and returns an Account entity with consolidated information to the context.
      scriptName: get-user-data
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "36"
    scriptarguments:
      user_name:
        simple: ${SuccessfulLoginUsernames}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1392,
          "y": 915
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "49":
    id: "49"
    taskid: 9126a98f-d798-45aa-8eb5-c3d3ca0603a1
    type: regular
    task:
      id: 9126a98f-d798-45aa-8eb5-c3d3ca0603a1
      version: -1
      name: Clear user session
      description: This script clears user sessions across multiple integrations for a list of usernames.
      scriptName: clear-user-session
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "40"
    scriptarguments:
      brands:
        simple: Okta v2
      user_name:
        complex:
          root: SuspiciousUsers
          transformers:
          - operator: Cut
            args:
              delimiter:
                value:
                  simple: \
              fields:
                value:
                  simple: "2"
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1792,
          "y": 1532
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "50":
    id: "50"
    taskid: dd5b857a-2e07-4e8e-8f69-c76a1f23e3e9
    type: regular
    task:
      id: dd5b857a-2e07-4e8e-8f69-c76a1f23e3e9
      version: -1
      name: Increase alert severity
      description: Optionally increases the alert severity to the new value if it is greater than the existing severity.
      scriptName: IncreaseAlertSeverity
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "49"
    scriptarguments:
      severity:
        simple: Medium
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1792,
          "y": 1412
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "51":
    id: "51"
    taskid: f4051290-d8c9-43a7-95e6-f34131b458b8
    type: regular
    task:
      id: f4051290-d8c9-43a7-95e6-f34131b458b8
      version: -1
      name: Block IP
      description: The script blocks a list of IP addresses in supported integrations.
      scriptName: block-external-ip
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "12"
    scriptarguments:
      ip_list:
        complex:
          root: alert
          accessor: localip
          transformers:
          - operator: uniq
    results:
    - push_job_id
    - commit_job_id
    - panorama_responses
    - executed_brands
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 676,
          "y": 766
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "52":
    id: "52"
    taskid: 68fda2b2-1c98-4149-80c8-1cedd943ae40
    type: regular
    task:
      id: 68fda2b2-1c98-4149-80c8-1cedd943ae40
      version: -1
      name: Inconclusive | No Suspicious Evidence
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
      description: ""
    nexttasks:
      '#none#':
      - "12"
    scriptarguments:
      key:
        simple: Inconclusive
      value:
        simple: No Suspicious Evidence
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1382,
          "y": 1289
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "17_28_Yes": 0.7,
      "21_12_#default#": 0.2,
      "23_12_#default#": 0.26,
      "25_12_#default#": 0.16,
      "25_46_Yes": 0.59,
      "31_32_yes": 0.54,
      "31_3_#default#": 0.51,
      "40_12_#default#": 0.26,
      "40_22_Okta": 0.45
    },
    "paper": {
      "dimensions": {
        "height": 2545,
        "width": 1906,
        "x": 676,
        "y": 131
      }
    }
  }
inputs: []
inputSections:
- inputs: []
  name: General (Inputs group)
  description: Generic group for inputs.
outputSections:
- outputs: []
  name: General (Outputs group)
  description: Generic group for outputs.
outputs: []
tests:
- No tests (auto formatted)
marketplaces: ["marketplacev2", "platform"]
fromversion: 8.9.0
issilent: true
contentitemexportablefields:
  contentitemfields: {}
