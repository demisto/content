description: "This playbook addresses the following alerts:\n\n- A mail forwarding\
  \ rule was configured in Google Workspace.\n- A mail forwarding rule was configured\
  \ in Google Workspace to an uncommon domain.\n\nPlaybook Stages:\n \nTriage: \n\n\
  - The playbook retrieves the caller's IP, the forwarding email address, and associated\
  \ filters.\n\nEarly Containment:\n\n- The playbook checks if the IP or domain of\
  \ the forwarding email address is malicious. If so, it suggests blocking the IP\
  \ using PAN-OS while continuing the investigation in parallel.\n\nInvestigation:\n\
  \n- The playbook verifies if the rule was created outside of working hours or from\
  \ an unusual geolocation and extracts suspicious keywords from the forwarding rules.\
  \ It then aggregates all evidence collected during the investigation.\n\nContainment:\n\
  \n- If only one suspicious evidence is found, the playbook executes soft response\
  \ actions, including signing the user out and deleting the forwarding email address\
  \ from the user account mailbox. The user will be notified of these actions via\
  \ email.\n- If multiple suspicious evidences are found, the playbook executes both\
  \ soft and hard response actions, recommending the analyst suspend the user account.\n\
  \nRequirements: \n\nFor any response action, you need one of the following integrations:\n\
  - Gmail integration to fetch filters and remove the forwarding email address.\n\
  - Google Workspace Admin access to sign out and suspend the user account.\n"
fromversion: 8.9.0
id: silent-A mail forwarding rule was configured in Google Workspace Test
inputSections:
- description: Generic group for inputs
  inputs:
  - SendNotification
  name: General (Inputs group)
inputs:
- description: If set to "true," the playbook will send an email notification to the
    user informing them that the forwarding address was deleted. If "false," no notification
    will be sent.
  key: SendNotification
  playbookInputQuery: null
  required: false
  value:
    simple: 'true'
issilent: true
marketplaces:
- marketplacev2
name: silent-A mail forwarding rule was configured in Google Workspace Test
outputSections:
- description: Generic group for outputs
  name: General (Outputs group)
  outputs: []
outputs: []
starttaskid: '0'
tags:
- TA0009 - Collection
- T1114 - Email Collection
tasks:
  '0':
    continueonerrortype: ''
    id: '0'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '1'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: f54996ae-66c2-4d51-8fe3-a1ad489e4afb
      iscommand: false
      name: ''
      version: -1
    taskid: f54996ae-66c2-4d51-8fe3-a1ad489e4afb
    timertriggers: []
    type: start
    view: "{\n  \"position\": {\n    \"x\": 440,\n    \"y\": -20\n  }\n}"
  '1':
    continueonerrortype: ''
    id: '1'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '6'
      - '2'
      - '12'
    note: false
    quietmode: 0
    scriptarguments:
      alert_ids:
        simple: ${alert.id}
      filter_alert_fields:
        simple: 'false'
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Returns information about each alert ID.
      id: 586f11c0-89b5-4c58-86df-36aa1af4305d
      iscommand: true
      name: Get caller IP and forwarding mail address
      script: '|||core-get-cloud-original-alerts'
      type: regular
      version: -1
    taskid: 586f11c0-89b5-4c58-86df-36aa1af4305d
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 440,\n    \"y\": 110\n  }\n}"
  '10':
    continueonerror: true
    continueonerrortype: ''
    id: '10'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '18'
    note: false
    quietmode: 0
    scriptarguments:
      forwarding_email:
        simple: ${Core.OriginalAlert.event.raw_log.events.parameters.value}
      user_id:
        simple: ${Core.OriginalAlert.event.raw_log.actor.profileId}
    separatecontext: false
    skipunavailable: true
    task:
      brand: ''
      description: Gets the specified forwarding address or a list of the forwarding
        addresses for the specified account.
      id: f636844f-1e17-47eb-8b12-e862f2863b85
      iscommand: true
      name: Gmail - Get forwarding email address
      script: '|||gmail-forwarding-address-get'
      type: regular
      version: -1
    taskid: f636844f-1e17-47eb-8b12-e862f2863b85
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 710,\n    \"y\": 1530\n  }\n}"
  '12':
    continueonerror: true
    continueonerrortype: ''
    id: '12'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '3'
    note: false
    quietmode: 0
    scriptarguments:
      ip:
        complex:
          accessor: caller_ip
          root: Core.OriginalAlert.raw_abioc.event
          transformers:
          - operator: uniq
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Checks the reputation of an IP address.
      id: 4a1a1abf-ed23-4539-892a-03f8111fb08c
      iscommand: true
      name: Get caller IP reputation
      script: '|||ip'
      type: regular
      version: -1
    taskid: 4a1a1abf-ed23-4539-892a-03f8111fb08c
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 50,\n    \"y\": 280\n  }\n}"
  '14':
    continueonerrortype: ''
    id: '14'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '15'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 23be2a95-6283-4e18-865a-9ce05445701f
      iscommand: false
      name: Early Containment
      type: title
      version: -1
    taskid: 23be2a95-6283-4e18-865a-9ce05445701f
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": -580,\n    \"y\": 810\n  }\n}"
  '15':
    continueonerrortype: ''
    id: '15'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - '34'
    note: false
    quietmode: 0
    scriptarguments:
      MaliciousIPs:
        complex:
          accessor: caller_ip
          root: Core.OriginalAlert.raw_abioc.event
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: true
    task:
      brand: ''
      description: 'This playbook blocks IP addresses with 2 optional actions:


        - Block IP addresses using Static Address Groups in Palo Alto Networks Panorama
        or Firewall. The playbook receives malicious IP addresses and an address group
        name as inputs, verifies that the addresses are not already a part of the
        address group, adds them and commits the configuration.



        - Utilize the Dynamic Address Group (DAG) capability of PAN-OS. DAG enables
        analysts to create a rule one time, where the group is the source/destination,
        and adds IP addresses dynamically without the need to commit the configuration
        every time.

        The playbook checks if the given tag already exists. If the tag exists, then
        the IP address is added to the tag.

        If the tag does not exist, a new address group is created with the given tag
        and a matching rule, and the configuration is committed.'
      id: f0dd7de0-9eac-4e6f-86a1-dd9ff4dc93f6
      iscommand: false
      name: PAN-OS - Block IP
      playbookName: PAN-OS - Block IP
      type: playbook
      version: -1
    taskid: f0dd7de0-9eac-4e6f-86a1-dd9ff4dc93f6
    timertriggers: []
    type: playbook
    view: "{\n  \"position\": {\n    \"x\": -580,\n    \"y\": 945\n  }\n}"
  '17':
    continueonerrortype: ''
    id: '17'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '20'
    note: false
    quietmode: 0
    scriptarguments:
      closeReason:
        complex:
          accessor: '}'
          root: ${
          transformers:
          - args:
              condition:
                value:
                  simple: lhs != rhs
              conditionB: {}
              conditionInBetween: {}
              else:
                value:
                  simple: Resolved as FALSE_POSITIVE - Handled by the playbook "A
                    mail forwarding rule was configured in Google Workspace"
              equals: {}
              lhs:
                iscontext: true
                value:
                  simple: Evidences
              lhsB: {}
              options: {}
              optionsB: {}
              rhs: {}
              rhsB: {}
              then:
                value:
                  simple: Resolved as TRUE_POSITIVE - Handled by the playbook "A mail
                    forwarding rule was configured in Google Workspace"
            operator: If-Then-Else
      id:
        simple: ${alert.id}
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.close.inv
      id: 3028fe8a-9e44-4203-8458-c6be36fc42a7
      iscommand: true
      name: Close Alert
      script: Builtin|||closeInvestigation
      type: regular
      version: -1
    taskid: 3028fe8a-9e44-4203-8458-c6be36fc42a7
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 440,\n    \"y\": 2410\n  }\n}"
  '18':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: Gmail.ForwardingAddress.forwardingEmail
          operator: isNotEmpty
          right:
            value: {}
      label: 'yes'
    continueonerrortype: ''
    id: '18'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '17'
      'yes':
      - '25'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: de8e5625-536a-4bb9-8bdc-70ee14eb72ff
      iscommand: false
      name: Check if the forwarding mail address still exists
      type: condition
      version: -1
    taskid: de8e5625-536a-4bb9-8bdc-70ee14eb72ff
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 710,\n    \"y\": 1690\n  }\n}"
  '2':
    continueonerror: true
    continueonerrortype: ''
    id: '2'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '3'
    note: false
    quietmode: 0
    scriptarguments:
      domain:
        complex:
          accessor: value
          root: Core.OriginalAlert.event.raw_log.events.parameters
          transformers:
          - args:
              delimiter:
                value:
                  simple: '@'
              fields:
                value:
                  simple: '2'
            operator: Cut
          - operator: uniq
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Checks the reputation of a domain.
      id: bfb51251-f775-4f54-8ad2-20a46e1f1ac0
      iscommand: true
      name: Get forwarding email domain reputation
      script: '|||domain'
      type: regular
      version: -1
    taskid: bfb51251-f775-4f54-8ad2-20a46e1f1ac0
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 440,\n    \"y\": 280\n  }\n}"
  '20':
    continueonerrortype: ''
    id: '20'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: fe775a32-55a3-45a0-8502-c6e319e7ae91
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: fe775a32-55a3-45a0-8502-c6e319e7ae91
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": 440,\n    \"y\": 2570\n  }\n}"
  '21':
    continueonerror: true
    continueonerrortype: ''
    id: '21'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '45'
    note: false
    quietmode: 0
    scriptarguments:
      begin_time:
        simple: '22:00:00'
      end_time:
        simple: 06:00:00
      extend-context:
        simple: IsOutOfWorkingHours=
      value:
        complex:
          accessor: event_timestamp
          root: Core.OriginalAlert.raw_abioc.event
          transformers:
          - operator: TimeStampToDate
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Checks whether the given value is within the specified time (hour)
        range.
      id: 252d8473-0602-420c-8fef-df880efcc695
      iscommand: false
      name: Check if the rule was created outside of working hours
      scriptName: BetweenHours
      type: regular
      version: -1
    taskid: 252d8473-0602-420c-8fef-df880efcc695
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 0,\n    \"y\": 765\n  }\n}"
  '22':
    continueonerror: true
    continueonerrortype: ''
    id: '22'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '43'
    note: false
    quietmode: 0
    scriptarguments:
      extend-context:
        simple: IsAbnormalGeolocation=
      left:
        simple: ${Core.OriginalAlert.raw_abioc.event.saas_caller_ip_geolocation_days_seen_count},${Core.OriginalAlert.raw_abioc.event.service_caller_ip_asn_days_seen_count}
      right:
        simple: '0'
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: 'Returns all elements from the left side that have a substring
        that is equal to an element from the right side. Note: This filter is case-insensitive.

        E.g -AnyMatch left=baby right=A will return baby. For more examples see the
        filter''s Readme.'
      id: a1b2240d-c96c-46a2-8749-c94f8a214538
      iscommand: false
      name: Check for unusual geolocation connections
      scriptName: AnyMatch
      type: regular
      version: -1
    taskid: a1b2240d-c96c-46a2-8749-c94f8a214538
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 440,\n    \"y\": 765\n  }\n}"
  '25':
    continueonerrortype: ''
    id: '25'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '52'
    note: false
    quietmode: 0
    scriptarguments:
      forwarding_email:
        simple: ${Gmail.ForwardingAddress.forwardingEmail}
      user_id:
        simple: ${Gmail.ForwardingAddress.userId}
    separatecontext: false
    skipunavailable: true
    task:
      brand: ''
      description: Deletes the specified forwarding address and revokes any verification
        that may have been required. This method is only available to service account
        clients that have been delegated domain-wide authority.
      id: 3023b302-dc80-4e51-8b44-4489de9d410c
      iscommand: true
      name: Gmail - Remove forwarding mail address
      script: '|||gmail-forwarding-address-remove'
      type: regular
      version: -1
    taskid: 3023b302-dc80-4e51-8b44-4489de9d410c
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 710,\n    \"y\": 1880\n  }\n}"
  '26':
    continueonerrortype: ''
    id: '26'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '10'
      - '49'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: f069e81d-7b35-45fc-864e-25e9051482ab
      iscommand: false
      name: Soft Response
      type: title
      version: -1
    taskid: f069e81d-7b35-45fc-864e-25e9051482ab
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": 710,\n    \"y\": 1400\n  }\n}"
  '27':
    continueonerrortype: ''
    id: '27'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '29'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 68992710-f44d-47dc-8ddb-82e8cea3339c
      iscommand: false
      name: Hard Response
      type: title
      version: -1
    taskid: 68992710-f44d-47dc-8ddb-82e8cea3339c
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": 160,\n    \"y\": 1400\n  }\n}"
  '29':
    continueonerrortype: ''
    form:
      description: The investigation identified several suspicious indicators, suggesting
        that the user who created the forwarding rule may have been compromised. The
        forwarding email and associated filters have been automatically removed. Please
        review and decide if any additional actions should be taken.
      expired: false
      questions:
      - defaultrows: []
        fieldassociated: ''
        gridcolumns: []
        id: '0'
        label: ''
        labelarg:
          simple: "The following evidence was found: \n\n${Evidences}\n\nWould you\
            \ like to suspend the account ${Core.OriginalAlert.raw_abioc.event.identity_name}\
            \ using Google Workspace Admin?"
        options: []
        optionsarg:
        - {}
        - simple: 'Yes'
        - simple: 'No '
        placeholder: ''
        readonly: false
        required: false
        tooltip: ''
        type: singleSelect
      sender: ''
      title: Select user account containment steps
      totalanswers: 0
    id: '29'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    message:
      bcc: null
      body: null
      cc: null
      format: ''
      methods: []
      subject: null
      timings:
        completeafterreplies: 1
        completeaftersla: false
        completeafterv2: true
        retriescount: 2
        retriesinterval: 360
      to: null
    nexttasks:
      '#none#':
      - '33'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 10a29f38-0fc1-4df2-82bc-e7afb761788b
      iscommand: false
      name: Decide Whether to Suspend User Account
      type: collection
      version: -1
    taskid: 10a29f38-0fc1-4df2-82bc-e7afb761788b
    timertriggers: []
    type: collection
    view: "{\n  \"position\": {\n    \"x\": 160,\n    \"y\": 1530\n  }\n}"
  '3':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: Indicator
                filters:
                - - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: DBotScore.Type
                    operator: isEqualString
                    right:
                      value:
                        simple: ip
                - - left:
                      iscontext: true
                      value:
                        simple: DBotScore.Score
                    operator: isEqualString
                    right:
                      value:
                        simple: '3'
                root: DBotScore
          operator: isNotEmpty
          right:
            value: {}
        - left:
            iscontext: true
            value:
              complex:
                accessor: Indicator
                filters:
                - - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: DBotScore.Type
                    operator: isEqualString
                    right:
                      value:
                        simple: domain
                - - left:
                      iscontext: true
                      value:
                        simple: DBotScore.Score
                    operator: isEqualString
                    right:
                      value:
                        simple: '3'
                root: DBotScore
          operator: isNotEmpty
      label: 'yes'
    continueonerrortype: ''
    id: '3'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '5'
      'yes':
      - '48'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 4f9ab5b8-efb8-4999-873c-8390d318895c
      iscommand: false
      name: Check if forwarding email domain or IP is malicious
      type: condition
      version: -1
    taskid: 4f9ab5b8-efb8-4999-873c-8390d318895c
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 50,\n    \"y\": 450\n  }\n}"
  '30':
    continueonerrortype: ''
    id: '30'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '17'
    note: false
    quietmode: 0
    scriptarguments:
      user_key:
        simple: ${Core.OriginalAlert.raw_abioc.event.identity_name}
    separatecontext: false
    skipunavailable: true
    task:
      brand: ''
      description: Signs a user out of all web and device sessions and reset their
        sign-in cookies.
      id: 172b1869-9064-4a18-869e-a522b8602b9a
      iscommand: true
      name: Sign-Out user account from Google Workspace
      script: '|||gsuite-user-signout'
      type: regular
      version: -1
    taskid: 172b1869-9064-4a18-869e-a522b8602b9a
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 1130,\n    \"y\": 2240\n  }\n}"
  '31':
    continueonerrortype: ''
    id: '31'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '17'
    note: false
    quietmode: 0
    scriptarguments:
      suspended:
        simple: 'true'
      user_key:
        simple: ${Core.OriginalAlert.raw_abioc.event.identity_name}
    separatecontext: false
    skipunavailable: true
    task:
      brand: ''
      description: Updates a user.
      id: 1b880cd2-e9af-4734-8364-ead4ccdb0a7b
      iscommand: true
      name: Suspend user in google workspace
      script: '|||gsuite-user-update'
      type: regular
      version: -1
    taskid: 1b880cd2-e9af-4734-8364-ead4ccdb0a7b
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 160,\n    \"y\": 1880\n  }\n}"
  '33':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: Select user account containment steps.Answers.0
          operator: containsGeneral
          right:
            value:
              simple: 'yes'
      label: 'yes'
    continueonerrortype: ''
    id: '33'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '17'
      'yes':
      - '31'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 2e040f98-61ea-4032-826c-66b48eece3d7
      iscommand: false
      name: Check analyst decision
      type: condition
      version: -1
    taskid: 2e040f98-61ea-4032-826c-66b48eece3d7
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 160,\n    \"y\": 1690\n  }\n}"
  '34':
    continueonerrortype: ''
    id: '34'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '17'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 52b78c1f-6c70-4221-8440-d99cd5fa754c
      iscommand: false
      name: Early Containment Complete
      type: title
      version: -1
    taskid: 52b78c1f-6c70-4221-8440-d99cd5fa754c
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": -580,\n    \"y\": 2270\n  }\n}"
  '37':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: Evidences
                transformers:
                - operator: count
          operator: greaterThanOrEqual
          right:
            value:
              simple: '1'
        - left:
            iscontext: true
            value:
              complex:
                accessor: Indicator
                filters:
                - - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: DBotScore.Type
                    operator: isEqualString
                    right:
                      value:
                        simple: domain
                  - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: DBotScore.Type
                    operator: isEqualString
                    right:
                      value:
                        simple: ip
                - - left:
                      iscontext: true
                      value:
                        simple: DBotScore.Score
                    operator: isEqualString
                    right:
                      value:
                        simple: '3'
                root: DBotScore
          operator: isNotEmpty
      label: 'yes'
    continueonerrortype: ''
    id: '37'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '17'
      'yes':
      - '26'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: fdc9701c-599a-4494-8a76-9b500a2bf90e
      iscommand: false
      name: Check if suspicious evidence detected
      type: condition
      version: -1
    taskid: fdc9701c-599a-4494-8a76-9b500a2bf90e
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 710,\n    \"y\": 1240\n  }\n}"
  '4':
    continueonerrortype: ''
    id: '4'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '37'
      - '17'
      - '46'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 65753a7c-d6c1-4592-8094-7a9efe197055
      iscommand: false
      name: Verdict
      type: title
      version: -1
    taskid: 65753a7c-d6c1-4592-8094-7a9efe197055
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": 440,\n    \"y\": 1100\n  }\n}"
  '40':
    continueonerror: true
    continueonerrortype: ''
    id: '40'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '44'
    note: false
    quietmode: 0
    scriptarguments:
      append:
        simple: 'true'
      key:
        simple: SuspiciousKeyWords
      stringify:
        simple: 'true'
      value:
        complex:
          accessor: Criteria.query
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: Gmail.Filter.Action.forward
              operator: containsGeneral
              right:
                iscontext: true
                value:
                  simple: Core.OriginalAlert.event.raw_log.events.parameters.value
          root: Gmail.Filter
          transformers:
          - operator: StringifyArray
          - args:
              error_if_no_match: {}
              ignore_case:
                value:
                  simple: 'true'
              multi_line: {}
              period_matches_newline: {}
              regex:
                value:
                  simple: \b(accounting|agreement|bank|bic|capital call|cash|confidential|contribution|credentials|credit|deposit|dividend|docusign|finance|fund|iban|invoice|password|payment|payroll|purchase|sensitive|shares|ssn|statement|swift|tax|transfer|w2|wire|wiring
                    info|withdrawal)\b
              unpack_matches: {}
            operator: RegexExtractAll
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: "Set a value in context under the key you entered. If no value\
        \ is entered, the script doesn't do anything.\n\nThis automation runs using\
        \ the default Limited User role, unless you explicitly change the permissions.\n\
        For more information, see the section about permissions here:\n- For Cortex\
        \ XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations\
        \ \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n\
        - For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      id: cc0a92a6-27ec-43ee-852a-d6368282a74d
      iscommand: false
      name: Extract suspicious keywords from the forwarding rules
      scriptName: SetAndHandleEmpty
      type: regular
      version: -1
    taskid: cc0a92a6-27ec-43ee-852a-d6368282a74d
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 860,\n    \"y\": 765\n  }\n}"
  '43':
    continueonerror: true
    continueonerrortype: ''
    id: '43'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '4'
    note: true
    quietmode: 0
    scriptarguments:
      append:
        simple: 'true'
      key:
        simple: Evidences
      stringify:
        simple: 'true'
      value:
        complex:
          accessor: '}'
          root: ${
          transformers:
          - args:
              condition:
                value:
                  simple: lhs==rhs
              conditionB: {}
              conditionInBetween: {}
              else: {}
              equals: {}
              lhs:
                iscontext: true
                value:
                  simple: IsAbnormalGeolocation.[0]
              lhsB: {}
              options: {}
              optionsB: {}
              rhs:
                value:
                  simple: 'True'
              rhsB: {}
              then:
                value:
                  simple: The user connected from an unusual geolocation.
            operator: If-Then-Else
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: "Set a value in context under the key you entered. If no value\
        \ is entered, the script doesn't do anything.\n\nThis automation runs using\
        \ the default Limited User role, unless you explicitly change the permissions.\n\
        For more information, see the section about permissions here:\n- For Cortex\
        \ XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations\
        \ \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n\
        - For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      id: 9b154689-28ab-4f05-8ba4-e3cc23859851
      iscommand: false
      name: Set abnormal geolocation to evidence
      scriptName: SetAndHandleEmpty
      type: regular
      version: -1
    taskid: 9b154689-28ab-4f05-8ba4-e3cc23859851
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 440,\n    \"y\": 930\n  }\n}"
  '44':
    continueonerror: true
    continueonerrortype: ''
    id: '44'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '4'
    note: true
    quietmode: 0
    scriptarguments:
      append:
        simple: 'true'
      key:
        simple: Evidences
      value:
        complex:
          accessor: '}'
          root: ${
          transformers:
          - args:
              condition:
                value:
                  simple: lhs!=rhs
              conditionB: {}
              conditionInBetween: {}
              else: {}
              equals: {}
              lhs:
                iscontext: true
                value:
                  simple: SuspiciousKeyWords
              lhsB: {}
              options: {}
              optionsB: {}
              rhs: {}
              rhsB: {}
              then:
                value:
                  simple: User has defined forwarding rule with querying for suspicious
                    words
            operator: If-Then-Else
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: "Set a value in context under the key you entered. If no value\
        \ is entered, the script doesn't do anything.\n\nThis automation runs using\
        \ the default Limited User role, unless you explicitly change the permissions.\n\
        For more information, see the section about permissions here:\n- For Cortex\
        \ XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations\
        \ \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n\
        - For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      id: 47ef82fb-1c7d-4c4b-8f3b-40c46d3c5bac
      iscommand: false
      name: Set suspicious keywords to evidence
      scriptName: SetAndHandleEmpty
      type: regular
      version: -1
    taskid: 47ef82fb-1c7d-4c4b-8f3b-40c46d3c5bac
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 860,\n    \"y\": 930\n  }\n}"
  '45':
    continueonerror: true
    continueonerrortype: ''
    id: '45'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '4'
    note: true
    quietmode: 0
    scriptarguments:
      append:
        simple: 'true'
      key:
        simple: Evidences
      stringify:
        simple: 'true'
      value:
        complex:
          accessor: '}'
          root: ${
          transformers:
          - args:
              condition:
                value:
                  simple: lhs==rhs
              conditionB:
                value:
                  simple: lhsB==rhsB
              conditionInBetween:
                value:
                  simple: and
              else: {}
              equals: {}
              lhs:
                iscontext: true
                value:
                  simple: IsOutOfWorkingHours
              lhsB:
                iscontext: true
                value:
                  simple: alert.severity
              options: {}
              optionsB: {}
              rhs:
                value:
                  simple: 'true'
              rhsB:
                value:
                  simple: '3'
              then:
                value:
                  simple: User took action outside of working hours
            operator: If-Then-Else
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: "Set a value in context under the key you entered. If no value\
        \ is entered, the script doesn't do anything.\n\nThis automation runs using\
        \ the default Limited User role, unless you explicitly change the permissions.\n\
        For more information, see the section about permissions here:\n- For Cortex\
        \ XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations\
        \ \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n\
        - For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      id: 80b45a10-5b09-4f0f-89af-c4aced6131cd
      iscommand: false
      name: Set abnormal working hours to evidence
      scriptName: SetAndHandleEmpty
      type: regular
      version: -1
    taskid: 80b45a10-5b09-4f0f-89af-c4aced6131cd
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 0,\n    \"y\": 930\n  }\n}"
  '46':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: Evidences
                transformers:
                - operator: count
          operator: greaterThanOrEqual
          right:
            value:
              simple: '2'
        - left:
            iscontext: true
            value:
              complex:
                accessor: Indicator
                filters:
                - - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: DBotScore.Type
                    operator: isEqualString
                    right:
                      value:
                        simple: domain
                  - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: DBotScore.Type
                    operator: isEqualString
                    right:
                      value:
                        simple: ip
                - - left:
                      iscontext: true
                      value:
                        simple: DBotScore.Score
                    operator: isEqualString
                    right:
                      value:
                        simple: '3'
                root: DBotScore
          operator: isNotEmpty
      - - left:
            iscontext: true
            value:
              complex:
                accessor: brand
                filters:
                - - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: isEqualString
                    right:
                      value:
                        simple: GSuiteAdmin
                - - left:
                      iscontext: true
                      value:
                        simple: modules.state
                    operator: isEqualString
                    right:
                      value:
                        simple: active
                root: modules
          operator: isNotEmpty
      label: 'yes'
    continueonerrortype: ''
    id: '46'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '17'
      'yes':
      - '27'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 652eb822-a99d-4d31-8777-3d912ffd8e29
      iscommand: false
      name: Check if multiple suspicious evidence detected
      type: condition
      version: -1
    taskid: 652eb822-a99d-4d31-8777-3d912ffd8e29
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 160,\n    \"y\": 1240\n  }\n}"
  '47':
    continueonerror: true
    continueonerrortype: ''
    id: '47'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '17'
    note: false
    quietmode: 0
    scriptarguments:
      htmlBody:
        simple: "<!DOCTYPE html>\n<html>\n<head>\n  <style>\n    body {\n      font-family:\
          \ Arial, sans-serif;\n      background-color: #f4f4f9;\n      margin: 0;\n\
          \      padding: 0;\n    }\n    .container {\n      width: 80%;\n      max-width:\
          \ 600px;\n      margin: 50px auto;\n      padding: 20px;\n      background-color:\
          \ #ffffff;\n      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);\n      border-radius:\
          \ 8px;\n    }\n    h2 {\n      color: #333;\n    }\n    p {\n      color:\
          \ #555;\n      line-height: 1.6;\n    }\n    .highlight {\n      color:\
          \ #d9534f;\n      font-weight: bold;\n    }\n  </style>\n</head>\n<body>\n\
          \n<div class=\"container\">\n  <h2>Dear <span class=\"highlight\">&lt;${Core.OriginalAlert.raw_abioc.event.identity_name}&gt;</span>,</h2>\n\
          \  \n  <p>As part of our ongoing security measures, we detected unusual\
          \ activity associated with your mailbox. A forwarding address and associated\
          \ rule were automatically removed from your account to protect your data\
          \ and ensure the security of our systems.</p>\n\n  <p>If you did not set\
          \ up these rules, we recommend reviewing your recent activity and updating\
          \ your account password immediately. If you require assistance or further\
          \ information, please contact our security team.</p>\n\n  <p>Thank you for\
          \ your understanding and cooperation.</p>\n</div>\n\n</body>\n</html>\n"
      subject:
        simple: Forwarding Rule and Address Removed from Your Mailbox
      to:
        simple: ${Core.OriginalAlert.raw_abioc.event.identity_name}
      using:
        simple: Built-in Mail Sender
    separatecontext: false
    skipunavailable: true
    task:
      brand: ''
      description: Sends an email.
      id: 8f88c80e-c7e1-41f0-8f57-2e0b353172ca
      iscommand: true
      name: Send user notification via Email
      script: '|||send-mail'
      type: regular
      version: -1
    taskid: 8f88c80e-c7e1-41f0-8f57-2e0b353172ca
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 710,\n    \"y\": 2240\n  }\n}"
  '48':
    continueonerror: true
    continueonerrortype: ''
    id: '48'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '14'
    note: true
    quietmode: 0
    scriptarguments:
      append:
        simple: 'true'
      key:
        simple: Evidences
      stringify:
        simple: 'true'
      value:
        simple: Known malicious indicators detected
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: "Set a value in context under the key you entered. If no value\
        \ is entered, the script doesn't do anything.\n\nThis automation runs using\
        \ the default Limited User role, unless you explicitly change the permissions.\n\
        For more information, see the section about permissions here:\n- For Cortex\
        \ XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations\
        \ \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n\
        - For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      id: f747c163-e58c-4da6-883b-a245234aed44
      iscommand: false
      name: Save known malicious indicators detected to evidences
      scriptName: SetAndHandleEmpty
      type: regular
      version: -1
    taskid: f747c163-e58c-4da6-883b-a245234aed44
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": -580,\n    \"y\": 620\n  }\n}"
  '49':
    continueonerrortype: ''
    id: '49'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '50'
    note: false
    quietmode: 0
    scriptarguments:
      user:
        simple: ${Core.OriginalAlert.raw_abioc.event.identity_name}
    separatecontext: false
    skipunavailable: true
    task:
      brand: ''
      description: Retrieve a user's details given a user key.
      id: 89920c84-f44d-45ce-8bc5-0577831df61f
      iscommand: true
      name: Get Google Workspace user account
      script: '|||gsuite-user-get'
      type: regular
      version: -1
    taskid: 89920c84-f44d-45ce-8bc5-0577831df61f
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 1130,\n    \"y\": 1880\n  }\n}"
  '5':
    continueonerrortype: ''
    id: '5'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '22'
      - '40'
      - '21'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 971290fa-daf4-4510-81d2-610dd2cb9751
      iscommand: false
      name: Investigation
      type: title
      version: -1
    taskid: 971290fa-daf4-4510-81d2-610dd2cb9751
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": 440,\n    \"y\": 620\n  }\n}"
  '50':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: GSuite.User.id
          operator: isNotEmpty
          right:
            value: {}
      label: 'yes'
    continueonerrortype: ''
    id: '50'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '17'
      'yes':
      - '30'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 212fa2bf-f6ce-458e-846d-0536d50ed840
      iscommand: false
      name: Check if Google Workspace user account found
      type: condition
      version: -1
    taskid: 212fa2bf-f6ce-458e-846d-0536d50ed840
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 1130,\n    \"y\": 2040\n  }\n}"
  '52':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: inputs.SendNotification
          operator: isEqualString
          right:
            value:
              simple: 'true'
      label: 'yes'
    continueonerrortype: ''
    id: '52'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '17'
      'yes':
      - '47'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: d87cf812-ca8d-4017-85a4-aedb561018e7
      iscommand: false
      name: Check user notification requirement
      type: condition
      version: -1
    taskid: d87cf812-ca8d-4017-85a4-aedb561018e7
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 710,\n    \"y\": 2040\n  }\n}"
  '6':
    continueonerror: true
    continueonerrortype: ''
    id: '6'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '5'
    note: false
    quietmode: 0
    scriptarguments:
      user-id:
        simple: ${Core.OriginalAlert.event.raw_log.actor.profileId}
    separatecontext: false
    skipunavailable: true
    task:
      brand: ''
      description: Lists all filters in a user's mailbox.
      id: 59e8a285-2f0f-49c3-83c8-f7126a101b53
      iscommand: true
      name: Get filters for the specific forwarding address
      script: '|||gmail-list-filters'
      type: regular
      version: -1
    taskid: 59e8a285-2f0f-49c3-83c8-f7126a101b53
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 830,\n    \"y\": 280\n  }\n}"
tests:
- No tests (auto formatted)
version: -1
view: "{\n  \"linkLabelsPosition\": {\n    \"18_17_#default#\": 0.31,\n    \"18_25_yes\"\
  : 0.55,\n    \"33_17_#default#\": 0.32,\n    \"37_17_#default#\": 0.19,\n    \"\
  3_5_#default#\": 0.37,\n    \"46_17_#default#\": 0.19,\n    \"50_17_#default#\"\
  : 0.19,\n    \"50_30_yes\": 0.76,\n    \"52_17_#default#\": 0.5,\n    \"52_47_yes\"\
  : 0.81\n  },\n  \"paper\": {\n    \"dimensions\": {\n      \"height\": 2655,\n \
  \     \"width\": 2090,\n      \"x\": -580,\n      \"y\": -20\n    }\n  }\n}"
