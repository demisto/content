contentitemexportablefields:
  contentitemfields: {}
description: "This playbook addresses the following alerts:\n\n* WmiPrvSe.exe Rare\
  \ Child Command Line\n\n**Playbook Stages:**\n\n**Analysis:**\n\n* Enrich the attacker\u2019\
  s IP address to identify any known malicious activity.\n\n* Retrieve all alert-related\
  \ alerts to consolidate context for further analysis.\n\n**Investigation:**\n\n\
  * Analyze command-line activity to assess risks based on suspicious patterns.\n\n\
  * Check for high-confidence evidence, such as malicious IP addresses or suspicious\
  \ command-line activity, to determine the next course of action.\n\n* Evaluate medium-confidence\
  \ detections and request analyst approval for further containment if required.\n\
  \n**Containment:**\n\n* Attempt to terminate the malicious process.\n\n* Provide\
  \ guidance for manual process termination if the automated action fails.\n\n* Propose\
  \ endpoint isolation to prevent further compromise if malicious activity is confirmed."
fromversion: 8.9.0
id: silent-WmiPrvSe.exe Rare Child Command Line
inputs: []
issilent: true
name: silent-WmiPrvSe.exe Rare Child Command Line
outputs: []
starttaskid: '0'
tags:
- TA0008 - Lateral Movement
- T1021 - Remote Services
tasks:
  '0':
    continueonerrortype: ''
    id: '0'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '22'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: d0d9e83a-eb37-4c5e-8669-4610c07f402f
      iscommand: false
      name: ''
      version: -1
    taskid: d0d9e83a-eb37-4c5e-8669-4610c07f402f
    timertriggers: []
    type: start
    view: "{\n  \"position\": {\n    \"x\": 450,\n    \"y\": -150\n  }\n}"
  '1':
    continueonerrortype: ''
    id: '1'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '4'
    note: false
    quietmode: 0
    scriptarguments:
      ip:
        complex:
          accessor: actor_remote_ip
          root: Core.OriginalAlert.event
          transformers:
          - args:
              applyIfEmpty: {}
              defaultValue:
                iscontext: true
                value:
                  simple: alert.hostip
            operator: SetIfEmpty
    separatecontext: false
    skipunavailable: true
    task:
      brand: ''
      description: Checks the specified IP address against the AbuseIP database.
      id: 3dea1ef1-2e15-40b1-8043-d23c49082ae9
      iscommand: true
      name: Enrich attacker's IP address
      script: '|||ip'
      type: regular
      version: -1
    taskid: 3dea1ef1-2e15-40b1-8043-d23c49082ae9
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 663,\n    \"y\": 221\n  }\n}"
  '10':
    continueonerrortype: ''
    id: '10'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '16'
      Approved:
      - '11'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: '**Approval Required: Suspicious Activity Detection**


        The detection does not meet the thresholds for a definitive malicious verdict.
        It falls into a suspicious category based on the following conditions:


        **One of the following supporting evidences**


        * Command Line Analysis score is in range 10 to 25

        * Command Line Analysis score below 15 with a prevention rule in the same
        incident.

        * Suspicious process tree detected


        **Unmatched Verdicts:**

        * No matches for high-risk command line analysis profiles.

        * No malicious IP address detected.

        * The command line analysis score is below 15 with high-confidence indicators.


        Analyst approval is required to proceed with further containment or escalation.'
      id: b5b70f92-16a9-4883-ba8c-720d18105221
      iscommand: false
      name: 'Approval Required: Medium Confidence Detection'
      type: condition
      version: -1
    taskid: b5b70f92-16a9-4883-ba8c-720d18105221
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 830,\n    \"y\": 1350\n  }\n}"
  '11':
    continueonerrortype: ''
    id: '11'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '28'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 0a1c5a5b-8df2-4b95-8fbe-d1d655f55346
      iscommand: false
      name: Containment
      type: title
      version: -1
    taskid: 0a1c5a5b-8df2-4b95-8fbe-d1d655f55346
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": 450,\n    \"y\": 1530\n  }\n}"
  '12':
    continueonerror: true
    continueonerrortype: errorPath
    id: '12'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#error#':
      - '13'
      '#none#':
      - '27'
    note: false
    quietmode: 0
    scriptarguments:
      agent_id:
        simple: ${alert.agentid}
      instance_id:
        simple: ${alert.actionprocessinstanceid}
      timeout_in_seconds:
        simple: '180'
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Terminate a process by its instance ID. Available only for Cortex
        XSIAM 2.4 and above.
      id: cd768fe6-4308-492c-8f3f-02d4d77daf5d
      iscommand: true
      name: Terminate target process
      script: '|||core-terminate-process'
      type: regular
      version: -1
    taskid: cd768fe6-4308-492c-8f3f-02d4d77daf5d
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 70,\n    \"y\": 1840\n  }\n}"
  '13':
    continueonerrortype: ''
    id: '13'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '27'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: "Dear Analyst,\n\nDuring the containment phase, the playbook couldn\u2019\
        t terminate the process: ${Core.OriginalAlert.event.action_process_image_name}\n\
        \nPlease terminate the process manually if possible."
      id: be6e0678-b817-46a9-8a0d-f6b2ac546436
      iscommand: false
      name: Terminate Process Manually
      type: regular
      version: -1
    taskid: be6e0678-b817-46a9-8a0d-f6b2ac546436
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 450,\n    \"y\": 2007\n  }\n}"
  '14':
    continueonerrortype: ''
    id: '14'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '15'
    note: false
    quietmode: 0
    scriptarguments:
      closeNotes:
        simple: The alert has been resolved. Confirmed as a True Positive by the playbook
          "WmiPrvSe.exe Rare Child Command Line"
      closeReason:
        simple: Resolved - True Positive
      id:
        simple: ${alert.id}
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.close.inv
      id: b9bddcb7-e2bf-4cb6-8ccf-9a10b71ffb8a
      iscommand: true
      name: Close the Alert as True Positive
      script: Builtin|||closeInvestigation
      type: regular
      version: -1
    taskid: b9bddcb7-e2bf-4cb6-8ccf-9a10b71ffb8a
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 172,\n    \"y\": 3007\n  }\n}"
  '15':
    continueonerrortype: ''
    id: '15'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 7f02a14e-8ff0-4bb6-860b-17d2471ce868
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: 7f02a14e-8ff0-4bb6-860b-17d2471ce868
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": 172,\n    \"y\": 3177\n  }\n}"
  '16':
    continueonerrortype: ''
    id: '16'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '15'
    note: false
    quietmode: 0
    scriptarguments:
      closeNotes:
        simple: The alert has been resolved. Confirmed as a False Positive by the
          playbook "WmiPrvSe.exe Rare Child Command Line"
      closeReason:
        simple: Resolved - False Positive
      id:
        simple: ${alert.id}
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.close.inv
      id: 7122a5a1-429a-4ba1-8069-c7d736845fa1
      iscommand: true
      name: Close the Alert as False Positive
      script: Builtin|||closeInvestigation
      type: regular
      version: -1
    taskid: 7122a5a1-429a-4ba1-8069-c7d736845fa1
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 1140,\n    \"y\": 3007\n  }\n}"
  '17':
    continueonerrortype: ''
    id: '17'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    message:
      bcc: null
      body: null
      cc: null
      format: ''
      methods: []
      replyOptions:
      - Isolate
      subject: null
      timings:
        completeafterreplies: 1
        completeaftersla: false
        completeafterv2: true
        retriescount: 2
        retriesinterval: 360
      to: null
    nexttasks:
      '#default#':
      - '14'
      Isolate:
      - '18'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: "**Recommendation: Isolation Required \u2013 Malicious Activity\
        \ Detected**\n\nThe detection meets high-confidence criteria for malicious\
        \ activity based on the following conditions:\n\n**Matched Verdicts:**\n*\
        \ Matches for high-risk command line analysis profiles: mixed_case_powershell,\
        \ double_encoding, amsi_techniques, malicious_commands, or powershell_suspicious_network_patterns.\n\
        \n* Score >= 25, indicating high confidence probability for malicious behavior.\n\
        \n**Action Required:**\n\n* Isolate the remote host: ${Endpoint.Hostname}"
      id: 095c11b6-e83f-49f8-8761-24fe79b5d968
      iscommand: false
      name: "Approval Required \u2013 Malicious Activity Detected"
      type: condition
      version: -1
    taskid: 095c11b6-e83f-49f8-8761-24fe79b5d968
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 451,\n    \"y\": 2670\n  }\n}"
  '18':
    continueonerrortype: ''
    id: '18'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '14'
    note: false
    quietmode: 0
    scriptarguments:
      endpoint_id:
        simple: ${Endpoint.ID}
      incident_id:
        complex:
          accessor: parentXDRIncident
          root: alert
          transformers:
          - args:
              delimiter:
                value:
                  simple: '-'
              fields:
                value:
                  simple: '2'
            operator: Cut
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Isolates the specified endpoint.
      id: 7df12c62-a960-428c-8e0f-dccf404b63e0
      iscommand: true
      name: Isolate endpoint
      script: '|||core-isolate-endpoint'
      type: regular
      version: -1
    taskid: 7df12c62-a960-428c-8e0f-dccf404b63e0
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 451,\n    \"y\": 2865\n  }\n}"
  '19':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: CommandLineAnalysis.findings
          operator: AnyMatch
          right:
            value:
              simple: mixed case powershell, reversed command, powershell suspicious
                patterns, credential dumping, double encoding, amsi techniques, malicious
                commands
        - left:
            iscontext: true
            value:
              simple: CommandLineAnalysis.score
          operator: greaterThanOrEqual
          right:
            value:
              simple: '25'
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: Core.Endpoint.is_isolated
          operator: isEqualString
          right:
            value:
              simple: AGENT_UNISOLATED
      label: 'Yes'
    continueonerrortype: ''
    id: '19'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '14'
      'Yes':
      - '23'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: If the condition "Check for high-confidence evidence" was matched
        and the endpoint ID is available, an endpoint isolation is suggested.
      id: aa59de8b-dca5-485b-90db-49fc8bad71dc
      iscommand: false
      name: Should proceed to isolate the endpoint?
      type: condition
      version: -1
    taskid: aa59de8b-dca5-485b-90db-49fc8bad71dc
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 451,\n    \"y\": 2310\n  }\n}"
  '22':
    continueonerrortype: ''
    id: '22'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '26'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 7ae38b7e-4c38-4c10-8cd6-1e935e4e0e4f
      iscommand: false
      name: Analysis
      type: title
      version: -1
    taskid: 7ae38b7e-4c38-4c10-8cd6-1e935e4e0e4f
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": 450,\n    \"y\": -20\n  }\n}"
  '23':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: Core.Endpoint.endpoint_type
          operator: containsString
          right:
            value:
              simple: WORKSTATION
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: Core.Endpoint.endpoint_status
          operator: isEqualString
          right:
            value:
              simple: CONNECTED
      label: WORKSTATION
    continueonerrortype: ''
    id: '23'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '24'
      WORKSTATION:
      - '17'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Checks whether the endpoint is a workstation or a server.
      id: c5470fce-c24b-4768-844b-ce10abd9c6ba
      iscommand: false
      name: Check if the endpoint is workstation or a server
      type: condition
      version: -1
    taskid: c5470fce-c24b-4768-844b-ce10abd9c6ba
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 451,\n    \"y\": 2490\n  }\n}"
  '24':
    continueonerrortype: ''
    id: '24'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '14'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: "Dear Analyst,\n\nPlease note that during the remediation process,\
        \ the playbook didn't isolate the following host: ${Endpoint.Hostname} \n\n\
        This is due to one of the following reasons:\n- The device disconnected.\n\
        - The device has been identified as a server.\n\nPlease take manual action\
        \ to contain the attack and prevent the attacker from executing lateral movement\
        \ before closing this alert."
      id: dc9a785d-392b-4233-89ad-b308d3412477
      iscommand: false
      name: Manual remediation actions for a server or a disconnected endpoint
      type: regular
      version: -1
    taskid: dc9a785d-392b-4233-89ad-b308d3412477
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 891,\n    \"y\": 2670\n  }\n}"
  '25':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: alert.initiatedby
          operator: containsGeneral
          right:
            value:
              simple: WmiPrvSE.exe
        - ignorecase: true
          left:
            iscontext: true
            value:
              simple: alert.initiatedby
          operator: containsGeneral
          right:
            value:
              simple: WMIC.exe
        - ignorecase: true
          left:
            iscontext: true
            value:
              simple: alert.initiatedby
          operator: containsGeneral
          right:
            value:
              simple: WMICodeCreator.exe
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: alert.targetprocessname
          operator: containsGeneral
          right:
            value:
              simple: powershell.exe
        - ignorecase: true
          left:
            iscontext: true
            value:
              simple: alert.targetprocessname
          operator: containsGeneral
          right:
            value:
              simple: cmd.exe
        - ignorecase: true
          left:
            iscontext: true
            value:
              simple: alert.targetprocessname
          operator: containsGeneral
          right:
            value:
              simple: ntdsutil.exe
        - ignorecase: true
          left:
            iscontext: true
            value:
              simple: alert.targetprocessname
          operator: containsGeneral
          right:
            value:
              simple: rundll32.exe
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: alert.targetprocesscmd
          operator: notContainsGeneral
          right:
            value:
              simple: C:\Windows\CCM
      label: 'yes'
    continueonerrortype: ''
    id: '25'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '16'
      'yes':
      - '10'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Checks if a suspicious process execution chain was detected. This
        Indicates a high probability of malicious behavior.
      id: d5bfd9fb-9daf-442c-8107-77255db16b94
      iscommand: false
      name: Check for suspicious process tree
      type: condition
      version: -1
    taskid: d5bfd9fb-9daf-442c-8107-77255db16b94
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 1140,\n    \"y\": 1150\n  }\n}"
  '26':
    continueonerrortype: ''
    id: '26'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '1'
      - '6'
    note: false
    quietmode: 0
    scriptarguments:
      alert_ids:
        simple: ${alert.id}
      filter_alert_fields:
        simple: 'false'
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Returns information about each alert ID.
      id: f0b93f7f-3f2c-4141-8de9-78fa361a7597
      iscommand: true
      name: Get the attacker's remote host IP address
      script: '|||core-get-cloud-original-alerts'
      type: regular
      version: -1
    taskid: f0b93f7f-3f2c-4141-8de9-78fa361a7597
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 450,\n    \"y\": 93\n  }\n}"
  '27':
    continueonerrortype: ''
    id: '27'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '19'
    note: false
    quietmode: 0
    scriptarguments:
      endpoint_id_list:
        simple: ${alert.agentid}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Gets a list of endpoints, according to the passed filters. If there
        are no filters, all endpoints are returned. Filtering by multiple fields will
        be concatenated using AND condition (OR is not supported). Maximum result
        set size is 100. Offset is the zero-based number of the endpoint from the
        start of the result set (start by counting from 0).
      id: de317f0e-4b02-4628-81fa-134576939a13
      iscommand: true
      name: Get endpoint status
      script: '|||core-get-endpoints'
      type: regular
      version: -1
    taskid: de317f0e-4b02-4628-81fa-134576939a13
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 451,\n    \"y\": 2140\n  }\n}"
  '28':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: alert.cgoname
          operator: containsGeneral
          right:
            value:
              simple: WmiPrvSE.exe
        - ignorecase: true
          left:
            iscontext: true
            value:
              simple: alert.cgoname
          operator: containsGeneral
          right:
            value:
              simple: WMIC.exe
        - ignorecase: true
          left:
            iscontext: true
            value:
              simple: alert.cgoname
          operator: containsGeneral
          right:
            value:
              simple: WMICodeCreator.exe
      label: WMI
    continueonerrortype: ''
    id: '28'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '29'
      WMI:
      - '12'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Check if the causality process image name is WMI.
      id: 894c36a0-db47-468b-887c-79316156c692
      iscommand: false
      name: Check if the causality is WMI
      type: condition
      version: -1
    taskid: 894c36a0-db47-468b-887c-79316156c692
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 450,\n    \"y\": 1643\n  }\n}"
  '29':
    continueonerror: true
    continueonerrortype: errorPath
    id: '29'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#error#':
      - '13'
      '#none#':
      - '27'
    note: false
    quietmode: 0
    scriptarguments:
      agent_id:
        simple: ${alert.agentid}
      causality_id:
        simple: ${alert.cid}
      timeout_in_seconds:
        simple: '180'
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Terminate a process tree by its causality ID. Available only for
        Cortex XSIAM 2.4 and above.
      id: 2aabb75e-d911-4d92-8974-0891c6156934
      iscommand: true
      name: Terminate causality process
      script: '|||core-terminate-causality'
      type: regular
      version: -1
    taskid: 2aabb75e-d911-4d92-8974-0891c6156934
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 819,\n    \"y\": 1840\n  }\n}"
  '3':
    continueonerrortype: ''
    id: '3'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '5'
    note: false
    quietmode: 0
    scriptarguments:
      command_line:
        complex:
          accessor: targetprocesscmd
          root: alert
          transformers:
          - args:
              item:
                iscontext: true
                value:
                  simple: alert.initiatorcmd
            operator: append
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: 'This script evaluates command-line threats by analyzing both original
        and decoded inputs. It assigns weighted scores to detected patterns, such
        as AMSI bypass or credential dumping, and applies risk combination bonuses
        for multiple detections. The total score is normalized to a 0-100 scale, with
        risk levels categorized as follows:


        * 0-25: Low Risk

        * 26-50: Medium Risk

        * 51-90: High Risk

        * 91-100: Critical Risk


        The scoring mechanism provides a comprehensive risk assessment, considering
        both the severity and frequency of malicious behaviors.'
      id: e6a68fa1-07fe-477e-839b-e34f1ea94317
      iscommand: false
      name: Analyze command line
      scriptName: CommandLineAnalysis
      type: regular
      version: -1
    taskid: e6a68fa1-07fe-477e-839b-e34f1ea94317
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 450,\n    \"y\": 478\n  }\n}"
  '4':
    continueonerrortype: ''
    id: '4'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '3'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: ''
      id: 2bc56cd9-7962-499b-8b89-2c1019c24e51
      iscommand: false
      name: Investigation
      type: title
      version: -1
    taskid: 2bc56cd9-7962-499b-8b89-2c1019c24e51
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": 450,\n    \"y\": 365\n  }\n}"
  '5':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: CommandLineAnalysis.findings
          operator: AnyMatch
          right:
            value:
              simple: mixed case powershell, reversed command, powershell suspicious
                patterns, credential dumping, double encoding, amsi techniques, malicious
                commands
        - left:
            iscontext: true
            value:
              complex:
                accessor: Score
                filters:
                - - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: DBotScore.Type
                    operator: isEqualString
                    right:
                      value:
                        simple: IP
                root: DBotScore
          operator: isEqualString
          right:
            value:
              simple: '3'
        - left:
            iscontext: true
            value:
              simple: CommandLineAnalysis.score
          operator: greaterThanOrEqual
          right:
            value:
              simple: '25'
      label: Malicious
    continueonerrortype: ''
    id: '5'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '8'
      Malicious:
      - '11'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: 'This task evaluates the command line analysis results and checks
        if the profile matches one or more high-risk categories or if the overall
        score indicates a critical risk.


        **Conditions:**


        - A profile matches one or more of the following categories: **mixed case
        PowerShell, reversed command, PowerShell suspicious patterns, credential dumping,
        double encoding, AMSI techniques, or malicious commands.**

        - OR the score is **greater than or equal to 25**.

        - OR an **IP address** involved in the alert is flagged as **malicious**.


        If any condition is met, mark the result as **Malicious**.'
      id: e3a5f626-810e-4be2-814a-4e7e39a901b6
      iscommand: false
      name: Check for high-confidence evidence or malicious IP address
      type: condition
      version: -1
    taskid: e3a5f626-810e-4be2-814a-4e7e39a901b6
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 450,\n    \"y\": 602\n  }\n}"
  '6':
    continueonerrortype: ''
    id: '6'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '4'
    note: false
    quietmode: 0
    scriptarguments:
      query:
        complex:
          accessor: parentXDRIncident
          root: alert
          transformers:
          - args:
              delimiter:
                value:
                  simple: '-'
              fields:
                value:
                  simple: '2'
            operator: Cut
          - args:
              prefix:
                value:
                  simple: 'caseid:'
              suffix: {}
            operator: concat
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: This task searches for Cortex XSIAM alerts related to the current
        incident.
      id: 19cbb840-f9a2-4334-8050-ea85ec73736a
      iscommand: false
      name: Retrieve all incident alerts
      scriptName: SearchIncidentsV2
      type: regular
      version: -1
    taskid: 19cbb840-f9a2-4334-8050-ea85ec73736a
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 230,\n    \"y\": 221\n  }\n}"
  '8':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: CommandLineAnalysis.score
          operator: greaterThanOrEqual
          right:
            value:
              simple: '15'
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: foundIncidents.CustomFields.action
          operator: containsGeneral
          right:
            value:
              simple: BLOCKED
        - left:
            iscontext: true
            value:
              simple: foundIncidents.CustomFields.action
          operator: isEqualString
          right:
            value:
              simple: REPORTED
      label: Malicious
    - condition:
      - - left:
            iscontext: true
            value:
              simple: CommandLineAnalysis.score
          operator: lessThan
          right:
            value:
              simple: '15'
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: foundIncidents.CustomFields.action
          operator: containsGeneral
          right:
            value:
              simple: BLOCKED
        - left:
            iscontext: true
            value:
              simple: foundIncidents.CustomFields.action
          operator: isEqualString
          right:
            value:
              simple: REPORTED
      label: Medium Confidence
    continueonerrortype: ''
    id: '8'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '9'
      Malicious:
      - '11'
      Medium Confidence:
      - '10'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: 'This task identifies the risk level by considering the score and
        whether a prevention rule is present in the same alert.


        **Conditions:**


        - If Score is **greater than or equal to 15** AND a **prevention rule exists**
        in the same alert, classify the result as **Malicious**.

        - Else, if Score is **less than 15** AND a **prevention rule exists** in the
        same alert, classify the result as **Suspicious**.


        High-risk behavior with prevention rule: **Malicious**.

        Low-risk behavior with prevention rule: **Suspicious**.

        '
      id: 80d9b967-a4d6-46a5-814a-06d806805237
      iscommand: false
      name: Check for medium-confidence threshold with a prevention alert
      type: condition
      version: -1
    taskid: 80d9b967-a4d6-46a5-814a-06d806805237
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 450,\n    \"y\": 780\n  }\n}"
  '9':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: CommandLineAnalysis.score
          operator: InRange
          right:
            value:
              simple: 10,25
      label: 'yes'
    continueonerrortype: ''
    id: '9'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '25'
      'yes':
      - '10'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: "This task identifies medium-risk cases based on the score received\
        \ from the command line analysis script.\n\n**Conditions:**\n\nIf the score\
        \ is in the range of **10\u201325**, mark the result as **Suspicious**."
      id: d7ea9ec9-e8b0-4c5f-8ecf-84dcbb2b422a
      iscommand: false
      name: Check for medium-confidence and request remediation approval
      type: condition
      version: -1
    taskid: d7ea9ec9-e8b0-4c5f-8ecf-84dcbb2b422a
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 830,\n    \"y\": 960\n  }\n}"
tests:
- No tests (auto formatted)
version: -1
view: "{\n  \"linkLabelsPosition\": {\n    \"10_11_Approved\": 0.38,\n    \"10_16_#default#\"\
  : 0.1,\n    \"12_13_#error#\": 0.64,\n    \"17_14_#default#\": 0.43,\n    \"17_18_Isolate\"\
  : 0.4,\n    \"19_14_#default#\": 0.21,\n    \"19_23_Yes\": 0.37,\n    \"23_17_WORKSTATION\"\
  : 0.46,\n    \"23_24_#default#\": 0.62,\n    \"25_10_yes\": 0.55,\n    \"25_16_#default#\"\
  : 0.1,\n    \"28_12_WMI\": 0.59,\n    \"28_29_#default#\": 0.6,\n    \"29_13_#error#\"\
  : 0.63,\n    \"5_11_Malicious\": 0.4,\n    \"5_8_#default#\": 0.42,\n    \"8_10_Medium\
  \ Confidence\": 0.82,\n    \"8_11_Malicious\": 0.8,\n    \"8_9_#default#\": 0.64,\n\
  \    \"9_10_yes\": 0.25,\n    \"9_25_#default#\": 0.48\n  },\n  \"paper\": {\n \
  \   \"dimensions\": {\n      \"height\": 3387,\n      \"width\": 1451,\n      \"\
  x\": 70,\n      \"y\": -150\n    }\n  }\n}"
