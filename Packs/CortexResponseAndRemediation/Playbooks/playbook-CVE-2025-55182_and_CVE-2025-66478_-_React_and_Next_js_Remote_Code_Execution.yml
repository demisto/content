id: CVE-2025-55182 and CVE-2025-66478 - React and Next js Remote Code Execution
version: -1
contentitemexportablefields:
  contentitemfields: {}
name: CVE-2025-55182 and CVE-2025-66478 - React and Next js Remote Code Execution
description: "## CVE-2025-55182  and CVE-2025-66478 - React and Next.js Remote Code Execution\n\n##   Vulnerability Overview\n\n- **Vulnerability Name**: Insecure Deserialization in React Server Components (RSC) \"Flight\" Protocol (Also referred to as React2Shell)\n- **CVE ID**: CVE-2025-55182 (Primary React RCE) and CVE-2025-66478 (Next.js RCE, affecting downstream implementations).\n- **CVSS Score**: 10 (Critical)  \n\n\nAn unauthenticated Remote Code Execution (RCE) vulnerability exists in the core packages used by React Server Components (RSC), which are primarily exposed via the Next.js App Router. The flaw is an insecure deserialization issue in the RSC \"Flight\" protocol that allows an attacker to execute arbitrary code on the server by sending a single, crafted HTTP request. The vulnerability is present in default configurations of affected applications.\n[Source: Unit42 - Palo Alto Networks](https://unit42.paloaltonetworks.com/cve-2025-55182-react-and-cve-2025-66478-next/)\n\n\n##  Mitigation and Recommendations\n\n- **Apply Patch**\n- **Restrict Access** to the vulnerable serves  \n- **Monitor for IoCs and suspicious traffic**  \n\n##  Conclusion\n\nCVE‑2025‑55182 is a critical, highly reliable, and unauthenticated RCE vulnerability in the modern React ecosystem. Due to its remote exploitability without user interaction or authentication, immediate patching is required to prevent server compromise.\n\n[View official CVE details on NIST](https://nvd.nist.gov/vuln/detail/CVE-2025-55182)\n\n## Vulnerable Versions\n\n**React**: Versions 19.0, 19.1, and 19.2\n**Next.js**: Versions 15.x and 16.x (App Router), as well as Canary builds starting from 14.3.0\n**Other frameworks**: Any library bundling the react-server implementation, including React Router, Waku, RedwoodSDK, Parcel and Vite RSC plugins\n\n\n##  Playbook Triggers\n- Manually - Create a new incident and select this playbook from the dropdown menu.\n\n##  Playbook Flow\n1. Collects IOCs from the Unit42 blog.\n2. Uses XQL to detect any suspicious command lines indicative of exploitation of this vulnerability.\n3. Investigates the command lines to identify malicious indicators related to the vulnerability.\n4. Uses XQL to hunt for malicious IOCs.\n5. Isolates possible compromised servers.\n6. Blocks malicious indicators using the \"Containment Plan – Block Indicators\" playbook.\n7. Provides mitigation recommendations.\n\nNote: This is a beta playbook, which lets you implement and test pre-release software. Since the playbook is beta, it might contain bugs. Updates to the pack during the beta phase might include non-backward compatible features. We appreciate your feedback on the quality and usability of the pack to help us identify issues, fix them, and continually improve.\n"
tags:
- Rapid Breach Response
- CVE-2025-55182
- CVE-2025-66478
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 4f736e78-7eb6-41fa-81ed-bbeca58eacae
    type: start
    task:
      id: 4f736e78-7eb6-41fa-81ed-bbeca58eacae
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "9"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201.5,
          "y": 320
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: c87272a4-3ee4-43fa-ace5-beacf4096c65
    type: title
    task:
      id: c87272a4-3ee4-43fa-ace5-beacf4096c65
      version: -1
      name: Collect Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "124"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201.5,
          "y": 475
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: 3d831be1-6556-4faf-88b0-2e8b481cb2eb
    type: regular
    task:
      id: 3d831be1-6556-4faf-88b0-2e8b481cb2eb
      version: -1
      name: Extract indicators from collected data
      description: commands.local.cmd.extract.indicators
      script: Builtin|||extractIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "22"
    scriptarguments:
      text:
        complex:
          root: http.parsedBlog
          accessor: indicators
          transformers:
          - operator: RemoveEmpty
            args:
              empty_values: {}
              remove_keys:
                value:
                  simple: "true"
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201.5,
          "y": 900
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: 220a4b75-0667-4734-8c12-021056d92c17
    type: title
    task:
      id: 220a4b75-0667-4734-8c12-021056d92c17
      version: -1
      name: Tag and Link Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "23"
      - "24"
      - "51"
      - "163"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201,
          "y": 1040
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: 3aa38607-a47e-4013-9840-d577ab586429
    type: regular
    task:
      id: 3aa38607-a47e-4013-9840-d577ab586429
      version: -1
      name: Tag URL Indicators
      description: commands.local.cmd.new.indicator
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      retry-count:
        simple: "3"
      retry-interval:
        simple: "2"
      tags:
        simple: CVE-2025-55182,CVE-2025-66478
      type:
        simple: URL
      value:
        complex:
          root: ExtractedIndicators.URL
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: ExtractedIndicators.URL
                iscontext: true
          transformers:
          - operator: uniq
      verdict:
        simple: Malicious
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3999.25,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: 3aaa1980-1f5c-4895-82f9-c6e3a25eae55
    type: regular
    task:
      id: 3aaa1980-1f5c-4895-82f9-c6e3a25eae55
      version: -1
      name: Tag CVE Indicators
      description: commands.local.cmd.new.indicator
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      retry-count:
        simple: "3"
      retry-interval:
        simple: "2"
      tags:
        simple: React and Next.js Remote Code Execution
      type:
        simple: CVE
      verdict:
        simple: Malicious
      value:
        complex:
          root: ExtractedIndicators
          accessor: CVE
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4401.5,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: 5ba25eb1-0569-482c-859b-4206b489a674
    type: title
    task:
      id: 5ba25eb1-0569-482c-859b-4206b489a674
      version: -1
      name: Extract Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "21"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201.5,
          "y": 761
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 8c57d83d-bfad-4566-88f4-e9269479223b
    type: title
    task:
      id: 8c57d83d-bfad-4566-88f4-e9269479223b
      version: -1
      name: Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "84"
      - "150"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4213,
          "y": 3350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: 3079d164-b58b-4367-853d-bbdd8f0494ca
    type: title
    task:
      id: 3079d164-b58b-4367-853d-bbdd8f0494ca
      version: -1
      name: Mitigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "99"
      - "87"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4213,
          "y": 4746
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: 69926028-10a9-4b1f-953f-a71cf1729657
    type: condition
    task:
      id: 69926028-10a9-4b1f-953f-a71cf1729657
      version: -1
      name: Analysis Resolution - Should continue with the investigation?
      description: |+
        ## Check with the analyst to determine whether to continue the investigation.

        - Verify that all affected React and Next.js servers are patched.

        - Check if the Threat Hunting steps returned results (if any).

        - Check for results from the command line analysis. Investigate further and take necessary actions.

         Validate that there are no other affected systems, and that potential attack patterns have been investigated.


      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "No":
      - "37"
      "Yes":
      - "36"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4213,
          "y": 5417
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
        simple: Do you need to continue with the investigation?
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
      replyOptions:
      - "Yes"
      - "No"
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: afc3aacb-3bcd-41c4-89e3-86037762d900
    type: title
    task:
      id: afc3aacb-3bcd-41c4-89e3-86037762d900
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4213,
          "y": 5728
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: ce542013-b78e-4801-909e-ddf1d3e60e31
    type: regular
    task:
      id: ce542013-b78e-4801-909e-ddf1d3e60e31
      version: -1
      name: Investigate Further
      description: |+
        ## Manual steps for further alert investigation.

        - Continue monitoring for IOCs and suspicious activity.
        - Check for any additional suspicious artifacts identified during the investigation and continue your analysis on them.

      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "35"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3980,
          "y": 5565
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: 275fcfc2-93e3-4a42-8f0a-eee78c7d5758
    type: regular
    task:
      id: 275fcfc2-93e3-4a42-8f0a-eee78c7d5758
      version: -1
      name: Close Investigation
      description: Close the current alert
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "35"
    scriptarguments:
      closeReason:
        simple: No further actions are required.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4443,
          "y": 5565
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: 4c900ab8-62d9-4cf8-8a04-82a9b4f24176
    type: title
    task:
      id: 4c900ab8-62d9-4cf8-8a04-82a9b4f24176
      version: -1
      name: Resolution
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "34"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4213,
          "y": 5245
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "48":
    id: "48"
    taskid: 90b93413-b835-4a63-9fd2-6014cc6be473
    type: regular
    task:
      id: 90b93413-b835-4a63-9fd2-6014cc6be473
      version: -1
      name: Link Indicators to Alert
      description: commands.local.cmd.associate.indicators
      script: Builtin|||associateIndicatorsToAlert
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "135"
    scriptarguments:
      alertId:
        simple: ${alert.id}
      indicatorsValues:
        complex:
          root: ExtractedIndicators.URL
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: ExtractedIndicators.URL
                iscontext: true
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.Domain
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.CVE
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.File
          - operator: RemoveEmpty
            args:
              empty_values: {}
              remove_keys:
                value:
                  simple: "true"
          - operator: uniq
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201.5,
          "y": 1341
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "51":
    id: "51"
    taskid: cfd5e8f1-2c23-4e86-a0e4-cf4543718268
    type: regular
    task:
      id: cfd5e8f1-2c23-4e86-a0e4-cf4543718268
      version: -1
      name: Tag Domain Indicators
      description: commands.local.cmd.new.indicator
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      retry-count:
        simple: "3"
      retry-interval:
        simple: "2"
      tags:
        simple: CVE-2025-55182,CVE-2025-66478
      type:
        simple: Domain
      value:
        complex:
          root: ExtractedIndicators.Domain
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: ExtractedIndicators.Domain
                iscontext: true
          - - operator: isNotEqualString
              left:
                value:
                  simple: ExtractedIndicators.Domain
                iscontext: true
              right:
                value:
                  simple: raw.githubusercontent.com
              ignorecase: true
          transformers:
          - operator: uniq
      verdict:
        simple: Malicious
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4795,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "68":
    id: "68"
    taskid: 4470f07a-5ebb-4a2d-9564-2b3c5a839337
    type: title
    task:
      id: 4470f07a-5ebb-4a2d-9564-2b3c5a839337
      version: -1
      name: Finish Threat Hunting
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "28"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4213,
          "y": 3160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "74":
    id: "74"
    taskid: 21395bd2-2dfb-4eb9-a30c-b38dfefd5287
    type: regular
    task:
      id: 21395bd2-2dfb-4eb9-a30c-b38dfefd5287
      version: -1
      name: XQL Query - Search for possible malicious command lines
      description: Execute an XQL query to detect suspicious command lines on potentially compromised React and Next.js servers.
      script: '|||xdr-xql-generic-query'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#error#':
      - "79"
      '#none#':
      - "138"
    scriptarguments:
      extend-context:
        simple: XQLPossibleMaliciousCmd=
      ignore-outputs:
        simple: "true"
      max_fields:
        simple: "100"
      query:
        simple: |
          // Description: This query attempts to identify possible node processes spawning two or more post-exploitation lolbins.
          // Notes: This has the potential to capture false-positives, it is recommended to  investigate the children processes spawned by the node process and check for suspicious file operations, network operations, reconnaissance commands or code execution.

          config case_sensitive = false
          | preset=xdr_process
          | filter (actor_process_image_name in ("node","node.exe", "bun", "bun.exe") and actor_process_command_line in ("*react-dom*", "*.next*", "*node_modules/next*", "*react-server*", "*next-server*", "*node server.js*", "*bin/next*", "*--experimental-https*", "*app/server*", "*.pnpm/next*", "*next start*", "*next dev*", "*react-scripts start*", "*next/dist/server*")) or (causality_actor_process_image_name in ("node","node.exe", "bun", "bun.exe") and causality_actor_process_command_line in ("*react-dom*", "*.next*", "*node_modules/next*", "*react-server*", "*next-server*", "*node server.js*", "*bin/next*", "*--experimental-https*", "*app/server*", "*.pnpm/next*", "*next start*", "*next dev*", "*react-scripts start*", "*next/dist/server*"))

          | filter actor_process_command_line not in ("*homebrew*", "*git config*", "*/users*", "*/usr*", "*\users*", "*gcloud config*", "*git branch*", "*git describe*") and action_process_image_command_line not in ("*homebrew*", "*git config*", "*/users*", "*/usr*", "*\users*", "*gcloud config*", "*git branch*", "*git describe*") and causality_actor_process_command_line not in ("*Microsoft VS Code*", "*iTerm2*", "*Visual Studio Code*") and action_process_image_name not in ("node", "node.exe")

          | alter suspicious_processes = arraycreate("id", "curl", "wget", "whoami", "arp", "at.exe", "hostname", "nbstat.exe", "netsh.exe", "netstat.exe", "nslookup", "ping.exe", "query.exe", "systeminfo.exe", "tasklist.exe", "traceroute.exe", "ipconfig.exe", "whoami.exe", "whois.exe", "quser.exe", "mshta.exe", "jscript.exe", "cscript.exe", "wscript.exe", "qwinsta.exe", "nltest.exe", "csvde.exe", "wevtutil.exe", "driverquery.exe", "nbtscan.exe", "ntdsutil.exe", "vssadmin.exe", "dsquery.exe", "adfind.exe", "klist.exe", "vssvc.exe", "nc", "ncat", "netcat", "base64", "uname", "dmidecode", "ip addr", "chmod -x", "chmod 7", "socat", "nohup", "setsid", "powershell.exe", "cmd.exe", "bash", "sh", "zsh", "mkfifo", "rundll32.exe", "java", "python", "python.exe", "php", "ifconfig", "net.exe", "net1.exe", "/dev/udp", "/dev/tcp", "adduser", "useradd", "lua", "crontab", "mknod")

          | alter matches = arrayfilter(suspicious_processes , action_process_image_command_line contains "@element")

          | comp count_distinct(action_process_image_command_line) as num_procs, values(action_process_image_command_line) as action_process_image_command_line,values(causality_actor_process_command_line) as causality_actor_process_command_line by agent_hostname, actor_process_image_name, actor_process_command_line, action_process_image_name
          | filter num_procs > 1
      query_name:
        simple: Check for possibles malicious command lines
      time_frame:
        simple: 21 days ago
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": 4795,
          "y": 1985
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "75":
    id: "75"
    taskid: 91a0d16b-b0b9-4982-8072-b5ae13b75e29
    type: condition
    task:
      id: 91a0d16b-b0b9-4982-8072-b5ae13b75e29
      version: -1
      name: Is the integration of 'XQL Query Engine' available?
      description: Returns 'yes' if integration brand 'XQL Query Engine' is available. Otherwise returns 'no'.
      scriptName: IsIntegrationAvailable
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "79"
      "yes":
      - "74"
    scriptarguments:
      brandname:
        simple: XQL Query Engine
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4795,
          "y": 1799
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "79":
    id: "79"
    taskid: ddd5f659-695e-40ef-a049-2c72b0b71bc4
    type: regular
    task:
      id: ddd5f659-695e-40ef-a049-2c72b0b71bc4
      version: -1
      name: Manual – Search web shells using XQL query and quarantine the files
      description: |-
        Dear Analyst,

        Ensure that the 'XQL Query Engine' integration is active. If it is not enabled, activate the integration or manually run the following XQL query to retrieve possible malicious command lines executed on potentially compromised React and Next.js servers.

        You can use the following XQL query:

        **Query:**
        Execute an XQL query to retrieve possible executed malicious command lines on potentially compromised React and Next.js servers.

        ```

        config case_sensitive = false
        | preset=xdr_process
        | filter (actor_process_image_name in ("node","node.exe", "bun", "bun.exe") and actor_process_command_line in ("*react-dom*", "*.next*", "*node_modules/next*", "*react-server*", "*next-server*", "*node server.js*", "*bin/next*", "*--experimental-https*", "*app/server*", "*.pnpm/next*", "*next start*", "*next dev*", "*react-scripts start*", "*next/dist/server*")) or (causality_actor_process_image_name in ("node","node.exe", "bun", "bun.exe") and causality_actor_process_command_line in ("*react-dom*", "*.next*", "*node_modules/next*", "*react-server*", "*next-server*", "*node server.js*", "*bin/next*", "*--experimental-https*", "*app/server*", "*.pnpm/next*", "*next start*", "*next dev*", "*react-scripts start*", "*next/dist/server*"))

        | filter actor_process_command_line not in ("*homebrew*", "*git config*", "*/users*", "*/usr*", "*\users*", "*gcloud config*", "*git branch*", "*git describe*") and action_process_image_command_line not in ("*homebrew*", "*git config*", "*/users*", "*/usr*", "*\users*", "*gcloud config*", "*git branch*", "*git describe*") and causality_actor_process_command_line not in ("*Microsoft VS Code*", "*iTerm2*", "*Visual Studio Code*") and action_process_image_name not in ("node", "node.exe")

        | alter suspicious_processes = arraycreate("id", "curl", "wget", "whoami", "arp", "at.exe", "hostname", "nbstat.exe", "netsh.exe", "netstat.exe", "nslookup", "ping.exe", "query.exe", "systeminfo.exe", "tasklist.exe", "traceroute.exe", "ipconfig.exe", "whoami.exe", "whois.exe", "quser.exe", "mshta.exe", "jscript.exe", "cscript.exe", "wscript.exe", "qwinsta.exe", "nltest.exe", "csvde.exe", "wevtutil.exe", "driverquery.exe", "nbtscan.exe", "ntdsutil.exe", "vssadmin.exe", "dsquery.exe", "adfind.exe", "klist.exe", "vssvc.exe", "nc", "ncat", "netcat", "base64", "uname", "dmidecode", "ip addr", "chmod -x", "chmod 7", "socat", "nohup", "setsid", "powershell.exe", "cmd.exe", "bash", "sh", "zsh", "mkfifo", "rundll32.exe", "java", "python", "python.exe", "php", "ifconfig", "net.exe", "net1.exe", "/dev/udp", "/dev/tcp", "adduser", "useradd", "lua", "crontab", "mknod")

        | alter matches = arrayfilter(suspicious_processes , action_process_image_command_line contains "@element")

        | comp count_distinct(action_process_image_command_line) as num_procs, values(action_process_image_command_line) as action_process_image_command_line,values(causality_actor_process_command_line) as causality_actor_process_command_line by agent_hostname, actor_process_image_name, actor_process_command_line, action_process_image_name
        | filter num_procs > 1

        ```
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "68"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4379.25,
          "y": 2200
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "84":
    id: "84"
    taskid: d45200bd-0433-4f6c-a75e-c250abb6653d
    type: playbook
    task:
      id: d45200bd-0433-4f6c-a75e-c250abb6653d
      version: -1
      name: Containment Plan - Block Indicators
      description: |-
        ## Containment Plan - Block Indicators

        This playbook is a sub-playbook within the containment plan playbook.

        ### Indicator Blocking

         The playbook block indicators using two methods:

        1. It adds malicious hashes to the Cortex XSIAM hash block list
        2. It utilizes the sub-playbook "Block Indicators - Generic v3"
      playbookName: Containment Plan - Block Indicators
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      AutoBlockIndicators:
        simple: "True"
      AutoContainment:
        simple: "True"
      BlockIndicators:
        simple: "True"
      Domain:
        complex:
          root: DBotScore
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: domain
              ignorecase: true
          - - operator: greaterThanOrEqual
              left:
                value:
                  simple: DBotScore.Score
                iscontext: true
              right:
                value:
                  simple: "2"
          accessor: Indicator
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.Domain
                iscontext: true
          - operator: RemoveEmpty
            args:
              empty_values: {}
              remove_keys:
                value:
                  simple: "true"
          - operator: uniq
      FileHash:
        complex:
          root: ExtractedIndicators
          accessor: File
          transformers:
          - operator: uniq
      IP:
        complex:
          root: DBotScore
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: ip
              ignorecase: true
          - - operator: greaterThanOrEqual
              left:
                value:
                  simple: DBotScore.Score
                iscontext: true
              right:
                value:
                  simple: "2"
          accessor: Indicator
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.File
                iscontext: true
          - operator: RemoveEmpty
            args:
              empty_values: {}
              remove_keys:
                value:
                  simple: "true"
          - operator: uniq
      URL:
        complex:
          root: DBotScore
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: url
              ignorecase: true
          - - operator: greaterThanOrEqual
              left:
                value:
                  simple: DBotScore.Score
                iscontext: true
              right:
                value:
                  simple: "2"
          accessor: Indicator
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.URL
                iscontext: true
          - operator: RemoveEmpty
            args:
              empty_values: {}
              remove_keys:
                value:
                  simple: "true"
          - operator: uniq
      UserVerification:
        simple: "False"
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 3920,
          "y": 3534
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "87":
    id: "87"
    taskid: f404a6c9-4b7e-4674-94fc-48481e93238a
    type: regular
    task:
      id: f404a6c9-4b7e-4674-94fc-48481e93238a
      version: -1
      name: Mitigation Actions
      description: "## Suggested Mitigation Steps\n\n### Update vulnerable packages: \n\n**Update/upgrade packages immediately**\n\nNote: If any vulnerable servers are found, it is recommended to isolate them until patching is complete.\n\n  * [CVE-2025-55182](https://react.dev/blog/2025/12/03/critical-security-vulnerability-in-react-server-components)\n```\nnpm install next@15.0.5   // for 15.0.x\nnpm install next@15.1.9   // for 15.1.x\nnpm install next@15.2.6   // for 15.2.x\nnpm install next@15.3.6   // for 15.3.x\nnpm install next@15.4.8   // for 15.4.x\nnpm install next@15.5.7   // for 15.5.x\nnpm install next@16.0.7   // for 16.0.x\n```\nNote: if you have additional components relying on react-server-dom* , visit the [React website for more instructions](https://react.dev/blog/2025/12/03/critical-security-vulnerability-in-react-server-components)\n\n  * [CVE-2025-66478](https://nextjs.org/blog/CVE-2025-66478)\n\n```\nnpm install next@15.0.5   # for 15.0.x\nnpm install next@15.1.9   # for 15.1.x\nnpm install next@15.2.6   # for 15.2.x\nnpm install next@15.3.6   # for 15.3.x\nnpm install next@15.4.8   # for 15.4.x\nnpm install next@15.5.7   # for 15.5.x\nnpm install next@16.0.7   # for 16.0.x\n \nnpm install next@15.6.0-canary.58   # for 15.x canary releases\nnpm install next@16.1.0-canary.12   # for 16.x canary releases\n```\n\nNote: if you have additional components relying on next.js , visit the [Next.js website for more instructions](https://nextjs.org/blog/CVE-2025-66478)"
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "38"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3999.25,
          "y": 4894
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "94":
    id: "94"
    taskid: f5951877-7b82-4304-a5bf-404fb2d14eda
    type: regular
    task:
      id: f5951877-7b82-4304-a5bf-404fb2d14eda
      version: -1
      name: Set parsed malicious command lines
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the permissions section in the documentation:\n- https://docs-cortex.paloaltonetworks.com/r/Cortex-XSIAM/Cortex-XSIAM-3.x-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "161"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: MaliciousCommandLinesDetected
      value:
        complex:
          root: CommandLineAnalysis
          filters:
          - - operator: greaterThan
              left:
                value:
                  simple: CommandLineAnalysis.score
                iscontext: true
              right:
                value:
                  simple: "50"
            - operator: containsGeneral
              left:
                value:
                  simple: CommandLineAnalysis.analysis.original.indicators.URL
                iscontext: true
              right:
                value:
                  simple: ExtractedIndicators.URL
                iscontext: true
              ignorecase: true
          accessor: parsed_command
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4795,
          "y": 2670
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "99":
    id: "99"
    taskid: b78ef3cc-1814-4e4c-9091-4f9a5cb603d2
    type: condition
    task:
      id: b78ef3cc-1814-4e4c-9091-4f9a5cb603d2
      version: -1
      name: Any results from threat hunting?
      description: Any results from Threat Hunting?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "38"
      "yes":
      - "102"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: containsGeneral
          left:
            value:
              simple: IOCFound
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
        - operator: isNotEmpty
          left:
            value:
              simple: DBotScore.Indicator
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4415,
          "y": 4894
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "102":
    id: "102"
    taskid: e09cf2b3-4500-4a66-aa52-8a36fb87d95b
    type: regular
    task:
      id: e09cf2b3-4500-4a66-aa52-8a36fb87d95b
      version: -1
      name: Review Threat Hunting Results
      description: |-
        ${IOCFound(val)="As part of our IOC hunting, we've identified results that need your attention: The results can be found in the Context under  HuntIOCs.Results  key or check the results of the task - "XQL Query - IOCs Hunt""}

        ${DBotScore(val.Indicator).Indicator=>"The following indicators were found in the command lines:\n - "+val.filter((v,i,a)=>a.indexOf(v)==i).join("\n - ")+"\n\nInvestigate them in a separate flow."}
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "38"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4660,
          "y": 5050
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "108":
    id: "108"
    taskid: d2b63e7a-de1f-4df5-bca2-cd4933d6c6df
    type: regular
    task:
      id: d2b63e7a-de1f-4df5-bca2-cd4933d6c6df
      version: -1
      name: XQL Query - IOCs Hunt
      description: Execute an XQL query to detect any usage of the specified malicious indicators.
      script: '|||xdr-xql-generic-query'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#error#':
      - "121"
      '#none#':
      - "110"
    scriptarguments:
      extend-context:
        simple: HuntIOCs=
      ignore-outputs:
        simple: "true"
      max_fields:
        simple: "100"
      query:
        simple: "datamodel dataset=* \n| filter (xdm.network.http.url  in (${ExtractedIndicators.URL=>'\"'+val.join('\",\"')+'\"'}) or xdm.target.url in (${ExtractedIndicators.URL=>'\"'+val.join('\",\"')+'\"'})) or (XDM_ALIAS.ip in (${ExtractedIndicators.IP=>'\"'+val.join('\",\"')+'\"'})) or ( XDM_ALIAS.file_hash in (${ExtractedIndicators.File=>'\"'+val.join('\",\"')+'\"'})) \n| fields fieldset.xdm_core, xdm.intermediate.ipv4, xdm.source.host.ipv4_addresses, xdm.target.host.ipv4_addresses, xdm.intermediate.host.ipv4_addresses, xdm.network.dhcp.ciaddr, xdm.network.dhcp.yiaddr, xdm.network.dhcp.siaddr, xdm.network.dhcp.giaddr, xdm.network.vpn.allocated_ipv4, xdm.source.ipv6, xdm.target.ipv6, xdm.intermediate.ipv6, xdm.source.host.ipv6_addresses, xdm.target.host.ipv6_addresses, xdm.intermediate.host.ipv6_addresses, xdm.network.vpn.allocated_ipv6, xdm.source.process.executable.md5, xdm.source.process.executable.sha256, xdm.target.process.executable.md5, xdm.target.process.executable.sha256, xdm.intermediate.process.executable.md5, xdm.intermediate.process.executable.sha256, xdm.target.module.md5, xdm.target.module.sha256, xdm.target.file.md5, xdm.target.file.sha256, xdm.target.file_before.md5, xdm.target.file_before.sha256, xdm.source.host.ipv4_addresses, xdm.target.host.ipv4_addresses, xdm.source.host.device_id, xdm.source.host.hostname"
      query_name:
        simple: IOCs search
      time_frame:
        simple: 1 week ago
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": 3600,
          "y": 1985
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "109":
    id: "109"
    taskid: 35355acb-10e6-417e-8d1f-92b073b5e9e1
    type: condition
    task:
      id: 35355acb-10e6-417e-8d1f-92b073b5e9e1
      version: -1
      name: Is the integration of 'XQL Query Engine' available?
      description: Returns 'yes' if integration brand 'XQL Query Engine' is available. Otherwise returns 'no'.
      scriptName: IsIntegrationAvailable
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "121"
      "yes":
      - "108"
    scriptarguments:
      brandname:
        simple: XQL Query Engine
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3600,
          "y": 1811
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "110":
    id: "110"
    taskid: 07a1ddb4-c0c8-4e51-adc0-282fcdadc664
    type: condition
    task:
      id: 07a1ddb4-c0c8-4e51-adc0-282fcdadc664
      version: -1
      name: Any results from XQL?
      description: ' Checks if Threat Hunting found threats.'
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "68"
      "yes":
      - "113"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: HuntIOCs.results
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3600,
          "y": 2170
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "113":
    id: "113"
    taskid: 44730f4a-62a7-4e74-bdbf-35ee1a3c844e
    type: regular
    task:
      id: 44730f4a-62a7-4e74-bdbf-35ee1a3c844e
      version: -1
      name: Set Context key on Found IOCs
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the permissions section in the documentation:\n- https://docs-cortex.paloaltonetworks.com/r/Cortex-XSIAM/Cortex-XSIAM-3.x-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "68"
    scriptarguments:
      key:
        simple: IOCFound
      value:
        simple: "True"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3600,
          "y": 2595
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "121":
    id: "121"
    taskid: 3b4a8919-2c14-4c6a-9463-74a25e446b17
    type: regular
    task:
      id: 3b4a8919-2c14-4c6a-9463-74a25e446b17
      version: -1
      name: Manual – Search For IOCs
      description: "Dear Analyst,\n\nEnsure that the 'XQL Query Engine' integration is active. If it's not enabled, activate the integration or manually run the following XQL query to determine if any IOCs are found within your environment. Otherwise, you can go ahead and search manually for the following indicators:\n\n#### List of URLs:\n${ExtractedIndicators.URL=>val.join(',')}\n\n#### List of Domains:\n${ExtractedIndicators.Domain=>val.join(',')}\n\n#### List of Hashes:\n${ExtractedIndicators.File=>val.join(',')}\n\n**XQL Query:**\nSearches for URL indicators.\n```\ndatamodel dataset=* \n| filter (xdm.network.http.url  in (${ExtractedIndicators.URL=>'\"'+val.join('\",\"')+'\"'}) or xdm.target.url in (${ExtractedIndicators.URL=>'\"'+val.join('\",\"')+'\"'})) or (XDM_ALIAS.ip in (${ExtractedIndicators.IP=>'\"'+val.join('\",\"')+'\"'})) or ( XDM_ALIAS.file_hash in (${ExtractedIndicators.File=>'\"'+val.join('\",\"')+'\"'})) \n| fields fieldset.xdm_core, xdm.intermediate.ipv4, xdm.source.host.ipv4_addresses, xdm.target.host.ipv4_addresses, xdm.intermediate.host.ipv4_addresses, xdm.network.dhcp.ciaddr, xdm.network.dhcp.yiaddr, xdm.network.dhcp.siaddr, xdm.network.dhcp.giaddr, xdm.network.vpn.allocated_ipv4, xdm.source.ipv6, xdm.target.ipv6, xdm.intermediate.ipv6, xdm.source.host.ipv6_addresses, xdm.target.host.ipv6_addresses, xdm.intermediate.host.ipv6_addresses, xdm.network.vpn.allocated_ipv6, xdm.source.process.executable.md5, xdm.source.process.executable.sha256, xdm.target.process.executable.md5, xdm.target.process.executable.sha256, xdm.intermediate.process.executable.md5, xdm.intermediate.process.executable.sha256, xdm.target.module.md5, xdm.target.module.sha256, xdm.target.file.md5, xdm.target.file.sha256, xdm.target.file_before.md5, xdm.target.file_before.sha256, xdm.source.host.ipv4_addresses, xdm.target.host.ipv4_addresses, xdm.source.host.device_id, xdm.source.host.hostname\n```\n"
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "68"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3999.25,
          "y": 2300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "124":
    id: "124"
    taskid: 6ab44f5a-4a21-4010-adb5-f3ee11ab07bb
    type: regular
    task:
      id: 6ab44f5a-4a21-4010-adb5-f3ee11ab07bb
      version: -1
      name: Collect Indicators from Unit42 Blog
      description: This script extracts indicators from HTML content and filters invalid TLDs to avoid file extension false positives.
      scriptName: ParseHTMLIndicators
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "25"
    scriptarguments:
      unescape_domain:
        simple: "False"
      url:
        simple: https://unit42.paloaltonetworks.com/cve-2025-55182-react-and-cve-2025-66478-next/
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201.5,
          "y": 609
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "134":
    id: "134"
    taskid: 9aba8ad7-c0d2-40fd-abe0-8eacff8aaef6
    type: regular
    task:
      id: 9aba8ad7-c0d2-40fd-abe0-8eacff8aaef6
      version: -1
      name: Command Line Analysis
      description: |-
        This script evaluates command-line threats by analyzing both original and decoded inputs. It assigns weighted scores to detected patterns, such as AMSI bypass or credential dumping, and applies risk combination bonuses for multiple detections. The total score is normalized to a 0-100 scale, with risk levels categorized as follows:

        * 0-25: Low Risk
        * 26-50: Medium Risk
        * 51-90: High Risk
        * 91-100: Critical Risk

        The scoring mechanism provides a comprehensive risk assessment, considering both the severity and frequency of malicious behaviors.
      scriptName: CommandLineAnalysis
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "145"
    scriptarguments:
      command_line:
        complex:
          root: XQLPossibleMaliciousCmd.results
          accessor: action_process_image_command_line
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: XQLPossibleMaliciousCmd.results.actor_process_command_line
                iscontext: true
          - operator: RemoveEmpty
            args:
              empty_values: {}
              remove_keys:
                value:
                  simple: "true"
          - operator: uniq
    reputationcalc: 2
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4795,
          "y": 2360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "135":
    id: "135"
    taskid: 67eb0acb-0665-4f3f-b116-9aecbbb0f786
    type: title
    task:
      id: 67eb0acb-0665-4f3f-b116-9aecbbb0f786
      version: -1
      name: Investigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "164"
      - "166"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201.5,
          "y": 1490
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "138":
    id: "138"
    taskid: d4f54519-dd0c-4933-8e13-cca96dfd00d9
    type: condition
    task:
      id: d4f54519-dd0c-4933-8e13-cca96dfd00d9
      version: -1
      name: Found any suspicious command lines?
      description: Checks if any suspicious command lines were found.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "68"
      "yes":
      - "134"
      - "162"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: XQLPossibleMaliciousCmd.results.actor_process_command_line
            iscontext: true
          right:
            value: {}
        - operator: isNotEmpty
          left:
            value:
              simple: XQLPossibleMaliciousCmd.results.action_process_image_command_line
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4795,
          "y": 2200
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "145":
    id: "145"
    taskid: 6fd43567-621b-4bc5-adc9-a449c4c632e2
    type: condition
    task:
      id: 6fd43567-621b-4bc5-adc9-a449c4c632e2
      version: -1
      name: Found any malicious command lines?
      description: Checks if any malicious command lines were found.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "68"
      "yes":
      - "94"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: containsGeneral
          left:
            value:
              simple: CommandLineAnalysis.analysis.original.indicators.URL
            iscontext: true
          right:
            value:
              simple: ExtractedIndicators.URL
            iscontext: true
        - operator: greaterThan
          left:
            value:
              simple: CommandLineAnalysis.score
            iscontext: true
          right:
            value:
              simple: "50"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4795,
          "y": 2510
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "150":
    id: "150"
    taskid: 9c8f964d-cbac-4209-8bce-69e72685a318
    type: condition
    task:
      id: 9c8f964d-cbac-4209-8bce-69e72685a318
      version: -1
      name: ' Are there any suspicious findings?'
      description: Checks if there are any suspicious findings collected during the investigation
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "31"
      "yes":
      - "151"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: PossibleCompromisedHostDetected
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4503.5,
          "y": 3534
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "151":
    id: "151"
    taskid: be831af9-3e16-473a-9827-2560464dfa7b
    type: collection
    task:
      id: be831af9-3e16-473a-9827-2560464dfa7b
      version: -1
      name: Analyst approval required for isolation
      description: |-
        As part of the playbook, we have identified possible malicious activity related to the vulnerabilities  CVE-2025-55182 (React) and CVE-2025-66478 (Next.js). Therefore, we strongly suggest reviewing the finding:

        ```
        ${MaliciousCommandLinesDetected(val.length > 0) =>" ### Malicious command lines The list below (Scored by the CommandLineAnalysis script): \n - " + val.join("\n - ")}
        ```

        ### Suspicious command lines
        The list below (if there are any findings, otherwise this section remains empty):

        ```
        ${XQLPossibleMaliciousCmd.results.action_process_image_command_line(val.length > 0)=>" - "+val.filter((v,i,a)=>a.indexOf(v)==i).join("\n - ")}
        ```



        **Recommended action: Isolate vulnerable servers until patching is complete.**
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "157"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4710,
          "y": 3710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: 'Select hosts to isolate from the following agent IDs:'
        required: true
        gridcolumns: []
        defaultrows: []
        type: multiSelect
        options: []
        optionsarg:
        - complex:
            root: PossibleCompromisedHostDetected
            transformers:
            - operator: uniq
        - simple: No Action
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      title: Hosts to isolate
      description: |-
        The following hosts were identified as possible affected servers that were exploited and compromised via vulnerabilities  CVE-2025-55182 (React) and CVE-2025-66478 (Next.js).
        It is recommended to isolate them until patching is complete.
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "156":
    id: "156"
    taskid: 551bf085-f1bb-4c6c-ac92-ec880e300b1f
    type: regular
    task:
      id: 551bf085-f1bb-4c6c-ac92-ec880e300b1f
      version: -1
      name: Isolate Endpoint
      description: This script isolates endpoints using multiple integrations and returns a success or failure message.
      scriptName: isolate-endpoint
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "160"
    scriptarguments:
      brands:
        simple: Cortex Core - IR
      endpoint_id:
        complex:
          root: EndpointData
          accessor: ID
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4710,
          "y": 4260
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "157":
    id: "157"
    taskid: 9f8f2c1d-7fd0-4895-b336-aa2a0a2d4021
    type: condition
    task:
      id: 9f8f2c1d-7fd0-4895-b336-aa2a0a2d4021
      version: -1
      name: Are there any hosts to isolate based on analyst approval?
      description: Check the analyst’s answer.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "31"
      "yes":
      - "167"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: notContainsGeneral
          left:
            value:
              simple: Hosts to isolate.Answers.0
            iscontext: true
          right:
            value:
              simple: No Action
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4710,
          "y": 3860
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "159":
    id: "159"
    taskid: 88d6ed51-6d3b-42b7-8791-18733c8ae0c5
    type: regular
    task:
      id: 88d6ed51-6d3b-42b7-8791-18733c8ae0c5
      version: -1
      name: Manual remediation actions for a server or a disconnected endpoint
      description: "Dear Analyst,\n\nPlease note that during the remediation process, the playbook didn't isolate the following host: ${alert.hostname} \n\nThis is due to the following reason(s):\n- The device disconnected.\n\nPlease take manual action to contain the attack and prevent the attacker from executing lateral movement before closing this alert."
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "31"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4920,
          "y": 4570
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "160":
    id: "160"
    taskid: f67a950e-7250-4472-bd7d-a7911bd8f79a
    type: condition
    task:
      id: f67a950e-7250-4472-bd7d-a7911bd8f79a
      version: -1
      name: Was the endpoint isolation successful?
      description: Verifies whether the endpoint isolation was successful.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "159"
      "yes":
      - "31"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: IsolateEndpoint.Result
            iscontext: true
          right:
            value:
              simple: Success
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4710,
          "y": 4410.66650390625
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "161":
    id: "161"
    taskid: 3ec0aafe-47e1-4637-825f-d606a5b65ab1
    type: regular
    task:
      id: 3ec0aafe-47e1-4637-825f-d606a5b65ab1
      version: -1
      name: Set original malicious command lines
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the permissions section in the documentation:\n- https://docs-cortex.paloaltonetworks.com/r/Cortex-XSIAM/Cortex-XSIAM-3.x-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "68"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: MaliciousCommandLinesDetected
      value:
        complex:
          root: CommandLineAnalysis
          filters:
          - - operator: greaterThan
              left:
                value:
                  simple: CommandLineAnalysis.score
                iscontext: true
              right:
                value:
                  simple: "50"
            - operator: containsGeneral
              left:
                value:
                  simple: CommandLineAnalysis.analysis.original.indicators.URL
                iscontext: true
              right:
                value:
                  simple: ExtractedIndicators.URL
                iscontext: true
              ignorecase: true
          accessor: original_command
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4795,
          "y": 2830
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "162":
    id: "162"
    taskid: e95ecf58-2ee6-4593-a91a-0385ada8db00
    type: regular
    task:
      id: e95ecf58-2ee6-4593-a91a-0385ada8db00
      version: -1
      name: Set Possible Compromised Servers
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the permissions section in the documentation:\n- https://docs-cortex.paloaltonetworks.com/r/Cortex-XSIAM/Cortex-XSIAM-3.x-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "68"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: PossibleCompromisedHostDetected
      value:
        complex:
          root: XQLPossibleMaliciousCmd.results
          accessor: agent_hostname
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 5205,
          "y": 2830
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "163":
    id: "163"
    taskid: 0f47cfc7-c6c8-4180-918f-b9bcedc7d45d
    type: regular
    task:
      id: 0f47cfc7-c6c8-4180-918f-b9bcedc7d45d
      version: -1
      name: Tag File Indicators
      description: commands.local.cmd.new.indicator
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      retry-count:
        simple: "3"
      retry-interval:
        simple: "2"
      tags:
        simple: CVE-2025-55182,CVE-2025-66478
      type:
        simple: File
      value:
        complex:
          root: ExtractedIndicators.File
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: ExtractedIndicators.File
                iscontext: true
          transformers:
          - operator: uniq
      verdict:
        simple: Malicious
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3619.25,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "164":
    id: "164"
    taskid: 46996534-4695-4bbf-bcd7-448cfdd972f2
    type: title
    task:
      id: 46996534-4695-4bbf-bcd7-448cfdd972f2
      version: -1
      name: Threat Hunting - IOCs
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "109"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3600,
          "y": 1630
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "166":
    id: "166"
    taskid: 48e788e8-b7e6-4b71-9e73-60d062a13369
    type: title
    task:
      id: 48e788e8-b7e6-4b71-9e73-60d062a13369
      version: -1
      name: Threat Hunting - Suspicious Activity
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "75"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4795,
          "y": 1640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "167":
    id: "167"
    taskid: 4fec5ff7-07e9-48c2-94ca-b936994da328
    type: regular
    task:
      id: 4fec5ff7-07e9-48c2-94ca-b936994da328
      version: -1
      name: Get Endpoint IDs
      description: This script gathers endpoint data from multiple integrations and returns an endpoint entity with consolidated information to the context.
      scriptName: get-endpoint-data
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "156"
    scriptarguments:
      endpoint_hostname:
        complex:
          root: Hosts to isolate.Answers
          accessor: "0"
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4710,
          "y": 4100
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "108_121_#error#": 0.4,
      "109_108_yes": 0.36,
      "109_121_#default#": 0.42,
      "110_113_yes": 0.5,
      "138_134_yes": 0.44,
      "138_68_#default#": 0.44,
      "145_68_#default#": 0.46,
      "150_31_#default#": 0.18,
      "157_31_#default#": 0.42,
      "160_31_yes": 0.3,
      "74_79_#error#": 0.31,
      "75_74_yes": 0.36,
      "75_79_#default#": 0.45,
      "99_38_#default#": 0.3
    },
    "paper": {
      "dimensions": {
        "height": 5468,
        "width": 1985,
        "x": 3600,
        "y": 320
      }
    }
  }
inputs: []
inputSections:
- inputs: []
  name: General (Inputs group)
  description: Generic group for inputs
outputSections:
- outputs: []
  name: General (Outputs group)
  description: Generic group for outputs
outputs: []
tests:
- No tests (auto formatted)
fromversion: 6.10.0
