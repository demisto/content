fromversion: 8.9.0
issilent: true
id: silent-Execution of significantly renamed lolbin
version: -1
name: silent-Execution of significantly renamed lolbin
description: |-
  This playbook is designed to handle the "Execution of significantly renamed lolbin" alerts.

  Playbook Stages:

  Analysis:

  - Analyze the issue command lines.
  - Retrieves the user risk score.
  - Retrieves the host risk score.
  - Retrieves the endpoint data.
  - Extracts related script paths from the action command line.
  - Enriches the process SHA-256.


  Investigation:

  - Retrieves and investigates scripts from the action command line.
  - Checks if the action occurred on host with a high risk level.
  - Searches for the user who renamed the lolbin.
  - Checks if the action performed by a high risk user.
  - Checks if the action performed by a high risk user.
  - Checks if the action was performed by a suspicious remote actor.
  - Searches for related alerts indicating suspicious or malicious activity.
  - Checks the process reputation.
  - Checks for suspicious execution paths.
  - Checks for unsigned processes in the causality.
  - Retrieves and analyzes the command line in the same causality chain for malicious activity.
  - Investigates to identify known masquerading techniques.

  Verdict:

  The verdict is determined as malicious based on the evidence found during the investigation phase.

  Remediation:

  - Terminates the processes.
  - Quarantines the masqueraded file or, if impossible, blocks its execution.
  - Quarantines the related scripts.
  - Disables the involved users (requires analyst approval).
  - Logs off the involved users.
  - Blocks the the connection from the remote actor.
  - Block the external IP of the remote actor.
  - Automatically close the alert.
tags:
- TA0005 - Defense Evasion
- T1036 - Masquerading
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: f47db075-7685-4bd3-813c-9595ca4b9618
    type: start
    task:
      id: f47db075-7685-4bd3-813c-9595ca4b9618
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "3"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1030
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: f3ab8eed-6f58-41de-9061-53edb8728efb
    type: regular
    task:
      id: f3ab8eed-6f58-41de-9061-53edb8728efb
      version: -1
      name: Get additional alert data
      description: Returns information about each alert ID.
      script: '|||core-get-cloud-original-alerts'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "344"
      - "6"
      - "7"
      - "257"
      - "258"
    scriptarguments:
      alert_ids:
        simple: ${issue.id}
      filter_alert_fields:
        simple: "false"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1310
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: f521f0d7-c4d4-4d96-9546-2011ea06faad
    type: title
    task:
      id: f521f0d7-c4d4-4d96-9546-2011ea06faad
      version: -1
      name: Data Collection
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "1"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: 65435c74-8e78-418e-a712-5c8d28e74a51
    type: title
    task:
      id: 65435c74-8e78-418e-a712-5c8d28e74a51
      version: -1
      name: Investigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "8"
      - "22"
      - "48"
      - "51"
      - "190"
      - "203"
      - "259"
      - "266"
      - "268"
      - "270"
      - "273"
      - "293"
      - "199"
      - "377"
      - "262"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1670
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: f513665e-c94d-498e-9683-1ce0a5dd96ae
    type: title
    task:
      id: f513665e-c94d-498e-9683-1ce0a5dd96ae
      version: -1
      name: Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "95"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 510,
          "y": 5070
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: a28bd32e-7d42-4fc4-af56-017cdef00ab4
    type: regular
    task:
      id: a28bd32e-7d42-4fc4-af56-017cdef00ab4
      version: -1
      name: Get host risk score
      description: Retrieve the risk score of a specific host or list of hosts with the highest risk score in the environment along with the reason affecting each score.
      script: '|||core-list-risky-hosts'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      host_id:
        simple: ${issue.hostname}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -50,
          "y": 1490
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: 04d8a15b-155c-49b6-87e0-86c0eb0833f2
    type: regular
    task:
      id: 04d8a15b-155c-49b6-87e0-86c0eb0833f2
      version: -1
      name: Get user risk score
      description: Retrieve the risk score of a specific user or list of users with the highest risk score in the environment along with the reason affecting each score.
      script: '|||core-list-risky-users'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      user_id:
        simple: ${Core.OriginalAlert.event.actor_primary_username}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1490
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: 9a036904-bb15-4261-8994-2046ba815bfb
    type: condition
    task:
      id: 9a036904-bb15-4261-8994-2046ba815bfb
      version: -1
      name: Was the action performed on a high risk level host?
      description: Checks if the action performed on DC server with a high risk level.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "9"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: Core.RiskyHost.risk_level
            iscontext: true
          right:
            value:
              simple: HIGH
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2290,
          "y": 1837.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: 6fb5acb1-55f5-447d-87b0-3988d06c7ff3
    type: regular
    task:
      id: 6fb5acb1-55f5-447d-87b0-3988d06c7ff3
      version: -1
      name: 'Evidence: The action performed on a high risk host'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "high_risk_host", "Score": 1, "Comment": "The action performed on a high risk host"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2290,
          "y": 2010
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: 5f8249a9-347e-44e7-bc95-8429ddb40cee
    type: title
    task:
      id: 5f8249a9-347e-44e7-bc95-8429ddb40cee
      version: -1
      name: Verdict
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "252"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 510,
          "y": 4290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: 7e0fbec2-0cde-4757-ba2d-2a22136aaba1
    type: condition
    task:
      id: 7e0fbec2-0cde-4757-ba2d-2a22136aaba1
      version: -1
      name: Was the action performed by a high-risk user?
      description: Checks if the action was performed by a high-risk user.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "23"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: Core.RiskyUser.risk_level
            iscontext: true
          right:
            value:
              simple: high
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1780,
          "y": 1837.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: b969b3f5-9b9f-4bcc-9bbd-76965e8b7c9f
    type: regular
    task:
      id: b969b3f5-9b9f-4bcc-9bbd-76965e8b7c9f
      version: -1
      name: 'Evidence: The action performed by a high risk user'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "high_risk_user", "Score": 0.5, "Comment": "The action performed by a high risk user"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1780,
          "y": 2010
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "48":
    id: "48"
    taskid: 7529d6e4-4f35-4a07-ba44-759e2815b04a
    type: regular
    task:
      id: 7529d6e4-4f35-4a07-ba44-759e2815b04a
      version: -1
      name: Search related alerts indicating a suspicious activity
      description: |
        This task searches the following alerts related to the endpoint for indications of a suspicious activity:

        - "Multiple alerts of different MITRE tactics were seen"
        - "Changing permissions or ownership of a file or folder"
        - "Administrator obtains access rights to a file using icacls.exe"
        - "Uncommon user management via net.exe"
        - "PowerShell suspicious flags"
        - "Uncommon net group administrators command execution"
        - "Bitsadmin.exe persistence using command-line callback"
        - "New local user created via PowerShell command line"
        - "Suspicious PowerShell Command Line"
        - "Uncommon net localgroup execution"
      scriptName: SearchAlertsV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "49"
    scriptarguments:
      extend-context:
        simple: SuspiciousRelatedAlerts=
      fromdate:
        simple: 5 hours ago
      ignore-outputs:
        simple: "true"
      query:
        simple: agentid:${issue.agentid} and (name:"Behavioral Threat" or name:"Multiple alerts of different MITRE tactics were seen" or name:"Changing permissions or ownership of a file or folder" or name:"Administrator obtains access rights to a file using icacls.exe" or name:"Uncommon user management via net.exe" or name:"PowerShell suspicious flags" or name:"Uncommon net group administrators command execution" or name:"Bitsadmin.exe persistence using command-line callback" or name:"New local user created via PowerShell command line" or name:"Suspicious PowerShell Command Line" or name:"Uncommon net localgroup execution")
      todate:
        simple: now
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1310,
          "y": 1837.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "49":
    id: "49"
    taskid: 79e39114-6f77-4dc6-b260-8104fcf79e53
    type: condition
    task:
      id: 79e39114-6f77-4dc6-b260-8104fcf79e53
      version: -1
      name: Found related alerts indicating a suspicious activity?
      description: Checks whether any related alerts indicating a suspicious activity were found.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "50"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: SuspiciousRelatedAlerts
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1310,
          "y": 2010
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "50":
    id: "50"
    taskid: 9085d795-1ce4-45af-8414-93a90c433d34
    type: regular
    task:
      id: 9085d795-1ce4-45af-8414-93a90c433d34
      version: -1
      name: 'Evidence: Related alerts indicating suspicious activity were found'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "suspicious_related_alerts", "Score": 1.5, "Comment": "Related alerts indicating suspicious activity were found"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1310,
          "y": 2170
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "51":
    id: "51"
    taskid: 0b1326cf-f0e4-4cdd-a15c-b42d92d8e121
    type: condition
    task:
      id: 0b1326cf-f0e4-4cdd-a15c-b42d92d8e121
      version: -1
      name: Is the action performed by a remote actor?
      description: Checks if the action performed by a remote actor.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "52"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: Core.OriginalAlert.event.causality_actor_remote_ip
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3870,
          "y": 1837.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "52":
    id: "52"
    taskid: 8dae7a21-bd29-4b21-8691-5f26582bd5fb
    type: title
    task:
      id: 8dae7a21-bd29-4b21-8691-5f26582bd5fb
      version: -1
      name: Execution by a remote actor
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "53"
      - "55"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3870,
          "y": 2000
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "53":
    id: "53"
    taskid: bba5be51-b7d3-4be3-9fb9-dc7286fead72
    type: regular
    task:
      id: bba5be51-b7d3-4be3-9fb9-dc7286fead72
      version: -1
      name: Get endpoint data by remote actor ip
      description: This script gathers endpoint data from multiple integrations and returns an endpoint entity with consolidated information to the context.
      scriptName: get-endpoint-data
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "153"
    scriptarguments:
      additional_fields:
        simple: "true"
      brands:
        simple: Cortex Core - IR
      endpoint_ip:
        simple: ${Core.OriginalAlert.event.causality_actor_remote_ip}
      extend-context:
        simple: RemoteActorData=
      ignore-outputs:
        simple: "true"
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -4290,
          "y": 2140
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "55":
    id: "55"
    taskid: a7885f56-f588-4d69-b1e0-b6ec3e38d6d5
    type: condition
    task:
      id: a7885f56-f588-4d69-b1e0-b6ec3e38d6d5
      version: -1
      name: Is the remote actor’s IP internal?
      description: Check if the remote IP internal or external.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "56"
      "yes":
      - "58"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: IsInCidrRanges
          left:
            value:
              simple: Core.OriginalAlert.event.causality_actor_remote_ip
            iscontext: true
          right:
            value:
              complex:
                root: lists
                accessor: PrivateIPs
                transformers:
                - operator: RegexExtractAll
                  args:
                    error_if_no_match: {}
                    ignore_case: {}
                    multi_line: {}
                    period_matches_newline: {}
                    regex:
                      value:
                        simple: (\b(?:\d{1,3}\.){3}\d{1,3}\b/\d{1,2})
                    unpack_matches: {}
                - operator: join
                  args:
                    separator:
                      value:
                        simple: ','
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3436.25,
          "y": 2140
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "56":
    id: "56"
    taskid: 2904cb0a-c148-409e-b7c6-0c96f83bc832
    type: regular
    task:
      id: 2904cb0a-c148-409e-b7c6-0c96f83bc832
      version: -1
      name: 'Evidence: The action performed by external remote IP'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "external_remote_actor_ip", "Score": 2.5, "Comment": "The action performed by external remote IP"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3640,
          "y": 2300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "58":
    id: "58"
    taskid: 5e41f480-727c-43ba-b600-467d7017c752
    type: regular
    task:
      id: 5e41f480-727c-43ba-b600-467d7017c752
      version: -1
      name: XQL Query - Check if it's a new IP
      description: "This task executes the XQL query to check if the IP is new in the system. \nThe query will check for 3-day logs in the XQL data, and deduct the first and last log timeframes. If the difference in hours is less than 48, the IP will be considered as new."
      script: '|||xdr-xql-generic-query'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#error#':
      - "272"
      '#none#':
      - "59"
    scriptarguments:
      extend-context:
        simple: XQLNewActorRemoteIP=
      ignore-outputs:
        simple: "true"
      max_fields:
        simple: "100"
      query:
        simple: " config timeframe = 3d case_sensitive = false \n| datamodel dataset in(*) \n| filter XDM_ALIAS.ipv4 = \"${Core.OriginalAlert.event.causality_actor_remote_ip}\" \n| fields _time\n| sort asc _time\n| comp earliest(_time) as first_seen\n| alter hours_beetween_logs = timestamp_diff(current_time(),first_seen ,\"HOUR\")\n|alter is_it_new = if((hours_beetween_logs<48) or (hours_beetween_logs = null),\"Yes\",\"No\")\n| fields is_it_new\n"
      query_name:
        simple: Check_new_remote_actor_ip
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": -3213.75,
          "y": 2300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 2
    isoversize: false
    isautoswitchedtoquietmode: false
  "59":
    id: "59"
    taskid: d5bd13aa-d7c0-40ab-a265-295b140ae175
    type: condition
    task:
      id: d5bd13aa-d7c0-40ab-a265-295b140ae175
      version: -1
      name: Is the remote IP new?
      description: Checks if the action was performed by a newly observed remote actor IP.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "60"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: XQLNewActorRemoteIP.results.is_it_new
            iscontext: true
          right:
            value:
              simple: "Yes"
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3213.75,
          "y": 2450
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "60":
    id: "60"
    taskid: 4803ef0b-9f31-44e7-aee8-8e9d89bfb886
    type: regular
    task:
      id: 4803ef0b-9f31-44e7-aee8-8e9d89bfb886
      version: -1
      name: 'Evidence: The action performed by a new remote actor IP address'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "new_remote_actor_ip", "Score": 1, "Comment": "The action performed by a new remote actor IP address"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3213.75,
          "y": 2604.16650390625
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "61":
    id: "61"
    taskid: 8817df86-14fe-4125-9ea3-59334141f092
    type: condition
    task:
      id: 8817df86-14fe-4125-9ea3-59334141f092
      version: -1
      name: Is the risk level of the remote actor high?
      description: Checks if the remote actor’s risk level is high.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "62"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: RemoteActorData.RiskLevel
            iscontext: true
          right:
            value: {}
          ignorecase: true
      - - operator: containsGeneral
          left:
            value:
              simple: RemoteActorData.RiskLevel
            iscontext: true
          right:
            value:
              simple: HIGH
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -4060,
          "y": 2460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "62":
    id: "62"
    taskid: c41eeb90-f657-43c8-bf3e-fa8164afb6e0
    type: regular
    task:
      id: c41eeb90-f657-43c8-bf3e-fa8164afb6e0
      version: -1
      name: 'Evidence: Suspicious remote actor with high risk level'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "high_risk_remote_actor", "Score": 1, "Comment": "Suspicious remote actor with high risk level"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -4060,
          "y": 2620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "80":
    id: "80"
    taskid: b5c4fbf2-0b5f-4e11-9205-b7d61d032a91
    type: regular
    task:
      id: b5c4fbf2-0b5f-4e11-9205-b7d61d032a91
      version: -1
      name: Terminate Causality processes
      description: Terminate a process tree by its causality ID. Available only for XSIAM 2.4 and above.
      script: '|||core-terminate-causality'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "100"
      - "83"
      - "333"
      - "341"
      - "351"
      - "96"
    scriptarguments:
      causality_id:
        simple: ${issue.actionprocessinstanceid.[0]}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -600,
          "y": 5350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "83":
    id: "83"
    taskid: ce7248f4-f28d-4b23-9091-253d98f29c57
    type: title
    task:
      id: ce7248f4-f28d-4b23-9091-253d98f29c57
      version: -1
      name: Masqueraded Process Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "337"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1390,
          "y": 5515
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "86":
    id: "86"
    taskid: eebce9dc-1133-45a8-b680-1c42c9e3661e
    type: title
    task:
      id: eebce9dc-1133-45a8-b680-1c42c9e3661e
      version: -1
      name: Done - Disable User
      description: commands.local.cmd.close.inv
      type: title
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "406"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -4353.75,
          "y": 7490
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "87":
    id: "87"
    taskid: cb087126-83eb-4bde-88c5-baa30e1ee191
    type: title
    task:
      id: cb087126-83eb-4bde-88c5-baa30e1ee191
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 540,
          "y": 8170
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "95":
    id: "95"
    taskid: 55ac7ea1-dbff-4a0e-9d81-517a00c61802
    type: title
    task:
      id: 55ac7ea1-dbff-4a0e-9d81-517a00c61802
      version: -1
      name: Terminate Processes
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "80"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -600,
          "y": 5220
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "96":
    id: "96"
    taskid: 9816d696-4fe3-4b8a-babe-2b1b92e4539a
    type: title
    task:
      id: 9816d696-4fe3-4b8a-babe-2b1b92e4539a
      version: -1
      name: User Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "379"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3545.8333129882812,
          "y": 5515
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "99":
    id: "99"
    taskid: c713c6f1-df15-4434-8155-3df8653326a2
    type: regular
    task:
      id: c713c6f1-df15-4434-8155-3df8653326a2
      version: -1
      name: 'Block connection from the remote actor '
      description: Block malicious or suspicious IP addresses.
      script: '|||core-block-ip'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "364"
    scriptarguments:
      addresses:
        simple: ${Core.OriginalAlert.event.causality_actor_remote_ip}
      duration:
        simple: "60"
      endpoint_list:
        simple: ${issue.agentid}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 740,
          "y": 5970
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "100":
    id: "100"
    taskid: da4c42aa-a5c8-46d5-a6f2-b15ebee17b6d
    type: title
    task:
      id: da4c42aa-a5c8-46d5-a6f2-b15ebee17b6d
      version: -1
      name: Remote Actor Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "107"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 540,
          "y": 5515
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "105":
    id: "105"
    taskid: f07cade3-50d8-4bcf-8a2f-e98ce4f093a8
    type: regular
    task:
      id: f07cade3-50d8-4bcf-8a2f-e98ce4f093a8
      version: -1
      name: Disable User
      description: This script disables users for multiple services.
      scriptName: disable-user
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "348"
    scriptarguments:
      brands:
        simple: Active Directory Query v2
      user_name:
        complex:
          root: User_Remediation.Answers
          accessor: "0"
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -4430,
          "y": 6965
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "107":
    id: "107"
    taskid: 1903375e-9d10-4b7f-a27d-626697a79732
    type: condition
    task:
      id: 1903375e-9d10-4b7f-a27d-626697a79732
      version: -1
      name: Is the action performed by a remote actor?
      description: Checks if the action performed by a remote actor.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "364"
      "yes":
      - "256"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: Core.OriginalAlert.event.causality_actor_remote_ip
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 540,
          "y": 5660
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "109":
    id: "109"
    taskid: 01ad5020-df6e-43f8-8572-7079c8b31f1c
    type: regular
    task:
      id: 01ad5020-df6e-43f8-8572-7079c8b31f1c
      version: -1
      name: 'Block the external IP of the remote actor '
      description: The script blocks a list of IP addresses in supported integrations.
      scriptName: block-external-ip
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "364"
    scriptarguments:
      auto_commit:
        simple: "false"
      ip_list:
        simple: ${Core.OriginalAlert.event.causality_actor_remote_ip}
    results:
    - push_job_id
    - commit_job_id
    - panorama_responses
    - executed_brands
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 340,
          "y": 5970
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "131":
    id: "131"
    taskid: e7ca123b-28a2-4f8a-ac84-c84f66311484
    type: title
    task:
      id: e7ca123b-28a2-4f8a-ac84-c84f66311484
      version: -1
      name: Inconclusive
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "254"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1500,
          "y": 4610
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "153":
    id: "153"
    taskid: 03c61a2a-a457-4f55-96d3-a98cc7076745
    type: condition
    task:
      id: 03c61a2a-a457-4f55-96d3-a98cc7076745
      version: -1
      name: Found agent installed on the remote actor?
      description: Checks whether the agent is installed on the remote host.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "155"
      "yes":
      - "61"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: RemoteActorData.AdditionalFields.endpoint_id
            iscontext: true
          right:
            value: {}
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -4290,
          "y": 2300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "155":
    id: "155"
    taskid: 879eb322-d852-409c-a930-a12705c3f97a
    type: regular
    task:
      id: 879eb322-d852-409c-a930-a12705c3f97a
      version: -1
      name: 'Evidence: No agent installed on the remote actor'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "remote_actor_without_agent", "Score": 1, "Comment": "No agent installed on the remote actor"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -4520,
          "y": 2460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "159":
    id: "159"
    taskid: f8b5b4e7-0277-47ea-8b32-c69df2cfaf9a
    type: regular
    task:
      id: f8b5b4e7-0277-47ea-8b32-c69df2cfaf9a
      version: -1
      name: 'Evidence: Related alerts indicating malicious activity were found'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "malicious_related_alerts", "Score": 2.5, "Comment": "Related alerts indicating malicious activity were found"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1800,
          "y": 2170
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "169":
    id: "169"
    taskid: 8f539cf1-8c7d-45cb-9268-568b830e0549
    type: title
    task:
      id: 8f539cf1-8c7d-45cb-9268-568b830e0549
      version: -1
      name: Disable User
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "250"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -4430,
          "y": 6330
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "190":
    id: "190"
    taskid: 44683673-1f59-4552-857d-195d276f99f8
    type: regular
    task:
      id: 44683673-1f59-4552-857d-195d276f99f8
      version: -1
      name: Search related alerts indicating a malicious activity
      description: |
        This task searches related alerts to identify any indications of a malicious activity.
      scriptName: SearchAlertsV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "290"
    scriptarguments:
      extend-context:
        simple: MaliciousRelatedAlerts=
      ignore-outputs:
        simple: "true"
      query:
        complex:
          root: issue
          accessor: parentXDRIncident
          transformers:
          - operator: Cut
            args:
              delimiter:
                value:
                  simple: '-'
              fields:
                value:
                  simple: "2"
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'agentid:${issue.agentid} and -name: "*Masquerading - *" and -name:"Behavioral Threat" and caseid:'
              suffix: {}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1800,
          "y": 1837.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "197":
    id: "197"
    taskid: 747635a9-1d0d-4244-a868-5bb63b57e7ce
    type: regular
    task:
      id: 747635a9-1d0d-4244-a868-5bb63b57e7ce
      version: -1
      name: Quarantine the masqueraded action process
      description: This script executes the 'quarantine-file' command on a specified file via the appropriate agent. This script is used to isolate files identified as suspicious.
      scriptName: quarantine-file
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "349"
    scriptarguments:
      brands:
        simple: Cortex Core - IR
      endpoint_id:
        simple: ${issue.agentid}
      file_hash:
        simple: ${issue.targetprocesssha256.[0]}
      file_path:
        simple: ${Core.OriginalAlert.event.action_process_image_path}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1150,
          "y": 5947.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "198":
    id: "198"
    taskid: ad545b16-7e17-4d80-9f20-4331bddd19e9
    type: regular
    task:
      id: ad545b16-7e17-4d80-9f20-4331bddd19e9
      version: -1
      name: XQL query to retrieve command line under the same causality
      description: |-
        Execute an XQL query and retrieve results of an executed XQL query API. The command will be executed every 10 seconds until results are retrieved or until a timeout error is raised.
        When more than 1000 results are retrieved, the command will return a compressed gzipped JSON format file,
        unless the argument 'parse_result_file_to_context' is set to true and then the results will be extracted to the context.
      script: '|||xdr-xql-generic-query'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#error#':
      - "301"
      '#none#':
      - "295"
    scriptarguments:
      query:
        simple: "dataset  = xdr_data \n| filter agent_id  = \"${issue.agentid}\" and (actor_process_instance_id = \"${issue.actionprocessinstanceid.[0]}\" or os_actor_process_instance_id = \"${issue.actionprocessinstanceid.[0]}\" or causality_actor_causality_id = \"${issue.actionprocessinstanceid.[0]}\" or causality_actor_process_instance_id = \"${issue.actionprocessinstanceid.[0]}\" or action_process_instance_id = \"${issue.actionprocessinstanceid.[0]}\")\n| fields actor_process_command_line\n|alter command_lines = actor_process_command_line\n| union \n(\ndataset  = xdr_data \n| filter agent_id  = \"${issue.agentid}\" and (actor_process_instance_id = \"${issue.actionprocessinstanceid.[0]}\" or os_actor_process_instance_id = \"${issue.actionprocessinstanceid.[0]}\" or causality_actor_causality_id = \"${issue.actionprocessinstanceid.[0]}\" or causality_actor_process_instance_id = \"${issue.actionprocessinstanceid.[0]}\" or action_process_instance_id = \"${issue.actionprocessinstanceid.[0]}\")\n| fields os_actor_process_command_line\n|alter command_lines = os_actor_process_command_line\n)\n| union \n(\ndataset  = xdr_data \n| filter agent_id  = \"${issue.agentid}\" and (actor_process_instance_id = \"${issue.actionprocessinstanceid.[0]}\" or os_actor_process_instance_id = \"${issue.actionprocessinstanceid.[0]}\" or causality_actor_causality_id = \"${issue.actionprocessinstanceid.[0]}\" or causality_actor_process_instance_id = \"${issue.actionprocessinstanceid.[0]}\" or action_process_instance_id = \"${issue.actionprocessinstanceid.[0]}\")\n| fields causality_actor_process_command_line \n|alter command_lines = causality_actor_process_command_line\n)\n| union \n(\ndataset  = xdr_data \n| filter agent_id  = \"${issue.agentid}\" and (actor_process_instance_id = \"${issue.actionprocessinstanceid.[0]}\" or os_actor_process_instance_id = \"${issue.actionprocessinstanceid.[0]}\" or causality_actor_causality_id = \"${issue.actionprocessinstanceid.[0]}\" or causality_actor_process_instance_id = \"${issue.actionprocessinstanceid.[0]}\" or action_process_instance_id = \"${issue.actionprocessinstanceid.[0]}\")\n| fields action_process_image_command_line \n|alter command_lines = action_process_image_command_line \n)\n|fields command_lines \n|dedup command_lines"
      query_name:
        simple: Retrieve_command_lines_from_same_causality
      time_frame:
        simple: between ${XQL.Retrieve_command_lines_from_same_causality.QueryStartTime} and ${XQL.Retrieve_command_lines_from_same_causality.QueryEndTime}
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": 5006.6666259765625,
          "y": 2140
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "199":
    id: "199"
    taskid: 2d4fcadf-fd78-4ab7-b2c4-b97c6da5f081
    type: regular
    task:
      id: 2d4fcadf-fd78-4ab7-b2c4-b97c6da5f081
      version: -1
      name: Set XQL query start time
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "200"
    scriptarguments:
      key:
        simple: XQL.Retrieve_command_lines_from_same_causality.QueryStartTime
      value:
        complex:
          root: issue
          accessor: timestamp
          transformers:
          - operator: ModifyDateTime
            args:
              variation:
                value:
                  simple: 5 min ago
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 5006.6666259765625,
          "y": 1837.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "200":
    id: "200"
    taskid: 558e816e-e7cf-4d4a-96b6-f66b26100d70
    type: regular
    task:
      id: 558e816e-e7cf-4d4a-96b6-f66b26100d70
      version: -1
      name: Set XQL query end time
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "198"
    scriptarguments:
      key:
        simple: XQL.Retrieve_command_lines_from_same_causality.QueryEndTime
      value:
        complex:
          root: issue
          accessor: timestamp
          transformers:
          - operator: ModifyDateTime
            args:
              variation:
                value:
                  simple: in 5 min
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 5006.6666259765625,
          "y": 1992.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "203":
    id: "203"
    taskid: daffe10e-3339-4921-a388-cd1ff4a1d785
    type: condition
    task:
      id: daffe10e-3339-4921-a388-cd1ff4a1d785
      version: -1
      name: Is the action command line including a script path?
      description: Checks if the action command line including a script path.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "302"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: ScriptPath
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 6426.6666259765625,
          "y": 1837.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "205":
    id: "205"
    taskid: d92ba426-e487-4ec0-959c-0f103f5680ed
    type: regular
    task:
      id: d92ba426-e487-4ec0-959c-0f103f5680ed
      version: -1
      name: Close Alert as False Positive
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "365"
    scriptarguments:
      closeNotes:
        simple: No evidence of malicious or suspicious activity detected - Resolved as "False Positive". Handled by the playbook "Execution of significantly renamed lolbin"
      closeReason:
        simple: Resolved - False Positive
      id:
        simple: ${issue.id}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2600,
          "y": 5380
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "250":
    id: "250"
    taskid: be861326-a58e-47e2-8461-8b80d094666c
    type: condition
    task:
      id: be861326-a58e-47e2-8461-8b80d094666c
      version: -1
      name: Were any users found to be disabled?
      description: Validates that the user is a non-system account.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "86"
      "yes":
      - "407"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: UsernameWithoutPrefix
            iscontext: true
          right:
            value: {}
          ignorecase: true
        - operator: isNotEmpty
          left:
            value:
              simple: UsernameMasquardingWithoutPrefix
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -4430,
          "y": 6469.583251953125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "252":
    id: "252"
    taskid: 272b0989-a5d1-4a78-b2b1-df935465f365
    type: condition
    task:
      id: 272b0989-a5d1-4a78-b2b1-df935465f365
      version: -1
      name: Any evidence found requiring remediation?
      description: Checks whether any malicious or suspicious evidence was found during the investigation. If malicious evidence is identified, the playbook proceeds to remediation; otherwise, it continues with deeper investigation.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "131"
      False Positive:
      - "300"
      Remediation:
      - "5"
    separatecontext: false
    conditions:
    - label: Remediation
      condition:
      - - operator: greaterThanOrEqual
          left:
            value:
              complex:
                root: Evidence
                accessor: Score
                transformers:
                - operator: SetIfEmpty
                  args:
                    applyIfEmpty: {}
                    defaultValue:
                      value:
                        simple: "0"
                - operator: SumList
            iscontext: true
          right:
            value:
              simple: "2.5"
    - label: False Positive
      condition:
      - - operator: isEmpty
          left:
            value:
              simple: Evidence.Name
            iscontext: true
      - - operator: isEmpty
          left:
            value:
              simple: Errors
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 510,
          "y": 4440
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "254":
    id: "254"
    taskid: a0de877b-d357-4746-9302-481afa89e3a0
    type: collection
    task:
      id: a0de877b-d357-4746-9302-481afa89e3a0
      version: -1
      name: Analyst Decision
      description: ""
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "255"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1500,
          "y": 4750
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: "During the investigation phase, the playbook identified the following suspicious evidence. Although the combined evidence does not conclusively confirm a true positive, it still warrants suspicion. Please review the evidence below and select the appropriate action.\n\n### Evidence found:\n${Evidence.Comment(val.length > 0) =>\"- \" + val.join(\"\\n - \")} \n\n### Decision Required:\nPlease choose the action you want to perform:\n\n- **False Positive** - Close the alert as a false positive.\n- **True Positive** - Handle the alert as a true positive by:\n       1. Terminating the CGO process\n       2. Logging off and disabling the user\n       3. Quarantine the masqueraded action process\n       4. Quarantine the related script from the action command line if it is detected\n        5. Temporarily blocking the attacker’s remote IP if it is internal\n        6. Blocking the attacker’s remote IP if it is external\n        6. Isolate the host\n**(Note: During the remediation stage, you will need to approve actions that affect the user)**"
        required: false
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: False Positive
        - simple: True Positive
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      title: Analyst_Decision
      description: ""
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "255":
    id: "255"
    taskid: 0091481b-e4d6-4b40-b97d-3de556d3e3a1
    type: condition
    task:
      id: 0091481b-e4d6-4b40-b97d-3de556d3e3a1
      version: -1
      name: Checks Analyst Decision
      description: Checks the analyst’s decision.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "414"
      False Positive:
      - "205"
      True Positive:
      - "5"
    separatecontext: false
    conditions:
    - label: True Positive
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: Analyst_Decision.Answers.0
            iscontext: true
          right:
            value:
              simple: True Positive
          ignorecase: true
    - label: False Positive
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: Analyst_Decision.Answers.0
            iscontext: true
          right:
            value:
              simple: False Positive
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1500,
          "y": 4900
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "256":
    id: "256"
    taskid: 57799708-f679-45a1-af94-d168f2fb16d0
    type: condition
    task:
      id: 57799708-f679-45a1-af94-d168f2fb16d0
      version: -1
      name: Is the remote actor’s IP internal?
      description: Check if the remote IP internal or external.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "109"
      "yes":
      - "99"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: IsInCidrRanges
          left:
            value:
              simple: Core.OriginalAlert.event.causality_actor_remote_ip
            iscontext: true
          right:
            value:
              complex:
                root: lists
                accessor: PrivateIPs
                transformers:
                - operator: RegexExtractAll
                  args:
                    error_if_no_match: {}
                    ignore_case: {}
                    multi_line: {}
                    period_matches_newline: {}
                    regex:
                      value:
                        simple: (\b(?:\d{1,3}\.){3}\d{1,3}\b/\d{1,2})
                    unpack_matches: {}
                - operator: join
                  args:
                    separator:
                      value:
                        simple: ','
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 540,
          "y": 5822.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "257":
    id: "257"
    taskid: d4f389f4-46d5-4341-97c7-37423061e5fb
    type: regular
    task:
      id: d4f389f4-46d5-4341-97c7-37423061e5fb
      version: -1
      name: Extract Related Script path from the action command line
      description: Extracts regex data from the provided text. The script support groups and looping.
      scriptName: MatchRegexV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      contextKey:
        simple: ScriptPath
      data:
        simple: ${issue.targetprocesscmd.[0]}
      regex:
        simple: (?i)([A-Za-z]:\\[^\s\"]+?\.(?:vbs|vbe|vb|js|jse|wsf|wsh|bat|ps1|cmd))
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 940,
          "y": 1490
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "258":
    id: "258"
    taskid: 1e16c998-0bca-4685-aeba-ed8da69c02f4
    type: regular
    task:
      id: 1e16c998-0bca-4685-aeba-ed8da69c02f4
      version: -1
      name: Check processes reputation
      description: 'This script gathers for reputation data from multiple integrations and returns a "FileEnrichment" object with consolidated information in the context output. Note: The script runs core-get-hash-analytics-prevalence on SHA256 values only.'
      scriptName: file-enrichment
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      additional_fields:
        simple: "true"
      external_enrichment:
        simple: "true"
      file_hash:
        complex:
          root: issue.cgosha256
          accessor: '[0]'
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: issue.osparentsha256.[0]
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: issue.initiatorsha256.[0]
                iscontext: true
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1410,
          "y": 1490
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "259":
    id: "259"
    taskid: 16f5f138-07b4-4d8d-b873-e21b35dd7f1e
    type: condition
    task:
      id: 16f5f138-07b4-4d8d-b873-e21b35dd7f1e
      version: -1
      name: Is the process reputation malicious or suspicious?
      description: Checks if the action was performed by a high-risk user.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      Malicious:
      - "260"
      Suspicious:
      - "261"
    separatecontext: false
    conditions:
    - label: Malicious
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: FileEnrichment.TIMScore
            iscontext: true
          right:
            value:
              simple: "3"
          ignorecase: true
    - label: Suspicious
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: FileEnrichment.TIMScore
            iscontext: true
          right:
            value:
              simple: "2"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 210,
          "y": 1837.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "260":
    id: "260"
    taskid: a3337837-29cf-4409-ac64-e83a9228ad43
    type: regular
    task:
      id: a3337837-29cf-4409-ac64-e83a9228ad43
      version: -1
      name: 'Evidence: A malicious process was detected based on its reputation'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "process_reputation", "Score": 2.5, "Comment": "A malicious process was detected based on its reputation"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -80,
          "y": 1992.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "261":
    id: "261"
    taskid: c1cb4884-db14-457b-9700-3eba61c8709a
    type: regular
    task:
      id: c1cb4884-db14-457b-9700-3eba61c8709a
      version: -1
      name: 'Evidence: A suspicious process was detected based on its reputation'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "process_reputation", "Score": 1.5, "Comment": "A suspicious process was detected based on its reputation"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 210,
          "y": 2120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "262":
    id: "262"
    taskid: 0839f7bd-f8f3-4929-bcc9-3c996f91036e
    type: regular
    task:
      id: 0839f7bd-f8f3-4929-bcc9-3c996f91036e
      version: -1
      name: Command Line Analysis
      description: |-
        This script evaluates command-line threats by analyzing both original and decoded inputs. It assigns weighted scores to detected patterns, such as AMSI bypass or credential dumping, and applies risk combination bonuses for multiple detections. The total score is normalized to a 0-100 scale, with risk levels categorized as follows:

        * 0-25: Low Risk
        * 26-50: Medium Risk
        * 51-90: High Risk
        * 91-100: Critical Risk

        The scoring mechanism provides a comprehensive risk assessment, considering both the severity and frequency of malicious behaviors.
      scriptName: CommandLineAnalysis
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "263"
    scriptarguments:
      command_line:
        complex:
          root: issue.targetprocesscmd
          accessor: '[0]'
          transformers:
          - operator: AppendIfNotEmpty
            args:
              item:
                value:
                  simple: issue.initiatorcmd.[0]
                iscontext: true
              raw: {}
          - operator: AppendIfNotEmpty
            args:
              item:
                value:
                  simple: issue.osparentcmd.[0]
                iscontext: true
              raw: {}
          - operator: AppendIfNotEmpty
            args:
              item:
                value:
                  simple: issue.cgocmd.[0]
                iscontext: true
              raw: {}
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -500,
          "y": 1837.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "263":
    id: "263"
    taskid: 4cb20e65-0314-4999-a77e-c436cd12114f
    type: condition
    task:
      id: 4cb20e65-0314-4999-a77e-c436cd12114f
      version: -1
      name: Any command lines found with a high or medium risk score?
      description: Checks if the action was performed by a high-risk user.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      Malicious:
      - "264"
      Suspicious:
      - "265"
    separatecontext: false
    conditions:
    - label: Malicious
      condition:
      - - operator: greaterThanOrEqual
          left:
            value:
              simple: CommandLineAnalysis.score
            iscontext: true
          right:
            value:
              simple: "50"
          ignorecase: true
    - label: Suspicious
      condition:
      - - operator: InRange
          left:
            value:
              complex:
                root: CommandLineAnalysis
                accessor: score
                transformers:
                - operator: sort
                  args:
                    descending:
                      value:
                        simple: "true"
                - operator: FirstArrayElement
            iscontext: true
          right:
            value:
              simple: 21,49
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -500,
          "y": 1987.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "264":
    id: "264"
    taskid: b7f15688-26e4-461a-9861-ff01b34e81dc
    type: regular
    task:
      id: b7f15688-26e4-461a-9861-ff01b34e81dc
      version: -1
      name: 'Evidence: A malicious command line detected'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "cmd_analysis", "Score": 2.5, "Comment": "A malicious command line detected"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -790,
          "y": 2140
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "265":
    id: "265"
    taskid: 1b6905e0-e7fb-4789-95dd-8aede3d6919e
    type: regular
    task:
      id: 1b6905e0-e7fb-4789-95dd-8aede3d6919e
      version: -1
      name: 'Evidence: A suspicious command line detected'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "cmd_analysis", "Score": 1, "Comment": "A suspicious command line detected"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -500,
          "y": 2280
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "266":
    id: "266"
    taskid: 26a52761-46d5-4e5d-9072-26a707b0a58b
    type: condition
    task:
      id: 26a52761-46d5-4e5d-9072-26a707b0a58b
      version: -1
      name: Are the processes in the causality chain unsigned?
      description: "Check if the causality chain includes unsigned processes."
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "267"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: containsGeneral
          left:
            value:
              simple: issue.cgosignature.[0]
            iscontext: true
          right:
            value:
              simple: SIGNATURE_UNSIGNED
          ignorecase: true
        - operator: containsGeneral
          left:
            value:
              simple: issue.initiatorsignature.[0]
            iscontext: true
          right:
            value:
              simple: SIGNATURE_UNSIGNED
          ignorecase: true
        - operator: containsGeneral
          left:
            value:
              simple: issue.osparentsignature.[0]
            iscontext: true
          right:
            value:
              simple: SIGNATURE_UNSIGNED
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1280,
          "y": 1837.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "267":
    id: "267"
    taskid: 89c38197-d807-48fb-bcc8-89e420cbc76c
    type: regular
    task:
      id: 89c38197-d807-48fb-bcc8-89e420cbc76c
      version: -1
      name: 'Evidence: Unsigned process in the causality chain'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "process_signature", "Score": 0.5, "Comment": "Unsigned process in the causality chain"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1280,
          "y": 2010
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "268":
    id: "268"
    taskid: 80514fce-80f5-4a1a-b1ec-a94ea9b85a4c
    type: condition
    task:
      id: 80514fce-80f5-4a1a-b1ec-a94ea9b85a4c
      version: -1
      name: Was the issue triggered by attack simulation tool?
      description: Checks if the action performed on DC server with a high risk level.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "269"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: issue
                accessor: targetprocesscmd
                transformers:
                - operator: AppendIfNotEmpty
                  args:
                    item:
                      value:
                        simple: issue.osparentcmd.[0]
                      iscontext: true
                    raw: {}
                - operator: AppendIfNotEmpty
                  args:
                    item:
                      value:
                        simple: issue.initiatorcmd.[0]
                      iscontext: true
                    raw: {}
                - operator: AppendIfNotEmpty
                  args:
                    item:
                      value:
                        simple: issue.cgocmd.[0]
                      iscontext: true
                    raw: {}
                - operator: RegexExtractAll
                  args:
                    error_if_no_match: {}
                    ignore_case: {}
                    multi_line: {}
                    period_matches_newline: {}
                    regex:
                      value:
                        simple: (?i)\b(?:cymulate|safebreach|attackiq|verodin|attackforge|picus|caldera|T1036|atomic[ _-]?red[ _-]?team)
                    unpack_matches: {}
            iscontext: true
          right:
            value: {}
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2740,
          "y": 1837.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "269":
    id: "269"
    taskid: 8723b832-de18-43cb-a32e-361d2adf0380
    type: regular
    task:
      id: 8723b832-de18-43cb-a32e-361d2adf0380
      version: -1
      name: 'Evidence: The action performed by attack simulation tool'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "attack_simulation_tool", "Score": 2.5, "Comment": "The action performed by attack simulation tool"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2740,
          "y": 2010
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "270":
    id: "270"
    taskid: 79abbddb-57a7-46ec-bd4d-a32a5a0ec784
    type: condition
    task:
      id: 79abbddb-57a7-46ec-bd4d-a32a5a0ec784
      version: -1
      name: Was the action process executed from a suspicious path?
      description: Checks if the action performed on DC server with a high risk level.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "271"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: Core.OriginalAlert.event
                accessor: action_process_image_path
                transformers:
                - operator: RegexExtractAll
                  args:
                    error_if_no_match: {}
                    ignore_case: {}
                    multi_line: {}
                    period_matches_newline: {}
                    regex:
                      value:
                        simple: (?i)\b(document|downloads|desktop)
                    unpack_matches: {}
            iscontext: true
          right:
            value: {}
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 830,
          "y": 1837.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "271":
    id: "271"
    taskid: 5872b74d-d4b7-4af6-8a70-991599047c1f
    type: regular
    task:
      id: 5872b74d-d4b7-4af6-8a70-991599047c1f
      version: -1
      name: 'Evidence: The action process executed from a suspicious path'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "suspicious_execution_path", "Score": 1, "Comment": "The action process executed from a suspicious path"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 830,
          "y": 2010
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "272":
    id: "272"
    taskid: 89decb60-243e-4c52-8989-8651796c3c9b
    type: regular
    task:
      id: 89decb60-243e-4c52-8989-8651796c3c9b
      version: -1
      name: 'Error: XQL task failed to verify whether the remote actor IP is new'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Errors
      value:
        simple: '{"Name": "XQL_check_new_remote_actor_ip", "Comment": "XQL task failed to verify whether the remote actor IP is new"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2750,
          "y": 2590
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "273":
    id: "273"
    taskid: 2c75e083-4f48-4636-9848-b2c15383543c
    type: condition
    task:
      id: 2c75e083-4f48-4636-9848-b2c15383543c
      version: -1
      name: known masquerading Techniques?
      description: "Checks for known masquerading techniques."
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      Accessibility Tools:
      - "275"
      System Process Mimicry:
      - "276"
    separatecontext: false
    conditions:
    - label: Accessibility Tools
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: issue.targetprocessname
            iscontext: true
          right:
            value:
              simple: sethc.exe
          ignorecase: true
        - operator: isEqualString
          left:
            value:
              simple: issue.targetprocessname
            iscontext: true
          right:
            value:
              simple: utilman.exe
          ignorecase: true
        - operator: isEqualString
          left:
            value:
              simple: issue.targetprocessname
            iscontext: true
          right:
            value:
              simple: osk.exe
          ignorecase: true
        - operator: isEqualString
          left:
            value:
              simple: issue.targetprocessname
            iscontext: true
          right:
            value:
              simple: Magnify.exe
          ignorecase: true
        - operator: isEqualString
          left:
            value:
              simple: issue.targetprocessname
            iscontext: true
          right:
            value:
              simple: AtBroker.exe
          ignorecase: true
        - operator: isEqualString
          left:
            value:
              simple: issue.targetprocessname
            iscontext: true
          right:
            value:
              simple: DisplaySwitch.exe
          ignorecase: true
        - operator: isEqualString
          left:
            value:
              simple: issue.targetprocessname
            iscontext: true
          right:
            value:
              simple: Narrator.exe
          ignorecase: true
      - - operator: isEqualString
          left:
            value:
              simple: Core.OriginalAlert.event.action_process_file_info_original_file_name
            iscontext: true
          right:
            value:
              simple: cmd.exe
          ignorecase: true
        - operator: isEqualString
          left:
            value:
              simple: Core.OriginalAlert.event.action_process_file_info_original_file_name
            iscontext: true
          right:
            value:
              simple: powershell.exe
    - label: System Process Mimicry
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: Core.OriginalAlert.event.action_process_file_info_original_file_name
            iscontext: true
          right:
            value:
              simple: cmd.exe
          ignorecase: true
        - operator: isEqualString
          left:
            value:
              simple: Core.OriginalAlert.event.action_process_file_info_original_file_name
            iscontext: true
          right:
            value:
              simple: powershell.exe
          ignorecase: true
        - operator: isEqualString
          left:
            value:
              simple: Core.OriginalAlert.event.action_process_file_info_original_file_name
            iscontext: true
          right:
            value:
              simple: wscript.exe
          ignorecase: true
        - operator: isEqualString
          left:
            value:
              simple: Core.OriginalAlert.event.action_process_file_info_original_file_name
            iscontext: true
          right:
            value:
              simple: Microsoft.Workflow.Compiler.exe
          ignorecase: true
      - - operator: isEqualString
          left:
            value:
              simple: issue.targetprocessname
            iscontext: true
          right:
            value:
              simple: lsass.exe
          ignorecase: true
        - operator: isEqualString
          left:
            value:
              simple: issue.targetprocessname
            iscontext: true
          right:
            value:
              simple: svchost.exe
        - operator: isEqualString
          left:
            value:
              simple: issue.initiatedby
            iscontext: true
          right:
            value:
              simple: wordpad.exe
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3170,
          "y": 1837.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "275":
    id: "275"
    taskid: 11747b9b-e756-454b-9c4a-173b65050ee5
    type: regular
    task:
      id: 11747b9b-e756-454b-9c4a-173b65050ee5
      version: -1
      name: 'Evidence: A known masquerading technique was detected using accessibility tools'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "known_masquerading_technique", "Score": 2.5, "Comment": "A known masquerading technique was detected using accessibility tools"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3450,
          "y": 2020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "276":
    id: "276"
    taskid: 67aaf08d-ca89-429e-9883-74fa7f4ee3d1
    type: regular
    task:
      id: 67aaf08d-ca89-429e-9883-74fa7f4ee3d1
      version: -1
      name: 'Evidence: A Known masquerading technique detected using system process mimicry'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "known_masquerading_technique", "Score": 2.5, "Comment": "A Known masquerading technique detected using system process mimicry"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3170,
          "y": 2195
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "290":
    id: "290"
    taskid: 05399c7a-aba7-4a3d-8076-ae26350a6c12
    type: condition
    task:
      id: 05399c7a-aba7-4a3d-8076-ae26350a6c12
      version: -1
      name: Found related alerts indicating a malicious activity?
      description: Checks whether any related alerts indicating a malicious activity were found.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "159"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: MaliciousRelatedAlerts.Contents.data.sourceBrand
            iscontext: true
          right:
            value: {}
      - - operator: containsGeneral
          left:
            value:
              simple: MaliciousRelatedAlerts.Contents.data.sourceBrand
            iscontext: true
          right:
            value:
              simple: TRAPS
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1800,
          "y": 2010
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "292":
    id: "292"
    taskid: 3f5035e3-e15d-4b3a-843e-de51b31a2abe
    type: condition
    task:
      id: 3f5035e3-e15d-4b3a-843e-de51b31a2abe
      version: -1
      name: Found related alerts across multiple masquerading techniques?
      description: Checks whether related alerts across multiple masquerading techniques were found indicating suspicious or malicious activity.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      Malicious:
      - "294"
      Suspicious:
      - "375"
    separatecontext: false
    conditions:
    - label: Malicious
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: MultipleMasqueradingRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value: {}
      - - operator: greaterThanOrEqual
          left:
            value:
              complex:
                root: MultipleMasqueradingRelatedAlerts.Contents.data
                accessor: name
                transformers:
                - operator: uniq
                - operator: count
            iscontext: true
          right:
            value:
              simple: "2"
          ignorecase: true
        - operator: containsGeneral
          left:
            value:
              simple: MultipleMasqueradingRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: Masquerading - 1396383840
    - label: Suspicious
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: MultipleMasqueradingRelatedAlerts.Contents.data.name
            iscontext: true
        - operator: isEqualNumber
          left:
            value:
              complex:
                root: MultipleMasqueradingRelatedAlerts.Contents.data
                accessor: name
                transformers:
                - operator: uniq
                - operator: count
            iscontext: true
          right:
            value:
              simple: "1"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2330,
          "y": 2010
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "293":
    id: "293"
    taskid: 3f797bd2-e9a1-45f4-9859-974bb611c557
    type: regular
    task:
      id: 3f797bd2-e9a1-45f4-9859-974bb611c557
      version: -1
      name: Search for related alerts across multiple masquerading techniques
      description: This task searches related alerts across multiple masquerading techniques to identify any indications of a suspicious or malicious activity.
      scriptName: SearchAlertsV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "292"
    scriptarguments:
      extend-context:
        simple: MultipleMasqueradingRelatedAlerts=
      ignore-outputs:
        simple: "true"
      query:
        complex:
          root: issue
          accessor: parentXDRIncident
          transformers:
          - operator: Cut
            args:
              delimiter:
                value:
                  simple: '-'
              fields:
                value:
                  simple: "2"
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'agentid:${issue.agentid} and name: "*Masquerading - *" and -name:"Masquerading - 767930202" and -name:"Masquerading - 305668593" and -name:"Masquerading - 3489326785" and caseid:'
              suffix: {}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2330,
          "y": 1837.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "294":
    id: "294"
    taskid: 7d7355a8-ae01-476a-81c8-639cf9a78776
    type: regular
    task:
      id: 7d7355a8-ae01-476a-81c8-639cf9a78776
      version: -1
      name: 'Evidence: Related alerts across multiple masquerading techniques were found on the host'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "masquerading_related_alerts", "Score": 2.5, "Comment": "Related alerts across multiple masquerading techniques were found on the host"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2650,
          "y": 2195
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "295":
    id: "295"
    taskid: 7c3eb637-220c-49e2-babc-a456beb06e12
    type: condition
    task:
      id: 7c3eb637-220c-49e2-babc-a456beb06e12
      version: -1
      name: Found command lines under the same causality?
      description: Verifies whether the command lines under the same causality were retrieved from the XQL query.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "297"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: PaloAltoNetworksXQL.GenericQuery.results.command_lines
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 5006.6666259765625,
          "y": 2300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "296":
    id: "296"
    taskid: f4128890-219c-40b9-b138-b72ecbe0f3fb
    type: regular
    task:
      id: f4128890-219c-40b9-b138-b72ecbe0f3fb
      version: -1
      name: 'Evidence: Malicious command line detected in the causality chain'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "causality_command_line", "Score": 2.5, "Comment": "Malicious command line detected in the causality chain"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4770,
          "y": 2760
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "297":
    id: "297"
    taskid: b3a8061a-d41d-4619-a7fc-6a9c9e338891
    type: regular
    task:
      id: b3a8061a-d41d-4619-a7fc-6a9c9e338891
      version: -1
      name: Command Line Analysis
      description: |-
        This script evaluates command-line threats by analyzing both original and decoded inputs. It assigns weighted scores to detected patterns, such as AMSI bypass or credential dumping, and applies risk combination bonuses for multiple detections. The total score is normalized to a 0-100 scale, with risk levels categorized as follows:

        * 0-25: Low Risk
        * 26-50: Medium Risk
        * 51-90: High Risk
        * 91-100: Critical Risk

        The scoring mechanism provides a comprehensive risk assessment, considering both the severity and frequency of malicious behaviors.
      scriptName: CommandLineAnalysis
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "298"
    scriptarguments:
      command_line:
        simple: ${PaloAltoNetworksXQL.GenericQuery.results.command_lines}
      custom_patterns:
        simple: (?i)net(\.exe)?\s+(user|localgroup|group|use|view|share|start|stop|all|accounts)|reg\s+save|password|whoami|transfercertutil
      extend-context:
        simple: CommandLineAnalysisXQLResults=
      ignore-outputs:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 5006.6666259765625,
          "y": 2460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "298":
    id: "298"
    taskid: 4d94a00e-7a71-4db6-b8b8-b22df0f84a89
    type: condition
    task:
      id: 4d94a00e-7a71-4db6-b8b8-b22df0f84a89
      version: -1
      name: Found Malicious Command line?
      description: Checks if the command line analysis detected high-risk patterns or scored above the risk threshold.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      Malicious:
      - "296"
      Suspicious:
      - "299"
    separatecontext: false
    conditions:
    - label: Malicious
      condition:
      - - operator: greaterThan
          left:
            value:
              simple: CommandLineAnalysisXQLResults.score
            iscontext: true
          right:
            value:
              simple: "50"
        - operator: isNotEmpty
          left:
            value:
              simple: CommandLineAnalysisXQLResults.analysis.original.custom_patterns
            iscontext: true
    - label: Suspicious
      condition:
      - - operator: InRange
          left:
            value:
              complex:
                root: CommandLineAnalysisXQLResults
                accessor: score
                transformers:
                - operator: sort
                  args:
                    descending:
                      value:
                        simple: "true"
                - operator: FirstArrayElement
            iscontext: true
          right:
            value:
              simple: 26,50
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 5006.6666259765625,
          "y": 2604.16650390625
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "299":
    id: "299"
    taskid: 42400922-e19e-4957-b941-2deb273d470e
    type: regular
    task:
      id: 42400922-e19e-4957-b941-2deb273d470e
      version: -1
      name: 'Evidence: Suspicious command line detected in the causality chain'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "causality_command_line", "Score": 1, "Comment": "Suspicious command line detected in the causality chain"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 5220,
          "y": 2760
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "300":
    id: "300"
    taskid: a5cca6e1-e0d9-4c51-9775-78ef2fefbcff
    type: title
    task:
      id: a5cca6e1-e0d9-4c51-9775-78ef2fefbcff
      version: -1
      name: False Positive
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "205"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2600,
          "y": 4610
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "301":
    id: "301"
    taskid: 7743197f-83cc-430c-a273-0d0f96eb0945
    type: regular
    task:
      id: 7743197f-83cc-430c-a273-0d0f96eb0945
      version: -1
      name: 'Error: XQL task failed to retrieve command line under the same causality'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Errors
      value:
        simple: '{"Name": "XQL_Retrieve_command_lines_from_same_causality", "Comment": "XQL task failed to retrieve command line under the same causality"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4580,
          "y": 2300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "302":
    id: "302"
    taskid: 9b45341f-1594-4cac-a4ab-103227308cac
    type: regular
    task:
      id: 9b45341f-1594-4cac-a4ab-103227308cac
      version: -1
      name: Retrieve Script Files
      description: Retrieves script files from the endpoint.
      script: '|||core-retrieve-files'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#error#':
      - "321"
      '#none#':
      - "303"
    scriptarguments:
      endpoint_ids:
        simple: ${alert.agentid}
      windows_file_paths:
        simple: ${ScriptPath}
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": 6426.6666259765625,
          "y": 2010
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "303":
    id: "303"
    taskid: f23139d0-8dc4-4e35-89f1-214636d9664d
    type: regular
    task:
      id: f23139d0-8dc4-4e35-89f1-214636d9664d
      version: -1
      name: Retrieve file details
      description: View the file retrieved by the core-retrieve-files command according to the action ID. Before running this command, you can use the core-action-status-get command to check if this action completed successfully.
      script: '|||core-retrieve-file-details'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "304"
    scriptarguments:
      action_id:
        simple: ${Core.RetrievedFiles.action_id}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 6426.6666259765625,
          "y": 2150.833251953125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "304":
    id: "304"
    taskid: 3ad3ef52-afa9-40f7-8894-46bd3d695adc
    type: regular
    task:
      id: 3ad3ef52-afa9-40f7-8894-46bd3d695adc
      version: -1
      name: Unzip Script file
      description: Unzip a file using fileName or entryID to specify a file. Unzipped files will be loaded to the War Room and names will be put into the context.
      scriptName: UnzipFile
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "310"
    scriptarguments:
      entryID:
        simple: ${File.EntryID}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 6426.6666259765625,
          "y": 2300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "305":
    id: "305"
    taskid: 7fffec8a-37a1-4d52-890a-cef27e4afcde
    type: regular
    task:
      id: 7fffec8a-37a1-4d52-890a-cef27e4afcde
      version: -1
      name: Loads script contents to context
      description: Load the contents of a file into context.
      scriptName: ReadFile
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "325"
    scriptarguments:
      entryID:
        complex:
          root: File
          filters:
          - - operator: inList
              left:
                value:
                  simple: File.Info
                iscontext: true
              right:
                value:
                  simple: vbs,vbe,vb,js,jse,ps1,bat,jar,cpl,wsf,wsh,asp,cmd,hta,pyc,rb,py,sh
              ignorecase: true
          accessor: EntryID
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 6426.6666259765625,
          "y": 3071.833251953125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "306":
    id: "306"
    taskid: ec3cda09-238b-47ab-8f3b-f73d3a02d5d1
    type: regular
    task:
      id: ec3cda09-238b-47ab-8f3b-f73d3a02d5d1
      version: -1
      name: Command Line Analysis
      description: |-
        This script evaluates command-line threats by analyzing both original and decoded inputs. It assigns weighted scores to detected patterns, such as AMSI bypass or credential dumping, and applies risk combination bonuses for multiple detections. The total score is normalized to a 0-100 scale, with risk levels categorized as follows:

        * 0-25: Low Risk
        * 26-50: Medium Risk
        * 51-90: High Risk
        * 91-100: Critical Risk

        The scoring mechanism provides a comprehensive risk assessment, considering both the severity and frequency of malicious behaviors.
      scriptName: CommandLineAnalysis
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "307"
    scriptarguments:
      command_line:
        simple: ${FileData}
      custom_patterns:
        simple: (?i)(DownloadFile|\$payload|regsvr32|subprocess|chr|urlopen|socket\.socket|addEventListener|unescape|WinHttpRequest|bitsadmin|beval\(|atob\(|WScript\.Sleep|String\.fromCharCode|binascii\.a2b_base64|Base64Decode|CreateObject\(\"Wscript\.Shell\"\)|objShell\.Run|requests\.get|os\.system|os\.popen|urllib\.request|ctypes\.windll\.kernel32|Base64\.decode64|base64\.b64decode|ActiveXObject\(\"WScript\.Shell\"\)|ActiveXObject\(\"MSXML2\.XMLHTTP\"\)|ActiveXObject\(\"MSXML2\.ServerXMLHTTP\"\)|addEventListener\(\)|ADODB\.Stream|Scripting\.FileSystemObject|Shell\.Application|GetObject\(\"winmgmts\:|-ExecutionPolicy\s+Unrestricted)
      extend-context:
        simple: CommandLineAnalysisScript=
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 5976.6666259765625,
          "y": 3410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "307":
    id: "307"
    taskid: 440ff391-f03b-41f3-aeb5-fb72d25e15cb
    type: condition
    task:
      id: 440ff391-f03b-41f3-aeb5-fb72d25e15cb
      version: -1
      name: Does the script have a malicious or suspicious parameters?
      description: |+
        This task evaluates the command-line analysis results and checks if the risk score is greater than or equal to 30. If it is, mark the result as **Malicious**.

        If the score is in the range of 10–29, mark the result as **Suspicious**.

      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "315"
      Malicious:
      - "318"
      Suspicious:
      - "319"
    separatecontext: false
    conditions:
    - label: Malicious
      condition:
      - - operator: greaterThan
          left:
            value:
              simple: CommandLineAnalysisScript.score
            iscontext: true
          right:
            value:
              simple: "50"
    - label: Suspicious
      condition:
      - - operator: InRange
          left:
            value:
              complex:
                root: CommandLineAnalysisScript
                accessor: score
                transformers:
                - operator: sort
                  args:
                    descending:
                      value:
                        simple: "true"
                - operator: FirstArrayElement
            iscontext: true
          right:
            value:
              simple: 26,50
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 5976.6666259765625,
          "y": 3565
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "308":
    id: "308"
    taskid: 28d2a10f-a328-4dee-a45f-1764172b3af1
    type: condition
    task:
      id: 28d2a10f-a328-4dee-a45f-1764172b3af1
      version: -1
      name: Does the script have a malicious reputation?
      description: Determines the appropriate verdict based on the reputation of the scripts files.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "305"
      Malicious:
      - "323"
      Suspicious:
      - "324"
    separatecontext: false
    conditions:
    - label: Malicious
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: FileEnrichment
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: FileEnrichment.Value
                      iscontext: true
                    right:
                      value:
                        simple: ScriptSHA256
                      iscontext: true
                    ignorecase: true
                accessor: TIMScore
            iscontext: true
          right:
            value: {}
      - - operator: isEqualNumber
          left:
            value:
              complex:
                root: FileEnrichment
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: FileEnrichment.Value
                      iscontext: true
                    right:
                      value:
                        simple: ScriptSHA256
                      iscontext: true
                    ignorecase: true
                accessor: TIMScore
            iscontext: true
          right:
            value:
              simple: "3"
    - label: Suspicious
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: FileEnrichment
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: FileEnrichment.Value
                      iscontext: true
                    right:
                      value:
                        simple: ScriptSHA256
                      iscontext: true
                accessor: TIMScore
            iscontext: true
      - - operator: isEqualString
          left:
            value:
              complex:
                root: FileEnrichment
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: FileEnrichment.Value
                      iscontext: true
                    right:
                      value:
                        simple: ScriptSHA256
                      iscontext: true
                accessor: TIMScore
            iscontext: true
          right:
            value:
              simple: "2"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 6426.6666259765625,
          "y": 2913.833251953125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "309":
    id: "309"
    taskid: 6553c39f-f366-4050-974e-dd9e7c3816de
    type: regular
    task:
      id: 6553c39f-f366-4050-974e-dd9e7c3816de
      version: -1
      name: Check the script file reputation
      description: This script gathers file reputation data from multiple integrations and returns a "FileEnrichment" object with consolidated information to the context output.
      scriptName: file-enrichment
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "308"
    scriptarguments:
      external_enrichment:
        simple: "true"
      file_hash:
        simple: ${ScriptSHA256}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 6426.6666259765625,
          "y": 2760
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "310":
    id: "310"
    taskid: 93ea6f57-8c65-4120-89a5-2e3efb127295
    type: condition
    task:
      id: 93ea6f57-8c65-4120-89a5-2e3efb127295
      version: -1
      name: Script Successfully Retrieved?
      description: Checks whether the script was retrieved successfully.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "321"
      "yes":
      - "311"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: ExtractedFiles
            iscontext: true
          right:
            value: {}
      - - operator: inList
          left:
            value:
              simple: File.Info
            iscontext: true
          right:
            value:
              simple: vbs,vbe,vb,js,jse,ps1,bat,wsf,wsh,cmd
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 6426.6666259765625,
          "y": 2460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "311":
    id: "311"
    taskid: 4f10b9f5-cd68-4c33-bbce-c594db210e70
    type: regular
    task:
      id: 4f10b9f5-cd68-4c33-bbce-c594db210e70
      version: -1
      name: Set Script SHA256
      description: Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "309"
    scriptarguments:
      key:
        simple: ScriptSHA256
      value:
        complex:
          root: File
          filters:
          - - operator: inList
              left:
                value:
                  simple: File.Info
                iscontext: true
              right:
                value:
                  simple: vbs,vbe,vb,js,jse,ps1,bat,wsf,wsh,cmd
              ignorecase: true
          accessor: SHA256
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 6426.6666259765625,
          "y": 2620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "312":
    id: "312"
    taskid: a7ec9eba-4eeb-4c1e-a3e7-46303da507fd
    type: playbook
    task:
      id: a7ec9eba-4eeb-4c1e-a3e7-46303da507fd
      version: -1
      name: Wildfire Sandbox - Detonate and Analyze File
      description: |
        This playbook uploads, detonates, and analyzes files for the Wildfire sandbox.
      playbookName: Wildfire Detonate and Analyze File
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "313"
    scriptarguments:
      File:
        complex:
          root: File
          filters:
          - - operator: inList
              left:
                value:
                  simple: File.Info
                iscontext: true
              right:
                value:
                  simple: vbs,vbe,vb,js,jse,ps1,bat,wsf,wsh,cmd
              ignorecase: true
    separatecontext: false
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 7086.833251953125,
          "y": 3678.833251953125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "313":
    id: "313"
    taskid: dfe4bf6f-155a-4b86-8e40-e453a273aecf
    type: regular
    task:
      id: dfe4bf6f-155a-4b86-8e40-e453a273aecf
      version: -1
      name: Wildfire get verdict
      description: Returns a verdict for a hash.
      script: '|||wildfire-get-verdict'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "314"
    scriptarguments:
      hash:
        simple: ${ScriptSHA256}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 7086.833251953125,
          "y": 3824.833251953125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "314":
    id: "314"
    taskid: b4c7e0c2-8cba-466b-83e7-a8f7ddc5c622
    type: condition
    task:
      id: b4c7e0c2-8cba-466b-83e7-a8f7ddc5c622
      version: -1
      name: Is the WildFire verdict malicious for the script?
      description: Checks if the WildFire verdict is malicious for the script.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      Malicious:
      - "320"
    separatecontext: false
    conditions:
    - label: Malicious
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: WildFire.Verdicts.VerdictDescription
            iscontext: true
          right:
            value:
              simple: malware
          ignorecase: true
        - operator: isEqualString
          left:
            value:
              simple: WildFire.Verdicts.VerdictDescription
            iscontext: true
          right:
            value:
              simple: C2
          ignorecase: true
        - operator: isEqualString
          left:
            value:
              simple: WildFire.Verdicts.VerdictDescription
            iscontext: true
          right:
            value:
              simple: phishing
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 6836.6666259765625,
          "y": 3970.833251953125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "315":
    id: "315"
    taskid: df381014-81b9-4073-8c40-7ee12e517dbd
    type: regular
    task:
      id: df381014-81b9-4073-8c40-7ee12e517dbd
      version: -1
      name: Wildfire get verdict
      description: Returns a verdict for a hash.
      script: '|||wildfire-get-verdict'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "316"
    scriptarguments:
      hash:
        simple: ${ScriptSHA256}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 6836.6666259765625,
          "y": 3383.833251953125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "316":
    id: "316"
    taskid: 836d63cc-d96b-430f-81e8-0a18cba80f7b
    type: condition
    task:
      id: 836d63cc-d96b-430f-81e8-0a18cba80f7b
      version: -1
      name: Is the hash known by WildFire Sandbox?
      description: Checks if the hash is known by WildFire Sandbox.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "312"
      "yes":
      - "314"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: notContainsString
          left:
            value:
              simple: WildFire.Verdicts.VerdictDescription
            iscontext: true
          right:
            value:
              simple: unknown
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 6836.6666259765625,
          "y": 3525
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "318":
    id: "318"
    taskid: cf3e71f2-b404-47f6-89cd-ac045c67d54a
    type: regular
    task:
      id: cf3e71f2-b404-47f6-89cd-ac045c67d54a
      version: -1
      name: 'Evidence: Malicious script detected in the action command line by command-line analysis'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "script_analysis", "Score": 2.5, "Comment": "Malicious script detected in the action command line by command-line analysis"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 5765.8330078125,
          "y": 3718.833251953125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "319":
    id: "319"
    taskid: 01681221-0321-430f-ab6a-4f215659d888
    type: regular
    task:
      id: 01681221-0321-430f-ab6a-4f215659d888
      version: -1
      name: 'Evidence: Suspicious script detected in the action command line by command-line analysis'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "script_analysis", "Score": 1, "Comment": "Suspicious script detected in the action command line by command-line analysis"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 6205.8330078125,
          "y": 3718.833251953125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "320":
    id: "320"
    taskid: 386e3ca6-0665-477a-9209-cffbcedf1f00
    type: regular
    task:
      id: 386e3ca6-0665-477a-9209-cffbcedf1f00
      version: -1
      name: 'Evidence: A malicious script was detected in the action command line using WildFire'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "wildfire", "Score": 2.5, "Comment": "A malicious script was detected in the action command line using WildFire"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 6836.6666259765625,
          "y": 4125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "321":
    id: "321"
    taskid: 9b8b4b16-ff90-4e8f-b8ec-e36d27e7f201
    type: regular
    task:
      id: 9b8b4b16-ff90-4e8f-b8ec-e36d27e7f201
      version: -1
      name: 'Error: The playbook failed to retrieve the script file'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Errors
      value:
        simple: '{"Name": "Retrieve_script_file", "Comment": "The playbook failed to retrieve the script file"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 5805.8330078125,
          "y": 2620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "323":
    id: "323"
    taskid: 5038d96c-1a8b-487d-8c28-3c3680283048
    type: regular
    task:
      id: 5038d96c-1a8b-487d-8c28-3c3680283048
      version: -1
      name: 'Evidence: A malicious script was detected from the command line based on its reputation'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "script_reputation", "Score": 2.5, "Comment": "A malicious script was detected from the command line based on its reputation"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 5546.6666259765625,
          "y": 3071.833251953125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "324":
    id: "324"
    taskid: e33d16f8-a93e-4ca8-9ced-2614bc7fc060
    type: regular
    task:
      id: e33d16f8-a93e-4ca8-9ced-2614bc7fc060
      version: -1
      name: 'Evidence: A suspicious script was detected from the command line based on its reputation'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "script_reputation", "Score": 1.5, "Comment": "A suspicious script was detected from the command line based on its reputation"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 5996.6666259765625,
          "y": 3071.833251953125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "325":
    id: "325"
    taskid: bdc86f9b-eff9-437b-8973-76a0a18f6b83
    type: condition
    task:
      id: bdc86f9b-eff9-437b-8973-76a0a18f6b83
      version: -1
      name: Is the script is bat or ps1 file?
      description: Checks whether the script was retrieved successfully.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "315"
      "yes":
      - "306"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: ExtractedFiles
            iscontext: true
          right:
            value: {}
      - - operator: inList
          left:
            value:
              simple: File.Info
            iscontext: true
          right:
            value:
              simple: ps1,bat,cmd
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 6426.6666259765625,
          "y": 3220
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "333":
    id: "333"
    taskid: 1fed7c66-c523-4c92-b9b4-24a61f5a8059
    type: title
    task:
      id: 1fed7c66-c523-4c92-b9b4-24a61f5a8059
      version: -1
      name: Quarantine Script
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "334"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2470,
          "y": 5515
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "334":
    id: "334"
    taskid: c00d321b-76c0-4bef-81b6-bdf4eabf8891
    type: condition
    task:
      id: c00d321b-76c0-4bef-81b6-bdf4eabf8891
      version: -1
      name: Is the action command line including a script path?
      description: Checks if the action command line including a script path.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "358"
      "yes":
      - "340"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: ScriptPath
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2470,
          "y": 5657.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "336":
    id: "336"
    taskid: b1ec49d5-8072-478e-b7ee-148c32b4c5bc
    type: regular
    task:
      id: b1ec49d5-8072-478e-b7ee-148c32b4c5bc
      version: -1
      name: Quarantine the script file
      description: This script executes the 'quarantine-file' command on a specified file via the appropriate agent. This script is used to isolate files identified as suspicious.
      scriptName: quarantine-file
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "360"
    scriptarguments:
      brands:
        simple: Cortex Core - IR
      endpoint_id:
        simple: ${issue.agentid}
      file_hash:
        simple: ${ScriptSHA256}
      file_path:
        simple: ${ScriptPath}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2470,
          "y": 5970
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "337":
    id: "337"
    taskid: 7de42d8d-c283-45fe-93f0-6d4222cf1ce5
    type: condition
    task:
      id: 7de42d8d-c283-45fe-93f0-6d4222cf1ce5
      version: -1
      name: Is it possible to quarantine the masqueraded process?
      description: Checks if it is possible to quarantine the masqueraded process.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "339"
      "yes":
      - "338"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEmpty
          left:
            value:
              complex:
                root: Core.OriginalAlert.event
                accessor: action_process_image_path
                transformers:
                - operator: RegexExtractAll
                  args:
                    error_if_no_match: {}
                    ignore_case: {}
                    multi_line: {}
                    period_matches_newline: {}
                    regex:
                      value:
                        simple: (?i)\b[A-Z]:\\Windows\\(?:(System32|SysWOW64)\\[^\\\/:*?\"<>|]+\.exe|System32\\WindowsPowerShell\\v1\.0\\[^\\\/:*?\"<>|]+\.exe)\b
                    unpack_matches: {}
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1390,
          "y": 5657.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "338":
    id: "338"
    taskid: b33c084f-7c60-42b5-8175-797a45701e23
    type: title
    task:
      id: b33c084f-7c60-42b5-8175-797a45701e23
      version: -1
      name: Quarantine masqueraded process
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "197"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1150,
          "y": 5812.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "339":
    id: "339"
    taskid: da6efbb9-059e-44a3-a4fe-7df427ca6614
    type: title
    task:
      id: da6efbb9-059e-44a3-a4fe-7df427ca6614
      version: -1
      name: Rename the masqueraded process
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "373"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1600,
          "y": 5812.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "340":
    id: "340"
    taskid: 94ecac65-1c57-4b6b-a506-5275fe831b38
    type: condition
    task:
      id: 94ecac65-1c57-4b6b-a506-5275fe831b38
      version: -1
      name: Script SHA256 Successfully Retrieved?
      description: Checks whether the script was retrieved successfully.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "361"
      "yes":
      - "336"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: ScriptSHA256
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2470,
          "y": 5812.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "341":
    id: "341"
    taskid: f17293a6-6bbf-4094-aa5b-6bdd8a74a8a8
    type: title
    task:
      id: f17293a6-6bbf-4094-aa5b-6bdd8a74a8a8
      version: -1
      name: Isolate Endpoint
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "345"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -290,
          "y": 5515
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "342":
    id: "342"
    taskid: 46728364-d6b1-4eb8-b1c9-420b68235a60
    type: regular
    task:
      id: 46728364-d6b1-4eb8-b1c9-420b68235a60
      version: -1
      name: Isolate Endpoint
      description: This script isolates endpoints using multiple integrations and returns a success or failure message.
      scriptName: isolate-endpoint
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "347"
    scriptarguments:
      brands:
        simple: Cortex Core - IR
      endpoint_id:
        simple: ${issue.agentid}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -290,
          "y": 6000
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "343":
    id: "343"
    taskid: c191df9d-3d14-4409-af4e-061b02b0652d
    type: condition
    task:
      id: c191df9d-3d14-4409-af4e-061b02b0652d
      version: -1
      name: Analyst approval for isolation
      description: Analyst approval is required to isolate the endpoint.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "362"
      "Yes":
      - "342"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -290,
          "y": 5830
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
        simple: Should perform isolation on the endpoint ${issue.hostname} ?
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
      replyOptions:
      - "Yes"
      - "No"
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "344":
    id: "344"
    taskid: 89aaa71c-aede-415c-8dcc-a67a1594efff
    type: regular
    task:
      id: 89aaa71c-aede-415c-8dcc-a67a1594efff
      version: -1
      name: Get endpoint info by endpoint ID
      description: This script gathers endpoint data from multiple integrations and returns an endpoint entity with consolidated information to the context.
      scriptName: get-endpoint-data
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      additional_fields:
        simple: "true"
      brands:
        simple: Cortex Core - IR
      endpoint_id:
        simple: ${issue.agentid}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -500,
          "y": 1490
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "345":
    id: "345"
    taskid: b5390c83-368f-4a46-8bfc-815e7a0b9b93
    type: condition
    task:
      id: b5390c83-368f-4a46-8bfc-815e7a0b9b93
      version: -1
      name: Verify endpoint isn't isolated, disconnected, or a server
      description: Determine whether to isolate the endpoint based on its status, isolation state, and OS type.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "346"
      Already isolated:
      - "362"
      Isolate:
      - "343"
    separatecontext: false
    conditions:
    - label: Isolate
      condition:
      - - operator: containsString
          left:
            value:
              simple: EndpointData.AdditionalFields.endpoint_type
            iscontext: true
          right:
            value:
              simple: WORKSTATION
          ignorecase: true
      - - operator: isEqualString
          left:
            value:
              simple: EndpointData.AdditionalFields.endpoint_status
            iscontext: true
          right:
            value:
              simple: CONNECTED
          ignorecase: true
      - - operator: isEqualString
          left:
            value:
              simple: EndpointData.AdditionalFields.is_isolated
            iscontext: true
          right:
            value:
              simple: AGENT_UNISOLATED
          ignorecase: true
    - label: Already isolated
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: EndpointData.AdditionalFields.is_isolated
            iscontext: true
          right:
            value:
              simple: AGENT_ISOLATED
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -290,
          "y": 5657.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 2
    isoversize: false
    isautoswitchedtoquietmode: false
  "346":
    id: "346"
    taskid: 07352a99-7335-482e-a4f0-e7fe3c10057c
    type: regular
    task:
      id: 07352a99-7335-482e-a4f0-e7fe3c10057c
      version: -1
      name: Manual remediation actions for a server or a disconnected endpoint
      description: "Dear Analyst,\n\nPlease note that during the remediation process, the playbook didn't isolate the following host: ${issue.hostname} \n\nThis is due to one of the following reasons:\n- The device disconnected.\n- The device has been identified as a server.\n\nPlease take manual action to contain the attack and prevent the attacker from executing lateral movement before closing this alert."
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "362"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -510,
          "y": 6320
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "347":
    id: "347"
    taskid: 53c4d55c-0683-407b-8a75-2569d64c7d1f
    type: condition
    task:
      id: 53c4d55c-0683-407b-8a75-2569d64c7d1f
      version: -1
      name: Was the endpoint isolation successful?
      description: Verifies whether the endpoint isolation was successful.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "346"
      "yes":
      - "362"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: IsolateEndpoint.Result
            iscontext: true
          right:
            value:
              simple: Success
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -290,
          "y": 6152.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "348":
    id: "348"
    taskid: 4e2b5304-e65b-4974-ba8f-6249fbbdc9ee
    type: condition
    task:
      id: 4e2b5304-e65b-4974-ba8f-6249fbbdc9ee
      version: -1
      name: User disabled successfully?
      description: Checks whether the command executed successfully.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "355"
      "Yes":
      - "86"
    separatecontext: false
    conditions:
    - label: "Yes"
      condition:
      - - operator: containsGeneral
          left:
            value:
              simple: DisableUser.Message
            iscontext: true
          right:
            value:
              simple: User successfully disabled
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -4430,
          "y": 7127.333251953125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "349":
    id: "349"
    taskid: 4512a5c9-f7c1-4495-b0a8-7fd5ccd85bab
    type: condition
    task:
      id: 4512a5c9-f7c1-4495-b0a8-7fd5ccd85bab
      version: -1
      name: Was the file quarantine successful?
      description: Verifies whether the endpoint isolation was successful.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "367"
      "yes":
      - "368"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: QuarantineFile
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: QuarantineFile.FileHash
                      iscontext: true
                    right:
                      value:
                        simple: issue.targetprocesssha256.[0]
                      iscontext: true
                accessor: Status
            iscontext: true
          right:
            value:
              simple: Success
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1150,
          "y": 6107.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "351":
    id: "351"
    taskid: 9a61a368-a383-434e-bbe1-3045f5f8d2e7
    type: title
    task:
      id: 9a61a368-a383-434e-bbe1-3045f5f8d2e7
      version: -1
      name: Add malicious files to blocklist
      description: Blocks requested files that are not already on the block list or the allow list.
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "356"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1240,
          "y": 5515
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "352":
    id: "352"
    taskid: 220e98f2-fb90-465d-9288-c5d3e5f7c09e
    type: regular
    task:
      id: 220e98f2-fb90-465d-9288-c5d3e5f7c09e
      version: -1
      name: Add files to Block list
      description: Blocks requested files that are not already on the block list or the allow list.
      script: '|||core-blocklist-files'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "357"
    scriptarguments:
      hash_list:
        complex:
          root: FileEnrichment
          filters:
          - - operator: containsGeneral
              left:
                value:
                  simple: FileEnrichment.TIMScore
                iscontext: true
              right:
                value:
                  simple: "3"
          accessor: Value
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1240,
          "y": 5850
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "355":
    id: "355"
    taskid: d60ecb00-58ca-45d9-8fe6-6a884c250a76
    type: regular
    task:
      id: d60ecb00-58ca-45d9-8fe6-6a884c250a76
      version: -1
      name: Manual remediation actions required to disable the user
      description: "Dear Analyst,\n\nPlease note that during the remediation process, the playbook did not disable the following user: ${Core.OriginalAlert.event.actor_primary_username} \n\nTo complete the containment and remediation process, please manually disable this user."
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "86"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -4610,
          "y": 7330
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "356":
    id: "356"
    taskid: effc9ea7-19d3-4fed-b0c3-f3f14ba8ae21
    type: condition
    task:
      id: effc9ea7-19d3-4fed-b0c3-f3f14ba8ae21
      version: -1
      name: Any malicious processes found based on reputation?
      description: Checks if the action was performed by a high-risk user.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "357"
      "Yes":
      - "352"
    separatecontext: false
    conditions:
    - label: "Yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: FileEnrichment.TIMScore
            iscontext: true
          right:
            value:
              simple: "3"
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1240,
          "y": 5677.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "357":
    id: "357"
    taskid: 23ad0e4e-af4c-459a-bd01-9ed85cb0ba2b
    type: title
    task:
      id: 23ad0e4e-af4c-459a-bd01-9ed85cb0ba2b
      version: -1
      name: Done - Add malicious files to blocklist
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "363"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1240,
          "y": 6022.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "358":
    id: "358"
    taskid: 2de3d0c1-fac2-4072-af0a-c7e852ecd60d
    type: title
    task:
      id: 2de3d0c1-fac2-4072-af0a-c7e852ecd60d
      version: -1
      name: Done - Quarantine Script
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "363"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2470,
          "y": 6471.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "360":
    id: "360"
    taskid: d1a4c932-f60a-4852-899a-5d31db0cf1c9
    type: condition
    task:
      id: d1a4c932-f60a-4852-899a-5d31db0cf1c9
      version: -1
      name: Was the file quarantine successful?
      description: Verifies whether the endpoint isolation was successful.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "361"
      "yes":
      - "358"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: QuarantineFile
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: QuarantineFile.FileHash
                      iscontext: true
                    right:
                      value:
                        simple: ScriptSHA256
                      iscontext: true
                accessor: Status
            iscontext: true
          right:
            value:
              simple: Success
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2470,
          "y": 6135
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "361":
    id: "361"
    taskid: 4d07c947-25a4-4d6a-9ce6-79adf28e0e6f
    type: regular
    task:
      id: 4d07c947-25a4-4d6a-9ce6-79adf28e0e6f
      version: -1
      name: Manually remediate by quarantining or deleting the script file
      description: |-
        Dear Analyst,

        Please note that during the remediation process, the playbook did not quarantine the following script file: ${ScriptPath}
         on the following Host ID: ${issue.agentid}

        This is due to one of the following reasons:
        - The file was written to a remote host share.
        - The file was not found in the specified path.
        - The endpoint is offline or unreachable.

        Please take manual action to contain the attack and prevent potential data exfiltration or credential theft before closing this alert.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "358"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2250,
          "y": 6311.66650390625
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "362":
    id: "362"
    taskid: cf5d737e-975b-416d-9843-03264f8fe0fb
    type: title
    task:
      id: cf5d737e-975b-416d-9843-03264f8fe0fb
      version: -1
      name: Done - Isolate Endpoint
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "363"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -290,
          "y": 6550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "363":
    id: "363"
    taskid: 3bf4bb1d-a8f2-46e7-801d-dc7f0ebd47be
    type: regular
    task:
      id: 3bf4bb1d-a8f2-46e7-801d-dc7f0ebd47be
      version: -1
      name: Close Alert
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "87"
    scriptarguments:
      closeNotes:
        simple: Malicious activity detected - Resolved as "True Positive". Handled by the playbook "Execution of significantly renamed lolbin"
      closeReason:
        simple: Resolved - True Positive
      id:
        simple: ${issue.id}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 540,
          "y": 8020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "364":
    id: "364"
    taskid: bcfea509-7075-444c-8e17-7b9678bcf231
    type: title
    task:
      id: bcfea509-7075-444c-8e17-7b9678bcf231
      version: -1
      name: Done - Remote Actor Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "363"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 540,
          "y": 6142.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "365":
    id: "365"
    taskid: 47183631-dcde-4034-bc1b-08bdd4a7e467
    type: title
    task:
      id: 47183631-dcde-4034-bc1b-08bdd4a7e467
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2600,
          "y": 5570
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "366":
    id: "366"
    taskid: f36e3e30-ae6d-45d4-a725-4b1deaa16739
    type: title
    task:
      id: f36e3e30-ae6d-45d4-a725-4b1deaa16739
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1500,
          "y": 5310
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "367":
    id: "367"
    taskid: be55b065-b7b6-446d-882b-bdc769920a6b
    type: regular
    task:
      id: be55b065-b7b6-446d-882b-bdc769920a6b
      version: -1
      name: Manually remediate by quarantining or deleting the script file
      description: |-
        Dear Analyst,

        Please note that during the remediation process, the playbook did not quarantine the following script file: ${ScriptPath}
         on the following Host ID: ${issue.agentid}

        This is due to one of the following reasons:
        - The file was written to a remote host share.
        - The file was not found in the specified path.
        - The endpoint is offline or unreachable.

        Please take manual action to contain the attack and prevent potential data exfiltration or credential theft before closing this alert.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "368"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -980,
          "y": 6311.66650390625
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "368":
    id: "368"
    taskid: b38ba6e7-aafe-4a1a-ba70-f74dd6f4c512
    type: title
    task:
      id: b38ba6e7-aafe-4a1a-ba70-f74dd6f4c512
      version: -1
      name: Done - Masqueraded Process Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "363"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1380,
          "y": 6610
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "369":
    id: "369"
    taskid: 3bb5fcc8-780d-47ce-a8a4-0b7b28e790c9
    type: regular
    task:
      id: 3bb5fcc8-780d-47ce-a8a4-0b7b28e790c9
      version: -1
      name: Manual Recovery of Masqueraded Executable
      description: |-
        Dear Analyst,

        As part of the remediation phase, the playbook automatically renamed the masqueraded executable by appending the `.blocked` extension, preventing the file from being executed and stopping the attack.

        **Manual recovery actions required:**

        - Delete the masqueraded `.blocked` file if it is a copied or non‑legitimate executable.

        - Verify whether any original system files were renamed during the masquerading activity.

        - If an original system file was renamed, restore it to its correct original name and default path.

        - Manually run `sfc /scannow` from an elevated Command Prompt to validate the integrity of protected system files and automatically restore any modified or missing files.

        Ensure that all legitimate system files exist in their default locations and match the expected hashes.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "368"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1850,
          "y": 6450
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "372":
    id: "372"
    taskid: 4b802a3e-0042-4ad4-8242-4a3e6554d83e
    type: regular
    task:
      id: 4b802a3e-0042-4ad4-8242-4a3e6554d83e
      version: -1
      name: Execute command to rename the masqueraded file
      description: Run a shell command on a specific endpoint and return its result.
      script: '|||core-execute-command'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "369"
    scriptarguments:
      command:
        simple: Rename-Item -Path "${Core.OriginalAlert.event.action_process_image_path}" -NewName "${issue.targetprocessname.[0]}.blocked"
      command_type:
        simple: powershell
      endpoint_ids:
        simple: ${issue.agentid}
      is_raw_command:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1600,
          "y": 6285
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "373":
    id: "373"
    taskid: d6b04077-1a93-44b0-b31e-fb377496a00b
    type: regular
    task:
      id: d6b04077-1a93-44b0-b31e-fb377496a00b
      version: -1
      name: Calculate  SHA256 of the masqueraded file
      description: Run a shell command on a specific endpoint and return its result.
      script: '|||core-execute-command'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "374"
    scriptarguments:
      command:
        complex:
          root: Core.OriginalAlert.event
          accessor: action_process_image_path
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: certutil -hashfile  "
              suffix:
                value:
                  simple: '" sha256'
      endpoint_ids:
        simple: ${issue.agentid}
      timeout:
        simple: "180"
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": -1600,
          "y": 5947.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "374":
    id: "374"
    taskid: 200fc290-d17a-4c75-97ec-55539aee45f3
    type: condition
    task:
      id: 200fc290-d17a-4c75-97ec-55539aee45f3
      version: -1
      name: Is the masqueraded file found in the specified path?
      description: "Checks if the file exists and can be processed for further actions."
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "368"
      "yes":
      - "372"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: Core.ScriptResult.results.executed_command.command_output
                filters:
                - - operator: stringHasLength
                    left:
                      value:
                        simple: Core.ScriptResult.results.executed_command.command_output
                      iscontext: true
                    right:
                      value:
                        simple: "64"
            iscontext: true
          right:
            value:
              simple: issue.targetprocesssha256.[0]
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1600,
          "y": 6107.5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "375":
    id: "375"
    taskid: ad9bec7d-612c-47c5-9e12-f96acd004843
    type: regular
    task:
      id: ad9bec7d-612c-47c5-9e12-f96acd004843
      version: -1
      name: 'Evidence: Related masquerading alert was found on the host'
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidence
      value:
        simple: '{"Name": "masquerading_related_alerts", "Score": 1, "Comment": "Related masquerading alert was found on the host"}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2330,
          "y": 2300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "376":
    id: "376"
    taskid: e74ba6c8-b2f1-485c-9222-bd41efa89bca
    type: regular
    task:
      id: e74ba6c8-b2f1-485c-9222-bd41efa89bca
      version: -1
      name: XQL query to retrieve users that rename the file
      description: |-
        Execute an XQL query and retrieve results of an executed XQL query API. The command will be executed every 10 seconds until results are retrieved or until a timeout error is raised.
        When more than 1000 results are retrieved, the command will return a compressed gzipped JSON format file,
        unless the argument 'parse_result_file_to_context' is set to true and then the results will be extracted to the context.
      script: '|||xdr-xql-generic-query'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      query:
        simple: "dataset = xdr_data \n| filter agent_id = \"${issue.agentid}\" and event_type = ENUM.FILE and ((event_sub_type = ENUM.FILE_RENAME  and lowercase(actor_effective_username) != \"nt authority\\system\" and lowercase(action_file_name) contains \"${issue.targetprocessname.[0]}\") or (event_sub_type = ENUM.FILE_WRITE and action_file_sha256 = \"${issue.targetprocesssha256.[0]}\" and lowercase(action_file_name) != \"${Core.OriginalAlert.raw_abioc.event.lower_action_process_file_info_original_file_name}\" and lowercase(actor_effective_username) != \"nt authority\\system\"))\n| fields action_file_name , action_file_previous_file_name ,actor_effective_username , action_file_sha256 \n| dedup actor_effective_username"
      query_name:
        simple: Retrieve_FileRename_actor_username
      time_frame:
        simple: between ${XQL.Retrieve_FileRename_actor_username.QueryStartTime} and ${XQL.Retrieve_FileRename_actor_username.QueryEndTime}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4014.1666870117188,
          "y": 2150
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "377":
    id: "377"
    taskid: 646ac37b-9d24-4ed1-bcec-30e53e559c15
    type: regular
    task:
      id: 646ac37b-9d24-4ed1-bcec-30e53e559c15
      version: -1
      name: Set XQL query start time
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "378"
    scriptarguments:
      key:
        simple: XQL.Retrieve_FileRename_actor_username.QueryStartTime
      value:
        complex:
          root: issue
          accessor: timestamp
          transformers:
          - operator: ModifyDateTime
            args:
              variation:
                value:
                  simple: 1 day ago
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4014.1666870117188,
          "y": 1845
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "378":
    id: "378"
    taskid: 18b868bc-061c-4ef4-8827-b926c1964805
    type: regular
    task:
      id: 18b868bc-061c-4ef4-8827-b926c1964805
      version: -1
      name: Set XQL query end time
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "376"
    scriptarguments:
      key:
        simple: XQL.Retrieve_FileRename_actor_username.QueryEndTime
      value:
        complex:
          root: issue
          accessor: timestamp
          transformers:
          - operator: ModifyDateTime
            args:
              variation:
                value:
                  simple: 1 sec ago
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4014.1666870117188,
          "y": 1995
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "379":
    id: "379"
    taskid: 1fdf09d7-7c19-47f6-ba09-8573797dbe08
    type: condition
    task:
      id: 1fdf09d7-7c19-47f6-ba09-8573797dbe08
      version: -1
      name: Found any users that rename the file?
      description: Verifies whether the command lines under the same causality were retrieved from the XQL query.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "383"
      "yes":
      - "403"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: PaloAltoNetworksXQL.GenericQuery
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: PaloAltoNetworksXQL.GenericQuery.query_name
                      iscontext: true
                    right:
                      value:
                        simple: Retrieve_FileRename_actor_username
                    ignorecase: true
                accessor: results.actor_effective_username
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3545.8333129882812,
          "y": 5660
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "383":
    id: "383"
    taskid: 6b4c5649-d156-4df7-8c42-c9bf8c899c76
    type: regular
    task:
      id: 6b4c5649-d156-4df7-8c42-c9bf8c899c76
      version: -1
      name: Set the username that execute the process - without domain prefix
      description: Saves the username without the domain prefix.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "411"
    scriptarguments:
      key:
        simple: UsernameWithoutPrefix
      value:
        complex:
          root: Core.OriginalAlert.event.actor_primary_username
          filters:
          - - operator: isNotEqualString
              left:
                value:
                  simple: Core.OriginalAlert.event.actor_primary_username
                iscontext: true
              right:
                value:
                  simple: NT AUTHORITY\SYSTEM
              ignorecase: true
          transformers:
          - operator: RegexExtractAll
            args:
              error_if_no_match: {}
              ignore_case: {}
              multi_line: {}
              period_matches_newline: {}
              regex:
                value:
                  simple: (?<=\\)[^\\]+$
              unpack_matches: {}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3330.833251953125,
          "y": 6004
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "385":
    id: "385"
    taskid: 771578af-782a-47d6-b668-acb7f5cb9c88
    type: regular
    task:
      id: 771578af-782a-47d6-b668-acb7f5cb9c88
      version: -1
      name: Logoff user from host
      description: Run a shell command on a specific endpoint and return its result.
      script: '|||core-execute-command'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#error#':
      - "389"
      '#none#':
      - "388"
    scriptarguments:
      command:
        complex:
          root: Core.ScriptResult.results.executed_command.command_output
          filters:
          - - operator: containsGeneral
              left:
                value:
                  simple: Core.ScriptResult.results.executed_command.command_output
                iscontext: true
              right:
                value:
                  simple: UsernameWithoutPrefix
                iscontext: true
              ignorecase: true
          - - operator: containsGeneral
              left:
                value:
                  simple: Core.ScriptResult.results.executed_command.command_output
                iscontext: true
              right:
                value:
                  simple: Active
              ignorecase: true
          transformers:
          - operator: RegexExtractAll
            args:
              error_if_no_match: {}
              ignore_case: {}
              multi_line: {}
              period_matches_newline: {}
              regex:
                value:
                  simple: (?<=\bconsole\s+)\d+
              unpack_matches: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'logoff '
              suffix: {}
          - operator: uniq
      command_type:
        simple: powershell
      endpoint_ids:
        simple: ${issue.agentid}
      is_raw_command:
        simple: "true"
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": -3610,
          "y": 7255
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "386":
    id: "386"
    taskid: 94d5e85d-38bc-4beb-8e9c-32563cdb08a5
    type: regular
    task:
      id: 94d5e85d-38bc-4beb-8e9c-32563cdb08a5
      version: -1
      name: Execute get user sessions
      description: Run a shell command on a specific endpoint and return its result.
      script: '|||core-execute-command'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#error#':
      - "389"
      '#none#':
      - "387"
    scriptarguments:
      command:
        complex:
          root: UsernameWithoutPrefix
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'quser '
              suffix: {}
      command_type:
        simple: native
      endpoint_ids:
        simple: ${issue.agentid}
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": -3610,
          "y": 6950
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "387":
    id: "387"
    taskid: b9dbd134-a786-4bcf-82c0-376df3af5aa3
    type: condition
    task:
      id: b9dbd134-a786-4bcf-82c0-376df3af5aa3
      version: -1
      name: Check for active session of the user
      description: Checks whether the execution results indicate an active session for the user, confirming the user is currently logged in.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "405"
      Active:
      - "385"
    separatecontext: false
    conditions:
    - label: Active
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: Core.ScriptResult.results.executed_command.command_output
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: Core.ScriptResult.results.executed_command.command_output
                      iscontext: true
                    right:
                      value:
                        simple: Active
                    ignorecase: true
                - - operator: AnyMatch
                    left:
                      value:
                        simple: Core.ScriptResult.results.executed_command.command_output
                      iscontext: true
                    right:
                      value:
                        simple: UsernameWithoutPrefix
                      iscontext: true
                    ignorecase: true
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3610,
          "y": 7100
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "388":
    id: "388"
    taskid: 61f216fe-1c82-499f-892a-b79aaf11169f
    type: condition
    task:
      id: 61f216fe-1c82-499f-892a-b79aaf11169f
      version: -1
      name: Command executed successfully?
      description: Checks whether the command executed successfully.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "389"
      "Yes":
      - "405"
    separatecontext: false
    conditions:
    - label: "Yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Core.ScriptResult.results.executed_command
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: Core.ScriptResult.results.executed_command.standard_output
                      iscontext: true
                    right:
                      value:
                        simple: logoff
                    ignorecase: true
                accessor: execution_status
            iscontext: true
          right:
            value:
              simple: COMPLETED_SUCCESSFULLY
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3610,
          "y": 7407.333251953125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "389":
    id: "389"
    taskid: ed53730b-4e71-44e0-8e52-01d22e36e82a
    type: regular
    task:
      id: ed53730b-4e71-44e0-8e52-01d22e36e82a
      version: -1
      name: Manual remediation actions required to log off the user
      description: "Dear Analyst,\n\nPlease note that during the remediation process, the playbook did not log off the user: ${UsernameWithoutPrefix} from the following host: ${issue.hostname} \n\nPlease manually log off the user to complete the containment and remediation process."
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "405"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3833.75,
          "y": 7560
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "396":
    id: "396"
    taskid: 0428d88e-6501-4807-82a4-857f5b435128
    type: condition
    task:
      id: 0428d88e-6501-4807-82a4-857f5b435128
      version: -1
      name: Was the masqueraded file renamed and executed by the same user?
      description: "Checks if the masqueraded file renamed and executed by the same user."
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "402"
      "yes":
      - "412"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: UsernameMasquardingWithoutPrefix
            iscontext: true
          ignorecase: true
      - - operator: isEqualString
          left:
            value:
              simple: UsernameWithoutPrefix
            iscontext: true
          right:
            value:
              simple: UsernameMasquardingWithoutPrefix
            iscontext: true
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3350.833251953125,
          "y": 6464
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "397":
    id: "397"
    taskid: 7f36f471-4a59-4dfc-b800-852f0b0c111b
    type: regular
    task:
      id: 7f36f471-4a59-4dfc-b800-852f0b0c111b
      version: -1
      name: Logoff user from host
      description: Run a shell command on a specific endpoint and return its result.
      script: '|||core-execute-command'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#error#':
      - "401"
      '#none#':
      - "400"
    scriptarguments:
      command:
        complex:
          root: Core.ScriptResult.results.executed_command.command_output
          filters:
          - - operator: containsGeneral
              left:
                value:
                  simple: Core.ScriptResult.results.executed_command.command_output
                iscontext: true
              right:
                value:
                  simple: UsernameMasquardingWithoutPrefix
                iscontext: true
              ignorecase: true
          - - operator: containsGeneral
              left:
                value:
                  simple: Core.ScriptResult.results.executed_command.command_output
                iscontext: true
              right:
                value:
                  simple: Active
              ignorecase: true
          transformers:
          - operator: RegexExtractAll
            args:
              error_if_no_match: {}
              ignore_case: {}
              multi_line: {}
              period_matches_newline: {}
              regex:
                value:
                  simple: (?<=\bconsole\s+)\d+
              unpack_matches: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'logoff '
              suffix: {}
          - operator: uniq
      command_type:
        simple: powershell
      endpoint_ids:
        simple: ${issue.agentid}
      is_raw_command:
        simple: "true"
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": -2990,
          "y": 7262.333251953125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "398":
    id: "398"
    taskid: 9f2317f6-ab2e-466f-99a3-4ee9e423e360
    type: regular
    task:
      id: 9f2317f6-ab2e-466f-99a3-4ee9e423e360
      version: -1
      name: Execute get user sessions
      description: Run a shell command on a specific endpoint and return its result.
      script: '|||core-execute-command'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#error#':
      - "401"
      '#none#':
      - "399"
    scriptarguments:
      command:
        complex:
          root: UsernameMasquardingWithoutPrefix
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'quser '
              suffix: {}
      command_type:
        simple: native
      endpoint_ids:
        simple: ${issue.agentid}
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": -2990,
          "y": 6950
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "399":
    id: "399"
    taskid: b36030f3-5d29-46e2-8d85-bb79f064a17a
    type: condition
    task:
      id: b36030f3-5d29-46e2-8d85-bb79f064a17a
      version: -1
      name: Check for active session of the user
      description: Checks whether the execution results indicate an active session for the user, confirming the user is currently logged in.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "405"
      Active:
      - "397"
    separatecontext: false
    conditions:
    - label: Active
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: Core.ScriptResult.results.executed_command.command_output
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: Core.ScriptResult.results.executed_command.command_output
                      iscontext: true
                    right:
                      value:
                        simple: Active
                    ignorecase: true
                - - operator: containsGeneral
                    left:
                      value:
                        simple: Core.ScriptResult.results.executed_command.command_output
                      iscontext: true
                    right:
                      value:
                        simple: UsernameMasquardingWithoutPrefix
                      iscontext: true
                    ignorecase: true
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2990,
          "y": 7100
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "400":
    id: "400"
    taskid: 53b0a992-0fc7-4135-8999-6256d00a4610
    type: condition
    task:
      id: 53b0a992-0fc7-4135-8999-6256d00a4610
      version: -1
      name: Command executed successfully?
      description: Checks whether the command executed successfully.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "401"
      "Yes":
      - "405"
    separatecontext: false
    conditions:
    - label: "Yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Core.ScriptResult.results.executed_command
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: Core.ScriptResult.results.executed_command.standard_output
                      iscontext: true
                    right:
                      value:
                        simple: logoff
                    ignorecase: true
                accessor: execution_status
            iscontext: true
          right:
            value:
              simple: COMPLETED_SUCCESSFULLY
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2990,
          "y": 7405
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "401":
    id: "401"
    taskid: 10b3a551-9d05-4d57-bb68-27f4cf6359f2
    type: regular
    task:
      id: 10b3a551-9d05-4d57-bb68-27f4cf6359f2
      version: -1
      name: Manual remediation actions required to log off the user
      description: "Dear Analyst,\n\nPlease note that during the remediation process, the playbook did not log off the user: ${UsernameMasquardingWithoutPrefix} from the following host: ${issue.hostname} \n\nPlease manually log off the user to complete the containment and remediation process."
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "405"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2760,
          "y": 7560
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "402":
    id: "402"
    taskid: c11c55af-c6dc-429b-9546-8cfbcd6d328f
    type: title
    task:
      id: c11c55af-c6dc-429b-9546-8cfbcd6d328f
      version: -1
      name: Log off both users
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "412"
      - "413"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2990,
          "y": 6620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "403":
    id: "403"
    taskid: d49b8409-2b2e-42e0-ae15-2123c3e8d361
    type: regular
    task:
      id: d49b8409-2b2e-42e0-ae15-2123c3e8d361
      version: -1
      name: Save the username that rename the file - without domain prefix
      description: Saves the username without the domain prefix.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "383"
    scriptarguments:
      key:
        simple: UsernameMasquardingWithoutPrefix
      value:
        complex:
          root: PaloAltoNetworksXQL.GenericQuery.results
          accessor: actor_effective_username
          transformers:
          - operator: FirstArrayElement
          - operator: RegexExtractAll
            args:
              error_if_no_match: {}
              ignore_case: {}
              multi_line: {}
              period_matches_newline: {}
              regex:
                value:
                  simple: (?<=\\)[^\\]+$
              unpack_matches: {}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3545.8333129882812,
          "y": 5840
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "404":
    id: "404"
    taskid: 3c32e1bf-6942-43c3-a838-8cb60f672f28
    type: title
    task:
      id: 3c32e1bf-6942-43c3-a838-8cb60f672f28
      version: -1
      name: User Logoff
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "396"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3350.833251953125,
          "y": 6330
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "405":
    id: "405"
    taskid: 2dcad8b4-e93c-42ca-be3e-0fb39169c204
    type: title
    task:
      id: 2dcad8b4-e93c-42ca-be3e-0fb39169c204
      version: -1
      name: Done - User Logoff
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "406"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3330.833251953125,
          "y": 7730
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "406":
    id: "406"
    taskid: 827ca743-9db6-4a36-ac60-d469d32e7a18
    type: title
    task:
      id: 827ca743-9db6-4a36-ac60-d469d32e7a18
      version: -1
      name: Done - User Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "363"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3833.75,
          "y": 7870
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "407":
    id: "407"
    taskid: f1653a6c-f28e-4019-b749-cbfe8a7e9135
    type: collection
    task:
      id: f1653a6c-f28e-4019-b749-cbfe8a7e9135
      version: -1
      name: Analyst Approval for User Disablement
      description: ""
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "408"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -4430,
          "y": 6645.208251953125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: "The following users were identified as involved in this issue and are recommended to be disabled as part of the remediation actions.\n\n### Users found:\n${UsernameWithoutPrefix(val.length > 0) =>\"The following user: \"+ val +\" executed the masqueraded lolbin file\"} \n\n${UsernameMasquardingWithoutPrefix(val.length > 0) =>\"The following user: \"+ val +\" renamed the masqueraded lolbin file\"} \n\n\n\n### Please select the users to disable. \nIf no users should be disabled, submit the response without making a selection."
        required: false
        gridcolumns: []
        defaultrows: []
        type: multiSelect
        options: []
        optionsarg:
        - complex:
            root: UsernameWithoutPrefix
            transformers:
            - operator: AppendIfNotEmpty
              args:
                item:
                  value:
                    simple: UsernameMasquardingWithoutPrefix
                  iscontext: true
                raw: {}
            - operator: uniq
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      title: User_Remediation
      description: ""
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "408":
    id: "408"
    taskid: 9b2de3e2-a8cf-40ed-9f52-1cc606959448
    type: condition
    task:
      id: 9b2de3e2-a8cf-40ed-9f52-1cc606959448
      version: -1
      name: Checks Analyst Decision
      description: Checks the analyst’s decision.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "86"
      Disable:
      - "105"
    separatecontext: false
    conditions:
    - label: Disable
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: User_Remediation.Answers.0
            iscontext: true
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -4430,
          "y": 6800
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "411":
    id: "411"
    taskid: 36a64f79-229e-4ec6-a829-dc2376a2dc43
    type: condition
    task:
      id: 36a64f79-229e-4ec6-a829-dc2376a2dc43
      version: -1
      name: Were any users found to continue the remediation action?
      description: "Checks if any users are found to continue the remediation action."
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "406"
      "yes":
      - "404"
      - "169"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: UsernameWithoutPrefix
            iscontext: true
        - operator: isNotEmpty
          left:
            value:
              simple: UsernameMasquardingWithoutPrefix
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3833.75,
          "y": 6150
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "412":
    id: "412"
    taskid: 86b8e97e-9b13-481c-b0c6-c9dfc93fe54d
    type: condition
    task:
      id: 86b8e97e-9b13-481c-b0c6-c9dfc93fe54d
      version: -1
      name: Was the execution initiated by a non‑SYSTEM user?
      description: Validates that the user is a non-system account.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "405"
      "yes":
      - "386"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: UsernameWithoutPrefix
            iscontext: true
          right:
            value: {}
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3610,
          "y": 6780.208251953125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "413":
    id: "413"
    taskid: 5c9feda1-5cee-45a5-bbac-5e5a4fe532a1
    type: condition
    task:
      id: 5c9feda1-5cee-45a5-bbac-5e5a4fe532a1
      version: -1
      name: Found any users that rename the file?
      description: Validates that the user is a non-system account.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "405"
      "yes":
      - "398"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: UsernameMasquardingWithoutPrefix
            iscontext: true
          right:
            value: {}
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2990,
          "y": 6780.208251953125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "414":
    id: "414"
    taskid: e51c6810-a372-4b98-a2ce-483740038220
    type: regular
    task:
      id: e51c6810-a372-4b98-a2ce-483740038220
      version: -1
      name: 'Print: Inconclusive after analyst review'
      description: Prints text to war room (Markdown supported)
      scriptName: Print
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "366"
    scriptarguments:
      value:
        simple: Inconclusive
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1500,
          "y": 5160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "107_256_yes": 0.46,
      "203_10_#default#": 0.13,
      "203_302_yes": 0.34,
      "22_10_#default#": 0.12,
      "22_23_yes": 0.47,
      "252_131_#default#": 0.79,
      "252_300_False Positive": 0.87,
      "252_5_Remediation": 0.44,
      "255_205_False Positive": 0.25,
      "255_5_True Positive": 0.29,
      "259_10_#default#": 0.1,
      "259_261_Suspicious": 0.63,
      "263_10_#default#": 0.1,
      "266_10_#default#": 0.15,
      "268_10_#default#": 0.11,
      "270_10_#default#": 0.1,
      "273_10_#default#": 0.22,
      "273_275_Accessibility Tools": 0.59,
      "290_10_#default#": 0.24,
      "292_10_#default#": 0.19,
      "292_294_Malicious": 0.61,
      "295_10_#default#": 0.12,
      "295_297_yes": 0.41,
      "298_10_#default#": 0.1,
      "298_296_Malicious": 0.41,
      "298_299_Suspicious": 0.51,
      "302_321_#error#": 0.47,
      "307_315_#default#": 0.37,
      "308_305_#default#": 0.37,
      "314_10_#default#": 0.1,
      "340_336_yes": 0.48,
      "343_342_Yes": 0.4,
      "345_343_Isolate": 0.47,
      "345_346_#default#": 0.48,
      "345_362_Already isolated": 0.36,
      "347_362_yes": 0.42,
      "348_86_Yes": 0.32,
      "349_368_yes": 0.32,
      "356_352_Yes": 0.52,
      "360_358_yes": 0.4,
      "374_372_yes": 0.47,
      "386_389_#error#": 0.47,
      "387_405_#default#": 0.36,
      "388_405_Yes": 0.31,
      "396_402_#default#": 0.55,
      "398_401_#error#": 0.53,
      "399_397_Active": 0.65,
      "399_405_#default#": 0.35,
      "400_405_Yes": 0.28,
      "411_404_yes": 0.68,
      "411_406_#default#": 0.1,
      "412_386_yes": 0.41,
      "412_405_#default#": 0.26,
      "49_10_#default#": 0.14,
      "49_50_yes": 0.41,
      "51_10_#default#": 0.1,
      "51_52_yes": 0.51,
      "55_56_#default#": 0.62,
      "59_10_#default#": 0.11,
      "59_60_yes": 0.38,
      "61_10_#default#": 0.11,
      "61_62_yes": 0.24,
      "8_10_#default#": 0.1,
      "8_9_yes": 0.5
    },
    "paper": {
      "dimensions": {
        "height": 7200,
        "width": 12076.833251953125,
        "x": -4610,
        "y": 1030
      }
    }
  }
inputs: []
outputs: []
tests:
- No tests (auto formatted)
supportedModules:
- xsiam
- cloud_runtime_security
- edr
