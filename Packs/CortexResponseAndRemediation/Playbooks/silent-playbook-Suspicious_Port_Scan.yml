id: silent-Suspicious Port Scan
version: -1
issilent: true
contentitemexportablefields:
  contentitemfields: {}
name: silent-Suspicious Port Scan
description: |-
  This playbook is designed to handle the following alerts:
  - Suspicious port scan
  - Highly suspicious port scan
  - Port scan by suspicious process

  Playbook Stages:

  Analysis:

  - Checks whether the reputation of associated processes is malicious.
  - Checks whether the endpoint has a high risk score.
  - Determines whether the alert process is a known scanner.
  - Checks whether the port scan has a highly suspicious connection ratio compared to the baseline.

  Investigation:

  - Checks for a suspicious ratio of unique ports to connections.
  - Checks if the port scan intervals are indicative of an automated scan.
  - Checks if the reputation of associated processes is suspicious.
  - Checks if the endpoint has a medium risk score.
  - Searches for related XSIAM alerts related to the destination host that indicate suspicious activity.
  - Searches for related XSIAM alerts related to the source host that indicate suspicious or malicious activity.

  Verdict:

  Determine the verdict as malicious if:
  - At least four specific related alerts indicating malicious activity are found.
  - At least two suspicious indicators are detected.

  Remediation:

  - Terminates the processes.
  - Quarantines the malicious process.
  - Adds the malicious process hash to the blocklist.
  - Adds an IOC rule for malicious processes.
  - Isolate the source host.  (Requires analyst approval).
  - Block the source IP Address (Requires analyst approval).
  - Automatically close the alert.
tags:
- TA0007 - Discovery
- T1046 - Network Service Discovery
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: cf6e8c28-cf7c-4636-87be-f7131f1b2e59
    type: start
    task:
      id: cf6e8c28-cf7c-4636-87be-f7131f1b2e59
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "43"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 170,
          "y": -22
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: 05199548-0c7f-479f-a76e-549f82c96c07
    type: title
    task:
      id: 05199548-0c7f-479f-a76e-549f82c96c07
      version: -1
      name: Investigation
      tags:
      - related_alerts
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "96"
      - "148"
      - "161"
      - "177"
      - "179"
      - "146"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2486,
          "y": 1631
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: c507d4f4-5e48-45fa-ae69-87632f971c96
    type: condition
    task:
      id: c507d4f4-5e48-45fa-ae69-87632f971c96
      version: -1
      name: Check if the process has a malicious reputation
      description: Determines the appropriate verdict based on the reputation of the processes.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "145"
      "yes":
      - "83"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: DBotScore
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: DBotScore.Indicator
                      iscontext: true
                    right:
                      value:
                        simple: alert.cgosha256
                      iscontext: true
                    ignorecase: true
                  - operator: isEqualString
                    left:
                      value:
                        simple: DBotScore.Indicator
                      iscontext: true
                    right:
                      value:
                        simple: alert.osparentsha256
                      iscontext: true
                accessor: Score
            iscontext: true
      - - operator: isEqualNumber
          left:
            value:
              complex:
                root: DBotScore
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: DBotScore.Indicator
                      iscontext: true
                    right:
                      value:
                        simple: alert.cgosha256
                      iscontext: true
                    ignorecase: true
                  - operator: containsGeneral
                    left:
                      value:
                        simple: DBotScore.Indicator
                      iscontext: true
                    right:
                      value:
                        simple: alert.osparentsha256
                      iscontext: true
                    ignorecase: true
                accessor: Score
            iscontext: true
          right:
            value:
              simple: "3"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 170,
          "y": 816
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: f6a7b9d9-7506-4220-9586-f642211bf61c
    type: title
    task:
      id: f6a7b9d9-7506-4220-9586-f642211bf61c
      version: -1
      name: Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "166"
      - "183"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 218,
          "y": 2797
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: 81912a32-c19c-4b6b-8dbc-6150de1c2c7b
    type: condition
    task:
      id: 81912a32-c19c-4b6b-8dbc-6150de1c2c7b
      version: -1
      name: Found any alerts indicating a malicious activity on the source host?
      description: Determines whether specific alerts related to the source host have been found and indicate malicious activity.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "167"
      "yes":
      - "169"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: containsGeneral
          left:
            value:
              simple: SrcHostRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: Nmap Scripting Engine Detection
        - operator: containsGeneral
          left:
            value:
              simple: SrcHostRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: Abnormal sensitive RPC traffic to multiple hosts in multiple interfaces
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3884,
          "y": 1914
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: 1bf160cf-b0f4-485f-9806-629ef45accc3
    type: title
    task:
      id: 1bf160cf-b0f4-485f-9806-629ef45accc3
      version: -1
      name: Close Alert
      description: Groups all tasks for a specific incident according to the task headers (titles).
      type: title
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "122"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 244,
          "y": 4422
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: 0bd3add5-ef26-48eb-9fdb-8b4a2356a61b
    type: regular
    task:
      id: 0bd3add5-ef26-48eb-9fdb-8b4a2356a61b
      version: -1
      name: Terminate Causality Process
      description: Terminate a process tree by its causality ID.
      script: '|||core-terminate-causality'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "123"
    scriptarguments:
      agent_id:
        complex:
          root: Endpoint
          filters:
          - - operator: containsGeneral
              left:
                value:
                  simple: Endpoint.Vendor
                iscontext: true
              right:
                value:
                  simple: Cortex
              ignorecase: true
          accessor: ID
      causality_id:
        simple: ${alert.cid}
      timeout_in_seconds:
        simple: "120"
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -65,
          "y": 3197
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "43":
    id: "43"
    taskid: 357da12c-5fcc-4eec-8dbf-ff8f712069e4
    type: title
    task:
      id: 357da12c-5fcc-4eec-8dbf-ff8f712069e4
      version: -1
      name: Analysis
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "53"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 170,
          "y": 109
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "53":
    id: "53"
    taskid: 43eecccd-496b-4de9-9c9e-c186a8c29a62
    type: regular
    task:
      id: 43eecccd-496b-4de9-9c9e-c186a8c29a62
      version: -1
      name: Get scan events
      description: Returns additional alert data, including connection details and scanning events.
      script: '|||core-get-cloud-original-alerts'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "144"
      - "151"
    scriptarguments:
      alert_ids:
        simple: ${alert.id}
      filter_alert_fields:
        simple: "false"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 170,
          "y": 236
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "78":
    id: "78"
    taskid: f4a3691b-7c80-4478-a8cf-66dd58cf0314
    type: playbook
    task:
      id: f4a3691b-7c80-4478-a8cf-66dd58cf0314
      version: -1
      name: Quarantine Process
      description: |-
        ## Containment Plan - Quarantine File

        This playbook is a sub-playbook within the containment plan playbook.
        The playbook quarantines files using core commands.
      playbookName: Containment Plan - Quarantine File
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "13"
    scriptarguments:
      AutoContainment:
        simple: "True"
      EndpointID:
        simple: ${Core.Endpoint.endpoint_id}
      FileContainment:
        simple: "True"
      FileHash:
        complex:
          root: MaliciousCGOProcess
          accessor: cgoSha256
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: MaliciousOSActorProcess.actorSha256
                iscontext: true
          - operator: RemoveEmpty
            args:
              empty_values: {}
              remove_keys: {}
          - operator: uniq
      FilePath:
        complex:
          root: MaliciousCGOProcess
          accessor: cgoPath
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: MaliciousOSActorProcess.actorPath
                iscontext: true
          - operator: RemoveEmpty
            args:
              empty_values: {}
              remove_keys: {}
          - operator: uniq
      FileRemediation:
        simple: Quarantine
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
      forEach: true
    view: |-
      {
        "position": {
          "x": -163,
          "y": 3576
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "81":
    id: "81"
    taskid: b631faff-7cdd-41bf-bfc4-081c666d4ae7
    type: condition
    task:
      id: b631faff-7cdd-41bf-bfc4-081c666d4ae7
      version: -1
      name: Is the reputation of the CGO process malicious?
      description: Verify if the CGO process has a malicious reputation.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "86"
      "yes":
      - "82"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: greaterThanOrEqual
          left:
            value:
              complex:
                root: DBotScore
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: DBotScore.Indicator
                      iscontext: true
                    right:
                      value:
                        simple: alert.cgosha256
                      iscontext: true
                    ignorecase: true
                accessor: Score
            iscontext: true
          right:
            value:
              simple: "3"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -557,
          "y": 1198
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "82":
    id: "82"
    taskid: 3350e748-e72f-49db-ab3e-bf5350cb59c6
    type: regular
    task:
      id: 3350e748-e72f-49db-ab3e-bf5350cb59c6
      version: -1
      name: Set malicious CGO process
      description: Set multiple keys/values related to the malicious CGO process to the context.
      tags:
      - malicious_causality_process
      scriptName: SetMultipleValues
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "86"
    scriptarguments:
      keys:
        simple: cgoPath,cgoSha256
      parent:
        simple: MaliciousCGOProcess
      values:
        simple: ${alert.cgopath.[0]},${alert.cgosha256.[0]}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -557,
          "y": 1352
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "83":
    id: "83"
    taskid: 13eb30d5-cb72-4a0f-85bb-d7d6a841d9e6
    type: title
    task:
      id: 13eb30d5-cb72-4a0f-85bb-d7d6a841d9e6
      version: -1
      name: Set keys for malicious processes
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "81"
      - "84"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -299,
          "y": 1075
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "84":
    id: "84"
    taskid: 8db40268-d731-4662-8f5d-1f1eb212e7b0
    type: condition
    task:
      id: 8db40268-d731-4662-8f5d-1f1eb212e7b0
      version: -1
      name: Is the reputation of the OS Actor process malicious?
      description: Verify if the OS Actor process has a malicious reputation.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "86"
      "yes":
      - "85"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: greaterThanOrEqual
          left:
            value:
              complex:
                root: DBotScore
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: DBotScore.Indicator
                      iscontext: true
                    right:
                      value:
                        simple: alert.osparentsha256
                      iscontext: true
                    ignorecase: true
                accessor: Score
            iscontext: true
          right:
            value:
              simple: "3"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -59,
          "y": 1198
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "85":
    id: "85"
    taskid: 2aa42aba-9426-49bc-99f1-324668962d2c
    type: regular
    task:
      id: 2aa42aba-9426-49bc-99f1-324668962d2c
      version: -1
      name: Set malicious OS Actor process
      description: Set multiple keys/values related to the malicious OS Actor process to the context.
      tags:
      - malicious_actor_process
      scriptName: SetMultipleValues
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "86"
    scriptarguments:
      keys:
        simple: actorPath,actorSha256
      parent:
        simple: MaliciousOSActorProcess
      values:
        simple: ${alert.initiatorpath.[0]},${alert.initiatorsha256.[0]}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -65,
          "y": 1352
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "86":
    id: "86"
    taskid: 9964a51f-6e6d-49d9-9451-9a7222143378
    type: title
    task:
      id: 9964a51f-6e6d-49d9-9451-9a7222143378
      version: -1
      name: Set keys for malicious processes - Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "3"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -299,
          "y": 1492
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "93":
    id: "93"
    taskid: ab43bfb8-4f03-4b8a-b1ac-42f2c956128c
    type: regular
    task:
      id: ab43bfb8-4f03-4b8a-b1ac-42f2c956128c
      version: -1
      name: Add malicious process hash to Block list
      description: Block lists requested files which have not already been block listed or added to allow lists.
      script: '|||core-blocklist-files'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "13"
    scriptarguments:
      comment:
        simple: 'The hash was added to the block list by the playbook ''Suspicious Port Scan'' as part of handling alert ID: ${alert.id}'
      hash_list:
        complex:
          root: MaliciousCGOProcess
          accessor: cgoSha256
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: MaliciousOSActorProcess.actorSha256
                iscontext: true
          - operator: RemoveEmpty
            args:
              empty_values: {}
              remove_keys: {}
          - operator: uniq
      incident_id:
        complex:
          root: alert
          accessor: parentXDRIncident
          transformers:
          - operator: Cut
            args:
              delimiter:
                value:
                  simple: '-'
              fields:
                value:
                  simple: "2"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -568,
          "y": 3576
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "94":
    id: "94"
    taskid: f1e22b15-cf9e-4f18-8919-945fa9e70ed8
    type: title
    task:
      id: f1e22b15-cf9e-4f18-8919-945fa9e70ed8
      version: -1
      name: Process Block and Quarantine
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "78"
      - "93"
      - "197"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -568,
          "y": 3447
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "96":
    id: "96"
    taskid: e8f49b4f-e6ba-42cf-855c-fa658685d32d
    type: regular
    task:
      id: e8f49b4f-e6ba-42cf-855c-fa658685d32d
      version: -1
      name: Search for related alerts to the source host
      description: This task searches for related alerts generated by processes within the same causality chain, which may indicate a compromised endpoint.
      scriptName: SearchAlertsV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "8"
    scriptarguments:
      extend-context:
        simple: SrcHostRelatedAlerts=
      fromdate:
        simple: 3 hours ago
      ignore-outputs:
        simple: "true"
      includeinformational:
        simple: "true"
      query:
        simple: (agentid:${alert.agentid} or localip:${Core.OriginalAlert.event.action_local_ip}) and -name:"Port Scan" and -name:"Highly suspicious port scan" and -name:"Port scan by suspicious process" and -name:"Suspicious port scan" and -name:"Port Scan With Low Direction Confidence"
      todate:
        simple: now
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3884,
          "y": 1774
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "122":
    id: "122"
    taskid: 061cb9a7-6ca1-45ba-a04d-3ceee6cb161e
    type: regular
    task:
      id: 061cb9a7-6ca1-45ba-a04d-3ceee6cb161e
      version: -1
      name: Close Alert as True Positive
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "175"
    scriptarguments:
      closeNotes:
        simple: Resolved as True Positive - Handled by the playbook "Suspicious Port Scan"
      closeReason:
        simple: Resolved - True Positive
      id:
        simple: ${alert.id}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 244,
          "y": 4542
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "123":
    id: "123"
    taskid: eac154ca-1a4d-4b1c-bd35-7adf6c07a8ed
    type: condition
    task:
      id: eac154ca-1a4d-4b1c-bd35-7adf6c07a8ed
      version: -1
      name: Found any malicious processes?
      description: Checks whether any of the processes are identified as malicious.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "13"
      "yes":
      - "94"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: MaliciousCGOProcess
            iscontext: true
          right:
            value: {}
        - operator: isNotEmpty
          left:
            value:
              simple: MaliciousOSActorProcess
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -65,
          "y": 3323
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "141":
    id: "141"
    taskid: 19e39a28-03d4-43bb-b0aa-f835560493e9
    type: condition
    task:
      id: 19e39a28-03d4-43bb-b0aa-f835560493e9
      version: -1
      name: Found any alerts indicating a malicious activity on the destination host?
      description: Determines whether specific alerts related to the destination host have been found and indicate suspicious activity.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "165"
      "yes":
      - "173"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: containsGeneral
          left:
            value:
              simple: DstHostRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: Brute Force
          ignorecase: true
        - operator: containsGeneral
          left:
            value:
              simple: DstHostRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: Port Scan
          ignorecase: true
        - operator: containsGeneral
          left:
            value:
              simple: DstHostRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: Vulnerability
        - operator: containsGeneral
          left:
            value:
              simple: DstHostRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: Failed Connections
          ignorecase: true
        - operator: containsGeneral
          left:
            value:
              simple: DstHostRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: Password Spray
          ignorecase: true
        - operator: containsGeneral
          left:
            value:
              simple: DstHostRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: Uncommon SSH session
        - operator: containsGeneral
          left:
            value:
              simple: DstHostRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: Uncommon VNC server communication
        - operator: containsGeneral
          left:
            value:
              simple: DstHostRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: Abnormal connections to a dormant host
        - operator: containsGeneral
          left:
            value:
              simple: DstHostRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: New SSH Administrative Behavior
        - operator: containsGeneral
          left:
            value:
              simple: DstHostRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: Unusual SSH activity that resembles SSH proxy
        - operator: containsGeneral
          left:
            value:
              simple: DstHostRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: Uncommon SSH session was established to an internal IP
        - operator: containsGeneral
          left:
            value:
              simple: DstHostRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: connections over DNS ports
        - operator: containsGeneral
          left:
            value:
              simple: DstHostRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: LDAP traffic from non-standard
        - operator: containsGeneral
          left:
            value:
              simple: DstHostRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: Rare WinRM Session
        - operator: containsGeneral
          left:
            value:
              simple: DstHostRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: Port Sweep
        - operator: containsGeneral
          left:
            value:
              simple: DstHostRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: Abnormal process connection to default Meterpreter port
        - operator: containsGeneral
          left:
            value:
              simple: DstHostRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: Abnormal RDP connections to multiple hosts
        - operator: containsGeneral
          left:
            value:
              simple: DstHostRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: Rare Windows Remote Management (WinRM) HTTP Activity
        - operator: containsGeneral
          left:
            value:
              simple: DstHostRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: Abnormal SMB scanning activity to multiple hosts
        - operator: containsGeneral
          left:
            value:
              simple: DstHostRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: Uncommon RDP connection
        - operator: containsGeneral
          left:
            value:
              simple: DstHostRelatedAlerts.Contents.data.name
            iscontext: true
          right:
            value:
              simple: Rare NTLM Access By User To Host
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3224,
          "y": 1914
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "144":
    id: "144"
    taskid: 18cefc5b-952c-4257-bc30-fa203dcc8e97
    type: regular
    task:
      id: 18cefc5b-952c-4257-bc30-fa203dcc8e97
      version: -1
      name: Get Endpoint details by ip address
      description: Returns endpoint information based on IP address.
      script: '|||endpoint'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "181"
    scriptarguments:
      ip:
        complex:
          root: alert
          accessor: agentid
          transformers:
          - operator: RegexExtractAll
            args:
              error_if_no_match: {}
              ignore_case: {}
              multi_line: {}
              period_matches_newline: {}
              regex:
                value:
                  simple: \b(?:(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)\b
              unpack_matches: {}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -83,
          "y": 368
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "145":
    id: "145"
    taskid: 070d6655-9b19-4ab4-afa0-955cb3d77544
    type: regular
    task:
      id: 070d6655-9b19-4ab4-afa0-955cb3d77544
      version: -1
      name: Get Host Risk level
      description: Retrieve the risk score of a specific host or list of hosts with the highest risk score in the environment along with the reason affecting each score.
      script: '|||core-list-risky-hosts'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "154"
    scriptarguments:
      host_id:
        simple: ${Endpoint.ID}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 640,
          "y": 949
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "146":
    id: "146"
    taskid: 670a4de6-883b-4883-a0dd-681c649357db
    type: regular
    task:
      id: 670a4de6-883b-4883-a0dd-681c649357db
      version: -1
      name: Analyze Timestamp Intervals
      description: Analyze a list of Unix timestamps in milliseconds, to detect simple patterns of consistency or high frequency. The script can aid in the investigation of multi-event alerts that contain a list of timestamps.
      scriptName: AnalyzeTimestampIntervals
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "147"
    scriptarguments:
      timestamps:
        complex:
          root: ${
          accessor: '}'
          transformers:
          - operator: If-Then-Else
            args:
              condition:
                value:
                  simple: lhs==rhs
              conditionB: {}
              conditionInBetween: {}
              else:
                value:
                  simple: Core.OriginalAlert.stateful_raw_data.events_from_decider.event_timestamp
                iscontext: true
              equals: {}
              lhs:
                value:
                  simple: Core.OriginalAlert.stateful_raw_data.events_from_decider.event_timestamp
                iscontext: true
              lhsB: {}
              options: {}
              optionsB: {}
              rhs: {}
              rhsB: {}
              then:
                value:
                  simple: Core.OriginalAlert._all_events.event_timestamp
                iscontext: true
          - operator: division
            args:
              by:
                value:
                  simple: "1"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1758,
          "y": 1774
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "147":
    id: "147"
    taskid: 77f74e26-b8e9-4f19-8d15-ac7f1666db7c
    type: condition
    task:
      id: 77f74e26-b8e9-4f19-8d15-ac7f1666db7c
      version: -1
      name: Are the intervals indicative of an automated port scan?
      description: Checks if the port scan intervals are indicative of an automated scan.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "165"
      "yes":
      - "164"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isTrue
          left:
            value:
              simple: IntervalAnalysis.IsPatternLikelyAutomated
            iscontext: true
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1758,
          "y": 1914
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "148":
    id: "148"
    taskid: b5cf9594-e9f3-45e5-87f5-30a04bd48cfe
    type: regular
    task:
      id: b5cf9594-e9f3-45e5-87f5-30a04bd48cfe
      version: -1
      name: Suspicious ratio of unique ports to connections
      description: Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "149"
    scriptarguments:
      key:
        simple: SuspiciousRatio
      value:
        complex:
          root: Core.OriginalAlert.stateful_raw_data
          accessor: count_distinct_story_id
          transformers:
          - operator: division
            args:
              by:
                value:
                  simple: Core.OriginalAlert.stateful_raw_data.count_distinct_remote_port
                iscontext: true
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1309,
          "y": 1770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "149":
    id: "149"
    taskid: 4dfb8c0e-ca97-4263-a2c2-2e218f895d4a
    type: condition
    task:
      id: 4dfb8c0e-ca97-4263-a2c2-2e218f895d4a
      version: -1
      name: Found suspicious ratio of unique ports to connections?
      description: Checks if a suspicious ratio of unique ports to connections is found.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "165"
      "yes":
      - "163"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: SuspiciousRatio
            iscontext: true
      - - operator: InRange
          left:
            value:
              simple: SuspiciousRatio
            iscontext: true
          right:
            value:
              simple: 1,1.1
        - operator: notContainsGeneral
          left:
            value:
              simple: SuspiciousRatio
            iscontext: true
          right:
            value:
              simple: .
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1309,
          "y": 1914
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "151":
    id: "151"
    taskid: 4ebca7d3-ef89-487f-a408-a6f0de6111e5
    type: condition
    task:
      id: 4ebca7d3-ef89-487f-a408-a6f0de6111e5
      version: -1
      name: Are there any processes in the alert context?
      description: Checks whether there are any processes in the alert context.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "145"
      "yes":
      - "198"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: alert.cgosha256
            iscontext: true
          right:
            value: {}
        - operator: isNotEmpty
          left:
            value:
              simple: alert.osparentsha256
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 421,
          "y": 368
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "154":
    id: "154"
    taskid: 8b342812-aba3-45ea-b13d-b36198b71f16
    type: condition
    task:
      id: 8b342812-aba3-45ea-b13d-b36198b71f16
      version: -1
      name: Is host risk score is high?
      description: Checks if the endpoint has a high risk score.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "156"
      "yes":
      - "196"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: Core.RiskyHost.risk_level
            iscontext: true
          ignorecase: true
      - - operator: containsGeneral
          left:
            value:
              simple: Core.RiskyHost.risk_level
            iscontext: true
          right:
            value:
              simple: High
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 640,
          "y": 1069
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "156":
    id: "156"
    taskid: 159f2bd6-9995-425f-b485-8186c1d13505
    type: condition
    task:
      id: 159f2bd6-9995-425f-b485-8186c1d13505
      version: -1
      name: Is the process known as scanner?
      description: Checks if the process in the alert is a known scanner.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "160"
      "yes":
      - "195"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: alert.cgoname
            iscontext: true
          right:
            value: {}
        - operator: isNotEmpty
          left:
            value:
              simple: alert.osparentname
            iscontext: true
      - - operator: AnyMatch
          left:
            value:
              simple: alert.cgoname
            iscontext: true
          right:
            value:
              simple: nmap,nessusd,freeportscanner,ipscan,portscanner,Lanspy,advanced_ip_scanner,advanced_port_scanner,domotz,LookAtLan,ldapwhoami,netscan,PortQry,Pinger,sweep
          ignorecase: true
        - operator: AnyMatch
          left:
            value:
              simple: alert.osparentname
            iscontext: true
          right:
            value:
              simple: nmap,nessusd,freeportscanner,ipscan,portscanner,Lanspy,advanced_ip_scanner,advanced_port_scanner,domotz,LookAtLan,ldapwhoami,netscan,PortQry,Pinger,sweep
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 996,
          "y": 1198
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "157":
    id: "157"
    taskid: 52e90940-b790-4880-9fcc-de9a35519bf6
    type: playbook
    task:
      id: 52e90940-b790-4880-9fcc-de9a35519bf6
      version: -1
      name: Block IP - Generic v3
      description: "This playbook blocks malicious IP addresses using all integrations that are enabled. The direction of the traffic that will be blocked is determined by the XSOAR user (and set by default to outgoing)\nNote the following:\n-  some of those integrations require specific parameters to run, which are based on the playbook inputs. Also, certain integrations use FW rules or appended network objects.\n- Note that the appended network objects should be specified in blocking rules inside the system later on. \n\n\nSupported integrations for this playbook [Network security products such as FW/WAF/IPs/etc.]: \n\n* Check Point Firewall\n* Palo Alto Networks PAN-OS\n* Zscaler\n* FortiGate\n* Aria Packet Intelligence\n* Cisco Firepower \n* Cisco Secure Cloud Analytics\n* Cisco ASA\n* Akamai WAF\n* F5 SilverLine\n* ThreatX\n* Signal Sciences WAF\n* Sophos Firewall."
      playbookName: Block IP - Generic v3
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "13"
    scriptarguments:
      AutoCommit:
        simple: "No"
      CustomBlockRule:
        simple: "True"
      Folder:
        simple: Shared
      IP:
        simple: ${Core.OriginalAlert.event.action_local_ip}
      InputEnrichment:
        simple: "False"
      InternalRange:
        complex:
          root: lists
          accessor: PrivateIPs
          transformers:
          - operator: RegexExtractAll
            args:
              error_if_no_match: {}
              ignore_case: {}
              multi_line: {}
              period_matches_newline: {}
              regex:
                value:
                  simple: (\b(?:\d{1,3}\.){3}\d{1,3}\b/\d{1,2})
              unpack_matches: {}
          - operator: join
            args:
              separator:
                value:
                  simple: ','
      RuleDirection:
        simple: outbound
      RuleName:
        simple: XSIAM- Block IP playbook - ${alert.id}
      UserVerification:
        simple: "False"
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 939,
          "y": 4301
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "158":
    id: "158"
    taskid: 2453af93-2909-4949-8fc3-0b9741bd86bb
    type: title
    task:
      id: 2453af93-2909-4949-8fc3-0b9741bd86bb
      version: -1
      name: Terminate Process
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "29"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -65,
          "y": 3069
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "159":
    id: "159"
    taskid: d02f20bf-d8ab-4cda-b841-8413d251857c
    type: title
    task:
      id: d02f20bf-d8ab-4cda-b841-8413d251857c
      version: -1
      name: Block IP
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "199"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 939,
          "y": 3918
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "160":
    id: "160"
    taskid: 37ecf6c8-61c3-4a69-8c38-bada08063d6c
    type: condition
    task:
      id: 37ecf6c8-61c3-4a69-8c38-bada08063d6c
      version: -1
      name: Is it a high-ratio port scan?
      description: Checks if the port scan has a highly suspicious connection ratio compared to the baseline.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "1"
      "yes":
      - "194"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: alert.name
            iscontext: true
          right:
            value:
              simple: Highly suspicious port scan
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1244,
          "y": 1352
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "161":
    id: "161"
    taskid: 44583cba-46de-4b50-af6e-be223a43cff3
    type: regular
    task:
      id: 44583cba-46de-4b50-af6e-be223a43cff3
      version: -1
      name: Search for related alerts to the destination host
      description: This task searches for related alerts generated by processes within the same causality chain, which may indicate a compromised endpoint.
      scriptName: SearchAlertsV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "141"
    scriptarguments:
      extend-context:
        simple: DstHostRelatedAlerts=
      fromdate:
        simple: 3 hours ago
      ignore-outputs:
        simple: "true"
      includeinformational:
        simple: "true"
      query:
        simple: (agentid:${Core.OriginalAlert.event.action_remote_ip} or localip:${Core.OriginalAlert.event.action_remote_ip} or remoteip:${Core.OriginalAlert.event.action_remote_ip}) and -name:"Port Scan" and -name:"Highly suspicious port scan" and -name:"Port scan by suspicious process" and -name:"Suspicious port scan" and -name:"Port Scan With Low Direction Confidence"
      todate:
        simple: now
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3224,
          "y": 1774
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "163":
    id: "163"
    taskid: 522a7b0d-f287-4400-9fb0-88a40bcd2d80
    type: regular
    task:
      id: 522a7b0d-f287-4400-9fb0-88a40bcd2d80
      version: -1
      name: Set evidence for suspicious ratio
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "165"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidences
      value:
        simple: Suspicious ports-to-connections ratio detected
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1309,
          "y": 2144
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "164":
    id: "164"
    taskid: f2fc2c9c-41b1-41eb-a53a-376e53cd4320
    type: regular
    task:
      id: f2fc2c9c-41b1-41eb-a53a-376e53cd4320
      version: -1
      name: Set evidence for automated scan pattern
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "165"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidences
      value:
        simple: Likely automated scanning pattern detected
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1758,
          "y": 2097
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "165":
    id: "165"
    taskid: 593a5563-6e22-4964-93f3-e125522c5486
    type: title
    task:
      id: 593a5563-6e22-4964-93f3-e125522c5486
      version: -1
      name: Evaluate investigation results
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "172"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2486,
          "y": 2512
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "166":
    id: "166"
    taskid: 13b43477-c142-4a42-9412-e0a255c76dc6
    type: condition
    task:
      id: 13b43477-c142-4a42-9412-e0a255c76dc6
      version: -1
      name: Is endpoint id exist?
      description: Checks if the endpoint ID is found.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "159"
      "yes":
      - "184"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: Endpoint.Vendor
            iscontext: true
          right:
            value: {}
      - - operator: isEqualString
          left:
            value:
              simple: Endpoint.Vendor
            iscontext: true
          right:
            value:
              simple: Cortex Core - IR
          ignorecase: true
      - - operator: isEqualNumber
          left:
            value:
              complex:
                root: Endpoint
                accessor: ID
                transformers:
                - operator: count
            iscontext: true
          right:
            value:
              simple: "1"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 644,
          "y": 2917
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "167":
    id: "167"
    taskid: b8cc2295-50b9-4109-85e5-f0630fce74bd
    type: regular
    task:
      id: b8cc2295-50b9-4109-85e5-f0630fce74bd
      version: -1
      name: Set Suspicious alert related to the source host
      description: Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "168"
    scriptarguments:
      key:
        simple: SuspiciousRelatedAlertsSrc
      value:
        complex:
          root: SrcHostRelatedAlerts.Contents.data.name
          filters:
          - - operator: containsGeneral
              left:
                value:
                  simple: SrcHostRelatedAlerts.Contents.data.name
                iscontext: true
              right:
                value:
                  simple: Vulnerability
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: SrcHostRelatedAlerts.Contents.data.name
                iscontext: true
              right:
                value:
                  simple: Brute Force Attempt
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: SrcHostRelatedAlerts.Contents.data.name
                iscontext: true
              right:
                value:
                  simple: New Administrative Behavior
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: SrcHostRelatedAlerts.Contents.data.name
                iscontext: true
              right:
                value:
                  simple: Host Sweep
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: SrcHostRelatedAlerts.Contents.data.name
                iscontext: true
              right:
                value:
                  simple: Password Spray
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: SrcHostRelatedAlerts.Contents.data.name
                iscontext: true
              right:
                value:
                  simple: Failed Connections
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: SrcHostRelatedAlerts.Contents.data.name
                iscontext: true
              right:
                value:
                  simple: Port Sweep
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: SrcHostRelatedAlerts.Contents.data.name
                iscontext: true
              right:
                value:
                  simple: RPC traffic to multiple
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: SrcHostRelatedAlerts.Contents.data.name
                iscontext: true
              right:
                value:
                  simple: Abnormal process connection to default Meterpreter port
            - operator: containsGeneral
              left:
                value:
                  simple: SrcHostRelatedAlerts.Contents.data.name
                iscontext: true
              right:
                value:
                  simple: Port Scan
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: SrcHostRelatedAlerts.Contents.data.name
                iscontext: true
              right:
                value:
                  simple: Rare WinRM Session
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: SrcHostRelatedAlerts.Contents.data.name
                iscontext: true
              right:
                value:
                  simple: Uncommon VNC server communication
            - operator: containsGeneral
              left:
                value:
                  simple: SrcHostRelatedAlerts.Contents.data.name
                iscontext: true
              right:
                value:
                  simple: Abnormal RDP connections to multiple hosts
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: SrcHostRelatedAlerts.Contents.data.name
                iscontext: true
              right:
                value:
                  simple: Uncommon RDP connection
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: SrcHostRelatedAlerts.Contents.data.name
                iscontext: true
              right:
                value:
                  simple: SMB scanning
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: SrcHostRelatedAlerts.Contents.data.name
                iscontext: true
              right:
                value:
                  simple: Rare SMB session to a remote host
            - operator: containsGeneral
              left:
                value:
                  simple: SrcHostRelatedAlerts.Contents.data.name
                iscontext: true
              right:
                value:
                  simple: Rare AppID usage to a rare destination
            - operator: containsGeneral
              left:
                value:
                  simple: SrcHostRelatedAlerts.Contents.data.name
                iscontext: true
              right:
                value:
                  simple: Rare Windows Remote Management (WinRM) HTTP Activity
            - operator: containsGeneral
              left:
                value:
                  simple: SrcHostRelatedAlerts.Contents.data.name
                iscontext: true
              right:
                value:
                  simple: LDAP traffic from non-standard process
            - operator: containsGeneral
              left:
                value:
                  simple: SrcHostRelatedAlerts.Contents.data.name
                iscontext: true
              right:
                value:
                  simple: Unsigned process makes connections over DNS ports
            - operator: containsGeneral
              left:
                value:
                  simple: SrcHostRelatedAlerts.Contents.data.name
                iscontext: true
              right:
                value:
                  simple: 'generic:'
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3673,
          "y": 2074
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "168":
    id: "168"
    taskid: c6f3edce-2cf1-4aa4-9717-20a891bd15fb
    type: condition
    task:
      id: c6f3edce-2cf1-4aa4-9717-20a891bd15fb
      version: -1
      name: Found suspicious or malicious combination of related alerts?
      description: Checks if a suspicious or malicious combination of related alerts to the source host was found.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "165"
      Malicious:
      - "169"
      Suspicious:
      - "171"
    separatecontext: false
    conditions:
    - label: Malicious
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: SuspiciousRelatedAlertsSrc
            iscontext: true
          right:
            value: {}
      - - operator: greaterThanOrEqual
          left:
            value:
              complex:
                root: SuspiciousRelatedAlertsSrc
                transformers:
                - operator: count
            iscontext: true
          right:
            value:
              simple: "4"
    - label: Suspicious
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: SuspiciousRelatedAlertsSrc
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3673,
          "y": 2214
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "169":
    id: "169"
    taskid: a8869978-46ef-4eab-a367-c893fcc89553
    type: regular
    task:
      id: a8869978-46ef-4eab-a367-c893fcc89553
      version: -1
      name: Set evidences for malicious related alerts to the source host
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "165"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidences
      value:
        simple: Malicious related alerts to source host detected
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4103,
          "y": 2391
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "171":
    id: "171"
    taskid: d5fb7501-b17c-400f-a1d3-15f2d3bbc9b3
    type: regular
    task:
      id: d5fb7501-b17c-400f-a1d3-15f2d3bbc9b3
      version: -1
      name: Set evidences for suspicious related alerts to the source host
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "165"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidences
      value:
        simple: Suspicious related alerts to source host detected
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3673,
          "y": 2391
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "172":
    id: "172"
    taskid: 67753c8e-1049-4b1b-8c66-33040f9460cc
    type: condition
    task:
      id: 67753c8e-1049-4b1b-8c66-33040f9460cc
      version: -1
      name: Any evidence found requiring remediation?
      description: Checks whether malicious evidence was found during the investigation.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "174"
      "yes":
      - "3"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: greaterThanOrEqual
          left:
            value:
              complex:
                root: Evidences
                transformers:
                - operator: count
            iscontext: true
          right:
            value:
              simple: "2"
        - operator: containsGeneral
          left:
            value:
              simple: Evidences
            iscontext: true
          right:
            value:
              simple: Malicious
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2486,
          "y": 2655
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "173":
    id: "173"
    taskid: 939d00d3-9c2b-44ec-9fb9-93fc6e499d1c
    type: regular
    task:
      id: 939d00d3-9c2b-44ec-9fb9-93fc6e499d1c
      version: -1
      name: Set evidence for suspicious related alerts to the destination host
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "165"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidences
      value:
        simple: Suspicious related alerts to destination host detected
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3224,
          "y": 2073
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "174":
    id: "174"
    taskid: 6f92da3c-a991-4173-854b-e922c54c33b4
    type: title
    task:
      id: 6f92da3c-a991-4173-854b-e922c54c33b4
      version: -1
      name: Inconclusive
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "175"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2486,
          "y": 2872
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "175":
    id: "175"
    taskid: 50d9b666-8923-4470-a0be-7a41b0b3ef63
    type: title
    task:
      id: 50d9b666-8923-4470-a0be-7a41b0b3ef63
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 244,
          "y": 4681
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "177":
    id: "177"
    taskid: 099673df-ebeb-463d-b393-235a2ff5f78e
    type: condition
    task:
      id: 099673df-ebeb-463d-b393-235a2ff5f78e
      version: -1
      name: Check if the process has a suspicious reputation
      description: Check if the process has a suspicious reputation.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "165"
      "yes":
      - "178"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualNumber
          left:
            value:
              complex:
                root: Indicators
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: Indicators.Value
                      iscontext: true
                    right:
                      value:
                        simple: alert.osparentsha256
                      iscontext: true
                    ignorecase: true
                  - operator: containsGeneral
                    left:
                      value:
                        simple: Indicators.Value
                      iscontext: true
                    right:
                      value:
                        simple: alert.cgosha256
                      iscontext: true
                accessor: Score
            iscontext: true
          right:
            value:
              simple: "2"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2229,
          "y": 1770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "178":
    id: "178"
    taskid: 4c47a60b-503c-4b7f-b2bb-c1d978c60285
    type: regular
    task:
      id: 4c47a60b-503c-4b7f-b2bb-c1d978c60285
      version: -1
      name: Set evidence for suspicious process reputation
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "165"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidences
      value:
        simple: Suspicious process reputation detected
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2229,
          "y": 1914
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "179":
    id: "179"
    taskid: e2d1d0d1-25a0-4ee2-81c4-2d216c4acdd4
    type: condition
    task:
      id: e2d1d0d1-25a0-4ee2-81c4-2d216c4acdd4
      version: -1
      name: Check if the host risk score is medium
      description: Checks if the host risk score is medium.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "165"
      "yes":
      - "180"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: Core.RiskyHost.risk_level
            iscontext: true
          right:
            value: {}
          ignorecase: true
      - - operator: containsGeneral
          left:
            value:
              simple: |
                Core.RiskyHost.risk_level
            iscontext: true
          right:
            value:
              simple: med
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2752,
          "y": 1770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "180":
    id: "180"
    taskid: af9b7732-e8b5-4e95-a322-91af63e3c54e
    type: regular
    task:
      id: af9b7732-e8b5-4e95-a322-91af63e3c54e
      version: -1
      name: Set evidences for medium risk score
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "165"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidences
      value:
        simple: Host detected with medium risk score
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2752,
          "y": 1914
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "181":
    id: "181"
    taskid: 2b311a78-177d-4e99-a1db-f161cc3fc58c
    type: regular
    task:
      id: 2b311a78-177d-4e99-a1db-f161cc3fc58c
      version: -1
      name: Get Endpoint details by agent id
      description: Returns endpoint information based on agent id.
      script: '|||endpoint'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "182"
    scriptarguments:
      id:
        simple: ${alert.agentid}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -83,
          "y": 516
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "182":
    id: "182"
    taskid: 6b66067c-b344-4186-90ce-bd2d09dc5c59
    type: regular
    task:
      id: 6b66067c-b344-4186-90ce-bd2d09dc5c59
      version: -1
      name: Get Endpoint details by hostname
      description: Returns endpoint information based on hostname.
      script: '|||endpoint'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "2"
    scriptarguments:
      hostname:
        simple: ${alert.agentid}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -83,
          "y": 670
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "183":
    id: "183"
    taskid: d5624280-4cc7-4231-80c1-bcba4ad1a68a
    type: condition
    task:
      id: d5624280-4cc7-4231-80c1-bcba4ad1a68a
      version: -1
      name: Found any process to terminate?
      description: Checks for processes to terminate.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "123"
      "yes":
      - "158"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: alert.cid
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -65,
          "y": 2917
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "184":
    id: "184"
    taskid: aa273708-ddea-4af5-ac69-67da4e9f4c21
    type: title
    task:
      id: aa273708-ddea-4af5-ac69-67da4e9f4c21
      version: -1
      name: Isolate Endpoint
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "189"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 644,
          "y": 3069
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "185":
    id: "185"
    taskid: 8575b582-e049-4d05-bf83-44bba974416c
    type: collection
    task:
      id: 8575b582-e049-4d05-bf83-44bba974416c
      version: -1
      name: Approve Isolation
      description: |-
        Analyst approval is required for the following actions:
        - Blocking the malicious URL.
        - Executing an XQL query to identify files downloaded via the malicious URL.
        - Isolating the endpoint.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "190"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 640,
          "y": 3518
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
      replyOptions:
      - "Yes"
      - "No"
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: "The activity was classified as malicious based on the following findings:\n${Evidences(val.length > 0) =>\"- \" + val.join(\"\\n - \")}\n${.=val.MaliciousCGOProcess ? \"- **Malicious CGO Process detected:** \" + val.MaliciousCGOProcess.cgoPath : \"\"}  \n${.=val.MaliciousOSActorProcess ? \"- **Malicious OS Actor Process detected:** \" + val.MaliciousOSActorProcess.actorPath : \"\"}  \n\n\n**Should Isolate the endpoint?**\n- Hostname: ${Endpoint.Hostname}\n- IP Address: ${Endpoint.IPAddress}\n- Endpoint ID: ${Endpoint.ID}"
        required: false
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: "No"
        - simple: "Yes"
        fieldassociated: ""
        placeholder: ""
        tooltip: This action will isolate the endpoint and is recommended to prevent the attacker from executing lateral movement.
        readonly: false
      title: IsolationApproval
      description: |+
        A malicious port scan was detected on the following endpoint. Isolation is recommended to prevent potential lateral movement within the network.


      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "186":
    id: "186"
    taskid: fd39248b-a9b8-4115-8aef-980b26662630
    type: regular
    task:
      id: fd39248b-a9b8-4115-8aef-980b26662630
      version: -1
      name: 'Isolate Endpoint '
      description: Isolates the specified endpoint.
      script: '|||core-isolate-endpoint'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#error#':
      - "159"
      '#none#':
      - "13"
    scriptarguments:
      endpoint_id:
        simple: ${Core.Endpoint.endpoint_id}
      incident_id:
        complex:
          root: alert
          accessor: parentXDRIncident
          transformers:
          - operator: Cut
            args:
              delimiter:
                value:
                  simple: '-'
              fields:
                value:
                  simple: "2"
      timeout_in_seconds:
        simple: "120"
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": 640,
          "y": 3794
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "187":
    id: "187"
    taskid: 9794e74e-6233-45c4-8b16-9ca1db483131
    type: condition
    task:
      id: 9794e74e-6233-45c4-8b16-9ca1db483131
      version: -1
      name: Verify endpoint isn't isolated, disconnected, or a server
      description: Determine whether to isolate the endpoint based on its status, isolation state, and OS type.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "159"
      Already isolated:
      - "13"
      Isolate:
      - "185"
    separatecontext: false
    conditions:
    - label: Isolate
      condition:
      - - operator: containsString
          left:
            value:
              complex:
                root: Core.Endpoint
                accessor: endpoint_type
            iscontext: true
          right:
            value:
              simple: WORKSTATION
          ignorecase: true
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Core.Endpoint
                accessor: endpoint_status
            iscontext: true
          right:
            value:
              simple: CONNECTED
          ignorecase: true
      - - operator: isEqualString
          left:
            value:
              simple: Core.Endpoint.is_isolated
            iscontext: true
          right:
            value:
              simple: AGENT_UNISOLATED
          ignorecase: true
    - label: Already isolated
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: Core.Endpoint.is_isolated
            iscontext: true
          right:
            value:
              simple: AGENT_ISOLATED
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 644,
          "y": 3341
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 2
    isoversize: false
    isautoswitchedtoquietmode: false
  "189":
    id: "189"
    taskid: 9faf3257-fbd3-474b-9a7b-ef71d2678f30
    type: regular
    task:
      id: 9faf3257-fbd3-474b-9a7b-ef71d2678f30
      version: -1
      name: Get endpoint info by endpoint ID
      description: Gets a list of endpoints, according to the passed filters. If there are no filters, all endpoints are returned. Filtering by multiple fields is concatenated using the AND condition (OR is not supported). Maximum result set size is 100. Offset is the zero-based number of endpoints from the start of the result set (start by counting from 0).
      script: '|||core-get-endpoints'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "187"
    scriptarguments:
      endpoint_id_list:
        complex:
          root: Endpoint
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: Endpoint.Vendor
                iscontext: true
              right:
                value:
                  simple: Cortex Core - IR
              ignorecase: true
          accessor: ID
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 644,
          "y": 3197
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "190":
    id: "190"
    taskid: aa73e003-0082-4bc5-878d-a9efa95b2520
    type: condition
    task:
      id: aa73e003-0082-4bc5-878d-a9efa95b2520
      version: -1
      name: Check Analyst decision
      description: Checks analyst’s decision on endpoint isolation.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "159"
      "yes":
      - "186"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: IsolationApproval.Answers.0
            iscontext: true
          right:
            value:
              simple: "Yes"
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 640,
          "y": 3646
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "194":
    id: "194"
    taskid: 9c5257fb-06da-45c2-96fd-8fac1fb05bfb
    type: regular
    task:
      id: 9c5257fb-06da-45c2-96fd-8fac1fb05bfb
      version: -1
      name: Set evidence for extremely high ratio
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidences
      value:
        simple: Port scan with extremely high ratio detected
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 996,
          "y": 1522
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "195":
    id: "195"
    taskid: 969da77c-00dd-4fdf-b104-571ddfb061e0
    type: regular
    task:
      id: 969da77c-00dd-4fdf-b104-571ddfb061e0
      version: -1
      name: Set evidence for process known as scanner
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidences
      value:
        simple: Process known as scanner
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 731,
          "y": 1352
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "196":
    id: "196"
    taskid: 7bdca7d2-c3da-426b-87ba-b75fa01d605a
    type: regular
    task:
      id: 7bdca7d2-c3da-426b-87ba-b75fa01d605a
      version: -1
      name: Set evidence for high risk score
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Evidences
      value:
        simple: Host detected with high risk score
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 443,
          "y": 1198
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "197":
    id: "197"
    taskid: 108d1c10-0893-4904-8b81-f1007f84d074
    type: regular
    task:
      id: 108d1c10-0893-4904-8b81-f1007f84d074
      version: -1
      name: Add an IOC rule for malicious processes
      description: Upload the IOC rules to XSIAM. When the ioc_object is defined, disregard any other provided arguments, as the ioc_object takes precedence. Validate the indicator parameters when ioc_object is used. If `vendor_name`, `vendor_reputation`, and `vendor_reliability` are used, only a single vendor is supported. For multiple vendors, utilize an `ioc_object` in JSON format. Adding a rule with the same indicator, but with different parameters, will update the existing rule.
      script: '|||core-add-indicator-rule'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "13"
    scriptarguments:
      comment:
        simple: 'The IOC rule was added by the playbook ''Suspicious Port Scan'' as part of handling alert ID: ${alert.id}'
      indicator:
        complex:
          root: MaliciousCGOProcess
          accessor: cgoSha256
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: MaliciousOSActorProcess.actorSha256
                iscontext: true
          - operator: uniq
      severity:
        simple: HIGH
      type:
        simple: HASH
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -974,
          "y": 3576
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "198":
    id: "198"
    taskid: 6a395957-07ea-45ad-9c9c-17d96ad7ee73
    type: regular
    task:
      id: 6a395957-07ea-45ad-9c9c-17d96ad7ee73
      version: -1
      name: Check the processes reputation
      description: Checks the file reputation of the specified hash.
      script: '|||file'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "2"
    scriptarguments:
      file:
        complex:
          root: alert
          accessor: cgosha256
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: alert.osparentsha256
                iscontext: true
          - operator: RemoveEmpty
            args:
              empty_values: {}
              remove_keys:
                value:
                  simple: "true"
          - operator: uniq
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 421,
          "y": 516
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "199":
    id: "199"
    taskid: 688914bb-c9e2-41b4-83f9-0a40ed65515f
    type: collection
    task:
      id: 688914bb-c9e2-41b4-83f9-0a40ed65515f
      version: -1
      name: Approve Block IP
      description: |+
        Blocking the source IP address requires analyst approval.

      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "200"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 939,
          "y": 4024
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
      replyOptions:
      - "Yes"
      - "No"
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: Should the source IP ${Core.OriginalAlert.event.action_local_ip} be blocked using the "Block IP - Generic v3" sub-playbook and the available integrations?
        required: false
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: "No"
        - simple: "Yes"
        fieldassociated: ""
        placeholder: ""
        tooltip: This approval will allow blocking the source IP address to prevent the attacker from executing lateral movement.
        readonly: false
      title: BlockIpApproval
      description: |+
        A malicious port scan was detected. Blocking the source IP address is recommended to prevent potential lateral movement within the network.


      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "200":
    id: "200"
    taskid: 62654364-f860-4c5d-be2f-1d6c476ab676
    type: condition
    task:
      id: 62654364-f860-4c5d-be2f-1d6c476ab676
      version: -1
      name: Check Analyst Decision – Block IP
      description: Checks analyst’s decision on blocking the source IP address.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "13"
      "yes":
      - "157"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: BlockIpApproval.Answers.0
            iscontext: true
          right:
            value:
              simple: "Yes"
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 939,
          "y": 4144
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "123_13_#default#": 0.2,
      "123_94_yes": 0.39,
      "141_165_#default#": 0.26,
      "147_164_yes": 0.51,
      "147_165_#default#": 0.22,
      "149_163_yes": 0.48,
      "149_165_#default#": 0.11,
      "151_198_yes": 0.48,
      "154_196_yes": 0.53,
      "160_1_#default#": 0.11,
      "166_159_#default#": 0.25,
      "166_184_yes": 0.3,
      "168_165_#default#": 0.19,
      "168_169_Malicious": 0.51,
      "168_171_Suspicious": 0.64,
      "177_165_#default#": 0.24,
      "177_178_yes": 0.45,
      "179_165_#default#": 0.23,
      "183_123_#default#": 0.89,
      "183_158_yes": 0.36,
      "186_159_#error#": 0.51,
      "187_13_Already isolated": 0.19,
      "187_159_#default#": 0.39,
      "190_159_#default#": 0.54,
      "190_186_yes": 0.42,
      "200_13_#default#": 0.46,
      "200_157_yes": 0.36,
      "2_145_#default#": 0.41,
      "2_83_yes": 0.24,
      "81_82_yes": 0.43,
      "81_86_#default#": 0.55,
      "84_85_yes": 0.38,
      "84_86_#default#": 0.51,
      "8_169_yes": 0.27
    },
    "paper": {
      "dimensions": {
        "height": 4763,
        "width": 5458,
        "x": -974,
        "y": -22
      }
    }
  }
inputs: []
inputSections:
- inputs: []
  name: General (Inputs group)
  description: Generic group for inputs
outputSections:
- outputs: []
  name: General (Outputs group)
  description: Generic group for outputs
outputs: []
tests:
- No tests (auto formatted)
fromversion: 8.9.0
