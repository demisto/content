id: CVE-2025-59287 - Microsoft WSUS Remote Code Execution
version: -1
contentitemexportablefields:
  contentitemfields: {}
name: CVE-2025-59287 - Microsoft WSUS Remote Code Execution
description: "CVE-2025-59287 - Microsoft WSUS Remote Code Execution\n\n\n##   Vulnerability Overview\n\n- **Vulnerability Name\t**: Microsoft Windows Server Update Service (WSUS) Deserialization of Untrusted Data Vulnerability\n- **CVE ID**: CVE-2025-59287 \n- **CVSS Score**: 9.8 (Critical)  \n\n\nAn unauthenticated remote code execution (RCE) vulnerability has been identified in Microsoft Windows Server Update Services (WSUS).\n[Source: Unit42 - Palo Alto Networks](https://unit42.paloaltonetworks.com/microsoft-cve-2025-59287/)\n\n\n##  Mitigation and Recommendations\n\n- **Apply Patch**\n- **Restrict Access** to the vulnerable serves  \n- **Monitor for IoCs and suspicious traffic  \n\n##  Conclusion\n\nCVE‑2025‑59287 is a critical, remotely exploitable vulnerability in WSUS that allows unauthenticated attackers to execute arbitrary code with SYSTEM privileges.\n\n[View official CVE details on NIST](https://nvd.nist.gov/vuln/detail/CVE-2025-59287)\n\n##  Playbook Triggers\n- Manually\n- \"CVE Exploitation - 2037164431\" or \"CVE Exploitation - 3823999562\" Agents rules\n\n##  Playbook Flow\n1. Using XQL to identify WSUS servers in your environment.\n2. Collects IOCs from the Unit42 blog.\n3. Using XQL to detect any suspicious command lines indicative of exploitation of this vulnerability.\n4. Investigate the command lines to identify malicious indicators related to the vulnerability.\n5. Using XQL to hunt for malicious IOCs.\n6. Isolats compromised WSUS servers.\n7. Block malicious indicators using the \"Containment Plan – Block Indicators\" playbook.\n8. Provides mitigation recommendations."
tags:
- Rapid Breach Response
- CVE-2025-59287
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 4f736e78-7eb6-41fa-81ed-bbeca58eacae
    type: start
    task:
      id: 4f736e78-7eb6-41fa-81ed-bbeca58eacae
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "26"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3720,
          "y": -707
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: 4c943ea3-0561-4398-935d-4bb47e9655a3
    type: regular
    task:
      id: 4c943ea3-0561-4398-935d-4bb47e9655a3
      version: -1
      name: XQL Query - Search for any WSUS servers that might be vulnerable
      description: |
        Execute an XQL query to search all WSUS servers and retrieve their agent IDs.
      script: '|||xdr-xql-generic-query'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#error#':
      - "2"
      '#none#':
      - "4"
    scriptarguments:
      extend-context:
        simple: PossibleWsusServers=
      ignore-outputs:
        simple: "true"
      max_fields:
        simple: "100"
      query:
        simple: "dataset = xdr_data \n| filter agent_os_type = ENUM.AGENT_OS_WINDOWS and event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START \n| filter lowercase(actor_process_image_name) = \"wsusservice.exe\" \nor lowercase(causality_actor_process_image_name) = \"wsusservice.exe\" \nor (lowercase(causality_actor_process_image_name) = \"w3wp.exe\" and lowercase(causality_actor_process_command_line) contains \"wsuspool\") \nor (lowercase(actor_process_image_name) = \"w3wp.exe\" and lowercase(actor_process_command_line) contains \"wsuspool\")\n| fields agent_id\n| dedup agent_id"
      query_name:
        simple: Search for any SharePoint servers that might be vulnerable
      time_frame:
        simple: 1 week ago
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": 3195,
          "y": -123
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: 9f22c906-8167-4c69-b4be-585007c3e3ff
    type: regular
    task:
      id: 9f22c906-8167-4c69-b4be-585007c3e3ff
      version: -1
      name: Manual – Search possible hosts
      description: "Dear Analyst,\n\nEnsure that the 'XQL Query Engine' integration is active. If it's not enabled, activate the integration or manually run the following XQL query to determine if any hosts are running a potentially vulnerable product.\n\n**XQL Query**:\nSearch all WSUS servers and retrieve their agent IDs.\n\n```dataset = xdr_data \n| filter agent_os_type = ENUM.AGENT_OS_WINDOWS and event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START \n| filter lowercase(actor_process_image_name) = \"wsusservice.exe\" \nor lowercase(causality_actor_process_image_name) = \"wsusservice.exe\" \nor (lowercase(causality_actor_process_image_name) = \"w3wp.exe\" and lowercase(causality_actor_process_command_line) contains \"wsuspool\") \nor (lowercase(actor_process_image_name) = \"w3wp.exe\" and lowercase(actor_process_command_line) contains \"wsuspool\")\n| fields agent_id\n| dedup agent_id \n```\n"
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "103"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3720,
          "y": 31
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: 4b4d51d5-6185-4ad7-8470-7c3e42f75484
    type: condition
    task:
      id: 4b4d51d5-6185-4ad7-8470-7c3e42f75484
      version: -1
      name: Is the integration of 'XQL Query Engine' available?
      description: Returns 'yes' if integration brand 'XQL Query Engine' is available. Otherwise returns 'no'.
      scriptName: IsIntegrationAvailable
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "2"
      "yes":
      - "1"
    scriptarguments:
      brandname:
        simple: XQL Query Engine
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3720,
          "y": -276
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: baa77a3d-d5e2-43ca-bd8f-00d1d50fe0fc
    type: condition
    task:
      id: baa77a3d-d5e2-43ca-bd8f-00d1d50fe0fc
      version: -1
      name: Any results from XQL?
      description: Any results from the XQL Query?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "9"
      "yes":
      - "92"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: PossibleWsusServers.results.agent_id
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3195,
          "y": 31
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: 9d8762f2-8993-49c2-bc0e-56f369b8070b
    type: title
    task:
      id: 9d8762f2-8993-49c2-bc0e-56f369b8070b
      version: -1
      name: 'XQL: Identify WSUS servers'
      description: This section identifies Microsoft SharePoint instances.
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3720,
          "y": -401
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: c87272a4-3ee4-43fa-ace5-beacf4096c65
    type: title
    task:
      id: c87272a4-3ee4-43fa-ace5-beacf4096c65
      version: -1
      name: Collect Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "124"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201.5,
          "y": 475
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: b91e46f0-2c7a-4ab9-83aa-018592b4ebbf
    type: title
    task:
      id: b91e46f0-2c7a-4ab9-83aa-018592b4ebbf
      version: -1
      name: Anlysis Endpoints
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "133"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201,
          "y": 1493
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: 3d831be1-6556-4faf-88b0-2e8b481cb2eb
    type: regular
    task:
      id: 3d831be1-6556-4faf-88b0-2e8b481cb2eb
      version: -1
      name: Extract indicators from collected data
      description: commands.local.cmd.extract.indicators
      script: Builtin|||extractIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "22"
    scriptarguments:
      text:
        complex:
          root: http.parsedBlog
          accessor: indicators
          transformers:
          - operator: RemoveEmpty
            args:
              empty_values: {}
              remove_keys:
                value:
                  simple: "true"
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201,
          "y": 894
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: 220a4b75-0667-4734-8c12-021056d92c17
    type: title
    task:
      id: 220a4b75-0667-4734-8c12-021056d92c17
      version: -1
      name: Tag and Link Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "23"
      - "24"
      - "51"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201,
          "y": 1040
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: 50de2b7e-6a3a-4283-a5da-f9acd59ae578
    type: regular
    task:
      id: 50de2b7e-6a3a-4283-a5da-f9acd59ae578
      version: -1
      name: Tag URL Indicators
      description: commands.local.cmd.new.indicator
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      retry-count:
        simple: "3"
      retry-interval:
        simple: "2"
      tags:
        simple: CVE-2025-59287
      type:
        simple: URL
      value:
        complex:
          root: ExtractedIndicators.URL
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: ExtractedIndicators.URL
                iscontext: true
          transformers:
          - operator: uniq
      verdict:
        simple: Malicious
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3799.25,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: 4114e55f-237b-480b-a748-d233752ca403
    type: regular
    task:
      id: 4114e55f-237b-480b-a748-d233752ca403
      version: -1
      name: Tag CVE Indicators
      description: commands.local.cmd.new.indicator
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      retry-count:
        simple: "3"
      retry-interval:
        simple: "2"
      tags:
        simple: Microsoft SharePoint ToolShell vulnerability chain
      type:
        simple: CVE
      value:
        complex:
          root: ExtractedIndicators
          accessor: CVE
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: 5ba25eb1-0569-482c-859b-4206b489a674
    type: title
    task:
      id: 5ba25eb1-0569-482c-859b-4206b489a674
      version: -1
      name: Extract Indicators
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "21"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201,
          "y": 761
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: 28d72d5f-3a7d-4e58-add5-ac6599a2e47e
    type: condition
    task:
      id: 28d72d5f-3a7d-4e58-add5-ac6599a2e47e
      version: -1
      name: Triggered manually or via alert?
      description: This task checks if the playbook was triggered manually or by an alert.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "7"
      Alert:
      - "27"
    separatecontext: false
    conditions:
    - label: Alert
      condition:
      - - operator: containsGeneral
          left:
            value:
              simple: alert.name
            iscontext: true
          right:
            value:
              simple: CVE Exploitation - 2037164431
          ignorecase: true
        - operator: containsGeneral
          left:
            value:
              simple: alert.name
            iscontext: true
          right:
            value:
              simple: CVE Exploitation - 3823999562
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3720,
          "y": -571
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: a0612543-9a56-4233-aab8-449960b0b27a
    type: title
    task:
      id: a0612543-9a56-4233-aab8-449960b0b27a
      version: -1
      name: Alert
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "9"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201.5,
          "y": -401
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 8c57d83d-bfad-4566-88f4-e9269479223b
    type: title
    task:
      id: 8c57d83d-bfad-4566-88f4-e9269479223b
      version: -1
      name: Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "150"
      - "84"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3460,
          "y": 4338
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: 3079d164-b58b-4367-853d-bbdd8f0494ca
    type: title
    task:
      id: 3079d164-b58b-4367-853d-bbdd8f0494ca
      version: -1
      name: Mitigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "99"
      - "87"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3460,
          "y": 5466
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: 778bf119-d2c9-49f8-826e-ebfc9c323e15
    type: condition
    task:
      id: 778bf119-d2c9-49f8-826e-ebfc9c323e15
      version: -1
      name: Analysis Resolution - Should continue with the investigation?
      description: |+
        ## Check with the analyst to determine whether to continue the investigation.

        - Verify that Microsoft WSUS is on the affected servers and the patches are implemented.

        - Check if the Threat Hunting steps returned results (if any).

        - Validate that there are no other affected systems, and the Potential attack patterns are investigated.


      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "No":
      - "37"
      "Yes":
      - "36"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3460,
          "y": 6077
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
        simple: Do you need to continue with the investigation?
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
      replyOptions:
      - "Yes"
      - "No"
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: afc3aacb-3bcd-41c4-89e3-86037762d900
    type: title
    task:
      id: afc3aacb-3bcd-41c4-89e3-86037762d900
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3460,
          "y": 6388
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: ca7eba93-8efc-494e-bb75-fcd2cc928709
    type: regular
    task:
      id: ca7eba93-8efc-494e-bb75-fcd2cc928709
      version: -1
      name: Investigate Further
      description: |
        ## Manual step for further alert investigation.

        - Keep monitoring IOCs for suspicious actions.
        - Check for any additional suspicious artifacts identified during the investigation and continue your analysis on them.
        - Keep monitoring for new [hot-fixes and KBs released by Microsoft](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-59287) related to this CVE.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "35"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3233.75,
          "y": 6225
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: 275fcfc2-93e3-4a42-8f0a-eee78c7d5758
    type: regular
    task:
      id: 275fcfc2-93e3-4a42-8f0a-eee78c7d5758
      version: -1
      name: Close Investigation
      description: Close the current alert
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "35"
    scriptarguments:
      closeReason:
        simple: No further actions are required.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3674.5,
          "y": 6225
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: 4c900ab8-62d9-4cf8-8a04-82a9b4f24176
    type: title
    task:
      id: 4c900ab8-62d9-4cf8-8a04-82a9b4f24176
      version: -1
      name: Resolution
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "34"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3460,
          "y": 5935
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "48":
    id: "48"
    taskid: de193ec2-fa76-46ac-864a-972bd955ecae
    type: regular
    task:
      id: de193ec2-fa76-46ac-864a-972bd955ecae
      version: -1
      name: Link Indicators to Alert
      description: commands.local.cmd.associate.indicators
      script: Builtin|||associateIndicatorsToAlert
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "12"
    scriptarguments:
      alertId:
        simple: ${alert.id}
      indicatorsValues:
        complex:
          root: ExtractedIndicators.URL
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: ExtractedIndicators.URL
                iscontext: true
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.Domain
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.CVE
                iscontext: true
          - operator: uniq
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201,
          "y": 1341
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "51":
    id: "51"
    taskid: 2a94e246-6cae-40c4-a074-113a8207c4b2
    type: regular
    task:
      id: 2a94e246-6cae-40c4-a074-113a8207c4b2
      version: -1
      name: Tag Domain Indicators
      description: commands.local.cmd.new.indicator
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      retry-count:
        simple: "3"
      retry-interval:
        simple: "2"
      tags:
        simple: CVE-2025-59287
      type:
        simple: File
      value:
        complex:
          root: ExtractedIndicators.Domain
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: ExtractedIndicators.Domain
                iscontext: true
          transformers:
          - operator: uniq
      verdict:
        simple: Malicious
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4605,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "68":
    id: "68"
    taskid: 610fa080-9091-4c33-86f3-22df5edd1693
    type: title
    task:
      id: 610fa080-9091-4c33-86f3-22df5edd1693
      version: -1
      name: Threat Hunting
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "109"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3460,
          "y": 3490
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "72":
    id: "72"
    taskid: 25e3703f-fe94-417f-b109-afe8360a6ae0
    type: condition
    task:
      id: 25e3703f-fe94-417f-b109-afe8360a6ae0
      version: -1
      name: Are there any WSUS hosts?
      description: This task checks if any SharePoint hosts are found.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "68"
      "yes":
      - "135"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: agentsidstocheck
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201,
          "y": 1814
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "74":
    id: "74"
    taskid: 50c2af65-3e80-4c04-bcfd-27cdb71d5747
    type: regular
    task:
      id: 50c2af65-3e80-4c04-bcfd-27cdb71d5747
      version: -1
      name: XQL Query - Search possible malicious command lines
      description: Execute an XQL query to retrieve possible executed malicious command lines on WSUS servers.
      script: '|||xdr-xql-generic-query'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#error#':
      - "79"
      '#none#':
      - "138"
    scriptarguments:
      extend-context:
        simple: XQLPossibleMaliciousCmd=
      ignore-outputs:
        simple: "true"
      max_fields:
        simple: "100"
      query:
        simple: "dataset = xdr_data\n| filter agent_id in (${agentsidstocheck})\n| filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START\n| filter (lowercase(actor_process_image_name) in (\"wsusservice.exe\",\"w3wp.exe\") and (lowercase(actor_process_image_name) = \"w3wp.exe\" and lowercase(actor_process_command_line) contains \"wsuspool\") or (lowercase(actor_process_image_name) = \"wsusservice.exe\")\nand lowercase(action_process_image_name) in (\"cmd.exe\",\"powershell.exe\"))\nor (causality_actor_process_image_name = \"w3wp.exe\" and causality_actor_process_command_line contains \"wsuspool\" and actor_process_image_name in (\"cmd.exe\",\"powershell.exe\") and lowercase(action_process_image_name) in (\"cmd.exe\",\"powershell.exe\")) \n| fields _time, agent_hostname, agent_id, actor_process_image_name, actor_process_command_line,\n         action_process_image_name, action_process_image_command_line\n| dedup actor_process_command_line, action_process_image_command_line"
      query_name:
        simple: Check for possibles malicious command lines
      time_frame:
        simple: 7 days ago
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": 4201.5,
          "y": 2285
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "75":
    id: "75"
    taskid: 91a0d16b-b0b9-4982-8072-b5ae13b75e29
    type: condition
    task:
      id: 91a0d16b-b0b9-4982-8072-b5ae13b75e29
      version: -1
      name: Is the integration of 'XQL Query Engine' available?
      description: Returns 'yes' if integration brand 'XQL Query Engine' is available. Otherwise returns 'no'.
      scriptName: IsIntegrationAvailable
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "79"
      "yes":
      - "74"
    scriptarguments:
      brandname:
        simple: XQL Query Engine
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201.5,
          "y": 2129
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "79":
    id: "79"
    taskid: 21cab094-9f66-4393-96d4-0e420ade8d9d
    type: regular
    task:
      id: 21cab094-9f66-4393-96d4-0e420ade8d9d
      version: -1
      name: Manual – Search web shells using XQL query and quarantine the files
      description: "Dear Analyst,\n\nEnsure that the 'XQL Query Engine' integration is active. If it's not enabled, activate the integration or manually run the following XQL query to retrieve possible executed malicious command lines on WSUS servers.\n\nYou can use the following XQL query:\n\n**Query:**\nExecute an XQL query to retrieve possible executed malicious command lines on WSUS servers.\n\n```\ndataset = xdr_data\n| filter agent_id in (${agentsidstocheck})\n| filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START\n| filter (lowercase(actor_process_image_name) in (\"wsusservice.exe\",\"w3wp.exe\") and (lowercase(actor_process_image_name) = \"w3wp.exe\" and lowercase(actor_process_command_line) contains \"wsuspool\") or (lowercase(actor_process_image_name) = \"wsusservice.exe\")\nand lowercase(action_process_image_name) in (\"cmd.exe\",\"powershell.exe\"))\nor (causality_actor_process_image_name = \"w3wp.exe\" and causality_actor_process_command_line contains \"wsuspool\" and actor_process_image_name in (\"cmd.exe\",\"powershell.exe\") and lowercase(action_process_image_name) in (\"cmd.exe\",\"powershell.exe\")) \n| fields _time, agent_hostname, actor_process_image_name, actor_process_command_line,\n         action_process_image_name, action_process_image_command_line\n| dedup actor_process_command_line, action_process_image_command_line\n```"
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "68"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3799.25,
          "y": 2530
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "84":
    id: "84"
    taskid: 32e22bed-33c2-436a-907b-10f9063ff57e
    type: playbook
    task:
      id: 32e22bed-33c2-436a-907b-10f9063ff57e
      version: -1
      name: Containment Plan - Block Indicators
      description: |-
        ## Containment Plan - Block Indicators

        This playbook is a sub-playbook within the containment plan playbook.

        ### Indicator Blocking

        The playbook block indicators by two methods:

        1. It adds the malicious hashes into the XSIAM hash block list
        2. It utilizes the sub-playbook "Block Indicators - Generic v3"
      playbookName: Containment Plan - Block Indicators
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      AutoBlockIndicators:
        simple: "True"
      AutoContainment:
        simple: "True"
      BlockIndicators:
        simple: "True"
      Domain:
        complex:
          root: DBotScore
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: domain
              ignorecase: true
          - - operator: greaterThanOrEqual
              left:
                value:
                  simple: DBotScore.Score
                iscontext: true
              right:
                value:
                  simple: "2"
          accessor: Indicator
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.Domain
                iscontext: true
          - operator: uniq
      IP:
        complex:
          root: DBotScore
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: ip
              ignorecase: true
          - - operator: greaterThanOrEqual
              left:
                value:
                  simple: DBotScore.Score
                iscontext: true
              right:
                value:
                  simple: "2"
          accessor: Indicator
          transformers:
          - operator: uniq
      URL:
        complex:
          root: DBotScore
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: DBotScore.Type
                iscontext: true
              right:
                value:
                  simple: url
              ignorecase: true
          - - operator: greaterThanOrEqual
              left:
                value:
                  simple: DBotScore.Score
                iscontext: true
              right:
                value:
                  simple: "2"
          accessor: Indicator
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: ExtractedIndicators.URL
                iscontext: true
          - operator: uniq
      UserVerification:
        simple: "False"
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 3160,
          "y": 4484
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "87":
    id: "87"
    taskid: fdde0488-113f-4681-8484-87a8b9069f3c
    type: regular
    task:
      id: fdde0488-113f-4681-8484-87a8b9069f3c
      version: -1
      name: Mitigation Actions
      description: "## Suggested Mitigation Steps\n\n### Patch Recommendations For Microsoft SharePoint: \n\n**Apply Patches Immediately**\n\nNote: If any vulnerable servers are found, it is recommended to isolate them until patching is complete.\n\n  * [CVE-2025-59287](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-59287)\n\n\n### Workarounds\nThe following workarounds might be helpful in your situation. In all cases, Microsoft strongly recommends that you install the updates for this vulnerability as soon as possible even if you plan to leave either of these workarounds in place:\n\nIf you are unable to install the October 23, 2025 out-of-band update, you can take any of the following actions to be protected against this vulnerability:\n\nIf the WSUS Server Role is enabled on your server, disable it. Note that clients will no longer receive updates from the server if WSUS is disabled.\nBlock inbound traffic to Ports 8530 and 8531 on the host firewall (as opposed to blocking only at the network/perimeter firewall) to render WSUS non-operational.\n\nImportant: Do NOT undo either of these workarounds until after you have installed the update."
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "38"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3263.75,
          "y": 5614
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "92":
    id: "92"
    taskid: b197684d-576a-49cd-be0f-d532e4e8ba65
    type: regular
    task:
      id: b197684d-576a-49cd-be0f-d532e4e8ba65
      version: -1
      name: Set agent IDs to alert context
      description: commands.local.cmd.set.incident
      script: Builtin|||setAlert
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      agentsid:
        simple: ${PossibleWSUSServers.results.agent_id}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2960,
          "y": 190
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "94":
    id: "94"
    taskid: bbb85635-7aaf-464a-9d33-3cb41b40ebfc
    type: regular
    task:
      id: bbb85635-7aaf-464a-9d33-3cb41b40ebfc
      version: -1
      name: Set parsed malicious command lines
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "161"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: MaliciousCommandLinesDetected
      value:
        complex:
          root: CommandLineAnalysis
          filters:
          - - operator: greaterThan
              left:
                value:
                  simple: CommandLineAnalysis.score
                iscontext: true
              right:
                value:
                  simple: "50"
            - operator: containsGeneral
              left:
                value:
                  simple: CommandLineAnalysis.analysis.original.indicators.URL
                iscontext: true
              right:
                value:
                  simple: ExtractedIndicators.URL
                iscontext: true
              ignorecase: true
          accessor: parsed_command
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201.5,
          "y": 3000
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "99":
    id: "99"
    taskid: b78ef3cc-1814-4e4c-9091-4f9a5cb603d2
    type: condition
    task:
      id: b78ef3cc-1814-4e4c-9091-4f9a5cb603d2
      version: -1
      name: Any results from threat hunting?
      description: Any results from Threat Hunting?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "38"
      "yes":
      - "102"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: containsGeneral
          left:
            value:
              simple: IOCFound
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
        - operator: isNotEmpty
          left:
            value:
              simple: DBotScore.Indicator
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3684.5,
          "y": 5614
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "102":
    id: "102"
    taskid: 1f0113b3-cd3f-402c-9bc3-283bfb4338ed
    type: regular
    task:
      id: 1f0113b3-cd3f-402c-9bc3-283bfb4338ed
      version: -1
      name: Review Threat Hunting Results
      description: |-
        ${IOCFound(val)="As part of our IOC hunting, we've identified results that need your attention: The results can be found in the Context under  HuntIOCs.Results  key or check the results of the task - "XQL Query - IOCs Hunt""}

        ${DBotScore(val.Indicator).Indicator=>"The following indicators were found in the command lines:\n - "+val.filter((v,i,a)=>a.indexOf(v)==i).join("\n - ")+"\n\nPlease Investigate"}
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "38"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3913,
          "y": 5770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "103":
    id: "103"
    taskid: 063ba2e5-71ee-46cf-ae8f-762eeb10e569
    type: collection
    task:
      id: 063ba2e5-71ee-46cf-ae8f-762eeb10e569
      version: -1
      name: Any results from the manual XQL?
      description: Enter the retrieved agent IDs from the XQL query.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "104"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3720,
          "y": 170
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body: {}
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
      replyOptions:
      - "Yes"
      - "No"
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: Provide the agent IDs for those machines. If you have multiple endpoints, enter them as comma-separated values.
        required: false
        gridcolumns: []
        defaultrows: []
        type: shortText
        options: []
        optionsarg:
        - simple: "Yes"
        - simple: "No"
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      title: Have you found any WSUS servers that might be vulnerable?
      description: ""
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "104":
    id: "104"
    taskid: c98f603c-12b0-4e3e-9118-6a714b2adce7
    type: regular
    task:
      id: c98f603c-12b0-4e3e-9118-6a714b2adce7
      version: -1
      name: Set Agent IDs to Alert Context
      description: commands.local.cmd.set.incident
      script: Builtin|||setAlert
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      agentsid:
        complex:
          root: Have you found any WSUS servers that might be vulnerable?.Answers
          accessor: "0"
          transformers:
          - operator: split
            args:
              delimiter:
                value:
                  simple: ','
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3720,
          "y": 321
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "108":
    id: "108"
    taskid: 20a350b7-28b1-4190-86e0-890f3c6b1f12
    type: regular
    task:
      id: 20a350b7-28b1-4190-86e0-890f3c6b1f12
      version: -1
      name: XQL Query - IOCs Hunt
      description: Execute an XQL query to detect any usage of the specified malicious indicators.
      script: '|||xdr-xql-generic-query'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#error#':
      - "121"
      '#none#':
      - "110"
    scriptarguments:
      extend-context:
        simple: HuntIOCs=
      ignore-outputs:
        simple: "true"
      max_fields:
        simple: "100"
      query:
        simple: "datamodel dataset=* \n| filter (xdm.network.http.url  in (${ExtractedIndicators.URL=>'\"'+val.join('\",\"')+'\"'}) \nor xdm.target.url in (${ExtractedIndicators.URL=>'\"'+val.join('\",\"')+'\"'}))\n| fields fieldset.xdm_core, xdm.source.host.ipv4_addresses, xdm.target.host.ipv4_addresses, agent_id, agent_hostname"
      query_name:
        simple: IOCs search
      time_frame:
        simple: 1 week ago
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": 3460,
          "y": 3800
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "109":
    id: "109"
    taskid: 35355acb-10e6-417e-8d1f-92b073b5e9e1
    type: condition
    task:
      id: 35355acb-10e6-417e-8d1f-92b073b5e9e1
      version: -1
      name: Is the integration of 'XQL Query Engine' available?
      description: Returns 'yes' if integration brand 'XQL Query Engine' is available. Otherwise returns 'no'.
      scriptName: IsIntegrationAvailable
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "121"
      "yes":
      - "108"
    scriptarguments:
      brandname:
        simple: XQL Query Engine
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3460,
          "y": 3621
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "110":
    id: "110"
    taskid: 07a1ddb4-c0c8-4e51-adc0-282fcdadc664
    type: condition
    task:
      id: 07a1ddb4-c0c8-4e51-adc0-282fcdadc664
      version: -1
      name: Any results from XQL?
      description: ' Checks if Threat Hunting found threats.'
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "28"
      "yes":
      - "113"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: HuntIOCs.results
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3460,
          "y": 3980
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "113":
    id: "113"
    taskid: 44730f4a-62a7-4e74-bdbf-35ee1a3c844e
    type: regular
    task:
      id: 44730f4a-62a7-4e74-bdbf-35ee1a3c844e
      version: -1
      name: Set Context key on Found IOCs
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "28"
    scriptarguments:
      key:
        simple: IOCFound
      value:
        simple: "True"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3150,
          "y": 4170
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "121":
    id: "121"
    taskid: ec6c9524-3359-4324-8155-bd122b7ebb64
    type: regular
    task:
      id: ec6c9524-3359-4324-8155-bd122b7ebb64
      version: -1
      name: Manual – Search For IOCs
      description: "Dear Analyst,\n\nEnsure that the 'XQL Query Engine' integration is active. If it's not enabled, activate the integration or manually run the following XQL query to determine if any IOCs are found within your environment. Otherwise, you can go ahead and search manually for the following indicators:\n\n#### List of URLs:\n${ExtractedIndicators.URL=>val.join(',')}\n\n#### List of Domains:\n${ExtractedIndicators.Domain=>val.join(',')}\n\n\n**XQL Query:**\nSearches for URL indicators.\n```\ndatamodel dataset=* \n| filter (xdm.network.http.url  in (${ExtractedIndicators.URL=>'\"'+val.join('\",\"')+'\"'}) \nor xdm.target.url in (${ExtractedIndicators.URL=>'\"'+val.join('\",\"')+'\"'}))\n| fields fieldset.xdm_core, xdm.source.host.ipv4_addresses, xdm.target.host.ipv4_addresses, agent_id, agent_hostname\n```\n"
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "28"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3913,
          "y": 3980
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "124":
    id: "124"
    taskid: 40983574-9711-40bb-adb1-ad2d0ebf0c69
    type: regular
    task:
      id: 40983574-9711-40bb-adb1-ad2d0ebf0c69
      version: -1
      name: Collect Indicators from Unit42 Blog
      description: This script extracts indicators from HTML and handles bad TLDs to avoid file extension false positives.
      scriptName: ParseHTMLIndicators
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "25"
    scriptarguments:
      unescape_domain:
        simple: "False"
      url:
        simple: https://unit42.paloaltonetworks.com/microsoft-cve-2025-59287/
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201.5,
          "y": 609
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "133":
    id: "133"
    taskid: 89a8fb10-2f09-4dbd-9dd2-99212bfda609
    type: regular
    task:
      id: 89a8fb10-2f09-4dbd-9dd2-99212bfda609
      version: -1
      name: Set Potential Agent IDs to search on
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "72"
    scriptarguments:
      key:
        simple: agentsidstocheck
      value:
        complex:
          root: alert
          accessor: agentid
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: alert.agentsid
                iscontext: true
          - operator: RemoveEmpty
            args:
              empty_values: {}
              remove_keys:
                value:
                  simple: "true"
          - operator: join
            args:
              separator:
                value:
                  simple: '","'
          - operator: concat
            args:
              prefix:
                value:
                  simple: '"'
              suffix:
                value:
                  simple: '"'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201,
          "y": 1643
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "134":
    id: "134"
    taskid: 9aba8ad7-c0d2-40fd-abe0-8eacff8aaef6
    type: regular
    task:
      id: 9aba8ad7-c0d2-40fd-abe0-8eacff8aaef6
      version: -1
      name: Command Line Analysis
      description: |-
        This script evaluates command-line threats by analyzing both original and decoded inputs. It assigns weighted scores to detected patterns, such as AMSI bypass or credential dumping, and applies risk combination bonuses for multiple detections. The total score is normalized to a 0-100 scale, with risk levels categorized as follows:

        * 0-25: Low Risk
        * 26-50: Medium Risk
        * 51-90: High Risk
        * 91-100: Critical Risk

        The scoring mechanism provides a comprehensive risk assessment, considering both the severity and frequency of malicious behaviors.
      scriptName: CommandLineAnalysis
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "145"
    scriptarguments:
      command_line:
        complex:
          root: XQLPossibleMaliciousCmd.results
          accessor: action_process_image_command_line
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: XQLPossibleMaliciousCmd.results.actor_process_command_line
                iscontext: true
          - operator: RemoveEmpty
            args:
              empty_values: {}
              remove_keys:
                value:
                  simple: "true"
          - operator: uniq
    reputationcalc: 2
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201.5,
          "y": 2690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "135":
    id: "135"
    taskid: 67eb0acb-0665-4f3f-b116-9aecbbb0f786
    type: title
    task:
      id: 67eb0acb-0665-4f3f-b116-9aecbbb0f786
      version: -1
      name: Investigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "75"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201.5,
          "y": 1980
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "138":
    id: "138"
    taskid: d4f54519-dd0c-4933-8e13-cca96dfd00d9
    type: condition
    task:
      id: d4f54519-dd0c-4933-8e13-cca96dfd00d9
      version: -1
      name: Found any suspicious command lines?
      description: Checks if any suspicious command lines were found.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "68"
      "yes":
      - "134"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: XQLPossibleMaliciousCmd.results.actor_process_command_line
            iscontext: true
          right:
            value: {}
        - operator: isNotEmpty
          left:
            value:
              simple: XQLPossibleMaliciousCmd.results.action_process_image_command_line
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201.5,
          "y": 2530
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "145":
    id: "145"
    taskid: 370f8e04-843b-48a1-aed4-ee5191f060ec
    type: condition
    task:
      id: 370f8e04-843b-48a1-aed4-ee5191f060ec
      version: -1
      name: Found any malicious command lines?
      description: Checks if any malicious command lines were found.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "68"
      "yes":
      - "94"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: containsGeneral
          left:
            value:
              simple: CommandLineAnalysis.analysis.original.indicators.URL
            iscontext: true
          right:
            value:
              simple: ExtractedIndicators.URL
            iscontext: true
        - operator: greaterThan
          left:
            value:
              simple: CommandLineAnalysis.score
            iscontext: true
          right:
            value:
              simple: "50"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201.5,
          "y": 2840
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "150":
    id: "150"
    taskid: f1ee8fa4-f58a-4f07-bd19-5652b795f605
    type: condition
    task:
      id: f1ee8fa4-f58a-4f07-bd19-5652b795f605
      version: -1
      name: ' Are there any suspicious findings?'
      description: Check if there are any suspicious findings collected during the investigation
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "31"
      "yes":
      - "151"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: CompromisedHostDetected
            iscontext: true
          right:
            value: {}
        - operator: isEqualString
          left:
            value:
              simple: alert.name
            iscontext: true
          right:
            value:
              simple: CVE Exploitation - 2037164431
        - operator: isEqualString
          left:
            value:
              simple: alert.name
            iscontext: true
          right:
            value:
              simple: CVE Exploitation - 3823999562
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3743.5,
          "y": 4484
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "151":
    id: "151"
    taskid: b94dd77f-ec03-4e68-80d6-0518e23cac09
    type: collection
    task:
      id: b94dd77f-ec03-4e68-80d6-0518e23cac09
      version: -1
      name: Analyst approval required for isolation
      description: |-
        As part of the playbook, we have identified possible malicious activity related to the vulnerability CVE-2025-59287. Therefore, we strongly suggest reviewing the finding:

        ### Malicious command lines
        The list below (if there are any findings, otherwise this section remains empty):

        ```${MaliciousCommandLinesDetected(val.length > 0) =>"- " + val.join("\n - ")}```

        **Recommended action: Isolate vulnerable servers until patching is complete.**
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "157"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3950,
          "y": 4660
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: 'Select hosts to isolate from the following agent IDs:'
        required: true
        gridcolumns: []
        defaultrows: []
        type: multiSelect
        options: []
        optionsarg:
        - {}
        - complex:
            root: CompromisedHostDetected
            transformers:
            - operator: AppendIfNotEmpty
              args:
                item:
                  value:
                    simple: alert.agentid
                  iscontext: true
                raw: {}
            - operator: uniq
        - simple: No Action
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      title: Hosts to isolate
      description: |-
        The following hosts were identified as WSUS servers that were exploited and compromised via vulnerability CVE-2025-59287.
        It is recommended to isolate them until patching is complete.
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "156":
    id: "156"
    taskid: e75d4622-e6c8-413c-a2ee-d69ee820b94f
    type: regular
    task:
      id: e75d4622-e6c8-413c-a2ee-d69ee820b94f
      version: -1
      name: Isolate Endpoint
      description: This script isolates endpoints using multiple integrations and returns a success or failure message.
      scriptName: isolate-endpoint
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "160"
    scriptarguments:
      brands:
        simple: Cortex Core - IR
      endpoint_id:
        simple: ${Hosts to isolate.Answers.0}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3950,
          "y": 5000
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "157":
    id: "157"
    taskid: 9f8f2c1d-7fd0-4895-b336-aa2a0a2d4021
    type: condition
    task:
      id: 9f8f2c1d-7fd0-4895-b336-aa2a0a2d4021
      version: -1
      name: Are there any hosts to isolate based on analyst approval?
      description: Check the analyst’s answer.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "31"
      "yes":
      - "156"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: notContainsGeneral
          left:
            value:
              simple: Hosts to isolate.Answers.0
            iscontext: true
          right:
            value:
              simple: No Action
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3950,
          "y": 4805
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "159":
    id: "159"
    taskid: 88d6ed51-6d3b-42b7-8791-18733c8ae0c5
    type: regular
    task:
      id: 88d6ed51-6d3b-42b7-8791-18733c8ae0c5
      version: -1
      name: Manual remediation actions for a server or a disconnected endpoint
      description: "Dear Analyst,\n\nPlease note that during the remediation process, the playbook didn't isolate the following host: ${alert.hostname} \n\nThis is due to one of the following reasons:\n- The device disconnected.\n\nPlease take manual action to contain the attack and prevent the attacker from executing lateral movement before closing this alert."
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "31"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4080,
          "y": 5306.66650390625
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "160":
    id: "160"
    taskid: f67a950e-7250-4472-bd7d-a7911bd8f79a
    type: condition
    task:
      id: f67a950e-7250-4472-bd7d-a7911bd8f79a
      version: -1
      name: Was the endpoint isolation successful?
      description: Verifies whether the endpoint isolation was successful.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "159"
      "yes":
      - "31"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: IsolateEndpoint.Result
            iscontext: true
          right:
            value:
              simple: Success
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3950,
          "y": 5150.66650390625
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "161":
    id: "161"
    taskid: e18176e2-1090-44d5-8854-13a6b6a5e10b
    type: regular
    task:
      id: e18176e2-1090-44d5-8854-13a6b6a5e10b
      version: -1
      name: Set original malicious command lines
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "162"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: MaliciousCommandLinesDetected
      value:
        complex:
          root: CommandLineAnalysis
          filters:
          - - operator: greaterThan
              left:
                value:
                  simple: CommandLineAnalysis.score
                iscontext: true
              right:
                value:
                  simple: "50"
            - operator: containsGeneral
              left:
                value:
                  simple: CommandLineAnalysis.analysis.original.indicators.URL
                iscontext: true
              right:
                value:
                  simple: ExtractedIndicators.URL
                iscontext: true
              ignorecase: true
          accessor: original_command
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201.5,
          "y": 3160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "162":
    id: "162"
    taskid: 1e263f7b-58f2-40f5-96b7-997cef12940c
    type: regular
    task:
      id: 1e263f7b-58f2-40f5-96b7-997cef12940c
      version: -1
      name: Set compromised WSUS servers
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "68"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: CompromisedHostDetected
      value:
        complex:
          root: XQLPossibleMaliciousCmd.results
          filters:
          - - operator: containsGeneral
              left:
                value:
                  simple: XQLPossibleMaliciousCmd.results.actor_process_command_line
                iscontext: true
              right:
                value:
                  simple: MaliciousCommandLinesDetected
                iscontext: true
              ignorecase: true
            - operator: containsGeneral
              left:
                value:
                  simple: XQLPossibleMaliciousCmd.results.action_process_image_command_line
                iscontext: true
              right:
                value:
                  simple: MaliciousCommandLinesDetected
                iscontext: true
          accessor: agent_id
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: alert.agentid
                iscontext: true
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 4201.5,
          "y": 3325
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "108_121_#error#": 0.4,
      "109_108_yes": 0.36,
      "109_121_#default#": 0.42,
      "110_113_yes": 0.5,
      "110_28_#default#": 0.13,
      "138_134_yes": 0.44,
      "138_68_#default#": 0.44,
      "145_68_#default#": 0.46,
      "150_31_#default#": 0.18,
      "157_31_#default#": 0.42,
      "160_31_yes": 0.3,
      "1_2_#error#": 0.48,
      "26_7_#default#": 0.36,
      "4_9_#default#": 0.12,
      "72_68_#default#": 0.38,
      "74_79_#error#": 0.31,
      "75_74_yes": 0.36,
      "75_79_#default#": 0.45,
      "99_38_#default#": 0.3
    },
    "paper": {
      "dimensions": {
        "height": 7155,
        "width": 2025,
        "x": 2960,
        "y": -707
      }
    }
  }
inputs: []
inputSections:
- inputs: []
  name: General (Inputs group)
  description: Generic group for inputs
outputSections:
- outputs: []
  name: General (Outputs group)
  description: Generic group for outputs
outputs: []
fromversion: 8.9.0
tests:
- No tests (auto formatted)
