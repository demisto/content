id: silent-Rundll32.exe executes a rare unsigned module
version: -1
name: silent-Rundll32.exe executes a rare unsigned module
description: "This playbook handles the \"Rundll32.exe executes a rare unsigned module\" alerts.\n\nThe playbook executes the following stages:\n\nData retrieval:\n- Retrieve the alert extra data.\n- Calculate the host risk score\n- Extract the extension of the loaded DLL.\n- Calculate the similarity between the CGO process signer and the loaded DLL's company attribute.\n\nInvestigation:\n- Check the DLL reputation.\n- Check the similarity between the CGO process signer and the loaded DLL's company attribute.\n- Check for uncommon DLL extensions.\n- Check for uncommon causality chain executions.\n- Search for related XDR agent alerts to determine if any suspicious behavior occurred as part of the causality chain and the related case ID.\n\nRemediation actions will be taken if:\n- The loaded DLL is malicious.\n- The DLL is loaded from an uncommon causality chain.\n- The DLL extension is uncommon, or the DLL's SHA256 is suspicious, and the host risk score is Medium.\n- The host risk score is High (and the similarity check is less than 0.6).\n\n\nRemediation actions:\n- Terminate the causality chain. \n- Quarantine suspicious or malicious DLLs, if any.\n\nThe playbook requires enrichment integrations for checking the DLL's SHA256 reputation.\n"
starttaskid: "0"
issilent: true
tasks:
  "0":
    id: "0"
    taskid: 0c35cb74-1ba5-439a-8a92-6e50e47d6db3
    type: start
    task:
      id: 0c35cb74-1ba5-439a-8a92-6e50e47d6db3
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "3"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 447,
          "y": -374
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: 29abeced-ecbd-44fd-8631-0dc8ba63131a
    type: regular
    task:
      id: 29abeced-ecbd-44fd-8631-0dc8ba63131a
      version: -1
      name: Get Host Risk score
      description: Retrieve the risk score of a specific host or list of hosts with the highest risk score in the environment along with the reason affecting each score.
      script: '|||core-list-risky-hosts'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      host_id:
        simple: ${alert.hostname}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 242,
          "y": -94
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: ee25c065-a0d8-4995-8075-f1550bf6211b
    type: regular
    task:
      id: ee25c065-a0d8-4995-8075-f1550bf6211b
      version: -1
      name: Get the alert's extra data
      description: Returns extended information about each alert ID.
      script: '|||core-get-cloud-original-alerts'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "1"
      - "36"
      - "5"
      - "44"
    scriptarguments:
      alert_ids:
        simple: ${alert.id}
      filter_alert_fields:
        simple: "false"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 447,
          "y": -259
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: 1c46d2e6-7d93-45d8-b5bb-9d1eba958884
    type: condition
    task:
      id: 1c46d2e6-7d93-45d8-b5bb-9d1eba958884
      version: -1
      name: Is the loaded DLL malicious?
      description: Check if the loaded DLL is malicious
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      Remediation:
      - "39"
    separatecontext: false
    conditions:
    - label: Remediation
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: DBotScore
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: DBotScore.Indicator
                      iscontext: true
                    right:
                      value:
                        simple: Core.OriginalAlert.event.action_module_sha256
                      iscontext: true
                    ignorecase: true
                accessor: Score
            iscontext: true
          right:
            value: {}
          ignorecase: true
      - - operator: isEqualNumber
          left:
            value:
              complex:
                root: DBotScore
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: DBotScore.Indicator
                      iscontext: true
                    right:
                      value:
                        simple: Core.OriginalAlert.event.action_module_sha256
                      iscontext: true
                    ignorecase: true
                accessor: Score
            iscontext: true
          right:
            value:
              simple: "3"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 178
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: e32222a7-4f51-478f-8ce1-6bfe6b05f965
    type: regular
    task:
      id: e32222a7-4f51-478f-8ce1-6bfe6b05f965
      version: -1
      name: Check the CGO signer and DLL company similarity
      description: Check the similarity between the CGO process signer and the loaded DLL's company attribute.
      scriptName: StringSimilarity
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      string_A:
        complex:
          root: Core.OriginalAlert.event.action_module_file_info
          accessor: company
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: 'Core.OriginalAlert.event.action_module_file_info.company is empty'
      string_B:
        complex:
          root: alert
          accessor: cgosigner
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: alert.cgosigner is empty
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 651,
          "y": -94
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: 34fb2063-1610-480c-8ad3-7025287f810a
    type: title
    task:
      id: 34fb2063-1610-480c-8ad3-7025287f810a
      version: -1
      name: Analysis
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "4"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 51
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: 373f2e44-32d1-4abb-810a-b26abb49378c
    type: condition
    task:
      id: 373f2e44-32d1-4abb-810a-b26abb49378c
      version: -1
      name: Is the Host Risk High?
      description: Checks if the host risk score is set to High.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "12"
      Remediation:
      - "37"
    separatecontext: false
    conditions:
    - label: Remediation
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: Core.RiskyHost.risk_level
            iscontext: true
          right:
            value:
              simple: High
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 864,
          "y": 568
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: 209d2b10-d746-48fa-8522-55dcd3308b5b
    type: condition
    task:
      id: 209d2b10-d746-48fa-8522-55dcd3308b5b
      version: -1
      name: Is CGO uncommon in this alert?
      description: "Checks if the causality chain is unusual for this alert. If the CGO name matches one on the list, the alert will be marked as a true positive (TP)."
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "38"
      Remediation:
      - "39"
    separatecontext: false
    conditions:
    - label: Remediation
      condition:
      - - operator: containsGeneral
          left:
            value:
              simple: alert.cgoname
            iscontext: true
          right:
            value:
              simple: cmd.exe
          ignorecase: true
        - operator: containsGeneral
          left:
            value:
              simple: alert.cgoname
            iscontext: true
          right:
            value:
              simple: powershell.exe
          ignorecase: true
        - operator: containsGeneral
          left:
            value:
              simple: alert.cgoname
            iscontext: true
          right:
            value:
              simple: mshta.exe
          ignorecase: true
        - operator: containsGeneral
          left:
            value:
              simple: alert.cgoname
            iscontext: true
          right:
            value:
              simple: sppsvc.exe
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 683,
          "y": 314
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: 4712cc6c-d28c-482f-8a0f-7506a80c0f22
    type: title
    task:
      id: 4712cc6c-d28c-482f-8a0f-7506a80c0f22
      version: -1
      name: Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "23"
      - "24"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1323
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: 43b20acc-d5bc-4889-8efa-83242bd23521
    type: title
    task:
      id: 43b20acc-d5bc-4889-8efa-83242bd23521
      version: -1
      name: Investigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "34"
      - "41"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1368,
          "y": 701
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 21ae1e28-6c5c-4109-809a-515828336e63
    type: condition
    task:
      id: 21ae1e28-6c5c-4109-809a-515828336e63
      version: -1
      name: Any related alerts?
      description: |-
        Check if there are any related alerts associated with this alert.
        The remediation phase will be taken in one of the following scenarios:
        - If there are any related alerts with Low, Medium, or High severity.
        - If the host risk score is set to Medium, and there are any insights.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "17"
      Alerts:
      - "39"
      Insights:
      - "11"
    separatecontext: false
    conditions:
    - label: Insights
      condition:
      - - operator: containsGeneral
          left:
            value:
              simple: Core.RiskyHost.risk_level
            iscontext: true
          right:
            value:
              simple: med
          ignorecase: true
      - - operator: isEqualString
          left:
            value:
              simple: foundIncidents.severity
            iscontext: true
          right:
            value:
              simple: Informational
          ignorecase: true
    - label: Alerts
      condition:
      - - operator: in
          left:
            value:
              simple: foundIncidents.severity
            iscontext: true
          right:
            value:
              simple: low,medium,high,critical
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1368,
          "y": 1065
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: 3289a3ea-47de-46ef-8b7f-9ccfe76bccb3
    type: title
    task:
      id: 3289a3ea-47de-46ef-8b7f-9ccfe76bccb3
      version: -1
      name: No malicious activity detected
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "40"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1032,
          "y": 1455
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: 9d451f1b-365b-4876-8ed0-c3babf1f3ff2
    type: regular
    task:
      id: 9d451f1b-365b-4876-8ed0-c3babf1f3ff2
      version: -1
      name: Close Alert - True Positive
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      closeNotes:
        simple: Resolved as True Positive - Handled by the playbook "Rundll32.exe executes a rare unsigned module"
      closeReason:
        simple: Resolved - True Positive
      id:
        simple: ${alert.id}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2509
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: 72145999-b2ed-457e-857b-9f44c978d2b6
    type: title
    task:
      id: 72145999-b2ed-457e-857b-9f44c978d2b6
      version: -1
      name: Finish Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "19"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2383
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: 52d61208-6af7-4566-971a-dd3c1c8cbb07
    type: condition
    task:
      id: 52d61208-6af7-4566-971a-dd3c1c8cbb07
      version: -1
      name: Check if the DLL is suspicious
      description: Check if the DLL is suspicious
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "20"
      "yes":
      - "22"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: DBotScore
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: DBotScore.Indicator
                      iscontext: true
                    right:
                      value:
                        simple: Core.OriginalAlert.event.action_module_sha256
                      iscontext: true
                    ignorecase: true
                accessor: Score
            iscontext: true
          right:
            value: {}
          ignorecase: true
      - - operator: greaterThanOrEqual
          left:
            value:
              complex:
                root: DBotScore
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: DBotScore.Indicator
                      iscontext: true
                    right:
                      value:
                        simple: Core.OriginalAlert.event.action_module_sha256
                      iscontext: true
                    ignorecase: true
                accessor: Score
            iscontext: true
          right:
            value:
              simple: "2"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -75,
          "y": 1573
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: 2d16efb4-48ef-4206-8bb1-38bb063b22b8
    type: regular
    task:
      id: 2d16efb4-48ef-4206-8bb1-38bb063b22b8
      version: -1
      name: Check tf the DLL file is quarantined
      description: Retrieves the quarantine status for a selected file.
      script: '|||core-get-quarantine-status'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "28"
    scriptarguments:
      endpoint_id:
        simple: ${alert.agentid}
      file_hash:
        simple: ${Core.OriginalAlert.event.action_module_sha256}
      file_path:
        simple: ${Core.OriginalAlert.event.action_module_path}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -327,
          "y": 1709
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: b8923032-bedb-4487-827c-2f8037b6a1c8
    type: title
    task:
      id: b8923032-bedb-4487-827c-2f8037b6a1c8
      version: -1
      name: Terminate CGO
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "32"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1455
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: ba70eb43-59be-4dbc-8e6e-a665f57f8dda
    type: title
    task:
      id: ba70eb43-59be-4dbc-8e6e-a665f57f8dda
      version: -1
      name: Quarentine DLL
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "21"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -75,
          "y": 1455
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: bdef93fd-336e-405f-815f-07b074d5acb6
    type: condition
    task:
      id: bdef93fd-336e-405f-815f-07b074d5acb6
      version: -1
      name: Should quarantine the file?
      description: Determines whether to quarantine the files based on their quarantine status.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "20"
      "yes":
      - "29"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Core.quarantineFiles.status
                accessor: status
            iscontext: true
          right:
            value:
              simple: "false"
          ignorecase: true
      - - operator: isNotEmpty
          left:
            value:
              simple: Core.OriginalAlert.event.action_module_path
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -327,
          "y": 1877
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: bed33a42-b382-430d-82ee-285ef7b24e3f
    type: regular
    task:
      id: bed33a42-b382-430d-82ee-285ef7b24e3f
      version: -1
      name: File quarantine
      description: Quarantines a file on selected endpoints.
      script: '|||core-quarantine-files'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#error#':
      - "30"
      '#none#':
      - "20"
    scriptarguments:
      endpoint_id_list:
        simple: ${alert.agentid}
      file_hash:
        simple: ${Core.OriginalAlert.event.action_module_sha256}
      file_path:
        simple: ${Core.OriginalAlert.event.action_module_path}
      incident_id:
        complex:
          root: alert
          accessor: parentXDRIncident
          transformers:
          - operator: Cut
            args:
              delimiter:
                value:
                  simple: '-'
              fields:
                value:
                  simple: "2"
      interval_in_seconds:
        simple: "20"
      timeout_in_seconds:
        simple: "120"
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": -327,
          "y": 2062
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: a50a91df-e3b3-4305-8a0d-ae6e872b7e87
    type: regular
    task:
      id: a50a91df-e3b3-4305-8a0d-ae6e872b7e87
      version: -1
      name: Manual action needed â€“ DLL file couldn't be quarantined
      description: |-
        Dear Analyst,

        The playbook was unable to quarantine the loadded DLL file due to the following possible reasons:

        - The DLL file is not located on the local host.
        - The endpoint is currently disconnected.
        - The DLL is loaded and can't be quarantined while running.


        Please take manual action to terminate the causality process if needed and quarantine the DLL file.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -650,
          "y": 2200
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: 81c6bf5c-bd5b-427d-855d-90b28f9b4b7d
    type: title
    task:
      id: 81c6bf5c-bd5b-427d-855d-90b28f9b4b7d
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2654
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: 76b9bddb-84bf-473d-8732-5792b081410d
    type: regular
    task:
      id: 76b9bddb-84bf-473d-8732-5792b081410d
      version: -1
      name: Terminate Causality (CGO)
      description: Terminate a process tree by its causality ID. Available only for Cortex XSIAM 2.4.
      script: '|||core-terminate-causality'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#error#':
      - "33"
      '#none#':
      - "20"
    scriptarguments:
      agent_id:
        simple: ${alert.agentid}
      causality_id:
        simple: ${alert.cid}
      incident_id:
        complex:
          root: alert
          accessor: parentXDRIncident
          transformers:
          - operator: Cut
            args:
              delimiter:
                value:
                  simple: '-'
              fields:
                value:
                  simple: "2"
      timeout_in_seconds:
        simple: "180"
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": 449,
          "y": 1573
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: 5e7a6d16-894e-4900-872e-81bfb670a331
    type: regular
    task:
      id: 5e7a6d16-894e-4900-872e-81bfb670a331
      version: -1
      name: Terminate Causality Process Manually
      description: |
        Dear Analyst,

        During the remediation process, the playbook failed to terminate the causality process: ${alert.cgoname}
        Please investigate this before closing this alert.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 207,
          "y": 1709
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: 46f92dd8-3ec0-42dc-8e5b-76014b18aa69
    type: regular
    task:
      id: 46f92dd8-3ec0-42dc-8e5b-76014b18aa69
      version: -1
      name: Search related alerts by causality chain
      description: |-
        This task uses the causality process chain to search for suspicious related alerts that may indicate a compromised endpoint.
        It searches for the following alerts:

        - Regsvr32 may have run code from an untrusted source
        - Process calls ActiveX Object with a shell command
        - Command-line arguments match Mimikatz execution
        - Unicode RTL Override Character
        - Screensaver process executed from Users or temporary folder by a scripting engine process
        - Unsigned and unpopular process performed a DLL injection
        - Unsigned and unpopular process performed queue APC injection
        - Unsigned and unpopular process performed an injection
        - Unsigned and unpopular process performed process hollowing injection
        - Unsigned and unpopular process performed a DLL injection to a commonly abused process
        - Unsigned and unpopular process performed injection into a commonly abused process
        - Uncommon Service Create/Config
        - Unsigned and unpopular process injected into a commonly abused process
        - Unsigned process injects code into a process
        - New service created via command line
        - PowerShell is used to execute a CPL file
        - Task scheduled by commonly abused host process
        - Unsigned process running from a temporary directory
        - Suspicious file created in AppData directory
      scriptName: SearchAlertsV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      fromdate:
        simple: 5 hours ago
      includeinformational:
        simple: "true"
      query:
        simple: "(\ncid:${alert.cid.[0]} or \nactorprocessinstanceid:${alert.cid.[0]} or \nactionprocessinstanceid:${alert.cid.[0]} or \nactorprocessinstanceid:${alert.actorprocessinstanceid.[0]} or \nactionprocessinstanceid:${alert.actorprocessinstanceid.[0]}\n)  \nAND \n(\nname:\"Regsvr32 may have run code from an untrusted source\" OR \nname:\"Process calls ActiveX Object with a shell command\" OR \nname:\"Command-line arguments match Mimikatz execution\" OR \nname:\"Unicode RTL Override Character\" OR\nname:\"Screensaver process executed from Users or temporary folder by a scripting engine process\" OR \nname:\"Unsigned and unpopular process performed a DLL injection\" OR \nname:\"Unsigned and unpopular process performed queue APC injection\" OR \nname:\"Unsigned and unpopular process performed an injection\" OR \nname:\"Unsigned and unpopular process performed process hollowing injection\" OR \nname:\"Unsigned and unpopular process performed a DLL injection to a commonly abused process\" OR \nname:\"Unsigned and unpopular process performed injection into a commonly abused process\" OR \nname:\"Uncommon Service Create/Config\" OR \nname:\"Unsigned and unpopular process injected into a commonly abused process\" OR \nname:\"Unsigned process injects code into a process\" OR \nname:\"New service created via command line\" OR \nname:\"PowerShell is used to execute a CPL file\" OR \nname:\"Task scheduled by commonly abused host process\" OR \nname:\"Unsigned process running from a temporary directory\" OR \nname:\"Suspicious file created in AppData directory\" \n)"
      todate:
        simple: now
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1184,
          "y": 914
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: 88b207cd-a053-4569-8080-377584506795
    type: regular
    task:
      id: 88b207cd-a053-4569-8080-377584506795
      version: -1
      name: Extract the DLL's extension
      description: Extract the DLL's extension.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: dll_extension
      value:
        complex:
          root: Core.OriginalAlert.event
          accessor: action_module_name
          transformers:
          - operator: RegexExtractAll
            args:
              error_if_no_match: {}
              ignore_case: {}
              multi_line: {}
              period_matches_newline: {}
              regex:
                value:
                  simple: \.(\w+)$
              unpack_matches: {}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1046,
          "y": -94
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: ae92ef82-5fc0-4985-8f58-00ea247377d4
    type: condition
    task:
      id: ae92ef82-5fc0-4985-8f58-00ea247377d4
      version: -1
      name: Check if the fuzzyhash is not similar
      description: Remove false positives if the CGO signer is similar to the company name in the DLL's attribute (excluding Microsoft Corporation).
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "11"
      False Positive:
      - "17"
    separatecontext: false
    conditions:
    - label: False Positive
      condition:
      - - operator: greaterThan
          left:
            value:
              simple: StringSimilarity.SimilarityScore
            iscontext: true
          right:
            value:
              simple: "0.6"
          ignorecase: true
      - - operator: notContainsGeneral
          left:
            value:
              simple: alert.cgosigner
            iscontext: true
          right:
            value:
              simple: Microsoft Corporation
          ignorecase: true
      - - operator: isNotEmpty
          left:
            value:
              simple: alert.cgosigner
            iscontext: true
      - - operator: isNotEmpty
          left:
            value:
              simple: Core.OriginalAlert.event.action_module_file_info.company
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 864,
          "y": 797
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: 9928334b-3f90-4972-842e-461db0b7bbf7
    type: condition
    task:
      id: 9928334b-3f90-4972-842e-461db0b7bbf7
      version: -1
      name: Suspicious DLL and medium-risk host?
      description: |-
        The following condition must be met:
        1. If the Host Risk score is Medium.

        And one of these below:
        2. The DLL extension is not a common one
        3. The DLL Reputation is Suspicious.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "9"
      Remediation:
      - "39"
    separatecontext: false
    conditions:
    - label: Remediation
      condition:
      - - operator: containsGeneral
          left:
            value:
              simple: Core.RiskyHost.risk_level
            iscontext: true
          right:
            value:
              simple: med
          ignorecase: true
      - - operator: notIn
          left:
            value:
              simple: dll_extension
            iscontext: true
          right:
            value:
              simple: cpl,exe,pkg,ax,tmp,dll
        - operator: isEqualNumber
          left:
            value:
              complex:
                root: DBotScore
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: DBotScore.Indicator
                      iscontext: true
                    right:
                      value:
                        simple: Core.OriginalAlert.event.action_module_sha256
                      iscontext: true
                    ignorecase: true
                accessor: Score
                transformers:
                - operator: SetIfEmpty
                  args:
                    applyIfEmpty: {}
                    defaultValue:
                      value:
                        simple: "-1"
            iscontext: true
          right:
            value:
              simple: "2"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 815,
          "y": 445
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: f8ef678e-ad8b-4c7f-801f-c47eef3b1b77
    type: title
    task:
      id: f8ef678e-ad8b-4c7f-801f-c47eef3b1b77
      version: -1
      name: Related Alerts
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "11"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1193
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: a04767b8-05ac-4433-880f-477d9a3402c9
    type: regular
    task:
      id: a04767b8-05ac-4433-880f-477d9a3402c9
      version: -1
      name: Close Alert - False Positive
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      closeNotes:
        simple: Resolved as false positive - handled by the playbook "Rundll32.exe executes a rare unsigned module"
      closeReason:
        simple: Resolved - False Positive
      id:
        simple: ${alert.id}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1032,
          "y": 2509
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "41":
    id: "41"
    taskid: 7d020778-3334-4b47-8e08-7785a519d039
    type: regular
    task:
      id: 7d020778-3334-4b47-8e08-7785a519d039
      version: -1
      name: Search related alerts by Case ID
      description: |-
        This task searches within the same case for additional suspicious related alerts that may indicate a compromised endpoint.
        It searches for the following alerts:

        - Regsvr32 may have run code from an untrusted source
        - Process calls ActiveX Object with a shell command
        - Command-line arguments match Mimikatz execution
        - Unicode RTL Override Character
        - Screensaver process executed from Users or temporary folder by a scripting engine process
        - Unsigned and unpopular process performed a DLL injection
        - Unsigned and unpopular process performed queue APC injection
        - Unsigned and unpopular process performed an injection
        - Unsigned and unpopular process performed process hollowing injection
        - Unsigned and unpopular process performed a DLL injection to a commonly abused process
        - Unsigned and unpopular process performed injection into a commonly abused process
        - Uncommon Service Create/Config
        - Unsigned and unpopular process injected into a commonly abused process
        - Unsigned process injects code into a process
        - New service created via command line
        - PowerShell is used to execute a CPL file
        - Task scheduled by commonly abused host process
        - Unsigned process running from a temporary directory
        - Suspicious file created in AppData directory
      scriptName: SearchAlertsV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      fromdate:
        simple: 5 hours ago
      query:
        simple: "(\n${alert.parentXDRIncident=val.split('-')[1]})  \nAND \n(\nname:\"Regsvr32 may have run code from an untrusted source\" OR \nname:\"Process calls ActiveX Object with a shell command\" OR \nname:\"Command-line arguments match Mimikatz execution\" OR \nname:\"Unicode RTL Override Character\" OR\nname:\"Screensaver process executed from Users or temporary folder by a scripting engine process\" OR \nname:\"Unsigned and unpopular process performed a DLL injection\" OR \nname:\"Unsigned and unpopular process performed queue APC injection\" OR \nname:\"Unsigned and unpopular process performed an injection\" OR \nname:\"Unsigned and unpopular process performed process hollowing injection\" OR \nname:\"Unsigned and unpopular process performed a DLL injection to a commonly abused process\" OR \nname:\"Unsigned and unpopular process performed injection into a commonly abused process\" OR \nname:\"Uncommon Service Create/Config\" OR \nname:\"Unsigned and unpopular process injected into a commonly abused process\" OR \nname:\"Unsigned process injects code into a process\" OR \nname:\"New service created via command line\" OR \nname:\"PowerShell is used to execute a CPL file\" OR \nname:\"Task scheduled by commonly abused host process\" OR \nname:\"Unsigned process running from a temporary directory\" OR \nname:\"Suspicious file created in AppData directory\" \n)"
      todate:
        simple: now
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1586,
          "y": 914
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "44":
    id: "44"
    taskid: 5b6fdac2-b839-4a71-8bb7-0d377afdfb3c
    type: regular
    task:
      id: 5b6fdac2-b839-4a71-8bb7-0d377afdfb3c
      version: -1
      name: Enrich the DLL's SHA256
      description: Checks the file reputation of the given hash.
      script: '|||file'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      file:
        simple: ${Core.OriginalAlert.event.action_module_sha256}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -152,
          "y": -94
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "10_39_Remediation": 0.17,
      "16_11_Insights": 0.26,
      "16_39_Alerts": 0.17,
      "32_33_#error#": 0.5,
      "37_11_#default#": 0.18,
      "37_17_False Positive": 0.35,
      "38_39_Remediation": 0.3,
      "4_39_Remediation": 0.44,
      "9_12_#default#": 0.29,
      "9_37_Remediation": 0.44
    },
    "paper": {
      "dimensions": {
        "height": 3088,
        "width": 2617,
        "x": -650,
        "y": -374
      }
    }
  }
inputs: []
outputs: []
tests:
- No tests (auto formatted)
fromversion: 8.9.0
