id: silent-Rundll32.exe executes a rare unsigned module
version: -1
name: silent-Rundll32.exe executes a rare unsigned module
description: "This playbook handles the \"Rundll32.exe executes a rare unsigned module\" alerts.\n\nThe playbook executes the following stages:\n\nData retrieval:\n- Retrieve the alert extra data.\n- Calculate the host risk score\n- Extract the extension of the loaded DLL.\n- Calculate the similarity between the CGO process signer and the loaded DLL's company attribute.\n\nInvestigation:\n- Check the DLL reputation.\n- Check the similarity between the CGO process signer and the loaded DLL's company attribute.\n- Check for uncommon DLL extensions.\n- Check for uncommon causality chain executions.\n- Search for related XDR agent alerts to determine if any suspicious behavior occurred as part of the causality chain and the related case ID.\n\nRemediation actions will be taken if:\n- The loaded DLL is malicious.\n- The DLL is loaded from an uncommon causality chain.\n- The DLL extension is uncommon, or the DLL's SHA256 is suspicious, and the host risk score is Medium.\n- The host risk score is High (and the similarity check is less than 0.6).\n\n\nRemediation actions:\n- Terminate the causality chain. \n- Quarantine suspicious or malicious DLLs, if any.\n\nThe playbook requires enrichment integrations for checking the DLL's SHA256 reputation.\n"
starttaskid: "0"
issilent: true
tasks:
  "0":
    id: "0"
    taskid: a981597c-ee9b-4d99-8622-dba5021bf3fc
    type: start
    task:
      id: a981597c-ee9b-4d99-8622-dba5021bf3fc
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "3"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 447,
          "y": -374
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: 3be302c1-252d-4dbb-859b-800c81177191
    type: regular
    task:
      id: 3be302c1-252d-4dbb-859b-800c81177191
      version: -1
      name: Get Host Risk score
      description: Retrieve the risk score of a specific host or list of hosts with the highest risk score in the environment along with the reason affecting each score.
      script: '|||core-list-risky-hosts'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      host_id:
        simple: ${alert.hostname}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 242,
          "y": -94
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: 654dc9e8-5ef6-4753-8fa6-609ce154582b
    type: regular
    task:
      id: 654dc9e8-5ef6-4753-8fa6-609ce154582b
      version: -1
      name: Get the alert's extra data
      description: Returns extended information about each alert ID.
      script: '|||core-get-cloud-original-alerts'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "1"
      - "36"
      - "5"
      - "44"
    scriptarguments:
      alert_ids:
        simple: ${alert.id}
      filter_alert_fields:
        simple: "false"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 447,
          "y": -259
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: 43d4796e-a36e-4e3d-9731-36f39660b690
    type: condition
    task:
      id: 43d4796e-a36e-4e3d-9731-36f39660b690
      version: -1
      name: Is the loaded DLL malicious?
      description: Check if the loaded DLL is malicious
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      Remediation:
      - "39"
    separatecontext: false
    conditions:
    - label: Remediation
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: DBotScore
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: DBotScore.Indicator
                      iscontext: true
                    right:
                      value:
                        simple: Core.OriginalAlert.event.action_module_sha256
                      iscontext: true
                accessor: Score
            iscontext: true
          ignorecase: true
      - - operator: isEqualNumber
          left:
            value:
              complex:
                root: DBotScore
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: DBotScore.Indicator
                      iscontext: true
                    right:
                      value:
                        simple: Core.OriginalAlert.event.action_module_sha256
                      iscontext: true
                accessor: Score
            iscontext: true
          right:
            value:
              simple: "3"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 178
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: 4f18a42a-12ce-4eb9-8a20-fec42f513135
    type: regular
    task:
      id: 4f18a42a-12ce-4eb9-8a20-fec42f513135
      version: -1
      name: Check the CGO signer and DLL company similarity
      description: Check the similarity between the CGO process signer and the loaded DLL's company attribute.
      scriptName: StringSimilarity
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      string_A:
        complex:
          root: Core.OriginalAlert.event.action_module_file_info
          accessor: company
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: 'Core.OriginalAlert.event.action_module_file_info.company is empty'
      string_B:
        complex:
          root: alert
          accessor: cgosigner
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: alert.cgosigner is empty
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 651,
          "y": -94
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: 2bb7eb4a-0916-48d4-8274-8663a7230cce
    type: title
    task:
      id: 2bb7eb4a-0916-48d4-8274-8663a7230cce
      version: -1
      name: Analysis
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "4"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 51
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: 2764fbda-ab36-499b-8ce2-d9cdde3745a6
    type: condition
    task:
      id: 2764fbda-ab36-499b-8ce2-d9cdde3745a6
      version: -1
      name: Is the Host Risk High?
      description: Checks if the host risk score is set to High.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "12"
      Remediation:
      - "37"
    separatecontext: false
    conditions:
    - label: Remediation
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: Core.RiskyHost.risk_level
            iscontext: true
          right:
            value:
              simple: High
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 864,
          "y": 568
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: ab48686b-bbd1-4f96-8fc9-ff097885715e
    type: condition
    task:
      id: ab48686b-bbd1-4f96-8fc9-ff097885715e
      version: -1
      name: Is CGO uncommon in this alert?
      description: "Checks if the causality chain is unusual for this alert. If the CGO name matches one on the list, the alert will be marked as a true positive (TP)."
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "38"
      Remediation:
      - "39"
    separatecontext: false
    conditions:
    - label: Remediation
      condition:
      - - operator: containsGeneral
          left:
            value:
              simple: alert.cgoname
            iscontext: true
          right:
            value:
              simple: cmd.exe
          ignorecase: true
        - operator: containsGeneral
          left:
            value:
              simple: alert.cgoname
            iscontext: true
          right:
            value:
              simple: powershell.exe
          ignorecase: true
        - operator: containsGeneral
          left:
            value:
              simple: alert.cgoname
            iscontext: true
          right:
            value:
              simple: mshta.exe
          ignorecase: true
        - operator: containsGeneral
          left:
            value:
              simple: alert.cgoname
            iscontext: true
          right:
            value:
              simple: sppsvc.exe
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 683,
          "y": 314
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: 259c10ff-e6f1-458c-844d-338ef85d47c2
    type: title
    task:
      id: 259c10ff-e6f1-458c-844d-338ef85d47c2
      version: -1
      name: Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "23"
      - "24"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1323
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: 28236b29-3d28-4404-859a-67b405eb9a4d
    type: title
    task:
      id: 28236b29-3d28-4404-859a-67b405eb9a4d
      version: -1
      name: Investigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "34"
      - "41"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1368,
          "y": 701
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 879c83b5-66ed-45d4-87e5-dc16f0c7497f
    type: condition
    task:
      id: 879c83b5-66ed-45d4-87e5-dc16f0c7497f
      version: -1
      name: Any related alerts?
      description: |-
        Check if there are any related alerts associated with this alert.
        The remediation phase will be taken in one of the following scenarios:
        - If there are any related alerts with Low, Medium, or High severity.
        - If the host risk score is set to Medium, and there are any insights.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "17"
      Alerts:
      - "39"
      Insights:
      - "11"
    separatecontext: false
    conditions:
    - label: Insights
      condition:
      - - operator: containsGeneral
          left:
            value:
              simple: Core.RiskyHost.risk_level
            iscontext: true
          right:
            value:
              simple: med
          ignorecase: true
      - - operator: isEqualString
          left:
            value:
              simple: foundIncidents.severity
            iscontext: true
          right:
            value:
              simple: Informational
          ignorecase: true
    - label: Alerts
      condition:
      - - operator: in
          left:
            value:
              simple: foundIncidents.severity
            iscontext: true
          right:
            value:
              simple: low,medium,high,critical
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1368,
          "y": 1065
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: 2abcf759-92c6-4629-8414-7bc3a54a894a
    type: title
    task:
      id: 2abcf759-92c6-4629-8414-7bc3a54a894a
      version: -1
      name: No malicious activity detected
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "40"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1032,
          "y": 1455
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: 337e6419-2449-42eb-87e8-0c05164c0579
    type: regular
    task:
      id: 337e6419-2449-42eb-87e8-0c05164c0579
      version: -1
      name: Close Alert - True Positive
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      closeNotes:
        simple: Resolved as True Positive - Handled by the playbook "Rundll32.exe executes a rare unsigned module"
      closeReason:
        simple: Resolved - True Positive
      id:
        simple: ${alert.id}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2509
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: 18f21c91-f77f-494d-816e-ec25a810f8fc
    type: title
    task:
      id: 18f21c91-f77f-494d-816e-ec25a810f8fc
      version: -1
      name: Finish Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "19"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2383
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: 7c321802-aef3-4ba2-9f53-4336e2cdf612
    type: condition
    task:
      id: 7c321802-aef3-4ba2-9f53-4336e2cdf612
      version: -1
      name: Check if the DLL is suspicious
      description: Check if the DLL is suspicious
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "20"
      "yes":
      - "22"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: DBotScore
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: DBotScore.Indicator
                      iscontext: true
                    right:
                      value:
                        simple: Core.OriginalAlert.event.action_module_sha256
                accessor: Score
            iscontext: true
          ignorecase: true
      - - operator: greaterThanOrEqual
          left:
            value:
              complex:
                root: DBotScore
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: DBotScore.Indicator
                      iscontext: true
                    right:
                      value:
                        simple: Core.OriginalAlert.event.action_module_sha256
                accessor: Score
            iscontext: true
          right:
            value:
              simple: "2"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -75,
          "y": 1573
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: 1c548669-49cc-45e9-8cd8-bb4e13244449
    type: regular
    task:
      id: 1c548669-49cc-45e9-8cd8-bb4e13244449
      version: -1
      name: Check tf the DLL file is quarantined
      description: Retrieves the quarantine status for a selected file.
      script: '|||core-get-quarantine-status'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "28"
    scriptarguments:
      endpoint_id:
        simple: ${alert.agentid}
      file_hash:
        simple: ${Core.OriginalAlert.event.action_module_sha256}
      file_path:
        simple: ${Core.OriginalAlert.event.action_module_path}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -327,
          "y": 1709
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: b4e06160-6d57-4529-8c25-793bb09d343a
    type: title
    task:
      id: b4e06160-6d57-4529-8c25-793bb09d343a
      version: -1
      name: Terminate CGO
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "32"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1455
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: 43802c12-7369-4105-8f1e-57714ae2e41b
    type: title
    task:
      id: 43802c12-7369-4105-8f1e-57714ae2e41b
      version: -1
      name: Quarentine DLL
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "21"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -75,
          "y": 1455
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 31546a37-85b5-49af-8dd5-51f3285fd438
    type: condition
    task:
      id: 31546a37-85b5-49af-8dd5-51f3285fd438
      version: -1
      name: Should quarantine the file?
      description: Determines whether to quarantine the files based on their quarantine status.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "20"
      "yes":
      - "29"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Core.quarantineFiles.status
                accessor: status
            iscontext: true
          right:
            value:
              simple: "false"
          ignorecase: true
      - - operator: isNotEmpty
          left:
            value:
              simple: Core.OriginalAlert.event.action_module_path
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -327,
          "y": 1877
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: bc809b36-0c2a-428d-8303-9b9c47f7ad06
    type: regular
    task:
      id: bc809b36-0c2a-428d-8303-9b9c47f7ad06
      version: -1
      name: File quarantine
      description: Quarantines a file on selected endpoints.
      script: '|||core-quarantine-files'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#error#':
      - "30"
      '#none#':
      - "20"
    scriptarguments:
      endpoint_id_list:
        simple: ${alert.agentid}
      file_hash:
        simple: ${Core.OriginalAlert.event.action_module_sha256}
      file_path:
        simple: ${Core.OriginalAlert.event.action_module_path}
      incident_id:
        complex:
          root: alert
          accessor: parentXDRIncident
          transformers:
          - operator: Cut
            args:
              delimiter:
                value:
                  simple: '-'
              fields:
                value:
                  simple: "2"
      interval_in_seconds:
        simple: "20"
      timeout_in_seconds:
        simple: "120"
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": -327,
          "y": 2062
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: db370eb9-d8eb-41c9-8014-94a870971fae
    type: regular
    task:
      id: db370eb9-d8eb-41c9-8014-94a870971fae
      version: -1
      name: Manual action needed – DLL file couldn't be quarantined
      description: |-
        Dear Analyst,

        The playbook was unable to quarantine the loadded DLL file due to the following possible reasons:

        - The DLL file is not located on the local host.
        - The endpoint is currently disconnected.
        - The DLL is loaded and can't be quarantined while running.


        Please take manual action to terminate the causality process if needed and quarantine the DLL file.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -650,
          "y": 2200
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: 7586c9cb-0617-4fce-86f8-5ffc0d993b28
    type: title
    task:
      id: 7586c9cb-0617-4fce-86f8-5ffc0d993b28
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2654
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: 47281942-33a2-476b-8776-8feb82cb2572
    type: regular
    task:
      id: 47281942-33a2-476b-8776-8feb82cb2572
      version: -1
      name: Terminate Causality (CGO)
      description: Terminate a process tree by its causality ID. Available only for Cortex XSIAM 2.4.
      script: '|||core-terminate-causality'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#error#':
      - "33"
      '#none#':
      - "20"
    scriptarguments:
      agent_id:
        simple: ${alert.agentid}
      causality_id:
        simple: ${alert.cid}
      incident_id:
        complex:
          root: alert
          accessor: parentXDRIncident
          transformers:
          - operator: Cut
            args:
              delimiter:
                value:
                  simple: '-'
              fields:
                value:
                  simple: "2"
      timeout_in_seconds:
        simple: "180"
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": 449,
          "y": 1573
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: 953cc262-2b48-489f-878d-fe1ac0119e40
    type: regular
    task:
      id: 953cc262-2b48-489f-878d-fe1ac0119e40
      version: -1
      name: Terminate Causality Process Manually
      description: |
        Dear Analyst,

        During the remediation process, the playbook failed to terminate the causality process: ${alert.cgoname}
        Please investigate this before closing this alert.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 207,
          "y": 1709
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: 4618df80-9e41-43c7-8d97-c3ad3ba79ede
    type: regular
    task:
      id: 4618df80-9e41-43c7-8d97-c3ad3ba79ede
      version: -1
      name: Search related alerts by causality chain
      description: |-
        This task uses the causality process chain to search for suspicious related alerts that may indicate a compromised endpoint.
        It searches for the following alerts:

        - Regsvr32 may have run code from an untrusted source
        - Process calls ActiveX Object with a shell command
        - Command-line arguments match Mimikatz execution
        - Unicode RTL Override Character
        - Screensaver process executed from Users or temporary folder by a scripting engine process
        - Unsigned and unpopular process performed a DLL injection
        - Unsigned and unpopular process performed queue APC injection
        - Unsigned and unpopular process performed an injection
        - Unsigned and unpopular process performed process hollowing injection
        - Unsigned and unpopular process performed a DLL injection to a commonly abused process
        - Unsigned and unpopular process performed injection into a commonly abused process
        - Uncommon Service Create/Config
        - Unsigned and unpopular process injected into a commonly abused process
        - Unsigned process injects code into a process
        - New service created via command line
        - PowerShell is used to execute a CPL file
        - Task scheduled by commonly abused host process
        - Unsigned process running from a temporary directory
        - Suspicious file created in AppData directory
      scriptName: SearchAlertsV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      fromdate:
        simple: 5 hours ago
      includeinformational:
        simple: "true"
      query:
        simple: "(\ncid:${alert.cid.[0]} or \nactorprocessinstanceid:${alert.cid.[0]} or \nactionprocessinstanceid:${alert.cid.[0]} or \nactorprocessinstanceid:${alert.actorprocessinstanceid.[0]} or \nactionprocessinstanceid:${alert.actorprocessinstanceid.[0]}\n)  \nAND \n(\nname:\"Regsvr32 may have run code from an untrusted source\" OR \nname:\"Process calls ActiveX Object with a shell command\" OR \nname:\"Command-line arguments match Mimikatz execution\" OR \nname:\"Unicode RTL Override Character\" OR\nname:\"Screensaver process executed from Users or temporary folder by a scripting engine process\" OR \nname:\"Unsigned and unpopular process performed a DLL injection\" OR \nname:\"Unsigned and unpopular process performed queue APC injection\" OR \nname:\"Unsigned and unpopular process performed an injection\" OR \nname:\"Unsigned and unpopular process performed process hollowing injection\" OR \nname:\"Unsigned and unpopular process performed a DLL injection to a commonly abused process\" OR \nname:\"Unsigned and unpopular process performed injection into a commonly abused process\" OR \nname:\"Uncommon Service Create/Config\" OR \nname:\"Unsigned and unpopular process injected into a commonly abused process\" OR \nname:\"Unsigned process injects code into a process\" OR \nname:\"New service created via command line\" OR \nname:\"PowerShell is used to execute a CPL file\" OR \nname:\"Task scheduled by commonly abused host process\" OR \nname:\"Unsigned process running from a temporary directory\" OR \nname:\"Suspicious file created in AppData directory\" \n)"
      todate:
        simple: now
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1184,
          "y": 914
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: ab608f24-0c02-4d7f-8db3-0436a00a222f
    type: regular
    task:
      id: ab608f24-0c02-4d7f-8db3-0436a00a222f
      version: -1
      name: Extract the DLL's extension
      description: Extract the DLL's extension.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: dll_extension
      value:
        complex:
          root: Core.OriginalAlert.event
          accessor: action_module_name
          transformers:
          - operator: RegexExtractAll
            args:
              error_if_no_match: {}
              ignore_case: {}
              multi_line: {}
              period_matches_newline: {}
              regex:
                value:
                  simple: \.(\w+)$
              unpack_matches: {}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1046,
          "y": -94
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: cbd42f8b-68c4-471b-89a0-af3643e0351b
    type: condition
    task:
      id: cbd42f8b-68c4-471b-89a0-af3643e0351b
      version: -1
      name: Check if the fuzzyhash is not similar
      description: Remove false positives if the CGO signer is similar to the company name in the DLL's attribute (excluding Microsoft Corporation).
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "11"
      False Positive:
      - "17"
    separatecontext: false
    conditions:
    - label: False Positive
      condition:
      - - operator: greaterThan
          left:
            value:
              simple: StringSimilarity.SimilarityScore
            iscontext: true
          right:
            value:
              simple: "0.6"
          ignorecase: true
      - - operator: notContainsGeneral
          left:
            value:
              simple: alert.cgosigner
            iscontext: true
          right:
            value:
              simple: Microsoft Corporation
          ignorecase: true
      - - operator: isNotEmpty
          left:
            value:
              simple: alert.cgosigner
            iscontext: true
      - - operator: isNotEmpty
          left:
            value:
              simple: Core.OriginalAlert.event.action_module_file_info.company
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 864,
          "y": 797
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: 7d09fe4c-29a8-493c-9c82-f75279c98c67
    type: condition
    task:
      id: 7d09fe4c-29a8-493c-9c82-f75279c98c67
      version: -1
      name: Suspicious DLL and medium-risk host?
      description: |-
        The following condition must be met:
        1. If the Host Risk score is Medium.

        And one of these below:
        2. The DLL extension is not a common one
        3. The DLL Reputation is Suspicious.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "9"
      Remediation:
      - "39"
    separatecontext: false
    conditions:
    - label: Remediation
      condition:
      - - operator: containsGeneral
          left:
            value:
              simple: Core.RiskyHost.risk_level
            iscontext: true
          right:
            value:
              simple: med
          ignorecase: true
      - - operator: notIn
          left:
            value:
              simple: dll_extension
            iscontext: true
          right:
            value:
              simple: cpl,exe,pkg,ax,tmp,dll
        - operator: isEqualNumber
          left:
            value:
              complex:
                root: DBotScore
                filters:
                - - operator: containsGeneral
                    left:
                      value:
                        simple: DBotScore.Indicator
                      iscontext: true
                    right:
                      value:
                        simple: Core.OriginalAlert.event.action_module_sha256
                      iscontext: true
                accessor: Score
                transformers:
                - operator: SetIfEmpty
                  args:
                    applyIfEmpty: {}
                    defaultValue:
                      value:
                        simple: "-1"
            iscontext: true
          right:
            value:
              simple: "2"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 815,
          "y": 445
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: 9ecf2e5f-b833-456e-8f36-69264b0a9360
    type: title
    task:
      id: 9ecf2e5f-b833-456e-8f36-69264b0a9360
      version: -1
      name: Related Alerts
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "11"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1193
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: df7d8195-afe3-4151-8426-02a95f68c5dc
    type: regular
    task:
      id: df7d8195-afe3-4151-8426-02a95f68c5dc
      version: -1
      name: Close Alert - False Positive
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      closeNotes:
        simple: Resolved as false positive - handled by the playbook "Rundll32.exe executes a rare unsigned module"
      closeReason:
        simple: Resolved - False Positive
      id:
        simple: ${alert.id}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1032,
          "y": 2509
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "41":
    id: "41"
    taskid: b1f04d00-0019-4a6b-81db-ea37291567f8
    type: regular
    task:
      id: b1f04d00-0019-4a6b-81db-ea37291567f8
      version: -1
      name: Search related alerts by Case ID
      description: |-
        This task searches within the same case for additional suspicious related alerts that may indicate a compromised endpoint.
        It searches for the following alerts:

        - Regsvr32 may have run code from an untrusted source
        - Process calls ActiveX Object with a shell command
        - Command-line arguments match Mimikatz execution
        - Unicode RTL Override Character
        - Screensaver process executed from Users or temporary folder by a scripting engine process
        - Unsigned and unpopular process performed a DLL injection
        - Unsigned and unpopular process performed queue APC injection
        - Unsigned and unpopular process performed an injection
        - Unsigned and unpopular process performed process hollowing injection
        - Unsigned and unpopular process performed a DLL injection to a commonly abused process
        - Unsigned and unpopular process performed injection into a commonly abused process
        - Uncommon Service Create/Config
        - Unsigned and unpopular process injected into a commonly abused process
        - Unsigned process injects code into a process
        - New service created via command line
        - PowerShell is used to execute a CPL file
        - Task scheduled by commonly abused host process
        - Unsigned process running from a temporary directory
        - Suspicious file created in AppData directory
      scriptName: SearchAlertsV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      fromdate:
        simple: 5 hours ago
      query:
        simple: "(\n${alert.parentXDRIncident=val.split('-')[1]})  \nAND \n(\nname:\"Regsvr32 may have run code from an untrusted source\" OR \nname:\"Process calls ActiveX Object with a shell command\" OR \nname:\"Command-line arguments match Mimikatz execution\" OR \nname:\"Unicode RTL Override Character\" OR\nname:\"Screensaver process executed from Users or temporary folder by a scripting engine process\" OR \nname:\"Unsigned and unpopular process performed a DLL injection\" OR \nname:\"Unsigned and unpopular process performed queue APC injection\" OR \nname:\"Unsigned and unpopular process performed an injection\" OR \nname:\"Unsigned and unpopular process performed process hollowing injection\" OR \nname:\"Unsigned and unpopular process performed a DLL injection to a commonly abused process\" OR \nname:\"Unsigned and unpopular process performed injection into a commonly abused process\" OR \nname:\"Uncommon Service Create/Config\" OR \nname:\"Unsigned and unpopular process injected into a commonly abused process\" OR \nname:\"Unsigned process injects code into a process\" OR \nname:\"New service created via command line\" OR \nname:\"PowerShell is used to execute a CPL file\" OR \nname:\"Task scheduled by commonly abused host process\" OR \nname:\"Unsigned process running from a temporary directory\" OR \nname:\"Suspicious file created in AppData directory\" \n)"
      todate:
        simple: now
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1586,
          "y": 914
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "44":
    id: "44"
    taskid: 11223b3e-6a34-4274-9827-b530a6ffbbfd
    type: regular
    task:
      id: 11223b3e-6a34-4274-9827-b530a6ffbbfd
      version: -1
      name: Enrich the DLL's SHA256
      description: Checks the file reputation of the given hash.
      script: '|||file'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      file:
        simple: ${Core.OriginalAlert.event.action_module_sha256}
    separatecontext: false
    continueonerror: true
    continueonerrortype: errorPath
    view: |-
      {
        "position": {
          "x": -152,
          "y": -94
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "10_39_Remediation": 0.17,
      "16_11_Insights": 0.26,
      "16_39_Alerts": 0.17,
      "32_33_#error#": 0.5,
      "37_11_#default#": 0.18,
      "37_17_False Positive": 0.35,
      "38_39_Remediation": 0.3,
      "4_39_Remediation": 0.44,
      "9_12_#default#": 0.29,
      "9_37_Remediation": 0.44
    },
    "paper": {
      "dimensions": {
        "height": 3088,
        "width": 2617,
        "x": -650,
        "y": -374
      }
    }
  }
inputs: []
outputs: []
tests:
- No tests (auto formatted)
fromversion: 8.9.0
