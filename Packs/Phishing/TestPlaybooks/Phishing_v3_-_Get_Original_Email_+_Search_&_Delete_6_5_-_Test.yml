id: Phishing v3 - Get Original Email + Search & Delete 6 5 - Test
version: -1
name: Phishing v3 - Get Original Email + Search & Delete 6 5 - Test
description: |-
  This playbook tests the search & delete and get original email functionality.
  Prerequisites:
  - The phishing playbook is configured with the correct inputs to allow getting the original email and searching & deleting emails
  - A mail sender with sr-test02 is configured. That user will supposedly attack sr-test01.
  - sr-test01 has a rule which forwards the test email to Testbox(but does not forward the acknowledgement emails it receives from the phishing playbook!)
  - EWS O365 is configured as the mail listener with Testbox as the user.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 20f7f66c-49a0-42e7-82c3-0ea954ac6081
    type: start
    task:
      id: 20f7f66c-49a0-42e7-82c3-0ea954ac6081
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "1"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 50
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: fa5095fb-1dfa-4e61-8df1-a4fde8fa1b76
    type: regular
    task:
      id: fa5095fb-1dfa-4e61-8df1-a4fde8fa1b76
      version: -1
      name: Delete Context
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      all:
        simple: "yes"
    reputationcalc: 1
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 185
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: e289f175-f205-4467-8bbb-b648eb107882
    type: regular
    task:
      id: e289f175-f205-4467-8bbb-b648eb107882
      version: -1
      name: Investigate the incident
      description: commands.local.investigate
      script: Builtin|||investigate
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "37"
    scriptarguments:
      id:
        complex:
          root: FoundID
    reputationcalc: 1
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 990
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 2
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: f1de267e-6140-4b4f-8095-3b1734dd1672
    type: regular
    task:
      id: f1de267e-6140-4b4f-8095-3b1734dd1672
      version: -1
      name: Get the final Email context
      description: Gets a value from the specified incident's context.
      scriptName: GetByIncidentId
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      get_key:
        simple: Email
      incident_id:
        complex:
          root: FoundID
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 750,
          "y": 1780
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: 0f983961-b186-49f4-85db-5cdbe0a8782a
    type: title
    task:
      id: 0f983961-b186-49f4-85db-5cdbe0a8782a
      version: -1
      name: Incident Field Checks
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "15"
      - "16"
      - "29"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -100,
          "y": 1970
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: acc564e7-3868-44a5-8528-c3775d2f7897
    type: title
    task:
      id: acc564e7-3868-44a5-8528-c3775d2f7897
      version: -1
      name: Context Checks
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "12"
      - "31"
      - "35"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1000,
          "y": 1960
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: 06e95947-8142-4666-8b92-65be9dde4afa
    type: regular
    task:
      id: 06e95947-8142-4666-8b92-65be9dde4afa
      version: -1
      name: Get final incident fields
      description: Searches Demisto incidents
      scriptName: SearchIncidentsV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "8"
    scriptarguments:
      id:
        complex:
          root: FoundID
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -100,
          "y": 1790
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: f6a9b7b4-3914-414c-82cb-4dabb039d8b2
    type: condition
    task:
      id: f6a9b7b4-3914-414c-82cb-4dabb039d8b2
      version: -1
      name: Does the retrieved email contain the correct HTML?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "13"
      "yes":
      - "14"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: Email
                accessor: HTML
            iscontext: true
          right:
            value:
              simple: http://157.230.37.22/banks/Scotia/
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 750,
          "y": 2120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: 6f0dd3e1-e682-4461-8bef-e5e8c25c005a
    type: regular
    task:
      id: 6f0dd3e1-e682-4461-8bef-e5e8c25c005a
      version: -1
      name: Error about mismatch in the email HTML
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: Something with the HTML of the retrieved email is wrong. Most likely, the original email was not retrieved.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 750,
          "y": 2330
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "14":
    id: "14"
    taskid: 02520079-e4c5-4b0f-825a-42b143720e2a
    type: title
    task:
      id: 02520079-e4c5-4b0f-825a-42b143720e2a
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2930
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "15":
    id: "15"
    taskid: 264e26c8-107c-40cc-80d5-3d03521c70c0
    type: condition
    task:
      id: 264e26c8-107c-40cc-80d5-3d03521c70c0
      version: -1
      name: Was the subject of the original email set?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "19"
      "Yes":
      - "14"
    separatecontext: false
    conditions:
    - label: "Yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: foundIncidents.CustomFields
                accessor: emailsubject
            iscontext: true
          right:
            value:
              simple: Suspicious activity in your bank account [ACTION REQUIRED]
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -100,
          "y": 2130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 0ab62619-a2a2-44e5-8ca5-b2be8e215c45
    type: condition
    task:
      id: 0ab62619-a2a2-44e5-8ca5-b2be8e215c45
      version: -1
      name: Is the reporter address different than the phishing sender?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "28"
      "Yes":
      - "14"
    separatecontext: false
    conditions:
    - label: "Yes"
      condition:
      - - operator: isNotEqualString
          left:
            value:
              complex:
                root: foundIncidents.CustomFields
                accessor: emailfrom
            iscontext: true
          right:
            value:
              complex:
                root: foundIncidents.CustomFields
                accessor: reporteremailaddress
            iscontext: true
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: foundIncidents.CustomFields
                accessor: reporteremailaddress
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -580,
          "y": 2130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: bcf54488-45de-430e-8ffc-0d8bf2cb0243
    type: title
    task:
      id: bcf54488-45de-430e-8ffc-0d8bf2cb0243
      version: -1
      name: Additional Flow Checks
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "25"
      - "39"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2760,
          "y": 1780
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: 8b64633b-caf9-4e03-88ea-0cc27d473c39
    type: regular
    task:
      id: 8b64633b-caf9-4e03-88ea-0cc27d473c39
      version: -1
      name: Error - subject is not the subject of the retrieved email
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: The subject of the retrieved email was not set in the Process Email - Generic playbook, or the original email was not retrieved at all.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -100,
          "y": 2330
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: 5491874a-3af4-45c1-8ba1-6c258863c219
    type: regular
    task:
      id: 5491874a-3af4-45c1-8ba1-6c258863c219
      version: -1
      name: Send email from attacker to victim
      description: Sends an email using EWS.
      script: '|||send-mail'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "21"
    scriptarguments:
      body:
        simple: 'We''ve detected suspicious activity in your bank account on 05/12/2021.Please take a moment to review your recent activity and report anything suspicious immediately.Make sure to login and follow the instructions on our official website: www.scotiabank.com<https://eur01.safelinks.protection.outlook.com/?url=http%3A%2F%2F157.230.37.22%2Fbanks%2FScotia%2F&data=04%7C01%7Csr-test01%40demistodev.onmicrosoft.com%7Ca068915160cb49db31d508d9b9a33929%7Cebac1a1681bf449b8d435732c3c1d999%7C1%7C0%7C637744932980194392%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&sdata=I7reVHNGh7ifFcOWXFdfQWFXmwK3MVxFLEgiMPiG7Jo%3D&reserved=0>.Should you have any questions, please contact us at SUPPORT@SCOTlABANK.COMScotiabank'
      htmlBody:
        simple: '<div style="font-family: Calibri, Arial, Helvetica, sans-serif;font-size: 12pt;color: rgb(0, 0, 0);"><span style="font-size: 12pt;background-color: rgb(255, 255, 255);">We&#39;ve detected suspicious activity in your bank account on 05/12/2021.</span> <div style="font-size: 12pt;background-color: rgb(255, 255, 255);">Please take a moment to review your recent activity and report anything suspicious immediately.</div><div style="font-size: 12pt;background-color: rgb(255, 255, 255);">Make sure to login and follow the instructions on our official website:<span> </span><a href="https://eur01.safelinks.protection.outlook.com/?url=http%3A%2F%2F157.230.37.22%2Fbanks%2FScotia%2F&amp;data=04%7C01%7Csr-test01%40demistodev.onmicrosoft.com%7Ca068915160cb49db31d508d9b9a33929%7Cebac1a1681bf449b8d435732c3c1d999%7C1%7C0%7C637744932980194392%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=I7reVHNGh7ifFcOWXFdfQWFXmwK3MVxFLEgiMPiG7Jo%3D&amp;reserved=0" target="_blank" style="" rel="nofollow noopener">www.scotiabank.com</a>.</div><div style="font-size: 12pt;background-color: rgb(255, 255, 255);"><br></div><div style="font-size: 12pt;background-color: rgb(255, 255, 255);">Should you have any questions, please contact us at SUPPORT@SCOTlABANK.COM</div><span style="font-size: 12pt;background-color: rgb(255, 255, 255);"><span style="">Scotiabank</span></span><br></div>'
      subject:
        simple: Suspicious activity in your bank account [ACTION REQUIRED]
      to:
        simple: sr-test01@demistodev.onmicrosoft.com
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 340
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: 9287a083-ab7a-4760-8e35-2dc0a4ad3e76
    type: regular
    task:
      id: 9287a083-ab7a-4760-8e35-2dc0a4ad3e76
      version: -1
      name: Wait for email to arrive and be forwarded by rule to Testbox
      description: Sleep for X seconds
      scriptName: Sleep
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "22"
    scriptarguments:
      seconds:
        simple: "120"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 505
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: f4d515b6-1168-41e6-8e21-a9649d588dc9
    type: regular
    task:
      id: f4d515b6-1168-41e6-8e21-a9649d588dc9
      version: -1
      name: Find the new incident
      description: |-
        Searches Demisto incidents.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.10/Cortex-XSOAR-Administrator-Guide/Automations
      scriptName: SearchIncidentsV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "23"
    scriptarguments:
      name:
        simple: 'FW: Suspicious activity in your bank account [ACTION REQUIRED]'
      status:
        simple: Pending
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 670
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: 22d95127-200e-4e36-8d79-8f5848aca33d
    type: regular
    task:
      id: 22d95127-200e-4e36-8d79-8f5848aca33d
      version: -1
      name: Save found incident ID
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      key:
        simple: FoundID
      value:
        complex:
          root: foundIncidents
          accessor: id
          transformers:
          - operator: sort
            args:
              descending:
                value:
                  simple: "true"
          - operator: atIndex
            args:
              index:
                value:
                  simple: "0"
    reputationcalc: 1
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 830
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: 96c9cdb5-6ab0-464b-8743-2d84e8bc7809
    type: regular
    task:
      id: 96c9cdb5-6ab0-464b-8743-2d84e8bc7809
      version: -1
      name: Clear found incident
      description: |-
        Delete field from context.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.10/Cortex-XSOAR-Administrator-Guide/Automations
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      all:
        simple: "no"
      key:
        simple: foundIncidents
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -100,
          "y": 1590
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: f84c6d17-d078-4efb-8e15-650795d1bd20
    type: title
    task:
      id: f84c6d17-d078-4efb-8e15-650795d1bd20
      version: -1
      name: Check Search & Delete
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "40"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3030,
          "y": 1920
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 0c75c856-0c47-4d03-8d80-ea9b36ecbf15
    type: regular
    task:
      id: 0c75c856-0c47-4d03-8d80-ea9b36ecbf15
      version: -1
      name: Error - email from is same as reporter, or reporter is empty
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: Either the Reporter Email Address is empty (problem with the mapper), or the Email From doesn't equal the Reporter Email Address (problem with Process Email - Generic subplaybook). In case of the latter, need to see if the original email was retrieved and parsed correctly using ParseEmailFiles.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -580,
          "y": 2320
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: d43e037b-2aa8-4035-80bf-a8166bf91746
    type: condition
    task:
      id: d43e037b-2aa8-4035-80bf-a8166bf91746
      version: -1
      name: Is the severity of the incident high?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "30"
      "yes":
      - "14"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: foundIncidents
                accessor: severity
            iscontext: true
          right:
            value:
              simple: "3"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1120,
          "y": 2120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: dfef391d-47fc-43b2-8a56-3c93362e8c79
    type: regular
    task:
      id: dfef391d-47fc-43b2-8a56-3c93362e8c79
      version: -1
      name: Error - final severity not calculated correctly
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: |-
          The incident severity should be high, but it isn't. This could indicate one of the following problems:
          1. The threat intelligence integration used reached its quota.
          2. The threat intelligence integration used no longer detects the malicious URL as malicious.
          3. The way we calculate severity for incidents has changed.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1120,
          "y": 2320
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: ba4e57cd-7657-4283-80b8-82cbec05cab5
    type: condition
    task:
      id: ba4e57cd-7657-4283-80b8-82cbec05cab5
      version: -1
      name: Were the URL & domain extracted successfully?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "33"
      "yes":
      - "14"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: containsGeneral
          left:
            value:
              simple: URL.Data
            iscontext: true
          right:
            value:
              simple: http://157.230.37.22/banks/Scotia/
      - - operator: containsGeneral
          left:
            value:
              simple: Domain.Name
            iscontext: true
          right:
            value:
              simple: www.scotiabank.com
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1220,
          "y": 2120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: 92aea16a-7106-42cf-8689-b0ec1063d9ba
    type: regular
    task:
      id: 92aea16a-7106-42cf-8689-b0ec1063d9ba
      version: -1
      name: Get the URL context
      description: Gets a value from the specified incident's context.
      scriptName: GetByIncidentId
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      get_key:
        simple: URL
      incident_id:
        complex:
          root: FoundID
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1230,
          "y": 1780
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: 475c38d0-b6f6-4a05-84d2-4262b41569f5
    type: regular
    task:
      id: 475c38d0-b6f6-4a05-84d2-4262b41569f5
      version: -1
      name: The URL or domain were not extracted
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      message:
        simple: The URL or the domain were not extracted properly. The legitimate URL and the malicious URL should have been extracted using incident auto-extract settings or field extraction rules (in XSOAR 6.1+). If auto-extract is OK, it could be an issue with the threat intelligence integration.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1220,
          "y": 2340
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: cd9a66b9-faa9-40c3-8201-0e7590dff462
    type: regular
    task:
      id: cd9a66b9-faa9-40c3-8201-0e7590dff462
      version: -1
      name: Get the File context
      description: Gets a value from the specified incident's context.
      scriptName: GetByIncidentId
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      get_key:
        simple: File
      incident_id:
        complex:
          root: FoundID
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1680,
          "y": 1780
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: 42dbd561-0036-4247-86a1-b0b3785f1a2d
    type: condition
    task:
      id: 42dbd561-0036-4247-86a1-b0b3785f1a2d
      version: -1
      name: Was the original email retrieved as an EML file?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "36"
      "yes":
      - "14"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: File
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: File.Extension
                      iscontext: true
                    right:
                      value:
                        simple: eml
                    ignorecase: true
                - - operator: isEqualString
                    left:
                      value:
                        simple: File.Name
                      iscontext: true
                    right:
                      value:
                        simple: Suspicious activity in your bank account [ACTION REQUIRED].eml
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1680,
          "y": 2120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: 185f045c-6b8c-4878-8a45-21c51b45a1fd
    type: regular
    task:
      id: 185f045c-6b8c-4878-8a45-21c51b45a1fd
      version: -1
      name: Email not retrieved as EML
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      message:
        simple: |-
          The original email was not retrieved at all, or was not retrieved as an EML file which is what is expected to happen.
          Possible reasons:
          - Something in the Process Email - Generic v2 or Get Original Email - Generic v2 playbooks changed.
          - Something in the EWS365 integration changed and the retrieved file is no longer retrieved as a file.
          - The email was deleted from the mailbox where it was received (probably sr-test01) by someone or something else.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1680,
          "y": 2340
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: 2abdf1c2-7a4c-44e3-82a0-ab74d6e0d6cb
    type: regular
    task:
      id: 2abdf1c2-7a4c-44e3-82a0-ab74d6e0d6cb
      version: -1
      name: Wait and manually remediate
      description: Wait and complete tasks by given status. Used for test playbooks.
      scriptName: WaitAndCompleteTask
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "38"
    scriptarguments:
      complete_task:
        simple: "true"
      incident_id:
        complex:
          root: FoundID
      interval_between_tries:
        simple: "15"
      max_timeout:
        simple: "700"
      task_name:
        simple: Manually search & delete emails
      task_states:
        simple: Waiting
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1170
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: adac6158-6034-4a0a-8436-47c37b75936e
    type: regular
    task:
      id: adac6158-6034-4a0a-8436-47c37b75936e
      version: -1
      name: Wait for incident to close
      description: Wait and complete tasks by given status. Used for test playbooks.
      scriptName: WaitAndCompleteTask
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "24"
      - "7"
      - "32"
      - "34"
      - "17"
      - "41"
    scriptarguments:
      complete_task:
        simple: "false"
      incident_id:
        complex:
          root: FoundID
      interval_between_tries:
        simple: "10"
      max_timeout:
        simple: "2500"
      task_name:
        simple: Close investigation
      task_states:
        simple: Completed
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: 68353754-1f69-4798-859d-641cf3e0fdf3
    type: regular
    task:
      id: 68353754-1f69-4798-859d-641cf3e0fdf3
      version: -1
      name: Check that URL screenshot was taken
      description: Wait and complete tasks by given status. Used for test playbooks.
      scriptName: WaitAndCompleteTask
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      complete_task:
        simple: "false"
      incident_id:
        complex:
          root: FoundID
      interval_between_tries:
        simple: "10"
      max_timeout:
        simple: "1000"
      task_name:
        simple: Get URL screenshot
      task_states:
        simple: Completed
    reputationcalc: 1
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2520,
          "y": 1940
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: 13081f13-73cb-4fd6-821b-10703efeaacc
    type: regular
    task:
      id: 13081f13-73cb-4fd6-821b-10703efeaacc
      version: -1
      name: Check that soft delete was performed
      description: Wait and complete tasks by given status. Used for test playbooks.
      scriptName: WaitAndCompleteTask
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      complete_task:
        simple: "false"
      incident_id:
        complex:
          root: FoundID
      interval_between_tries:
        simple: "10"
      max_timeout:
        simple: "1000"
      task_name:
        simple: Search action - Soft delete.
      task_states:
        simple: Completed
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 3030,
          "y": 2050
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "41":
    id: "41"
    taskid: 8d0ce478-bdcd-4cb3-814e-cc9b88053f39
    type: regular
    task:
      id: 8d0ce478-bdcd-4cb3-814e-cc9b88053f39
      version: -1
      name: Get the Domain context
      description: Gets a value from the specified incident's context.
      scriptName: GetByIncidentId
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      get_key:
        simple: Domain
      incident_id:
        complex:
          root: FoundID
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2090,
          "y": 1780
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "16_14_Yes": 0.12,
      "31_33_#default#": 0.59
    },
    "paper": {
      "dimensions": {
        "height": 2945,
        "width": 4530,
        "x": -1120,
        "y": 50
      }
    }
  }
inputs: []
outputs: []
tests:
- No tests (auto formatted)
