version: -1
name: Phishing - Core - Test - Actual Incident
description: This playbooks runs on an incident of type Phishing.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: fff6c57a-2ebc-426c-80b6-44e556efebfb
    type: start
    task:
      id: fff6c57a-2ebc-426c-80b6-44e556efebfb
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "17"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 265,
          "y": -140
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: d7c250f9-04d5-4061-8cbb-5b61ae45af82
    type: title
    task:
      id: d7c250f9-04d5-4061-8cbb-5b61ae45af82
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 390,
          "y": 2175
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: 32fbe44a-f6bb-469d-864b-8fd36f012fbd
    type: regular
    task:
      id: 32fbe44a-f6bb-469d-864b-8fd36f012fbd
      version: -1
      name: Delete Context
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "21"
    scriptarguments:
      all:
        simple: "yes"
    reputationcalc: 1
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 265,
          "y": 5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: 638d6bcf-4e2a-4fde-831e-6a2a4d914149
    type: regular
    task:
      id: 638d6bcf-4e2a-4fde-831e-6a2a4d914149
      version: -1
      name: Download EML file
      description: Sends http request. Returns the response as json.
      scriptName: http
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "24"
      - "25"
    scriptarguments:
      filename:
        simple: attachment.eml
      method:
        simple: GET
      saveAsFile:
        simple: "yes"
      url:
        simple: https://raw.githubusercontent.com/demisto/content/master/TestData/attachment_malicious_url.eml
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 265,
          "y": 505
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: f28882b4-942f-4e6b-83c5-1297e033c9cd
    type: regular
    task:
      id: f28882b4-942f-4e6b-83c5-1297e033c9cd
      version: -1
      name: Create malicious URL indicator
      description: commands.local.cmd.new.indicator
      script: Builtin|||createNewIndicator
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "23"
    scriptarguments:
      reputation:
        simple: Bad
      type:
        simple: URL
      value:
        simple: http://www.desktop-style.de
      verdict:
        simple: Malicious
    reputationcalc: 1
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 265,
          "y": 160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: 046e0da5-608c-4e7f-8f92-7ce7c0a29c07
    type: regular
    task:
      id: 046e0da5-608c-4e7f-8f92-7ce7c0a29c07
      version: -1
      name: Set phishing incident fields
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "19"
    scriptarguments:
      emailfrom:
        simple: test@demistodev.com
      emailsubject:
        simple: Hello! This is not the phishing one.
      emailto:
        simple: admin@demistodev.com
      labels:
        simple: '[{"Email/from":"test@demistodev.com"}, {"Email/to": "admin@demistodev.com"}]'
    reputationcalc: 1
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 265,
          "y": 330
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: ef7f3149-4798-4d21-8962-f0216beff1e8
    type: playbook
    task:
      id: ef7f3149-4798-4d21-8962-f0216beff1e8
      version: -1
      name: Phishing - Core
      description: |-
        Provides a basic response to phishing incidents. Playbook features:
        - Calculates reputation for all indicators
        - Extracts indicators from email attachments
        - Calculates severity for the incident based on indicator reputation
        - Updates reporting user about investigation status
        - Allows manual remediation of the incident
      playbookName: Phishing - Core
      type: playbook
      iscommand: false
      brand: ""
    scriptarguments:
      GetURLScreenshots:
        simple: "True"
    separatecontext: false
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 640,
          "y": 860
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: 8992ff65-c24a-47ed-8bdd-23dd7ec8020e
    type: playbook
    task:
      id: 8992ff65-c24a-47ed-8bdd-23dd7ec8020e
      version: -1
      name: Complete manual remediation
      description: Waits for a certain task status, and/or completes the task.
      playbookName: Wait And Complete Task By Status
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      CompleteTask:
        simple: "True"
      IncidentID:
        complex:
          root: incident
          accessor: id
      TaskName:
        simple: Manually remediate the incident
      TaskStates:
        simple: Waiting
    separatecontext: true
    loop:
      iscommand: false
      builtincondition:
      - - operator: containsGeneral
          left:
            value:
              simple: FoundTaskNames
            iscontext: true
          right:
            value:
              simple: Manually remediate the incident
      exitCondition: ""
      wait: 8
      max: 100
    view: |-
      {
        "position": {
          "x": -30,
          "y": 730
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: a3ecdcf6-6bd0-4101-8a07-0c46fa3d2413
    type: playbook
    task:
      id: a3ecdcf6-6bd0-4101-8a07-0c46fa3d2413
      version: -1
      name: Wait for incident to close
      description: Waits for a certain task status, and/or completes the task.
      playbookName: Wait And Complete Task By Status
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "27"
    scriptarguments:
      CompleteTask:
        simple: "False"
      IncidentID:
        complex:
          root: incident
          accessor: id
      TaskName:
        simple: Close investigation
      TaskStates:
        simple: Completed
    separatecontext: true
    loop:
      iscommand: false
      builtincondition:
      - - operator: containsGeneral
          left:
            value:
              simple: FoundTaskNames
            iscontext: true
          right:
            value:
              simple: Close investigation
      exitCondition: ""
      wait: 3
      max: 20
    view: |-
      {
        "position": {
          "x": -30,
          "y": 910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: e23fdb4a-3a2f-42a9-8327-6db3b6ac10f6
    type: regular
    task:
      id: e23fdb4a-3a2f-42a9-8327-6db3b6ac10f6
      version: -1
      name: Get final incident fields
      description: Searches Demisto incidents
      scriptName: SearchIncidentsV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "29"
    scriptarguments:
      id:
        complex:
          root: incident
          accessor: id
    reputationcalc: 1
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -210,
          "y": 1170
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 2d1ae422-de09-4317-88a7-d229a71968bc
    type: condition
    task:
      id: 2d1ae422-de09-4317-88a7-d229a71968bc
      version: -1
      name: Check Email Subject
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "30"
      OK:
      - "3"
    separatecontext: false
    conditions:
    - label: OK
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: foundIncidents.CustomFields.emailsubject
            iscontext: true
          right:
            value:
              simple: Test email
    view: |-
      {
        "position": {
          "x": -950,
          "y": 1520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: 11d69a46-5368-460e-8aa2-7283fc0eae0d
    type: title
    task:
      id: 11d69a46-5368-460e-8aa2-7283fc0eae0d
      version: -1
      name: Incident Field Checks
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "28"
      - "31"
      - "33"
      - "35"
      - "37"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -210,
          "y": 1340
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: cd6db655-f7bb-489a-8696-fd3220227c8a
    type: regular
    task:
      id: cd6db655-f7bb-489a-8696-fd3220227c8a
      version: -1
      name: Error about email subject
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: |-
          The Email Subject field was not set correctly. This can be for several reasons:
          1. Something in the playbook broke and we no longer setIncident for the correct field.
          2. The ParseEmailFiles script is bugged and doesn't output the correct data from the attached EML file
          3. The EML file attachment was not added to the incident for some reason (GitHub is down?).
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -960,
          "y": 1710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: 1f0c3d81-a333-40b2-8672-60dc702d49aa
    type: condition
    task:
      id: 1f0c3d81-a333-40b2-8672-60dc702d49aa
      version: -1
      name: Check Email Body
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "32"
      OK:
      - "3"
    separatecontext: false
    conditions:
    - label: OK
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: foundIncidents.CustomFields.emailbody
            iscontext: true
          right:
            value:
              simple: Body of the text
    view: |-
      {
        "position": {
          "x": -470,
          "y": 1520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: cf1d1de6-07bb-408f-8e16-aff4c0e982ed
    type: regular
    task:
      id: cf1d1de6-07bb-408f-8e16-aff4c0e982ed
      version: -1
      name: Error about email body
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      message:
        simple: |-
          The Email Body field was not set correctly. This can be for several reasons:
          1. Something in the playbook broke and we no longer setIncident for the correct field.
          2. The ParseEmailFiles script is bugged and doesn't output the correct data from the attached EML file
          3. The EML file attachment was not added to the incident for some reason (GitHub is down?).
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -470,
          "y": 1700
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: c903b22f-f324-4567-8531-a39dfd24fe28
    type: condition
    task:
      id: c903b22f-f324-4567-8531-a39dfd24fe28
      version: -1
      name: Check Email From + To
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "34"
      OK:
      - "3"
    separatecontext: false
    conditions:
    - label: OK
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: foundIncidents.CustomFields.emailfrom
            iscontext: true
          right:
            value:
              simple: example@example.com
      - - operator: isEqualString
          left:
            value:
              simple: foundIncidents.CustomFields.emailto
            iscontext: true
          right:
            value:
              simple: example1@example.com
    view: |-
      {
        "position": {
          "x": -40,
          "y": 1520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: a3ee8d32-1931-41ce-86b4-de0a46a30dda
    type: regular
    task:
      id: a3ee8d32-1931-41ce-86b4-de0a46a30dda
      version: -1
      name: Error about email from / to
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      message:
        simple: |-
          The Email From or Email To field was not set correctly. This can be for several reasons:
          1. Something in the playbook broke and we no longer setIncident for the correct field.
          2. The ParseEmailFiles script is bugged and doesn't output the correct data from the attached EML file
          3. The EML file attachment was not added to the incident for some reason (GitHub is down?).
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -40,
          "y": 1690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: a4e07aa5-fc3b-4100-8feb-e995a27c40b8
    type: condition
    task:
      id: a4e07aa5-fc3b-4100-8feb-e995a27c40b8
      version: -1
      name: Check Email Headers
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "36"
      OK:
      - "3"
    separatecontext: false
    conditions:
    - label: OK
      condition:
      - - operator: hasLength
          left:
            value:
              simple: foundIncidents.CustomFields.emailheaders
            iscontext: true
          right:
            value:
              simple: "9"
    view: |-
      {
        "position": {
          "x": 390,
          "y": 1520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: a6356ba7-93d3-449b-8b42-8968c9908a8b
    type: regular
    task:
      id: a6356ba7-93d3-449b-8b42-8968c9908a8b
      version: -1
      name: Error about email headers
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: |-
          Not all of the email headers were set correctly. This can be for several reasons:
          1. Something in the playbook broke and we no longer use SetGridField properly.
          2. The SetGridField script is bugged and doesn't set the headers correctly.
          3. The EML file attachment was not added to the incident for some reason (GitHub is down?).
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 390,
          "y": 1700
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: d693ea84-a289-4647-8af9-f18314fc13db
    type: condition
    task:
      id: d693ea84-a289-4647-8af9-f18314fc13db
      version: -1
      name: Check incident severity
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "38"
      OK:
      - "3"
    separatecontext: false
    conditions:
    - label: OK
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: foundIncidents.severity
            iscontext: true
          right:
            value:
              simple: "3"
    view: |-
      {
        "position": {
          "x": -1400,
          "y": 1520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: 507d5c22-9496-4f39-82f0-50de8e0b00f2
    type: regular
    task:
      id: 507d5c22-9496-4f39-82f0-50de8e0b00f2
      version: -1
      name: Error about incident severity
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: |-
          The severity of the incident was not set correctly. This could mean that the malicious indicator which we created in the system, was not extracted and enriched in the Phishing - Core playbook.
          If this is not the case, then the way we calculate severity for the incident might have changed.
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -1400,
          "y": 1710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 2380,
        "width": 2420,
        "x": -1400,
        "y": -140
      }
    }
  }
inputs: []
outputs: []
fromversion: 6.0.0
