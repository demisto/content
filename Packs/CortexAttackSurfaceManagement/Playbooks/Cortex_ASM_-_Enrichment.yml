id: Cortex ASM - Enrichment
version: -1
name: Cortex ASM - Enrichment
description: Used as a container folder for all enrichments of ASM alerts.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: d1449df8-7d76-4d3e-8502-dce3ac8a941b
    type: start
    task:
      id: d1449df8-7d76-4d3e-8502-dce3ac8a941b
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "1"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": -120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: 54777f8c-f741-4bdc-8d58-e49667f9e289
    type: condition
    task:
      id: 54777f8c-f741-4bdc-8d58-e49667f9e289
      version: -1
      name: Is there an IP address?
      description: Determines if the IP address has been supplied to proceed with cloud enrichment.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "57"
      "yes":
      - "35"
      - "45"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: inputs.RemoteIP
            iscontext: true
          right:
            value: {}
      - - operator: isNotEqualString
          left:
            value:
              complex:
                root: inputs.RemoteIP
            iscontext: true
          right:
            value:
              simple: None
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 10
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: c35888ff-0b77-42a0-87fc-33c8188cbb1f
    type: title
    task:
      id: c35888ff-0b77-42a0-87fc-33c8188cbb1f
      version: -1
      name: ServiceNow CMDB Enrichment
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "56"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -180,
          "y": 2610
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: 89e760fd-b66c-4fbd-86e2-0e2799edb6db
    type: condition
    task:
      id: 89e760fd-b66c-4fbd-86e2-0e2799edb6db
      version: -1
      name: Was there a result?
      description: Determines if there was a result from the previous command to continue cloud enrichment.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "3"
      "yes":
      - "7"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: ASM.ExternalService
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 765
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: 4917e65e-d407-42d6-8512-24aa3bcac514
    type: condition
    task:
      id: 4917e65e-d407-42d6-8512-24aa3bcac514
      version: -1
      name: What provider is this service?
      description: Determines which cloud provider the service is in order to direct to the correct enrichment.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "3"
      AWS:
      - "60"
    separatecontext: false
    conditions:
    - label: AWS
      condition:
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: ASM.ExternalService
                accessor: externally_detected_providers
            iscontext: true
          right:
            value:
              simple: Amazon Web Services
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 945
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: 0613c067-8533-4071-8bc3-8826bde21bd2
    type: regular
    task:
      id: 0613c067-8533-4071-8bc3-8826bde21bd2
      version: -1
      name: Get external service information
      description: Get a list of all your external services filtered by business units, externally detected providers, domain, externally inferred CVEs, active classifications, inactive classifications, service name, service type, protocol, IP address, is active, and discovery type. Maximum result limit is 100 assets.
      script: Cortex Attack Surface Management|||asm-list-external-service
      type: regular
      iscommand: true
      brand: Cortex Attack Surface Management
    nexttasks:
      '#none#':
      - "6"
    scriptarguments:
      ip_address:
        complex:
          root: alert
          accessor: remoteip
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 610
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: 5a29551f-cd20-4b04-8880-f45814e20e8f
    type: title
    task:
      id: 5a29551f-cd20-4b04-8880-f45814e20e8f
      version: -1
      name: Set Field
      description: commands.local.cmd.set.incident
      type: title
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "16"
      - "17"
      - "22"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: a0abd2e5-ec98-4d8d-891a-77411aa9e1da
    type: regular
    task:
      id: a0abd2e5-ec98-4d8d-891a-77411aa9e1da
      version: -1
      name: Set private IP grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      gridfield:
        simple: asmprivateip
      keys:
        simple: IP,Source
      val1:
        complex:
          root: AWS.EC2.Instances.NetworkInterfaces
          accessor: PrivateIpAddress
      val2:
        simple: AWS
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1000,
          "y": 1800
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: 8d707797-b68f-40a1-84d6-7b4ee6f12c87
    type: condition
    task:
      id: 8d707797-b68f-40a1-84d6-7b4ee6f12c87
      version: -1
      name: Is Cortex ASM enabled?
      description: Determines if the "Cortex Attack Surface Management" integration instance is configured to continue with cloud enrichment.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "3"
      "yes":
      - "8"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Cortex Attack Surface Management
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "14":
    id: "14"
    taskid: 97ddc74e-063b-4ddf-85e4-5eb0916c1873
    type: regular
    task:
      id: 97ddc74e-063b-4ddf-85e4-5eb0916c1873
      version: -1
      name: Set service owner grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      gridfield:
        simple: asmserviceowner
      keys:
        simple: Name,Email,Source,Timestamp
      val1:
        complex:
          root: AWS.IAM.Users
          accessor: UserName
      val2:
        simple: n/a
      val3:
        simple: AWS
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 130,
          "y": 1800
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 085ab0b0-e3b5-453d-8c08-ac918e57d3d9
    type: condition
    task:
      id: 085ab0b0-e3b5-453d-8c08-ac918e57d3d9
      version: -1
      name: Is there EC2 information?
      description: Determines if there is EC2 information to set the private IP, cloud and tags fields.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "3"
      "yes":
      - "19"
      - "29"
      - "32"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: AWS.EC2.Instances.NetworkInterfaces
                accessor: PrivateIpAddress
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1420,
          "y": 1475
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: bb6581a1-db3b-4253-8f99-63d0e271a148
    type: condition
    task:
      id: bb6581a1-db3b-4253-8f99-63d0e271a148
      version: -1
      name: Is there IAM information?
      description: Determines if there is IAM information to set the service owner field.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "3"
      "yes":
      - "20"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: AWS.IAM.Users
                accessor: UserName
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 130,
          "y": 1475
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: 0a410ef7-7688-495b-8628-06fdb95cee05
    type: title
    task:
      id: 0a410ef7-7688-495b-8628-06fdb95cee05
      version: -1
      name: Private IP
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "10"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1000,
          "y": 1675
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: 76af9bd7-dba5-468c-83e8-da04f223cef8
    type: title
    task:
      id: 76af9bd7-dba5-468c-83e8-da04f223cef8
      version: -1
      name: Service Owner
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "14"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 130,
          "y": 1675
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: 4d1d41d5-bfa2-4326-84ea-3791b54b4870
    type: title
    task:
      id: 4d1d41d5-bfa2-4326-84ea-3791b54b4870
      version: -1
      name: System IDs
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "23"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 570,
          "y": 1675
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: 34519907-ecc9-4aea-81e6-82e272f42072
    type: condition
    task:
      id: 34519907-ecc9-4aea-81e6-82e272f42072
      version: -1
      name: Is there EC2 and security group information?
      description: Determines if there is ECS and security group information to set the system IDs field.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "3"
      "yes":
      - "21"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: AWS.EC2
                accessor: Instances
            iscontext: true
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: AWS.EC2.SecurityGroups
                accessor: GroupId
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 570,
          "y": 1475
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: 93798a60-5a5c-4e81-8e5b-5475f1960b9f
    type: regular
    task:
      id: 93798a60-5a5c-4e81-8e5b-5475f1960b9f
      version: -1
      name: Set system IDs grid field (VPC)
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "24"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: AWS-VPC
      val2:
        complex:
          root: AWS.EC2.SecurityGroups
          accessor: VpcId
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 570,
          "y": 1800
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: 18b394a3-b4d7-4947-898f-92ef37ae520c
    type: regular
    task:
      id: 18b394a3-b4d7-4947-898f-92ef37ae520c
      version: -1
      name: Set system IDs grid field (SG)
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "25"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: AWS-SG
      val2:
        complex:
          root: AWS.EC2.SecurityGroups
          accessor: GroupId
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 570,
          "y": 1950
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: cb8d06e1-5925-417d-8860-fb6a5a83dd9c
    type: regular
    task:
      id: cb8d06e1-5925-417d-8860-fb6a5a83dd9c
      version: -1
      name: Set system IDs grid field (NET)
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: AWS-NET
      val2:
        complex:
          root: AWS.EC2.Instances
          accessor: SubnetId
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 570,
          "y": 2100
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: 8f373eaf-2f76-4fcf-856e-21221aab0dc9
    type: regular
    task:
      id: 8f373eaf-2f76-4fcf-856e-21221aab0dc9
      version: -1
      name: Set system IDs grid field (NIC)
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "27"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: AWS-NIC
      val2:
        complex:
          root: AWS.EC2.Instances.NetworkInterfaces
          accessor: NetworkInterfaceId
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 570,
          "y": 2260
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: 5fa1b96f-35e2-4b6a-8b7e-fd0c2e920de8
    type: regular
    task:
      id: 5fa1b96f-35e2-4b6a-8b7e-fd0c2e920de8
      version: -1
      name: Set system IDs grid field (EC2)
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: AWS-EC2
      val2:
        complex:
          root: AWS.EC2.Instances
          accessor: InstanceId
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 570,
          "y": 2410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: e6f22bc3-90bb-4ac8-8401-6ebd2142c442
    type: title
    task:
      id: e6f22bc3-90bb-4ac8-8401-6ebd2142c442
      version: -1
      name: Cloud
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "30"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1420,
          "y": 1675
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: f503bd85-9ead-41ae-8c53-9a8c0c98da93
    type: regular
    task:
      id: f503bd85-9ead-41ae-8c53-9a8c0c98da93
      version: -1
      name: Set cloud grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      gridfield:
        simple: asmcloud
      keys:
        simple: Provider,Organization,Project,Region,Other
      val1:
        simple: AWS
      val2:
        simple: n/a
      val3:
        simple: n/a
      val4:
        complex:
          root: AWS.EC2.Instances
          accessor: Region
      val5:
        complex:
          root: AWS.EC2.Instances.Placement
          accessor: AvailabilityZone
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1420,
          "y": 1800
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: e5009251-008f-4a9d-8010-41c756092369
    type: title
    task:
      id: e5009251-008f-4a9d-8010-41c756092369
      version: -1
      name: Tags
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "33"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1860,
          "y": 1675
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: eaca1dc1-1571-48d6-8d79-019e20183feb
    type: regular
    task:
      id: eaca1dc1-1571-48d6-8d79-019e20183feb
      version: -1
      name: Set tags grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      gridfield:
        simple: asmtags
      keys:
        simple: Key,Value,Source
      val1:
        complex:
          root: AWS.EC2.Instances.Tags
          accessor: Key
      val2:
        complex:
          root: AWS.EC2.Instances.Tags
          accessor: Value
      val3:
        simple: AWS
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1860,
          "y": 1800
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: e653e8d9-c904-4c6d-8f4f-70ebe4e0ffcc
    type: title
    task:
      id: e653e8d9-c904-4c6d-8f4f-70ebe4e0ffcc
      version: -1
      name: Cloud Enrichment
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "11"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: f175160f-44bd-43b8-8d3d-08e14bc6fb00
    type: title
    task:
      id: f175160f-44bd-43b8-8d3d-08e14bc6fb00
      version: -1
      name: Complete
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1260,
          "y": 4210
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: e0c3ed6d-3e3f-4c56-8d1b-1715cd280336
    type: title
    task:
      id: e0c3ed6d-3e3f-4c56-8d1b-1715cd280336
      version: -1
      name: Set Field
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "54"
      - "55"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -180,
          "y": 2870
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: 678ef2e8-fed3-4d2f-8666-eed51fe18480
    type: condition
    task:
      id: 678ef2e8-fed3-4d2f-8666-eed51fe18480
      version: -1
      name: Is ServiceNow v2 enabled?
      description: Determines if the "ServiceNow v2" integration instance is in order to find email accounts for ServiceNow usernames.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "46"
      "yes":
      - "41"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: ServiceNow v2
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -440,
          "y": 3360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "41":
    id: "41"
    taskid: b088532b-1030-429c-881d-3cdcbf90ea84
    type: regular
    task:
      id: b088532b-1030-429c-881d-3cdcbf90ea84
      version: -1
      name: Pull ServiceNow user information
      description: Pull information on the user that was "assigned_to" for CMDB object.
      script: ServiceNow v2|||servicenow-query-users
      type: regular
      iscommand: true
      brand: ServiceNow v2
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      user_id:
        complex:
          root: ServiceNowCMDB.Record.Attributes.assigned_to
          accessor: value
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -940,
          "y": 3535
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "42":
    id: "42"
    taskid: a7e08571-a1aa-4848-8866-be691dc009aa
    type: title
    task:
      id: a7e08571-a1aa-4848-8866-be691dc009aa
      version: -1
      name: Service Owner
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "40"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -440,
          "y": 3230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "43":
    id: "43"
    taskid: d5d83f77-4542-4627-86b0-c67e43401c92
    type: title
    task:
      id: d5d83f77-4542-4627-86b0-c67e43401c92
      version: -1
      name: System IDs
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "49"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 130,
          "y": 3230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "45":
    id: "45"
    taskid: 5894ca6d-7998-4465-8955-96ef714ccf1b
    type: regular
    task:
      id: 5894ca6d-7998-4465-8955-96ef714ccf1b
      version: -1
      name: Get current time
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "11"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 870,
          "y": 215
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "46":
    id: "46"
    taskid: 17a556f3-f295-42d4-873c-a85bd7081195
    type: regular
    task:
      id: 17a556f3-f295-42d4-873c-a85bd7081195
      version: -1
      name: Set service owner grid field (no email)
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "38"
    scriptarguments:
      gridfield:
        simple: asmserviceowner
      keys:
        simple: Name,Email,Source,Timestamp
      val1:
        complex:
          root: ServiceNowCMDB.Record.Attributes.assigned_to
          accessor: display_value
      val2:
        simple: n/a
      val3:
        simple: SNOW-CMDB
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -440,
          "y": 3690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "48":
    id: "48"
    taskid: ee6e9f2b-f35d-4cf5-8585-c8d13e62f054
    type: regular
    task:
      id: ee6e9f2b-f35d-4cf5-8585-c8d13e62f054
      version: -1
      name: Set service owner grid field (email)
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "38"
    scriptarguments:
      gridfield:
        simple: asmserviceowner
      keys:
        simple: Name,Email,Source,Timestamp
      val1:
        complex:
          root: ServiceNowCMDB.Record.Attributes.assigned_to
          accessor: display_value
      val2:
        complex:
          root: ServiceNow.User
          accessor: Email
      val3:
        simple: SNOW-CMDB
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -940,
          "y": 3690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "49":
    id: "49"
    taskid: ded18949-09bf-4717-87d9-e554cd2b9333
    type: regular
    task:
      id: ded18949-09bf-4717-87d9-e554cd2b9333
      version: -1
      name: Set system IDs grid field (NIC)
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "51"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: SNOW-CMDB-NIC
      val2:
        complex:
          root: ServiceNowCMDB.Records.[0]
          accessor: sys_id
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 130,
          "y": 3360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "51":
    id: "51"
    taskid: 793e96e1-1524-4b64-833d-9f3061cc59d7
    type: regular
    task:
      id: 793e96e1-1524-4b64-833d-9f3061cc59d7
      version: -1
      name: Set system IDs grid field (Parent)
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "52"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: SNOW-CMDB-Parent
      val2:
        complex:
          root: ServiceNowCMDB.Record
          accessor: SysID
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 130,
          "y": 3520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "52":
    id: "52"
    taskid: 85390d43-e7a0-4805-8626-833588f29aec
    type: regular
    task:
      id: 85390d43-e7a0-4805-8626-833588f29aec
      version: -1
      name: Set system IDs grid field (Assigned)
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "53"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: SNOW-CMDB-ASSIGN
      val2:
        complex:
          root: ServiceNowCMDB.Record.Attributes.assigned_to
          accessor: value
      val3:
        complex:
          root: ServiceNowCMDB.Record.Attributes.assigned_to
          accessor: link
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 130,
          "y": 3690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "53":
    id: "53"
    taskid: 9a116cc5-1cd1-493e-8d2d-01048f9dfcd6
    type: regular
    task:
      id: 9a116cc5-1cd1-493e-8d2d-01048f9dfcd6
      version: -1
      name: Set system IDs grid field (Company)
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "38"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: SNOW-CMDB-COMPANY
      val2:
        complex:
          root: ServiceNowCMDB.Record.Attributes.company
          accessor: value
      val3:
        complex:
          root: ServiceNowCMDB.Record.Attributes.company
          accessor: link
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 130,
          "y": 3860
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "54":
    id: "54"
    taskid: 982b585a-afe8-4cbe-8caf-956967f44a4b
    type: condition
    task:
      id: 982b585a-afe8-4cbe-8caf-956967f44a4b
      version: -1
      name: Is there ServiceNow record information?
      description: Determines if there is ServiceNow record information to set the service owner field.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "38"
      "yes":
      - "42"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: ServiceNowCMDB
                accessor: Record
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -440,
          "y": 3030
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "55":
    id: "55"
    taskid: c479944e-27dd-4d27-89e4-8baa60d5c6a9
    type: condition
    task:
      id: c479944e-27dd-4d27-89e4-8baa60d5c6a9
      version: -1
      name: Is there ServiceNow record and records information?
      description: Determines if there is ServiceNow record and records information to set the service owner field.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "38"
      "yes":
      - "43"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: ServiceNowCMDB
                accessor: Records
            iscontext: true
          right:
            value: {}
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: ServiceNowCMDB
                accessor: Record
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 130,
          "y": 3030
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "56":
    id: "56"
    taskid: 8e74798f-ebf8-4cde-82a8-c3f07a8868c4
    type: playbook
    task:
      id: 8e74798f-ebf8-4cde-82a8-c3f07a8868c4
      version: -1
      name: ServiceNow CMDB Search
      playbookName: ServiceNow CMDB Search
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "39"
    scriptarguments:
      BypassAddRecord:
        simple: "true"
      SearchCIClass:
        simple: cmdb_ci_network_adapter
      SearchQueryField:
        simple: ip_address
      SearchQueryValue:
        complex:
          root: inputs.RemoteIP
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": -180,
          "y": 2720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "57":
    id: "57"
    taskid: c09fc988-629a-41ab-87c8-feb1328e55ba
    type: title
    task:
      id: c09fc988-629a-41ab-87c8-feb1328e55ba
      version: -1
      name: continue
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "38"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1270,
          "y": 400
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "60":
    id: "60"
    taskid: 6128809c-eae7-4b12-8953-0ef2c7894e24
    type: playbook
    task:
      id: 6128809c-eae7-4b12-8953-0ef2c7894e24
      version: -1
      name: AWS - Enrichment
      description: Given the IP address this playbook enriches EC2 and IAM information.
      playbookName: AWS - Enrichment
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      AwsIP:
        complex:
          root: inputs.RemoteIP
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1140
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "11_3_#default#": 0.23,
      "54_38_#default#": 0.16,
      "55_38_#default#": 0.2,
      "6_3_#default#": 0.28,
      "7_3_#default#": 0.35
    },
    "paper": {
      "dimensions": {
        "height": 4395,
        "width": 3510,
        "x": -1270,
        "y": -120
      }
    }
  }
inputs:
- key: RemoteIP
  value:
    complex:
      root: alert
      accessor: remoteip
  required: true
  description: IP address of service
  playbookInputQuery:
outputs: []
fromversion: 6.5.0
tests:
- No tests (auto formatted)
