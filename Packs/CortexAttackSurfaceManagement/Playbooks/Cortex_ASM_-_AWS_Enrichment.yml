id: Cortex ASM - AWS Enrichment
version: -1
name: Cortex ASM - AWS Enrichment
description: Given the IP address this playbook enriches AWS information relevant to ASM alerts.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: b25d8768-11f3-4756-86ad-fc485976cd1c
    type: start
    task:
      id: b25d8768-11f3-4756-86ad-fc485976cd1c
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "19"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 0
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: 47d08d0a-69e3-4645-8828-76dc8e052018
    type: title
    task:
      id: 47d08d0a-69e3-4645-8828-76dc8e052018
      version: -1
      name: Set Field
      description: commands.local.cmd.set.incident
      type: title
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "4"
      - "9"
      - "22"
      - "29"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 330
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: e29bf2dc-01e3-4a97-831d-bec367ccd5c7
    type: regular
    task:
      id: e29bf2dc-01e3-4a97-831d-bec367ccd5c7
      version: -1
      name: Set private IP grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "30"
    scriptarguments:
      gridfield:
        simple: asmprivateip
      keys:
        simple: ip,source
      val1:
        complex:
          root: AWS.EC2.Instances.NetworkInterfaces
          accessor: PrivateIpAddress
      val2:
        simple: AWS
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 770,
          "y": 950
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: ec05bcc1-ff6f-4fc7-84d6-e6e5ddfdbc07
    type: condition
    task:
      id: ec05bcc1-ff6f-4fc7-84d6-e6e5ddfdbc07
      version: -1
      name: Is there EC2 information?
      description: Determines if there is EC2 information to set the private IP, cloud, and tags fields.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "32"
      "yes":
      - "15"
      - "6"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: AWS.EC2.Instances.NetworkInterfaces
                accessor: PrivateIpAddress
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 980,
          "y": 505
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: 9ebe91b8-3e7b-4c70-897f-b4fbbd158e59
    type: title
    task:
      id: 9ebe91b8-3e7b-4c70-897f-b4fbbd158e59
      version: -1
      name: Private IP
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "2"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 770,
          "y": 795
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: 442527df-5f69-4806-8dea-30bc6f8eb5a4
    type: title
    task:
      id: 442527df-5f69-4806-8dea-30bc6f8eb5a4
      version: -1
      name: System IDs
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "56"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: ca854e89-2950-4f69-82c0-cdf88e5d1247
    type: condition
    task:
      id: ca854e89-2950-4f69-82c0-cdf88e5d1247
      version: -1
      name: Is there EC2 and security group information?
      description: Determines if there is EC2 and security group information to set in the system IDs field.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "38"
      "yes":
      - "8"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: AWS.EC2
                accessor: Instances
            iscontext: true
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: AWS.EC2.SecurityGroups
                accessor: GroupId
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 515
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: e3876064-4756-4e6e-8f54-4a81f24169fa
    type: regular
    task:
      id: e3876064-4756-4e6e-8f54-4a81f24169fa
      version: -1
      name: Set system IDs grid field (VPC)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: type,id,link
      val1:
        simple: ASSET-VIRTUAL-NET
      val2:
        complex:
          root: AWS.EC2.SecurityGroups
          accessor: VpcId
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 1020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: c203783c-695d-406b-8dc9-ca07823b2dd5
    type: regular
    task:
      id: c203783c-695d-406b-8dc9-ca07823b2dd5
      version: -1
      name: Set system IDs grid field (SG)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "12"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: type,id,link
      val1:
        simple: ASSET-SG
      val2:
        complex:
          root: AWS.EC2.SecurityGroups
          accessor: GroupId
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 1190
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: 4e61b33f-914b-4452-84fe-0312039ae71b
    type: regular
    task:
      id: 4e61b33f-914b-4452-84fe-0312039ae71b
      version: -1
      name: Set system IDs grid field (subnet ID)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "13"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: type,id,link
      val1:
        simple: ASSET-SUBNET-ID
      val2:
        complex:
          root: AWS.EC2.Instances
          accessor: SubnetId
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 1360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: e025b490-dbe7-423d-8df9-d5d24eeb18e8
    type: regular
    task:
      id: e025b490-dbe7-423d-8df9-d5d24eeb18e8
      version: -1
      name: Set system IDs grid field (NIC)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: type,id,link
      val1:
        simple: ASSET-NIC
      val2:
        complex:
          root: AWS.EC2.Instances.NetworkInterfaces
          accessor: NetworkInterfaceId
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 1540
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "14":
    id: "14"
    taskid: 5d503986-2c6b-4ed2-86ec-391e6287d72c
    type: regular
    task:
      id: 5d503986-2c6b-4ed2-86ec-391e6287d72c
      version: -1
      name: Set system IDs grid field (EC2 ID)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "39"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: type,id,link
      val1:
        simple: ASSET-ID
      val2:
        complex:
          root: AWS.EC2.Instances
          accessor: InstanceId
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 1710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "15":
    id: "15"
    taskid: de9cfcfe-a153-446f-8b0f-fa6b5dde1c67
    type: title
    task:
      id: de9cfcfe-a153-446f-8b0f-fa6b5dde1c67
      version: -1
      name: Cloud
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "16"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1190,
          "y": 795
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: bc6cff21-c1d2-4e5c-8b24-2873597b2c9c
    type: regular
    task:
      id: bc6cff21-c1d2-4e5c-8b24-2873597b2c9c
      version: -1
      name: Set cloud grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "33"
    scriptarguments:
      gridfield:
        simple: asmcloud
      keys:
        simple: provider,organization,project,region,other
      val1:
        simple: AWS
      val2:
        simple: n/a
      val3:
        complex:
          root: AWS.EC2.Instances.NetworkInterfaces.Association
          accessor: IpOwnerId
          transformers:
          - operator: FirstArrayElement
      val4:
        complex:
          root: AWS.EC2.Instances
          accessor: Region
      val5:
        complex:
          root: AWS.EC2.Instances.Placement
          accessor: AvailabilityZone
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1190,
          "y": 950
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: b581ac52-c661-4aa7-804a-ea4421ef26e8
    type: title
    task:
      id: b581ac52-c661-4aa7-804a-ea4421ef26e8
      version: -1
      name: Tags
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "18"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1850,
          "y": 895
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: 67d4758f-539a-442e-86d3-d76c50d2cc6b
    type: regular
    task:
      id: 67d4758f-539a-442e-86d3-d76c50d2cc6b
      version: -1
      name: Set tags grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "34"
    scriptarguments:
      gridfield:
        simple: asmtags
      keys:
        simple: key,value,source
      val1:
        complex:
          root: AWS.EC2.Instances.Tags
          accessor: Key
      val2:
        complex:
          root: AWS.EC2.Instances.Tags
          accessor: Value
      val3:
        simple: AWS
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1850,
          "y": 1050
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: cadd15f7-4c88-4788-8ba8-104d1e1d40b8
    type: playbook
    task:
      id: cadd15f7-4c88-4788-8ba8-104d1e1d40b8
      version: -1
      name: AWS - Enrichment
      description: Given the IP address this playbook enriches EC2 and IAM information.
      playbookName: AWS - Enrichment
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "1"
    scriptarguments:
      AwsIP:
        complex:
          root: inputs.RemoteIP
    separatecontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 150
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: f43303fa-2d06-411d-8bac-41c19f91f324
    type: title
    task:
      id: f43303fa-2d06-411d-8bac-41c19f91f324
      version: -1
      name: Closing Steps
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "51"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2100
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: 83764637-09bd-4581-81b2-16b469347e0e
    type: condition
    task:
      id: 83764637-09bd-4581-81b2-16b469347e0e
      version: -1
      name: Are there EC2 tags?
      description: Determines if there is EC2 tag information to set the tags fields.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "32"
      "yes":
      - "17"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: AWS.EC2.Instances.Tags
                accessor: Key
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1850,
          "y": 505
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: 7958cf3d-a625-4fd5-82c7-b841d8371edb
    type: playbook
    task:
      id: 7958cf3d-a625-4fd5-82c7-b841d8371edb
      version: -1
      name: AWS - Unclaimed S3 Bucket Validation
      description: The playbook sends a HTTP get response to the hostname and validates if there is missing bucket information.
      playbookName: AWS - Unclaimed S3 Bucket Validation
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "24"
    separatecontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -530,
          "y": 810
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: 4a02ac94-0ffe-47c0-88b6-8570145e411e
    type: condition
    task:
      id: 4a02ac94-0ffe-47c0-88b6-8570145e411e
      version: -1
      name: Was an S3 bucket passed back?
      description: Determines if an S3 bucket was passed back or not.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "41"
      "yes":
      - "57"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: S3BucketName
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -530,
          "y": 995
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 88cfb45f-162a-47f8-8226-79825c0ea95e
    type: regular
    task:
      id: 88cfb45f-162a-47f8-8226-79825c0ea95e
      version: -1
      name: Set system IDs grid field (BucketName)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "40"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: type,id,link
      val1:
        simple: ASSET-ID
      val2:
        complex:
          root: S3BucketName
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -530,
          "y": 1455
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: 796b66ae-3596-4b3e-855e-bc817789f2ae
    type: condition
    task:
      id: 796b66ae-3596-4b3e-855e-bc817789f2ae
      version: -1
      name: What is the sub-alert type?
      description: Determines the ASM sub-alert type for different scans.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "41"
      Unclaimed S3 Bucket:
      - "23"
    separatecontext: false
    conditions:
    - label: Unclaimed S3 Bucket
      condition:
      - - operator: inList
          left:
            value:
              complex:
                root: inputs.ASMRuleID
                transformers:
                - operator: StripChars
                  args:
                    chars:
                      value:
                        simple: '[\"]'
            iscontext: true
          right:
            value:
              simple: UnclaimedS3Bucket
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -410,
          "y": 505
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: 94db8910-5e53-44fa-8c33-97d5b09d2f98
    type: regular
    task:
      id: 94db8910-5e53-44fa-8c33-97d5b09d2f98
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_aws
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 770,
          "y": 1140
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: f5c91425-347c-4e63-8d5e-cda1d12c78bd
    type: regular
    task:
      id: f5c91425-347c-4e63-8d5e-cda1d12c78bd
      version: -1
      name: Set false flag for completed enrichment
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_aws
      value:
        simple: "false"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1480,
          "y": 1380
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: a6c3b45a-ac70-416c-8fe9-06d85c7dbe56
    type: regular
    task:
      id: a6c3b45a-ac70-416c-8fe9-06d85c7dbe56
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_aws
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1190,
          "y": 1140
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: 4377ceb5-65ef-4dcd-8570-83ed884e3fdb
    type: regular
    task:
      id: 4377ceb5-65ef-4dcd-8570-83ed884e3fdb
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_aws
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1850,
          "y": 1240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: 4c136b25-e590-4c72-8321-47e2c73c0242
    type: regular
    task:
      id: 4c136b25-e590-4c72-8321-47e2c73c0242
      version: -1
      name: Set false flag for completed enrichment
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_aws
      value:
        simple: "false"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 520,
          "y": 1480
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: ec5e8aa5-b3ed-4637-8a7c-4c2132adcf48
    type: regular
    task:
      id: ec5e8aa5-b3ed-4637-8a7c-4c2132adcf48
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_aws
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 1880
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: 7f856d79-5fd5-4de4-8161-b9f81405e4b6
    type: regular
    task:
      id: 7f856d79-5fd5-4de4-8161-b9f81405e4b6
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_aws_s3
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -530,
          "y": 1865
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "41":
    id: "41"
    taskid: db8150ea-b5e5-4d5b-8f00-81b7919c3d2e
    type: regular
    task:
      id: db8150ea-b5e5-4d5b-8f00-81b7919c3d2e
      version: -1
      name: Set false flag for completed enrichment
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_aws_s3
      value:
        simple: "false"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -310,
          "y": 1635
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "43":
    id: "43"
    taskid: 91f6a3f1-1943-497d-85d8-65fa75379cb9
    type: regular
    task:
      id: 91f6a3f1-1943-497d-85d8-65fa75379cb9
      version: -1
      name: Set ASM enrichment status to true (s3)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Instead of a value you can enter `TIMESTAMP` to get the current timestamp in ISO format. For example:
        `!GridFieldSetup keys=ip,src,timestamp val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" val3="TIMESTAMP" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "55"
    scriptarguments:
      gridfield:
        simple: asmenrichmentstatus
      keys:
        simple: source,record_exists,timestamp
      val1:
        simple: AWS S3
      val2:
        simple: "true"
      val3:
        simple: TIMESTAMP
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 210,
          "y": 2630
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "44":
    id: "44"
    taskid: 25b685ae-879d-4ee8-83ed-e7edb62f4b7a
    type: regular
    task:
      id: 25b685ae-879d-4ee8-83ed-e7edb62f4b7a
      version: -1
      name: Set ASM enrichment status to true (AWS)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Instead of a value you can enter `TIMESTAMP` to get the current timestamp in ISO format. For example:
        `!GridFieldSetup keys=ip,src,timestamp val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" val3="TIMESTAMP" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "55"
    scriptarguments:
      gridfield:
        simple: asmenrichmentstatus
      keys:
        simple: source,record_exists,timestamp
      val1:
        simple: AWS
      val2:
        simple: "true"
      val3:
        simple: TIMESTAMP
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 690,
          "y": 2630
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "51":
    id: "51"
    taskid: 7bc1b3de-153f-434b-8187-6d754b5e8ac9
    type: condition
    task:
      id: 7bc1b3de-153f-434b-8187-6d754b5e8ac9
      version: -1
      name: Was enrichment performed?
      description: Check if enrichment was performed by checking for a value of true in the relevant flag variable.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "53"
      AWS (EC2):
      - "44"
      Both:
      - "52"
      S3:
      - "43"
    separatecontext: false
    conditions:
    - label: Both
      condition:
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: asm_enrichment_flag_aws
            iscontext: true
          right:
            value:
              simple: "true"
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: asm_enrichment_flag_aws_s3
            iscontext: true
          right:
            value:
              simple: "true"
    - label: S3
      condition:
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: asm_enrichment_flag_aws_s3
            iscontext: true
          right:
            value:
              simple: "true"
    - label: AWS (EC2)
      condition:
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: asm_enrichment_flag_aws
            iscontext: true
          right:
            value:
              simple: "true"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "52":
    id: "52"
    taskid: ab923872-8d3f-4479-8e74-2206728b6f2c
    type: title
    task:
      id: ab923872-8d3f-4479-8e74-2206728b6f2c
      version: -1
      name: Both
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "43"
      - "44"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2480
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "53":
    id: "53"
    taskid: cb2fbac4-0c17-4ec5-850e-429b99e73830
    type: regular
    task:
      id: cb2fbac4-0c17-4ec5-850e-429b99e73830
      version: -1
      name: Set ASM enrichment status to false (AWS)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Instead of a value you can enter `TIMESTAMP` to get the current timestamp in ISO format. For example:
        `!GridFieldSetup keys=ip,src,timestamp val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" val3="TIMESTAMP" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "54"
    scriptarguments:
      gridfield:
        simple: asmenrichmentstatus
      keys:
        simple: source,record_exists,timestamp
      val1:
        simple: AWS
      val2:
        simple: "false"
      val3:
        simple: TIMESTAMP
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2780
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "54":
    id: "54"
    taskid: aab5947c-1f1c-444a-8e62-dc5e08d58688
    type: regular
    task:
      id: aab5947c-1f1c-444a-8e62-dc5e08d58688
      version: -1
      name: Set ASM enrichment status to false (s3)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Instead of a value you can enter `TIMESTAMP` to get the current timestamp in ISO format. For example:
        `!GridFieldSetup keys=ip,src,timestamp val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" val3="TIMESTAMP" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "55"
    scriptarguments:
      gridfield:
        simple: asmenrichmentstatus
      keys:
        simple: source,record_exists,timestamp
      val1:
        simple: AWS S3
      val2:
        simple: "false"
      val3:
        simple: TIMESTAMP
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2970
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "55":
    id: "55"
    taskid: 33e10be7-dcd5-4484-8ec2-3a3638de84f7
    type: title
    task:
      id: 33e10be7-dcd5-4484-8ec2-3a3638de84f7
      version: -1
      name: Complete
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 3220
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "56":
    id: "56"
    taskid: a5d924b8-08c5-4e35-8d68-df9b5e9a0865
    type: regular
    task:
      id: a5d924b8-08c5-4e35-8d68-df9b5e9a0865
      version: -1
      name: Set system IDs grid field (type)
      description: Sets the type of cloud asset to the grid field for the ASM system IDs object.
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: type,id,link
      val1:
        simple: ASSET-TYPE
      val2:
        simple: AWS EC2
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 855
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "57":
    id: "57"
    taskid: e8c3724f-9891-45c0-8cef-9a7a2d20b43d
    type: regular
    task:
      id: e8c3724f-9891-45c0-8cef-9a7a2d20b43d
      version: -1
      name: Set system IDs grid field (type)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "28"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: type,id,link
      val1:
        simple: ASSET-TYPE
      val2:
        simple: AWS S3
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -530,
          "y": 1235
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "22_32_#default#": 0.32,
      "24_41_#default#": 0.23,
      "29_23_Unclaimed S3 Bucket": 0.71,
      "29_41_#default#": 0.54,
      "4_32_#default#": 0.44,
      "51_52_Both": 0.4
    },
    "paper": {
      "dimensions": {
        "height": 3285,
        "width": 2760,
        "x": -530,
        "y": 0
      }
    }
  }
inputs:
- key: RemoteIP
  value:
    complex:
      root: alert
      accessor: remoteip
  required: false
  description: IP address of service
  playbookInputQuery:
- key: ASMRuleID
  value:
    complex:
      root: alert
      accessor: asmattacksurfaceruleid
  required: true
  description: Attack Surface Management Rule ID.
  playbookInputQuery:
outputs: []
fromversion: 6.5.0
tests:
- No tests (auto formatted)
