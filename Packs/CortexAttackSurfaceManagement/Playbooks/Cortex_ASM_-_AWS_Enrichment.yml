id: Cortex ASM - AWS Enrichment
version: -1
name: Cortex ASM - AWS Enrichment
description: Given the IP address this playbook enriches AWS information relevant to ASM alerts.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 523db6f5-5906-4fcc-87f4-4d2e46b4e192
    type: start
    task:
      id: 523db6f5-5906-4fcc-87f4-4d2e46b4e192
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "19"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 0
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: d5fd8cee-ab73-49a5-8f19-277cf65085c5
    type: title
    task:
      id: d5fd8cee-ab73-49a5-8f19-277cf65085c5
      version: -1
      name: Set Field
      description: commands.local.cmd.set.incident
      type: title
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "4"
      - "9"
      - "22"
      - "29"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 330
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: d67ae23f-8145-43ce-8a58-9b535ccc21f6
    type: regular
    task:
      id: d67ae23f-8145-43ce-8a58-9b535ccc21f6
      version: -1
      name: Set private IP grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "30"
    scriptarguments:
      gridfield:
        simple: asmprivateip
      keys:
        simple: IP,Source
      val1:
        complex:
          root: AWS.EC2.Instances.NetworkInterfaces
          accessor: PrivateIpAddress
      val2:
        simple: AWS
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 770,
          "y": 950
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: d9184a47-f883-4166-8d6e-fc05f521cfa7
    type: condition
    task:
      id: d9184a47-f883-4166-8d6e-fc05f521cfa7
      version: -1
      name: Is there EC2 information?
      description: Determines if there is EC2 information to set the private IP, cloud, and tags fields.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "32"
      "yes":
      - "15"
      - "6"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: AWS.EC2.Instances.NetworkInterfaces
                accessor: PrivateIpAddress
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 980,
          "y": 505
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: 0410a32e-a5b1-4e39-8ee7-aa45637ec0b3
    type: title
    task:
      id: 0410a32e-a5b1-4e39-8ee7-aa45637ec0b3
      version: -1
      name: Private IP
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "2"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 770,
          "y": 795
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: 04e589ba-9c47-475a-877f-75c284afda7d
    type: title
    task:
      id: 04e589ba-9c47-475a-877f-75c284afda7d
      version: -1
      name: System IDs
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "10"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 110,
          "y": 755
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: 67806759-9ede-4e68-83cd-6f534e94f9b9
    type: condition
    task:
      id: 67806759-9ede-4e68-83cd-6f534e94f9b9
      version: -1
      name: Is there EC2 and security group information?
      description: Determines if there is EC2 and security group information to set in the system IDs field.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "38"
      "yes":
      - "8"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: AWS.EC2
                accessor: Instances
            iscontext: true
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: AWS.EC2.SecurityGroups
                accessor: GroupId
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 110,
          "y": 505
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: fc2b9af5-3f22-4d4f-8606-9efa867557c7
    type: regular
    task:
      id: fc2b9af5-3f22-4d4f-8606-9efa867557c7
      version: -1
      name: Set system IDs grid field (VPC)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: AWS-VPC
      val2:
        complex:
          root: AWS.EC2.SecurityGroups
          accessor: VpcId
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 110,
          "y": 880
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: 2a04004c-f926-41a4-85c1-3fa3c3d06d6d
    type: regular
    task:
      id: 2a04004c-f926-41a4-85c1-3fa3c3d06d6d
      version: -1
      name: Set system IDs grid field (SG)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "12"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: AWS-SG
      val2:
        complex:
          root: AWS.EC2.SecurityGroups
          accessor: GroupId
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 110,
          "y": 1030
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: 1552a34f-266d-4743-8ea2-039aa2fe36b1
    type: regular
    task:
      id: 1552a34f-266d-4743-8ea2-039aa2fe36b1
      version: -1
      name: Set system IDs grid field (NET)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "13"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: AWS-NET
      val2:
        complex:
          root: AWS.EC2.Instances
          accessor: SubnetId
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 110,
          "y": 1180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: 69b76141-c044-4e51-8eb2-cdf7a0352b3d
    type: regular
    task:
      id: 69b76141-c044-4e51-8eb2-cdf7a0352b3d
      version: -1
      name: Set system IDs grid field (NIC)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: AWS-NIC
      val2:
        complex:
          root: AWS.EC2.Instances.NetworkInterfaces
          accessor: NetworkInterfaceId
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 110,
          "y": 1340
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "14":
    id: "14"
    taskid: 2d14708e-3857-4c6e-864b-0094f30a740c
    type: regular
    task:
      id: 2d14708e-3857-4c6e-864b-0094f30a740c
      version: -1
      name: Set system IDs grid field (EC2)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "39"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: AWS-EC2
      val2:
        complex:
          root: AWS.EC2.Instances
          accessor: InstanceId
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 110,
          "y": 1490
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "15":
    id: "15"
    taskid: 30a7107f-cadf-4b38-8b66-fd20778ded72
    type: title
    task:
      id: 30a7107f-cadf-4b38-8b66-fd20778ded72
      version: -1
      name: Cloud
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "16"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1190,
          "y": 795
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 48d3da5c-99d7-4d3e-8a2a-aae68000b1e8
    type: regular
    task:
      id: 48d3da5c-99d7-4d3e-8a2a-aae68000b1e8
      version: -1
      name: Set cloud grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "33"
    scriptarguments:
      gridfield:
        simple: asmcloud
      keys:
        simple: Provider,Organization,Project,Region,Other
      val1:
        simple: AWS
      val2:
        simple: n/a
      val3:
        complex:
          root: AWS.EC2.Instances.NetworkInterfaces.Association
          accessor: IpOwnerId
          transformers:
          - operator: FirstArrayElement
      val4:
        complex:
          root: AWS.EC2.Instances
          accessor: Region
      val5:
        complex:
          root: AWS.EC2.Instances.Placement
          accessor: AvailabilityZone
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1190,
          "y": 950
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: a1a475b8-c762-4777-8a46-103ee539a693
    type: title
    task:
      id: a1a475b8-c762-4777-8a46-103ee539a693
      version: -1
      name: Tags
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "18"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1850,
          "y": 895
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: a6b88e53-9169-472f-85b4-456924303b84
    type: regular
    task:
      id: a6b88e53-9169-472f-85b4-456924303b84
      version: -1
      name: Set tags grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "34"
    scriptarguments:
      gridfield:
        simple: asmtags
      keys:
        simple: Key,Value,Source
      val1:
        complex:
          root: AWS.EC2.Instances.Tags
          accessor: Key
      val2:
        complex:
          root: AWS.EC2.Instances.Tags
          accessor: Value
      val3:
        simple: AWS
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1850,
          "y": 1050
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: 31c01184-3ac7-4c71-8850-18d4b6690983
    type: playbook
    task:
      id: 31c01184-3ac7-4c71-8850-18d4b6690983
      version: -1
      name: AWS - Enrichment
      description: Given the IP address this playbook enriches EC2 and IAM information.
      playbookName: AWS - Enrichment
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "1"
    scriptarguments:
      AwsIP:
        complex:
          root: inputs.RemoteIP
    separatecontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 150
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: 6958e410-13d2-4418-89f9-ffade93bccff
    type: title
    task:
      id: 6958e410-13d2-4418-89f9-ffade93bccff
      version: -1
      name: Closing Steps
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "51"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2010
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: 28c23706-9f13-41ba-89de-163584b02fcf
    type: condition
    task:
      id: 28c23706-9f13-41ba-89de-163584b02fcf
      version: -1
      name: Are there EC2 tags?
      description: Determines if there is EC2 tag information to set the tags fields.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "32"
      "yes":
      - "17"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: AWS.EC2.Instances.Tags
                accessor: Key
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1850,
          "y": 505
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: 8f6ef0be-f4a6-459e-8997-007d12176168
    type: playbook
    task:
      id: 8f6ef0be-f4a6-459e-8997-007d12176168
      version: -1
      name: AWS - Unclaimed S3 Bucket Validation
      description: The playbook sends a HTTP get response to the hostname and validates if there is missing bucket information.
      playbookName: AWS - Unclaimed S3 Bucket Validation
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "24"
    separatecontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -530,
          "y": 810
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: 3e255968-8412-469b-87d1-f00c9a1ecd16
    type: condition
    task:
      id: 3e255968-8412-469b-87d1-f00c9a1ecd16
      version: -1
      name: Was an S3 bucket passed back?
      description: Determines if an S3 bucket was passed back or not.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "41"
      "yes":
      - "28"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: S3BucketName
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -530,
          "y": 995
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 6fb47710-6922-4e3c-8696-0aa73555b806
    type: regular
    task:
      id: 6fb47710-6922-4e3c-8696-0aa73555b806
      version: -1
      name: Set system IDs grid field (BucketName)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "40"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: Type,ID,Link
      val1:
        simple: S3-BucketName
      val2:
        complex:
          root: S3BucketName
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -530,
          "y": 1245
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: d2ea2e7e-764b-4b2d-8259-e98508aa8b85
    type: condition
    task:
      id: d2ea2e7e-764b-4b2d-8259-e98508aa8b85
      version: -1
      name: What is the sub-alert type?
      description: Determines the ASM sub-alert type for different scans.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "41"
      Unclaimed S3 Bucket:
      - "23"
    separatecontext: false
    conditions:
    - label: Unclaimed S3 Bucket
      condition:
      - - operator: inList
          left:
            value:
              complex:
                root: inputs.ASMRuleID
                transformers:
                - operator: StripChars
                  args:
                    chars:
                      value:
                        simple: '[\"]'
            iscontext: true
          right:
            value:
              simple: UnclaimedS3Bucket
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -410,
          "y": 505
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: 6d862128-39f4-4f51-85d0-3eeb705ef68f
    type: regular
    task:
      id: 6d862128-39f4-4f51-85d0-3eeb705ef68f
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_aws
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 770,
          "y": 1140
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: 3d9e6657-7ea4-4a08-85b2-119c30b015a2
    type: regular
    task:
      id: 3d9e6657-7ea4-4a08-85b2-119c30b015a2
      version: -1
      name: Set false flag for completed enrichment
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_aws
      value:
        simple: "false"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1480,
          "y": 1380
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: 4001c151-e0b2-442e-8498-60dd3b0740c3
    type: regular
    task:
      id: 4001c151-e0b2-442e-8498-60dd3b0740c3
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_aws
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1190,
          "y": 1140
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: 0b131166-16cb-46d2-8151-d37134b8f505
    type: regular
    task:
      id: 0b131166-16cb-46d2-8151-d37134b8f505
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_aws
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1850,
          "y": 1240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: cf716a2d-d796-4d3b-84f2-b7879fb98220
    type: regular
    task:
      id: cf716a2d-d796-4d3b-84f2-b7879fb98220
      version: -1
      name: Set false flag for completed enrichment
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      key:
        simple: asm_enrichment_flag_aws
      value:
        simple: "false"
      append:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 520,
          "y": 1480
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: c2c1b2ed-3daa-49cc-8ad4-91df9fbae30a
    type: regular
    task:
      id: c2c1b2ed-3daa-49cc-8ad4-91df9fbae30a
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_aws
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 110,
          "y": 1650
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: 6d9faa36-22d4-4d64-8621-43cc5b0252bf
    type: regular
    task:
      id: 6d9faa36-22d4-4d64-8621-43cc5b0252bf
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_aws_s3
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -530,
          "y": 1585
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "41":
    id: "41"
    taskid: 4bd46ab1-93c3-4317-829f-0a2b48790835
    type: regular
    task:
      id: 4bd46ab1-93c3-4317-829f-0a2b48790835
      version: -1
      name: Set false flag for completed enrichment
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      key:
        simple: asm_enrichment_flag_aws_s3
      value:
        simple: "false"
      append:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -310,
          "y": 1435
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "43":
    id: "43"
    taskid: 7a4df59a-49f0-4182-8add-7e5c1f352bbd
    type: regular
    task:
      id: 7a4df59a-49f0-4182-8add-7e5c1f352bbd
      version: -1
      name: Set ASM enrichment status to true (s3)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Instead of a value you can enter `TIMESTAMP` to get the current timestamp in ISO format. For example:
        `!GridFieldSetup keys=ip,src,timestamp val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" val3="TIMESTAMP" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "55"
    scriptarguments:
      gridfield:
        simple: asmenrichmentstatus
      keys:
        simple: source,record_exists,timestamp
      val1:
        simple: AWS S3
      val2:
        simple: "true"
      val3:
        simple: TIMESTAMP
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 200,
          "y": 2540
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "44":
    id: "44"
    taskid: 77d86402-7d2f-4fa3-8342-f6b81ec9e377
    type: regular
    task:
      id: 77d86402-7d2f-4fa3-8342-f6b81ec9e377
      version: -1
      name: Set ASM enrichment status to true (AWS)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Instead of a value you can enter `TIMESTAMP` to get the current timestamp in ISO format. For example:
        `!GridFieldSetup keys=ip,src,timestamp val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" val3="TIMESTAMP" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "55"
    scriptarguments:
      gridfield:
        simple: asmenrichmentstatus
      keys:
        simple: source,record_exists,timestamp
      val1:
        simple: AWS
      val2:
        simple: "true"
      val3:
        simple: TIMESTAMP
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 680,
          "y": 2540
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "51":
    id: "51"
    taskid: cd28d732-2248-43af-8802-53e734951be1
    type: condition
    task:
      id: cd28d732-2248-43af-8802-53e734951be1
      version: -1
      name: Was enrichment performed?
      description: Check if enrichment was performed by checking for a value of true in the relevant flag variable.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "53"
      AWS (EC2):
      - "44"
      Both:
      - "52"
      S3:
      - "43"
    separatecontext: false
    conditions:
    - label: Both
      condition:
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: asm_enrichment_flag_aws
            iscontext: true
          right:
            value:
              simple: "true"
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: asm_enrichment_flag_aws_s3
            iscontext: true
          right:
            value:
              simple: "true"
    - label: S3
      condition:
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: asm_enrichment_flag_aws_s3
            iscontext: true
          right:
            value:
              simple: "true"
    - label: AWS (EC2)
      condition:
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: asm_enrichment_flag_aws
            iscontext: true
          right:
            value:
              simple: "true"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2140
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "52":
    id: "52"
    taskid: 9378d476-2718-40ec-8c09-074e98ded7a7
    type: title
    task:
      id: 9378d476-2718-40ec-8c09-074e98ded7a7
      version: -1
      name: Both
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "43"
      - "44"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2390
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "53":
    id: "53"
    taskid: 6913117a-5072-45c9-81ac-789a2b1e84ec
    type: regular
    task:
      id: 6913117a-5072-45c9-81ac-789a2b1e84ec
      version: -1
      name: Set ASM enrichment status to false (AWS)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Instead of a value you can enter `TIMESTAMP` to get the current timestamp in ISO format. For example:
        `!GridFieldSetup keys=ip,src,timestamp val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" val3="TIMESTAMP" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "54"
    scriptarguments:
      gridfield:
        simple: asmenrichmentstatus
      keys:
        simple: source,record_exists,timestamp
      val1:
        simple: AWS
      val2:
        simple: "false"
      val3:
        simple: TIMESTAMP
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 440,
          "y": 2690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "54":
    id: "54"
    taskid: 27904728-1475-4457-8bac-23ceefd53134
    type: regular
    task:
      id: 27904728-1475-4457-8bac-23ceefd53134
      version: -1
      name: Set ASM enrichment status to false (s3)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Instead of a value you can enter `TIMESTAMP` to get the current timestamp in ISO format. For example:
        `!GridFieldSetup keys=ip,src,timestamp val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" val3="TIMESTAMP" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "55"
    scriptarguments:
      gridfield:
        simple: asmenrichmentstatus
      keys:
        simple: source,record_exists,timestamp
      val1:
        simple: AWS S3
      val2:
        simple: "false"
      val3:
        simple: TIMESTAMP
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 440,
          "y": 2880
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "55":
    id: "55"
    taskid: b342a1dc-10ae-4984-8d46-8230c56f5cd0
    type: title
    task:
      id: b342a1dc-10ae-4984-8d46-8230c56f5cd0
      version: -1
      name: Complete
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 440,
          "y": 3130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "22_32_#default#": 0.32,
      "29_23_Unclaimed S3 Bucket": 0.71,
      "4_32_#default#": 0.44,
      "51_52_Both": 0.4
    },
    "paper": {
      "dimensions": {
        "height": 3195,
        "width": 2760,
        "x": -530,
        "y": 0
      }
    }
  }
inputs:
- key: RemoteIP
  value:
    complex:
      root: alert
      accessor: remoteip
  required: false
  description: IP address of service
  playbookInputQuery:
- key: ASMRuleID
  value:
    complex:
      root: alert
      accessor: asmattacksurfaceruleid
  required: true
  description: Attack Surface Management Rule ID.
  playbookInputQuery:
outputs: []
fromversion: 6.5.0
tests:
- No tests (auto formatted)
