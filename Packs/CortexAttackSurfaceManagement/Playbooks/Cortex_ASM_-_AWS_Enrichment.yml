id: Cortex ASM - AWS Enrichment
version: -1
name: Cortex ASM - AWS Enrichment
description: Given the IP address this playbook enriches AWS information relevant to ASM alerts.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 9ba2d2b0-413c-4d19-8f40-6ef1925f974a
    type: start
    task:
      id: 9ba2d2b0-413c-4d19-8f40-6ef1925f974a
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "19"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 0
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: fd243dde-60d2-46cd-8610-fa1a921b6cf4
    type: title
    task:
      id: fd243dde-60d2-46cd-8610-fa1a921b6cf4
      version: -1
      name: Set Field
      description: commands.local.cmd.set.incident
      type: title
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "4"
      - "9"
      - "22"
      - "29"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 330
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: 7fe90475-0a65-47f8-833a-96d8a1ce9f8b
    type: regular
    task:
      id: 7fe90475-0a65-47f8-833a-96d8a1ce9f8b
      version: -1
      name: Set private IP grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "30"
    scriptarguments:
      gridfield:
        simple: asmprivateip
      keys:
        simple: ip,source
      val1:
        complex:
          root: AWS.EC2.Instances.NetworkInterfaces
          accessor: PrivateIpAddress
      val2:
        simple: AWS
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 770,
          "y": 950
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: 4f3d7ed8-2b85-4a90-83d7-8d7b9e313a19
    type: condition
    task:
      id: 4f3d7ed8-2b85-4a90-83d7-8d7b9e313a19
      version: -1
      name: Is there EC2 information?
      description: Determines if there is EC2 information to set the private IP, cloud, and tags fields.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "32"
      "yes":
      - "15"
      - "6"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: AWS.EC2.Instances.NetworkInterfaces
                accessor: PrivateIpAddress
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 980,
          "y": 505
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: bd77ece9-73dc-4d8d-8101-20128a24b739
    type: title
    task:
      id: bd77ece9-73dc-4d8d-8101-20128a24b739
      version: -1
      name: Private IP
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "2"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 770,
          "y": 795
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: 9036dc30-241a-40c3-88bd-958362d0a060
    type: title
    task:
      id: 9036dc30-241a-40c3-88bd-958362d0a060
      version: -1
      name: System IDs
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "56"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: 39283a81-f494-47ec-86cd-a5e31cb1b2fb
    type: condition
    task:
      id: 39283a81-f494-47ec-86cd-a5e31cb1b2fb
      version: -1
      name: Is there EC2 and security group information?
      description: Determines if there is EC2 and security group information to set in the system IDs field.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "38"
      "yes":
      - "8"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: AWS.EC2
                accessor: Instances
            iscontext: true
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: AWS.EC2.SecurityGroups
                accessor: GroupId
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 515
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: c037aeea-6ced-4ede-80fc-d946a81134b7
    type: regular
    task:
      id: c037aeea-6ced-4ede-80fc-d946a81134b7
      version: -1
      name: Set system IDs grid field (VPC)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: type,id,link
      val1:
        simple: ASSET-VIRTUAL-NET
      val2:
        complex:
          root: AWS.EC2.SecurityGroups
          accessor: VpcId
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 1020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: c1ec02f3-c876-44a7-82d7-4378e02f6273
    type: regular
    task:
      id: c1ec02f3-c876-44a7-82d7-4378e02f6273
      version: -1
      name: Set system IDs grid field (SG)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "12"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: type,id,link
      val1:
        simple: ASSET-SG
      val2:
        complex:
          root: AWS.EC2.SecurityGroups
          accessor: GroupId
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 1190
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: 7c909839-567f-4898-8f30-b7343b4fb787
    type: regular
    task:
      id: 7c909839-567f-4898-8f30-b7343b4fb787
      version: -1
      name: Set system IDs grid field (subnet ID)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "13"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: type,id,link
      val1:
        simple: ASSET-SUBNET-ID
      val2:
        complex:
          root: AWS.EC2.Instances
          accessor: SubnetId
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 1360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: cc4f6b99-f4fe-4356-88a3-c98b470dcfd2
    type: regular
    task:
      id: cc4f6b99-f4fe-4356-88a3-c98b470dcfd2
      version: -1
      name: Set system IDs grid field (NIC)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: type,id,link
      val1:
        simple: ASSET-NIC
      val2:
        complex:
          root: AWS.EC2.Instances.NetworkInterfaces
          accessor: NetworkInterfaceId
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 1540
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "14":
    id: "14"
    taskid: cf5b199c-817b-4c37-82d3-7cc1d39d02c8
    type: regular
    task:
      id: cf5b199c-817b-4c37-82d3-7cc1d39d02c8
      version: -1
      name: Set system IDs grid field (EC2 ID)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "39"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: type,id,link
      val1:
        simple: ASSET-ID
      val2:
        complex:
          root: AWS.EC2.Instances
          accessor: InstanceId
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 1710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "15":
    id: "15"
    taskid: 5d3602ce-952f-4baf-8c9c-d0492bf4633b
    type: title
    task:
      id: 5d3602ce-952f-4baf-8c9c-d0492bf4633b
      version: -1
      name: Cloud
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "16"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1190,
          "y": 795
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 0c67b6e0-09c9-4d61-8c39-7439b3170edb
    type: regular
    task:
      id: 0c67b6e0-09c9-4d61-8c39-7439b3170edb
      version: -1
      name: Set cloud grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "33"
    scriptarguments:
      gridfield:
        simple: asmcloud
      keys:
        simple: provider,organization,project,region,other
      val1:
        simple: AWS
      val2:
        simple: n/a
      val3:
        complex:
          root: AWS.EC2.SecurityGroups
          accessor: OwnerId
      val4:
        complex:
          root: AWS.EC2.Instances
          accessor: Region
      val5:
        complex:
          root: AWS.EC2.Instances.Placement
          accessor: AvailabilityZone
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1190,
          "y": 950
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: 880c73e3-35c4-40f3-891c-4886498022c6
    type: title
    task:
      id: 880c73e3-35c4-40f3-891c-4886498022c6
      version: -1
      name: Tags
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "18"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1850,
          "y": 895
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: 87264d6c-acdd-418a-869f-19347d4af3bf
    type: regular
    task:
      id: 87264d6c-acdd-418a-869f-19347d4af3bf
      version: -1
      name: Set tags grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "34"
    scriptarguments:
      gridfield:
        simple: asmtags
      keys:
        simple: key,value,source
      val1:
        complex:
          root: AWS.EC2.Instances.Tags
          accessor: Key
      val2:
        complex:
          root: AWS.EC2.Instances.Tags
          accessor: Value
      val3:
        simple: AWS
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1850,
          "y": 1050
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: 730a58bb-8470-4243-87f6-ecc01b5b3d47
    type: playbook
    task:
      id: 730a58bb-8470-4243-87f6-ecc01b5b3d47
      version: -1
      name: AWS - Enrichment
      description: Given the IP address this playbook enriches EC2 and IAM information.
      type: playbook
      iscommand: false
      brand: ""
      playbookId: AWS - Enrichment
    nexttasks:
      '#none#':
      - "1"
    scriptarguments:
      AwsIP:
        complex:
          root: inputs.RemoteIP
      AWSAssumeRoleName:
        simple: ${inputs.AWSAssumeRoleName}
    separatecontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 150
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: 5cc8dd7f-86c3-4aa8-8c69-9b84bbb23fb9
    type: title
    task:
      id: 5cc8dd7f-86c3-4aa8-8c69-9b84bbb23fb9
      version: -1
      name: Closing Steps
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2100
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    nexttasks:
      '#none#':
      - "51"
  "22":
    id: "22"
    taskid: 8a4f0836-637e-4f44-83b6-3d6a00e1e5a7
    type: condition
    task:
      id: 8a4f0836-637e-4f44-83b6-3d6a00e1e5a7
      version: -1
      name: Are there EC2 tags?
      description: Determines if there is EC2 tag information to set the tags fields.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "32"
      "yes":
      - "17"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: AWS.EC2.Instances.Tags
                accessor: Key
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1850,
          "y": 505
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: 03213064-c48a-44c6-8c3f-6e418eb20bff
    type: playbook
    task:
      id: 03213064-c48a-44c6-8c3f-6e418eb20bff
      version: -1
      name: AWS - Unclaimed S3 Bucket Validation
      description: The playbook sends a HTTP get response to the hostname and validates if there is missing bucket information.
      type: playbook
      iscommand: false
      brand: ""
      playbookId: AWS - Unclaimed S3 Bucket Validation
    nexttasks:
      '#none#':
      - "24"
    separatecontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -530,
          "y": 810
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: f15e24e8-c8f6-4d25-8e32-5cb22006eb13
    type: condition
    task:
      id: f15e24e8-c8f6-4d25-8e32-5cb22006eb13
      version: -1
      name: Was an S3 bucket passed back?
      description: Determines if an S3 bucket was passed back or not.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "41"
      "yes":
      - "57"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: S3BucketName
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -530,
          "y": 995
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 7d589fe9-a797-40d5-8c20-196b5da90e68
    type: regular
    task:
      id: 7d589fe9-a797-40d5-8c20-196b5da90e68
      version: -1
      name: Set system IDs grid field (BucketName)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "40"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: type,id,link
      val1:
        simple: ASSET-ID
      val2:
        complex:
          root: S3BucketName
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -530,
          "y": 1455
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: 7a855bb0-13e5-43e8-8523-5690863e340c
    type: condition
    task:
      id: 7a855bb0-13e5-43e8-8523-5690863e340c
      version: -1
      name: What is the sub-alert type?
      description: Determines the ASM sub-alert type for different scans.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "41"
      Unclaimed S3 Bucket:
      - "23"
    separatecontext: false
    conditions:
    - label: Unclaimed S3 Bucket
      condition:
      - - operator: inList
          left:
            value:
              complex:
                root: inputs.ASMRuleID
                transformers:
                - operator: StripChars
                  args:
                    chars:
                      value:
                        simple: '[\"]'
            iscontext: true
          right:
            value:
              simple: UnclaimedS3Bucket
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -410,
          "y": 505
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: 19be6db9-5d0f-437f-8a55-0cdcb07a2cc6
    type: regular
    task:
      id: 19be6db9-5d0f-437f-8a55-0cdcb07a2cc6
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_aws
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 770,
          "y": 1140
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: 017f9cf1-741b-4543-8fe7-db50d10004b0
    type: regular
    task:
      id: 017f9cf1-741b-4543-8fe7-db50d10004b0
      version: -1
      name: Set false flag for completed enrichment
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_aws
      value:
        simple: "false"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1480,
          "y": 1380
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: 7ba582fc-f295-4766-8909-fd1239193d52
    type: regular
    task:
      id: 7ba582fc-f295-4766-8909-fd1239193d52
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_aws
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1190,
          "y": 1140
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: bf81caff-1cde-4f25-8f9e-0b0bcf0cdb91
    type: regular
    task:
      id: bf81caff-1cde-4f25-8f9e-0b0bcf0cdb91
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_aws
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1850,
          "y": 1240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: c42824aa-84fc-4f0e-8fd0-094e3f307ca4
    type: regular
    task:
      id: c42824aa-84fc-4f0e-8fd0-094e3f307ca4
      version: -1
      name: Set false flag for completed enrichment
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_aws
      value:
        simple: "false"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 520,
          "y": 1480
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: 91d773c3-780e-4865-8c96-33522f746832
    type: regular
    task:
      id: 91d773c3-780e-4865-8c96-33522f746832
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_aws
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 1880
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: 3406e5ca-cb7a-48af-8ed0-dffbb3070514
    type: regular
    task:
      id: 3406e5ca-cb7a-48af-8ed0-dffbb3070514
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_aws_s3
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -530,
          "y": 1865
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "41":
    id: "41"
    taskid: be11023f-968c-4460-8df9-196716c66ac9
    type: regular
    task:
      id: be11023f-968c-4460-8df9-196716c66ac9
      version: -1
      name: Set false flag for completed enrichment
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_aws_s3
      value:
        simple: "false"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -310,
          "y": 1635
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "43":
    id: "43"
    taskid: f1b7412c-b2b8-41ab-8827-cd41240db516
    type: regular
    task:
      id: f1b7412c-b2b8-41ab-8827-cd41240db516
      version: -1
      name: Set ASM enrichment status to true (s3)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Instead of a value you can enter `TIMESTAMP` to get the current timestamp in ISO format. For example:
        `!GridFieldSetup keys=ip,src,timestamp val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" val3="TIMESTAMP" gridfiled="gridfield"`
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "55"
    scriptarguments:
      gridfield:
        simple: asmenrichmentstatus
      keys:
        simple: source,record_exists,timestamp
      val1:
        simple: AWS S3
      val2:
        simple: "true"
      val3:
        simple: TIMESTAMP
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 210,
          "y": 2630
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "44":
    id: "44"
    taskid: d502cf01-8c73-4ada-8af6-b41608c3c30a
    type: regular
    task:
      id: d502cf01-8c73-4ada-8af6-b41608c3c30a
      version: -1
      name: Set ASM enrichment status to true (AWS)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Instead of a value you can enter `TIMESTAMP` to get the current timestamp in ISO format. For example:
        `!GridFieldSetup keys=ip,src,timestamp val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" val3="TIMESTAMP" gridfiled="gridfield"`
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "55"
    scriptarguments:
      gridfield:
        simple: asmenrichmentstatus
      keys:
        simple: source,record_exists,timestamp
      val1:
        simple: AWS
      val2:
        simple: "true"
      val3:
        simple: TIMESTAMP
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 690,
          "y": 2630
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "51":
    id: "51"
    taskid: aa2b00b2-749b-487b-86ef-9fde26ed1ff8
    type: condition
    task:
      id: aa2b00b2-749b-487b-86ef-9fde26ed1ff8
      version: -1
      name: Was enrichment performed?
      description: Check if enrichment was performed by checking for a value of true in the relevant flag variable.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "53"
      AWS (EC2):
      - "44"
      Both:
      - "52"
      S3:
      - "43"
    separatecontext: false
    conditions:
    - label: Both
      condition:
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: asm_enrichment_flag_aws
            iscontext: true
          right:
            value:
              simple: "true"
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: asm_enrichment_flag_aws_s3
            iscontext: true
          right:
            value:
              simple: "true"
    - label: S3
      condition:
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: asm_enrichment_flag_aws_s3
            iscontext: true
          right:
            value:
              simple: "true"
    - label: AWS (EC2)
      condition:
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: asm_enrichment_flag_aws
            iscontext: true
          right:
            value:
              simple: "true"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "52":
    id: "52"
    taskid: 22bb0fa5-4cfe-4e97-892b-3a843f322a75
    type: title
    task:
      id: 22bb0fa5-4cfe-4e97-892b-3a843f322a75
      version: -1
      name: Both
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "43"
      - "44"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2480
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "53":
    id: "53"
    taskid: a5713beb-2c17-40ec-880c-be778ed3dd0e
    type: regular
    task:
      id: a5713beb-2c17-40ec-880c-be778ed3dd0e
      version: -1
      name: Set ASM enrichment status to false (AWS)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Instead of a value you can enter `TIMESTAMP` to get the current timestamp in ISO format. For example:
        `!GridFieldSetup keys=ip,src,timestamp val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" val3="TIMESTAMP" gridfiled="gridfield"`
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "54"
    scriptarguments:
      gridfield:
        simple: asmenrichmentstatus
      keys:
        simple: source,record_exists,timestamp
      val1:
        simple: AWS
      val2:
        simple: "false"
      val3:
        simple: TIMESTAMP
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2780
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "54":
    id: "54"
    taskid: 38ba8ced-48e2-410a-8a65-93af8c8e4078
    type: regular
    task:
      id: 38ba8ced-48e2-410a-8a65-93af8c8e4078
      version: -1
      name: Set ASM enrichment status to false (s3)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Instead of a value you can enter `TIMESTAMP` to get the current timestamp in ISO format. For example:
        `!GridFieldSetup keys=ip,src,timestamp val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" val3="TIMESTAMP" gridfiled="gridfield"`
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "55"
    scriptarguments:
      gridfield:
        simple: asmenrichmentstatus
      keys:
        simple: source,record_exists,timestamp
      val1:
        simple: AWS S3
      val2:
        simple: "false"
      val3:
        simple: TIMESTAMP
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2970
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "55":
    id: "55"
    taskid: 09b4bed6-aad2-44b5-841c-b0f5bb85a0da
    type: title
    task:
      id: 09b4bed6-aad2-44b5-841c-b0f5bb85a0da
      version: -1
      name: Complete
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": 3220
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "56":
    id: "56"
    taskid: 46e7dc6a-e581-4ade-8e88-45144041459b
    type: regular
    task:
      id: 46e7dc6a-e581-4ade-8e88-45144041459b
      version: -1
      name: Set system IDs grid field (type)
      description: Sets the type of cloud asset to the grid field for the ASM system IDs object.
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: type,id,link
      val1:
        simple: ASSET-TYPE
      val2:
        simple: AWS EC2
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 855
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "57":
    id: "57"
    taskid: 5bffc949-1f23-4c8c-8272-1b038726a0b3
    type: regular
    task:
      id: 5bffc949-1f23-4c8c-8272-1b038726a0b3
      version: -1
      name: Set system IDs grid field (type)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "28"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: type,id,link
      val1:
        simple: ASSET-TYPE
      val2:
        simple: AWS S3
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -530,
          "y": 1235
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "22_32_#default#": 0.32,
      "24_41_#default#": 0.23,
      "29_23_Unclaimed S3 Bucket": 0.71,
      "29_41_#default#": 0.54,
      "4_32_#default#": 0.44,
      "51_52_Both": 0.4
    },
    "paper": {
      "dimensions": {
        "height": 3285,
        "width": 2760,
        "x": -530,
        "y": 0
      }
    }
  }
inputs:
- key: RemoteIP
  value:
    complex:
      root: alert
      accessor: remoteip
  required: false
  description: IP address of service
  playbookInputQuery:
- key: ASMRuleID
  value:
    complex:
      root: alert
      accessor: asmattacksurfaceruleid
  required: true
  description: Attack Surface Management Rule ID.
  playbookInputQuery:
- description: If assuming roles for AWS, this is the name of the role to assume (should be the same for all organizations).
  key: AWSAssumeRoleName
  playbookInputQuery:
  required: false
  value: {}
outputs: []
tests:
- No tests (auto formatted)
fromversion: 6.5.0
