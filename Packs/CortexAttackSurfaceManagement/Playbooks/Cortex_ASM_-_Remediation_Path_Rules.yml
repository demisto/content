id: Cortex ASM - Remediation Path Rules
version: -1
name: Cortex ASM - Remediation Path Rules
description: This playbook returns "RemediationAction" options based on the return from the Remediation Path Rules API, or defaults to data collection task.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: f1d641cb-5c08-4f6e-845f-ebe6496e022a
    type: start
    task:
      id: f1d641cb-5c08-4f6e-845f-ebe6496e022a
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "51"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 490,
          "y": -2150
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: 6d53bedc-d81f-4285-8e6e-dc97f4614354
    type: regular
    task:
      id: 6d53bedc-d81f-4285-8e6e-dc97f4614354
      version: -1
      name: List remediation path rules
      description: Returns list of remediation path rules.
      script: '|||asm-list-remediation-rule'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      asm_rule_id:
        complex:
          root: alert
          accessor: asmattacksurfaceruleid
          transformers:
          - operator: StripChars
            args:
              chars:
                value:
                  simple: '[\"]'
      sort_by_creation_time:
        simple: desc
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 470,
          "y": 405
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: 9df5d879-eeb5-40c3-8eb8-aceb4ec9618c
    type: condition
    task:
      id: 9df5d879-eeb5-40c3-8eb8-aceb4ec9618c
      version: -1
      name: Was there a result?
      description: Determines if there was a result from the previous command to continue.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "45"
      "yes":
      - "4"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: ASM.RemediationRule
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 470,
          "y": 575
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: 22599bbd-9854-465e-8df9-66064c1b0c36
    type: regular
    task:
      id: 22599bbd-9854-465e-8df9-66064c1b0c36
      version: -1
      name: Evaluate remediation path rules
      description: For a given alert and remediation path rules that are defined for that alert's attack surface rule, this takes each remediation path rule and looks at the rule criteria too see if the rule matches for the given alert. If multiple rules match, it will return the most recently created rule. This assumes that the rules passed in are filtered to correlate with the alert's attack surface rule.
      type: regular
      iscommand: false
      brand: ""
      script: RemediationPathRuleEvaluation
    nexttasks:
      '#none#':
      - "22"
    scriptarguments:
      cloud_managed:
        complex:
          root: alert
          accessor: asmcloud
      development_environment:
        complex:
          root: alert.asmdevcheckdetails
          accessor: result
      ip:
        complex:
          root: alert
          accessor: remoteip
      providers:
        complex:
          root: inputs.ExternallyDetectedProviders
      remediation_path_rules:
        complex:
          root: ASM
          accessor: RemediationRule
      service_owner_identified:
        complex:
          root: alert
          accessor: asmserviceowner
      severity:
        complex:
          root: alert
          accessor: severity
      tags:
        complex:
          root: alert
          accessor: asmtags
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 470,
          "y": 750
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: 02723b92-4f05-4d1a-8fa2-c3857e794069
    type: title
    task:
      id: 02723b92-4f05-4d1a-8fa2-c3857e794069
      version: -1
      name: Complete
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1855
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: 9a61e92b-ebd0-42f8-86e3-48a46c7ba7f6
    type: condition
    task:
      id: 9a61e92b-ebd0-42f8-86e3-48a46c7ba7f6
      version: -1
      name: Meets automated remediation requirements?
      description: Determines if the alert meets the criteria for automated remediation.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "20"
      Cortex Endpoint:
      - "52"
      Unclaimed S3 Bucket:
      - "33"
      "yes":
      - "34"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: inList
          left:
            value:
              complex:
                root: alert
                accessor: asmattacksurfaceruleid
                transformers:
                - operator: StripChars
                  args:
                    chars:
                      value:
                        simple: '[\"]'
            iscontext: true
          right:
            value:
              simple: remediationattacksurfacerules
            iscontext: true
      - - operator: inList
          left:
            value:
              complex:
                root: alert.asmcloud
                accessor: provider
            iscontext: true
          right:
            value:
              simple: AWS,GCP,Azure,On Prem
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: alert
                accessor: asmserviceowner
            iscontext: true
      - - operator: isTrue
          left:
            value:
              complex:
                root: alert.asmdevcheckdetails
                accessor: result
            iscontext: true
          ignorecase: true
        - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.BypassDevCheck
            iscontext: true
          right:
            value:
              simple: "True"
    - label: Cortex Endpoint
      condition:
      - - operator: inList
          left:
            value:
              complex:
                root: alert
                accessor: asmattacksurfaceruleid
                transformers:
                - operator: StripChars
                  args:
                    chars:
                      value:
                        simple: '[\"]'
            iscontext: true
          right:
            value:
              simple: remediationattacksurfacerules
            iscontext: true
      - - operator: isExists
          left:
            value:
              complex:
                root: alert.asmenrichmentstatus
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: alert.asmenrichmentstatus.source
                      iscontext: true
                    right:
                      value:
                        simple: CORTEX-ENDPOINT
                - - operator: isEqualString
                    left:
                      value:
                        simple: alert.asmenrichmentstatus.record_exists
                      iscontext: true
                    right:
                      value:
                        simple: "true"
                  - operator: isTrue
                    left:
                      value:
                        simple: alert.asmenrichmentstatus.record_exists
                      iscontext: true
            iscontext: true
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: alert
                accessor: asmserviceowner
            iscontext: true
      - - operator: isTrue
          left:
            value:
              complex:
                root: alert.asmdevcheckdetails
                accessor: result
            iscontext: true
          ignorecase: true
        - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.BypassDevCheck
            iscontext: true
          right:
            value:
              simple: "True"
    - label: Unclaimed S3 Bucket
      condition:
      - - operator: inList
          left:
            value:
              complex:
                root: alert
                accessor: asmattacksurfaceruleid
                transformers:
                - operator: StripChars
                  args:
                    chars:
                      value:
                        simple: '[\"]'
            iscontext: true
          right:
            value:
              simple: UnclaimedS3Bucket
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: AWS - S3
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 490,
          "y": -1830
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: e6ed66bb-f03a-44ad-8869-cbcad1bc5c7e
    type: condition
    task:
      id: e6ed66bb-f03a-44ad-8869-cbcad1bc5c7e
      version: -1
      name: Is Cortex ASM enabled?
      description: Determines if the "Cortex Attack Surface Management" integration instance is configured to pull Remediation Path Rules.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "45"
      "yes":
      - "1"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Cortex Attack Surface Management
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 470,
          "y": 230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 872e7d75-7798-4745-8c45-9c5d67833adc
    type: condition
    task:
      id: 872e7d75-7798-4745-8c45-9c5d67833adc
      version: -1
      name: Is ServiceNow v2 enabled?
      description: Determines if the "ServiceNow v2" integration instance is enabled in order to send ServiceNow tickets as notifications.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "18"
      "yes":
      - "17"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: ServiceNow v2
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -170,
          "y": -750
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: 7a5830bc-6940-4622-854d-5cc41bea9678
    type: regular
    task:
      id: 7a5830bc-6940-4622-854d-5cc41bea9678
      version: -1
      name: Set ServiceNowv2Enabled to true
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "37"
    scriptarguments:
      key:
        simple: ServiceNowv2Enabled
      value:
        simple: "True"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -170,
          "y": -550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: 18f501de-2d4c-45bf-81b3-015a4130a2e3
    type: regular
    task:
      id: 18f501de-2d4c-45bf-81b3-015a4130a2e3
      version: -1
      name: Set ServiceNowv2Enabled to false
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "43"
    scriptarguments:
      key:
        simple: ServiceNowv2Enabled
      value:
        simple: "False"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -580,
          "y": -540
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: 9f25d9ed-b762-4a00-87e9-afa7994391e8
    type: regular
    task:
      id: 9f25d9ed-b762-4a00-87e9-afa7994391e8
      version: -1
      name: Set AutoRemediationRequirements to true
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "36"
    scriptarguments:
      key:
        simple: AutoRemediationRequirements
      value:
        simple: "True"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 470,
          "y": -1210
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: f51f4a24-b789-48c5-846d-4db40bc79d4f
    type: regular
    task:
      id: f51f4a24-b789-48c5-846d-4db40bc79d4f
      version: -1
      name: Set AutoRemediationRequirements to false
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "36"
    scriptarguments:
      key:
        simple: AutoRemediationRequirements
      value:
        simple: "False"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -110,
          "y": -1475
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: b04443f9-0b6e-41af-876e-a39a746c444d
    type: condition
    task:
      id: b04443f9-0b6e-41af-876e-a39a746c444d
      version: -1
      name: Was there a match?
      description: Determines if a matching remediation path rule was found based on population of the "ASM - Remediation Path Rule" field.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "45"
      "yes":
      - "23"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: alert
                accessor: asmremediationpathrule
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 470,
          "y": 910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: 673dc3c7-b5e7-44d2-8d1f-b99c49e38459
    type: condition
    task:
      id: 673dc3c7-b5e7-44d2-8d1f-b99c49e38459
      version: -1
      name: What is the action of the matched rule?
      description: Determines what is returned to the parent playbook based on contents of "ASM - Remediation Path Rule" field and other requirements.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "45"
      Jira:
      - "48"
      Manual:
      - "27"
      return AR:
      - "24"
      return Email:
      - "26"
      return SNOW:
      - "25"
      Slack:
      - "57"
    separatecontext: false
    conditions:
    - label: return AR
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: alert.asmremediationpathrule
                accessor: action
            iscontext: true
          right:
            value:
              simple: automated_remediation
      - - operator: isEqualString
          left:
            value:
              simple: AutoRemediationRequirements
            iscontext: true
          right:
            value:
              simple: "True"
    - label: return SNOW
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: alert.asmremediationpathrule
                accessor: action
            iscontext: true
          right:
            value:
              simple: servicenow
      - - operator: isEqualString
          left:
            value:
              simple: ServiceNowv2Enabled
            iscontext: true
          right:
            value:
              simple: "True"
    - label: return Email
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: alert.asmremediationpathrule
                accessor: action
            iscontext: true
          right:
            value:
              simple: email
    - label: Manual
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: alert.asmremediationpathrule
                accessor: action
            iscontext: true
          right:
            value:
              simple: manual_remediation
    - label: Jira
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: ASM.RemediationRule
                accessor: action
            iscontext: true
          right:
            value:
              simple: jira
      - - operator: isEqualString
          left:
            value:
              complex:
                root: JiraEnabled
            iscontext: true
          right:
            value:
              simple: "True"
    - condition:
      - - left:
            iscontext: true
            value:
              simple: ASM.RemediationRule.action
          operator: isEqualString
          right:
            value:
              simple: slack
        - left:
            iscontext: true
            value:
              simple: SlackEnabled
          operator: isEqualString
          right:
            value:
              simple: "True"
      label: Slack
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 470,
          "y": 1120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: 5f6db26e-c815-46c0-8526-6cafe69162a7
    type: regular
    task:
      id: 5f6db26e-c815-46c0-8526-6cafe69162a7
      version: -1
      name: Return AR
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      key:
        simple: RemediationAction
      value:
        simple: AR
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 40,
          "y": 1350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: 3a779211-73aa-4227-8d4b-e226266aecf9
    type: regular
    task:
      id: 3a779211-73aa-4227-8d4b-e226266aecf9
      version: -1
      name: Return SNOW
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      key:
        simple: RemediationAction
      value:
        simple: SNOW
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: cacdb1e1-788f-4206-8efe-e80c54afbc53
    type: regular
    task:
      id: cacdb1e1-788f-4206-8efe-e80c54afbc53
      version: -1
      name: Return Email
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      key:
        simple: RemediationAction
      value:
        simple: Email
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 890,
          "y": 1350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: d7d4f883-128c-4d9d-8fab-105b0daae9d6
    type: regular
    task:
      id: d7d4f883-128c-4d9d-8fab-105b0daae9d6
      version: -1
      name: Return Manual
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      key:
        simple: RemediationAction
      value:
        simple: Manual
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1310,
          "y": 1350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: df241042-452b-4119-86b3-d03f6ec228b0
    type: regular
    task:
      id: df241042-452b-4119-86b3-d03f6ec228b0
      version: -1
      name: Get current time
      description: |
        Retrieves the current date and time.
      type: regular
      iscommand: false
      brand: ""
      script: GetTime
    nexttasks:
      '#none#':
      - "32"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1530
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: 54580754-7324-4b6f-8fb8-b8812d59472a
    type: regular
    task:
      id: 54580754-7324-4b6f-8fb8-b8812d59472a
      version: -1
      name: Set timestamp
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "6"
    scriptarguments:
      key:
        simple: RPR_Timestamp
      value:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1670
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: 4de8a07c-0f69-4ec7-8ab1-eedb57c82b87
    type: title
    task:
      id: 4de8a07c-0f69-4ec7-8ab1-eedb57c82b87
      version: -1
      name: Also True
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "35"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1210,
          "y": -1590
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: fe46ce0d-166d-4ac5-8853-7b020dae803c
    type: regular
    task:
      id: fe46ce0d-166d-4ac5-8853-7b020dae803c
      version: -1
      name: Set remediationoptions context (AR ports)
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "19"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: remediationoptions
      value:
        simple: Automated remediation by restricting open ports
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 300,
          "y": -1475
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: f66a622d-5407-40d5-8ba7-18fe4e140e28
    type: regular
    task:
      id: f66a622d-5407-40d5-8ba7-18fe4e140e28
      version: -1
      name: Set remediationoptions context (AR S3)
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "19"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: remediationoptions
      value:
        simple: Automated remediation by creating empty S3 bucket
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1210,
          "y": -1475
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: 1ffe487c-5824-4193-8a27-31b564884200
    type: title
    task:
      id: 1ffe487c-5824-4193-8a27-31b564884200
      version: -1
      name: Notification Check
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "16"
      - "49"
      - "56"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 470,
          "y": -955
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: b6742788-2eab-48d7-801d-fb177fddc2ef
    type: regular
    task:
      id: b6742788-2eab-48d7-801d-fb177fddc2ef
      version: -1
      name: Set remediationoptions context (SNOW)
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "43"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: remediationoptions
      value:
        simple: File a ServiceNow Ticket
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -170,
          "y": -390
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: 909f6cfe-e0f7-4a9b-864f-de30c442d850
    type: regular
    task:
      id: 909f6cfe-e0f7-4a9b-864f-de30c442d850
      version: -1
      name: Set JiraEnabled to true
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "42"
    scriptarguments:
      key:
        simple: JiraEnabled
      value:
        simple: "True"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 270,
          "y": -550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: 85b0b148-69ca-45bc-8d6b-04e072eda19b
    type: regular
    task:
      id: 85b0b148-69ca-45bc-8d6b-04e072eda19b
      version: -1
      name: Set JiraEnabled to false
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "43"
    scriptarguments:
      key:
        simple: JiraEnabled
      value:
        simple: "False"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 680,
          "y": -550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "42":
    id: "42"
    taskid: f2a81c15-a56e-4dc8-8036-84a48240154b
    type: regular
    task:
      id: f2a81c15-a56e-4dc8-8036-84a48240154b
      version: -1
      name: Set remediationoptions context (Jira)
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "43"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: remediationoptions
      value:
        simple: File a Jira Ticket
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 270,
          "y": -390
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "43":
    id: "43"
    taskid: e70816ef-97c2-48cc-8bb7-9f9db73848dd
    type: regular
    task:
      id: e70816ef-97c2-48cc-8bb7-9f9db73848dd
      version: -1
      name: Set remediationoptions context (Email)
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "44"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: remediationoptions
      value:
        simple: Send a notification email
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": -110
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "44":
    id: "44"
    taskid: 4dd679b5-46a7-4861-8392-a11b98d7f868
    type: regular
    task:
      id: 4dd679b5-46a7-4861-8392-a11b98d7f868
      version: -1
      name: Set remediationoptions context (Manual)
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "13"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: remediationoptions
      value:
        simple: Manual remediation
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": 50
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "45":
    id: "45"
    taskid: 07bc720d-5745-4f20-8367-094894f285ca
    type: collection
    task:
      id: 07bc720d-5745-4f20-8367-094894f285ca
      version: -1
      name: Select remediation action (dynamic)
      description: Determines the next action (remediation or ticket) based on user input. Options are based on if ServiceNowV2 integration is set up and/or the alert meets the requirement for automated remediation.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "46"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -370,
          "y": 1350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
        simple: Select Remediation Action
      body:
        simple: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean at https://pan.dev.
      methods: []
      format: html
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: What remediation action would you like to take?
        required: true
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - complex:
            root: ${remediationoptions}
        fieldassociated: ""
        placeholder: ""
        tooltip: A selection is necessary in order for the playbook to progress further.
        readonly: false
      title: Select a remediation option
      description: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean at https://pan.dev.
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "46":
    id: "46"
    taskid: a2513b43-b1d0-4d13-8311-6396fd8c6250
    type: regular
    task:
      id: a2513b43-b1d0-4d13-8311-6396fd8c6250
      version: -1
      name: Set data collection grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Instead of a value you can enter `TIMESTAMP` to get the current timestamp in ISO format.  Example of the command:
        `!GridFieldSetup keys=ip,src,timestamp val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" val3="TIMESTAMP" gridfiled="gridfield"`
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "47"
    scriptarguments:
      gridfield:
        simple: asmdatacollection
      keys:
        simple: options,selected,answerer,timestamp
      val1:
        simple: What remediation action would you like to take?
      val2:
        complex:
          root: Select a remediation option.Answers
          accessor: "0"
          transformers:
          - operator: LastArrayElement
      val3:
        complex:
          root: Select a remediation option.Answers
          accessor: name
          transformers:
          - operator: LastArrayElement
      val4:
        simple: TIMESTAMP
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -370,
          "y": 1510
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "47":
    id: "47"
    taskid: 5a2c5b2d-7d92-4fbf-8e7d-678217ad68aa
    type: regular
    task:
      id: 5a2c5b2d-7d92-4fbf-8e7d-678217ad68aa
      version: -1
      name: Set playbook stage grid field (decision)
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. Instead of a value, you can enter `TIMESTAMP` to get the current timestamp in ISO format.  Example of the command:
        `!GridFieldSetup keys=ip,src,timestamp val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" val3="TIMESTAMP" gridfiled="gridfield"`
      type: regular
      iscommand: false
      brand: ""
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "6"
    scriptarguments:
      gridfield:
        simple: asmplaybookstage
      keys:
        simple: stage,timestamp
      val1:
        simple: decision
      val2:
        simple: TIMESTAMP
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -370,
          "y": 1680
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "48":
    id: "48"
    taskid: dba10119-d0ef-46c6-87d8-18c0b4bc114c
    type: regular
    task:
      id: dba10119-d0ef-46c6-87d8-18c0b4bc114c
      version: -1
      name: Return Jira
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      key:
        simple: RemediationAction
      value:
        simple: Jira
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1720,
          "y": 1350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "49":
    id: "49"
    taskid: 52f28b8b-f66b-4d11-84f0-f1ab7f28e3a0
    type: condition
    task:
      id: 52f28b8b-f66b-4d11-84f0-f1ab7f28e3a0
      version: -1
      name: Is Atlassian Jira v2 or v3 enabled?
      description: Determines if the "Atlassian Jira v2" or "Atlassian Jira v3" integration instance is enabled in order to send Jira tickets as notifications.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "40"
      "yes":
      - "39"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: jira-v2
                  - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Jira V3
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 470,
          "y": -750
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "51":
    id: "51"
    taskid: 58720e77-debb-4205-8a8d-245c18f42bf5
    type: regular
    task:
      id: 58720e77-debb-4205-8a8d-245c18f42bf5
      version: -1
      name: Set Attack Surface Rules list
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      key:
        simple: remediationattacksurfacerules
      value:
        simple: RdpServer,InsecureOpenSSH,TelnetServer,UnencryptedFtpServer,OpenSSH,SshServer,SnmpServer,MysqlServer,MongoServer,PostgresServer,ElasticsearchServer,SSHTerrapinAttack
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 490,
          "y": -2010
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "52":
    id: "52"
    taskid: 20584fc7-7e06-45f2-8055-6a44a1e36af2
    type: regular
    task:
      id: 20584fc7-7e06-45f2-8055-6a44a1e36af2
      version: -1
      name: Set remediationoptions context (AR Cortex Endpoint)
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "19"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: remediationoptions
      value:
        simple: Automated remediation by isolating the endpoint on the network
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 750,
          "y": -1475
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "53":
    continueonerrortype: ""
    id: "53"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "55"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: SlackEnabled
      value:
        simple: "True"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set a value in context under the key you entered.
      id: 314f9e04-2477-47a7-83dc-a8b21d48b006
      iscommand: false
      name: Set SlackEnabled to true
      script: Set
      type: regular
      version: -1
    taskid: 314f9e04-2477-47a7-83dc-a8b21d48b006
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1100,
          "y": -550
        }
      }
  "54":
    continueonerrortype: ""
    id: "54"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "43"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: SlackEnabled
      value:
        simple: "False"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set a value in context under the key you entered.
      id: f51f39d7-302a-4835-80de-5a9796c0e38d
      iscommand: false
      name: Set SlackEnabled to false
      script: Set
      type: regular
      version: -1
    taskid: f51f39d7-302a-4835-80de-5a9796c0e38d
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1510,
          "y": -550
        }
      }
  "55":
    continueonerrortype: ""
    id: "55"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "43"
    note: false
    quietmode: 0
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: remediationoptions
      value:
        simple: Send a Slack message
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set a value in context under the key you entered.
      id: 16a734a7-6889-426d-8fe3-4f90d13e70bc
      iscommand: false
      name: Set remediationoptions context (Slack)
      script: Set
      type: regular
      version: -1
    taskid: 16a734a7-6889-426d-8fe3-4f90d13e70bc
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1100,
          "y": -390
        }
      }
  "56":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: isEqualString
                    right:
                      value:
                        simple: SlackV3
                - - left:
                      iscontext: true
                      value:
                        simple: modules.state
                    operator: isEqualString
                    right:
                      value:
                        simple: active
                root: modules
          operator: isExists
          right:
            value: {}
      label: "yes"
    continueonerrortype: ""
    id: "56"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "54"
      "yes":
      - "53"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Determines if the Slack integration (v3) instance is enabled in order to send Slack messages as notifications.
      id: 83fa531f-9f0f-40a8-8b65-3e24414ff867
      iscommand: false
      name: Is Slack enabled?
      type: condition
      version: -1
    taskid: 83fa531f-9f0f-40a8-8b65-3e24414ff867
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1110,
          "y": -750
        }
      }
  "57":
    continueonerrortype: ""
    id: "57"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "31"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: RemediationAction
      value:
        simple: Slack
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set a value in context under the key you entered.
      id: 688b2697-3d80-41e6-821e-ebbc7f725666
      iscommand: false
      name: Return Slack
      script: Set
      type: regular
      version: -1
    taskid: 688b2697-3d80-41e6-821e-ebbc7f725666
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 2130,
          "y": 1350
        }
      }
view: |-
  {
    "linkLabelsPosition": {
      "10_33_Unclaimed S3 Bucket": 0.55,
      "10_34_yes": 0.83,
      "10_52_Cortex Endpoint": 0.66,
      "16_17_yes": 0.55,
      "23_48_Jira": 0.88,
      "23_57_Slack": 0.89
    },
    "paper": {
      "dimensions": {
        "height": 4070,
        "width": 3090,
        "x": -580,
        "y": -2150
      }
    }
  }
inputs:
- key: ExternallyDetectedProviders
  value: {}
  required: false
  description: Providers of external service.
  playbookInputQuery:
- key: BypassDevCheck
  value:
    simple: "False"
  required: false
  description: |-
    Determine whether to bypass the Dev Check in automated remediation criteria: https://docs-cortex.paloaltonetworks.com/r/Cortex-XPANSE/Cortex-Xpanse-Expander-User-Guide/Automated-Remediation-Capabilities-Matrix

    Set to "True" if you want to bypass.  "
  playbookInputQuery:
outputs:
- contextPath: RemediationAction
  description: Remediation action to be taken.
  type: string
- contextPath: RPR_Timestamp
  description: Timestamp of when the remediation path rule action was determined.
  type: string
tests:
- No tests (auto formatted)
fromversion: 6.9.0
