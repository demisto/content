id: Cortex ASM - ASM Alert
version: -1
name: Cortex ASM - ASM Alert
description: This playbook aims to handle ASM alerts by enriching asset information and providing means of remediating the issue directly or through contacting service owners.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 78f596bd-e910-435c-880e-698f9ede6c6d
    type: start
    task:
      id: 78f596bd-e910-435c-880e-698f9ede6c6d
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ""
    nexttasks:
      '#none#':
      - "5"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 150
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "4":
    id: "4"
    taskid: f6f15200-bd6e-45e5-8e3a-19de6071bd3c
    type: title
    task:
      id: f6f15200-bd6e-45e5-8e3a-19de6071bd3c
      version: -1
      name: Complete
      type: title
      iscommand: false
      brand: ""
      description: ""
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 90,
          "y": 5250
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "5":
    id: "5"
    taskid: edb81f8c-d915-4965-8921-50362f97e575
    type: title
    task:
      id: edb81f8c-d915-4965-8921-50362f97e575
      version: -1
      name: Triage and Qualifier Stage
      description: ''
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "83"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "6":
    id: "6"
    taskid: fd37ace7-d351-407d-8c1d-cea0073df985
    type: title
    task:
      id: fd37ace7-d351-407d-8c1d-cea0073df985
      version: -1
      name: Enrichment Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "87"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: aa274a71-3cce-480c-8be8-af5ac907f441
    type: title
    task:
      id: aa274a71-3cce-480c-8be8-af5ac907f441
      version: -1
      name: Verdict Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "33"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 980
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: e1725c2c-4b0d-4387-8dcc-328912426708
    type: title
    task:
      id: e1725c2c-4b0d-4387-8dcc-328912426708
      version: -1
      name: Ticketing Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "67"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 900,
          "y": 2290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: df6a89aa-a24b-42d9-8fd1-f8cff792c68c
    type: title
    task:
      id: df6a89aa-a24b-42d9-8fd1-f8cff792c68c
      version: -1
      name: Validation Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "86"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 3870
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: 6ac26ace-84cc-4772-8a8a-18ca5ca00288
    type: title
    task:
      id: 6ac26ace-84cc-4772-8a8a-18ca5ca00288
      version: -1
      name: Remediation Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "77"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -740,
          "y": 2290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: 10f8e20b-57f6-4177-8c81-d391ff4242df
    type: title
    task:
      id: 10f8e20b-57f6-4177-8c81-d391ff4242df
      version: -1
      name: Summarization Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "82"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 4455
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 030f5483-2350-4d10-890b-fe8a614a9eef
    type: condition
    task:
      id: 030f5483-2350-4d10-890b-fe8a614a9eef
      version: -1
      name: Service exposure still observable?
      description: Determines if service was still observable or not.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "17"
      "yes":
      - "6"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEqualString
          left:
            value:
              complex:
                root: alert.asmservicedetection
                accessor: ScanResult
            iscontext: true
          right:
            value:
              simple: Closed
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 540
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: f4b75a32-d7d5-482f-88ef-df2c4c95111d
    type: title
    task:
      id: f4b75a32-d7d5-482f-88ef-df2c4c95111d
      version: -1
      name: continue
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "18"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1170,
          "y": 2290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: 969db962-d7b3-4bfa-8b8f-ae9b23b9703b
    type: regular
    task:
      id: 969db962-d7b3-4bfa-8b8f-ae9b23b9703b
      version: -1
      name: Close alert (service not observed)
      description: Close the current alert because service is no longer observed
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      closeNotes:
        simple: Alert status set to `Resolved - No Longer Observed` by AFR Module
      closeReason:
        simple: Resolved - No Longer Observed
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -780,
          "y": 5080
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: acab503a-acb3-4556-8136-0abdee6c35da
    type: condition
    task:
      id: acab503a-acb3-4556-8136-0abdee6c35da
      version: -1
      name: Service exposure still observable?
      description: Determines if service was still observable or not and also if automated remediation was done.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "21"
      "no":
      - "13"
    separatecontext: false
    conditions:
    - label: "no"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: alert.asmservicedetection
                accessor: ScanResult
                transformers:
                - operator: LastArrayElement
            iscontext: true
          right:
            value:
              simple: Closed
        - operator: isEqualString
          left:
            value:
              complex:
                root: alert.asmremediation
                accessor: Outcome
            iscontext: true
          right:
            value:
              simple: Success
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 4110
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: dcf72485-479c-4e76-817a-356b8af4d64f
    type: collection
    task:
      id: dcf72485-479c-4e76-817a-356b8af4d64f
      version: -1
      name: What to do if NMAP scan is inconclusive?
      description: Determines if alert should be closed or kept open for auto-closure based on analyst input.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "13"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 500,
          "y": 4280
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
        simple: The post migration NMAP scan wasn't conclusive, decide next steps.
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: false
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: If you know the issue has been remediated, chose to keep open and have next Xpanse scan auto-close or manually close now.
        required: false
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: Close Now
        - simple: Wait to Auto-close
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      title: Select a next step
      description: The post migration NMAP scan wasn't conclusive, decide next steps.
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: f56f75fb-a039-4f84-8f21-9a9c119a47c9
    type: condition
    task:
      id: f56f75fb-a039-4f84-8f21-9a9c119a47c9
      version: -1
      name: Auto-close or keep open?
      description: Determines if alert will be closed or kept open.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "4"
      Auto-Close:
      - "74"
      Automated-Remediation:
      - "75"
    separatecontext: false
    conditions:
    - label: Automated-Remediation
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: alert.asmremediation
                accessor: Outcome
            iscontext: true
          right:
            value:
              simple: Success
    - label: Auto-Close
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Select a next step.Answers
                accessor: "0"
            iscontext: true
          right:
            value:
              simple: Close Now
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 4890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 438b903d-afc7-4b27-8b7f-585cfebf2295
    type: condition
    task:
      id: 438b903d-afc7-4b27-8b7f-585cfebf2295
      version: -1
      name: Should remediate automatically?
      description: Determines if playbook input for bypassing analyst interaction was set in order to continue to automated remediation.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "32"
      "yes":
      - "47"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.AutomatedRemediation
            iscontext: true
          right:
            value:
              simple: "True"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1270
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: efe88661-f175-4a85-8ef2-310e5ff11460
    type: collection
    task:
      id: efe88661-f175-4a85-8ef2-310e5ff11460
      version: -1
      name: Select remediation action (all options)
      description: Determines next action (remediation or ticket) based on user input.  Options are based on if ServiceNowV2 integration is setup and/or the alert meets the requirement for automated remediation.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "45"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 280,
          "y": 1640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
        simple: test@email.com
      subject:
        simple: Select Remediation Action
      body:
        simple: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean <a href="https://pan.dev">here</a>.
      methods: []
      format: html
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: false
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: What remediation action would you like to take?
        required: true
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: Automated remediation by restricting open ports
        - simple: Manual remediation
        - simple: File a ServiceNow Ticket
        - simple: Send a notification email
        fieldassociated: ""
        placeholder: ""
        tooltip: A selection is necessary in order for the playbook to progress further.
        readonly: false
      title: Select a remediation option
      description: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean at https://pan.dev
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: 60579f87-69eb-46ba-8fb7-c51b9fef0c79
    type: condition
    task:
      id: 60579f87-69eb-46ba-8fb7-c51b9fef0c79
      version: -1
      name: Is ServiceNow v2 enabled?
      description: Determines if the "ServiceNow v2" integration instance is in order to find email accounts for ServiceNow usernames.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "35"
      "yes":
      - "31"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: ServiceNow v2
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 80,
          "y": 1470
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: 811599ba-5e67-4559-8b08-6c1651460709
    type: condition
    task:
      id: 811599ba-5e67-4559-8b08-6c1651460709
      version: -1
      name: Meets automated remediation requirements?
      description: Determines if alert meets the criteria for automated remediation.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "37"
      "yes":
      - "28"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: alert
                accessor: asmattacksurfaceruleid
            iscontext: true
          right:
            value:
              simple: RdpServer
        - operator: containsGeneral
          left:
            value:
              complex:
                root: incident
                accessor: asmattacksurfaceruleid
            iscontext: true
          right:
            value:
              simple: InsecureOpenSSH
      - - operator: isEqualString
          left:
            value:
              complex:
                root: alert.asmcloud
                accessor: Provider
            iscontext: true
          right:
            value:
              simple: AWS
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: alert
                accessor: asmserviceowner
            iscontext: true
      - - operator: containsString
          left:
            value:
              complex:
                root: alert.asmtags
                accessor: Name
            iscontext: true
          right:
            value:
              simple: dev
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1110
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: 595da2b0-1d77-418a-833b-a02f962dc1bf
    type: collection
    task:
      id: 595da2b0-1d77-418a-833b-a02f962dc1bf
      version: -1
      name: Select remediation action (no automated-remediation)
      description: Determines next action (remediation or ticket) based on user input.  Options are based on if ServiceNowV2 integration is setup and/or the alert meets the requirement for automated remediation.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "38"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1190,
          "y": 1530
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
        simple: test@email.com
      subject:
        simple: Select Remediation Action
      body:
        simple: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean <a href="https://pan.dev">here</a>.
      methods: []
      format: html
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: false
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: What remediation action would you like to take?
        required: true
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: Manual remediation
        - simple: File a ServiceNow Ticket
        - simple: Send a notification email
        fieldassociated: ""
        placeholder: ""
        tooltip: A selection is necessary in order for the playbook to progress further.
        readonly: false
      title: Select a remediation option
      description: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean at https://pan.dev
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: c239ff28-fc06-413f-8f7f-b435948859a8
    type: collection
    task:
      id: c239ff28-fc06-413f-8f7f-b435948859a8
      version: -1
      name: Select remediation action (no ServiceNow)
      description: Determines next action (remediation or ticket) based on user input.  Options are based on if ServiceNowV2 integration is setup and/or the alert meets the requirement for automated remediation.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "46"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -120,
          "y": 1640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
        simple: test@email.com
      subject:
        simple: Select Remediation Action
      body:
        simple: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean <a href="https://pan.dev">here</a>.
      methods: []
      format: html
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: false
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: What remediation action would you like to take?
        required: true
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: Automated remediation by restricting open ports
        - simple: Manual remediation
        - simple: Send a notification email
        fieldassociated: ""
        placeholder: ""
        tooltip: A selection is necessary in order for the playbook to progress further.
        readonly: false
      title: Select a remediation option
      description: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean at https://pan.dev
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: 25667321-92de-4355-8696-c2c91f5fc37b
    type: collection
    task:
      id: 25667321-92de-4355-8696-c2c91f5fc37b
      version: -1
      name: Select remediation action (base)
      description: Determines next action (remediation or ticket) based on user input.  Options are based on if ServiceNowV2 integration is setup and/or the alert meets the requirement for automated remediation.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "44"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 790,
          "y": 1530
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
        simple: test@email.com
      subject:
        simple: Select Remediation Action
      body:
        simple: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean <a href="https://pan.dev">here</a>.
      methods: []
      format: html
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: false
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: What remediation action would you like to take?
        required: true
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: Manual remediation
        - simple: Send a notification email
        fieldassociated: ""
        placeholder: ""
        tooltip: A selection is necessary in order for the playbook to progress further.
        readonly: false
      title: Select a remediation option
      description: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean at https://pan.dev
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: 9222596a-100c-467d-80c2-aba094f5ac23
    type: condition
    task:
      id: 9222596a-100c-467d-80c2-aba094f5ac23
      version: -1
      name: Is ServiceNow v2 enabled?
      description: Determines if the "ServiceNow v2" integration instance is in order to find email accounts for ServiceNow usernames.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "36"
      "yes":
      - "34"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: ServiceNow v2
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 980,
          "y": 1360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: 5f4427cf-e06a-47d4-8d20-4db216c16bba
    type: regular
    task:
      id: 5f4427cf-e06a-47d4-8d20-4db216c16bba
      version: -1
      name: Get current time
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "43"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1190,
          "y": 1680
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: 3b1d3e29-d74a-419e-87a9-a049da36f12c
    type: regular
    task:
      id: 3b1d3e29-d74a-419e-87a9-a049da36f12c
      version: -1
      name: Set data collection grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      gridfield:
        simple: asmdatacollection
      keys:
        simple: Options,Selected,Answerer,Timestamp
      val1:
        simple: WHAT REMEDIATION ACTION WOULD YOU LIKE TO TAKE?
      val2:
        complex:
          root: Select a remediation option.Answers
          accessor: "0"
      val3:
        complex:
          root: Select a remediation option.Answers
          accessor: name
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -120,
          "y": 1950
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "41":
    id: "41"
    taskid: 0a81252d-eeab-4a6f-837c-ae1a97a15c58
    type: regular
    task:
      id: 0a81252d-eeab-4a6f-837c-ae1a97a15c58
      version: -1
      name: Set data collection grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      gridfield:
        simple: asmdatacollection
      keys:
        simple: Options,Selected,Answerer,Timestamp
      val1:
        simple: WHAT REMEDIATION ACTION WOULD YOU LIKE TO TAKE?
      val2:
        complex:
          root: Select a remediation option.Answers
          accessor: "0"
      val3:
        complex:
          root: Select a remediation option.Answers
          accessor: name
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 280,
          "y": 1950
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "42":
    id: "42"
    taskid: 6c4cc6ab-7783-44fc-858e-be1700bf3022
    type: regular
    task:
      id: 6c4cc6ab-7783-44fc-858e-be1700bf3022
      version: -1
      name: Set data collection grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      gridfield:
        simple: asmdatacollection
      keys:
        simple: Options,Selected,Answerer,Timestamp
      val1:
        simple: WHAT REMEDIATION ACTION WOULD YOU LIKE TO TAKE?
      val2:
        complex:
          root: Select a remediation option.Answers
          accessor: "0"
      val3:
        complex:
          root: Select a remediation option.Answers
          accessor: name
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 790,
          "y": 1840
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "43":
    id: "43"
    taskid: e8672bf3-77fd-4922-80e2-eb9785cdf368
    type: regular
    task:
      id: e8672bf3-77fd-4922-80e2-eb9785cdf368
      version: -1
      name: Set data collection grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      gridfield:
        simple: asmdatacollection
      keys:
        simple: Options,Selected,Answerer,Timestamp
      val1:
        simple: WHAT REMEDIATION ACTION WOULD YOU LIKE TO TAKE?
      val2:
        complex:
          root: Select a remediation option.Answers
          accessor: "0"
      val3:
        complex:
          root: Select a remediation option.Answers
          accessor: name
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1190,
          "y": 1840
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "44":
    id: "44"
    taskid: 9e4a0289-8433-406a-8822-d8b6ee389d43
    type: regular
    task:
      id: 9e4a0289-8433-406a-8822-d8b6ee389d43
      version: -1
      name: Get current time
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "42"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 790,
          "y": 1680
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "45":
    id: "45"
    taskid: abcaf1d9-b7dc-47c7-823e-0d60f26f8ab9
    type: regular
    task:
      id: abcaf1d9-b7dc-47c7-823e-0d60f26f8ab9
      version: -1
      name: Get current time
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "41"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 280,
          "y": 1790
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "46":
    id: "46"
    taskid: e6b78adb-a5c8-4dde-8e32-fa4d52ea12a3
    type: regular
    task:
      id: e6b78adb-a5c8-4dde-8e32-fa4d52ea12a3
      version: -1
      name: Get current time
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "39"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -120,
          "y": 1790
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "47":
    id: "47"
    taskid: 9e272aca-e424-4fd2-83ae-d6a11d3a774c
    type: title
    task:
      id: 9e272aca-e424-4fd2-83ae-d6a11d3a774c
      version: -1
      name: Bypass
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "12"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -740,
          "y": 1470
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "48":
    id: "48"
    taskid: a21c312b-a00c-49d8-8c5c-629bb1235321
    type: condition
    task:
      id: a21c312b-a00c-49d8-8c5c-629bb1235321
      version: -1
      name: What was data collection task response?
      description: Determines next action (remediation or ticket) based on previous data collection task.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "50"
      Automated remediation:
      - "12"
      Manual remediation:
      - "63"
      Notification email:
      - "60"
      ServiceNow ticket:
      - "10"
    separatecontext: false
    conditions:
    - label: Automated remediation
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Select a remediation option.Answers
                accessor: "0"
            iscontext: true
          right:
            value:
              simple: Automated remediation by restricting open ports
    - label: Manual remediation
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Select a remediation option.Answers
                accessor: "0"
            iscontext: true
          right:
            value:
              simple: Manual remediation
    - label: ServiceNow ticket
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Select a remediation option.Answers
                accessor: "0"
            iscontext: true
          right:
            value:
              simple: File a ServiceNow Ticket
    - label: Notification email
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Select a remediation option.Answers
                accessor: "0"
            iscontext: true
          right:
            value:
              simple: Send a notification email
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 2120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "50":
    id: "50"
    taskid: a8fbe0dd-10dc-44e1-8a6e-e5d2945f156b
    type: collection
    task:
      id: a8fbe0dd-10dc-44e1-8a6e-e5d2945f156b
      version: -1
      name: When manual remediation is complete
      description: Determines if manual remediation (by service owner or otherwise) was completed via analyst input.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "71"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 3210
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: false
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: 'Please click when manual remediation was completed:'
        required: true
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: complete
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      title: Verify that manual remediation was completed
      description: ""
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "54":
    id: "54"
    taskid: 960ccd98-da0a-4d3f-8c7e-5c4acb58ed5f
    type: collection
    task:
      id: 960ccd98-da0a-4d3f-8c7e-5c4acb58ed5f
      version: -1
      name: Select owners to notify
      description: Determines who to send notification emails to based on analyst input.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "85"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1340,
          "y": 2400
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
        simple: Select owners to notify
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: false
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: 'Enter email addresses to notify:'
        required: true
        gridcolumns: []
        defaultrows: []
        type: shortText
        options: []
        optionsarg: []
        fieldassociated: ""
        placeholder: ""
        tooltip: Add multiple addresses separated by commas
        readonly: false
      title: Select owners to notify
      description: ""
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "55":
    id: "55"
    taskid: d7ac3132-c056-4ffa-8bfc-c78b22da17d3
    type: regular
    task:
      id: d7ac3132-c056-4ffa-8bfc-c78b22da17d3
      version: -1
      name: Send email
      description: Send an email to service owner with alert information.
      script: '|||send-mail'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "62"
    scriptarguments:
      body:
        complex:
          root: inputs.OwnerNotificationBody
          transformers:
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ${RemediationGuidance}
      subject:
        complex:
          root: inputs.OwnerNotificationSubject
      to:
        complex:
          root: Select owners to notify.Answers
          accessor: "0"
          transformers:
          - operator: split
            args:
              delimiter:
                value:
                  simple: ','
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1340,
          "y": 2710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "56":
    id: "56"
    taskid: 55169da3-2543-4c30-8c93-c5b4ee073096
    type: regular
    task:
      id: 55169da3-2543-4c30-8c93-c5b4ee073096
      version: -1
      name: Create ServiceNow incident
      description: Creates new ServiceNow ticket.
      script: ServiceNow v2|||servicenow-create-ticket
      type: regular
      iscommand: true
      brand: ServiceNow v2
    nexttasks:
      '#none#':
      - "57"
    scriptarguments:
      description:
        complex:
          root: inputs.OwnerNotificationBody
          transformers:
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ${RemediationGuidance}
      short_description:
        complex:
          root: inputs.OwnerNotificationSubject
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 900,
          "y": 2710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "57":
    id: "57"
    taskid: 2ee2329a-8280-41cb-8267-5a25fd7b43a5
    type: regular
    task:
      id: 2ee2329a-8280-41cb-8267-5a25fd7b43a5
      version: -1
      name: Set notification grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "50"
    scriptarguments:
      gridfield:
        simple: asmnotification
      keys:
        simple: Type,Value,Url,Timestamp
      val1:
        simple: ServiceNow
      val2:
        complex:
          root: ServiceNow.Ticket
          accessor: ID
      val3:
        simple: n/a
      val4:
        complex:
          root: ServiceNow.Ticket
          accessor: CreatedOn
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 900,
          "y": 3020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "59":
    id: "59"
    taskid: 1e34440a-9cfa-49ec-8640-937b1d054bb9
    type: regular
    task:
      id: 1e34440a-9cfa-49ec-8640-937b1d054bb9
      version: -1
      name: Set notification grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "50"
    scriptarguments:
      gridfield:
        simple: asmnotification
      keys:
        simple: Type,Value,Url,Timestamp
      val1:
        simple: Email
      val2:
        complex:
          root: Select owners to notify.Answers
          accessor: "0"
      val3:
        simple: n/a
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: LastArrayElement
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1340,
          "y": 3020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "60":
    id: "60"
    taskid: c8bc9960-8aae-4da1-827a-7c6b3aa6ea43
    type: title
    task:
      id: c8bc9960-8aae-4da1-827a-7c6b3aa6ea43
      version: -1
      name: Ticketing Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "54"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1340,
          "y": 2290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "62":
    id: "62"
    taskid: 36ff6efe-cdd1-476e-8bf4-833551dfa8fa
    type: regular
    task:
      id: 36ff6efe-cdd1-476e-8bf4-833551dfa8fa
      version: -1
      name: Get current time
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "59"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1340,
          "y": 2865
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "63":
    id: "63"
    taskid: 64dae0b5-00e5-4c38-8129-38d64dfd9fa8
    type: title
    task:
      id: 64dae0b5-00e5-4c38-8129-38d64dfd9fa8
      version: -1
      name: Remediation Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "50"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -320,
          "y": 2290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "64":
    id: "64"
    taskid: 6dfa6e9c-bfa0-4be9-880a-aea7449b9294
    type: regular
    task:
      id: 6dfa6e9c-bfa0-4be9-880a-aea7449b9294
      version: -1
      name: Get current time
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "65"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -390,
          "y": 3500
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "65":
    id: "65"
    taskid: bd33d8e9-fd27-4ded-8772-51861441aaa9
    type: regular
    task:
      id: bd33d8e9-fd27-4ded-8772-51861441aaa9
      version: -1
      name: Set remediation grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      gridfield:
        simple: asmremediation
      keys:
        simple: Action,ActionTimestamp,Outcome,OutcomeTimestamp
      val1:
        simple: close service port from internet
      val2:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: LastArrayElement
          - operator: TimeStampToDate
      val3:
        simple: Success
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: LastArrayElement
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -390,
          "y": 3690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "67":
    id: "67"
    taskid: f26ece1a-5e49-4138-8bec-302e4b29a8d8
    type: regular
    task:
      id: f26ece1a-5e49-4138-8bec-302e4b29a8d8
      version: -1
      name: Get remediation guidance
      description: Pull remediation guidance based on a list of Xpanse issueTypeId to remediationGuidance pairings.
      scriptName: GetRemediationGuidance
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "56"
    scriptarguments:
      AttackSurfaceRuleID:
        complex:
          root: alert
          accessor: asmattacksurfaceruleid
          transformers:
          - operator: replace
            args:
              limit: {}
              replaceWith: {}
              toReplace:
                value:
                  simple: '['
          - operator: replace
            args:
              limit: {}
              replaceWith: {}
              toReplace:
                value:
                  simple: '"'
          - operator: replace
            args:
              limit: {}
              replaceWith: {}
              toReplace:
                value:
                  simple: ']'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 900,
          "y": 2550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "69":
    id: "69"
    taskid: c054fbc2-556a-440e-834b-77426b1018a3
    type: regular
    task:
      id: c054fbc2-556a-440e-834b-77426b1018a3
      version: -1
      name: Set remediation grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      gridfield:
        simple: asmremediation
      keys:
        simple: Action,ActionTimestamp,Outcome,OutcomeTimestamp
      val1:
        simple: Manual remediation
      val2:
        complex:
          root: alert.asmdatacollection
          accessor: Timestamp
      val3:
        simple: Manual remediation completed
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: LastArrayElement
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 3700
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "71":
    id: "71"
    taskid: 440adab4-d91f-4dc9-88e4-dbc4a0117b3e
    type: regular
    task:
      id: 440adab4-d91f-4dc9-88e4-dbc4a0117b3e
      version: -1
      name: Get current time
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "72"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 3360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "72":
    id: "72"
    taskid: c4c310d0-577c-43e5-8fd3-6ce9bdb4f309
    type: condition
    task:
      id: c4c310d0-577c-43e5-8fd3-6ce9bdb4f309
      version: -1
      name: Manual remediation selected?
      description: Determines if "manual remediation" was selected on main data collection task.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "73"
      "yes":
      - "69"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Select a remediation option.Answers
                accessor: "0"
            iscontext: true
          right:
            value:
              simple: Manual remediation
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 3510
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "73":
    id: "73"
    taskid: fe804414-0986-4a78-8fed-97602f536e00
    type: regular
    task:
      id: fe804414-0986-4a78-8fed-97602f536e00
      version: -1
      name: Set remediation grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      gridfield:
        simple: asmremediation
      keys:
        simple: Action,ActionTimestamp,Outcome,OutcomeTimestamp
      val1:
        complex:
          root: alert.asmnotification
          accessor: Type
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'Notified service owner via '
              suffix: {}
      val2:
        complex:
          root: alert.asmnotification
          accessor: Timestamp
      val3:
        simple: Resolved by service owner
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: LastArrayElement
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 520,
          "y": 3700
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "74":
    id: "74"
    taskid: 78d45c88-ae06-44e9-8baf-6c9a04824e41
    type: regular
    task:
      id: 78d45c88-ae06-44e9-8baf-6c9a04824e41
      version: -1
      name: Close alert (Auto-Close)
      description: Close the current alert because auto-close selected
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      closeNotes:
        simple: Alert status set to `Resolved` by AFR Module
      closeReason:
        simple: Resolved
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -180,
          "y": 5080
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "75":
    id: "75"
    taskid: 2ce0374c-0abc-424e-86ff-caf53171e281
    type: regular
    task:
      id: 2ce0374c-0abc-424e-86ff-caf53171e281
      version: -1
      name: Close alert (Remediated Automatically)
      description: Close the current alert because Automated Remediation path selected
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      closeNotes:
        simple: Alert status set to `Resolved - Remediated Automatically` by AFR Module
      closeReason:
        simple: Resolved - Remediated Automatically
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 400,
          "y": 5080
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "77":
    id: "77"
    taskid: cb456a42-f90f-4213-86c4-e0925a6b723a
    type: playbook
    task:
      id: cb456a42-f90f-4213-86c4-e0925a6b723a
      version: -1
      name: AWS - Security Group Remediation
      description: Replace current security groups with limited access security groups.
      playbookName: AWS - Security Group Remediation
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "64"
    scriptarguments:
      NicID:
        complex:
          root: alert.asmsystemids
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: alert.asmsystemids.Type
                iscontext: true
              right:
                value:
                  simple: AWS-NIC
          accessor: ID
      RemediationRule:
        complex:
          root: inputs.RemediationRule
      VpcID:
        complex:
          root: alert.asmsystemids
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: alert.asmsystemids.Type
                iscontext: true
              right:
                value:
                  simple: AWS-VPC
          accessor: ID
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": -740,
          "y": 2400
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "81":
    id: "81"
    taskid: 35557ea1-454d-41ae-8b7e-38acc28e4276
    type: regular
    task:
      id: 35557ea1-454d-41ae-8b7e-38acc28e4276
      version: -1
      name: Set alert summary grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "23"
    scriptarguments:
      gridfield:
        simple: asmalertsummary
      keys:
        simple: Link,EntryID
      val1:
        complex:
          root: demistoUrls
          accessor: server
          transformers:
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: /xsoar/entry/download/
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ${lastCompletedTaskEntries.[0]}
                iscontext: true
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: '%40'
              toReplace:
                value:
                  simple: '@'
      val2:
        complex:
          root: lastCompletedTaskEntries
          accessor: '[0]'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 4730
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "82":
    id: "82"
    taskid: 1147b02e-e2e7-4116-871a-f50a50352c76
    type: regular
    task:
      id: 1147b02e-e2e7-4116-871a-f50a50352c76
      version: -1
      name: GenerateSummaryReport
      description: Generate an ASM Alert Summary report.
      scriptName: GenerateASMReport
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "81"
    scriptarguments:
      alert_details:
        complex:
          root: alert
          accessor: details
      alert_id:
        complex:
          root: alert
          accessor: id
      alert_name:
        complex:
          root: alert
          accessor: name
      alert_severityStr:
        complex:
          root: alert
          accessor: severityStr
      asmcloud:
        complex:
          root: alert
          accessor: asmcloud
      asmdatacollection:
        complex:
          root: alert
          accessor: asmdatacollection
      asmnotification:
        complex:
          root: alert
          accessor: asmnotification
      asmprivateip:
        complex:
          root: alert
          accessor: asmprivateip
      asmrelated:
        complex:
          root: alert
          accessor: asmrelated
      asmremediation:
        complex:
          root: alert
          accessor: asmremediation
      asmservicedetection:
        complex:
          root: alert
          accessor: asmservicedetection
      asmserviceowner:
        complex:
          root: alert
          accessor: asmserviceowner
      asmsystemids:
        complex:
          root: alert
          accessor: asmsystemids
      asmtags:
        complex:
          root: alert
          accessor: asmtags
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 4580
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "83":
    id: "83"
    taskid: 02f13d37-89e7-4fbc-81b6-e78afdcf6fa3
    type: playbook
    task:
      id: 02f13d37-89e7-4fbc-81b6-e78afdcf6fa3
      version: -1
      name: Cortex ASM - Detect Service
      description: Playbook that looks at what ASM sub-type the alert is and direct to different pre/post mitigation scans (such as NMAP).
      playbookName: Cortex ASM - Detect Service
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      ASMRuleID:
        complex:
          root: alert
          accessor: asmattacksurfaceruleid
      RemoteIP:
        complex:
          root: alert
          accessor: remoteip
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: None
      RemotePort:
        complex:
          root: alert
          accessor: remoteport
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: None
      ScanNumber:
        simple: "1"
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 50,
          "y": 400
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "85":
    id: "85"
    taskid: 250dce2d-407c-4477-8c76-781605ce1458
    type: regular
    task:
      id: 250dce2d-407c-4477-8c76-781605ce1458
      version: -1
      name: Get remediation guidance
      description: Pull remediation guidance based on a list of Xpanse issueTypeId to remediationGuidance pairings.
      scriptName: GetRemediationGuidance
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "55"
    scriptarguments:
      AttackSurfaceRuleID:
        complex:
          root: alert
          accessor: asmattacksurfaceruleid
          transformers:
          - operator: replace
            args:
              limit: {}
              replaceWith: {}
              toReplace:
                value:
                  simple: '['
          - operator: replace
            args:
              limit: {}
              replaceWith: {}
              toReplace:
                value:
                  simple: '"'
          - operator: replace
            args:
              limit: {}
              replaceWith: {}
              toReplace:
                value:
                  simple: ']'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1340,
          "y": 2550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "86":
    id: "86"
    taskid: c02d58c1-e7a2-4dd3-8002-4285b83a12bf
    type: playbook
    task:
      id: c02d58c1-e7a2-4dd3-8002-4285b83a12bf
      version: -1
      name: Cortex ASM - Detect Service
      description: Playbook that looks at what ASM sub-type the alert is and direct to different pre/post mitigation scans (such as NMAP).
      playbookName: Cortex ASM - Detect Service
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      ASMRuleID:
        complex:
          root: alert
          accessor: asmattacksurfaceruleid
      RemoteIP:
        complex:
          root: alert
          accessor: remoteip
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: None
      RemotePort:
        complex:
          root: alert
          accessor: remoteport
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: None
      ScanNumber:
        simple: "2"
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 90,
          "y": 3980
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "87":
    id: "87"
    taskid: e4fb8bb0-44b1-44b2-8ed7-f79efd4f287b
    type: playbook
    task:
      id: e4fb8bb0-44b1-44b2-8ed7-f79efd4f287b
      version: -1
      name: Cortex ASM - Enrichment
      playbookName: Cortex ASM - Enrichment
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "8"
    scriptarguments:
      RemoteIP:
        complex:
          root: alert
          accessor: remoteip
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: None
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 50,
          "y": 830
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "28_47_yes": 0.48,
      "33_37_#default#": 0.35,
      "48_10_ServiceNow ticket": 0.82,
      "48_50_#default#": 0.25,
      "48_60_Notification email": 0.88,
      "48_63_Manual remediation": 0.6
    },
    "paper": {
      "dimensions": {
        "height": 5165,
        "width": 2890,
        "x": -1170,
        "y": 150
      }
    }
  }
inputs:
- key: AutomatedRemediation
  value:
    simple: "False"
  required: true
  description: 'Decide whether to potential skip analyst intervention and conduct automated remediation if meeting the following criteria: issue is Insecure OpenSSH/RDP, happened on EC2 instance, service owner information found and indicators of a non-prod host.  Default if "False" (don''t do automated remediation).  Set "True" to turn this feature on.'
  playbookInputQuery:
- key: OwnerNotificationSubject
  value:
    simple: A new security risk was identified on an external service owned by your team
  required: true
  description: Subject of the notification (email or ticket) send to potential service owner.
  playbookInputQuery:
- key: OwnerNotificationBody
  value:
    simple: |+
      Infosec identified a security risk on an external service potentially owned by your team: ${alert.name}

      Description: ${alert.details}

  required: true
  description: Body of the notification (email or ticket) send to potential service owner.
  playbookInputQuery:
- key: RemediationRule
  value:
    simple: Remediation-Security-Group
  required: true
  description: 'The firewall rule that will used for remediating internet exposures. '
  playbookInputQuery:
outputs: []
tests:
- No tests (auto formatted)
fromversion: 6.5.0
contentitemexportablefields:
  contentitemfields: {}
system: true
