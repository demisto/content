id: Cortex ASM - ASM Alert
version: -1
name: Cortex ASM - ASM Alert
description: This playbook handles ASM alerts by enriching asset information and providing a means of remediating the issue directly or through contacting service owners.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 5cf41a0f-efe8-4939-89e9-bd5e916b76fd
    type: start
    task:
      id: 5cf41a0f-efe8-4939-89e9-bd5e916b76fd
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "5"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 150
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "4":
    id: "4"
    taskid: 23c19053-1ae8-4e6a-8c9f-86f0f1bc978b
    type: title
    task:
      id: 23c19053-1ae8-4e6a-8c9f-86f0f1bc978b
      version: -1
      name: Complete
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 90,
          "y": 5190
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "5":
    id: "5"
    taskid: cf841205-1bc1-4490-89f8-027e330c91d2
    type: title
    task:
      id: cf841205-1bc1-4490-89f8-027e330c91d2
      version: -1
      name: Triage and Qualifier Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "100"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "6":
    id: "6"
    taskid: 9aad1634-f6bf-45b0-8335-674800596d17
    type: title
    task:
      id: 9aad1634-f6bf-45b0-8335-674800596d17
      version: -1
      name: Enrichment Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "97"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: 020cb23f-19af-4415-8933-53fd42d1d36e
    type: title
    task:
      id: 020cb23f-19af-4415-8933-53fd42d1d36e
      version: -1
      name: Decision Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "101"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 980
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: d6ae778e-0674-4e7b-8cef-66c7f909651a
    type: title
    task:
      id: d6ae778e-0674-4e7b-8cef-66c7f909651a
      version: -1
      name: Ticketing Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "91"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 930,
          "y": 2220
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: 97a8b99b-265b-493a-8a3c-5f22b17f5fc2
    type: title
    task:
      id: 97a8b99b-265b-493a-8a3c-5f22b17f5fc2
      version: -1
      name: Validation Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "86"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 3810
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: 623323fb-2af2-465a-8af5-35deadd40e66
    type: title
    task:
      id: 623323fb-2af2-465a-8af5-35deadd40e66
      version: -1
      name: Remediation Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "98"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1250,
          "y": 2230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: ff614b68-6a60-4af6-886f-a6d9e7864f6e
    type: title
    task:
      id: ff614b68-6a60-4af6-886f-a6d9e7864f6e
      version: -1
      name: Summarization Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "93"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 4395
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: d3d1f946-9f9e-4460-86f4-df31a6046530
    type: condition
    task:
      id: d3d1f946-9f9e-4460-86f4-df31a6046530
      version: -1
      name: Service exposure still observable?
      description: Determines if service was still observable.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "17"
      "yes":
      - "6"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEqualString
          left:
            value:
              complex:
                root: alert.asmservicedetection
                accessor: ScanResult
            iscontext: true
          right:
            value:
              simple: Closed
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 540
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: 0667d597-b2fa-4717-8b01-828c679b34b0
    type: title
    task:
      id: 0667d597-b2fa-4717-8b01-828c679b34b0
      version: -1
      name: continue
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "18"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1700,
          "y": 2260
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: 4c1488d4-0d9f-4f70-891b-0c9f476312ec
    type: regular
    task:
      id: 4c1488d4-0d9f-4f70-891b-0c9f476312ec
      version: -1
      name: Close alert (service not observed)
      description: Close the current alert because service is no longer observed.
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      closeNotes:
        simple: Alert status set to 'Resolved - No Longer Observed' by Active Response Module
      closeReason:
        simple: Resolved - No Longer Observed
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -780,
          "y": 5020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: 69be963e-3719-4710-8b09-945f1bd9d4a4
    type: condition
    task:
      id: 69be963e-3719-4710-8b09-945f1bd9d4a4
      version: -1
      name: Service exposure still observable?
      description: Determines if service was still observable and also if automated remediation was done.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "21"
      "no":
      - "13"
    separatecontext: false
    conditions:
    - label: "no"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: alert.asmservicedetection
                accessor: ScanResult
                transformers:
                - operator: LastArrayElement
            iscontext: true
          right:
            value:
              simple: Closed
        - operator: isEqualString
          left:
            value:
              complex:
                root: alert.asmremediation
                accessor: Outcome
            iscontext: true
          right:
            value:
              simple: Success
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 4050
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: f9fa16ff-b86c-4b20-8694-cb9c88eb9090
    type: collection
    task:
      id: f9fa16ff-b86c-4b20-8694-cb9c88eb9090
      version: -1
      name: What to do if NMAP scan is inconclusive?
      description: Determines if alert should be closed or kept open for auto-closure based on analyst input.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "13"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 500,
          "y": 4220
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
        simple: The post migration NMAP scan wasn't conclusive, decide next steps.
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: false
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: If you know the issue has been remediated, choose to keep open and have next Xpanse scan auto-close or manually close now.
        required: false
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: Close Now
        - simple: Wait to Auto-close
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      title: Select a next step
      description: The post migration NMAP scan wasn't conclusive, decide next steps.
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: bfa7a592-ab98-48d6-8013-8c41fe175667
    type: condition
    task:
      id: bfa7a592-ab98-48d6-8013-8c41fe175667
      version: -1
      name: Auto-close or keep open?
      description: Determines if alert will be closed or kept open.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "4"
      Auto-Close:
      - "74"
      Automated-Remediation:
      - "75"
    separatecontext: false
    conditions:
    - label: Automated-Remediation
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: alert.asmremediation
                accessor: Outcome
            iscontext: true
          right:
            value:
              simple: Success
    - label: Auto-Close
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Select a next step.Answers
                accessor: "0"
            iscontext: true
          right:
            value:
              simple: Close Now
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 4830
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: b71c94ce-9a0d-4a5e-8d72-77d379bcfc0a
    type: collection
    task:
      id: b71c94ce-9a0d-4a5e-8d72-77d379bcfc0a
      version: -1
      name: Select remediation action (all options)
      description: Determines the next action (remediation or ticket) based on user input. Options are based on if ServiceNowV2 integration is setup and/or the alert meets the requirement for automated remediation.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "45"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -530,
          "y": 1470
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
        simple: test@email.com
      subject:
        simple: Select Remediation Action
      body:
        simple: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean at https://pan.dev.
      methods: []
      format: html
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: What remediation action would you like to take?
        required: true
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: Automated remediation by restricting open ports
        - simple: Manual remediation
        - simple: File a ServiceNow Ticket
        - simple: Send a notification email
        fieldassociated: ""
        placeholder: ""
        tooltip: A selection is necessary in order for the playbook to progress further.
        readonly: false
      title: Select a remediation option
      description: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean at https://pan.dev.
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: ffee8538-b8bb-46ad-86e4-23c8c132825b
    type: collection
    task:
      id: ffee8538-b8bb-46ad-86e4-23c8c132825b
      version: -1
      name: Select remediation action (no automated-remediation)
      description: Determines next action (remediation or ticket) based on user input. Options are based on if ServiceNowV2 integration is setup and/or the alert meets the requirement for automated remediation.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "38"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -140,
          "y": 1470
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
        simple: test@email.com
      subject:
        simple: Select Remediation Action
      body:
        simple: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean at https://pan.dev.
      methods: []
      format: html
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: false
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: What remediation action would you like to take?
        required: true
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: Manual remediation
        - simple: File a ServiceNow Ticket
        - simple: Send a notification email
        fieldassociated: ""
        placeholder: ""
        tooltip: A selection is necessary in order for the playbook to progress further.
        readonly: false
      title: Select a remediation option
      description: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean at https://pan.dev.
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: 6fcace7c-1a6d-4690-8101-47823d124c7f
    type: collection
    task:
      id: 6fcace7c-1a6d-4690-8101-47823d124c7f
      version: -1
      name: Select remediation action (no ServiceNow)
      description: Determines the next action (remediation or ticket) based on user input. Options are based on if ServiceNowV2 integration is setup and/or the alert meets the requirement for automated remediation.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "46"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 250,
          "y": 1470
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
        simple: test@email.com
      subject:
        simple: Select Remediation Action
      body:
        simple: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean at https://pan.dev.
      methods: []
      format: html
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: false
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: What remediation action would you like to take?
        required: true
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: Automated remediation by restricting open ports
        - simple: Manual remediation
        - simple: Send a notification email
        fieldassociated: ""
        placeholder: ""
        tooltip: A selection is necessary in order for the playbook to progress further.
        readonly: false
      title: Select a remediation option
      description: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean at https://pan.dev.
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: 5323c1de-2910-411c-8349-118f0979981e
    type: collection
    task:
      id: 5323c1de-2910-411c-8349-118f0979981e
      version: -1
      name: Select remediation action (base)
      description: Determines the next action (remediation or ticket) based on user input. Options are based on if ServiceNowV2 integration is setup and/or the alert meets the requirement for automated remediation.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "44"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 640,
          "y": 1470
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
        simple: test@email.com
      subject:
        simple: Select Remediation Action
      body:
        simple: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean at https://pan.dev.
      methods: []
      format: html
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: false
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: What remediation action would you like to take?
        required: true
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: Manual remediation
        - simple: Send a notification email
        fieldassociated: ""
        placeholder: ""
        tooltip: A selection is necessary in order for the playbook to progress further.
        readonly: false
      title: Select a remediation option
      description: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean at https://pan.dev
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: d2591a15-8c93-4efb-8db4-10d8ead6a2d5
    type: regular
    task:
      id: d2591a15-8c93-4efb-8db4-10d8ead6a2d5
      version: -1
      name: Get current time
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "43"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -140,
          "y": 1630
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: 55463492-756f-41bc-86f5-411d791d49f7
    type: regular
    task:
      id: 55463492-756f-41bc-86f5-411d791d49f7
      version: -1
      name: Set data collection grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      gridfield:
        simple: asmdatacollection
      keys:
        simple: Options,Selected,Answerer,Timestamp
      val1:
        simple: What remediation action would you like to take?
      val2:
        complex:
          root: Select a remediation option.Answers
          accessor: "0"
      val3:
        complex:
          root: Select a remediation option.Answers
          accessor: name
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 250,
          "y": 1790
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "41":
    id: "41"
    taskid: 4cb617b0-5dc9-40b6-88ca-c10df50b6fbf
    type: regular
    task:
      id: 4cb617b0-5dc9-40b6-88ca-c10df50b6fbf
      version: -1
      name: Set data collection grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      gridfield:
        simple: asmdatacollection
      keys:
        simple: Options,Selected,Answerer,Timestamp
      val1:
        simple: What remediation action would you like to take?
      val2:
        complex:
          root: Select a remediation option.Answers
          accessor: "0"
      val3:
        complex:
          root: Select a remediation option.Answers
          accessor: name
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -530,
          "y": 1790
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "42":
    id: "42"
    taskid: 8ec07328-bc7d-43e2-8fe9-8d94b2672c9e
    type: regular
    task:
      id: 8ec07328-bc7d-43e2-8fe9-8d94b2672c9e
      version: -1
      name: Set data collection grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      gridfield:
        simple: asmdatacollection
      keys:
        simple: Options,Selected,Answerer,Timestamp
      val1:
        simple: What remediation action would you like to take?
      val2:
        complex:
          root: Select a remediation option.Answers
          accessor: "0"
      val3:
        complex:
          root: Select a remediation option.Answers
          accessor: name
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 640,
          "y": 1790
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "43":
    id: "43"
    taskid: 5b4aec54-b338-483d-87b7-d4043fe34607
    type: regular
    task:
      id: 5b4aec54-b338-483d-87b7-d4043fe34607
      version: -1
      name: Set data collection grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      gridfield:
        simple: asmdatacollection
      keys:
        simple: Options,Selected,Answerer,Timestamp
      val1:
        simple: What remediation action would you like to take?
      val2:
        complex:
          root: Select a remediation option.Answers
          accessor: "0"
      val3:
        complex:
          root: Select a remediation option.Answers
          accessor: name
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -140,
          "y": 1790
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "44":
    id: "44"
    taskid: 29d99f8a-ef64-428c-8b00-00a340199e46
    type: regular
    task:
      id: 29d99f8a-ef64-428c-8b00-00a340199e46
      version: -1
      name: Get current time
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "42"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 640,
          "y": 1630
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "45":
    id: "45"
    taskid: 06f4b70f-079d-4e9b-8232-024712548dbf
    type: regular
    task:
      id: 06f4b70f-079d-4e9b-8232-024712548dbf
      version: -1
      name: Get current time
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "41"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -530,
          "y": 1630
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "46":
    id: "46"
    taskid: 90a3d955-ace7-49b9-89af-af8e2d7fde5a
    type: regular
    task:
      id: 90a3d955-ace7-49b9-89af-af8e2d7fde5a
      version: -1
      name: Get current time
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "39"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 250,
          "y": 1630
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "48":
    id: "48"
    taskid: 9e01b8a1-ad84-48e3-843d-a6b9454d82ae
    type: condition
    task:
      id: 9e01b8a1-ad84-48e3-843d-a6b9454d82ae
      version: -1
      name: What was data collection task response?
      description: Determines the next action (remediation or ticket) based on the previous data collection task.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "88"
      Automated remediation:
      - "12"
      Manual remediation:
      - "63"
      Notification email:
      - "60"
      ServiceNow ticket:
      - "10"
    separatecontext: false
    conditions:
    - label: Automated remediation
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Select a remediation option.Answers
                accessor: "0"
            iscontext: true
          right:
            value:
              simple: Automated remediation by restricting open ports
    - label: Manual remediation
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Select a remediation option.Answers
                accessor: "0"
            iscontext: true
          right:
            value:
              simple: Manual remediation
    - label: ServiceNow ticket
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Select a remediation option.Answers
                accessor: "0"
            iscontext: true
          right:
            value:
              simple: File a ServiceNow Ticket
    - label: Notification email
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Select a remediation option.Answers
                accessor: "0"
            iscontext: true
          right:
            value:
              simple: Send a notification email
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 60,
          "y": 1960
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "50":
    id: "50"
    taskid: 638ad390-454d-4825-8aad-a4f69b60cabc
    type: collection
    task:
      id: 638ad390-454d-4825-8aad-a4f69b60cabc
      version: -1
      name: Verify service exposure resolved by service owner
      description: Determines if manual remediation (by service owner or otherwise) was completed via analyst input.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "71"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 360,
          "y": 3130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: 'Please verify service exposure was resolved by service owner and mark "complete" when done:'
        required: true
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: Yes, remediation complete
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      title: Verify that service exposure was resolved by service owner
      description: ""
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "54":
    id: "54"
    taskid: a28b2338-d412-4934-8b38-68ba91942fd9
    type: collection
    task:
      id: a28b2338-d412-4934-8b38-68ba91942fd9
      version: -1
      name: Select owners to notify
      description: Determines who to send notification emails to based on analyst input.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "92"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1370,
          "y": 2340
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
        simple: Select owners to notify
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: false
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: 'Enter email addresses to notify:'
        required: true
        gridcolumns: []
        defaultrows: []
        type: shortText
        options: []
        optionsarg: []
        fieldassociated: ""
        placeholder: ""
        tooltip: Add multiple addresses separated by commas
        readonly: false
      title: Select Owners to Notify
      description: ""
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "55":
    id: "55"
    taskid: f754535a-4d41-40b6-8eb9-7b7b2feebc94
    type: regular
    task:
      id: f754535a-4d41-40b6-8eb9-7b7b2feebc94
      version: -1
      name: Send email
      description: Send an email to the service owner with alert information.
      script: '|||send-mail'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "62"
    scriptarguments:
      subject:
        complex:
          root: inputs.OwnerNotificationSubject
      to:
        complex:
          root: Select Owners to Notify.Answers
          accessor: "0"
          transformers:
          - operator: split
            args:
              delimiter:
                value:
                  simple: ','
      htmlBody:
        complex:
          root: inputs.OwnerNotificationBody
          transformers:
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: RemediationGuidance
                iscontext: true
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1370,
          "y": 2650
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "59":
    id: "59"
    taskid: 3dfab8a6-f887-48f9-87c1-4066b2d04315
    type: regular
    task:
      id: 3dfab8a6-f887-48f9-87c1-4066b2d04315
      version: -1
      name: Set notification grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "50"
    scriptarguments:
      gridfield:
        simple: asmnotification
      keys:
        simple: Type,Value,URL,Timestamp
      val1:
        simple: Email
      val2:
        complex:
          root: Select Owners to Notify.Answers
          accessor: "0"
      val3:
        simple: n/a
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: LastArrayElement
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1370,
          "y": 2960
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "60":
    id: "60"
    taskid: da7e7969-fbbc-4cc1-8163-4a4402a185b5
    type: title
    task:
      id: da7e7969-fbbc-4cc1-8163-4a4402a185b5
      version: -1
      name: Ticketing Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "54"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1370,
          "y": 2220
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "62":
    id: "62"
    taskid: ffdf9937-8df9-42fe-8b75-d55541364ecf
    type: regular
    task:
      id: ffdf9937-8df9-42fe-8b75-d55541364ecf
      version: -1
      name: Get current time
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "59"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1370,
          "y": 2805
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "63":
    id: "63"
    taskid: f55631c2-0718-421d-8243-add79760ceac
    type: title
    task:
      id: f55631c2-0718-421d-8243-add79760ceac
      version: -1
      name: Remediation Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "88"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -840,
          "y": 2230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "64":
    id: "64"
    taskid: 35f1eea4-d5be-4755-8325-24023f33ad8a
    type: regular
    task:
      id: 35f1eea4-d5be-4755-8325-24023f33ad8a
      version: -1
      name: Get current time
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "65"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -390,
          "y": 3315
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "65":
    id: "65"
    taskid: 9e822664-8ac0-472d-891d-fb89756a053a
    type: regular
    task:
      id: 9e822664-8ac0-472d-891d-fb89756a053a
      version: -1
      name: Set remediation grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      gridfield:
        simple: asmremediation
      keys:
        simple: Action,ActionTimestamp,Outcome,OutcomeTimestamp
      val1:
        simple: close service port from internet
      val2:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: LastArrayElement
          - operator: TimeStampToDate
      val3:
        simple: Success
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: LastArrayElement
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -390,
          "y": 3630
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "69":
    id: "69"
    taskid: 5a6e7348-d72d-4daf-8a1f-f805e0c79929
    type: regular
    task:
      id: 5a6e7348-d72d-4daf-8a1f-f805e0c79929
      version: -1
      name: Set remediation grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      gridfield:
        simple: asmremediation
      keys:
        simple: Action,ActionTimestamp,Outcome,OutcomeTimestamp
      val1:
        simple: Manual remediation
      val2:
        complex:
          root: alert.asmdatacollection
          accessor: Timestamp
      val3:
        simple: Manual remediation completed
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: LastArrayElement
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 3640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "71":
    id: "71"
    taskid: 9e429cfb-edd2-4562-8506-027018884f23
    type: regular
    task:
      id: 9e429cfb-edd2-4562-8506-027018884f23
      version: -1
      name: Get current time
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "72"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 3300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "72":
    id: "72"
    taskid: 22a0bdaa-e449-4744-8d77-35a64e6bdb42
    type: condition
    task:
      id: 22a0bdaa-e449-4744-8d77-35a64e6bdb42
      version: -1
      name: Manual remediation selected?
      description: Determines if "manual remediation" was selected on main data collection task.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "73"
      manual from RPR:
      - "103"
      manual from data collection:
      - "69"
    separatecontext: false
    conditions:
    - label: "manual from data collection"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Select a remediation option.Answers
                accessor: "0"
            iscontext: true
          right:
            value:
              simple: Manual remediation
          ignorecase: true
    - label: manual from RPR
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: RemediationAction
            iscontext: true
          right:
            value:
              simple: Manual
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 3450
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "73":
    id: "73"
    taskid: 709cf157-9d47-473f-8b65-39b731aabfff
    type: regular
    task:
      id: 709cf157-9d47-473f-8b65-39b731aabfff
      version: -1
      name: Set remediation grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      gridfield:
        simple: asmremediation
      keys:
        simple: Action,ActionTimestamp,Outcome,OutcomeTimestamp
      val1:
        complex:
          root: alert.asmnotification
          accessor: Type
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'Notified service owner via '
              suffix: {}
      val2:
        complex:
          root: alert.asmnotification
          accessor: Timestamp
      val3:
        simple: Resolved by service owner
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: LastArrayElement
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 870,
          "y": 3640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "74":
    id: "74"
    taskid: e555dece-d030-41ce-8859-da2ad3eac0be
    type: regular
    task:
      id: e555dece-d030-41ce-8859-da2ad3eac0be
      version: -1
      name: Close alert (Auto-Close)
      description: Close the current alert because auto-close was selected,
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      closeNotes:
        simple: Alert status set to 'Resolved' by Active Response Module
      closeReason:
        simple: STATUS_160_RESOLVED
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -180,
          "y": 5020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "75":
    id: "75"
    taskid: 306c3a59-d1bd-478c-8a8f-ee4d98b55547
    type: regular
    task:
      id: 306c3a59-d1bd-478c-8a8f-ee4d98b55547
      version: -1
      name: Close alert (Remediated Automatically)
      description: Close the current alert because Automated Remediation path was selected.
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      closeNotes:
        simple: Alert status set to 'Resolved - Remediated Automatically' by Active Response Module
      closeReason:
        simple: Resolved - Remediated Automatically
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 400,
          "y": 5020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "81":
    id: "81"
    taskid: 1443dc39-c07c-4a04-879c-985f6da6b95e
    type: regular
    task:
      id: 1443dc39-c07c-4a04-879c-985f6da6b95e
      version: -1
      name: Set alert summary grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "23"
    scriptarguments:
      gridfield:
        simple: asmalertsummary
      keys:
        simple: Link,EntryID
      val1:
        complex:
          root: demistoUrls
          accessor: server
          transformers:
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: /xsoar/entry/download/
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ${lastCompletedTaskEntries.[0]}
                iscontext: true
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: '%40'
              toReplace:
                value:
                  simple: '@'
      val2:
        complex:
          root: lastCompletedTaskEntries
          accessor: '[0]'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 4670
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "86":
    id: "86"
    taskid: be116371-fcc0-4038-829f-95d3535da4d6
    type: playbook
    task:
      id: be116371-fcc0-4038-829f-95d3535da4d6
      version: -1
      name: Cortex ASM - Detect Service
      description: Playbook that looks at what ASM sub-type the alert is and directs it to different pre/post mitigation scans (such as NMAP).
      playbookName: Cortex ASM - Detect Service
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      ASMRuleID:
        complex:
          root: alert
          accessor: asmattacksurfaceruleid
      RemoteIP:
        complex:
          root: alert
          accessor: remoteip
      RemotePort:
        complex:
          root: alert
          accessor: remoteport
      ScanNumber:
        simple: "2"
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 90,
          "y": 3920
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "88":
    id: "88"
    taskid: d198f805-9c50-49dd-8a71-a46465f6bea4
    type: collection
    task:
      id: d198f805-9c50-49dd-8a71-a46465f6bea4
      version: -1
      name: Complete manual remediation
      description: Determines if manual remediation (by service owner or otherwise) was completed via analyst input.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "71"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -120,
          "y": 3130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: 'Please complete manual remediation and mark "complete" when done:'
        required: true
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: Yes, remediation complete
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      title: Verify that manual remediation was completed
      description: ""
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "91":
    id: "91"
    taskid: 558e07b1-d25e-4a1f-81ba-423b9f63d850
    type: playbook
    task:
      id: 558e07b1-d25e-4a1f-81ba-423b9f63d850
      version: -1
      name: Cortex ASM - Remediation Guidance
      playbookName: Cortex ASM - Remediation Guidance
      type: playbook
      iscommand: false
      brand: ""
      description: 'This playbook pulls remediation guidance off of a list based on ASM RuleID to be used in service owner notifications (email or ticketing system).'
    nexttasks:
      '#none#':
      - "94"
    separatecontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 930,
          "y": 2490
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    scriptarguments:
      IssueTypeID:
        complex:
          root: alert
          accessor: asmattacksurfaceruleid
          transformers:
          - operator: StripChars
            args:
              chars:
                value:
                  simple: '[\"]'
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
  "92":
    id: "92"
    taskid: 90571172-18e1-40af-841e-71bbb5af1820
    type: playbook
    task:
      id: 90571172-18e1-40af-841e-71bbb5af1820
      version: -1
      name: Cortex ASM - Remediation Guidance
      playbookName: Cortex ASM - Remediation Guidance
      type: playbook
      iscommand: false
      brand: ""
      description: 'This playbook pulls remediation guidance off of a list based on ASM RuleID to be used in service owner notifications (email or ticketing system).'
    nexttasks:
      '#none#':
      - "55"
    scriptarguments:
      IssueTypeID:
        complex:
          root: alert
          accessor: asmattacksurfaceruleid
          transformers:
          - operator: StripChars
            args:
              chars:
                value:
                  simple: '[\"]]'
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 1370,
          "y": 2490
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "93":
    id: "93"
    taskid: 4a0b20a3-16a1-421c-8ac8-1c1b89758d7e
    type: regular
    task:
      id: 4a0b20a3-16a1-421c-8ac8-1c1b89758d7e
      version: -1
      name: GenerateSummaryReport
      description: Generate an ASM Alert Summary report.
      scriptName: GenerateASMReport
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "81"
    scriptarguments:
      alert_details:
        complex:
          root: alert
          accessor: details
      alert_id:
        complex:
          root: alert
          accessor: id
      alert_name:
        complex:
          root: alert
          accessor: name
      alert_severityStr:
        complex:
          root: alert
          accessor: severityStr
      asm_cloud:
        complex:
          root: alert
          accessor: asmcloud
      asm_data_collection:
        complex:
          root: alert
          accessor: asmdatacollection
      asm_notification:
        complex:
          root: alert
          accessor: asmnotification
      asm_private_ip:
        complex:
          root: alert
          accessor: asmprivateip
      asm_related:
        complex:
          root: alert
          accessor: asmrelated
      asm_remediation:
        complex:
          root: alert
          accessor: asmremediation
      asm_service_detection:
        complex:
          root: alert
          accessor: asmservicedetection
      asm_service_owner:
        complex:
          root: alert
          accessor: asmserviceowner
      asm_system_ids:
        complex:
          root: alert
          accessor: asmsystemids
      asm_tags:
        complex:
          root: alert
          accessor: asmtags
      asm_remediation_path_rule:
        complex:
          root: alert
          accessor: asmremediationpathrule
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 4520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "94":
    id: "94"
    taskid: 264911db-37bb-4927-82da-d85197381208
    type: regular
    task:
      id: 264911db-37bb-4927-82da-d85197381208
      version: -1
      name: Create ServiceNow incident
      description: Creates new ServiceNow ticket.
      script: ServiceNow v2|||servicenow-create-ticket
      type: regular
      iscommand: true
      brand: ServiceNow v2
    nexttasks:
      '#none#':
      - "95"
    scriptarguments:
      description:
        complex:
          root: inputs.OwnerNotificationBody
          transformers:
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ${RemediationGuidance}
      extend-context:
        simple: 'ServiceNowDomain=.={"url": val.result.sys_domain.link.split(''api/now'')[0]}'
      short_description:
        complex:
          root: alert
          accessor: name
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'Cortex ASM Alert: '
              suffix: {}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 930,
          "y": 2650
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "95":
    id: "95"
    taskid: f94578e7-7a91-48de-8f8a-86abc639f66e
    type: regular
    task:
      id: f94578e7-7a91-48de-8f8a-86abc639f66e
      version: -1
      name: Set notification grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "50"
    scriptarguments:
      gridfield:
        simple: asmnotification
      keys:
        simple: Type,Value,URL,Timestamp
      val1:
        simple: ServiceNow
      val2:
        complex:
          root: ServiceNow.Ticket
          accessor: ID
      val3:
        complex:
          root: ServiceNowDomain
          accessor: url
          transformers:
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: incident.do?sysparm_query=number=
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ServiceNow.Ticket.Number
                iscontext: true
      val4:
        complex:
          root: ServiceNow.Ticket
          accessor: CreatedOn
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 930,
          "y": 2960
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "97":
    id: "97"
    taskid: 4e518fc3-fa31-4168-88df-acc7d46860ec
    type: playbook
    task:
      id: 4e518fc3-fa31-4168-88df-acc7d46860ec
      version: -1
      name: Cortex ASM - Enrichment
      description: Used as a container folder for all enrichments of ASM alerts.
      playbookName: Cortex ASM - Enrichment
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "8"
    separatecontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 830
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "98":
    id: "98"
    taskid: 257c7072-d19b-47a8-830c-500288215015
    type: playbook
    task:
      id: 257c7072-d19b-47a8-830c-500288215015
      version: -1
      name: Cortex ASM - Remediation
      description: This playbook contains all the cloud provider sub playbooks for remediation
      playbookName: Cortex ASM - Remediation
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "64"
    scriptarguments:
      RemediationRule:
        complex:
          root: inputs.RemediationRule
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      scriptArguments:
        NicID:
          complex:
            root: alert.asmsystemids
            filters:
            - - operator: isEqualString
                left:
                  value:
                    simple: alert.asmsystemids.Type
                  iscontext: true
                right:
                  value:
                    simple: AWS-NIC
            accessor: ID
        RemediationRule:
          complex:
            root: inputs.RemediationRule
        VpcID:
          complex:
            root: alert.asmsystemids
            filters:
            - - operator: isEqualString
                left:
                  value:
                    simple: alert.asmsystemids.Type
                  iscontext: true
                right:
                  value:
                    simple: AWS-VPC
            accessor: ID
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": -1250,
          "y": 2415
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "100":
    id: "100"
    taskid: 775fedc2-21d6-426e-8509-9973ac13dac9
    type: playbook
    task:
      id: 775fedc2-21d6-426e-8509-9973ac13dac9
      version: -1
      name: Cortex ASM - Detect Service
      playbookName: Cortex ASM - Detect Service
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      ASMRuleID:
        complex:
          root: alert
          accessor: asmattacksurfaceruleid
      RemoteIP:
        complex:
          root: alert
          accessor: remoteip
      RemotePort:
        complex:
          root: alert
          accessor: remoteport
      ScanNumber:
        simple: "1"
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 50,
          "y": 400
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "101":
    id: "101"
    taskid: 2bdb4a9e-2e38-4560-80de-52908d6873e6
    type: playbook
    task:
      id: 2bdb4a9e-2e38-4560-80de-52908d6873e6
      version: -1
      name: Cortex ASM - Remediation Path Rules
      description: This playbook returns "RemediationAction" options based return from Remediation Path Rules API, or defaults to data collection task options from "Cortex ADM - Decision" subplaybook.
      playbookName: Cortex ASM - Remediation Path Rules
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "102"
    scriptarguments:
      ExternallyDetectedProviders:
        complex:
          root: ASM.ExternalService
          accessor: externally_detected_providers
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1100
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "102":
    id: "102"
    taskid: 7b451b55-1fd2-465f-8a2d-9127abe3937e
    type: condition
    task:
      id: 7b451b55-1fd2-465f-8a2d-9127abe3937e
      version: -1
      name: What is the remediation action?
      description: Determines what the remediation action is (direct action or data collection task).
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "36"
      Automated Remediation:
      - "12"
      Manual Remediation:
      - "63"
      Notification Email:
      - "60"
      Prompt All Options:
      - "31"
      Prompt no AR:
      - "34"
      Prompt no ServiceNow:
      - "35"
      ServiceNow Ticket:
      - "10"
    separatecontext: false
    conditions:
    - label: Automated Remediation
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: RemediationAction
            iscontext: true
          right:
            value:
              simple: AR
    - label: ServiceNow Ticket
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: RemediationAction
            iscontext: true
          right:
            value:
              simple: SNOW
    - label: Notification Email
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: RemediationAction
            iscontext: true
          right:
            value:
              simple: Email
    - label: Manual Remediation
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: RemediationAction
            iscontext: true
          right:
            value:
              simple: Manual
    - label: Prompt All Options
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: RemediationAction
            iscontext: true
          right:
            value:
              simple: Prompt all options
    - label: Prompt no AR
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: RemediationAction
            iscontext: true
          right:
            value:
              simple: Prompt no ar
    - label: Prompt no ServiceNow
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: RemediationAction
            iscontext: true
          right:
            value:
              simple: Prompt no snow
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1250
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "103":
    id: "103"
    taskid: 98f612fe-f024-448e-88ec-e09959054785
    type: regular
    task:
      id: 98f612fe-f024-448e-88ec-e09959054785
      version: -1
      name: Set remediation grid field
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well. For example:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      gridfield:
        simple: asmremediation
      keys:
        simple: Action,ActionTimestamp,Outcome,OutcomeTimestamp
      val1:
        simple: Manual remediation
      val2:
        complex:
          root: RPR_Timestamp
      val3:
        simple: Manual remediation completed
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: LastArrayElement
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 3640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "102_12_Automated Remediation": 0.79,
      "102_31_Prompt All Options": 0.78,
      "48_10_ServiceNow ticket": 0.82,
      "48_12_Automated remediation": 0.87,
      "48_60_Notification email": 0.88,
      "48_63_Manual remediation": 0.54
    },
    "paper": {
      "dimensions": {
        "height": 5105,
        "width": 3450,
        "x": -1700,
        "y": 150
      }
    }
  }
inputs:
- key: OwnerNotificationSubject
  value:
    simple: "A new security risk was identified on an external service owned by your team"
  required: true
  description: "Subject of the notification (email or ticket) sent to potential service owner."
  playbookInputQuery:
- key: OwnerNotificationBody
  value:
    simple: |
      Infosec identified a security risk on an external service potentially owned by your team: ${alert.name}<br><br>

      Description: ${alert.details}
      <br><br>
  required: true
  description: Body of the notification (email or ticket) sent to potential service owner.
  playbookInputQuery:
- key: RemediationRule
  value:
    simple: |-
      Remediation-Security-Group
  required: true
  description: 'The firewall rule that will be used for remediating internet exposures. '
  playbookInputQuery:
outputs: []
tests:
- No tests (auto formatted)
fromversion: 6.5.0
