id: Cortex ASM - ASM Alert
version: -1
name: Cortex ASM - ASM Alert
description: This playbook aims to handle ASM alerts by enriching asset information and providing means of remediating the issue directly or through contacting service owners.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: ee272e7f-fc31-4a52-8e6d-cc1d3e37d7e4
    type: start
    task:
      id: ee272e7f-fc31-4a52-8e6d-cc1d3e37d7e4
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ""
    nexttasks:
      '#none#':
      - "5"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 150
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "4":
    id: "4"
    taskid: 9150cb6a-3bf2-477f-85ff-5f3b1ee59c28
    type: title
    task:
      id: 9150cb6a-3bf2-477f-85ff-5f3b1ee59c28
      version: -1
      name: Complete
      type: title
      iscommand: false
      brand: ""
      description: ""
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 90,
          "y": 5250
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "5":
    id: "5"
    taskid: 4dc043e5-f3d7-4ac3-8a6f-04b8e792dc82
    type: title
    task:
      id: 4dc043e5-f3d7-4ac3-8a6f-04b8e792dc82
      version: -1
      name: Triage and Qualifier Stage
      description: ''
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "83"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
    continueonerrortype: ""
  "6":
    id: "6"
    taskid: 02b2bd47-560b-4db3-8146-f7b688d6e4f0
    type: title
    task:
      id: 02b2bd47-560b-4db3-8146-f7b688d6e4f0
      version: -1
      name: Enrichment Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "87"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: 1e3394ba-182c-4529-8d06-776f4c8cb737
    type: title
    task:
      id: 1e3394ba-182c-4529-8d06-776f4c8cb737
      version: -1
      name: Decision Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "33"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 980
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: ff55a02b-047e-4a37-879b-9e2007830569
    type: title
    task:
      id: ff55a02b-047e-4a37-879b-9e2007830569
      version: -1
      name: Ticketing Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "67"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 900,
          "y": 2290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: 21302745-3283-4057-843b-3c70c1067727
    type: title
    task:
      id: 21302745-3283-4057-843b-3c70c1067727
      version: -1
      name: Validation Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "86"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 3870
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: 409fd7a6-f26c-4c31-8541-014b12df0a2c
    type: title
    task:
      id: 409fd7a6-f26c-4c31-8541-014b12df0a2c
      version: -1
      name: Remediation Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "77"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -740,
          "y": 2290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: b6603309-8fb7-4c1c-88d4-3a0f75cad25f
    type: title
    task:
      id: b6603309-8fb7-4c1c-88d4-3a0f75cad25f
      version: -1
      name: Summarization Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "82"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 4455
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 8c626493-e4a6-4b1c-8e95-92e038792d7b
    type: condition
    task:
      id: 8c626493-e4a6-4b1c-8e95-92e038792d7b
      version: -1
      name: Service exposure still observable?
      description: Determines if service was still observable or not.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "17"
      "yes":
      - "6"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEqualString
          left:
            value:
              complex:
                root: alert.asmservicedetection
                accessor: ScanResult
            iscontext: true
          right:
            value:
              simple: Closed
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 540
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: c85eb424-c46a-4588-8d7e-7e5410d6f550
    type: title
    task:
      id: c85eb424-c46a-4588-8d7e-7e5410d6f550
      version: -1
      name: continue
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "18"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1170,
          "y": 2290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: 60ee3958-0388-468e-81da-2353f1fc58c1
    type: regular
    task:
      id: 60ee3958-0388-468e-81da-2353f1fc58c1
      version: -1
      name: Close alert (service not observed)
      description: Close the current alert because service is no longer observed
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      closeNotes:
        simple: Alert status set to `Resolved - No Longer Observed` by AFR Module
      closeReason:
        simple: Resolved - No Longer Observed
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -780,
          "y": 5080
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: a78fd188-56df-4260-88ba-5bc54caf6ecc
    type: condition
    task:
      id: a78fd188-56df-4260-88ba-5bc54caf6ecc
      version: -1
      name: Service exposure still observable?
      description: Determines if service was still observable or not and also if automated remediation was done.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "21"
      "no":
      - "13"
    separatecontext: false
    conditions:
    - label: "no"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: alert.asmservicedetection
                accessor: ScanResult
                transformers:
                - operator: LastArrayElement
            iscontext: true
          right:
            value:
              simple: Closed
        - operator: isEqualString
          left:
            value:
              complex:
                root: alert.asmremediation
                accessor: Outcome
            iscontext: true
          right:
            value:
              simple: Success
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 4110
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: d70cdad2-287a-4a1e-80b6-befb7cb26fd2
    type: collection
    task:
      id: d70cdad2-287a-4a1e-80b6-befb7cb26fd2
      version: -1
      name: What to do if NMAP scan is inconclusive?
      description: Determines if alert should be closed or kept open for auto-closure based on analyst input.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "13"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 500,
          "y": 4280
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
        simple: The post migration NMAP scan wasn't conclusive, decide next steps.
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: false
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: If you know the issue has been remediated, chose to keep open and have next Xpanse scan auto-close or manually close now.
        required: false
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: Close Now
        - simple: Wait to Auto-close
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      title: Select a next step
      description: The post migration NMAP scan wasn't conclusive, decide next steps.
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: edfbfa63-9bcf-4b5f-8a29-34039d07b502
    type: condition
    task:
      id: edfbfa63-9bcf-4b5f-8a29-34039d07b502
      version: -1
      name: Auto-close or keep open?
      description: Determines if alert will be closed or kept open.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "4"
      Auto-Close:
      - "74"
      Automated-Remediation:
      - "75"
    separatecontext: false
    conditions:
    - label: Automated-Remediation
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: alert.asmremediation
                accessor: Outcome
            iscontext: true
          right:
            value:
              simple: Success
    - label: Auto-Close
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Select a next step.Answers
                accessor: "0"
            iscontext: true
          right:
            value:
              simple: Close Now
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 4890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: e766e441-5be0-490d-8303-aa3a0b925bea
    type: condition
    task:
      id: e766e441-5be0-490d-8303-aa3a0b925bea
      version: -1
      name: Should remediate automatically?
      description: Determines if playbook input for bypassing analyst interaction was set in order to continue to automated remediation.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "32"
      "yes":
      - "47"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.AutomatedRemediation
            iscontext: true
          right:
            value:
              simple: "True"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1270
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: 054118f3-6677-4f0b-88d8-cc70f4444a73
    type: collection
    task:
      id: 054118f3-6677-4f0b-88d8-cc70f4444a73
      version: -1
      name: Select remediation action (all options)
      description: Determines next action (remediation or ticket) based on user input.  Options are based on if ServiceNowV2 integration is setup and/or the alert meets the requirement for automated remediation.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "45"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 280,
          "y": 1640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
        simple: test@email.com
      subject:
        simple: Select Remediation Action
      body:
        simple: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean <a href="https://pan.dev">here</a>.
      methods: []
      format: html
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: false
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: What remediation action would you like to take?
        required: true
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: Automated remediation by restricting open ports
        - simple: Manual remediation
        - simple: File a ServiceNow Ticket
        - simple: Send a notification email
        fieldassociated: ""
        placeholder: ""
        tooltip: A selection is necessary in order for the playbook to progress further.
        readonly: false
      title: Select a remediation option
      description: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean at https://pan.dev
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: 6dd6631a-ba18-4195-802a-6c5f1762f87f
    type: condition
    task:
      id: 6dd6631a-ba18-4195-802a-6c5f1762f87f
      version: -1
      name: Is ServiceNow v2 enabled?
      description: Determines if the "ServiceNow v2" integration instance is in order to find email accounts for ServiceNow usernames.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "35"
      "yes":
      - "31"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: ServiceNow v2
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 80,
          "y": 1470
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: d1a43e1a-b9d8-46e5-8e8e-c44c5563b3e6
    type: condition
    task:
      id: d1a43e1a-b9d8-46e5-8e8e-c44c5563b3e6
      version: -1
      name: Meets automated remediation requirements?
      description: Determines if alert meets the criteria for automated remediation.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "37"
      "yes":
      - "28"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: alert
                accessor: asmattacksurfaceruleid
            iscontext: true
          right:
            value:
              simple: RdpServer
        - operator: containsGeneral
          left:
            value:
              complex:
                root: incident
                accessor: asmattacksurfaceruleid
            iscontext: true
          right:
            value:
              simple: InsecureOpenSSH
      - - operator: isEqualString
          left:
            value:
              complex:
                root: alert.asmcloud
                accessor: Provider
            iscontext: true
          right:
            value:
              simple: AWS
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: alert
                accessor: asmserviceowner
            iscontext: true
      - - operator: containsString
          left:
            value:
              complex:
                root: alert.asmtags
                accessor: Name
            iscontext: true
          right:
            value:
              simple: dev
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1110
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: 5a035a9e-cef5-4550-81b9-e55508d38dbd
    type: collection
    task:
      id: 5a035a9e-cef5-4550-81b9-e55508d38dbd
      version: -1
      name: Select remediation action (no automated-remediation)
      description: Determines next action (remediation or ticket) based on user input.  Options are based on if ServiceNowV2 integration is setup and/or the alert meets the requirement for automated remediation.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "38"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1190,
          "y": 1530
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
        simple: test@email.com
      subject:
        simple: Select Remediation Action
      body:
        simple: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean <a href="https://pan.dev">here</a>.
      methods: []
      format: html
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: false
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: What remediation action would you like to take?
        required: true
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: Manual remediation
        - simple: File a ServiceNow Ticket
        - simple: Send a notification email
        fieldassociated: ""
        placeholder: ""
        tooltip: A selection is necessary in order for the playbook to progress further.
        readonly: false
      title: Select a remediation option
      description: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean at https://pan.dev
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: 260f8dc3-4d55-4606-8026-0bb9afacbe67
    type: collection
    task:
      id: 260f8dc3-4d55-4606-8026-0bb9afacbe67
      version: -1
      name: Select remediation action (no ServiceNow)
      description: Determines next action (remediation or ticket) based on user input.  Options are based on if ServiceNowV2 integration is setup and/or the alert meets the requirement for automated remediation.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "46"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -120,
          "y": 1640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
        simple: test@email.com
      subject:
        simple: Select Remediation Action
      body:
        simple: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean <a href="https://pan.dev">here</a>.
      methods: []
      format: html
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: false
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: What remediation action would you like to take?
        required: true
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: Automated remediation by restricting open ports
        - simple: Manual remediation
        - simple: Send a notification email
        fieldassociated: ""
        placeholder: ""
        tooltip: A selection is necessary in order for the playbook to progress further.
        readonly: false
      title: Select a remediation option
      description: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean at https://pan.dev
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: d0904dc1-1854-4643-89b1-67e8e9410347
    type: collection
    task:
      id: d0904dc1-1854-4643-89b1-67e8e9410347
      version: -1
      name: Select remediation action (base)
      description: Determines next action (remediation or ticket) based on user input.  Options are based on if ServiceNowV2 integration is setup and/or the alert meets the requirement for automated remediation.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "44"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 790,
          "y": 1530
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
        simple: test@email.com
      subject:
        simple: Select Remediation Action
      body:
        simple: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean <a href="https://pan.dev">here</a>.
      methods: []
      format: html
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: false
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: What remediation action would you like to take?
        required: true
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: Manual remediation
        - simple: Send a notification email
        fieldassociated: ""
        placeholder: ""
        tooltip: A selection is necessary in order for the playbook to progress further.
        readonly: false
      title: Select a remediation option
      description: Cortex Xpanse has the ability to fully remediate or augment your remediation process via integrations in other security and IT tools and control surfaces. The options presented in this prompt may vary depending on the integrations that your organization has configured and the type of alert. You can learn more about why you're seeing these options and what they mean at https://pan.dev
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: cf36caf3-25f0-4581-8d6e-467c50b9907e
    type: condition
    task:
      id: cf36caf3-25f0-4581-8d6e-467c50b9907e
      version: -1
      name: Is ServiceNow v2 enabled?
      description: Determines if the "ServiceNow v2" integration instance is in order to find email accounts for ServiceNow usernames.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "36"
      "yes":
      - "34"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: ServiceNow v2
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 980,
          "y": 1360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: b90f23c0-43c1-4dc6-8773-e67001ab409c
    type: regular
    task:
      id: b90f23c0-43c1-4dc6-8773-e67001ab409c
      version: -1
      name: Get current time
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "43"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1190,
          "y": 1680
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: 2c651d9c-2119-40b6-8df6-16749d419059
    type: regular
    task:
      id: 2c651d9c-2119-40b6-8df6-16749d419059
      version: -1
      name: Set data collection grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      gridfield:
        simple: asmdatacollection
      keys:
        simple: Options,Selected,Answerer,Timestamp
      val1:
        simple: WHAT REMEDIATION ACTION WOULD YOU LIKE TO TAKE?
      val2:
        complex:
          root: Select a remediation option.Answers
          accessor: "0"
      val3:
        complex:
          root: Select a remediation option.Answers
          accessor: name
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -120,
          "y": 1950
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "41":
    id: "41"
    taskid: 726a3788-f99c-4b71-87ce-e2068fc363cf
    type: regular
    task:
      id: 726a3788-f99c-4b71-87ce-e2068fc363cf
      version: -1
      name: Set data collection grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      gridfield:
        simple: asmdatacollection
      keys:
        simple: Options,Selected,Answerer,Timestamp
      val1:
        simple: WHAT REMEDIATION ACTION WOULD YOU LIKE TO TAKE?
      val2:
        complex:
          root: Select a remediation option.Answers
          accessor: "0"
      val3:
        complex:
          root: Select a remediation option.Answers
          accessor: name
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 280,
          "y": 1950
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "42":
    id: "42"
    taskid: 33b4c565-0409-423d-81fc-98954cb79622
    type: regular
    task:
      id: 33b4c565-0409-423d-81fc-98954cb79622
      version: -1
      name: Set data collection grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      gridfield:
        simple: asmdatacollection
      keys:
        simple: Options,Selected,Answerer,Timestamp
      val1:
        simple: WHAT REMEDIATION ACTION WOULD YOU LIKE TO TAKE?
      val2:
        complex:
          root: Select a remediation option.Answers
          accessor: "0"
      val3:
        complex:
          root: Select a remediation option.Answers
          accessor: name
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 790,
          "y": 1840
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "43":
    id: "43"
    taskid: 020a16e4-4ca6-4271-83d4-343500264934
    type: regular
    task:
      id: 020a16e4-4ca6-4271-83d4-343500264934
      version: -1
      name: Set data collection grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      gridfield:
        simple: asmdatacollection
      keys:
        simple: Options,Selected,Answerer,Timestamp
      val1:
        simple: WHAT REMEDIATION ACTION WOULD YOU LIKE TO TAKE?
      val2:
        complex:
          root: Select a remediation option.Answers
          accessor: "0"
      val3:
        complex:
          root: Select a remediation option.Answers
          accessor: name
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1190,
          "y": 1840
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "44":
    id: "44"
    taskid: 8ec4f538-a44d-42fe-814e-c92e78c65f1c
    type: regular
    task:
      id: 8ec4f538-a44d-42fe-814e-c92e78c65f1c
      version: -1
      name: Get current time
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "42"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 790,
          "y": 1680
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "45":
    id: "45"
    taskid: a73d35a4-838a-4b8b-8ff0-721c3431a81e
    type: regular
    task:
      id: a73d35a4-838a-4b8b-8ff0-721c3431a81e
      version: -1
      name: Get current time
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "41"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 280,
          "y": 1790
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "46":
    id: "46"
    taskid: 7f0345e5-cc92-4ab5-816a-7fadd851ee4a
    type: regular
    task:
      id: 7f0345e5-cc92-4ab5-816a-7fadd851ee4a
      version: -1
      name: Get current time
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "39"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -120,
          "y": 1790
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "47":
    id: "47"
    taskid: 92d87a68-3318-481e-8a76-a6690379e6d5
    type: title
    task:
      id: 92d87a68-3318-481e-8a76-a6690379e6d5
      version: -1
      name: Bypass
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "12"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -740,
          "y": 1470
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "48":
    id: "48"
    taskid: 9839f091-7ebc-4e42-823a-3a1455c02f13
    type: condition
    task:
      id: 9839f091-7ebc-4e42-823a-3a1455c02f13
      version: -1
      name: What was data collection task response?
      description: Determines next action (remediation or ticket) based on previous data collection task.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "88"
      Automated remediation:
      - "12"
      Manual remediation:
      - "63"
      Notification email:
      - "60"
      ServiceNow ticket:
      - "10"
    separatecontext: false
    conditions:
    - label: Automated remediation
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Select a remediation option.Answers
                accessor: "0"
            iscontext: true
          right:
            value:
              simple: Automated remediation by restricting open ports
    - label: Manual remediation
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Select a remediation option.Answers
                accessor: "0"
            iscontext: true
          right:
            value:
              simple: Manual remediation
    - label: ServiceNow ticket
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Select a remediation option.Answers
                accessor: "0"
            iscontext: true
          right:
            value:
              simple: File a ServiceNow Ticket
    - label: Notification email
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Select a remediation option.Answers
                accessor: "0"
            iscontext: true
          right:
            value:
              simple: Send a notification email
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 2120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "50":
    id: "50"
    taskid: ba0aea71-4a95-4799-812a-7d354b4f5c5d
    type: collection
    task:
      id: ba0aea71-4a95-4799-812a-7d354b4f5c5d
      version: -1
      name: Verify service exposure resolved by service owner
      description: Determines if manual remediation (by service owner or otherwise) was completed via analyst input.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "71"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 360,
          "y": 3190
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: 'Please verify service exposure was resolved by service owner and mark "complete" when done:'
        required: true
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: Yes, remediation complete
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      title: Verify that service exposure was resolved by service owner
      description: ""
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "54":
    id: "54"
    taskid: 2c02f6a1-dd04-4b60-832d-92c3ce764574
    type: collection
    task:
      id: 2c02f6a1-dd04-4b60-832d-92c3ce764574
      version: -1
      name: Select owners to notify
      description: Determines who to send notification emails to based on analyst input.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "85"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1340,
          "y": 2400
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
        simple: Select owners to notify
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: false
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: 'Enter email addresses to notify:'
        required: true
        gridcolumns: []
        defaultrows: []
        type: shortText
        options: []
        optionsarg: []
        fieldassociated: ""
        placeholder: ""
        tooltip: Add multiple addresses separated by commas
        readonly: false
      title: Select owners to notify
      description: ""
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "55":
    id: "55"
    taskid: e90ef6c8-583e-4150-8d5f-6b6866cd05d6
    type: regular
    task:
      id: e90ef6c8-583e-4150-8d5f-6b6866cd05d6
      version: -1
      name: Send email
      description: Send an email to service owner with alert information.
      script: '|||send-mail'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "62"
    scriptarguments:
      body:
        complex:
          root: inputs.OwnerNotificationBody
          transformers:
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ${RemediationGuidance}
      subject:
        complex:
          root: inputs.OwnerNotificationSubject
      to:
        complex:
          root: Select owners to notify.Answers
          accessor: "0"
          transformers:
          - operator: split
            args:
              delimiter:
                value:
                  simple: ','
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1340,
          "y": 2710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "56":
    id: "56"
    taskid: 17017807-1ca4-4b96-8d34-1943bba1ca77
    type: regular
    task:
      id: 17017807-1ca4-4b96-8d34-1943bba1ca77
      version: -1
      name: Create ServiceNow incident
      description: Creates new ServiceNow ticket.
      script: ServiceNow v2|||servicenow-create-ticket
      type: regular
      iscommand: true
      brand: ServiceNow v2
    nexttasks:
      '#none#':
      - "57"
    scriptarguments:
      description:
        complex:
          root: inputs.OwnerNotificationBody
          transformers:
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ${RemediationGuidance}
      short_description:
        complex:
          root: inputs.OwnerNotificationSubject
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 900,
          "y": 2710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "57":
    id: "57"
    taskid: 19421289-d995-494a-8dff-3e62f0d57186
    type: regular
    task:
      id: 19421289-d995-494a-8dff-3e62f0d57186
      version: -1
      name: Set notification grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "50"
    scriptarguments:
      gridfield:
        simple: asmnotification
      keys:
        simple: Type,Value,Url,Timestamp
      val1:
        simple: ServiceNow
      val2:
        complex:
          root: ServiceNow.Ticket
          accessor: ID
      val3:
        simple: n/a
      val4:
        complex:
          root: ServiceNow.Ticket
          accessor: CreatedOn
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 900,
          "y": 3020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "59":
    id: "59"
    taskid: d558bc46-2149-4ee6-8532-e6d6604e3171
    type: regular
    task:
      id: d558bc46-2149-4ee6-8532-e6d6604e3171
      version: -1
      name: Set notification grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "50"
    scriptarguments:
      gridfield:
        simple: asmnotification
      keys:
        simple: Type,Value,Url,Timestamp
      val1:
        simple: Email
      val2:
        complex:
          root: Select owners to notify.Answers
          accessor: "0"
      val3:
        simple: n/a
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: LastArrayElement
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1340,
          "y": 3020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "60":
    id: "60"
    taskid: fe4625c8-31b6-405a-8fa2-77119ea5faf8
    type: title
    task:
      id: fe4625c8-31b6-405a-8fa2-77119ea5faf8
      version: -1
      name: Ticketing Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "54"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1340,
          "y": 2290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "62":
    id: "62"
    taskid: 73e65aa8-7673-4e7d-858c-a4eb5c8fdfc9
    type: regular
    task:
      id: 73e65aa8-7673-4e7d-858c-a4eb5c8fdfc9
      version: -1
      name: Get current time
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "59"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1340,
          "y": 2865
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "63":
    id: "63"
    taskid: 96f40abc-46dc-42e5-80ef-c2581d58b6a7
    type: title
    task:
      id: 96f40abc-46dc-42e5-80ef-c2581d58b6a7
      version: -1
      name: Remediation Stage
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "88"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -320,
          "y": 2290
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "64":
    id: "64"
    taskid: 38a1eabe-8a35-4233-8dc8-585052e6f377
    type: regular
    task:
      id: 38a1eabe-8a35-4233-8dc8-585052e6f377
      version: -1
      name: Get current time
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "65"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -390,
          "y": 3500
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "65":
    id: "65"
    taskid: 260d3a1c-f45d-47af-878a-126b9fc4d7c4
    type: regular
    task:
      id: 260d3a1c-f45d-47af-878a-126b9fc4d7c4
      version: -1
      name: Set remediation grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      gridfield:
        simple: asmremediation
      keys:
        simple: Action,ActionTimestamp,Outcome,OutcomeTimestamp
      val1:
        simple: close service port from internet
      val2:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: LastArrayElement
          - operator: TimeStampToDate
      val3:
        simple: Success
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: LastArrayElement
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -390,
          "y": 3690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "67":
    id: "67"
    taskid: 6476d703-db83-4647-8760-9fee27700dc9
    type: regular
    task:
      id: 6476d703-db83-4647-8760-9fee27700dc9
      version: -1
      name: Get remediation guidance
      description: Pull remediation guidance based on a list of Xpanse issueTypeId to remediationGuidance pairings.
      scriptName: GetRemediationGuidance
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "56"
    scriptarguments:
      AttackSurfaceRuleID:
        complex:
          root: alert
          accessor: asmattacksurfaceruleid
          transformers:
          - operator: replace
            args:
              limit: {}
              replaceWith: {}
              toReplace:
                value:
                  simple: '['
          - operator: replace
            args:
              limit: {}
              replaceWith: {}
              toReplace:
                value:
                  simple: '"'
          - operator: replace
            args:
              limit: {}
              replaceWith: {}
              toReplace:
                value:
                  simple: ']'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 900,
          "y": 2550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "69":
    id: "69"
    taskid: 7cadbf45-fb27-45f5-87cc-e2a378eb1aa8
    type: regular
    task:
      id: 7cadbf45-fb27-45f5-87cc-e2a378eb1aa8
      version: -1
      name: Set remediation grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      gridfield:
        simple: asmremediation
      keys:
        simple: Action,ActionTimestamp,Outcome,OutcomeTimestamp
      val1:
        simple: Manual remediation
      val2:
        complex:
          root: alert.asmdatacollection
          accessor: Timestamp
      val3:
        simple: Manual remediation completed
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: LastArrayElement
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 3700
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "71":
    id: "71"
    taskid: 00f8a50f-8323-4887-879c-60299e421bb0
    type: regular
    task:
      id: 00f8a50f-8323-4887-879c-60299e421bb0
      version: -1
      name: Get current time
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "72"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 3360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "72":
    id: "72"
    taskid: e98c5f72-de3e-4cda-84d1-47211d016be4
    type: condition
    task:
      id: e98c5f72-de3e-4cda-84d1-47211d016be4
      version: -1
      name: Manual remediation selected?
      description: Determines if "manual remediation" was selected on main data collection task.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "73"
      "yes":
      - "69"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Select a remediation option.Answers
                accessor: "0"
            iscontext: true
          right:
            value:
              simple: Manual remediation
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 3510
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "73":
    id: "73"
    taskid: 88966ba9-d56b-4755-830f-34e109a76a92
    type: regular
    task:
      id: 88966ba9-d56b-4755-830f-34e109a76a92
      version: -1
      name: Set remediation grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      gridfield:
        simple: asmremediation
      keys:
        simple: Action,ActionTimestamp,Outcome,OutcomeTimestamp
      val1:
        complex:
          root: alert.asmnotification
          accessor: Type
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'Notified service owner via '
              suffix: {}
      val2:
        complex:
          root: alert.asmnotification
          accessor: Timestamp
      val3:
        simple: Resolved by service owner
      val4:
        complex:
          root: TimeNowUnix
          transformers:
          - operator: LastArrayElement
          - operator: TimeStampToDate
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 520,
          "y": 3700
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "74":
    id: "74"
    taskid: 0cd0b144-6132-4bb7-8666-d591f8ab3d08
    type: regular
    task:
      id: 0cd0b144-6132-4bb7-8666-d591f8ab3d08
      version: -1
      name: Close alert (Auto-Close)
      description: Close the current alert because auto-close selected
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      closeNotes:
        simple: Alert status set to `Resolved` by AFR Module
      closeReason:
        simple: Resolved
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -180,
          "y": 5080
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "75":
    id: "75"
    taskid: 50f949a8-5927-4483-85d5-115b5a1d9449
    type: regular
    task:
      id: 50f949a8-5927-4483-85d5-115b5a1d9449
      version: -1
      name: Close alert (Remediated Automatically)
      description: Close the current alert because Automated Remediation path selected
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      closeNotes:
        simple: Alert status set to `Resolved - Remediated Automatically` by AFR Module
      closeReason:
        simple: Resolved - Remediated Automatically
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 400,
          "y": 5080
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "77":
    id: "77"
    taskid: 88a04e9e-60a6-40d0-8c5b-2b01363bbb60
    type: playbook
    task:
      id: 88a04e9e-60a6-40d0-8c5b-2b01363bbb60
      version: -1
      name: AWS - Security Group Remediation
      description: Replace current security groups with limited access security groups.
      playbookName: AWS - Security Group Remediation
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "64"
    scriptarguments:
      NicID:
        complex:
          root: alert.asmsystemids
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: alert.asmsystemids.Type
                iscontext: true
              right:
                value:
                  simple: AWS-NIC
          accessor: ID
      RemediationRule:
        complex:
          root: inputs.RemediationRule
      VpcID:
        complex:
          root: alert.asmsystemids
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: alert.asmsystemids.Type
                iscontext: true
              right:
                value:
                  simple: AWS-VPC
          accessor: ID
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": -740,
          "y": 2400
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "81":
    id: "81"
    taskid: 739b0b2e-4bb9-44b3-8fa1-fca7ca738e6d
    type: regular
    task:
      id: 739b0b2e-4bb9-44b3-8fa1-fca7ca738e6d
      version: -1
      name: Set alert summary grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Example of command:
        `!GridFieldSetup keys=ip,src val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "23"
    scriptarguments:
      gridfield:
        simple: asmalertsummary
      keys:
        simple: Link,EntryID
      val1:
        complex:
          root: demistoUrls
          accessor: server
          transformers:
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: /xsoar/entry/download/
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ${lastCompletedTaskEntries.[0]}
                iscontext: true
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: '%40'
              toReplace:
                value:
                  simple: '@'
      val2:
        complex:
          root: lastCompletedTaskEntries
          accessor: '[0]'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 4730
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "82":
    id: "82"
    taskid: 267ac5d5-f046-4b95-865d-8c45a5a030a7
    type: regular
    task:
      id: 267ac5d5-f046-4b95-865d-8c45a5a030a7
      version: -1
      name: GenerateSummaryReport
      description: Generate an ASM Alert Summary report.
      scriptName: GenerateASMReport
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "81"
    scriptarguments:
      alert_details:
        complex:
          root: alert
          accessor: details
      alert_id:
        complex:
          root: alert
          accessor: id
      alert_name:
        complex:
          root: alert
          accessor: name
      alert_severityStr:
        complex:
          root: alert
          accessor: severityStr
      asmcloud:
        complex:
          root: alert
          accessor: asmcloud
      asmdatacollection:
        complex:
          root: alert
          accessor: asmdatacollection
      asmnotification:
        complex:
          root: alert
          accessor: asmnotification
      asmprivateip:
        complex:
          root: alert
          accessor: asmprivateip
      asmrelated:
        complex:
          root: alert
          accessor: asmrelated
      asmremediation:
        complex:
          root: alert
          accessor: asmremediation
      asmservicedetection:
        complex:
          root: alert
          accessor: asmservicedetection
      asmserviceowner:
        complex:
          root: alert
          accessor: asmserviceowner
      asmsystemids:
        complex:
          root: alert
          accessor: asmsystemids
      asmtags:
        complex:
          root: alert
          accessor: asmtags
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 90,
          "y": 4580
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "83":
    id: "83"
    taskid: 7f124821-ed90-458a-89cc-02e23066aeb8
    type: playbook
    task:
      id: 7f124821-ed90-458a-89cc-02e23066aeb8
      version: -1
      name: Cortex ASM - Detect Service
      description: Playbook that looks at what ASM sub-type the alert is and direct to different pre/post mitigation scans (such as NMAP).
      playbookName: Cortex ASM - Detect Service
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      ASMRuleID:
        complex:
          root: alert
          accessor: asmattacksurfaceruleid
      RemoteIP:
        complex:
          root: alert
          accessor: remoteip
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: None
      RemotePort:
        complex:
          root: alert
          accessor: remoteport
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: None
      ScanNumber:
        simple: "1"
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 50,
          "y": 400
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "85":
    id: "85"
    taskid: fa131b07-00e2-4f6a-81ca-9d969377640c
    type: regular
    task:
      id: fa131b07-00e2-4f6a-81ca-9d969377640c
      version: -1
      name: Get remediation guidance
      description: Pull remediation guidance based on a list of Xpanse issueTypeId to remediationGuidance pairings.
      scriptName: GetRemediationGuidance
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "55"
    scriptarguments:
      AttackSurfaceRuleID:
        complex:
          root: alert
          accessor: asmattacksurfaceruleid
          transformers:
          - operator: replace
            args:
              limit: {}
              replaceWith: {}
              toReplace:
                value:
                  simple: '['
          - operator: replace
            args:
              limit: {}
              replaceWith: {}
              toReplace:
                value:
                  simple: '"'
          - operator: replace
            args:
              limit: {}
              replaceWith: {}
              toReplace:
                value:
                  simple: ']'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1340,
          "y": 2550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "86":
    id: "86"
    taskid: a3b5a2b7-0778-4cb4-88c4-cf2031514c28
    type: playbook
    task:
      id: a3b5a2b7-0778-4cb4-88c4-cf2031514c28
      version: -1
      name: Cortex ASM - Detect Service
      description: Playbook that looks at what ASM sub-type the alert is and direct to different pre/post mitigation scans (such as NMAP).
      playbookName: Cortex ASM - Detect Service
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      ASMRuleID:
        complex:
          root: alert
          accessor: asmattacksurfaceruleid
      RemoteIP:
        complex:
          root: alert
          accessor: remoteip
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: None
      RemotePort:
        complex:
          root: alert
          accessor: remoteport
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: None
      ScanNumber:
        simple: "2"
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 90,
          "y": 3980
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "87":
    id: "87"
    taskid: c58dc447-db1c-436a-83d1-f9583e30ebbf
    type: playbook
    task:
      id: c58dc447-db1c-436a-83d1-f9583e30ebbf
      version: -1
      name: Cortex ASM - Enrichment
      playbookName: Cortex ASM - Enrichment
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "8"
    scriptarguments:
      RemoteIP:
        complex:
          root: alert
          accessor: remoteip
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: None
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 50,
          "y": 830
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "88":
    id: "88"
    taskid: fb0a6008-8c8f-49aa-87e2-fff4b5400289
    type: collection
    task:
      id: fb0a6008-8c8f-49aa-87e2-fff4b5400289
      version: -1
      name: Complete manual remediation
      description: Determines if manual remediation (by service owner or otherwise) was completed via analyst input.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "71"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -120,
          "y": 3190
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
        completeafterv2: true
        completeaftersla: false
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: 'Please complete manual remediation and mark "complete" when done:'
        required: true
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: Yes, remediation complete
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      title: Verify that manual remediation was completed
      description: ""
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "28_47_yes": 0.48,
      "33_37_#default#": 0.35,
      "48_10_ServiceNow ticket": 0.82,
      "48_60_Notification email": 0.88,
      "48_63_Manual remediation": 0.6
    },
    "paper": {
      "dimensions": {
        "height": 5165,
        "width": 2890,
        "x": -1170,
        "y": 150
      }
    }
  }
inputs:
- key: AutomatedRemediation
  value:
    simple: "False"
  required: true
  description: 'Decide whether to potential skip analyst intervention and conduct automated remediation if meeting the following criteria: issue is Insecure OpenSSH/RDP, happened on EC2 instance, service owner information found and indicators of a non-prod host.  Default if "False" (don''t do automated remediation).  Set "True" to turn this feature on.'
  playbookInputQuery:
- key: OwnerNotificationSubject
  value:
    simple: A new security risk was identified on an external service owned by your team
  required: true
  description: Subject of the notification (email or ticket) send to potential service owner.
  playbookInputQuery:
- key: OwnerNotificationBody
  value:
    simple: |+
      Infosec identified a security risk on an external service potentially owned by your team: ${alert.name}

      Description: ${alert.details}

  required: true
  description: Body of the notification (email or ticket) send to potential service owner.
  playbookInputQuery:
- key: RemediationRule
  value:
    simple: Remediation-Security-Group
  required: true
  description: 'The firewall rule that will used for remediating internet exposures. '
  playbookInputQuery:
outputs: []
tests:
- No tests (auto formatted)
fromversion: 6.5.0
system: true
