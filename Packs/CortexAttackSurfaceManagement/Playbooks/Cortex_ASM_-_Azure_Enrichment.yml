id: Cortex ASM - Azure Enrichment
version: -1
name: Cortex ASM - Azure Enrichment
description: Given the IP address, this playbook enriches Azure information relevant to ASM alerts.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: cf72405b-002e-45ab-864b-93d9983d156a
    type: start
    task:
      id: cf72405b-002e-45ab-864b-93d9983d156a
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - '50'
    separatecontext: false
    continueonerrortype: ""
    view: "{\n  \"position\": {\n    \"x\": 450,\n    \"y\": -360\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: af5ce807-f82d-4cf0-8bdb-804bbc062dd4
    type: title
    task:
      id: af5ce807-f82d-4cf0-8bdb-804bbc062dd4
      version: -1
      name: Set Fields
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "3"
      - "4"
      - "7"
      - "25"
      - '51'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 450,
          "y": -30
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: 7e79a382-a33a-471b-87e5-65a6e4b67298
    type: condition
    task:
      id: 7e79a382-a33a-471b-87e5-65a6e4b67298
      version: -1
      name: Is there IAM information?
      description: Determines if there is IAM information to set in the service owner field.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "42"
      "yes":
      - "9"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: MSGraphUser
            iscontext: true
          right:
            value: {}
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: Account
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -440,
          "y": 160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: fd32548e-ede3-4707-8edf-6c6c36747901
    type: condition
    task:
      id: fd32548e-ede3-4707-8edf-6c6c36747901
      version: -1
      name: Is there Azure compute information?
      description: Determines if there is Azure Compute information to set in the system ID fields.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "yes":
      - "11"
      '#default#':
      - '42'
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: Azure
                accessor: Compute
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 240,
          "y": 160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: 34834160-6169-42a2-8012-f1aa3072380a
    type: condition
    task:
      id: 34834160-6169-42a2-8012-f1aa3072380a
      version: -1
      name: Is there Azure network information?
      description: Determines if there is Azure network information to set in the ASM Private IP field.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "43"
      "yes":
      - "18"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: Azure
                accessor: Network
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: "{\n  \"position\": {\n    \"x\": 1930,\n    \"y\": 160\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: c57c0d1c-c256-4a9b-8c85-f11032024a40
    type: regular
    task:
      id: c57c0d1c-c256-4a9b-8c85-f11032024a40
      version: -1
      name: Set service owner grid field
      description: Sets the potential Azure service owner to the grid field for the ASM service owner object.
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "39"
    scriptarguments:
      gridfield:
        simple: asmserviceowner
      keys:
        simple: name,email,source,timestamp
      val1:
        complex:
          root: Account
          accessor: DisplayName
      val2:
        complex:
          root: Account
          filters:
          - - operator: isEmpty
              left:
                value:
                  simple: Account.Email.Address
                iscontext: true
            - operator: isNotEmpty
              left:
                value:
                  simple: Account.Email.Address
                iscontext: true
          transformers:
          - operator: getField
            args:
              field:
                value:
                  simple: Email
          - operator: getField
            args:
              field:
                value:
                  simple: Address
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: n/a
      val3:
        simple: Azure
      val4:
        simple: TIMESTAMP
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -440,
          "y": 540
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: aa4f0ace-ee61-4317-8bb7-1ab9f106d615
    type: title
    task:
      id: aa4f0ace-ee61-4317-8bb7-1ab9f106d615
      version: -1
      name: Service Owner
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "8"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -440,
          "y": 395
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: 9bdfe31b-11f5-4ffe-8a10-2e5c6f8809cc
    type: title
    task:
      id: 9bdfe31b-11f5-4ffe-8a10-2e5c6f8809cc
      version: -1
      name: System IDs
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - '49'
    separatecontext: false
    continueonerrortype: ""
    view: "{\n  \"position\": {\n    \"x\": 260,\n    \"y\": 395\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: 527fa1dd-49ff-485f-8fdd-978d35987450
    type: regular
    task:
      id: 527fa1dd-49ff-485f-8fdd-978d35987450
      version: -1
      name: Set system IDs grid field (NSG)
      description: Sets Azure NSG information to the grid field for the ASM system IDs object.
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "13"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: type,id,link
      val1:
        simple: ASSET-SG
      val2:
        complex:
          root: Azure.Network.Interfaces.NetworkSecurityGroup
          accessor: id
          transformers:
          - operator: substringFrom
            args:
              from:
                value:
                  simple: networkSecurityGroups/
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: "{\n  \"position\": {\n    \"x\": 260,\n    \"y\": 705\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: 48248ba8-a016-4c3d-8b40-5e458ef3233e
    type: regular
    task:
      id: 48248ba8-a016-4c3d-8b40-5e458ef3233e
      version: -1
      name: Set system IDs grid field (Resource Group)
      description: Sets Azure resource group information to the grid field for the ASM system IDs object. The variable name "CLOUD-RG" is chosen because multiple CSPs have a concept of a resource group including Alibaba, IBM Cloud, and Azure.
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "15"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: type,id,link
      val1:
        simple: ASSET-RG
      val2:
        complex:
          root: Azure.Compute
          accessor: ResourceGroup
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: "{\n  \"position\": {\n    \"x\": 260,\n    \"y\": 870\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "15":
    id: "15"
    taskid: 006baf33-faf6-4f8a-89ad-25591ebf4f85
    type: regular
    task:
      id: 006baf33-faf6-4f8a-89ad-25591ebf4f85
      version: -1
      name: Set system IDs grid field (NIC)
      description: Sets Azure NIC information to the grid field for the ASM system IDs object. The variable name "ASSET-NIC" is chosen because it can used for more than just compute resources in all cloud providers.
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: type,id,link
      val1:
        simple: ASSET-NIC
      val2:
        complex:
          root: Azure.Compute.NetworkInterfaces
          accessor: id
          transformers:
          - operator: substringFrom
            args:
              from:
                value:
                  simple: networkInterfaces/
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: "{\n  \"position\": {\n    \"x\": 260,\n    \"y\": 1040\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: ee9627bc-19e2-4394-8f8b-fb166a6e1c38
    type: regular
    task:
      id: ee9627bc-19e2-4394-8f8b-fb166a6e1c38
      version: -1
      name: Set system IDs grid field (ID)
      description: Sets the Azure Compute instance ID to the grid field for the ASM system IDs object.
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "23"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: type,id,link
      val1:
        simple: ASSET-ID
      val2:
        complex:
          root: Azure.Compute
          accessor: ID
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: "{\n  \"position\": {\n    \"x\": 260,\n    \"y\": 1210\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: dd0c6fd4-643d-4d96-8769-48c9cf643952
    type: regular
    task:
      id: dd0c6fd4-643d-4d96-8769-48c9cf643952
      version: -1
      name: Set private IP grid field
      description: Sets the private IP to the grid field for the ASM private IP object.
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "30"
    scriptarguments:
      gridfield:
        simple: asmprivateip
      keys:
        simple: ip,source
      val1:
        complex:
          root: Azure.Network.Interfaces.IPConfigurations
          accessor: PrivateIPAddress
      val2:
        simple: Azure
    separatecontext: false
    continueonerrortype: ""
    view: "{\n  \"position\": {\n    \"x\": 1930,\n    \"y\": 540\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: 4e3260ce-dd04-4a2b-8fcb-a5510bbebdcc
    type: title
    task:
      id: 4e3260ce-dd04-4a2b-8fcb-a5510bbebdcc
      version: -1
      name: Private IP
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "17"
    separatecontext: false
    continueonerrortype: ""
    view: "{\n  \"position\": {\n    \"x\": 1930,\n    \"y\": 405\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: ca9b9fe6-87d8-4e4a-89f1-e20ba69002bf
    type: title
    task:
      id: ca9b9fe6-87d8-4e4a-89f1-e20ba69002bf
      version: -1
      name: Cloud
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "20"
    separatecontext: false
    continueonerrortype: ""
    view: "{\n  \"position\": {\n    \"x\": 1290,\n    \"y\": 395\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: 1edded92-2e34-49d8-802c-c269071f8878
    type: regular
    task:
      id: 1edded92-2e34-49d8-802c-c269071f8878
      version: -1
      name: Set cloud grid field
      description: Sets Azure subscription, resource group, and location information to the grid field for the ASM cloud object.
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      gridfield:
        simple: asmcloud
      keys:
        simple: provider,organization,project,region,other
      val1:
        simple: Azure
      val2:
        complex:
          root: Azure.Compute.NetworkInterfaces
          accessor: id
          transformers:
          - operator: ExtractInbetween
            args:
              from:
                value:
                  simple: subscriptions/
              to:
                value:
                  simple: /resourceGroups
      val3:
        complex:
          root: Azure.Compute
          accessor: ResourceGroup
      val4:
        complex:
          root: Azure.Compute
          accessor: Location
      val5:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: "{\n  \"position\": {\n    \"x\": 1290,\n    \"y\": 530\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: aa1ada77-28d9-4047-8241-3cc45659b460
    type: regular
    task:
      id: aa1ada77-28d9-4047-8241-3cc45659b460
      version: -1
      name: Set system IDs grid field (Compute Name)
      description: Sets the Azure Compute instance name to the grid field for the ASM system IDs object.
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "38"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: type,id,link
      val1:
        simple: ASSET-NAME
      val2:
        complex:
          root: Azure.Compute
          accessor: Name
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: "{\n  \"position\": {\n    \"x\": 260,\n    \"y\": 1380\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: a31174a0-735b-40a9-8faa-f0bec7ec289f
    type: condition
    task:
      id: a31174a0-735b-40a9-8faa-f0bec7ec289f
      version: -1
      name: Is there Azure compute information?
      description: Determines if there is Azure Compute information to set in the Cloud ASM fields.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "43"
      "yes":
      - "19"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: Azure
                accessor: Compute
            iscontext: true
          right:
            value: {}
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: Azure
                accessor: Network
            iscontext: true
    continueonerrortype: ""
    view: "{\n  \"position\": {\n    \"x\": 1290,\n    \"y\": 160\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: 66ba01b2-1fc2-47f3-8283-a00b6911bd34
    type: regular
    task:
      id: 66ba01b2-1fc2-47f3-8283-a00b6911bd34
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "33"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_azure
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: "{\n  \"position\": {\n    \"x\": 1930,\n    \"y\": 705\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: d04ea2f1-0778-4133-89ee-e710f1687bca
    type: regular
    task:
      id: d04ea2f1-0778-4133-89ee-e710f1687bca
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "34"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_azure
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: "{\n  \"position\": {\n    \"x\": 1290,\n    \"y\": 705\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: c6cb79da-0e7b-4da1-807f-c816be5369b7
    type: title
    task:
      id: c6cb79da-0e7b-4da1-807f-c816be5369b7
      version: -1
      name: System IDs - End
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "44"
    separatecontext: false
    continueonerrortype: ""
    view: "{\n  \"position\": {\n    \"x\": 260,\n    \"y\": 1770\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: ce5ab593-8382-41aa-84cc-38e06574705d
    type: title
    task:
      id: ce5ab593-8382-41aa-84cc-38e06574705d
      version: -1
      name: Private IP - End
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "44"
    separatecontext: false
    continueonerrortype: ""
    view: "{\n  \"position\": {\n    \"x\": 1930,\n    \"y\": 1010\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: dc09af91-5966-4cc6-8976-276a01b8745c
    type: title
    task:
      id: dc09af91-5966-4cc6-8976-276a01b8745c
      version: -1
      name: Cloud - End
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "44"
    separatecontext: false
    continueonerrortype: ""
    view: "{\n  \"position\": {\n    \"x\": 1290,\n    \"y\": 1010\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: 6e76036b-b6a4-4ffd-8fec-df6463431e1c
    type: regular
    task:
      id: 6e76036b-b6a4-4ffd-8fec-df6463431e1c
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "32"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_azure
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: "{\n  \"position\": {\n    \"x\": 260,\n    \"y\": 1545\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: dae9c5ee-1dce-4031-8afe-4bbe5ffd791f
    type: regular
    task:
      id: dae9c5ee-1dce-4031-8afe-4bbe5ffd791f
      version: -1
      name: Set true flag for completed enrichment
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "40"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_azure
      value:
        simple: "true"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -440,
          "y": 705
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: e3887014-d1d5-4d18-846d-ce1d1236a6d6
    type: title
    task:
      id: e3887014-d1d5-4d18-846d-ce1d1236a6d6
      version: -1
      name: Service Owner - End
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "44"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -440,
          "y": 1425
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "42":
    id: "42"
    taskid: 59fb59e3-e39e-4333-8790-c4725b499478
    type: regular
    task:
      id: 59fb59e3-e39e-4333-8790-c4725b499478
      version: -1
      name: Set false flag for completed enrichment
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "32"
      - "40"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_azure
      value:
        simple: "false"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -170,
          "y": 870
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "43":
    id: "43"
    taskid: adba3a7d-e9fe-441b-8387-f72a64bc6fb9
    type: regular
    task:
      id: adba3a7d-e9fe-441b-8387-f72a64bc6fb9
      version: -1
      name: Set false flag for completed enrichment
      description: Set a value in context under the key you entered.
      type: regular
      iscommand: false
      brand: ""
      script: Set
    nexttasks:
      '#none#':
      - "34"
      - "33"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: asm_enrichment_flag_azure
      value:
        simple: "false"
    separatecontext: false
    continueonerrortype: ""
    view: "{\n  \"position\": {\n    \"x\": 1600,\n    \"y\": 830\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "44":
    id: "44"
    taskid: d809d2d1-8d11-4950-8a71-3e1c64b38807
    type: title
    task:
      id: d809d2d1-8d11-4950-8a71-3e1c64b38807
      version: -1
      name: Closing Steps
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "47"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1197.5,
          "y": 1990
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "45":
    id: "45"
    taskid: 8591ae5d-bcd4-49ce-8e57-a8fc48e5fc49
    type: title
    task:
      id: 8591ae5d-bcd4-49ce-8e57-a8fc48e5fc49
      version: -1
      name: Complete
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1207.5,
          "y": 2580
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "46":
    id: "46"
    taskid: 13a256d7-9f5f-4073-8165-d88571a5a6e8
    type: regular
    task:
      id: 13a256d7-9f5f-4073-8165-d88571a5a6e8
      version: -1
      name: Set ASM enrichment status to true
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Instead of a value you can enter `TIMESTAMP` to get the current timestamp in ISO format. For example:
        `!GridFieldSetup keys=ip,src,timestamp val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" val3="TIMESTAMP" gridfiled="gridfield"`
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "45"
    scriptarguments:
      gridfield:
        simple: asmenrichmentstatus
      keys:
        simple: source,record_exists,timestamp
      val1:
        simple: Azure
      val2:
        simple: "true"
      val3:
        simple: TIMESTAMP
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1442.5,
          "y": 2360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "47":
    id: "47"
    taskid: f9e9b99d-5b7d-42a4-871f-6dd8bdc28e3e
    type: condition
    task:
      id: f9e9b99d-5b7d-42a4-871f-6dd8bdc28e3e
      version: -1
      name: Was enrichment performed?
      description: Check if enrichment was performed by checking for a value of true in the relevant flag variable.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "48"
      "yes":
      - "46"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: asm_enrichment_flag_azure
            iscontext: true
          right:
            value:
              simple: "true"
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1197.5,
          "y": 2140
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "48":
    id: "48"
    taskid: fe9cf582-491c-4e84-8598-7c2ab9dea4d8
    type: regular
    task:
      id: fe9cf582-491c-4e84-8598-7c2ab9dea4d8
      version: -1
      name: Set ASM enrichment status to false
      description: |-
        Automation used to more easily populate a grid field. This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Instead of a value you can enter `TIMESTAMP` to get the current timestamp in ISO format. For example:
        `!GridFieldSetup keys=ip,src,timestamp val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" val3="TIMESTAMP" gridfiled="gridfield"`
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "45"
    scriptarguments:
      gridfield:
        simple: asmenrichmentstatus
      keys:
        simple: source,record_exists,timestamp
      val1:
        simple: Azure
      val2:
        simple: "false"
      val3:
        simple: TIMESTAMP
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 990,
          "y": 2360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "49":
    id: "49"
    taskid: 1627df8e-76a7-4b7a-8860-1a5cfaa907b9
    type: regular
    task:
      id: 1627df8e-76a7-4b7a-8860-1a5cfaa907b9
      version: -1
      name: Set system IDs grid field (type)
      description: Sets the type of cloud asset to the grid field for the ASM system IDs object.
      type: regular
      iscommand: false
      brand: Builtin
      script: GridFieldSetup
    nexttasks:
      '#none#':
      - "12"
    scriptarguments:
      gridfield:
        simple: asmsystemids
      keys:
        simple: type,id,link
      val1:
        simple: ASSET-TYPE
      val2:
        simple: Azure Compute
      val3:
        simple: n/a
    separatecontext: false
    continueonerrortype: ""
    view: "{\n  \"position\": {\n    \"x\": 260,\n    \"y\": 530\n  }\n}"
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '50':
    continueonerrortype: ''
    id: '50'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '2'
    note: false
    quietmode: 0
    scriptarguments:
      AzureIP:
        simple: ${inputs.RemoteIP}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ''
      description: Given an IP address, this playbook enriches Azure Compute, Microsoft Graph User, and IAM information and outputs Azure Compute, Microsoft Graph User, and IAM information.
      id: 552168a5-fe49-4238-8c68-ad255bf6262c
      iscommand: false
      name: Azure - Enrichment
      playbookId: Azure - Enrichment
      type: playbook
      version: -1
    taskid: 552168a5-fe49-4238-8c68-ad255bf6262c
    timertriggers: []
    type: playbook
    view: "{\n  \"position\": {\n    \"x\": 450,\n    \"y\": -210\n  }\n}"
  '51':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: AzureAssetHierarchy
          operator: isNotEmpty
      label: Yes
    continueonerrortype: ''
    id: '51'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      Yes:
      - '52'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Determines if there is Azure Compute information to set in the Cloud ASM fields.
      id: 4aa3f4df-e8ba-42c6-80e1-3baf0cb1877e
      iscommand: false
      name: Is there Azure hierarchy information?
      type: condition
      version: -1
    taskid: 4aa3f4df-e8ba-42c6-80e1-3baf0cb1877e
    timertriggers: []
    type: condition
    view: "{\n  \"position\": {\n    \"x\": 750,\n    \"y\": 160\n  }\n}"
  '52':
    continueonerrortype: ''
    id: '52'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '53'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 4956c946-228d-43ab-8d24-91a18eb5e7d6
      iscommand: false
      name: Hierarchy
      type: title
      version: -1
      description: ''
    taskid: 4956c946-228d-43ab-8d24-91a18eb5e7d6
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": 750,\n    \"y\": 395\n  }\n}"
  '53':
    continueonerrortype: ''
    id: '53'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '54'
    note: false
    quietmode: 0
    scriptarguments:
      asmassethierarchy:
        simple: ${AzureAssetHierarchy}
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.set.incident
      id: d9320f94-6915-4afc-8d7c-c26b75adde72
      iscommand: true
      name: Set hierarchy grid field
      script: Builtin|||setAlert
      type: regular
      version: -1
    taskid: d9320f94-6915-4afc-8d7c-c26b75adde72
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 750,\n    \"y\": 530\n  }\n}"
  '54':
    continueonerrortype: ''
    id: '54'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '44'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 46805d76-345f-4694-8330-53f721d6b03d
      iscommand: false
      name: Hierarchy - End
      type: title
      version: -1
      description: ''
    taskid: 46805d76-345f-4694-8330-53f721d6b03d
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": 750,\n    \"y\": 735\n  }\n}"
view: "{\n  \"linkLabelsPosition\": {\n    \"25_19_yes\": 0.6,\n    \"3_42_#default#\": 0.32,\n    \"3_9_yes\": 0.5,\n    \"4_11_yes\": 0.43,\n    \"4_42_#default#\": 0.31,\n    \"7_18_yes\": 0.5\n  },\n  \"paper\": {\n    \"dimensions\": {\n      \"height\": 3005,\n      \"width\": 2750,\n      \"x\": -440,\n      \"y\": -360\n    }\n  }\n}"
inputSections:
- description: Generic group for inputs
  inputs:
  - RemoteIP
  name: General (Inputs group)
inputs:
- description: IP address of the service.
  key: RemoteIP
  playbookInputQuery:
  required: false
  value:
    complex:
      accessor: remoteip
      root: inputs
fromversion: 6.5.0
tests:
- No tests (auto formatted)
