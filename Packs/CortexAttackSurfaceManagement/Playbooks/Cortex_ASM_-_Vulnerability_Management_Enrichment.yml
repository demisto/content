id: Cortex ASM - Vulnerability Management Enrichment
version: -1
name: Cortex ASM - Vulnerability Management Enrichment
description: Deprecated. No available replacement. This playbook will look up an IP address in Tenable.io or Rapid7 InsightVM.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 99e75dec-0004-47a8-86cf-7784768b7eda
    type: start
    task:
      id: 99e75dec-0004-47a8-86cf-7784768b7eda
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ""
    nexttasks:
      '#none#':
      - "2"
      - "10"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 340,
          "y": -80
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: 1b0ec0f3-2081-4b8b-881e-d99c2266923a
    type: regular
    task:
      id: 1b0ec0f3-2081-4b8b-881e-d99c2266923a
      version: -1
      name: tenable-io-get-vulnerabilities-by-asset
      description: Gets a list of up to 5000 of the vulnerabilities recorded for a specified asset.
      script: Tenable.io|||tenable-io-get-vulnerabilities-by-asset
      type: regular
      iscommand: true
      brand: Tenable.io
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      dateRange:
        complex:
          root: inputs.DaysPast
      ip:
        complex:
          root: inputs.IP
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -380,
          "y": 660
        }
      }
    note: true
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: 62582fbd-65c0-47b3-8bbb-1a9561dfe459
    type: condition
    task:
      id: 62582fbd-65c0-47b3-8bbb-1a9561dfe459
      version: -1
      name: Is Tenable.io Enabled?
      type: condition
      iscommand: false
      brand: ""
      description: ""
    nexttasks:
      '#default#':
      - "3"
      "yes":
      - "7"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Tenable.io
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
          right:
            value: {}
    view: |-
      {
        "position": {
          "x": 50,
          "y": 280
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: 53703990-ba87-45dc-8f65-5d69f77498be
    type: title
    task:
      id: 53703990-ba87-45dc-8f65-5d69f77498be
      version: -1
      name: Complete
      type: title
      iscommand: false
      brand: ""
      description: ""
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 340,
          "y": 1700
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: 33292a48-5944-46a2-8e6b-b738b713588d
    type: condition
    task:
      id: 33292a48-5944-46a2-8e6b-b738b713588d
      version: -1
      name: Do Vulnerability Findings Exist?
      description: Check if a given value exists in the context. Will return 'no' for empty empty arrays. To be used mostly with DQ and selectors.
      scriptName: Exists
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "9"
      "yes":
      - "3"
    scriptarguments:
      value:
        complex:
          root: TenableIO.Vulnerabilities
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: TenableIO.Vulnerabilities
                iscontext: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -380,
          "y": 870
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: 6468186e-8384-435f-81a7-24e2a0f11e1b
    type: regular
    task:
      id: 6468186e-8384-435f-81a7-24e2a0f11e1b
      version: -1
      name: Launch Vulnerability Assessment scan manually in https://cloud.tenable.com/
      type: regular
      iscommand: false
      brand: ""
      description: ""
    nexttasks:
      '#none#':
      - "3"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -380,
          "y": 1310
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: 43905bfc-f344-4ca4-8f3d-1419a7eee40f
    type: condition
    task:
      id: 43905bfc-f344-4ca4-8f3d-1419a7eee40f
      version: -1
      name: IP address exists?
      description: Check if a given value exists in the context. Will return 'no' for empty empty arrays. To be used mostly with DQ and selectors.
      scriptName: Exists
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "3"
      "yes":
      - "1"
    scriptarguments:
      value:
        complex:
          root: inputs.IP
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -380,
          "y": 460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: 40bc4d00-f2f0-4f09-846e-4bb6d741f4fa
    type: regular
    task:
      id: 40bc4d00-f2f0-4f09-846e-4bb6d741f4fa
      version: -1
      name: tenable-io-launch-scan
      description: Launches a scan with existing or custom targets. You can specify custom targets in the command arguments.
      script: Tenable.io|||tenable-io-launch-scan
      type: regular
      iscommand: true
      brand: Tenable.io
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      scanId:
        complex:
          root: inputs.TenableScanId
      scanTargets:
        complex:
          root: inputs.IP
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -870,
          "y": 1310
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: 4f356cc5-aad3-4598-8579-8daef5c87471
    type: condition
    task:
      id: 4f356cc5-aad3-4598-8579-8daef5c87471
      version: -1
      name: Does Tenable.io Scan ID Exist?
      description: Check if a given value exists in the context. Will return 'no' for empty empty arrays. To be used mostly with DQ and selectors.
      scriptName: Exists
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "6"
      "yes":
      - "8"
    scriptarguments:
      value:
        complex:
          root: inputs.TenableScanId
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -380,
          "y": 1100
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: 449c2e79-6a4b-46d8-8dc2-f5e5522eee4e
    type: condition
    task:
      id: 449c2e79-6a4b-46d8-8dc2-f5e5522eee4e
      version: -1
      name: Is Rapid7 InsightVM Enabled?
      type: condition
      iscommand: false
      brand: ""
      description: ""
    nexttasks:
      '#default#':
      - "3"
      "yes":
      - "11"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Rapid7 Nexpose
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
          right:
            value: {}
    view: |-
      {
        "position": {
          "x": 630,
          "y": 280
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: 3723ac9c-1631-46ad-8297-35db74e7e696
    type: condition
    task:
      id: 3723ac9c-1631-46ad-8297-35db74e7e696
      version: -1
      name: IP address exists?
      description: Check if a given value exists in the context. Will return 'no' for empty empty arrays. To be used mostly with DQ and selectors.
      scriptName: Exists
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "3"
      "yes":
      - "12"
    scriptarguments:
      value:
        complex:
          root: inputs.IP
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 950,
          "y": 460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: 38292c41-5da6-487b-8f00-5a002749db80
    type: regular
    task:
      id: 38292c41-5da6-487b-8f00-5a002749db80
      version: -1
      name: nexpose-search-assets
      description: Returns all assets for which you have access that match the given search criteria.
      script: '|||nexpose-search-assets'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "13"
    scriptarguments:
      ipAddressIs:
        complex:
          root: inputs.IP
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 950,
          "y": 660
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: 0ac02fa0-760b-4a95-8e9f-733128e064f6
    type: condition
    task:
      id: 0ac02fa0-760b-4a95-8e9f-733128e064f6
      version: -1
      name: Has Asset been assessed by Rapid7
      description: Check if a given value exists in the context. Will return 'no' for empty empty arrays. To be used mostly with DQ and selectors.
      scriptName: Exists
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "14"
      "yes":
      - "15"
    scriptarguments:
      value:
        complex:
          root: Nexpose.Asset
          accessor: Assessed
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 950,
          "y": 870
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "14":
    id: "14"
    taskid: 1a50b035-c5a8-477d-8ab2-2c0b60834377
    type: regular
    task:
      id: 1a50b035-c5a8-477d-8ab2-2c0b60834377
      version: -1
      name: nexpose-start-assets-scan
      description: Starts a scan for specified asset IP addresses and host names.
      script: Rapid7 Nexpose|||nexpose-start-assets-scan
      type: regular
      iscommand: true
      brand: Rapid7 Nexpose
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      IPs:
        complex:
          root: inputs.IP
      name:
        complex:
          root: inputs.IP
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'VM Scan of '
              suffix:
                value:
                  simple: ' started by Cortex XSIAM'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1490,
          "y": 1110
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "15":
    id: "15"
    taskid: 3e07f752-bc7d-451c-84b7-135af8747312
    type: regular
    task:
      id: 3e07f752-bc7d-451c-84b7-135af8747312
      version: -1
      name: Print Asset Results
      description: Convert an array to a nice table display. Usually, from the context.
      scriptName: ToTable
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      columns:
        simple: AssetId,Name,Assessed,LastScanId, Vulnerabilities
      data:
        complex:
          root: Nexpose
          accessor: Assets
      title:
        complex:
          root: Nexpose.Asset
          accessor: AssetId
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'Results for asset - '
              suffix: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 950,
          "y": 1110
        }
      }
    note: true
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 1845,
        "width": 2740,
        "x": -870,
        "y": -80
      }
    }
  }
inputs:
- key: IP
  value: {}
  required: true
  description: IP address to look up in VM tool
  playbookInputQuery:
- key: DaysPast
  value:
    simple: "30"
  required: false
  description: How many days in the past to look for scan results
  playbookInputQuery:
- key: TenableScanId
  value: {}
  required: false
  description: The Tenable.io Scan Template ID used to launch a new scan
  playbookInputQuery:
outputs: []
tests:
- No tests
fromversion: 6.5.0
deprecated: true
supportedModules:
- X1
- X3
- X5
- ENT_PLUS
