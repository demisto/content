id: Cortex ASM - Remediation Objectives
version: -1
name: Cortex ASM - Remediation Objectives
description: Playbook that populates remediation objectives field that is used to display the remediation actions to the end user
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 5e71ab69-e5f2-4dd6-82b9-e4ec135fb721
    type: start
    task:
      id: 5e71ab69-e5f2-4dd6-82b9-e4ec135fb721
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "14"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 550,
          "y": -140
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: b9557f14-9294-4fe3-8f70-a852d355e712
    type: regular
    task:
      id: b9557f14-9294-4fe3-8f70-a852d355e712
      version: -1
      name: Set remediation artifacts grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Instead of a value you can enter `TIMESTAMP` to get the current timestamp in ISO format. For example:
        `!GridFieldSetup keys=ip,src,timestamp val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" val3="TIMESTAMP" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "5"
    scriptarguments:
      gridfield:
        simple: asmremediationobjectives
      keys:
        simple: 1,2,3
      val1:
        simple: replace the security group that is allowing the risky service to be exposed to the public internet with a new security group
      val2:
        simple: The new security group be created with the name of the old security group with '_xpanse_ar_XXX' appended to it
      val3:
        simple: XXX signifies a random three digit number so there are not naming conflicts
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 760,
          "y": 220
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: e80da9ea-6af2-4ca7-838a-17dc42a8b08d
    type: title
    task:
      id: e80da9ea-6af2-4ca7-838a-17dc42a8b08d
      version: -1
      name: Complete
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 560,
          "y": 420
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: b613d902-d71c-4cd1-858d-5ff0b6074134
    type: regular
    task:
      id: b613d902-d71c-4cd1-858d-5ff0b6074134
      version: -1
      name: Set remediation artifacts grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Instead of a value you can enter `TIMESTAMP` to get the current timestamp in ISO format. For example:
        `!GridFieldSetup keys=ip,src,timestamp val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" val3="TIMESTAMP" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "5"
    scriptarguments:
      gridfield:
        simple: asmremediationobjectives
      keys:
        simple: 1,2,3
      val1:
        simple: ' add a new Azure Network Security Group (NSG) rules to the NSG attached to a NIC'
      val2:
        complex:
          root: inputs.RemotePort
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: rule remediation-block-port-
              suffix:
                value:
                  simple: '-'
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ${alert.protocol}
                iscontext: true
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ' will ensure that internal communication to this asset can continue'
          - operator: toLowerCase
      val3:
        complex:
          root: inputs.RemotePort
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: remediation-allow-port-
              suffix:
                value:
                  simple: '-'
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ${alert.protocol}
                iscontext: true
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ' will ensure that internal communication to this asset can continue'
          - operator: toLowerCase
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -50,
          "y": 220
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: 884d7db6-3617-481c-8437-13ed35ce478c
    type: regular
    task:
      id: 884d7db6-3617-481c-8437-13ed35ce478c
      version: -1
      name: Set remediation artifacts grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Instead of a value you can enter `TIMESTAMP` to get the current timestamp in ISO format. For example:
        `!GridFieldSetup keys=ip,src,timestamp val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" val3="TIMESTAMP" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "5"
    scriptarguments:
      gridfield:
        simple: asmremediationobjectives
      keys:
        simple: 1,2,3
      val1:
        simple: create an empty S3 bucket with no external access that matches the organizationâ€™s undefined DNS CNAME record
      val2:
        complex:
          root: alert.asmsystemids
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: alert.asmsystemids.Type
                iscontext: true
              right:
                value:
                  simple: S3-BucketName
          accessor: ID
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'The DNS name '
              suffix:
                value:
                  simple: ' was queried'
      val3:
        complex:
          root: alert.asmsystemids
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: alert.asmsystemids.Type
                iscontext: true
              right:
                value:
                  simple: S3-BucketName
          accessor: ID
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'the bucket name '
              suffix:
                value:
                  simple: ' will be created'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1170,
          "y": 220
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: ef6a3b4b-16fb-4e19-829f-d74a3db821c4
    type: regular
    task:
      id: ef6a3b4b-16fb-4e19-829f-d74a3db821c4
      version: -1
      name: Set remediation artifacts grid field
      description: |-
        Automation used to more easily populate a grid field.  This is necessary when you want to assign certain values as static or if you have context paths that you will assign to different values as well.  Instead of a value you can enter `TIMESTAMP` to get the current timestamp in ISO format. For example:
        `!GridFieldSetup keys=ip,src,timestamp val1=${AWS.EC2.Instances.NetworkInterfaces.PrivateIpAddress} val2="AWS" val3="TIMESTAMP" gridfiled="gridfield"`
      scriptName: GridFieldSetup
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "5"
    scriptarguments:
      gridfield:
        simple: asmremediationobjectives
      keys:
        simple: 1,2,3,4
      val1:
        simple: create two new firewall rules
      val2:
        complex:
          root: inputs.RemotePort
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: rule remediation-block-port-
              suffix:
                value:
                  simple: '-'
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ${alert.protocol}
                iscontext: true
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ' will block all internet traffic to this service'
          - operator: toLowerCase
      val3:
        complex:
          root: inputs.RemotePort
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: remediation-allow-port-
              suffix:
                value:
                  simple: '-'
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ${alert.protocol}
                iscontext: true
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ' will ensure that internal communication to this asset can continue'
          - operator: toLowerCase
      val4:
        complex:
          root: alert.asmsystemids
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: alert.asmsystemids.Type
                iscontext: true
              right:
                value:
                  simple: GCP-VMNAME
          accessor: ID
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'fter these rules are created, '
              suffix:
                value:
                  simple: ' will have a new network tag named remediation-tag-'
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: inputs.RemotePort
                iscontext: true
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: '-'
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ${alert.protocol}
                iscontext: true
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: ' which will apply these new firewall rules and restrict public internet access.'
          - operator: toLowerCase
          - operator: concat
            args:
              prefix:
                value:
                  simple: A
              suffix: {}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 360,
          "y": 220
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "14":
    id: "14"
    taskid: bffc5438-be2d-433c-8d4b-dbc4a5206dbc
    type: condition
    task:
      id: bffc5438-be2d-433c-8d4b-dbc4a5206dbc
      version: -1
      name: What provider is this service?
      description: Determines which cloud provider the service is in order to direct to the correct enrichment.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      AWS:
      - "4"
      Azure:
      - "9"
      GCP:
      - "12"
      Unclaimed S3 Bucket:
      - "10"
    separatecontext: false
    conditions:
    - label: AWS
      condition:
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: alert.asmcloud
                accessor: Provider
            iscontext: true
          right:
            value:
              simple: AWS
    - label: GCP
      condition:
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: alert.asmcloud
                accessor: Provider
            iscontext: true
          right:
            value:
              simple: GCP
    - label: Azure
      condition:
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: alert.asmcloud
                accessor: Provider
            iscontext: true
          right:
            value:
              simple: Azure
    - label: Unclaimed S3 Bucket
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: alert
                accessor: asmattacksurfaceruleid
                transformers:
                - operator: StripChars
                  args:
                    chars:
                      value:
                        simple: '[\"]'
            iscontext: true
          right:
            value:
              simple: UnclaimedS3Bucket
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 550,
          "y": -5
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 625,
        "width": 1600,
        "x": -50,
        "y": -140
      }
    }
  }
inputs:
- key: RemotePort
  value:
    complex:
      root: alert
      accessor: remoteport
  required: false
  description: The remote port that is publicly exposed to.
  playbookInputQuery:
outputs: []
tests:
- No tests (auto formatted)
fromversion: 6.8.0
