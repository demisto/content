import json
from pathlib import Path

from InvestigationDetailedSummaryToTable import table_command

TEST_DATA_DIR = Path(__file__).parent / 'test_data'


def _dump_test_file(file_name: str, content: dict | list):
    (TEST_DATA_DIR / file_name).write_text(json.dumps(content))


def _load_test_file(file_name: str):
    return json.loads((TEST_DATA_DIR / file_name).read_text())


def test_empty_context():
    assert table_command({}).to_context() == _load_test_file('empty_context.json')


def test_table_command():
    context = {
        "Defense Evasion": {
            "Deobfuscate/Decode Files or Information": True,
            "Indicator Removal on Host": False
        },
        "Execution": {
            "Command and Scripting Interpreter": True,
            "Command and Scripting Interpreter: PowerShell": True
        },
    }
    assert table_command(context).to_context() == _load_test_file('table_command.json')
