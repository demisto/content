id: MDE Malware - Incident Enrichment
version: 4
contentitemexportablefields:
  contentitemfields:
    packID: MicrosoftDefenderAdvancedThreatProtection
    packName: Microsoft Defender for Endpoint
    itemVersion: 1.11.2
    fromServerVersion: 6.5.0
    toServerVersion: ""
    definitionid: ""
vcShouldKeepItemLegacyProdMachine: false
name: MDE Malware - Incident Enrichment
description: This playbook enriches Microsoft Defender For Endpoint alerts. The enrichment
  is done on the involved endpoint and Mitre technique ID information, and it sets
  the 'Malware-Investigation and Response' layout.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: b4f45af0-1855-4ffc-8ae2-b6efdb25a99a
    type: start
    task:
      id: b4f45af0-1855-4ffc-8ae2-b6efdb25a99a
      version: -1
      name: ""
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "41"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": 230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: aaf8082e-fe44-455d-8ca0-f9243218db51
    type: regular
    task:
      id: aaf8082e-fe44-455d-8ca0-f9243218db51
      version: -1
      name: Enrich endpoint details
      description: Lists the Microsoft Defender for Endpoint sensors.
      script: '|||endpoint'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      id:
        complex:
          root: incident
          accessor: agentsid
          transformers:
          - operator: uniq
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 0,
          "y": 1370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: d7598165-3381-43cf-8f70-b98573542890
    type: title
    task:
      id: d7598165-3381-43cf-8f70-b98573542890
      version: -1
      name: Mitre Att&ck
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "43"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": 1240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: b809c6e6-e279-45c0-83f7-594e33bd74dc
    type: regular
    task:
      id: b809c6e6-e279-45c0-83f7-594e33bd74dc
      version: -1
      name: Set Evidence Information to context
      description: |-
        Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs.paloaltonetworks.com/cortex/cortex-xsoar/6-2/cortex-xsoar-admin/playbooks/automations.html
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "44"
    scriptarguments:
      key:
        simple: MicrosoftATP.Alert
      value:
        complex:
          root: incident
          accessor: additionaldata
          transformers:
          - operator: join
            args:
              separator:
                value:
                  simple: ','
          - operator: Stringify
          - operator: concat
            args:
              prefix:
                value:
                  simple: '{"Evidence":['
              suffix:
                value:
                  simple: ']}'
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -230,
          "y": 740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: 19cc7fd9-f64e-467d-8e95-50b3a4b27cef
    type: condition
    task:
      id: 19cc7fd9-f64e-467d-8e95-50b3a4b27cef
      version: -1
      name: Check if Evidence was fetched?
      description: Check if evidence was fetched?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "42"
      "yes":
      - "7"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: incident.additionaldata
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 170,
          "y": 550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: fd55a5be-7079-4fbe-808a-d06085b0dc09
    type: title
    task:
      id: fd55a5be-7079-4fbe-808a-d06085b0dc09
      version: -1
      name: Entity Enrichments
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "11"
      - "5"
      - "28"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": 1080
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: 81deed9f-324d-49d0-80bd-09cc648e819f
    type: title
    task:
      id: 81deed9f-324d-49d0-80bd-09cc648e819f
      version: -1
      name: Endpoint
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "2"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 0,
          "y": 1240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 8ce1dc17-7c0b-436c-8388-66db07dce8d2
    type: title
    task:
      id: 8ce1dc17-7c0b-436c-8388-66db07dce8d2
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2330
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: 59f3baeb-51ec-4cff-885b-9abf05e25091
    type: title
    task:
      id: 59f3baeb-51ec-4cff-885b-9abf05e25091
      version: -1
      name: Set Process To Layout
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "22"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": 1700
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: 96a6cd07-020b-4f52-881d-694925536f1f
    type: regular
    task:
      id: 96a6cd07-020b-4f52-881d-694925536f1f
      version: -1
      name: Set Endpoint information to layout
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      deviceid:
        simple: ${Endpoint.[0].ID}
      devicelocalip:
        simple: ${Endpoint.[0].IPAddress}
      devicemacaddress:
        simple: ${Endpoint.[0].MACAddress}
      devicename:
        simple: ${Endpoint.[0].Hostname}
      deviceosname:
        simple: ${Endpoint.[0].OS}
      deviceosversion:
        simple: ${Endpoint.[0].OSVersion}
      devicestatus:
        simple: ${Endpoint.[0].Status}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 20,
          "y": 1840
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: a572b7cd-49dc-4565-827a-aa5a5f0fc4d0
    type: condition
    task:
      id: a572b7cd-49dc-4565-827a-aa5a5f0fc4d0
      version: -1
      name: Check if we have more than 1 item
      description: Checks whether specific entries returned an error. Use ${lastCompletedTaskEntries}
        to check the previous task entries. If an array is provided, will return 'yes'
        if one of the entries returned an error.
      scriptName: isError
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "16"
      "yes":
      - "21"
    scriptarguments:
      entryId:
        simple: ${lastCompletedTaskEntries}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 20,
          "y": 1990
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: d85efba8-1bf3-42dc-8705-9f1c433098f8
    type: regular
    task:
      id: d85efba8-1bf3-42dc-8705-9f1c433098f8
      version: -1
      name: Set Endpoint information to layout
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      deviceid:
        complex:
          root: Endpoint
          accessor: ID
          transformers:
          - operator: uniq
      devicelocalip:
        complex:
          root: Endpoint
          accessor: IPAddress
          transformers:
          - operator: uniq
      devicemacaddress:
        complex:
          root: Endpoint
          accessor: MACAddress
          transformers:
          - operator: uniq
      devicename:
        complex:
          root: Endpoint
          accessor: Hostname
          transformers:
          - operator: uniq
      deviceosname:
        complex:
          root: Endpoint
          accessor: OS
          transformers:
          - operator: uniq
      deviceosversion:
        complex:
          root: Endpoint
          accessor: OSVersion
          transformers:
          - operator: uniq
      devicestatus:
        complex:
          root: Endpoint
          accessor: Status
          transformers:
          - operator: uniq
      isolated:
        complex:
          root: Endpoint
          accessor: IsIsolated
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -210,
          "y": 2160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: c675140a-1c38-4552-8e45-5fcbad8d4ec1
    type: regular
    task:
      id: c675140a-1c38-4552-8e45-5fcbad8d4ec1
      version: -1
      name: Set Process Info to Layout
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      filesha1:
        complex:
          root: MicrosoftATP.Alert.Evidence
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: MicrosoftATP.Alert.Evidence.entityType
                iscontext: true
              right:
                value:
                  simple: Process
              ignorecase: true
            - operator: isEqualString
              left:
                value:
                  simple: MicrosoftATP.Alert.Evidence.entityType
                iscontext: true
              right:
                value:
                  simple: File
          accessor: '[0].sha1'
      filesha256:
        complex:
          root: MicrosoftATP.Alert.Evidence
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: MicrosoftATP.Alert.Evidence.entityType
                iscontext: true
              right:
                value:
                  simple: Process
            - operator: isEqualString
              left:
                value:
                  simple: MicrosoftATP.Alert.Evidence.entityType
                iscontext: true
              right:
                value:
                  simple: File
          accessor: '[0].sha256'
      processname:
        complex:
          root: MicrosoftATP.Alert.Evidence
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: MicrosoftATP.Alert.Evidence.entityType
                iscontext: true
              right:
                value:
                  simple: Process
              ignorecase: true
            - operator: isEqualString
              left:
                value:
                  simple: MicrosoftATP.Alert.Evidence.entityType
                iscontext: true
              right:
                value:
                  simple: File
              ignorecase: true
          accessor: '[0].fileName'
      processpath:
        complex:
          root: MicrosoftATP.Alert.Evidence
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: MicrosoftATP.Alert.Evidence.entityType
                iscontext: true
              right:
                value:
                  simple: Process
            - operator: isEqualString
              left:
                value:
                  simple: MicrosoftATP.Alert.Evidence.entityType
                iscontext: true
              right:
                value:
                  simple: File
          accessor: '[0].filePath'
      sha1:
        complex:
          root: MicrosoftATP.Alert.Evidence
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: MicrosoftATP.Alert.Evidence.entityType
                iscontext: true
              right:
                value:
                  simple: Process
            - operator: isEqualString
              left:
                value:
                  simple: MicrosoftATP.Alert.Evidence.entityType
                iscontext: true
              right:
                value:
                  simple: File
          accessor: '[0].sha1'
      sha256:
        complex:
          root: MicrosoftATP.Alert.Evidence
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: MicrosoftATP.Alert.Evidence.entityType
                iscontext: true
              right:
                value:
                  simple: Process
            - operator: isEqualString
              left:
                value:
                  simple: MicrosoftATP.Alert.Evidence.entityType
                iscontext: true
              right:
                value:
                  simple: File
          - - operator: isNotEmpty
              left:
                value:
                  simple: MicrosoftATP.Alert.Evidence.sha256
                iscontext: true
          accessor: '[0].sha256'
      username:
        complex:
          root: MicrosoftATP.Alert.Evidence
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: MicrosoftATP.Alert.Evidence.entityType
                iscontext: true
              right:
                value:
                  simple: Process
              ignorecase: true
            - operator: isEqualString
              left:
                value:
                  simple: MicrosoftATP.Alert.Evidence.entityType
                iscontext: true
              right:
                value:
                  simple: File
          accessor: '[0].accountName'
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": 1840
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: 59d46333-1f8c-4ea5-86bf-edd2276d704b
    type: title
    task:
      id: 59d46333-1f8c-4ea5-86bf-edd2276d704b
      version: -1
      name: Set Alert info to Layout
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "40"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 900,
          "y": 1700
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: b606b61e-2e12-45be-8dae-659a01f87460
    type: title
    task:
      id: b606b61e-2e12-45be-8dae-659a01f87460
      version: -1
      name: Layout Enrichment
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "29"
      - "18"
      - "25"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": 1555
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: 91bdea9c-913d-40bf-8c93-4565fc2b91fd
    type: regular
    task:
      id: 91bdea9c-913d-40bf-8c93-4565fc2b91fd
      version: -1
      name: Hash Enrichment
      description: Retrieves results for a file hash using Palo Alto Networks WildFire.
      script: '|||file'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      file:
        complex:
          root: incident
          accessor: filesha1
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: incident.filesha256
                iscontext: true
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 910,
          "y": 1370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    fieldMapping:
    - incidentfield: SHA256
      output:
        simple: ${File.SHA256}
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: bb2de9ac-524e-4a39-8e12-de908ff425dd
    type: title
    task:
      id: bb2de9ac-524e-4a39-8e12-de908ff425dd
      version: -1
      name: 'Hash '
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "27"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 910,
          "y": 1240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: 6ad17d28-e5a0-4df7-85db-b0119144bf64
    type: title
    task:
      id: 6ad17d28-e5a0-4df7-85db-b0119144bf64
      version: -1
      name: Set Endpoint Details to Layout
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "19"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 20,
          "y": 1700
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: 56fca72d-c355-477c-8a16-2cddc89143a7
    type: playbook
    task:
      id: 56fca72d-c355-477c-8a16-2cddc89143a7
      version: -1
      name: Malware Investigation and Response - Set Alerts Grid
      playbookName: Malware Investigation and Response - Set Alerts Grid
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      AlertName:
        complex:
          root: incident
          accessor: alertname
          transformers:
          - operator: FirstArrayElement
      CommandLine:
        complex:
          root: incident
          accessor: cmdline
          transformers:
          - operator: FirstArrayElement
      FileName:
        complex:
          root: incident
          accessor: processnames
          transformers:
          - operator: FirstArrayElement
      HostName:
        complex:
          root: incident
          accessor: devicename
          transformers:
          - operator: FirstArrayElement
      ParentProcess:
        complex:
          root: incident
          accessor: parentprocess
          transformers:
          - operator: FirstArrayElement
      ProcessID:
        complex:
          root: incident
          accessor: processid
          transformers:
          - operator: FirstArrayElement
      SHA256:
        complex:
          root: incident
          accessor: filesha256
          transformers:
          - operator: FirstArrayElement
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 900,
          "y": 1840
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: true
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "41":
    id: "41"
    taskid: 2299d8c8-29e8-4453-83cd-cf4027253651
    type: condition
    task:
      id: 2299d8c8-29e8-4453-83cd-cf4027253651
      version: -1
      name: Is MDE the alert source?
      description: Is MDE the alert source?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "8"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.DidAlertOriginateFromSIEM
            iscontext: true
          right:
            value:
              simple: "No"
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": 360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "42":
    id: "42"
    taskid: e7a62989-93a1-49d4-8843-64e9f633f646
    type: regular
    task:
      id: e7a62989-93a1-49d4-8843-64e9f633f646
      version: -1
      name: Get full alert details
      description: Retrieves an alert by alert ID. Note - If a specific alert ID is
        not part of the results, it was not found.
      script: '|||microsoft-atp-get-alert-by-id'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "44"
    scriptarguments:
      alert_ids:
        simple: ${inputs.AlertID}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 170,
          "y": 740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    fieldMapping:
    - incidentfield: URLs
      output:
        simple: ${MicrosoftATP.Alert.Evidence.url}
    - incidentfield: Users
      output:
        simple: ${MicrosoftATP.Alert.Evidence.accountName}
    - incidentfield: User SID
      output:
        simple: ${MicrosoftATP.Alert.Evidence.userSid}
    - incidentfield: CMD line
      output:
        simple: ${MicrosoftATP.Alert.Evidence.processCommandLine}
    - incidentfield: Detected IPs
      output:
        simple: ${MicrosoftATP.Alert.Evidence.ipAddress}
    - incidentfield: Domain Name
      output:
        simple: ${MicrosoftATP.Alert.Evidence.domainName}
    - incidentfield: File Names
      output:
        simple: ${MicrosoftATP.Alert.Evidence.fileName}
    - incidentfield: File Paths
      output:
        simple: ${MicrosoftATP.Alert.Evidence.filePath}
    - incidentfield: File SHA1
      output:
        simple: ${MicrosoftATP.Alert.Evidence.sha1}
    - incidentfield: File SHA256
      output:
        simple: ${MicrosoftATP.Alert.Evidence.sha256}
    - incidentfield: Microsoft Defender for Endpoint Evidence Type
      output:
        simple: ${MicrosoftATP.Alert.Evidence.entityType}
    - incidentfield: Parent Process
      output:
        simple: ${MicrosoftATP.Alert.Evidence.parentProcessFileName}
    - incidentfield: Parent Process File Path
      output:
        simple: ${MicrosoftATP.Alert.Evidence.parentProcessFileName}
    - incidentfield: Parent Process ID
      output:
        simple: ${MicrosoftATP.Alert.Evidence.parentProcessId}
    - incidentfield: Process ID
      output:
        simple: ${MicrosoftATP.Alert.Evidence.processId}
    - incidentfield: Registry Key
      output:
        simple: ${MicrosoftATP.Alert.Evidence.registryKey}
    - incidentfield: Registry Value
      output:
        simple: ${MicrosoftATP.Alert.Evidence.registryValue}
    - incidentfield: Registry Value Type
      output:
        simple: ${MicrosoftATP.Alert.Evidence.registryValueType}
    - incidentfield: Investigation Stage
      output:
        simple: ${MicrosoftATP.Alert.InvestigationState}
    - incidentfield: Agents ID
      output:
        simple: ${MicrosoftATP.Alert.MachineID}
    - incidentfield: MITRE Technique ID
      output:
        simple: ${MicrosoftATP.Alert.MitreTechniques}
    - incidentfield: Process CMD
      output:
        simple: ${MicrosoftATP.Alert.Evidence.processCommandLine}
    - incidentfield: Process SHA256
      output:
        simple: ${MicrosoftATP.Alert.Evidence.sha256}
    - incidentfield: External Severity
      output:
        simple: ${MicrosoftATP.Alert.Severity}
    - incidentfield: External End Time
      output:
        simple: ${MicrosoftATP.Alert.LastUpdateTime}
    - incidentfield: External Start Time
      output:
        simple: ${MicrosoftATP.Alert.FirstEventTime}
    - incidentfield: External Status
      output:
        simple: ${MicrosoftATP.Alert.Status}
    - incidentfield: Hostnames
      output:
        simple: ${MicrosoftATP.Alert.ComputerDNSName}
    - incidentfield: External Category Name
      output:
        simple: ${MicrosoftATP.Alert.Category}
    - incidentfield: Description
      output:
        simple: ${MicrosoftATP.Alert.Description}
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "43":
    id: "43"
    taskid: 60175b4a-af25-4044-8033-42b5e69d5dd5
    type: playbook
    task:
      id: 60175b4a-af25-4044-8033-42b5e69d5dd5
      version: -1
      name: Mitre Attack - Extract Technique Information From ID
      playbookName: Mitre Attack - Extract Technique Information From ID
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      TechniqueID:
        simple: ${incident.mitretechniqueid}
    separatecontext: true
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 460,
          "y": 1370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "44":
    id: "44"
    taskid: 8d034285-25f1-4c73-8be7-35cdbad83de0
    type: regular
    task:
      id: 8d034285-25f1-4c73-8be7-35cdbad83de0
      version: -1
      name: Extract Indicators
      description: commands.local.cmd.extract.indicators
      script: Builtin|||extractIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      text:
        simple: ${MicrosoftATP.Alert}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 170,
          "y": 910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
system: true
view: |-
  {
    "linkLabelsPosition": {
      "20_16_no": 0.23
    },
    "paper": {
      "dimensions": {
        "height": 2165,
        "width": 1520,
        "x": -230,
        "y": 230
      }
    }
  }
inputs:
- key: DidAlertOriginateFromSIEM
  value:
    simple: "No"
  required: false
  description: 'Whether the incident is fetched through a SIEM product. '
  playbookInputQuery: null
- key: AlertID
  value:
    simple: ${incident.externalsystemid}
  required: false
  description: The Microsoft Defender For Endpoint alert ID.
  playbookInputQuery: null
outputs:
- contextPath: MITREATTACK
  description: The full MITRE data for the attack pattern.
  type: string
- contextPath: AttackPattern
  description: An array of attack patterns name and IDs.
  type: string
- contextPath: MicrosoftATP.Alert
  description: Microsoft Defender For Endpoint alert information.
  type: unknown
- contextPath: Endpoint
  description: The endpoint information.
  type: unknown
