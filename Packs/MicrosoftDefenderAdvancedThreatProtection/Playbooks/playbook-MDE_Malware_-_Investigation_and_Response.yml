contentitemexportablefields:
  contentitemfields:
    propagationLabels:
    - all
description: |-
  This playbook investigates Microsoft Defender For Endpoint malware alerts. It uses: 
  - Microsoft Defender For Endpoint Advanced Hunting
  - Command Line Analysis
  - Deduplication
  - Sandbox hash search and detonation
  - Proactive investigation actions: AV scan, investigation package collection, running automated investigation on an endpoint
  - Microsoft Defender For Endpoint alert enrichment
  - Incident handling (true/false positive)
id: MDE Malware - Investigation and Response
inputs:
- description: "Possible Options: SNOW or Jira \n*SNOW == ServiceNow"
  key: TicketingSystemToUse
  playbookInputQuery:
  required: false
  value: {}
- description: |-
    Whether file retrieval from the endpoint is allowed.
  key: RetrieveFile
  playbookInputQuery:
  required: false
  value:
    simple: 'True'
- description: |-
    Whether file detonation is allowed on the sandbox.
  key: DetonateFile
  playbookInputQuery:
  required: false
  value:
    simple: 'True'
- description: |-
    "Whether the deduplication playbook will be used."
  key: EnableDeduplication
  playbookInputQuery:
  required: false
  value:
    simple: 'True'
- description: The name of the tag to apply for allowed indicators.
  key: BenignTagName
  playbookInputQuery:
  required: false
  value:
    simple: BenignTagName
- description: |-
    Choose True to automatically run investigation activities (this relies on the `ActionTask` input ).
    Possible values: True/False
  key: RunInvestigationActivities
  playbookInputQuery:
  required: false
  value:
    simple: 'True'
- description: Choose True to run Advance Hunting queries through your Microsoft Defender For Endpoint instance. Note - It may take some time.
  key: AdvancedHunting
  playbookInputQuery:
  required: false
  value:
    simple: 'True'
- description: "Defines how to handle similar incidents. \nPossible values: \"Link\", \"Close\", \"Link and Close\".\nNote: Closing incidents requires defining the \"CloseSimilar\" input as well.\nAlso, incidents found by similar indicators or fields will be closed if their similarity score is above the CloseSimilar value."
  key: DeduphandleSimilar
  playbookInputQuery:
  required: false
  value:
    simple: Link and Close
- description: |-
    Defines the threshold of similarity to close a similar incident. All similar incidents with similarity above this value will be closed.
    For example, if CloseSimilar is set to .8 and an incident has a similarity score of .9, the incident will be closed.
    The value should be between 0 and 1 [0=low similarity , 1=identical].
  key: DedupCloseSimilar
  playbookInputQuery:
  required: false
  value:
    simple: '0.9'
- description: |-
    Whether to use closure steps or close the incident automatically.
        True/False
  key: EnableClosureSteps
  playbookInputQuery:
  required: false
  value:
    simple: 'True'
- description: If using Jira, specify the Jira Project Key (can be retrieved from the Jira console).
  key: TicketProjectName
  playbookInputQuery:
  required: false
  value: {}
- description: |-
    Choose True to autorun collecting the investigation package from an endpoint.
    Possible values: True/False
  key: AutoCollectinvestigationPackege
  playbookInputQuery:
  required: false
  value:
    simple: 'False'
- description: |-
    Option for input ( can be entered as comma-separated values):
    `Full Scan` - Fully Scan the provided endpoint/s
    `Collect Investigation Package` - Collect investigation package from endpoint/s (only for supported devices)
    `Automated Investigation` - Run Automated Investigation on the provided endpoint
    In case it will remain empty, the actions should be checked manually.
  key: ActionTask
  playbookInputQuery:
  required: false
  value: {}
- description: |-
    Choose if you would like to autorun a Full AV Scan on your Endpoint.
    Possible values: True/False
  key: AutoAVScan
  playbookInputQuery:
  required: false
  value:
    simple: 'False'
- description: |-
    Choose if you would like to autorun Automated Investigation on your Endpoint.
    Possible values: True/False
  key: AutoAutomatedInvestigation
  playbookInputQuery:
  required: false
  value:
    simple: 'False'
- description: The tag to assign for indicators to block.
  key: MaliciousTagName
  playbookInputQuery:
  required: false
  value:
    simple: MaliciousTagName
- description: |-
    Indicates if automatic un-isolation is allowed
        True/False
  key: AutoUnisolation
  playbookInputQuery:
  required: false
  value:
    simple: 'False'
- description: In case the alert originated from SIEM no need to run the Incident enrichment flow.
  key: DidAlertOriginateFromSIEM
  playbookInputQuery:
  required: false
  value:
    simple: No
- description: Comma-separated list of incident text fields to take into account when computing similarity. For example commandline, URL
  key: DedupSimilarTextField
  playbookInputQuery:
  required: false
  value:
    simple: agnetsid,users,agentsid,CMDline,Hostnames,filenames,filepaths
- description: |-
    Indicates if endpoint isolation is allowed.
    True/False
  key: AutoIsolation
  playbookInputQuery:
  required: false
  value:
    simple: 'False'
- description: |-
    Retain incidents with a similarity score that's higher than the MinimunIncidentSimilarity.
    Default: 0.2
    Value should be between 0 to 1 [0=low similarity, 1=identical]
  key: DedupMinimunIncidentSimilarity
  playbookInputQuery:
  required: false
  value:
    simple: '0.2'
- description: |-
    The maximum number of incidents to query and set to context data.
    Default is: 200
  key: DedupLimit
  playbookInputQuery:
  required: false
  value:
    simple: '200'
name: MDE Malware - Investigation and Response
outputs: []
starttaskid: '0'
tasks:
  '0':
    id: '0'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '175'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: a379159d-b573-41fb-814d-8b9546bd7260
      iscommand: false
      name: ''
      version: -1
      description: ''
    taskid: a379159d-b573-41fb-814d-8b9546bd7260
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 450,
          "y": -80
        }
      }
  '11':
    id: '11'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '25'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Retrieves information from previously-run reputation commands and aggregates their results
      id: 51fe107f-d717-470a-81f2-4bb98a152c38
      iscommand: false
      name: Parse Findings From Sandbox
      scriptName: MalwareFindingsParse
      type: regular
      version: -1
    taskid: 51fe107f-d717-470a-81f2-4bb98a152c38
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -230,
          "y": 2470
        }
      }
  '16':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: inputs.RetrieveFile
          operator: isEqualString
          right:
            value:
              simple: 'true'
      - - left:
            iscontext: true
            value:
              complex:
                accessor: filePath
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: MicrosoftATP.Alert.Evidence.sha256
                    operator: in
                    right:
                      iscontext: true
                      value:
                        simple: NonFoundHashes
                root: MicrosoftATP.Alert.Evidence
          operator: isNotEmpty
      label: yes
    id: '16'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '25'
      yes:
      - '145'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Is file retrieval allowed?
      id: 65a27388-1f9f-4b7c-803a-78fb3a921b98
      iscommand: false
      name: Is file retrieval allowed?
      type: condition
      version: -1
    taskid: 65a27388-1f9f-4b7c-803a-78fb3a921b98
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -750,
          "y": 1600
        }
      }
  '18':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: NonFoundHashes
                transformers:
                - operator: uniq
          operator: isNotEmpty
          right:
            value: {}
      label: yes
    id: '18'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '70'
      yes:
      - '71'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Are there hashes with no results?
      id: 2d92ea30-3569-437c-8d88-3259b812962f
      iscommand: false
      name: Are there hashes with no results?
      type: condition
      version: -1
    taskid: 2d92ea30-3569-437c-8d88-3259b812962f
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -500,
          "y": 1300
        }
      }
  '23':
    id: '23'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '150'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 2071ebc0-ef0a-4ea8-8c8f-9b15199559c9
      iscommand: false
      name: Sandbox
      type: title
      version: -1
      description: ''
    taskid: 2071ebc0-ef0a-4ea8-8c8f-9b15199559c9
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -500,
          "y": 1030
        }
      }
  '25':
    id: '25'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '43'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 0cf672f8-253e-41f1-8b00-f138fca880b6
      iscommand: false
      name: Sandbox done
      type: title
      version: -1
      description: ''
    taskid: 0cf672f8-253e-41f1-8b00-f138fca880b6
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -750,
          "y": 2660
        }
      }
  '43':
    id: '43'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '180'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: ec81515b-1591-4b6a-8056-0671f2112ff9
      iscommand: false
      name: Done Investigation
      type: title
      version: -1
      description: ''
    taskid: ec81515b-1591-4b6a-8056-0671f2112ff9
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2810
        }
      }
  '44':
    form:
      description: ''
      expired: false
      questions:
      - defaultrows: []
        fieldassociated: ''
        gridcolumns: []
        id: '0'
        label: ''
        labelarg:
          simple: Alert Determination
        options: []
        optionsarg:
        - simple: Uknown
        - simple: TruePositive
        - simple: FalsePositive
        placeholder: ''
        readonly: false
        required: true
        tooltip: ''
        type: singleSelect
      - defaultrows: []
        fieldassociated: ''
        gridcolumns: []
        id: '1'
        label: ''
        labelarg:
          simple: Define the closure reason
        options: []
        optionsarg:
        - simple: Other
        - simple: UnwantedSoftware
        - simple: SecurityTesting
        - simple: SecurityPersonnel
        - simple: Malware
        - simple: Apt
        - simple: NotAvailable
        placeholder: ''
        readonly: false
        required: true
        tooltip: ''
        type: singleSelect
      - defaultrows: []
        fieldassociated: ''
        gridcolumns: []
        id: '2'
        label: ''
        labelarg:
          simple: Please add comment
        options: []
        optionsarg: []
        placeholder: XSOAR related incident ${incident.id}
        readonly: false
        required: false
        tooltip: ''
        type: shortText
      sender: ''
      title: Determine if the alert was False/True Positive
      totalanswers: 0
    id: '44'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    message:
      bcc:
      body:
        simple: Please Classify this MDE Incident ${incident.id}
      cc:
      format: ''
      methods: []
      replyOptions:
      - False Positive
      - True Positive
      subject:
        simple: 'New Microsoft Defender For Endpoint '
      timings:
        completeafterreplies: 1
        completeaftersla: false
        completeafterv2: true
        retriescount: 2
        retriesinterval: 360
      to:
        simple: Analyst
    nexttasks:
      '#none#':
      - '182'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Confirm if true or false positive
      id: c3f14925-0ee6-4c98-8215-046b98ae9aa4
      iscommand: false
      name: Confirm if true or false positive
      type: collection
      version: -1
    taskid: c3f14925-0ee6-4c98-8215-046b98ae9aa4
    timertriggers: []
    type: collection
    view: |-
      {
        "position": {
          "x": -170,
          "y": 3250
        }
      }
  '63':
    id: '63'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '177'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 31152c29-ba40-4bf3-85e3-bb3e7223e2d8
      iscommand: false
      name: Advanced Hunting
      type: title
      version: -1
      description: ''
    taskid: 31152c29-ba40-4bf3-85e3-bb3e7223e2d8
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 990,
          "y": 1030
        }
      }
  '66':
    id: '66'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '67'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 3f862614-b02b-4948-8486-208cbb690a07
      iscommand: false
      name: Deduplication
      type: title
      version: -1
      description: ''
    taskid: 3f862614-b02b-4948-8486-208cbb690a07
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 450,
          "y": 215
        }
      }
  '67':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: inputs.EnableDeduplication
          operator: isEqualString
          right:
            value:
              simple: 'true'
      label: yes
    id: '67'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '68'
      yes:
      - '176'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Use deduplication?
      id: 0733ba5b-d659-459d-8a7f-79b398834824
      iscommand: false
      name: Use deduplication?
      type: condition
      version: -1
    taskid: 0733ba5b-d659-459d-8a7f-79b398834824
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 450,
          "y": 360
        }
      }
  '68':
    id: '68'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '90'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: a101d2da-b3ae-4d7d-86c0-1f3a4fe64014
      iscommand: false
      name: Done Deduplication
      type: title
      version: -1
      description: ''
    taskid: a101d2da-b3ae-4d7d-86c0-1f3a4fe64014
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 450,
          "y": 700
        }
      }
  '70':
    id: '70'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '11'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: bdbe71b0-6b44-476b-8aac-35cd436daf50
      iscommand: false
      name: Known File
      type: title
      version: -1
      description: ''
    taskid: bdbe71b0-6b44-476b-8aac-35cd436daf50
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -230,
          "y": 1480
        }
      }
  '71':
    id: '71'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '16'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: e319cb98-0e47-4bce-83b3-7ed65fd12d76
      iscommand: false
      name: Unknown File
      type: title
      version: -1
      description: ''
    taskid: e319cb98-0e47-4bce-83b3-7ed65fd12d76
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -750,
          "y": 1480
        }
      }
  '81':
    id: '81'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - '178'
    note: false
    quietmode: 0
    scriptarguments:
      DeviceID:
        complex:
          accessor: ID
          root: Endpoint
          transformers:
          - operator: uniq
      DeviceName:
        complex:
          accessor: Hostname
          root: Endpoint
          transformers:
          - operator: uniq
      FileMd5:
        complex:
          accessor: filemd5
          root: incident
          transformers:
          - operator: uniq
      FileName:
        complex:
          accessor: filenames
          root: incident
          transformers:
          - operator: uniq
      FileSha1:
        complex:
          accessor: filesha1
          root: incident
          transformers:
          - operator: uniq
      FileSha256:
        complex:
          accessor: filesha256
          root: incident
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ''
      description: This playbook will use the Microsoft Defender For Endpoint feature - Advanced Hunting. The hunt will be done based on provided inputs.
      id: 6d3c886d-43bf-468d-88d4-f35572caae35
      iscommand: false
      name: ae9483be-d4d5-4c55-89fd-d6dd3fe60e5b
      playbookId: ae9483be-d4d5-4c55-89fd-d6dd3fe60e5b
      type: playbook
      version: -1
    taskid: 6d3c886d-43bf-468d-88d4-f35572caae35
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 770,
          "y": 1340
        }
      }
  '90':
    id: '90'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '23'
      - '63'
      - '167'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 93f3963f-2ead-46b7-8ccb-166c5ced85c0
      iscommand: false
      name: Proceeding with investigation
      type: title
      version: -1
      description: ''
    taskid: 93f3963f-2ead-46b7-8ccb-166c5ced85c0
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 450,
          "y": 860
        }
      }
  '137':
    id: '137'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - '178'
    note: false
    quietmode: 0
    scriptarguments:
      AutoAVScan:
        simple: ${inputs.AutoAVScan}
      AutoAutomatedInvestigation:
        simple: ${inputs.AutoAutomatedInvestigation}
      AutoCollectinvestigationPackege:
        simple: ${inputs.AutoCollectinvestigationPackege}
      EndpointsID:
        simple: ${incident.deviceid}
      Task:
        simple: ${inputs.ActionTask}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ''
      description: |
        This playbook supports investigation actions for the analyst, including:
        - Running a full AV scan for a specific endpoint
        - Requesting an investigation package (a zip file containing forensic data with a size of ~ 15MB) from an endpoint.
        - Requesting to run automatic investigation on an endpoint.
      id: 2ab9dae6-f32f-4e13-8e31-7d46c9bb9528
      iscommand: false
      name: a62b206f-01f5-4e17-8594-e190523e5723
      playbookId: a62b206f-01f5-4e17-8594-e190523e5723
      type: playbook
      version: -1
    taskid: 2ab9dae6-f32f-4e13-8e31-7d46c9bb9528
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1210,
          "y": 1565
        }
      }
  '144':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: inputs.RunInvestigationActivities
          operator: isEqualString
          right:
            value:
              simple: 'true'
      label: yes
    id: '144'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '178'
      yes:
      - '137'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Run Pro-Active Activities?
      id: 11e60609-6665-4046-8e8f-48a88b178863
      iscommand: false
      name: Run Pro-Active Activities?
      type: condition
      version: -1
    taskid: 11e60609-6665-4046-8e8f-48a88b178863
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1210,
          "y": 1340
        }
      }
  '145':
    id: '145'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '148'
    note: false
    quietmode: 0
    scriptarguments:
      format:
        simple: '{1}\{2}'
      list1:
        complex:
          accessor: filePath
          filters:
          - - left:
                iscontext: true
                value:
                  simple: MicrosoftATP.Alert.Evidence.sha256
              operator: in
              right:
                iscontext: true
                value:
                  simple: NonFoundHashes
          root: MicrosoftATP.Alert.Evidence
          transformers:
          - operator: StringToArray
      list2:
        complex:
          accessor: fileName
          filters:
          - - left:
                iscontext: true
                value:
                  simple: MicrosoftATP.Alert.Evidence.sha256
              operator: in
              right:
                iscontext: true
                value:
                  simple: NonFoundHashes
          root: MicrosoftATP.Alert.Evidence
          transformers:
          - operator: StringToArray
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Joins values by index from two lists according to a given format.
      id: 09a0250c-09b5-4bfc-8854-b6acd7b958cf
      iscommand: false
      name: Join File Paths and File Names
      scriptName: ZipStrings
      type: regular
      version: -1
    taskid: 09a0250c-09b5-4bfc-8854-b6acd7b958cf
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -490,
          "y": 1775
        }
      }
  '148':
    id: '148'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      forEach: true
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - '155'
    note: false
    quietmode: 0
    scriptarguments:
      paths:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: zipped_list
              operator: match
              right:
                value:
                  simple: ^[a-zA-Z]:(\\[\w_\d-])*([\\]|[.]*[a-zA-Z0-9_-])*?$
          root: zipped_list
          transformers:
          - args:
              item:
                iscontext: true
                value:
                  simple: incident.filenames
            operator: append
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: This playbook uses the Live Response feature to retrieve a file from an endpoint.
      id: ae0f5a5f-da0f-43a1-8544-c4ac35415d9b
      iscommand: false
      name: 30dc7ee1-0b30-4643-8955-f35cf0a8fe65
      playbookId: 30dc7ee1-0b30-4643-8955-f35cf0a8fe65
      type: playbook
      version: -1
    taskid: ae0f5a5f-da0f-43a1-8544-c4ac35415d9b
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -490,
          "y": 1940
        }
      }
  '149':
    id: '149'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - '11'
    note: false
    quietmode: 0
    scriptarguments:
      File:
        complex:
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: File.Extension
              operator: notContainsString
              right:
                value:
                  simple: gz
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: File.Name
              operator: notContainsString
              right:
                value:
                  simple: Investigation_package_incident
          root: File
    separatecontext: true
    skipunavailable: false
    task:
      brand: ''
      id: 623a8d0f-2f50-43bb-8235-981c808e9f45
      iscommand: false
      name: 470ceb33-1487-47a0-8337-a6c50149f385
      playbookId: 470ceb33-1487-47a0-8337-a6c50149f385
      type: playbook
      version: -1
      description: ''
    taskid: 623a8d0f-2f50-43bb-8235-981c808e9f45
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -490,
          "y": 2290
        }
      }
  '150':
    id: '150'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - '18'
    note: false
    quietmode: 0
    scriptarguments:
      FileSha256:
        complex:
          accessor: SHA256
          root: File
    separatecontext: true
    skipunavailable: false
    task:
      brand: ''
      id: 14998e59-643b-4e40-837e-180417de4662
      iscommand: false
      name: 5d24f937-9988-4647-8247-7415e343b581
      playbookId: 5d24f937-9988-4647-8247-7415e343b581
      type: playbook
      version: -1
      description: ''
    taskid: 14998e59-643b-4e40-837e-180417de4662
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -500,
          "y": 1150
        }
      }
  '155':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: inputs.DetonateFile
          operator: isEqualString
          right:
            value:
              simple: 'true'
      label: yes
    id: '155'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '25'
      yes:
      - '149'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Is Detonate Allowed?
      id: a0f1ad7a-cfe0-4490-8e7a-8aefb1f96655
      iscommand: false
      name: Is Detonate Allowed?
      type: condition
      version: -1
    taskid: a0f1ad7a-cfe0-4490-8e7a-8aefb1f96655
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -490,
          "y": 2110
        }
      }
  '157':
    id: '157'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - '158'
    note: false
    quietmode: 0
    scriptarguments:
      AutoIsolation:
        simple: ${inputs.AutoIsolation}
      BlockTag:
        simple: ${inputs.MaliciousTagName}
      Classification:
        simple: ${Determine if the alert was False/True Positive.Answers.0}
      CloseDuplicate:
        simple: ${inputs.DeduphandleSimilar}
      Comment:
        simple: ${Determine if the alert was False/True Positive.Answers.2}
      DupAlertIDsToBeClosed:
        complex:
          accessor: id
          filters:
          - - left:
                iscontext: true
                value:
                  simple: DBotFindSimilarIncidents.similarIncident.similarity incident
              operator: greaterThanOrEqual
              right:
                iscontext: true
                value:
                  simple: inputs.CloseSimilar
          root: DBotFindSimilarIncidents.similarIncident
      FileSha1:
        simple: ${incident.filesha1}
      FileSha256:
        simple: ${incident.filesha256}
      HostID:
        simple: ${incident.deviceid}
      Reason:
        simple: ${Determine if the alert was False/True Positive.Answers.1}
      TicketDescription:
        simple: ${Determine if the alert was False/True Positive.Answers.2} + Incident classification:${Determine if the alert was False/True Positive.Answers.0}
      TicketProjectName:
        simple: ${inputs.TicketProjectName}
      TicketingSystemToUse:
        simple: ${inputs.TicketingSystemToUse}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ''
      description: This Playbook handles closing a true positive incident for Microsoft Defender for Endpoint.
      id: 4e13212c-f3be-4237-8424-5bdbf04400f7
      iscommand: false
      name: 87353eea-72a8-43b9-8e91-d9ba986ef5da
      playbookId: 87353eea-72a8-43b9-8e91-d9ba986ef5da
      type: playbook
      version: -1
    taskid: 4e13212c-f3be-4237-8424-5bdbf04400f7
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -580,
          "y": 3620
        }
      }
  '158':
    id: '158'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 82b4be54-2dd4-4595-83db-5f9851bfacdc
      iscommand: false
      name: Done
      type: title
      version: -1
      description: ''
    taskid: 82b4be54-2dd4-4595-83db-5f9851bfacdc
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 450,
          "y": 3790
        }
      }
  '167':
    id: '167'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '171'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 8e721eb8-d1de-4596-8769-1b7f91524c80
      iscommand: false
      name: Command Line Analysis
      type: title
      version: -1
      description: ''
    taskid: 8e721eb8-d1de-4596-8769-1b7f91524c80
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1030
        }
      }
  '168':
    id: '168'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - '169'
    note: false
    quietmode: 0
    scriptarguments:
      Commandline:
        complex:
          accessor: cmdline
          root: incident
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ''
      description: "This playbook takes the command line from the alert and performs the following actions:\n
      - Checks for a base64 string and decodes it if exists.\n
      - Extracts and enriches indicators from the command line\n
      - Checks specific arguments for malicious usage. \n\n
      At the end of the playbook, it sets a possible verdict for the command line, based on the finding:\n
      1. Indicators found in the command line\n
      2. Found AMSI techniques\n
      3. Found suspicious parameters\n
      4. Usage of malicious tools\n
      5. Indication of network activity"
      id: 169f0820-d949-4d92-8450-bb24056bba34
      iscommand: false
      name: Command-Line Analysis
      playbookId: Command-Line Analysis
      type: playbook
      version: -1
    taskid: 169f0820-d949-4d92-8450-bb24056bba34
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 210,
          "y": 1360
        }
      }
  '169':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: CommandlineVerdict
          operator: isNotEmpty
      label: yes
    id: '169'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '43'
      yes:
      - '170'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Found any suspicious components?
      id: 152e0a41-7858-453d-81a9-a62bad004af3
      iscommand: false
      name: Found any suspicious components?
      type: condition
      version: -1
    taskid: 152e0a41-7858-453d-81a9-a62bad004af3
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 210,
          "y": 1545
        }
      }
  '170':
    id: '170'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '179'
    note: false
    quietmode: 0
    scriptarguments:
      appendTags:
        simple: 'true'
      tags:
        complex:
          root: CommandlineVerdict
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.set.incident
      id: f47335db-a305-49a0-8b26-bd0ba442c46d
      iscommand: true
      name: Set Tag `Suspicious Command-line`
      script: Builtin|||setIncident
      type: regular
      version: -1
    taskid: f47335db-a305-49a0-8b26-bd0ba442c46d
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -10,
          "y": 1720
        }
      }
  '171':
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: incident.cmdline
                    operator: notInList
                    right:
                      iscontext: true
                      value:
                        simple: incident.processnames
                root: incident.cmdline
          operator: isNotEmpty
          right:
            value: {}
      label: yes
    id: '171'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '43'
      yes:
      - '168'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Is there a CMD line parameter?
      id: 4c9f987d-ce4c-4c6b-811f-9140e86956d0
      iscommand: false
      name: Is there a CMD line parameter?
      type: condition
      version: -1
    taskid: 4c9f987d-ce4c-4c6b-811f-9140e86956d0
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1160
        }
      }
  '174':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: inputs.EnableClosureSteps
          operator: isEqualString
          right:
            value:
              simple: 'True'
      label: yes
    id: '174'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '158'
      yes:
      - '44'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Proceed To Closure Steps?
      id: 78289f9f-ed51-4ee8-8544-32f6e978a8b4
      iscommand: false
      name: Proceed To Closure Steps?
      type: condition
      version: -1
    taskid: 78289f9f-ed51-4ee8-8544-32f6e978a8b4
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 450,
          "y": 3070
        }
      }
  '175':
    id: '175'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - '66'
    note: false
    quietmode: 0
    scriptarguments:
      AlertID:
        simple: ${incident.externalsystemid}
      DidAlertOriginateFromSIEM:
        simple: ${inputs.DidAlertOriginateFromSIEM}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ''
      description: "This playbook enriches Microsoft Defender For Endpoint alerts. The enrichment is done on the involved endpoint and Mitre technique ID information, and sets the 'Malware-Investigation and Response' layout."
      id: ce19533b-03de-4ba3-86c5-2ea64cc60a1c
      iscommand: false
      name: 28a9069d-1412-4262-8823-69010271a021
      playbookId: 28a9069d-1412-4262-8823-69010271a021
      type: playbook
      version: -1
    taskid: ce19533b-03de-4ba3-86c5-2ea64cc60a1c
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 450,
          "y": 60
        }
      }
  '176':
    id: '176'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - '68'
    note: false
    quietmode: 0
    scriptarguments:
      CloseSimilar:
        simple: ${inputs.DedupCloseSimilar}
      closeReason:
        simple: Closed by Dedup Playbook within inc ${incident.id}
      fromDate:
        simple: 1 months ago
      handleSimilar:
        simple: ${inputs.DeduphandleSimilar}
      limit:
        simple: ${inputs.DedupLimit}
      method:
        simple: Fields and Indicators
      minimunIncidentSimilarity:
        simple: ${inputs.DedupMinimunIncidentSimilarity}
      query:
        simple: -status:closed -category:job
      showIncidentSimilarityForAllFields:
        simple: 'True'
      similarTextField:
        simple: ${inputs.DedupSimilarTextField}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ''
      description: "This playbook identifies duplicate incidents using the Cortex XSOAR machine\
      \ learning method (script).\nIn this playbook, you can choose fields and/or indicators\
      \ to be compared against other incidents in the Cortex XSOAR database.\
      \ \n\nNote: To identify similar incidents you must *must* properly define the playbook inputs. "\
      id: 3196eb9a-12e2-4cc8-82bb-ecf6c7d0a221
      iscommand: false
      name: Dedup - Generic v4
      playbookId: Dedup - Generic v4
      type: playbook
      version: -1
    taskid: 3196eb9a-12e2-4cc8-82bb-ecf6c7d0a221
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 700,
          "y": 530
        }
      }
  '177':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: inputs.AdvancedHunting
          operator: isEqualString
          right:
            value:
              simple: 'true'
      label: yes
    id: '177'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '178'
      yes:
      - '81'
      - '144'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: AutoRun Advanced Hunting
      id: a6ac2991-fdac-4ddd-8bfb-e45c967f1f98
      iscommand: false
      name: AutoRun Advanced Hunting
      type: condition
      version: -1
    taskid: a6ac2991-fdac-4ddd-8bfb-e45c967f1f98
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 990,
          "y": 1160
        }
      }
  '178':
    id: '178'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '43'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 2e290a12-81c0-4fb1-81d4-f5372eb93521
      iscommand: false
      name: Done with Advanced Hunting
      type: title
      version: -1
      description: ''
    taskid: 2e290a12-81c0-4fb1-81d4-f5372eb93521
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 990,
          "y": 1735
        }
      }
  '179':
    id: '179'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '43'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 11de75b7-e4b0-4120-8754-655309f6745b
      iscommand: false
      name: 'Done Command Line Analysis '
      type: title
      version: -1
      description: ''
    taskid: 11de75b7-e4b0-4120-8754-655309f6745b
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -10,
          "y": 2650
        }
      }
  '180':
    id: '180'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '174'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 314cc641-0edd-4d15-888e-64d0ded6bf40
      iscommand: false
      name: Proceed to closure steps
      type: title
      version: -1
      description: ''
    taskid: 314cc641-0edd-4d15-888e-64d0ded6bf40
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 450,
          "y": 2940
        }
      }
  '181':
    id: '181'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ''
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - '158'
    note: false
    quietmode: 0
    scriptarguments:
      AllowTag:
        simple: ${inputs.BenignTagName}
      AutoUnisolation:
        simple: ${inputs.AutoUnisolation}
      Classification:
        simple: ${Determine if the alert was False/True Positive.Answers.0}
      CloseDuplicate:
        simple: ${inputs.handleSimilar}
      Comment:
        simple: ${Determine if the alert was False/True Positive.Answers.2}
      DupAlertIDsToBeClosed:
        complex:
          accessor: id
          filters:
          - - left:
                iscontext: true
                value:
                  simple: 'DBotFindSimilarIncidents.similarIncident.similarity incident '
              operator: greaterThanOrEqual
              right:
                iscontext: true
                value:
                  simple: inputs.CloseSimilar
          root: DBotFindSimilarIncidents.similarIncident
      Reason:
        simple: ${Determine if the alert was False/True Positive.Answers.1}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ''
      description: 'This Playbook handles closing a false positive incident for Microsoft Defender for Endpoint. '
      id: bc7ab9d6-627d-46d1-82fc-734d41936c56
      iscommand: false
      name: 00d681fc-f2e1-4144-8bda-f9bff976cbfb
      playbookId: 00d681fc-f2e1-4144-8bda-f9bff976cbfb
      type: playbook
      version: -1
    taskid: bc7ab9d6-627d-46d1-82fc-734d41936c56
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 240,
          "y": 3620
        }
      }
  '182':
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: Determine if the alert was False/True Positive.Answers.0
          operator: containsString
          right:
            value:
              simple: 'true'
      label: True Positive
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              simple: Determine if the alert was False/True Positive.Answers.0
          operator: containsString
          right:
            value:
              simple: 'false'
      label: False Positive
    id: '182'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - '183'
      False Positive:
      - '181'
      True Positive:
      - '157'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: False/True/Manual
      id: a8ea3392-f720-4806-80d8-ff06940f0161
      iscommand: false
      name: False/True/Manual
      type: condition
      version: -1
    taskid: a8ea3392-f720-4806-80d8-ff06940f0161
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -170,
          "y": 3420
        }
      }
  '183':
    id: '183'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '158'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: 'Resolve this incident manually. '
      id: 9571e49e-18dd-40ae-8402-238066a9a4a7
      iscommand: false
      name: Manual Action Required - Resolve Incident
      type: regular
      version: -1
    taskid: 9571e49e-18dd-40ae-8402-238066a9a4a7
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -170,
          "y": 3620
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "169_43_#default#": 0.15,
      "171_43_#default#": 0.12,
      "174_158_#default#": 0.25
    },
    "paper": {
      "dimensions": {
        "height": 3935,
        "width": 2340,
        "x": -750,
        "y": -80
      }
    }
  }
tests:
- No tests (auto formatted)
fromversion: 6.2.0
