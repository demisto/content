commonfields:
  id: MxToolBox
  version: -1
name: MxToolBox
display: MxToolBox
category: Data Enrichment & Threat Intelligence
image: data:image/png;base64,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
description: All of your MX record, DNS, blacklist and SMTP diagnostics in one integrated
  tool
detaileddescription: Query MxToolBox for threat intelligence information as seen [here](https://mxtoolbox.com/User/Api/Lookup.aspx)
configuration:
- display: API Key
  name: apiKey
  defaultvalue: ""
  type: 4
  required: true
- display: Use system proxy settings
  name: useproxy
  defaultvalue: "true"
  type: 8
  required: false
- display: Allow self-signed SSL certificates
  name: insecure
  defaultvalue: "false"
  type: 8
  required: false
script:
  script: |
    var doReq = function(cmd, data, p) {
        var url = 'https://api.mxtoolbox.com/api/v1/lookup/' + cmd + '/' + data;
        if (p) {
            url += '?' + p;
        }
        var result = http(
            url,
            {
                Headers: {'Accept': ['application/json'], 'Authorization': [params.apiKey]},
                Method: 'GET'
            },
            params.insecure,
            params.useproxy
        );

        if (result.StatusCode < 200 || result.StatusCode > 299) {
            throw 'Failed to perform command "' + cmd + '", request status code: ' + result.StatusCode +
                ' body is: ' + result.Body;
        }
        if (result.Body === '') {
            throw 'No content received for command "' + cmd + '", request status code: ' + result.StatusCode;
        }
        var obj;
        try {
            obj = JSON.parse(result.Body);
        } catch (ex) {
            throw 'Error parsing reply - ' + result.Body + ' - ' + ex;
        }
        return {body: result.Body, obj: obj, statusCode: result.StatusCode};
    };

    switch (command) {
        case 'test-module':
            doReq('mx', 'example.com');
            return 'ok';
        case 'mxtoolbox':
            var res = doReq(args.command, args.data, args.additionalParams);
            var ec = {};
            var md = 'MxToolbox command - **' + args.command + '**\n';
            var arrays = ['Passed', 'Failed', 'Errors', 'Warnings', 'Information', 'MultiInformation', 'Transcript'];
            for (var i=0; i<arrays.length; i++) {
                if (res.obj[arrays[i]] && res.obj[arrays[i]].length > 0) {
                    md += tableToMarkdown(arrays[i], res.obj[arrays[i]]) + '\n';
                    ec['MXToolbox.' + arrays[i]] = res.obj[arrays[i]];
                }
                delete res.obj[arrays[i]];
            }
            delete res.obj.RelatedLookups;
            md += tableToMarkdown('Result Data', res.obj);
            ec['MXToolbox.Data'] = res.obj;
            return {Type: entryTypes.note, Contents: res.body, ContentsFormat: formats.json, HumanReadable: md, EntryContext: ec};
        default:
            throw 'Unknown command ' + command + ' requested';
    }
  type: javascript
  commands:
  - name: mxtoolbox
    arguments:
    - name: command
      required: true
      auto: PREDEFINED
      predefined:
      - mx
      - a
      - dns
      - spf
      - txt
      - soa
      - ptr
      - blacklist
      - smtp
      - tcp
      - http
      - https
      - ping
      - trace
      description: The command you want to execute
    - name: data
      required: true
      description: The data to query
    - name: additionalParams
      description: Any additional query parameters you want to add
    outputs:
    - contextPath: MXToolbox.Passed
      description: Successful results
    - contextPath: MXToolbox.Failed
      description: Query failures
    - contextPath: MXToolbox.Errors
      description: Query errors
    - contextPath: MXToolbox.Warnings
      description: Warning for query
    - contextPath: MXToolbox.Information
      description: Additional information regarding the query
    - contextPath: MXToolbox.MultiInformation
      description: Additional multi-information
    - contextPath: MXToolbox.Transcript
      description: Query transcript
    description: Run any supported command on the mxtoolbox API
