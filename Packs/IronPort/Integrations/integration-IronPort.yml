category: Network Security
commonfields:
  id: Cisco Email Security Appliance (IronPort)
  version: -1
configuration:
- defaultvalue: ''
  display: Server URL (e.g. https://192.168.0.1)
  name: server
  required: true
  type: 0
- defaultvalue: ''
  display: Port
  name: port
  required: true
  type: 0
- defaultvalue: ''
  display: Credentials
  name: credentials
  required: true
  type: 9
- defaultvalue: ''
  display: Trust any certificate (not secure)
  name: insecure
  required: false
  type: 8
- defaultvalue: ''
  display: Use system proxy settings
  name: proxy
  required: false
  type: 8
description: Cisco Email Security protects against ransomware, business email compromise,
  spoofing, and phishing
display: Cisco Email Security Appliance (IronPort)
image: data:image/png;base64,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
name: Cisco Email Security Appliance (IronPort)
script:
  commands:
  - arguments:
    - auto: PREDEFINED
      description: Use this attribute to retrieve report(s) for a specified duration.
        Must provide either this or duration argument
      name: time_range
      predefined:
      - 1d
      - 1h
    - auto: PREDEFINED
      description: The type of report to fetch
      name: report_type
      predefined:
      - mail_authentication_summary
      - mail_dlp_outgoing_traffic_summary
      - mail_incoming_malware_threat_file_detail_summary
      - mail_incoming_traffic_summary
      - mail_mailbox_auto_remediation
      - mail_outgoing_traffic_summary
      - mail_security_summary
      - mail_sender_group_summary
      - mail_system_capacity
      - mail_authentication_incoming_domain_ip
      - mail_content_filter_incoming
      - mail_dmarc_incoming_traffic_summary
      - mail_env_sender_rate_limit
      - mail_env_sender_stats
      - mail_fed_content_filter_incoming
      - mail_hvm_msg_filter_stats
      - mail_incoming_hat_connections
      - mail_incoming_malware_threat_file_detail
      - mail_incoming_web_interaction_track_malicious_users
      - mail_incoming_web_interaction_track_urls
      - mail_md_attachment_incoming_file_type
      - mail_md_attachment_outgoing_file_type
      - mail_outgoing_web_interaction_track_malicious_users
      - mail_outgoing_web_interaction_track_urls
      - mail_msg_filter_stats
      - mail_sender_group_detail
      - mail_subject_stats
      - mail_url_category_summary
      - mail_url_domain_summary
      - mail_url_reputation_summary
      - mail_vof_threat_summary
      - mail_vof_threats_by_level
      - mail_vof_threats_by_threat_type
      - mail_vof_threats_by_time_threshold
      - mail_vof_threats_by_type
      - mail_vof_threats_rewritten_url
      - mail_authentication_incoming_domain
      - mail_content_filter_outgoing
      - mail_destination_domain_detail
      - mail_dlp_outgoing_policy_detail
      - mail_incoming_domain_detail
      - mail_incoming_ip_hostname_detail
      - mail_incoming_network_detail
      - mail_sender_domain_detail
      - mail_sender_ip_hostname_detail
      - mail_users_detail
      - mail_virus_type_detail
      required: true
    - defaultValue: '30'
      description: Use this attribute to limit the number of results returned by the
        report. n is the number of results that you want the report to return and
        can assume values from 1 through 1000. Default is 30
      name: max
    - description: Aggregate report(s) for the specified duration. Supported values
        of TZD are Z , +hh:mm , or -hh:mm. Format should be YYYY-MM-DDThh:mmTZD/YYYY-MM-DDThh:mmTZD
      name: duration
    - description: Use this attribute to retrieve reports based on a specified entity
        such as email address, IP address, and so on. You can choose whether to exactly
        match the specified text or look for items starting with the specified text
        (for instance, starts with "ex" will match "example.com").
      name: entity
    - description: Use this attribute to retrieve items starting with the specified
        entity value. This attribute must be used in conjunction with the entity attribute
        and value must be set to true , for example, entity=us&starts_with=true .
      name: starts_with
    description: Retrieve email security appliance statistical reports
    name: ironport-report
  runonce: false
  script: "var host = params.server.replace(/[\\/]+$/, '') + ':'+params.port;\n\n\
    var sendRequest = function(url, method) {\n    var res = http(\n        url,\n\
    \        {\n            Method: method,\n            Headers: {\n            \
    \    Accept: ['application/json'],\n                Host: [host]\n           \
    \ },\n            Username: params.credentials.identifier,\n            Password:\
    \ params.credentials.password\n        },\n        params.insecure,\n        params.proxy\n\
    \    );\n    if (res.StatusCode < 200 || res.StatusCode >= 300) {\n        throw\
    \ 'Request Failed.\\nStatus code: ' + res.StatusCode + '.\\nBody: ' + JSON.stringify(res)\
    \ + '.';\n    }\n    return res;\n};\n\nvar underscoreToCapital = function(string){\n\
    \    var ret_string = '_'+string;\n    return ret_string.replace(/_([a-z])/g,\
    \ function (g) { return ' '+g[1].toUpperCase(); });\n};\n\nvar convertResKeys\
    \ = function(res){\n    var ret = {};\n    var keys = Object.keys(res);\n    keys.forEach(function(key){\n\
    \        ret[underscoreToCamelCase(key)] = res[key];\n    });\n    return ret;\n\
    };\n\nfunction getReport(command, args){\n    delete args.report_type;\n    requestURL\
    \ = host+'/api/v1.0/stats/'+command;\n\n    var time_range = args.time_range;\n\
    \    delete args.time_range;\n    var attributes = encodeToURLQuery(args);\n\n\
    \    if(time_range){\n        attributes += (attributes.length > 0) ? '&'+time_range\
    \ : '?' + time_range;\n    }\n    else if(!args.duration){\n            throw\
    \ 'Time range missing. Must provide either time_range or duration arguments.';\n\
    \    }\n    rawResponse = sendRequest(requestURL + attributes, 'GET');\n    try{\n\
    \        res = JSON.parse(rawResponse.Body).data;\n    }\n    catch (err){\n \
    \       return rawResponse;\n    }\n    context = {};\n    context['IronPort.'+underscoreToCamelCase(command)]\
    \ = convertResKeys(res);\n    return {\n        Type: entryTypes.note,\n     \
    \   Contents: res,\n        ContentsFormat: formats.json,\n        ReadableContentsFormat\
    \ : formats.markdown,\n        EntryContext : context,\n        HumanReadable:\
    \ tableToMarkdown('IronPort Report', res, undefined, undefined, underscoreToCapital)\n\
    \    };\n}\n\nswitch (command) {\n    case 'test-module':\n        res = getReport('mail_authentication_summary',\
    \ {time_range: '1d'});\n        if(!res.Contents){\n            return res;\n\
    \        }\n        return 'ok';\n    default:\n        return getReport(args.report_type,\
    \ args);\n}"
  type: javascript
tests:
- No Tests
toversion: 4.1.9
