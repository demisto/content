commonfields:
  id: FalconHost
  version: -1
name: FalconHost
display: FalconHost (Deprecated)
fromversion: 5.0.0
category: Endpoint
image: data:image/png;base64,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
description: Deprecated. Use the CrowdStrike Falcon integration instead.
detaileddescription: |-
  Please provide the API id and key for the CrowsStrike Falcon Host API.
  API Key Pairs can be requested by emailing support@crowdstrike.com.
configuration:
- display: Server URL (e.g. https://192.168.0.1)
  name: url
  defaultvalue: https://falconapi.crowdstrike.com/
  type: 0
  required: true
- display: API ID
  name: id
  type: 0
  required: true
- display: API Key
  name: key
  type: 4
  required: true
- display: Use system proxy settings
  name: useproxy
  defaultvalue: "true"
  type: 8
  required: false
- display: Trust any certificate (not secure)
  name: insecure
  defaultvalue: "false"
  type: 8
  required: false
script:
  script: >-
    var SERVER_URL = params.url;

    if (SERVER_URL[SERVER_URL.length - 1] !== '/') {
        SERVER_URL += '/';
    }

    //HELPER FUNCTIONS


    function doReq(method, path, query, body) {
        var result = http(
            SERVER_URL + path + encodeToURLQuery(query),
            {
                Headers: {
                    'Content-Type': ['application/json'],
                    'Accept': ['application/json']
                },
                Username: params.id,
                Password: params.key,
                Method: method,
                Body: body ? JSON.stringify(body) : ''
            },
            params.insecure,
            params.useproxy
        );
        if (result.StatusCode < 200 || result.StatusCode > 299) {
            if (result.StatusCode === 404 && result.Body.indexOf('Resource Not Found') > -1) {
                    // Skip this error - it just means query returned no results. Handle as no results.
            } else {
                throw 'Failed to perform request ' + path + ', request status code: ' + result.StatusCode + ', body: ' + result.Body;
            }
        }


        if (result.Body === '') {
            throw 'No content received.';
        } else
        {
            var obj;
            try {
                obj = JSON.parse(result.Body);
            } catch (ex) {
                throw 'Error parsing reply - ' + result.Body + ' - ' + ex;
            }

            if (obj.errors && obj.errors.length > 0) {
                if (dq(obj, 'errors.[0].code') === 404 && dq(obj, 'errors.[0].message').indexOf('Resource Not Found') > -1) {
                    // Skip this error - it just means query returned no results. Handle as no results.
                } else {
                    throw JSON.stringify(obj.errors);
                }
            }
            return {
                body: result.Body,
                obj: obj,
                statusCode: result.StatusCode
            };
        }
    }


    function dateToEpoch(d) {
        return d ? new Date(d).getTime() : null;
    }


    function uploadIOC() {
        args.expiration_days = parseInt(args.expiration_days)
        var res = doReq('POST', 'indicators/entities/iocs/v1', {}, [args]);
        return {
            Type: entryTypes.note,
            Contents: res.body,
            ContentsFormat: formats.json,
            HumanReadable: 'IOC [' + args.value + '] uploaded'
        };
    }



    // add args to a if exists

    function add(a, k, f) {
        if (args[k]) {
            // check if the argument is a number
            if(!isNaN(args[k])){
                args[k] = args[k].toString();
            }
            var parts = argToList(args[k]);
            for (var i=0; i<parts.length; i++) {
                // check if the argument is a number
                if(!isNaN(parts[i])){
                    parts[i] = parts[i].toString();
                }
                parts[i] = parts[i].trim();
            }
            a[k] = f ? f(args[k]) : parts.length > 1 ? parts : parts[0];
        }
    }


    //COMMANDS//


    function getIOC() {
        var res = doReq('GET', 'indicators/entities/iocs/v1', {ids: args.type + ':' + args.value});
        var md = '### Falcon Host custom IOC retrieval\n';
        if (res.obj.resources) {
            for (var i=0; i<res.obj.resources.length; i++) {
                md += objToList(res.obj.resources[i], res.obj.resources[i].value) + '\n';
            }
        } else {
            md += 'No result found';
        }
        return {
            Type: entryTypes.note,
            Contents: res.body,
            ContentsFormat: formats.json,
            HumanReadable: md
        };
    }


    function updateIOC() {
        var a = {};
        add(a, 'policy');
        add(a, 'share_level');
        add(a, 'expiration_days');
        add(a, 'source');
        add(a, 'description');
        var res = doReq('PATCH', 'indicators/entities/iocs/v1', {ids: args.type + ':' + args.value}, a);
        return {
            Type: entryTypes.note,
            Contents: res.body,
            ContentsFormat: formats.json,
            HumanReadable: 'IOC [' + args.value + '] updated'
        };
    }


    function deleteIOC() {
        var a = {};
        var res = doReq('DELETE', 'indicators/entities/iocs/v1', {ids: args.type + ':' + args.value});
        return {
            Type: entryTypes.note,
            Contents: res.body,
            ContentsFormat: formats.json,
            HumanReadable: 'IOC [' + args.value + '] deleted'
        };
    }


    function searchIOCs() {
        var a = {};
        add(a, 'types');
        add(a, 'values');
        add(a, 'policies');
        add(a, 'share_levels');
        add(a, 'sources');
        add(a, 'sort');
        add(a, 'limit');
        add(a, 'offset');
        if (args.from_expiration_date) {
            a['from.expiration_timestamp'] = args.from_expiration_date + 'T00:00:00';
        }
        if (args.to_expiration_date) {
            a['to.expiration_timestamp'] = args.to_expiration_date + 'T23:59:59';
        }
        var res = doReq('GET', 'indicators/queries/iocs/v1', a);
        var md = '## Falcon Host IOC Search\n';
        if (res.obj.resources) {
            var fullRes = doReq('GET', 'indicators/entities/iocs/v1', {ids: res.obj.resources});
            if (fullRes.obj.resources) {
                for (var i=0; i<fullRes.obj.resources.length; i++) {
                    md += objToList(fullRes.obj.resources[i], fullRes.obj.resources[i].value) + '\n';
                }
                res.obj.resources = fullRes.obj.resources;
            } else {
                md += 'No result found';
            }
        } else {
            md += 'No result found';
        }
        return {
            Type: entryTypes.note,
            Contents: res.obj,
            ContentsFormat: formats.json,
            HumanReadable: md
        };
    }


    function deviceSearch() {
        var a = {};
        add(a, 'filter');
        add(a, 'limit');
        add(a, 'offset');
        if (args.query) {
            a.q = args.query;
        }
        var res = doReq('GET', 'devices/queries/devices/v1', a);
        var md = '## Falcon Host Device Search\n';
        var ec = {};
        if (res.obj.resources && res.obj.resources.length > 0) {
            ec.FalconHostDevices = res.obj.resources;
            md += '### Devices\n';
            for (var i=0; i<res.obj.resources.length; i++) {
                md += res.obj.resources[i] + '\n';
            }
        } else {
            md += 'No result found';
        }
        return {
            Type: entryTypes.note,
            Contents: res.obj,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext: ec
        };
    }


    function deviceDetails() {
        var ids = argToList(args.ids);
        var res = doReq('GET', 'devices/entities/devices/v1', {ids: ids});
        var md = '## Falcon Host Device Details\n';
        var found = false;
        var ec = {};
        if (res.obj.resources) {
            var endpoint = []; //add Endpoint in context
            ec = {"FalconHostDetails": res.obj.resources, "Endpoint":  endpoint};
            for (var i=0; i<res.obj.resources.length; i++) {
                var o = res.obj.resources[i];
                var cleanObj = {};
                var keys = Object.keys(o);
                endpoint.push({
                    "HostName": 'FalconHost',
                    "ID": o.device_id,
                    "IPAddress": o.local_ip,
                    "Domain": o.machine_domain,
                    "MACAddress": o.mac_address,
                    "OS": o.platform_name,
                    "OSVersion": o.os_version,
                    "BIOSVersion": o.bios_version,
                });
                for (var j=0; j<keys.length; j++) {
                    if (keys[j] !== 'policies' && keys[j] !== 'meta') {
                        cleanObj[keys[j]] = o[keys[j]];
                    }
                }
                md += objToList(cleanObj, o.hostname) + '\n';
                if (o.policies) {
                    md += '#### Policies\n';
                    md += arrToMd(o.policies) + '\n';
                }
                if (o.meta) {
                    md += objToList(o.meta, 'Meta') + '\n';
                }
                found = true;
            }
            ec["Endpoint"] = endpoint;
        }
        if (!found) {
            md += 'No result found';
        }
        return {
            Type: entryTypes.note,
            Contents: res.obj,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext: ec
        };
    }


    function deviceCountIOC() {
        var res = doReq('GET', 'indicators/aggregates/devices-count/v1', args);
        var md = '## Falcon Host IOC Device Count\n';
        if (res.obj.resources && res.obj.resources.length > 0) {
            md += arrToMd(res.obj.resources);
        } else {
            md += 'No result found';
        }
        return {
            Type: entryTypes.note,
            Contents: res.obj,
            ContentsFormat: formats.json,
            HumanReadable: md
        };
    }


    function deviceRanOn() {
        var res = doReq('GET', 'indicators/queries/devices/v1', args);
        var md = '## Falcon Host IOC Device Ran On\n';
        var ec = {};
        if (res.obj.resources && res.obj.resources.length > 0) {
            ec.FalconHostDevices = res.obj.resources;
            md += '### Devices\n';
            for (var i=0; i<res.obj.resources.length; i++) {
                md += res.obj.resources[i] + '\n';
            }
        } else {
            md += 'No result found';
        }
        return {
            Type: entryTypes.note,
            Contents: res.obj,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext: ec
        };
    }


    function processesRanOn() {
        var res = doReq('GET', 'indicators/queries/processes/v1', args);
        var md = '## Falcon Host IOC Processes Ran On Device\n';
        var ec = {};
        if (res.obj.resources && res.obj.resources.length > 0) {
            ec.FalconHostProcesses = res.obj.resources;
            md += '### Processes\n';
            for (var i=0; i<res.obj.resources.length; i++) {
                md += res.obj.resources[i] + '\n';
            }
        } else {
            md += 'No result found';
        }
        return {
            Type: entryTypes.note,
            Contents: res.obj,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext: ec
        };
    }


    function processDetails() {
        var ids = argToList(args.ids);
        var res = doReq('GET', 'processes/entities/processes/v1', {ids: ids});
        var md = '## Falcon Host Process Details\n';
        if (res.obj.resources && res.obj.resources.length > 0) {
            md += arrToMd(res.obj.resources);
        } else {
            md += 'No result found';
        }
        return {
            Type: entryTypes.note,
            Contents: res.obj,
            ContentsFormat: formats.json,
            HumanReadable: md
        };
    }


    function resolveDetection() {
        var ids = argToList(args.ids);
        doReq('PATCH', 'detects/entities/detects/v2', {}, {ids: ids, status: args.status});
        var res = doReq('POST', 'detects/entities/summaries/GET/v1', {}, {ids: ids});
        var md = '## Falcon Host Detection Details\n';
        var ec = {};
        if (res.obj.resources && res.obj.resources.length > 0) {
            ec = res.obj.resources;
            md += tableToMarkdown('', prettifyDetectionsDetails(res.obj.resources),
                ['First Behavior', 'Device Hostname', 'Max Severity Display Name', 'Technique', 'Filename', 'Commandline', 'Detection ID', 'Device ID', 'Status']);
        } else {
            md += 'No result found';
        }
        return {
            Type: entryTypes.note,
            Contents: res.obj,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext: {
                "CrowdStrikeHost.Detections(val.detection_id == obj.detection_id)": ec
            }
        };
    }


    function detectionSearch() {
        var headers = {};

        if ((!args.query && !args.first_behavior)) {
                return {
                    Type: entryTypes.error,
                    Contents: 'You must specify at least one of the following: query, first_behavior',
                    ContentsFormat: formats.text,
                };
        }
        if (args.query) {
            headers.q = args.query;
        }
        if (args.first_behavior) {
            headers.first_behavior = args.first_behavior;
        }

        var res = doReq('GET', 'detects/queries/detects/v1', headers);
        var ec = [];
        var md = '## Falcon Host List of Detections\n';
        if (res.obj.resources && res.obj.resources.length > 0) {
            //ec.detectionID = res.obj.resources;
            md += '### Detections\n';
            for (var i=0; i<res.obj.resources.length; i++) {
                md += res.obj.resources[i] + '\n';
                ec.push({
                   'detection_id': res.obj.resources[i]
                });
            }
        } else {
            md += 'No result found';
        }
        return {
            Type: entryTypes.note,
            Contents: res.obj,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext: {
                "CrowdStrikeHost.Detections(val.detection_id == obj.detection_id)": ec
            }
        };
    }


    function prettifyDetectionsDetails(detections) {
        var prettyDetections = [];
        for (var i=0; i<detections.length; i++) {
            var detection = detections[i];
            prettyDetections[i] = {
                'First Behavior': detection.first_behavior,
                'Max Severity Display Name': detection.max_severity_displayname,
                'Detection ID': detection.detection_id,
                'Status': detection.status,
                'Device Hostname': detection.device.hostname,
                'Technique': detection.behaviors[0].technique,
                'Filename': detection.behaviors[0].filename,
                'Commandline': detection.behaviors[0].cmdline,
                'Device ID': detection.behaviors[0].device_id,
            };
        }
        return prettyDetections;
    }


    function detectionDetails() {
        var ids = argToList(args.detection_id);
        var res = doReq('POST', 'detects/entities/summaries/GET/v1', {}, {ids: ids});
        var md = '## Falcon Host Detection Details\n';
        var ec = {};
        if (res.obj.resources && res.obj.resources.length > 0) {
            ec = res.obj.resources;
            md += tableToMarkdown('', prettifyDetectionsDetails(res.obj.resources),
                ['First Behavior', 'Device Hostname', 'Max Severity Display Name', 'Technique', 'Filename', 'Commandline', 'Detection ID', 'Device ID', 'Status']);
        } else {
            md += 'No result found';
        }
        return {
            Type: entryTypes.note,
            Contents: res.obj,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext: {
                "CrowdStrikeHost.Detections(val.detection_id == obj.detection_id)": ec
            }
        };
    }


    function threatGraphSummary() {
        var ids = argToList(args.ctg_id);
        var res = doReq('GET', 'threatgraph/combined/control-graphs/summary/v1', {ids: ids});
        var md = '## Falcon Host Threat Graph Summary\n';
        var ec = {};
        if (res.obj.resources && res.obj.resources.length > 0) {
            ec = {"CrowdStrikeHost.ThreatGraphSummary(val.id == obj.id)": res.obj.resources};
            md += tableToMarkdown('', res.obj.resources)
        } else {
            md += 'No result found';
        }
        return {
            Type: entryTypes.note,
            Contents: res.obj,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext: ec
        };
    }


    function threatGraphProcesses() {
        var ids = argToList(args.process_id);
        var res = doReq('GET', 'threatgraph/combined/processes/summary/v1', {ids: ids});
        var md = '## Falcon Host Threat Graph Processess Summary\n';
        var ec = {};
        if (res.obj.resources && res.obj.resources.length > 0) {
            ec = {"CrowdStrikeHost.ThreatGraphProcessess(val.id == obj.id)": res.obj.resources};
            md += tableToMarkdown('', res.obj.resources)
        } else {
            md += 'No result found';
        }
        return {
            Type: entryTypes.note,
            Contents: res.obj,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext: ec
        };
    }

    function threatGraphDetections() {
        var ids = argToList(args.detection_id);
        var res = doReq('GET', 'threatgraph/combined/detections/summary/v1', {ids: ids});
        var md = '## Falcon Host Threat Graph Detections Summary\n';
        var ec = {};
        if (res.obj.resources && res.obj.resources.length > 0) {
            ec = {"CrowdStrikeHost.ThreatGraphDetections":res.obj.resources};
            md += tableToMarkdown('', res.obj.resources)
        } else {
            md += 'No result found';
        }
        return {
            Type: entryTypes.note,
            Contents: res.obj,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext: ec
        };
    }


    switch (command) {
        case 'test-module':
            args = {filter: "platform_name:'Windows'"};
            deviceSearch();
            return true;
        case 'cs-upload-ioc':
            return uploadIOC();
        case 'cs-get-ioc':
            return getIOC();
        case 'cs-update-ioc':
            return updateIOC();
        case 'cs-delete-ioc':
            return deleteIOC();
        case 'cs-search-iocs':
            return searchIOCs();
        case 'cs-device-search':
            return deviceSearch();
        case 'cs-device-details':
            return deviceDetails();
        case 'cs-device-count-ioc':
            return deviceCountIOC();
        case 'cs-device-ran-on':
            return deviceRanOn();
        case 'cs-processes-ran-on':
            return processesRanOn();
        case 'cs-process-details':
            return processDetails();
        case 'cs-resolve-detection':
            return resolveDetection();
        case 'cs-detection-search':
            return detectionSearch();
        case 'cs-detection-details':
            return detectionDetails();
        case 'cs-threatgraph-summary':
            return threatGraphSummary();
        case 'cs-threatgraph-processes':
            return threatGraphProcesses();
        case 'cs-threatgraph-detections':
            return threatGraphDetections();
        default:
            throw 'Unknown command - ' + command;
    }
  type: javascript
  commands:
  - name: cs-upload-ioc
    arguments:
    - name: type
      required: true
      auto: PREDEFINED
      predefined:
      - sha256
      - sha1
      - md5
      - domain
      - ipv4
      - ipv6
      description: The type of the indicator
    - name: value
      required: true
      description: The string representation of the indicator
    - name: policy
      auto: PREDEFINED
      predefined:
      - detect
      - none
      description: "The policy to enact when the value is detected on a host. A value of none is equivalent to turning the indicator off.\t"
      defaultValue: detect
    - name: share_level
      auto: PREDEFINED
      predefined:
      - red
      description: The level at which the indicator will be shared. Only red share level (not shared) is supported, which indicates that the IOC is not shared with other Falcon Host customers.
    - name: expiration_days
      description: 'This represents the days the indicator should be valid for. This only applies to domain, ipv4, and ipv6 types. Default is 30 if not provided. '
    - name: source
      description: The source where this indicator originated. This can be used for tracking where this indicator was defined. Limit 200 characters.
    - name: description
      description: A meaningful description of the indicator. Limit 200 characters.
    description: Uploads one or more indicators for CrowdStrike to monitor
    execution: true
  - name: cs-get-ioc
    arguments:
    - name: type
      required: true
      auto: PREDEFINED
      predefined:
      - sha256
      - sha1
      - md5
      - domain
      - ipv4
      - ipv6
      description: The IOC type to retrieve
    - name: value
      required: true
      description: The IOC value to retrieve
    description: Get the full definition of one or more indicators that you are watching
  - name: cs-update-ioc
    arguments:
    - name: type
      required: true
      auto: PREDEFINED
      predefined:
      - sha256
      - sha1
      - md5
      - domain
      - ipv4
      - ipv6
      description: The IOC type to update
    - name: value
      required: true
      description: The IOC value to update
    - name: policy
      auto: PREDEFINED
      predefined:
      - detect
      - none
      description: The policy to enact when the value is detected on a host. A value of none is equivalent to turning the indicator off.
      defaultValue: detect
    - name: share_level
      auto: PREDEFINED
      predefined:
      - red
      description: The level at which the indicator will be shared. Only red share level (not shared) is supported, which indicates that the IOC is not shared with other Falcon Host customers.
    - name: expiration_days
      description: This represents the days the indicator should be valid for. This only applies to domain, ipv4, and ipv6 types. Default is 30.
    - name: source
      description: The source where this indicator originated. This can be used for tracking where this indicator was defined. Limit 200 characters.
    - name: description
      description: A meaningful description of the indicator. Limit 200 characters.
    description: Updates one or more of the uploaded indicators
    execution: true
  - name: cs-delete-ioc
    arguments:
    - name: type
      required: true
      auto: PREDEFINED
      predefined:
      - sha256
      - sha1
      - md5
      - domain
      - ipv4
      - ipv6
      description: The IOC type to delete
    - name: value
      description: The IOC value to delete
    description: Deletes an indicator that you are monitoring
    execution: true
  - name: cs-search-iocs
    arguments:
    - name: types
      description: A list of indicator types. Separate multiple types by comma. Valid types are sha256, sha1, md5, domain, ipv4, ipv6.
      isArray: true
    - name: values
      description: Comma-separated list of indicator values
      isArray: true
    - name: policies
      description: Comma-separated list of indicator policies
      isArray: true
    - name: share_levels
      description: A list of share levels. Only red is supported.
      isArray: true
    - name: sources
      description: Comma-separated list of IOC sources
      isArray: true
    - name: from_expiration_date
      description: Start of date range to search (YYYY-MM-DD format)
    - name: to_expiration_date
      description: End of date range to search (YYYY-MM-DD format)
    - name: sort
      auto: PREDEFINED
      predefined:
      - type.asc
      - type.desc
      - value.asc
      - value.desc
      - policy.asc
      - policy.desc
      - share_level.asc
      - share_level.desc
      - expiration_timestamp.asc
      - expiration_timestamp.desc
      description: The order of the results. Format is field.asc or field.desc.
    - name: limit
      description: The maximum number of records to return. The minimum is 1 and the maximum is 500. Default is 100.
    - name: offset
      description: The offset to begin the list from. For example, start from the 10th record and return the list. Default is 0.
    description: Returns a list of your uploaded IOCs that match the search criteria
  - name: cs-device-search
    arguments:
    - name: query
      default: true
      description: Search for a value across all fields
    - name: filter
      description: Filter devices using query syntax of "field:value+field:value" where string values are enclosed in single quotes or as arrays in single quotes (['x', 'y']). Numerical fields and dates also support operators like field:>value. For a list of relevant fields, see the CrowdStrike documentation.
    - name: limit
      description: Number of results to return
    - name: offset
      description: The result to start from
    outputs:
    - contextPath: FalconHostDevices
      description: Device IDs found by device search
      type: string
    description: Search for devices in your environment by platform, host name, IP, or various other parameters
  - name: cs-device-details
    arguments:
    - name: ids
      required: true
      default: true
      description: The ID of the process. Allows multiple values separated by comma.
    outputs:
    - contextPath: FalconHostDetails
      description: The ID to retrieve details for. Supports comma-separated list of IDs.
      type: string
    - contextPath: Endpoint.ID
      description: Unique ID of the endpoint in FalconHost
      type: string
    - contextPath: Endpoint.IPAddress
      description: IPAddress of the endpoint
      type: string
    - contextPath: Endpoint.Domain
      description: Domain of the endpoint
      type: string
    - contextPath: Endpoint.MACAddress
      description: MACAddress of the endpoint
      type: string
    - contextPath: Endpoint.OS
      description: OS of the endpoint
      type: string
    - contextPath: Endpoint.OSVersion
      description: OSVersion of the endpoint
      type: string
    - contextPath: Endpoint.BIOSVersion
      description: BIOSVersion of the endpoint
      type: string
    - contextPath: Endpoint.HostName
      description: The host of the endpoint
      type: string
    description: Get details for one or more devices, according to device ID
  - name: cs-device-count-ioc
    arguments:
    - name: type
      required: true
      auto: PREDEFINED
      predefined:
      - sha256
      - sha1
      - md5
      - domain
      description: The type of indicator
    - name: value
      required: true
      default: true
      description: The actual string representation of the indicator
    description: Returns the number of devices on which an IOC ran, according to type and value of an IOC
  - name: cs-device-ran-on
    arguments:
    - name: type
      required: true
      auto: PREDEFINED
      predefined:
      - sha256
      - sha1
      - md5
      - domain
      - ipv4
      - ipv6
      description: The type of indicator from the list of supported indicator types.
    - name: value
      required: true
      description: The actual string representation of the indicator
    outputs:
    - contextPath: FalconHostDevices
      description: Device IDs found by device IOC search
      type: string
    description: Returns a list of device IDs on which an indicator ran
  - name: cs-processes-ran-on
    arguments:
    - name: type
      required: true
      auto: PREDEFINED
      predefined:
      - sha256
      - sha1
      - md5
      - domain
      description: The type of indicator from the list of supported indicator types.
    - name: value
      required: true
      description: The actual string representation of the indicator
    - name: device_id
      required: true
      description: "The device ID you want to check against\t"
    outputs:
    - contextPath: FalconHostProcesses
      description: List of processes of the searched indicators
      type: string
    description: Returns the process ID of the indicator if it ran on given device recently
  - name: cs-process-details
    arguments:
    - name: ids
      required: true
      default: true
      description: The ID of the process. Allows multiple values separated by comma.
    description: Retrieves the details of a process, according to process ID, that is running or that previously ran.
  - name: cs-resolve-detection
    deprecated: true
    arguments:
    - name: ids
      required: true
      default: true
      description: "The IDs of the detections you want to resolve. Falcon Host API v2: detection ids are in the following format: ldt:[first field]:[second field],  for example, ldt:cf54bb61f92e4d3e75bf4f7c11fc8f74:4295536142.\t"
    - name: status
      required: true
      auto: PREDEFINED
      predefined:
      - new
      - in_progress
      - true_positive
      - false_positive
      - ignored
      description: "The status to which you want to transition a detection\t"
    outputs:
    - contextPath: CrowdStrikeHost.Detections.cid
      description: cid of the detection
      type: string
    - contextPath: CrowdStrikeHost.Detections.detection_id
      description: ID of the detection
      type: string
    - contextPath: CrowdStrikeHost.Detections.first_behavior
      description: First behavior of the detection
      type: string
    - contextPath: CrowdStrikeHost.Detections.last_behavior
      description: Last behavior of the detection
      type: string
    - contextPath: CrowdStrikeHost.Detections.max_confidence
      description: Max confidence of the detection
      type: number
    - contextPath: CrowdStrikeHost.Detections.max_severity
      description: Max severity of the detection
      type: number
    - contextPath: CrowdStrikeHost.Detections.max_severity_display_name
      description: Displayname of the max severity
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.alleged_file_type
      description: Alleged filetype of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.behavior_id
      description: ID of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.device_id
      description: ID of the device of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.user_id
      description: ID of the user of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.control_graph_id
      description: ID of the control graph of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.cmdline
      description: Command line of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.confidence
      description: Confidence of the behavior
      type: number
    - contextPath: CrowdStrikeHost.Detections.behaviors.severity
      description: Severity of the behavior
      type: number
    - contextPath: CrowdStrikeHost.Detections.behaviors.filename
      description: Filename of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.ioc_description
      description: IOC description of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.ioc_source
      description: IOC source of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.ioc_type
      description: IOC type of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.ioc_value
      description: IOC value of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.md5
      description: MD5 of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.sha256
      description: SHA256 of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.timestamp
      description: Timestamp of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.parent_details.parent_cmdline
      description: Commandline of the parent of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.parent_details.parent_md5
      description: MD5 of the parent of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.parent_details.parent_sha256
      description: SHA256 of the parent of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.parent_details.parent_control_graph_id
      description: Control graph ID of the parent of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.device.agent_version
      description: Agent version of the device
      type: string
    - contextPath: CrowdStrikeHost.Detections.device.bios_version
      description: Bios version of the device
      type: string
    - contextPath: CrowdStrikeHost.Detections.device.os_version
      description: OS version of the device
      type: string
    - contextPath: CrowdStrikeHost.Detections.device.mac_address
      description: MACAddress of the device
      type: string
    - contextPath: CrowdStrikeHost.Detections.device.local_ip
      description: Local IP of the device
      type: string
    - contextPath: CrowdStrikeHost.Detections.device.external_ip
      description: External IP of the device
      type: string
    - contextPath: CrowdStrikeHost.Detections.device.hostname
      description: Hostname of the device
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.technique
      description: Technique of the behavior
      type: string
    description: Deprecated. Use the cs-falcon-resolve-detection command from the CrowdStrike Falcon integration instead.
    execution: true
  - name: cs-detection-search
    deprecated: true
    arguments:
    - name: query
      description: Free text search filter
    - name: first_behavior
      description: 'First Behavior of the detection. Example: 2017-01-31T22:36:11Z'
    outputs:
    - contextPath: CrowdStrikeHost.Detections.detection_id
      description: IDs of the related detections
      type: string
    description: Deprecated. Use the cs-falcon-search-detection command from the CrowdStrike Falcon integration instead.
  - name: cs-detection-details
    deprecated: true
    arguments:
    - name: detection_id
      required: true
      description: ID of the detections
      isArray: true
    outputs:
    - contextPath: CrowdStrikeHost.Detections.cid
      description: cid of the detection
      type: string
    - contextPath: CrowdStrikeHost.Detections.detection_id
      description: ID of the detection
      type: string
    - contextPath: CrowdStrikeHost.Detections.first_behavior
      description: First behavior of the detection
      type: string
    - contextPath: CrowdStrikeHost.Detections.last_behavior
      description: Last behavior of the detection
      type: string
    - contextPath: CrowdStrikeHost.Detections.max_confidence
      description: Max confidence of the detection
      type: number
    - contextPath: CrowdStrikeHost.Detections.max_severity
      description: Max severity of the detection
      type: number
    - contextPath: CrowdStrikeHost.Detections.max_severity_display_name
      description: Displayname of the max severity
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.alleged_file_type
      description: Alleged filetype of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.behavior_id
      description: ID of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.device_id
      description: ID of the device of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.user_id
      description: ID of the user of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.control_graph_id
      description: ID of the control graph of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.cmdline
      description: Command line of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.confidence
      description: Confidence of the behavior
      type: number
    - contextPath: CrowdStrikeHost.Detections.behaviors.severity
      description: Severity of the behavior
      type: number
    - contextPath: CrowdStrikeHost.Detections.behaviors.filename
      description: Filename of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.ioc_description
      description: IOC description of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.ioc_source
      description: IOC source of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.ioc_type
      description: IOC type of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.ioc_value
      description: IOC value of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.md5
      description: MD5 of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.sha256
      description: SHA256 of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.timestamp
      description: Timestamp of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.parent_details.parent_cmdline
      description: Commandline of the parent of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.parent_details.parent_md5
      description: MD5 of the parent of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.parent_details.parent_sha256
      description: SHA256 of the parent of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.parent_details.parent_control_graph_id
      description: Control graph ID of the parent of the behavior
      type: string
    - contextPath: CrowdStrikeHost.Detections.device.agent_version
      description: Agent version of the device
      type: string
    - contextPath: CrowdStrikeHost.Detections.device.bios_version
      description: Bios version of the device
      type: string
    - contextPath: CrowdStrikeHost.Detections.device.os_version
      description: OS version of the device
      type: string
    - contextPath: CrowdStrikeHost.Detections.device.mac_address
      description: MAC address of the device
      type: string
    - contextPath: CrowdStrikeHost.Detections.device.local_ip
      description: Local IP of the device
      type: string
    - contextPath: CrowdStrikeHost.Detections.device.external_ip
      description: External IP of the device
      type: string
    - contextPath: CrowdStrikeHost.Detections.device.hostname
      description: Hostname of the device
      type: string
    - contextPath: CrowdStrikeHost.Detections.behaviors.technique
      description: Technique of the behavior
      type: string
    description: Deprecated. Use the cs-falcon-search-detection command from the CrowdStrike Falcon integration instead.
  - name: cs-threatgraph-summary
    arguments:
    - name: ctg_id
      required: true
      description: Crowd Strike threat graph ID.
      isArray: true
    outputs:
    - contextPath: CrowdStrikeHost.ThreatGraphSummary.customer_id
      description: Customer ID.
      type: string
    - contextPath: CrowdStrikeHost.ThreatGraphSummary.device_id
      description: Device ID.
      type: string
    - contextPath: CrowdStrikeHost.ThreatGraphSummary.edges
      description: Summary edges.
    - contextPath: CrowdStrikeHost.ThreatGraphSummary.id
      description: Threat graph ID.
      type: string
    - contextPath: CrowdStrikeHost.ThreatGraphSummary.object_id
      description: Object ID.
      type: string
    - contextPath: CrowdStrikeHost.ThreatGraphSummary.properties
      description: Threat graph properties.
    - contextPath: CrowdStrikeHost.ThreatGraphSummary.scope
      description: Threat graph scope.
      type: string
    - contextPath: CrowdStrikeHost.ThreatGraphSummary.timestamp
      description: Timestamp when the threat graph summary was created.
      type: string
    - contextPath: CrowdStrikeHost.ThreatGraphSummary.vertex_type
      description: Threat graph vertex type.
      type: string
    description: Gets the details of a threat graph summary.
  - name: cs-threatgraph-processes
    arguments:
    - name: process_id
      required: true
      description: ID of the threat graph processes.
      isArray: true
    outputs:
    - contextPath: CrowdStrikeHost.ThreatGraphProcesses.customer_id
      description: Customer ID.
      type: string
    - contextPath: CrowdStrikeHost.ThreatGraphProcesses.device_id
      description: Device ID.
      type: string
    - contextPath: CrowdStrikeHost.ThreatGraphProcesses.edges
      description: Threat graph edges.
      type: unknown
    - contextPath: CrowdStrikeHost.ThreatGraphProcesses.id
      description: Process ID.
      type: string
    - contextPath: CrowdStrikeHost.ThreatGraphProcesses.object_id
      description: Object ID.
      type: string
    - contextPath: CrowdStrikeHost.ThreatGraphProcesses.properties
      description: Threat graph properties.
    - contextPath: CrowdStrikeHost.ThreatGraphProcesses.scope
      description: Threat graph scope.
      type: string
    - contextPath: CrowdStrikeHost.ThreatGraphProcesses.timestamp
      description: Timestamp when the threat graph processes were created.
      type: string
    - contextPath: CrowdStrikeHost.ThreatGraphProcesses.vertex_type
      description: Threat graph vertex type.
      type: string
    description: Gets the summary of Threat Graph Processes.
  - name: cs-threatgraph-detections
    arguments:
    - name: detection_id
      required: true
      description: ID of  threat graph detection.
      isArray: true
    outputs:
    - contextPath: CrowdStrikeHost.ThreatGraphDetections.customer_id
      description: Customer ID.
      type: string
    - contextPath: CrowdStrikeHost.ThreatGraphDetections.device_id
      description: Device ID.
      type: string
    - contextPath: CrowdStrikeHost.ThreatGraphDetections.edges
      description: Threat graph edges.
      type: unknown
    - contextPath: CrowdStrikeHost.ThreatGraphDetections.id
      description: Detection ID.
      type: string
    - contextPath: CrowdStrikeHost.ThreatGraphDetections.object_id
      description: Object ID.
    - contextPath: CrowdStrikeHost.ThreatGraphDetections.properties
      description: Threat graph properties.
    - contextPath: CrowdStrikeHost.ThreatGraphDetections.scope
      description: Threat graph scope.
      type: string
    - contextPath: CrowdStrikeHost.ThreatGraphDetections.timestamp
      description: Timestamp when the threat graph detections were created.
      type: string
    - contextPath: CrowdStrikeHost.ThreatGraphDetections.vertex_type
      description: Threat graph vertex type.
      type: string
    description: Gets the child process Threat Graph Detections.
  runonce: false
deprecated: true
tests:
- No tests
