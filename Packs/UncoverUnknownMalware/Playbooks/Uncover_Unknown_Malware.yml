id: Uncover Unknown Malware
version: -1
name: Uncover Unknown Malware
description: |-
  This playbook leverages the case management and TIM aspects of XSOAR to uncover unknown malware.
  The playbook does the following:
  - Gets the SSDeep hash of a known malicious MD5 or SHA256 hash by enriching the hash via VirusTotal, and attempting to retrieve the related file from an endpoint.
  - Creates relationships between otherwise unknown indicators - based on their correspondence to the SSDeep that was deemed similar to the original SSDeep of the malicious hash.
  - Links incidents that had any of the indicators which were found related based on the SSDeep hash similarity.
  - Hunts for the presence of the related indicators across the different organization assets.
  - Enriches the original hash to get the threat actor, malware family and VirusTotal community comments.

  These steps allow the analyst to find new files, incidents and endpoints which could be related to the the original hash that was searched simply based on the similarity of SSDeep hashes.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 6c2383b2-e7e4-455f-8d3b-052960c0983f
    type: start
    task:
      id: 6c2383b2-e7e4-455f-8d3b-052960c0983f
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "38"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 450,
          "y": -840
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: 2c40df7e-9ab1-42f4-8747-23672de011c7
    type: regular
    task:
      id: 2c40df7e-9ab1-42f4-8747-23672de011c7
      version: -1
      name: Search all existing hashes
      description: Searches for all existing hashes in the system, to create an "SSDeep hash pool" which will be used for comparison against the SSDeep obtained for the originally provided hash.
      script: Builtin|||findIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      extend-context:
        simple: AllHashes=
      fromdate:
        complex:
          root: inputs.SearchFromDate
      ignore-outputs:
        simple: "true"
      query:
        simple: type:File
    reputationcalc: 1
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 1320
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 2
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: b2a370f4-4195-4919-88e7-46dc8a98708b
    type: regular
    task:
      id: b2a370f4-4195-4919-88e7-46dc8a98708b
      version: -1
      name: Save SSDeep hashes of all hashes
      description: Saves all of the SSDeep hashes available in XSOAR in a separate context key.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "55"
    scriptarguments:
      key:
        simple: AllSSDeeps.SSDeep
      value:
        complex:
          root: AllHashes.CustomFields.ssdeep
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: AllHashes.CustomFields.ssdeep
                iscontext: true
          - - operator: isNotEqualString
              left:
                value:
                  simple: AllHashes.CustomFields.ssdeep
                iscontext: true
              right:
                value:
                  simple: InputHash
                iscontext: true
          transformers:
          - operator: toLowerCase
          - operator: uniq
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 2360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: 080ae8ed-7a31-4cf4-8ee8-bf9b22f95080
    type: regular
    task:
      id: 080ae8ed-7a31-4cf4-8ee8-bf9b22f95080
      version: -1
      name: Check SSDeep similarity
      description: This script finds similar files that can be related to each other by fuzzy hash (SSDeep).
      scriptName: SSDeepSimilarity
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "12"
    scriptarguments:
      ssdeep_hash:
        complex:
          root: InputHash
          transformers:
          - operator: toLowerCase
          - operator: uniq
      ssdeep_hashes_to_compare:
        complex:
          root: AllSSDeeps.SSDeep
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: AllSSDeeps.SSDeep
                iscontext: true
          transformers:
          - operator: toLowerCase
          - operator: uniq
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 780,
          "y": 2890
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: 690887bb-287a-4a3f-86bd-739f387bb1c6
    type: regular
    task:
      id: 690887bb-287a-4a3f-86bd-739f387bb1c6
      version: -1
      name: Create relationships between input hash and simillar hashes
      description: This automation creates a relationship between indicator objects.
      scriptName: CreateIndicatorRelationship
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "27"
    scriptarguments:
      description:
        simple: Detected while comparing SSDeep hashes.
      entity_a:
        complex:
          root: inputs.fileHash
          transformers:
          - operator: toLowerCase
      entity_a_type:
        simple: File
      entity_b:
        complex:
          root: similarIndicators.CustomFields
          accessor: md5
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: similarIndicators.CustomFields.sha1
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: similarIndicators.CustomFields.sha256
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: similarIndicators.CustomFields.ssdeep
                iscontext: true
          - operator: toLowerCase
      entity_b_type:
        simple: File
      relationship:
        simple: similar-to
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1110,
          "y": 4260
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: 94e85ca1-1c40-4b7f-8f38-fc15619eb9d1
    type: title
    task:
      id: 94e85ca1-1c40-4b7f-8f38-fc15619eb9d1
      version: -1
      name: Create Relationships with Similar Files & Incidents
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "8"
      - "14"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1270,
          "y": 3925
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: 0be61b08-d93a-4236-8be6-f330a3b6b975
    type: regular
    task:
      id: 0be61b08-d93a-4236-8be6-f330a3b6b975
      version: -1
      name: Find incidents with any related hash
      description: Searches Demisto incidents
      scriptName: SearchIncidentsV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      query:
        complex:
          root: similarIndicators.CustomFields
          accessor: md5
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: similarIndicators.CustomFields.sha1
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: similarIndicators.CustomFields.sha256
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: similarIndicators.CustomFields.ssdeep
                iscontext: true
          - operator: toLowerCase
          - operator: uniq
          - operator: join
            args:
              separator:
                value:
                  simple: ' OR '
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1530,
          "y": 4070
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    fieldMapping:
    - incidentfield: Number of Related Incidents
      output:
        complex:
          root: foundIncidents
          accessor: id
          transformers:
          - operator: count
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: 17fdc1d8-098d-431d-8d24-34945b37f1b5
    type: condition
    task:
      id: 17fdc1d8-098d-431d-8d24-34945b37f1b5
      version: -1
      name: Are there any related incidents?
      description: "Checks whether incidents with any related hash were found."
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "27"
      "yes":
      - "11"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: foundIncidents
                accessor: id
                transformers:
                - operator: uniq
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1530,
          "y": 4240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: b9e6336c-471f-40fb-8ac5-0e2a2856f989
    type: regular
    task:
      id: b9e6336c-471f-40fb-8ac5-0e2a2856f989
      version: -1
      name: Link to all related incidents
      description: commands.local.cmd.linkIncidents
      script: Builtin|||linkIncidents
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "15"
    scriptarguments:
      incidentId:
        complex:
          root: incident
          accessor: id
      linkedIncidentIDs:
        complex:
          root: foundIncidents.id
          filters:
          - - operator: isNotEqualString
              left:
                value:
                  simple: foundIncidents.id
                iscontext: true
              right:
                value:
                  simple: incident.id
                iscontext: true
          transformers:
          - operator: uniq
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1900,
          "y": 4410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: 29d880e5-6ea8-4cc7-84a2-13fe9be80125
    type: condition
    task:
      id: 29d880e5-6ea8-4cc7-84a2-13fe9be80125
      version: -1
      name: Were SSDeeps with high similarity found?
      description: Checks whether the SSDeep hashes have a high similarity to the SSDeep hash of the file we're hunting for.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "22"
      High Similarity:
      - "13"
    separatecontext: false
    conditions:
    - label: High Similarity
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: SSDeepSimilarity
                filters:
                - - operator: greaterThanOrEqual
                    left:
                      value:
                        simple: SSDeepSimilarity.compared_hashes.similarityValue
                      iscontext: true
                    right:
                      value:
                        simple: inputs.SimilarityThreshold
                      iscontext: true
                transformers:
                - operator: uniq
            iscontext: true
    view: |-
      {
        "position": {
          "x": 780,
          "y": 3045
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: 6958aff0-19f7-4240-87ce-5f3e68d77ea5
    type: regular
    task:
      id: 6958aff0-19f7-4240-87ce-5f3e68d77ea5
      version: -1
      name: Save Hashes with high SSDeep similarity
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "36"
    scriptarguments:
      key:
        simple: HighSimilarity
      value:
        complex:
          root: SSDeepSimilarity.compared_hashes
          filters:
          - - operator: greaterThanOrEqual
              left:
                value:
                  simple: SSDeepSimilarity.compared_hashes.similarityValue
                iscontext: true
              right:
                value:
                  simple: inputs.SimilarityThreshold
                iscontext: true
          transformers:
          - operator: uniq
    reputationcalc: 1
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1270,
          "y": 3220
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    fieldMapping:
    - incidentfield: Number of similar files
      output:
        complex:
          root: HighSimilarity
          transformers:
          - operator: uniq
          - operator: count
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "14":
    id: "14"
    taskid: 59d03edc-b768-4841-83cb-bd3810f4cd42
    type: regular
    task:
      id: 59d03edc-b768-4841-83cb-bd3810f4cd42
      version: -1
      name: Find relationships of similar hashes to other indicators
      description: This automation outputs the indicator relationships to context according to the provided query, using the entities, entityTypes, and relationships arguments. All arguments will use the AND operator. For example, using the following arguments entities=8.8.8.8 entities_types=Domain will provide only relationships that the 8.8.8.8 indicator has with indicators of type domain.
      scriptName: SearchIndicatorRelationships
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "5"
      - "64"
    scriptarguments:
      entities:
        complex:
          root: similarIndicators.CustomFields
          accessor: md5
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: similarIndicators.CustomFields.sha1
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: similarIndicators.CustomFields.sha256
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: similarIndicators.CustomFields.ssdeep
                iscontext: true
          - operator: uniq
      limit:
        simple: "40"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1020,
          "y": 4070
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "15":
    id: "15"
    taskid: 28f2b2b3-36ee-4208-8608-e736024486e9
    type: regular
    task:
      id: 28f2b2b3-36ee-4208-8608-e736024486e9
      version: -1
      name: Get additional indicators from linked incidents
      description: commands.local.cmd.find.indicators
      script: Builtin|||findIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      extend-context:
        simple: IndicatorsFromLinkedIncidents=
      query:
        complex:
          root: foundIncidents
          accessor: id
          transformers:
          - operator: uniq
          - operator: replaceMatch
            args:
              regex:
                value:
                  simple: (.*)
              replaceWith:
                value:
                  simple: incident.id:$1
          - operator: join
            args:
              separator:
                value:
                  simple: ' OR '
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1900,
          "y": 4600
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 57e1b9e6-2ba6-480d-846d-58c1e9a42b4e
    type: regular
    task:
      id: 57e1b9e6-2ba6-480d-846d-58c1e9a42b4e
      version: -1
      name: Set additional indicators from linked incidents
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "27"
    scriptarguments:
      additionalindicators:
        complex:
          root: IndicatorsFromLinkedIncidents
          accessor: value
          transformers:
          - operator: toLowerCase
          - operator: uniq
          - operator: join
            args:
              separator:
                value:
                  simple: |
                    ,
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1900,
          "y": 4760
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: 154690d3-0284-4bb2-86ab-cdc2b749af70
    type: title
    task:
      id: 154690d3-0284-4bb2-86ab-cdc2b749af70
      version: -1
      name: Search Endpoints for Indicators Related By SSDeep Similarity
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "19"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1530,
          "y": 5580
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: 1e1ce804-d649-474f-8d32-16951fb8ca9f
    type: playbook
    task:
      id: 1e1ce804-d649-474f-8d32-16951fb8ca9f
      version: -1
      name: Search Endpoints By Hash - Generic V2
      description: Hunt using available tools
      playbookName: Search Endpoints By Hash - Generic V2
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "60"
    scriptarguments:
      MD5Hash:
        complex:
          root: similarIndicators.CustomFields
          accessor: md5
          transformers:
          - operator: uniq
      SHA1Hash:
        complex:
          root: similarIndicators.CustomFields
          accessor: sha1
          transformers:
          - operator: uniq
      SHA256Hash:
        complex:
          root: similarIndicators.CustomFields
          accessor: sha256
          transformers:
          - operator: uniq
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 1530,
          "y": 5720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: 8d95179d-8301-4081-8efc-a44c75f609c3
    type: condition
    task:
      id: 8d95179d-8301-4081-8efc-a44c75f609c3
      version: -1
      name: Are there hashes that are missing an SSDeep value?
      description: |-
        Checks whether there are hashes in XSOAR which are missing SSDeep hash values.
        Also checks whether the indicators can be enriched according to the EnrichExistingIndicators playbook input.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "2"
      "yes":
      - "21"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: AllHashes
                filters:
                - - operator: isEmpty
                    left:
                      value:
                        simple: AllHashes.CustomFields.ssdeep
                      iscontext: true
                accessor: value
            iscontext: true
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.EnrichExistingIndicators
            iscontext: true
          right:
            value:
              simple: "True"
    view: |-
      {
        "position": {
          "x": 470,
          "y": 1490
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: 99416d11-0860-4f54-8a73-3cdae230da35
    type: title
    task:
      id: 99416d11-0860-4f54-8a73-3cdae230da35
      version: -1
      name: Enrich File Indicators to Expand SSDeep Pool
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "35"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 790,
          "y": 1690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: 6c35e554-1227-49a5-8fd9-4035c4ca3727
    type: title
    task:
      id: 6c35e554-1227-49a5-8fd9-4035c4ca3727
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 6270
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: b8b8ecb5-db3c-48ae-8611-55c2c3fe8a50
    type: title
    task:
      id: b8b8ecb5-db3c-48ae-8611-55c2c3fe8a50
      version: -1
      name: Malware Family and Threat Actor Enrichment
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "58"
      - "62"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1510,
          "y": 4960
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: fabc2761-ee35-4268-8b2c-7bfff8166615
    type: regular
    task:
      id: fabc2761-ee35-4268-8b2c-7bfff8166615
      version: -1
      name: Get VirusTotal community comments
      description: Retrieves comments for a given resource.
      tags:
      - vt-community-comments
      script: '|||vt-comments-get'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "17"
    scriptarguments:
      resource:
        complex:
          root: inputs.fileHash
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: similarIndicators.CustomFields.md5
                iscontext: true
      resource_type:
        simple: file
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1800,
          "y": 5370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: 8d325307-9434-4d3a-8d07-30df6ed35028
    type: regular
    task:
      id: 8d325307-9434-4d3a-8d07-30df6ed35028
      version: -1
      name: Search for SSDeep of the hash in VirusTotal
      description: Checks the file reputation of the specified hash.
      script: VirusTotal (API v3)|||file
      type: regular
      iscommand: true
      brand: VirusTotal (API v3)
    nexttasks:
      '#none#':
      - "49"
    scriptarguments:
      extend-context:
        simple: sourceHash=
      file:
        complex:
          root: inputs.fileHash
      ignore-outputs:
        simple: "true"
    reputationcalc: 2
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 250,
          "y": 70
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    fieldMapping:
    - incidentfield: File MD5
      output:
        simple: ${sourceHash.data.attributes.md5}
    - incidentfield: File SHA1
      output:
        simple: ${sourceHash.data.attributes.sha1}
    - incidentfield: File SHA256
      output:
        simple: ${sourceHash.data.attributes.sha256}
    - incidentfield: SSDeep
      output:
        simple: ${sourceHash.data.attributes.ssdeep}
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: 72d37543-e8bf-4009-8539-1dddc0f3eac7
    type: regular
    task:
      id: 72d37543-e8bf-4009-8539-1dddc0f3eac7
      version: -1
      name: Get MD5/SHA1/SHA256 for high similarity SSDeeps
      description: commands.local.cmd.find.indicators
      script: Builtin|||findIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "65"
    scriptarguments:
      extend-context:
        simple: similarIndicators=
      ignore-outputs:
        simple: "true"
      query:
        complex:
          root: HighSimilarity
          accessor: hash
          transformers:
          - operator: toLowerCase
          - operator: uniq
          - operator: concat
            args:
              prefix:
                value:
                  simple: '"'
              suffix:
                value:
                  simple: '"'
          - operator: join
            args:
              separator:
                value:
                  simple: ' OR '
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1270,
          "y": 3570
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: 9cd805c8-f230-421a-8596-5d409a104bfa
    type: regular
    task:
      id: 9cd805c8-f230-421a-8596-5d409a104bfa
      version: -1
      name: Enrich files that are missing SSDeep hashes
      description: Enriches existing indicators in order to increase the available SSDeep hashes to compare against.
      script: Builtin|||enrichIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "53"
    scriptarguments:
      indicatorsValues:
        complex:
          root: AllHashes
          filters:
          - - operator: isEmpty
              left:
                value:
                  simple: AllHashes.CustomFields.ssdeep
                iscontext: true
          - - operator: isNotEmpty
              left:
                value:
                  simple: AllHashes.CustomFields.md5
                iscontext: true
          accessor: value
          transformers:
          - operator: append
            args:
              item:
                value:
                  simple: AllHashes.CustomFields.sha1
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: AllHashes.CustomFields.sha1
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: AdditionalHashesToEnrich.CustomFields.md5
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: AdditionalHashesToEnrich.CustomFields.sha1
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: AdditionalHashesToEnrich.CustomFields.sha256
                iscontext: true
          - operator: append
            args:
              item:
                value:
                  simple: AdditionalHashesToEnrich.value
                iscontext: true
          - operator: uniq
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 790,
          "y": 1820
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: abe5a203-011d-47f1-81ef-feb6739569c5
    type: regular
    task:
      id: abe5a203-011d-47f1-81ef-feb6739569c5
      version: -1
      name: Display SSDeep similarity grid
      description: Creates a Grid table from items or key-value pairs.
      scriptName: SetGridField
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      columns:
        simple: Similarity Score,File SSDeep
      context_path:
        simple: HighSimilarity
      grid_id:
        simple: similarfilehashesbasedonssdeep
      keys:
        simple: similarityValue,hash
      sort_by:
        simple: Similarity Score
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1270,
          "y": 3390
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: 232f83d7-2d40-4ab6-80fd-af0990a65017
    type: regular
    task:
      id: 232f83d7-2d40-4ab6-80fd-af0990a65017
      version: -1
      name: Save SSDeep of the file hash
      description: Saves the SSDeep found in the XSOAR / VirusTotal search to a context key. This is used for normalization, so regardless of where the SSDeep hash was obtained from, it will be saved in the same key.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "39"
    scriptarguments:
      key:
        simple: InputHash
      value:
        complex:
          root: sourceHash.data.attributes
          accessor: ssdeep
          transformers:
          - operator: toLowerCase
          - operator: uniq
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: foundssdeep
                iscontext: true
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: File.SSDeep
                iscontext: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 990
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: 1f06d07c-2d9d-49ff-87a4-a94f10b0a41e
    type: title
    task:
      id: 1f06d07c-2d9d-49ff-87a4-a94f10b0a41e
      version: -1
      name: Set Source SSDeep Indicator
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "50"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 450,
          "y": -700
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: db205757-da3d-46ca-8785-6a0a02e67644
    type: title
    task:
      id: db205757-da3d-46ca-8785-6a0a02e67644
      version: -1
      name: Creating an SSDeep Pool
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "1"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 470,
          "y": 1175
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: a0fd8f4d-0291-43cf-8d89-e16a6f161fd9
    type: title
    task:
      id: a0fd8f4d-0291-43cf-8d89-e16a6f161fd9
      version: -1
      name: Search Similar Files Based on SSDeeps
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "4"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 780,
          "y": 2745
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "47":
    id: "47"
    taskid: 73630e11-6d4f-4c65-8be1-b7cc65ee6b85
    type: regular
    task:
      id: 73630e11-6d4f-4c65-8be1-b7cc65ee6b85
      version: -1
      name: Display relationship of similar hashes in layout
      description: Creates a Grid table from items or key-value pairs.
      scriptName: SetGridField
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "27"
    scriptarguments:
      columns:
        simple: Relationship Type,Relationship Target
      context_path:
        simple: Relationships
      grid_id:
        simple: filerelationships
      keys:
        simple: Relationship,EntityB
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 710,
          "y": 4450
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "48":
    id: "48"
    taskid: e06faf2d-b138-4114-8869-62055fa8c056
    type: regular
    task:
      id: e06faf2d-b138-4114-8869-62055fa8c056
      version: -1
      name: Display related endpoints
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "22"
    scriptarguments:
      relatedendpoints:
        complex:
          root: Endpoint
          accessor: Hostname
          transformers:
          - operator: uniq
          - operator: join
            args:
              separator:
                value:
                  simple: ', '
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1530,
          "y": 6060
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "49":
    id: "49"
    taskid: 2017dc07-ac8a-4608-8f72-2c7bfd08c1f9
    type: condition
    task:
      id: 2017dc07-ac8a-4608-8f72-2c7bfd08c1f9
      version: -1
      name: Was an SSDeep hash found?
      description: Checks whether an SSDeep hash was found in VirusTotal for the input hash provided by the user.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "52"
      "yes":
      - "37"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: sourceHash.data.attributes.ssdeep
            iscontext: true
    view: |-
      {
        "position": {
          "x": 250,
          "y": 250
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "50":
    id: "50"
    taskid: c85e790b-8932-4173-8a34-140c86a02958
    type: regular
    task:
      id: c85e790b-8932-4173-8a34-140c86a02958
      version: -1
      name: Search XSOAR for SSDeep hash of the provided hash
      description: commands.local.cmd.find.indicators
      script: Builtin|||findIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "51"
    scriptarguments:
      extend-context:
        simple: foundssdeep=CustomFields.ssdeep.[0]::foundmd5=CustomFields.md5::foundsha1=CustomFields.sha1::foundsha256=CustomFields.sha256
      ignore-outputs:
        simple: "true"
      value:
        complex:
          root: inputs.fileHash
    reputationcalc: 1
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 450,
          "y": -560
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    fieldMapping:
    - incidentfield: File MD5
      output:
        simple: ${foundmd5}
    - incidentfield: File SHA256
      output:
        simple: ${foundsha256}
    - incidentfield: SSDeep
      output:
        simple: ${foundssdeep}
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "51":
    id: "51"
    taskid: 720fbf19-fa7f-478f-8598-acf6419c1760
    type: condition
    task:
      id: 720fbf19-fa7f-478f-8598-acf6419c1760
      version: -1
      name: Was an SSDeep hash found in XSOAR?
      description: Checks whether an SSDeep hash that corresponds to the input hash exists already in XSOAR. This is based on the local indicator search done to try and save VirusTotal quota.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "61"
      "yes":
      - "37"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: foundssdeep
            iscontext: true
    view: |-
      {
        "position": {
          "x": 310,
          "y": -370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "52":
    id: "52"
    taskid: eb72aec6-793b-4746-831a-db7725416310
    type: title
    task:
      id: eb72aec6-793b-4746-831a-db7725416310
      version: -1
      name: Attempt File Retrieval to Obtain SSDeep
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "56"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -110,
          "y": 440
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "53":
    id: "53"
    taskid: d12a4917-dc6a-40db-8029-e4756a205d44
    type: regular
    task:
      id: d12a4917-dc6a-40db-8029-e4756a205d44
      version: -1
      name: Remove previously searched hashes
      description: Deletes the context of the previously searched hashes because it may negatively impact performance, since the search can provide a huge number of results.
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "54"
    scriptarguments:
      all:
        simple: "no"
      key:
        simple: AllHashes
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 790,
          "y": 1990
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "54":
    id: "54"
    taskid: 46d27498-819f-4742-894c-c275f43025b0
    type: regular
    task:
      id: 46d27498-819f-4742-894c-c275f43025b0
      version: -1
      name: Get available SSDeep hashes after enrichment
      description: Searches for all file indicators that have an SSDeep hash.
      script: Builtin|||findIndicators
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "2"
    scriptarguments:
      extend-context:
        simple: AllHashes=
      fromdate:
        complex:
          root: inputs.SearchFromDate
      ignore-outputs:
        simple: "true"
      query:
        simple: type:File ssdeep:*
    reputationcalc: 1
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 790,
          "y": 2150
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 2
    isoversize: false
    isautoswitchedtoquietmode: false
  "55":
    id: "55"
    taskid: 9004cb2b-861c-483e-8fa7-7aa370731156
    type: condition
    task:
      id: 9004cb2b-861c-483e-8fa7-7aa370731156
      version: -1
      name: Is there an SSDeep pool to compare against?
      description: "Checks whether SSDeep hashes were gathered for potentially similar files, to compare against the original hash's respective SSDeep."
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "22"
      "yes":
      - "40"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: AllSSDeeps.SSDeep
            iscontext: true
    view: |-
      {
        "position": {
          "x": 470,
          "y": 2540
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "56":
    id: "56"
    taskid: 09c3255c-26bb-44e6-84d2-4299d6df0ded
    type: playbook
    task:
      id: 09c3255c-26bb-44e6-84d2-4299d6df0ded
      version: -1
      name: Retrieve File from Endpoint - Generic V3
      description: |-
        'This playbook retrieves a file sample from an endpoint using the following playbooks:'
        - Get File Sample From Path - Generic v2.
        - Get File Sample By Hash - Generic v3.
      playbookName: Retrieve File from Endpoint - Generic V3
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "57"
    scriptarguments:
      MD5:
        complex:
          root: inputs.fileHash
          filters:
          - - operator: hasLength
              left:
                value:
                  simple: inputs.fileHash
                iscontext: true
              right:
                value:
                  simple: "32"
      SHA256:
        complex:
          root: inputs.fileHash
          filters:
          - - operator: hasLength
              left:
                value:
                  simple: inputs.fileHash
                iscontext: true
              right:
                value:
                  simple: "64"
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": -110,
          "y": 570
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "57":
    id: "57"
    taskid: 3fdae635-0fa7-423b-80e8-e4f470953619
    type: condition
    task:
      id: 3fdae635-0fa7-423b-80e8-e4f470953619
      version: -1
      name: Was a file retrieved?
      description: |-
        Checks whether a file which has an MD5/SHA256 hash of the input hash we are hunting for, was retrieved.
        If a file was retrieved then we should have an SSDeep hash that we can compare against other SSDeep hashes.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "22"
      "yes":
      - "37"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: File
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: File.MD5
                      iscontext: true
                    right:
                      value:
                        simple: inputs.fileHash
                      iscontext: true
                  - operator: isEqualString
                    left:
                      value:
                        simple: File.SHA256
                      iscontext: true
                    right:
                      value:
                        simple: inputs.fileHash
                      iscontext: true
                accessor: SSDeep
            iscontext: true
    view: |-
      {
        "position": {
          "x": -110,
          "y": 720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "58":
    id: "58"
    taskid: 94bb0391-91b8-4ed7-8801-42c65b3e8d94
    type: condition
    task:
      id: 94bb0391-91b8-4ed7-8801-42c65b3e8d94
      version: -1
      name: Is VirusTotal (API v3) enabled?
      description: Returns 'yes' if integration brand is available. Otherwise returns 'no'
      scriptName: IsIntegrationAvailable
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "17"
      "yes":
      - "29"
    scriptarguments:
      brandname:
        simple: VirusTotal (API v3)
    results:
    - brandInstances
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1800,
          "y": 5120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "60":
    id: "60"
    taskid: 05d11ed9-e0e7-4c80-85f5-02f944546fb7
    type: condition
    task:
      id: 05d11ed9-e0e7-4c80-85f5-02f944546fb7
      version: -1
      name: Were related endpoints found?
      description: Checks whether endpoints were found for the related hashes.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "22"
      "yes":
      - "48"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: Endpoint
                accessor: Hostname
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1530,
          "y": 5870
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "61":
    id: "61"
    taskid: 96f63971-5fc9-435c-833f-dd0bc457c894
    type: condition
    task:
      id: 96f63971-5fc9-435c-833f-dd0bc457c894
      version: -1
      name: Is VirusTotal (API v3) enabled?
      description: Returns 'yes' if integration brand is available. Otherwise returns 'no'
      scriptName: IsIntegrationAvailable
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "52"
      "yes":
      - "30"
    scriptarguments:
      brandname:
        simple: VirusTotal (API v3)
    results:
    - brandInstances
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 20,
          "y": -190
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "62":
    id: "62"
    taskid: 7925e282-7b8e-4d5d-8671-6261f9bacf1d
    type: playbook
    task:
      id: 7925e282-7b8e-4d5d-8671-6261f9bacf1d
      version: -1
      name: Intezer - Analyze by hash
      description: Analyze the given file hash on Intezer Analyze and enrich the file reputation. Supports SHA256, SHA1, and MD5.
      playbookName: Intezer - Analyze by hash
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "63"
    scriptarguments:
      Interval:
        simple: "1"
      Timeout:
        simple: "10"
      hash:
        complex:
          root: inputs.fileHash
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 0
    view: |-
      {
        "position": {
          "x": 1280,
          "y": 5120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "63":
    id: "63"
    taskid: 24dcd8a4-c41e-440f-88bf-0afe153d80e8
    type: regular
    task:
      id: 24dcd8a4-c41e-440f-88bf-0afe153d80e8
      version: -1
      name: Save analysis results in layout
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "17"
    scriptarguments:
      analysisreport:
        complex:
          root: File
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: File.MD5
                iscontext: true
              right:
                value:
                  simple: inputs.fileHash
                iscontext: true
            - operator: isEqualString
              left:
                value:
                  simple: File.SHA256
                iscontext: true
              right:
                value:
                  simple: inputs.fileHash
                iscontext: true
          accessor: Metadata.analysis_url
          transformers:
          - operator: uniq
      malwarefamily:
        complex:
          root: File
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: File.MD5
                iscontext: true
              right:
                value:
                  simple: inputs.fileHash
                iscontext: true
            - operator: isEqualString
              left:
                value:
                  simple: File.SHA256
                iscontext: true
              right:
                value:
                  simple: inputs.fileHash
                iscontext: true
          accessor: Metadata.family_name
      verdict:
        complex:
          root: File
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: File.MD5
                iscontext: true
              right:
                value:
                  simple: inputs.fileHash
                iscontext: true
            - operator: isEqualString
              left:
                value:
                  simple: File.SHA256
                iscontext: true
              right:
                value:
                  simple: inputs.fileHash
                iscontext: true
          accessor: Metadata.verdict
          transformers:
          - operator: uniq
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1280,
          "y": 5370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "64":
    id: "64"
    taskid: dd3c09ce-95a4-4438-8472-1fe4b0fdb379
    type: condition
    task:
      id: dd3c09ce-95a4-4438-8472-1fe4b0fdb379
      version: -1
      name: Were relationships found?
      description: Checks whether relationships of similar hashes with any indicator were found.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "27"
      "yes":
      - "47"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: Relationships
            iscontext: true
    view: |-
      {
        "position": {
          "x": 720,
          "y": 4260
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "65":
    id: "65"
    taskid: a7964549-fa52-44fa-8ee6-c6bf5fb3a836
    type: condition
    task:
      id: a7964549-fa52-44fa-8ee6-c6bf5fb3a836
      version: -1
      name: Were other hash types found for similar SSDeep hashes?
      description: Checks whether MD5, SHA1 or SHA256 hashes were found for the SSDeep hashes that were found similar to the original hash that is being hunted, by its SSDeep value.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "66"
      "yes":
      - "6"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: similarIndicators
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1270,
          "y": 3740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "66":
    id: "66"
    taskid: 1b1a7a66-ebdd-49eb-8a6c-181bb7da818b
    type: title
    task:
      id: 1b1a7a66-ebdd-49eb-8a6c-181bb7da818b
      version: -1
      name: No hashes for the similar SSDeeps found
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "27"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2850,
          "y": 4160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "12_13_High Similarity": 0.32,
      "12_22_#default#": 0.1,
      "20_2_#default#": 0.21,
      "49_37_yes": 0.2,
      "49_52_#default#": 0.31,
      "51_37_yes": 0.16,
      "55_22_#default#": 0.11,
      "55_40_yes": 0.57,
      "57_22_#default#": 0.1,
      "57_37_yes": 0.15,
      "58_17_#default#": 0.21,
      "58_29_yes": 0.26,
      "60_22_#default#": 0.2,
      "60_48_yes": 0.46,
      "61_30_yes": 0.23,
      "61_52_#default#": 0.28,
      "64_27_#default#": 0.33,
      "65_66_#default#": 0.25,
      "65_6_yes": 0.46,
      "9_11_yes": 0.37,
      "9_27_#default#": 0.18
    },
    "paper": {
      "dimensions": {
        "height": 7175,
        "width": 3340,
        "x": -110,
        "y": -840
      }
    }
  }
inputs:
- key: fileHash
  value:
    complex:
      root: incident
      accessor: filehash
  required: true
  description: The file hash to hunt for. Supported hash types are MD5 and SHA256.
  playbookInputQuery:
- key: SimilarityThreshold
  value:
    simple: "50"
  required: true
  description: |-
    SSDeep hashes with a similarity value equal to or greater than the value specified, will be considered as similar hashes.
    The SSDeep hashes are given a similarity value between 0 and 100. The similarity is calculated based on the linux "ssdeep" command which is based on the SpamSum program. It basically calculates how many character edits are needed to reach from one hash to the other hash. More information can be found in:
    https://www.samba.org/ftp/unpacked/junkcode/spamsum/README
  playbookInputQuery:
- key: SearchFromDate
  value:
    simple: 2020-01-01T00:00:00
  required: false
  description: |-
    When looking for existing hashes in the system, this is the date that it will look for hashes from.
    The value should be in YYYY-MM-DDTHH:MM:SS.
    For example: 2022-02-15T08:31:00
  playbookInputQuery:
- key: EnrichExistingIndicators
  value:
    simple: "False"
  required: false
  description: 'Whether indicators found in XSOAR will be enriched using the enrichIndicators command. Note: this may use up quota in your threat intelligence products. This is used to increase the SSDeep pool size to improve the coverage when comparing the input hash against other SSDeeps in the system.'
  playbookInputQuery:
outputs: []
tests:
- No tests (auto formatted)
fromversion: 6.5.0
