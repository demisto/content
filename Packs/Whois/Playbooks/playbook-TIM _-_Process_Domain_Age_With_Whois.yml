id: TIM - Process Domain Age With Whois
version: -1
fromversion: 5.5.0
name: TIM - Process Domain Age With Whois
description: This playbook compares the domain creation time against the a provided
  time value such as one month ago. The period can be configured within the playbook
  inputs MinimumAgeOfDomainMonths or MinimumAgeOfDomainHours. The playbook calculates
  the timestamp for the relevant period and compares it to the domain creation time
  value provided by Whois. The resulted domains will be outputted accordingly if they
  were created before or after the compared time.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 8e34007e-8fd0-4aba-84ce-07af557a2ed5
    type: start
    task:
      id: 8e34007e-8fd0-4aba-84ce-07af557a2ed5
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "23"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 820,
          "y": -950
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "5":
    id: "5"
    taskid: 1e1b1291-8c18-46bd-8bfc-d5a9354ea7e9
    type: title
    task:
      id: 1e1b1291-8c18-46bd-8bfc-d5a9354ea7e9
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 820,
          "y": 1160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "7":
    id: "7"
    taskid: 536a3af9-9ba6-49e0-8bcb-c9b98a2da013
    type: regular
    task:
      id: 536a3af9-9ba6-49e0-8bcb-c9b98a2da013
      version: -1
      name: Calculate timestamp to compare
      description: |
        Retrieves the current date and time.
      scriptName: GetTime
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "24"
    scriptarguments:
      contextKey: {}
      date: {}
      dateFormat:
        simple: Date
      hoursAgo: {}
      minutesAgo: {}
      monthsAgo:
        simple: ${inputs.MinimumAgeMonthValue}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 230,
          "y": -225
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "23":
    id: "23"
    taskid: 66794d3b-7ab4-4cfc-82be-e9d30729378e
    type: condition
    task:
      id: 66794d3b-7ab4-4cfc-82be-e9d30729378e
      version: -1
      name: Was a domain value provided?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "5"
      "yes":
      - "28"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: inputs.WhoisResults
            iscontext: true
    view: |-
      {
        "position": {
          "x": 820,
          "y": -830
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "24":
    id: "24"
    taskid: 8b92fa70-0b29-410a-890c-4b7271198fb5
    type: regular
    task:
      id: 8b92fa70-0b29-410a-890c-4b7271198fb5
      version: -1
      name: Compare domain creation time to input
      description: Compare a single timestamp to a list of timestamps;
      scriptName: TimeStampCompare
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "32"
      - "33"
      - "34"
    scriptarguments:
      tested_time:
        simple: ${TimeNow}
      time_format: {}
      values_to_compare:
        simple: ${Results.WHOIS.CreationDate}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 230,
          "y": -40
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "25":
    id: "25"
    taskid: 513e2f1d-3d12-455c-8066-0b80b9521937
    type: condition
    task:
      id: 513e2f1d-3d12-455c-8066-0b80b9521937
      version: -1
      name: Are the domains that were created after the tested time?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "5"
      "yes":
      - "26"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: TimeStampCompare.Result
            iscontext: true
          right:
            value:
              simple: after
    view: |-
      {
        "position": {
          "x": 560,
          "y": 300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "26":
    id: "26"
    taskid: 5f8e6cfa-40fc-43a5-89c9-367275c11c9f
    type: regular
    task:
      id: 5f8e6cfa-40fc-43a5-89c9-367275c11c9f
      version: -1
      name: Set new times
      description: Sets a value into the context with the given context key
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "27"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: NewTimes
      stringify: {}
      value:
        complex:
          root: TimeStampCompare
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: TimeStampCompare.Result
                iscontext: true
              right:
                value:
                  simple: after
          accessor: ComparedTime
          transformers:
          - operator: uniq
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 560,
          "y": 645
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "27":
    id: "27"
    taskid: f0efc84d-45e7-4c1b-898e-4dd7978bb9d6
    type: regular
    task:
      id: f0efc84d-45e7-4c1b-898e-4dd7978bb9d6
      version: -1
      name: Set new domains
      description: Sets a value into the context with the given context key
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "37"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: NewDomains
      stringify: {}
      value:
        complex:
          root: Results
          filters:
          - - operator: inList
              left:
                value:
                  simple: Results.CreationDate
                iscontext: true
              right:
                value:
                  simple: NewTimes
                iscontext: true
          accessor: Whois.QueryValue
          transformers:
          - operator: uniq
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 560,
          "y": 780
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "28":
    id: "28"
    taskid: 7096bf2e-8db1-443a-8659-04fcbb085562
    type: regular
    task:
      id: 7096bf2e-8db1-443a-8659-04fcbb085562
      version: -1
      name: Set Results
      description: Sets a value into the context with the given context key
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "39"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Results
      stringify: {}
      value:
        simple: ${inputs.WhoisResults}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 230,
          "y": -660
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "29":
    id: "29"
    taskid: f98c2038-085d-4474-8484-9bcfaf2d232b
    type: regular
    task:
      id: f98c2038-085d-4474-8484-9bcfaf2d232b
      version: -1
      name: Set not new times
      description: Sets a value into the context with the given context key
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: NotNewTimes
      stringify: {}
      value:
        complex:
          root: TimeStampCompare
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: TimeStampCompare.Result
                iscontext: true
              right:
                value:
                  simple: before
            - operator: isEqualString
              left:
                value:
                  simple: TimeStampCompare.Result
                iscontext: true
              right:
                value:
                  simple: equal
          accessor: ComparedTime
          transformers:
          - operator: uniq
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -290,
          "y": 730
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "30":
    id: "30"
    taskid: 5c6762fc-1621-47b5-8166-921a44253f16
    type: condition
    task:
      id: 5c6762fc-1621-47b5-8166-921a44253f16
      version: -1
      name: Are the domains that were created before the tested time?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "5"
      "yes":
      - "29"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: TimeStampCompare.Result
            iscontext: true
          right:
            value:
              simple: before
        - operator: isEqualString
          left:
            value:
              simple: TimeStampCompare.Result
            iscontext: true
          right:
            value:
              simple: equal
    view: |-
      {
        "position": {
          "x": -290,
          "y": 300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "31":
    id: "31"
    taskid: fd10a22d-4cfd-441e-8c6f-b0807c164a4d
    type: regular
    task:
      id: fd10a22d-4cfd-441e-8c6f-b0807c164a4d
      version: -1
      name: Set non new domains
      description: Sets a value into the context with the given context key
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "5"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: NotNewDomains
      stringify: {}
      value:
        complex:
          root: Results
          filters:
          - - operator: inList
              left:
                value:
                  simple: Results.CreationDate
                iscontext: true
              right:
                value:
                  simple: NotNewTimes
                iscontext: true
          accessor: Whois.QueryValue
          transformers:
          - operator: uniq
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -290,
          "y": 935
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "32":
    id: "32"
    taskid: 18761c31-f905-4052-8c29-b3560bea989e
    type: title
    task:
      id: 18761c31-f905-4052-8c29-b3560bea989e
      version: -1
      name: New domains
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "25"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 560,
          "y": 165
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "33":
    id: "33"
    taskid: 3c07a4cc-cb82-4249-8c51-22473960e12c
    type: title
    task:
      id: 3c07a4cc-cb82-4249-8c51-22473960e12c
      version: -1
      name: Non new domains
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "30"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -290,
          "y": 165
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "34":
    id: "34"
    taskid: d6abffc9-cf61-4c64-873d-ca76c57ccfc8
    type: title
    task:
      id: d6abffc9-cf61-4c64-873d-ca76c57ccfc8
      version: -1
      name: Domain not resolved by Whois
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "35"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -1090,
          "y": 165
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "35":
    id: "35"
    taskid: 2f43a5e9-56fa-4b90-84c7-3172513c0ea4
    type: condition
    task:
      id: 2f43a5e9-56fa-4b90-84c7-3172513c0ea4
      version: -1
      name: Are there domains without Whois query results?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "5"
      - "38"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEqualString
          left:
            value:
              simple: Results.Whois.QueryResult
            iscontext: true
          right:
            value:
              simple: "true"
    view: |-
      {
        "position": {
          "x": -1090,
          "y": 310
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "36":
    id: "36"
    taskid: c2f1d75a-7c81-4286-8a43-e25c25376d3c
    type: regular
    task:
      id: c2f1d75a-7c81-4286-8a43-e25c25376d3c
      version: -1
      name: Tag domain with no Whois resolution
      description: tag indicator with no Whois result.
      script: Builtin|||appendIndicatorField
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "5"
    scriptarguments:
      field:
        simple: tags
      fieldValue:
        simple: no_whois_resolution
      indicatorsValues:
        simple: ${DomainsNotResolvedByWhois}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -1090,
          "y": 935
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "37":
    id: "37"
    taskid: 0d20246e-2988-4596-8502-54ad1211a25d
    type: regular
    task:
      id: 0d20246e-2988-4596-8502-54ad1211a25d
      version: -1
      name: Tag domain as new
      description: Tag indicator as new domain.
      script: Builtin|||appendIndicatorField
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "5"
    scriptarguments:
      field:
        simple: tags
      fieldValue:
        simple: new_domain
      indicatorsValues:
        simple: ${NewDomains}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 560,
          "y": 935
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "38":
    id: "38"
    taskid: fdba449b-6ded-447b-8ab8-f5a9a6bee0e4
    type: regular
    task:
      id: fdba449b-6ded-447b-8ab8-f5a9a6bee0e4
      version: -1
      name: Set domains without Whois results
      description: Sets a value into the context with the given context key
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "36"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: DomainsNotResolvedByWhois
      stringify: {}
      value:
        complex:
          root: Results
          filters:
          - - operator: isNotEqualString
              left:
                value:
                  simple: Results.Whois.QueryResult
                iscontext: true
              right:
                value:
                  simple: "true"
          accessor: Whois.QueryValue
          transformers:
          - operator: uniq
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -1090,
          "y": 730
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "39":
    id: "39"
    taskid: 129ea7dc-ff40-4b11-8906-a5ee7e828f6e
    type: condition
    task:
      id: 129ea7dc-ff40-4b11-8906-a5ee7e828f6e
      version: -1
      name: Was a time to compare value provided?
      type: condition
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#default#':
      - "40"
      "yes":
      - "28"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: inputs.MinimumAgeMonthValue
            iscontext: true
        - operator: isNotEmpty
          left:
            value:
              simple: inputs.MinimumAgeDayValue
            iscontext: true
    view: |-
      {
        "position": {
          "x": 230,
          "y": -660
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "40":
    id: "40"
    taskid: 66464352-d00a-4193-88a3-0be8f3687df1
    type: title
    task:
      id: 66464352-d00a-4193-88a3-0be8f3687df1
      version: -1
      name: No compare time was provided
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "41"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1110,
          "y": -475
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "41":
    id: "41"
    taskid: 02ac451b-0907-4eb1-8534-8430bc7298e6
    type: regular
    task:
      id: 02ac451b-0907-4eb1-8534-8430bc7298e6
      version: -1
      name: Set domains that couldnt be processed
      description: Sets a value into the context with the given context key
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "5"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: DomainsNotProcessed
      stringify: {}
      value:
        complex:
          root: Results
          accessor: Whois.QueryValue
          transformers:
          - operator: uniq
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1110,
          "y": -295
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 2175,
        "width": 2580,
        "x": -1090,
        "y": -950
      }
    }
  }
inputs:
- key: MinimumAgeMonthValue
  value: {}
  required: false
  description: The minimal month age of a domain to be considered a new domain. Specifying
    the value 1 will mean that if the tested domain was registered less than a month
    ago it will be considered a new domain.
  playbookInputQuery: null
- key: MinimumAgeDayValue
  value: {}
  required: false
  description: The minimal day age of a domain to be considered a new domain. Specifying
    the value 1 will mean that if the tested domain was registered less than one day
    ago it will be considered a new domain.
  playbookInputQuery: null
- key: WhoisResults
  value: {}
  required: false
  description: This input receives the Whois results from the parent playbook.
  playbookInputQuery: null
outputs:
- contextPath: NewDomains
  description: Domains their create value is after the tested date.
  type: string
- contextPath: NotNewDomains
  description: Domains their create value is before the tested date.
  type: string
- contextPath: DomainsNotResolvedByWhois
  description: Domains Not Resolved By Whois.
  type: string
- contextPath: DomainsNotProcessed
  description: In case no time value to compare was provided all domains will be outputted
    here.
  type: string
quiet: true
tests:
- No test