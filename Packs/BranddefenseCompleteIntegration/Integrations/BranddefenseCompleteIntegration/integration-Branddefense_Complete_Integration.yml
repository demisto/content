category: Utilities
commonfields:
  id: Branddefense Complete Integration
  version: -1
configuration:
- additionalinfo: Reliability of the source providing the intelligence data.
  defaultvalue: C - Fairly reliable
  display: Source Reliability
  name: integrationReliability
  options:
  - A+ - 3rd party enrichment
  - A - Completely reliable
  - B - Usually reliable
  - C - Fairly reliable
  - D - Not usually reliable
  - E - Unreliable
  - F - Reliability cannot be judged
  required: false
  section: Collect
  type: 15
- defaultvalue: https://api.brandefense.io/api/v1/incidents
  display: Server URL (e.g., https://api.xsoar-example.com)
  name: url
  required: true
  section: Connect
  type: 0
- display: Fetch incidents
  name: isFetch
  required: false
  section: Collect
  type: 8
- display: Incident type
  name: incidentType
  required: false
  section: Connect
  type: 13
- defaultvalue: "10"
  display: Maximum number of alerts per fetch
  name: max_fetch
  required: false
  section: Collect
  type: 0
- display: ""
  displaypassword: API Key
  hiddenusername: true
  name: credentials
  required: true
  section: Connect
  type: 9
- additionalinfo: Set this to determine the HelloWorld score that will determine if
    an IP is malicious (0-100)
  advanced: true
  defaultvalue: "65"
  display: Score threshold for IP reputation command
  name: threshold_ip
  required: false
  section: Collect
  type: 0
- defaultvalue: low
  display: Severity of alerts to fetch
  name: severity
  options:
  - low
  - medium
  - high
  - critical
  required: true
  section: Collect
  type: 15
- defaultvalue: 3 days
  display: First fetch time
  name: first_fetch
  required: false
  section: Collect
  type: 0
- advanced: true
  display: Trust any certificate (not secure)
  name: insecure
  required: false
  section: Connect
  type: 8
- advanced: true
  display: Use system proxy settings
  name: proxy
  required: false
  section: Connect
  type: 8
- defaultvalue: "1"
  display: Incidents Fetch Interval
  name: incidentFetchInterval
  required: false
  type: 19
contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: ""
    itemVersion: ""
    packID: c99e8e23-506a-45a0-8194-8d2db733b5d4
    packName: Branddefense Complete Integration
    prevname: ""
    propagationLabels: []
    toServerVersion: ""
description: Branddefense Integration
detaileddescription: |-
  ### Community Contributed Integration
   #### Integration Author: Asim Sarp Kurt
   No support or maintenance is provided by the author. Customers are encouraged to engage with the user community for questions and guidance at the [Cortex XSOAR Live Discussions](https://live.paloaltonetworks.com/t5/cortex-xsoar-discussions/bd-p/Cortex_XSOAR_Discussions).
  ***
  ## Hello World
  - This section explains how to configure the instance of HelloWorld in Cortex XSOAR:
  - You can use the following API Key: `dummy-key`


  ---
  [View Integration Documentation](https://xsoar.pan.dev/docs/reference/integrations/hello-world)
display: Branddefense Complete Integration
image: data:image/png;base64,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
name: Branddefense Complete Integration
script:
  commands:
  - arguments: []
    name: branddefense_get_assets
    outputs:
    - contextPath: branddefense_assets
  - arguments:
    - name: assetid
      required: true
    name: branddefense_get_specific_asset
    outputs:
    - contextPath: branddefense_requested_asset
  - arguments: []
    name: branddefense_get_audit_logs
    outputs:
    - contextPath: branddefense_audit_logs
  - arguments:
    - name: audit_log_id
      required: true
    name: branddefense_get_specific_audit_log
    outputs:
    - contextPath: branddefense_requested_audit_log
  - arguments:
    - name: search_uuid
    name: branddefense_get_threat_search
  - arguments:
    - name: incident_code
      required: true
    name: branddefense_get_specific_incident
    outputs:
    - contextPath: branddefense_requested_incident
  - arguments:
    - description: The required code parameter should be given to perform incident
        searches on Brandefense.
      name: incident_code
      required: true
    - description: 'The required status parameter should be given to perform change
        incident status Possible Values: ''OPEN'' ''IN_PROGRESS'' ''CLOSED'' ''RISK_ACCEPTED''
        ''REJECTED'''
      isArray: true
      name: incident_status
      required: true
    name: branddefense_change_incident_status
  - arguments:
    - description: The required code parameter should be given to perform incident
        searches on Brandefense.
      name: incident_code
      required: true
    name: branddefense_get_incident_indicators
    outputs:
    - contextPath: branddefense_requested_incident_indicators
  - arguments:
    - name: indicator_type
      required: true
    name: branddefense_get_indicators
    outputs:
    - contextPath: branddefense_requested_indicator
  - arguments:
    - description: The required ioc_type parameter allows you to select Indicators
        of Compromise (IoCs) types from the threat lists.
      name: ioc_type
      required: true
    name: branddefense_get_ioc
    outputs:
    - contextPath: branddefense_ioc
      description: hash,domain,url veya ip address girilmeli
  - arguments:
    - description: Cti Rule Created at range
      name: created_at__range
    - description: Cti rule search
      name: search
    - name: tag
    - name: source__ilike
    name: branddefense_get_cti_rules
  - arguments:
    - name: value
    description: Create Threat Search endpoint allows you to post indicator of compromises
      to investigate suspicious/malicious IP, Domain, URL address or Hash values.
    name: branddefense_create_threat_search
    outputs:
    - contextPath: search_result
  - arguments:
    - name: created_at
    name: branddefense_get_incidents
    outputs:
    - contextPath: branddefense_all_incidents
  dockerimage: demisto/python3:3.10.13.74666
  isfetch: true
  runonce: false
  script: |
    import requests


    def get_assets(api_token):
        url = "https://api.brandefense.io/api/v1/assets"
        headers = {
        "accept": "application/json",
        "content-type": "application/json",
        "authorization": "Bearer "+api_token}
        response = requests.get(url, headers=headers)
        allassets={'assets':response.json()}
        result=CommandResults(outputs=allassets,outputs_prefix='branddefense_assets')
        return_results(result)
        return result

    def get_specific_asset(api_token,args):
        asset_id=args.get('assetid')
        url = "https://api.brandefense.io/api/v1/assets/"+str(asset_id)
        headers = {
        "accept": "application/json",
        "content-type": "application/json",
        "authorization": "Bearer "+api_token}
        response = requests.get(url, headers=headers)
        requestedasset={'assets':response.json()}
        result=CommandResults(outputs=requestedasset,outputs_prefix='branddefense_requested_asset')
        return_results(result)
        return result


    def get_audit_logs(api_token):
        url = "https://api.brandefense.io/api/v1/audit-logs"
        headers = {
        "accept": "application/json",
        "content-type": "application/json",
        "authorization": "Bearer "+api_token}
        response = requests.get(url, headers=headers)
        auditlogs={'auditlogs':response.json()}
        result=CommandResults(outputs=auditlogs,outputs_prefix='branddefense_audit_logs')
        return_results(result)
        return result

    def get_specific_audit_log(api_token,args):
        audit_log_id=args.get('audit_log_id')
        url = "https://api.brandefense.io/api/v1/audit-logs/"+str(audit_log_id)
        headers = {
        "accept": "application/json",
        "content-type": "application/json",
        "authorization": "Bearer "+api_token}
        response = requests.get(url, headers=headers)
        requestedauditlog={'requestedauditlog':response.json()}
        result=CommandResults(outputs=requestedauditlog,outputs_prefix='branddefense_requested_audit_log')
        return_results(result)
        return result

    def get_threat_search(api_token,args):
        uuid=args.get('search_uuid')
        uuid=str(uuid)
        url = "https://api.brandefense.io/api/v1/cti/threat-search/"+uuid
        headers = {
        "accept": "application/json",
        "content-type": "application/json",
        "authorization": "Bearer "+api_token}
        response = requests.get(url, headers=headers)
        search_result={'sarch_result':response.json()}
        result=CommandResults(outputs=search_result,outputs_prefix='search_result')
        return_results(result)
        return result


    def get_specific_incident(api_token,args):
        incident_code=args.get('incident_code')
        incident_code=str(incident_code)
        url = "https://api.brandefense.io/api/v1/incidents/"+incident_code
        headers = {
        "accept": "application/json",
        "content-type": "application/json",
        "authorization": "Bearer "+api_token}
        response = requests.get(url, headers=headers)
        branddefense_requested_incident={'branddefense_requested_incident':response.json()}
        result=CommandResults(outputs=branddefense_requested_incident,outputs_prefix='branddefense_requested_incident')
        return_results(result)
        return result


    def change_incident_status(api_token,args):
        incident_code=args.get('incident_code')
        incident_code=str(incident_code)
        incident_status=args.get('incident_status')
        incident_status=str(incident_status)
        url = "https://api.brandefense.io/api/v1/incidents/"+incident_code+"/change-status"
        payload={"status":incident_status}
        headers = {
        "accept": "application/json",
        "content-type": "application/json",
        "authorization": "Bearer "+api_token}
        response = requests.patch(url,json=payload, headers=headers)
        incident_status_to_changed={'incident_status_to_changed':response.json()}
        result=CommandResults(outputs=incident_status_to_changed,outputs_prefix='incident_status_to_changed')
        return_results(result)
        return result


    def get_incident_indicators(api_token,args):
        incident_code=args.get('incident_code')
        incident_code=str(incident_code)
        url = "https://api.brandefense.io/api/v1/incidents/"+incident_code+"/indicators"
        headers = {
        "accept": "application/json",
        "content-type": "application/json",
        "authorization": "Bearer "+api_token}
        response = requests.get(url, headers=headers)
        branddefense_requested_incident_indicators={'branddefense_requested_incident_indicators':response.json()}
        result=CommandResults(outputs=branddefense_requested_incident_indicators,outputs_prefix='branddefense_requested_incident_indicators')
        return_results(result)
        return result


    def get_indicator(api_token,args):
        indicator_type=args.get('indicator_type')
        indicator_type=str(indicator_type)
        url = "https://api.brandefense.io/api/v1/indicators"
        querystring={'indicator_type':indicator_type}
        headers = {
        "accept": "application/json",
        "content-type": "application/json",
        "authorization": "Bearer "+api_token}
        response = requests.get(url, headers=headers, params=querystring)
        branddefense_requested_indicator={'branddefense_requested_indicator':response.json()}
        result=CommandResults(outputs=branddefense_requested_indicator,outputs_prefix='branddefense_requested_indicator')
        return_results(result)
        return result


    def get_ioc(api_token,args):
        ioc_type=args.get('ioc_type')
        ioc_type=str(ioc_type)
        url = "https://api.brandefense.io/api/v1/threat-intelligence/iocs"
        querystring={'ioc_type':ioc_type}
        headers = {
        "accept": "application/json",
        "content-type": "application/json",
        "authorization": "Bearer "+api_token}
        response = requests.get(url, headers=headers, params=querystring)
        branddefense_ioc={'branddefense_ioc':response.json()}
        result=CommandResults(outputs=branddefense_ioc,outputs_prefix='branddefense_ioc')
        return_results(result)
        return result


    def get_cti_rules(api_token,args):
        search=args.get('search')
        search=str(search)
        created_at__range=args.get('created_at__range')
        created_at__range=str(created_at__range)
        tag=args.get('tag')
        tag=str(tag)
        source__ilike=args.get('source__ilike')
        source__ilike=str(source__ilike)
        url = "https://api.brandefense.io/api/v1/threat-intelligence/rules"
        querystring={'tag':tag,'search':search}
        headers = {
        "accept": "application/json",
        "content-type": "application/json",
        "authorization": "Bearer "+api_token}
        if len(search)>2 or len(created_at__range)>2 or len(search)>2 or len(tag)>2 or len(source__ilike)>2:
            response = requests.get(url, headers=headers,params=querystring)
        else:
            response = requests.get(url, headers=headers)
        branddefense_cti_rules={'branddefense_cti_rules':response.json()}
        result=CommandResults(outputs=branddefense_cti_rules,outputs_prefix='branddefense_cti_rules')
        return_results(result)
        return result



    def create_threat_search(api_token,args):
        value=args.get('value')
        value=str(value)
        url = "https://api.brandefense.io/api/v1/cti/threat-search"
        payload={"value": value}
        headers = {
        "accept": "application/json",
        "content-type": "application/json",
        "authorization": "Bearer "+api_token}
        response = requests.post(url, json=payload, headers=headers)
        search_start={'sarch_created':response.json()}
        result=CommandResults(outputs=search_start,outputs_prefix='search_start')
        return_results(result)
        return result


    def get_incidents(api_token,args):
        created_at=args.get("created_at")
        url = "https://api.brandefense.io/api/v1/incidents"
        querystring={'created_at__range':str(created_at)}
        headers = {
        "accept": "application/json",
        "content-type": "application/json",
        "authorization": "Bearer "+api_token}
        response = requests.get(url, headers=headers,params=querystring)
        branddefense_all_incidents={'branddefense_incidents':response.json()}
        result=CommandResults(outputs=branddefense_all_incidents,outputs_prefix='branddefense_all_incidents')
        return_results(result)
        return result

    def main():
        try:
            args=demisto.args()
            command=demisto.command()
            params=demisto.params()
            api_token=params.get('credentials',{}).get('password')

            if command == 'branddefense_get_assets':
                result=get_assets(api_token)
            elif command == 'branddefense_get_specific_asset':
                result=get_specific_asset(api_token,args)
            elif command == 'branddefense_get_audit_logs':
                result=get_audit_logs(api_token)
            elif command == 'get_specific_audit_log':
                result=get_specific_audit_log(api_token,args)
            elif command == 'branddefense_get_threat_search':
                result =get_threat_search(api_token,args)
            elif command == 'branddefense_requested_incident':
                result =get_specific_incident(api_token,args)
            elif command == 'branddefense_change_incident_status':
                result = change_incident_status(api_token,args)
            elif command == 'branddefense_requested_incident_indicators':
                result=get_incident_indicators(api_token,args)
            elif command == 'branddefense_get_indicators':
                result=get_indicator(api_token,args)
            elif command =='branddefense_get_ioc':
                result=get_ioc(api_token,args)
            elif command =='branddefense_get_cti_rules':
                result=get_cti_rules(api_token,args)
            elif command == 'branddefense_create_threat_search':
                result=create_threat_search(api_token,args)
            elif command == 'branddefense_get_incidents':
                result=get_incidents(api_token,args)
        except Exception as e:
            return_error(f'Failed to execute {command} command.\nError:\n{str(e)}')


    if __name__ in ('__main__', '__builtin__', 'builtins'):
        main()
  subtype: python3
  type: python
