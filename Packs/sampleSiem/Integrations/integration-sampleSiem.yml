commonfields:
  id: Sample Incident Generator
  version: -1
name: Sample Incident Generator
display: Sample Incident Generator
category: Analytics & SIEM
image: data:image/png;base64,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
description: Generate random incidents per given parameter
configuration:
- display: Fetch incidents
  name: isFetch
  type: 8
  required: false
- display: 'Fetch incidents  every X minutes '
  name: runEveryXMinutes
  defaultvalue: "30"
  type: 0
  required: false
- display: Incident type
  name: incidentType
  required: false
  type: 13
script:
  script: >-
    function buildIncident(incidentType) {
        var incident = {
            severity: getSeverity(),
            type: incidentType,
            phase: '1. Triage',
            labels: [{'type': 'sample', 'value': 'sample value'}],
            details: "Issue Details",
        };

        switch (incidentType) {
            case 'Unclassified':
                break;
            case 'Malware':
                incident.details = "Detected Incident with malicious on files on system sample-laptop.";
                incident.labels = [{'type':'md5', 'value':'7BF2B57F2A205768755C07F238FB32CC'},
                    {'type':'user', 'value':'Jeni Russo'},
                    {'type':'system', 'value':'sample-laptop'},
                    {'type':'md5','value':'8495400F199AC77853C53B5A3F278F3E'}];
                break;
            case 'Phishing':
                incident.details = 'Hi, got this in my inbox today. \n \
                From: somerandomemail@nodomain.net \n \
                Sent: Sunday, January 24, 2016 19:43 \n \
                To: Bob<bob@demisto.int>; \n \
                Subject: Cloud Services Invoice \n \
                Dear customer, \n \
                Thank you for signing up for Acme Creative Cloud Service. \
                You can download latest invoice at http://www.kloshpro.com/js/db/b/db/d/9/dropbx.z/document.html \n \
                Attached is the copy of your invoice. \n \
                Invoice \n \
                Thank you for your purchase. \n \
                 \n \
                Thank You, \n \
                The Acme Team \n \
                Acme Creative Cloud Service';
                incident.labels = [{'type':'IP Address', 'value':'195.22.26.248'}, {'type':'IP Address', 'value':'107.161.186.90'}, {'type':'md5', 'value':'775A0631FB8229B2AA3D7621427085AD'}, {'type':'user', 'value':'Jeni Russo'}];
                break;
        }
        return incident;
    }



    switch (command) {
        case 'test-module':
            return 'ok';
        case 'fetch-incidents':
            var incidents = [];
            last = getLastRun();
            if (!last || !last.lastMinuteCount) {
                last = {'lastMinuteCount': 0};
            }
            var lastMinuteCount = last.lastMinuteCount;
            var numOfIncidentsPerMin = 5;
            var runEvery = parseInt(params['runEveryXMinutes'], 10) || 1 ;
            last = {'lastMinuteCount': lastMinuteCount+1};
            setLastRun(last);
            if (lastMinuteCount % runEvery === 0) {
                for (var i = 0; i < numOfIncidentsPerMin; i++) {
                    //Incident details, other field can be added as json
                    var incidentType = getIncidentType();
                    var incident = buildIncident(incidentType);
                    incident.name = 'Sample Incident - ' + incidentType;
                    incident.rawJSON = JSON.stringify(incident);
                    incidents.push(incident);
                }
            }
            return JSON.stringify(incidents);
        default:
            return 'nothing to see here';
    }



    function getIncidentType (number) {
        var num = number || Math.floor(Math.random() * 3) + 1;
        switch (num) {
            case 1:
                return 'Unclassified';
            case 2:
                return 'Malware';
            case 3:
                return 'Phishing';
            default:
                return '';
        }
    }


    function getSeverity (number) {
        return number || Math.floor(Math.random() * 5);
    }
  type: javascript
  isfetch: true
tests:
- No test
fromversion: 5.0.0
