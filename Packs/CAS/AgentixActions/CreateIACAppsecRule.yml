commonfields:
  id: CreateIACAppsecRule
  version: -1
name: CreateIACAppsecRule
display: CAS - Create Iac Appsec Rule 
description: Creates a new Application Security rule in Cortex Platform. An AppSec rule defines the specific criteria and scanners used to detect vulnerabilities or misconfigurations across your application lifecycle.
category: Utilities
requiresuserapproval: false
marketplaces:
  - platform
supportedModules:
  - agentix
  - xsiam
  - cloud_posture
tags:
  - Appsec
  - Rules
args:
- name: rule_name
  underlyingargname: rule_name
  description: >
    A unique name for the AppSec rule following the organization's naming conventions.
  type: string
  required: true
- name: description
  underlyingargname: description
  description: >
    A descriptive summary of the rule's objective and expected outcomes.
  type: string
  required: false
- name: labels
  underlyingargname: labels
  description: >
    A comma-separated list of rule labels to apply the rule to.
  type: string
  required: false
- name: severity
  underlyingargname: severity
  description: >
    Filter findings based on their severity level.
    Options: CRITICAL, HIGH, MEDIUM, LOW.
  type: string
  required: true
- name: scanner
  underlyingargname: scanner
  description: >
    The type of security scanner used to detect findings of this rule. 
    Options: SECRETS, IAC.
  type: string
  required: true
- name: category
  underlyingargname: category
  description: >
    Custom rule IAC category
    Options: AI_ML, COMPUTE, IAM, KUBERNETES, LOGGING, MONITORING, NETWORKING, PUBLIC, STORAGE
  type: string
  required: true
- name: sub_category
  underlyingargname: sub_category
  description: >
    Custom rule IAC sub_category
    Options: 
    if category is AI_ML: GUARDRAILS, RISKY_MODELS, PUBLIC_EXPOSURE, PERMISSIONS.
    if category is COMPUTE: OVERPROVISIONED, STARTUP_SCRIPT_LEAKS, DEFAULT_CREDENTIALS_OR_AUTH, UNSANCTIONED_RESOURCE_OR_TYPE.
    if category is IAM: OVERLY_PERMISSIVE, UNUSED, CREDENTIAL_EXPOSURE, MFA, ROLE_SEPARATION, SHARED, EXPIRED_KEY_CONTROLS, AUTHENTICATION_POLICIES.
    if category is KUBERNETES: NETWORK_POLICIES, ACCESS_CONTROL, LOGGING_AND_MONITORING, RESOURCE_MANAGEMENT, NATIVE_SECURITY_CONTROLS, MANAGEMENT_SERVICES_EXPOSURE.
    if category is LOGGING: ENCRYPTION, PERMISSIONS, RETENTION, FORMATS, DISABLED_OR_MISSING, PUBLIC_EXPOSURE, UNDER_USE.
    if category is MONITORING: TAGS_AND_METADATA, RESOURCE_HEALTH, PERFORMANCE_MONITORING, ALERTING_AND_NOTIFICATIONS, UNINTEGRATED, STORAGE.
    if category is NETWORKING: LOAD_BALANCING, INGRESS_CONTROLS, EGRESS_CONTROLS, ENCRYPTION_AND_PROTOCOLS, VPC_VCN_VNET, FLOW_LOGS.
    if category is PUBLIC: ADMIN_INTERFACES, DATABASE_ENDPOINTS, STORAGE_BUCKETS, APIS, SENSITIVE_PORTS.
    if category is STORAGE: ENCRYPTION, PERMISSIONS, BACKUPS, VERSIONING, REPLICATION, ALERTING, REDUNDANCY.
  type: string
  required: true
- name: frameworks
  underlyingargname: frameworks
  description: >
    array of json objects { name:string, definition:string } for the rule
    name Options: ARM, BICEP, CLOUDFORMATION, KUBERNETES, TERRAFORM..
    The rule definition
    If definition not exist create one for yourself
    Example:
    scope:
      provider: '' # Optional - choose one: "alibaba_cloud"/"aws"/"azure"/"gcp"/"oci"
    definition: # Define the configurations that will pass when running a scan. Any resource matching the specified resource type but not matching the defined attribute configuration and/or resource type will fail the check.
      The example below checks for EC2s with an instance_type that is not t3.micro or t3.nano. For more examples please visit our docs - https://docs-cortex.paloaltonetworks.com/r/Cortex-CLOUD/Cortex-Cloud-Runtime-Security-Documentation/Configure-YAML-file-properties
      or:
        - cond_type: 'attribute'
          resource_types:
            - 'aws_instance'
          attribute: 'instance_type'
          operator: 'equals'
          value: 't3.micro'
        - cond_type: 'attribute'
          resource_types:
            - 'aws_instance'
          attribute: 'instance_type'
          operator: 'equals'
          value: 't3.nano'
  type: string
outputs:
- name: Appsec.Rule.RULE_NAME
  description: The name of the Rule.
  type: string
  underlyingoutputcontextpath: Appsec.Rule.RULE_NAME
underlyingcontentitem:
  id: CreateAppsecRule
  name: CreateAppsecRule
  type: script
  version: -1
  command: ""