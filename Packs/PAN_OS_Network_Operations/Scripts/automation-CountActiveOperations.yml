comment: Used as a dynamic field, retrieves all the currently active operations for
  a given firewall.
commonfields:
  id: CountActiveOperations
  version: -1
contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: ""
    itemVersion: ""
    packID: a3acf260-148d-4af7-81ab-49744965d264
    propagationLabels:
    - all
    toServerVersion: ""
dockerimage: demisto/python3:3.9.8.24399
enabled: true
engineinfo: {}
mainengineinfo: {}
name: CountActiveOperations
pswd: ""
runas: DBotWeakRole
runonce: false
script: |
  register_module_line('CountActiveOperations', 'start', __line__())



  incident = demisto.incidents()[0]
  target = incident.get('CustomFields', {}).get('panosnetworkoperationstarget')
  res = demisto.executeCommand("GetIncidentsByQuery", {
      "query": f"-status:closed -category:job target:{target} -type:\"PAN-OS Network Operations - Device\""
  })
  if is_error(res):
      return_error(get_error(res))

  incidents = json.loads(res[0]['Contents'])


  data = {
      "Type": 17,
      "ContentsFormat": "number",
      "Contents": {
          "stats": len(incidents),
          "params": {
              "layout": "horizontal",
              "name": f"Active Operations for {target}",
              "sign": "",
              "colors": {
                  "items": {
                      "#00CD33": {
                        "value": 5
                      },
                      "#FAC100": {
                          "value": 0
                      },
                  }
              },
              "type": "above"
          }
      }
  }

  demisto.results(data)

  register_module_line('CountActiveOperations', 'end', __line__())
scripttarget: 0
subtype: python3
tags:
- dynamic-section
type: python
