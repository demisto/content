comment: Used as a dynamic field, retrieves all the currently hygiene incidents and
  counts the total number of fixes deployed.
commonfields:
  id: 34ef0c51-ee18-4302-818b-7b9db2d276b2
  version: -1
contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: ""
    itemVersion: ""
    packID: a3acf260-148d-4af7-81ab-49744965d264
    propagationLabels:
    - all
    toServerVersion: ""
dockerimage: demisto/python3:3.9.8.24399
enabled: true
engineinfo: {}
mainengineinfo: {}
name: CountFixedVisibilityHygieneIssues
pswd: ""
runas: DBotWeakRole
runonce: false
script: |
  """
  Counts the number of open FW Change requests for the platform, if the change management pack is in use.
  """
  res = demisto.executeCommand("GetIncidentsByQuery", {
      "query": f"-category:job type:\"PAN-OS Network Operations - Visibility Hygiene\""
  })
  if is_error(res):
      return_error(get_error(res))

  incidents = json.loads(res[0]['Contents'])

  issue_list = []
  for incident in incidents:
      grid_field = incident.get("CustomFields").get("panosnetworkoperationsfixedconfigurationhygieneissues")
      issue_list += grid_field

  count = len(issue_list)

  data = {
      "Type": 17,
      "ContentsFormat": "number",
      "Contents": {
          "stats": count,
          "params": {
              "layout": "horizontal",
              "name": "Configuration Hygiene Issues",
              "sign": "",
              "colors": {
                  "items": {
                      "#ebebeb": {"value": -1},
                      "#00CD33": {"value": 1},
                  }
              },
              "type": "above"
          }
      }
  }

  # If demisto.args() isn't empty, then this is being invoked as a widget script, in which case simply return the count.
  # Also check for currentUser key, which deliniates this as being run within an incident layout
  if "currentUser" in demisto.args():
      demisto.results(data)
  elif demisto.args():
      demisto.results(count)
  else:
      demisto.results(data)
scripttarget: 0
subtype: python3
tags:
- dynamic-section
- widget
type: python
