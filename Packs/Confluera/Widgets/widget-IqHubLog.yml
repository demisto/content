commonfields:
  id: IqHubLog
  version: -1
name: IqHubLog
script: |-
  import json

  # Executes confluera-login command/script
  login_data = demisto.executeCommand('confluera-login', {})
  token = login_data[0]['Contents']['access_token']


  # Executes confluera-fetch-detections command/script
  detections_data = demisto.executeCommand('confluera-fetch-detections', { 'access_token': token, 'hours': '24'})
  det_url = detections_data[0]['Contents']['Detections URL']
  det_count = len(detections_data[1]['Contents'])

  # Executes confluera-fetch-progressions command/script
  progressions_data = demisto.executeCommand('confluera-fetch-progressions', { 'access_token': token, 'hours': '72'})
  prog_url = progressions_data[0]['Contents']['Progressions URL']
  prog_count = len(progressions_data[1]['Contents'])


  data = [
    {
      'Count': 'Detections: '+ str(det_count),
      'URL': det_url
    },
    {
      'Count': 'Progressions:' + str(prog_count),
      'URL': prog_url
    }
  ]

  demisto.results({
    'total': 2,
    'data': data
  })
type: python
tags: []
comment: |-
  Logs detections & progression counts along with respective links to confluera Iq-Hub portal.
enabled: true
scripttarget: 0
subtype: python3
dependson:
  must:
  - Confluera|||confluera-login
  - Confluera|||confluera-fetch-detections
  - Confluera|||confluera-fetch-progressions
  should:
  - Confluera|||confluera-login
  - Confluera|||confluera-fetch-detections
  - Confluera|||confluera-fetch-progressions
runonce: false
dockerimage: demisto/python3:3.9.4.18682
runas: DBotWeakRole
fromversion: 5.0.0
tests:
- No tests (auto formatted)
