id: Code42 Exfiltration Playbook
version: -1
name: Code42 Exfiltration Playbook
description: The Code42 Exfiltration playbook acts on Code42 Security Alerts, retrieves
  file event data, and allows security teams to remediate file exfiltration events
  by revoking access rights to cloud files or containing endpoints.
starttaskid: '0'
tasks:
  '0':
    id: '0'
    taskid: cb09ea8c-7a68-4162-8756-87cb4b5155d9
    type: start
    task:
      id: cb09ea8c-7a68-4162-8756-87cb4b5155d9
      version: -1
      name: ''
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '1'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 520,
          "y": -90
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  '1':
    id: '1'
    taskid: 0dae8dde-9ba6-4d0a-8562-cfd2fa65e06b
    type: title
    task:
      id: 0dae8dde-9ba6-4d0a-8562-cfd2fa65e06b
      version: -1
      name: Start Remediation Timer
      type: title
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '24'
      - '25'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 520,
          "y": 75
        }
      }
    note: false
    timertriggers:
    - fieldname: remediationsla
      action: start
    ignoreworker: false
  '5':
    id: '5'
    taskid: a184e0ba-3bfb-4510-840d-6caaa4a262b1
    type: condition
    task:
      id: a184e0ba-3bfb-4510-840d-6caaa4a262b1
      version: -1
      name: Review Evidence for Malicious Behavior
      description: ''
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - '7'
      Malicious:
      - '6'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 520,
          "y": 465
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  '6':
    id: '6'
    taskid: 4204c1f9-a75a-424f-8906-4dcb71189bf9
    type: title
    task:
      id: 4204c1f9-a75a-424f-8906-4dcb71189bf9
      version: -1
      name: Malicious Behavior Determined
      type: title
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '19'
      - '22'
      - '23'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1000,
          "y": 670
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  '7':
    id: '7'
    taskid: 382104d4-9021-49d8-8848-c0233d0e17b8
    type: title
    task:
      id: 382104d4-9021-49d8-8848-c0233d0e17b8
      version: -1
      name: Benign Behavior Determined
      type: title
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '9'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1900
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  '8':
    id: '8'
    taskid: 8bf6135a-41de-4f2e-81d0-f0e20621e61d
    type: regular
    task:
      id: 8bf6135a-41de-4f2e-81d0-f0e20621e61d
      version: -1
      name: Resolve Code42 Alert
      description: ''
      script: '|||code42-alert-resolve'
      type: regular
      iscommand: true
      brand: ''
    nexttasks:
      '#none#':
      - '26'
    scriptarguments:
      id:
        simple: ${incident.labels.id}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2455
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  '9':
    id: '9'
    taskid: 4def18a6-b969-4f29-8c9b-ea7a97004000
    type: title
    task:
      id: 4def18a6-b969-4f29-8c9b-ea7a97004000
      version: -1
      name: Stop Remediation Timer
      type: title
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '8'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2260
        }
      }
    note: false
    timertriggers:
    - fieldname: remediationsla
      action: stop
    ignoreworker: false
  '10':
    id: '10'
    taskid: 6c5e4d9e-bfd6-4bff-80f7-4ea8a329af9b
    type: title
    task:
      id: 6c5e4d9e-bfd6-4bff-80f7-4ea8a329af9b
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ''
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2905
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  '11':
    id: '11'
    taskid: ab440d56-4490-45dc-8685-7a8cb5748da1
    type: regular
    task:
      id: ab440d56-4490-45dc-8685-7a8cb5748da1
      version: -1
      name: Locate CrowdStrike Host
      description: ''
      script: CrowdstrikeFalcon|||cs-falcon-search-device
      type: regular
      iscommand: true
      brand: CrowdstrikeFalcon
    nexttasks:
      '#none#':
      - '31'
    scriptarguments:
      filter: {}
      hostname:
        complex:
          root: incident
          accessor: code42fileevents.oshostname
          transformers:
          - operator: uniq
      ids: {}
      platform_name: {}
      site_name: {}
      status: {}
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 990,
          "y": 1195
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  '19':
    id: '19'
    taskid: edfaee2f-e2ef-469c-8377-2eaa79e626da
    type: condition
    task:
      id: edfaee2f-e2ef-469c-8377-2eaa79e626da
      version: -1
      name: Is Jira Enabled?
      description: ''
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - '30'
      'yes':
      - '21'
    separatecontext: false
    conditions:
    - label: 'yes'
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: jira-v2
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                accessor: brand
            iscontext: true
    view: |-
      {
        "position": {
          "x": 295,
          "y": 1535
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  '21':
    id: '21'
    taskid: 0dbd8661-9b0c-47fc-88bc-1b05752f81e5
    type: regular
    task:
      id: 0dbd8661-9b0c-47fc-88bc-1b05752f81e5
      version: -1
      name: Create Jira Incident Ticket
      description: ''
      script: jira-v2|||jira-create-issue
      type: regular
      iscommand: true
      brand: jira-v2
    nexttasks:
      '#none#':
      - '30'
    scriptarguments:
      assignee: {}
      description: {}
      dueDate: {}
      issueJson: {}
      issueTypeId: {}
      issueTypeName:
        simple: ${inputs.JiraType}
      labels: {}
      parentIssueId: {}
      parentIssueKey: {}
      priority: {}
      projectKey: {}
      projectName:
        simple: ${inputs.JiraProject}
      reporter: {}
      summary:
        simple: ${inputs.JiraSummary}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 290,
          "y": 1770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  '22':
    id: '22'
    taskid: 8951bca9-832e-4728-8c99-ac8225567f4d
    type: condition
    task:
      id: 8951bca9-832e-4728-8c99-ac8225567f4d
      version: -1
      name: Is CrowdStrike Enabled?
      description: ''
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      '#default#':
      - '30'
      'yes':
      - '28'
    separatecontext: false
    conditions:
    - label: 'yes'
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: CrowdstrikeFalcon
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
                accessor: brand
            iscontext: true
    view: |-
      {
        "position": {
          "x": 990,
          "y": 810
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  '23':
    id: '23'
    taskid: 4b0e0316-551c-4521-8538-0c158e869f4f
    type: condition
    task:
      id: 4b0e0316-551c-4521-8538-0c158e869f4f
      version: -1
      name: Does Manager Email Exist?
      description: ''
      type: condition
      iscommand: false
      brand: ''
    nexttasks:
      'yes':
      - '29'
    separatecontext: false
    conditions:
    - label: 'yes'
      condition:
      - - operator: isExists
          left:
            value:
              simple: UserManagerEmail
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1590,
          "y": 1535
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  '24':
    id: '24'
    taskid: 2433863a-006b-466d-8806-a073c17e4b40
    type: regular
    task:
      id: 2433863a-006b-466d-8806-a073c17e4b40
      version: -1
      name: Retrieve File Contents
      type: regular
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '5'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 310,
          "y": 260
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  '25':
    id: '25'
    taskid: 048d8d85-9980-4c99-8f0c-6ec470790f3c
    type: playbook
    task:
      id: 048d8d85-9980-4c99-8f0c-6ec470790f3c
      version: -1
      name: Active Directory - Get User Manager Details
      description: ''
      playbookName: Active Directory - Get User Manager Details
      type: playbook
      iscommand: false
      brand: ''
    nexttasks:
      '#none#':
      - '5'
    scriptarguments:
      UserEmail:
        simple: ${incident.labels.actor}
      Username: {}
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ''
      wait: 1
    view: |-
      {
        "position": {
          "x": 735,
          "y": 260
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  '26':
    id: '26'
    taskid: 31971cff-2b6f-43e3-81b5-6e21f0bebc18
    type: regular
    task:
      id: 31971cff-2b6f-43e3-81b5-6e21f0bebc18
      version: -1
      name: Close Incident
      description: ''
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - '10'
    scriptarguments:
      assetid: {}
      closeNotes: {}
      closeReason: {}
      code42alerttype: {}
      emailclassification: {}
      id: {}
      phishingsubtype: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2680
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  '27':
    id: '27'
    taskid: ffcbeb49-e65c-4a55-88c3-379f397038a7
    type: condition
    task:
      id: ffcbeb49-e65c-4a55-88c3-379f397038a7
      version: -1
      name: Confirm Network Contain
      type: condition
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#default#':
      - '30'
      'Yes':
      - '32'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1115,
          "y": 1580
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  '28':
    id: '28'
    taskid: 89f7c480-e5b5-451d-8b7f-71173d1d7e6e
    type: condition
    task:
      id: 89f7c480-e5b5-451d-8b7f-71173d1d7e6e
      version: -1
      name: Does Hostname Exist?
      type: condition
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      'yes':
      - '11'
    separatecontext: false
    conditions:
    - label: 'yes'
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: incident
                filters:
                - - operator: isExists
                    left:
                      value:
                        simple: incident.code42fileevents.oshostname
                      iscontext: true
                accessor: code42fileevents.oshostname
                transformers:
                - operator: uniq
            iscontext: true
    view: |-
      {
        "position": {
          "x": 990,
          "y": 1020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  '29':
    id: '29'
    taskid: a5672e94-6a8c-408e-8692-bbb309445390
    type: regular
    task:
      id: a5672e94-6a8c-408e-8692-bbb309445390
      version: -1
      name: Send email to manager
      description: ''
      script: '|||send-mail'
      type: regular
      iscommand: true
      brand: ''
    nexttasks:
      '#none#':
      - '30'
    scriptarguments:
      additionalHeader: {}
      attachCIDs: {}
      attachIDs: {}
      attachNames: {}
      bcc: {}
      body:
        simple: |-
          Data exfiltration activity has been detected by Code42 for user ${incident.labels.actor}. File exfiltration details:

          Files:
          ${incident.code42fileevents.filename}

          Paths:
          ${incident.code42fileevents.filepath}

          Exposures:
          ${incident.code42fileevents.exposure}

          If you have access to Demisto, you can view the incident details at ${inputs.DemistoInstanceURL}#/incident/${incident.id}
      cc: {}
      htmlBody: {}
      raw_message: {}
      replyTo: {}
      subject:
        simple: ${incident.name}
      templateParams: {}
      to:
        simple: ${UserManagerEmail}
      transientFile: {}
      transientFileCID: {}
      transientFileContent: {}
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1590,
          "y": 1710
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  '30':
    id: '30'
    taskid: b7694500-9c25-4a86-8033-aa4f8d07e99a
    type: regular
    task:
      id: b7694500-9c25-4a86-8033-aa4f8d07e99a
      version: -1
      name: Confirm Remediation Is Complete
      type: regular
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '9'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 710,
          "y": 2080
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  '31':
    id: '31'
    taskid: d467f47c-af70-46bb-8080-cf1ddab4d7ef
    type: condition
    task:
      id: d467f47c-af70-46bb-8080-cf1ddab4d7ef
      version: -1
      name: Determine if too many hosts will be contained
      type: condition
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#default#':
      - '27'
      'yes':
      - '30'
    separatecontext: false
    conditions:
    - label: 'yes'
      condition:
      - - operator: greaterThan
          left:
            value:
              complex:
                root: CrowdStrike
                accessor: Device.ID
                transformers:
                - operator: count
            iscontext: true
          right:
            value:
              simple: inputs.ContainHostsMax
            iscontext: true
    view: |-
      {
        "position": {
          "x": 990,
          "y": 1360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  '32':
    id: '32'
    taskid: 6c6e0dc7-d9a4-4368-8868-a2acb0335ac4
    type: regular
    task:
      id: 6c6e0dc7-d9a4-4368-8868-a2acb0335ac4
      version: -1
      name: CrowdStrike Network Contain
      description: ''
      script: '|||cs-falcon-contain-host'
      type: regular
      iscommand: true
      brand: ''
    nexttasks:
      '#none#':
      - '30'
    scriptarguments:
      ids:
        simple: ${CrowdStrike.Device.ID}
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1115,
          "y": 1805
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 3060,
        "width": 1920,
        "x": 50,
        "y": -90
      }
    }
  }
inputs:
- key: JiraProject
  value:
    simple: Security
  required: false
  description: Jira Project for created incident ticket
- key: JiraType
  value:
    simple: Investigation
  required: false
  description: Type of Jira ticket to create
- key: JiraSummary
  value:
    simple: Code42 Security Alert for Demisto Incident ${incident.id}
  required: false
  description: Summary to use with Jira ticket creation
- key: ContainHostsMax
  value:
    simple: '2'
  required: false
  description: Maximum number of network hosts to contain.
- key: DemistoInstanceURL
  value:
    simple: https://sardan.demisto.works/
  required: false
  description: URL of Demisto instance for emails.
outputs: []
fromversion: 5.0.0
tests:
- No Test
