commonfields:
  id: IAMIntegrationCount
  version: -1
name: IAMIntegrationCount
script: |-
  from operator import itemgetter

  iam_brands_with_non_iam_category = ['Active Directory Query v2']

  integrations = set([])

  all_instances = demisto.getModules()

  for instance_name, details in all_instances.items():
    if (details.get('category') == 'Identity and Access Management' or details.get('brand') in iam_brands_with_non_iam_category) and details.get('state') == 'active':
        integrations.add(details.get('brand'))

  return_outputs(len(integrations))
type: python
comment: Returns the number of active IAM integrations.
tags:
- widget
- IAM
enabled: true
scripttarget: 0
subtype: python3
runonce: false
dockerimage: demisto/python3:3.10.12.68300
runas: DBotWeakRole
fromversion: 5.0.0
tests:
- No tests (auto formatted)
