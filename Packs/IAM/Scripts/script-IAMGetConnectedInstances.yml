commonfields:
  id: IAMGetConnectedInstances
  version: -1
name: IAMGetConnectedInstances
script: |
  incident = demisto.incidents()[0]
  custom_fields = incident.get('CustomFields', {})
  okta_iam_instance = custom_fields.get('oktaiaminstance')
  configuration = demisto.executeCommand('okta-iam-get-configuration', {'using': okta_iam_instance})[0]["Contents"]
  if not configuration:
      configuration = []
  unavailable_instances = [conf.get('Instance') for conf in configuration]

  demisto.results({"hidden": False, "options": sorted(unavailable_instances)})
type: python
tags:
- field-display
comment: Returns a list of IAM instances connected to Okta applications.
enabled: true
args:
- name: incident
  description: Incident object
- name: field
  description: Field definition object
scripttarget: 0
subtype: python3
dockerimage: demisto/python3:3.9.8.24399
runonce: false
runas: DBotWeakRole
fromversion: 6.0.0
tests:
- No tests
