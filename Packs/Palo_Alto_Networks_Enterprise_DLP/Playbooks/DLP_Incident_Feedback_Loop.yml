id: DLP Incident Feedback Loop
version: -1
fromversion: 6.0.0
name: DLP Incident Feedback Loop
description: Collect feedback from user about blocked files
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: e0772674-d7ff-43df-8075-a871655a3f9b
    type: start
    task:
      id: e0772674-d7ff-43df-8075-a871655a3f9b
      version: -1
      name: start_task
      description: ""
      type: start
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 920,
          "y": 65
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: cac60ef4-98d1-49ad-887a-79fe899dab4a
    type: regular
    task:
      id: cac60ef4-98d1-49ad-887a-79fe899dab4a
      version: -1
      name: Set feedback to "true positive"
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "29"
    scriptarguments:
      dlpincidentfeedback:
        simple: CONFIRMED_SENSITIVE
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 310,
          "y": 1440
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: 6f8e5938-6e7c-4955-8bea-512f3bd07891
    type: condition
    task:
      id: 6f8e5938-6e7c-4955-8bea-512f3bd07891
      version: -1
      name: Is Slack v3 enabled?
      description: Checks whether the Slack V2 integration is enabled.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "11"
      "yes":
      - "25"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: SlackV3
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
    view: |-
      {
        "position": {
          "x": 920,
          "y": 225
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: b1d07087-5ef5-40f1-8fd9-1d24294ddf53
    type: title
    task:
      id: b1d07087-5ef5-40f1-8fd9-1d24294ddf53
      version: -1
      name: Done
      description: ""
      type: title
      iscommand: false
      brand: ""
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 990,
          "y": 3100
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: 1b2a19fa-2940-4268-8ac2-b279918bb8cc
    type: regular
    task:
      id: 1b2a19fa-2940-4268-8ac2-b279918bb8cc
      version: -1
      name: Set feedback to "false positive"
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "29"
    scriptarguments:
      dlpincidentfeedback:
        simple: CONFIRMED_FALSE_POSITIVE
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -210,
          "y": 1440
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: fb9e8768-7884-46c2-840d-e894cfc488d3
    type: condition
    task:
      id: fb9e8768-7884-46c2-840d-e894cfc488d3
      version: -1
      name: Received feedback
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "12"
      "Yes":
      - "4"
    separatecontext: false
    sla:
      hours: 6
      days: 0
      weeks: 0
    slareminder:
      hours: 1
      days: 0
      weeks: 0
    view: |-
      {
        "position": {
          "x": 70,
          "y": 1160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: 5d2eab81-a9b9-436e-86f1-c281f0d12e27
    type: condition
    task:
      id: 5d2eab81-a9b9-436e-86f1-c281f0d12e27
      version: -1
      name: Save feedback failed?
      description: Check whether given entry/entries returned an error. Use ${lastCompletedTaskEntries}
        to check the previous task entries. If array is provided, will return yes
        if one of the entries returned an error.
      scriptName: isError
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "37"
      "yes":
      - "22"
    scriptarguments:
      entryId:
        simple: ${lastCompletedTaskEntries}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 70,
          "y": 1795
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: 16ed8716-3138-4089-8064-51235ae7a86d
    type: regular
    task:
      id: 16ed8716-3138-4089-8064-51235ae7a86d
      version: -1
      name: 'send-mail '
      description: Send an email
      script: Mail Sender (New)|||send-mail
      type: regular
      iscommand: true
      brand: Mail Sender (New)
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      body:
        simple: XSOAR playbook failed to save "False Positive" feedback for user ${Slack.User.Name}
          ${incident.sourceusername} for DLP Incident ${incident.dlpincidentid}, Tenant
          ID ${incident.dlptenantid}
      subject:
        simple: XSOAR Playbook Error
      to:
        simple: dlp-feedback@paloaltonetworks.com
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -580,
          "y": 2830
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: ea098652-e80e-49de-87cb-a7b66041db8f
    type: regular
    task:
      id: ea098652-e80e-49de-87cb-a7b66041db8f
      version: -1
      name: Find user on slack
      description: Get details about a specified user.
      script: SlackV3|||slack-get-user-details
      type: regular
      iscommand: true
      brand: SlackV3
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      user:
        simple: ${incident.sourceusername}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 520,
          "y": 410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: 4a3bbd9f-7fa3-42c0-872e-a48f48d6583e
    type: condition
    task:
      id: 4a3bbd9f-7fa3-42c0-872e-a48f48d6583e
      version: -1
      name: User exists on Slack?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "11"
      "yes":
      - "33"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: Slack.User.ID
            iscontext: true
    view: |-
      {
        "position": {
          "x": 520,
          "y": 565
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: 9b56062e-8f86-4924-827e-b86ba6b9c3d8
    type: regular
    task:
      id: 9b56062e-8f86-4924-827e-b86ba6b9c3d8
      version: -1
      name: 'Set feedback status to "Pending" '
      description: Update a DLP incident with user feedback
      script: '|||pan-dlp-update-incident'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "17"
    scriptarguments:
      feedback:
        simple: PENDING_RESPONSE
      incident_id:
        simple: ${incident.dlpincidentid}
      region:
        simple: us
      user_id:
        simple: ${incident.sourceusername}
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 70,
          "y": 970
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: abd93cd3-0cdf-4cd4-84f7-bc82f928ff84
    type: regular
    task:
      id: abd93cd3-0cdf-4cd4-84f7-bc82f928ff84
      version: -1
      name: Save feedback to DLP
      description: Update a DLP incident with user feedback
      script: '|||pan-dlp-update-incident'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "21"
    scriptarguments:
      feedback:
        simple: ${incident.dlpincidentfeedback}
      incident_id:
        simple: ${incident.dlpincidentid}
      region:
        simple: us
      user_id:
        simple: ${incident.sourceusername}
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 70,
          "y": 1630
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: 2d9c8b1f-33e3-48b0-872a-ff71cd6e3c53
    type: regular
    task:
      id: 2d9c8b1f-33e3-48b0-872a-ff71cd6e3c53
      version: -1
      name: Close Incident
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      id:
        complex:
          root: incident
          accessor: id
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 290,
          "y": 2860
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: 6d395e50-702d-4612-8cb4-9d333a9e2bf0
    type: regular
    task:
      id: 6d395e50-702d-4612-8cb4-9d333a9e2bf0
      version: -1
      name: Ask user if file contains sensitive info
      scriptName: DlpAskFeedback
      type: regular
      iscommand: false
      brand: SlackV3
    nexttasks:
      '#none#':
      - "27"
    scriptarguments:
      app_name:
        simple: Office 365
      data_profile_name:
        simple: Catch All Leaks
      file_name:
        simple: ${incident.filename}
      task:
        simple: "17"
      user:
        simple: ${Slack.User.Email}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 70,
          "y": 770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: 40a6530f-29fc-4ea0-8c0c-47b2f51f4d0b
    type: condition
    task:
      id: 40a6530f-29fc-4ea0-8c0c-47b2f51f4d0b
      version: -1
      name: Ask the user if exemption needed?
      description: Sends a message (question) to either user (in a direct message)
        or to a channel. The message includes predefined reply options. The response
        can also close a task (might be conditional) in a playbook.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "31"
      "Yes":
      - "35"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 270,
          "y": 2310
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
        simple: ${Slack.User.Email}
      subject: null
      body:
        simple: Do you want to request a temporary exemption?
      methods:
      - SlackV3
      format: ""
      bcc: null
      cc: null
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
      replyOptions:
      - "Yes"
      - "No"
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: af364e17-5d25-4733-8e92-be365a47bb14
    type: regular
    task:
      id: af364e17-5d25-4733-8e92-be365a47bb14
      version: -1
      name: Save feedback to DLP
      description: Update a DLP incident with user feedback
      script: '|||pan-dlp-update-incident'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "36"
    scriptarguments:
      feedback:
        simple: ${incident.dlpincidentfeedback}
      incident_id:
        simple: ${incident.dlpincidentid}
      region:
        simple: us
      user_id:
        simple: ${incident.sourceusername}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -60,
          "y": 2480
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: c0a65af7-2d35-4c94-8752-cb7626afeb55
    type: condition
    task:
      id: c0a65af7-2d35-4c94-8752-cb7626afeb55
      version: -1
      name: Save feedback failed?
      description: Check whether given entry/entries returned an error. Use ${lastCompletedTaskEntries}
        to check the previous task entries. If array is provided, will return yes
        if one of the entries returned an error.
      scriptName: isError
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "31"
      "yes":
      - "22"
    scriptarguments:
      entryId:
        simple: ${lastCompletedTaskEntries}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -60,
          "y": 2660
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: 33e72024-f0bd-412a-88e1-fb927b2db435
    type: regular
    task:
      id: 33e72024-f0bd-412a-88e1-fb927b2db435
      version: -1
      name: Get eligibility for exemption
      description: Determines if exemption can be granted on incidents from a certain
        data profile
      script: '|||pan-dlp-exemption-eligible'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "38"
    scriptarguments:
      data_profile:
        simple: ${incident.dlpdataprofilename}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 280,
          "y": 1980
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: a8af95e1-af99-4500-8254-04392bb8a43c
    type: condition
    task:
      id: a8af95e1-af99-4500-8254-04392bb8a43c
      version: -1
      name: Is eligible?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "31"
      "yes":
      - "34"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isTrue
          left:
            value:
              simple: DLP.exemption.eligible
            iscontext: true
    view: |-
      {
        "position": {
          "x": 280,
          "y": 2130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "10_11_#default#": 0.48,
      "10_25_yes": 0.52,
      "17_12_#default#": 0.72,
      "17_4_Yes": 0.6
    },
    "paper": {
      "dimensions": {
        "height": 3100,
        "width": 1950,
        "x": -580,
        "y": 65
      }
    }
  }
inputs:
- key: UsernameOrEmail
  value:
    complex:
      root: incident
      accessor: sourceusername
  required: true
  description: The username or the email address of the user whose file upload triggered
    the incident
  playbookInputQuery: null
outputs: []
tests:
  - No test
