id: DLP Incident Feedback Loop
version: -1
fromversion: 6.0.0
name: DLP Incident Feedback Loop
description: Collect feedback from user about blocked files
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: e0772674-d7ff-43df-8075-a871655a3f9b
    type: start
    task:
      id: e0772674-d7ff-43df-8075-a871655a3f9b
      version: -1
      name: start_task
      description: ""
      type: start
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 920,
          "y": 65
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: cac60ef4-98d1-49ad-887a-79fe899dab4a
    type: regular
    task:
      id: cac60ef4-98d1-49ad-887a-79fe899dab4a
      version: -1
      name: Set feedback to "true positive"
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "29"
    scriptarguments:
      dlpincidentfeedback:
        simple: CONFIRMED_SENSITIVE
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 110,
          "y": 1450
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: 6f8e5938-6e7c-4955-8bea-512f3bd07891
    type: condition
    task:
      id: 6f8e5938-6e7c-4955-8bea-512f3bd07891
      version: -1
      name: Is Slack v3 enabled?
      description: Checks whether the Slack V2 integration is enabled.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "11"
      "yes":
      - "25"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: SlackV3
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
    view: |-
      {
        "position": {
          "x": 920,
          "y": 225
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: b1d07087-5ef5-40f1-8fd9-1d24294ddf53
    type: title
    task:
      id: b1d07087-5ef5-40f1-8fd9-1d24294ddf53
      version: -1
      name: Done
      description: ""
      type: title
      iscommand: false
      brand: ""
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1000,
          "y": 2240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: 1b2a19fa-2940-4268-8ac2-b279918bb8cc
    type: regular
    task:
      id: 1b2a19fa-2940-4268-8ac2-b279918bb8cc
      version: -1
      name: Set feedback to "false positive"
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "29"
    scriptarguments:
      dlpincidentfeedback:
        simple: CONFIRMED_FALSE_POSITIVE
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -400,
          "y": 1440
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 5df39ca8-1e5b-4cb1-8e83-dd8e56fef7eb
    type: regular
    task:
      id: 5df39ca8-1e5b-4cb1-8e83-dd8e56fef7eb
      version: -1
      name: Ask user for feedback with 2 options
      description: ""
      scriptName: DlpAskFeedback
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "27"
    scriptarguments:
      execution-timeout:
        simple: "900"
      feedback_options:
        simple: True_Positive,False_Positive
      file_name:
        simple: ${incident.filename}
      policy_name:
        simple: ${incident.dlpdataprofilename}
      task:
        simple: "17"
      user:
        simple: ${incident.sourceusername}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -170,
          "y": 920
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: fb9e8768-7884-46c2-840d-e894cfc488d3
    type: condition
    task:
      id: fb9e8768-7884-46c2-840d-e894cfc488d3
      version: -1
      name: Received feedback
      description: ""
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "18"
      False_Positive:
      - "12"
      True_Positive:
      - "4"
    separatecontext: false
    sla:
      hours: 6
      days: 0
      weeks: 0
    slareminder:
      hours: 1
      days: 0
      weeks: 0
    view: |-
      {
        "position": {
          "x": 150,
          "y": 1240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: b4035c3e-b25a-4f07-8c8e-664448f64e42
    type: regular
    task:
      id: b4035c3e-b25a-4f07-8c8e-664448f64e42
      version: -1
      name: Set feedback to "true positive" and create exemption
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "29"
    scriptarguments:
      dlpincidentfeedback:
        simple: EXCEPTION_REQUESTED
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 540,
          "y": 1465
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: f3905774-abba-4988-896d-b018b8358419
    type: condition
    task:
      id: f3905774-abba-4988-896d-b018b8358419
      version: -1
      name: Save "false positive" feedback failed?
      description: Check whether given entry/entries returned an error. Use ${lastCompletedTaskEntries}
        to check the previous task entries. If array is provided, will return yes
        if one of the entries returned an error.
      scriptName: isError
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "11"
      "yes":
      - "22"
    scriptarguments:
      entryId:
        simple: ${lastCompletedTaskEntries}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 40,
          "y": 1785
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: 28846c82-eba3-4715-8f8f-20ab89a63a40
    type: regular
    task:
      id: 28846c82-eba3-4715-8f8f-20ab89a63a40
      version: -1
      name: 'send-mail '
      description: Send an email
      script: Mail Sender (New)|||send-mail
      type: regular
      iscommand: true
      brand: Mail Sender (New)
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      body:
        simple: XSOAR playbook failed to save "False Positive" feedback for user ${Slack.User.Name}
          ${incident.sourceusername} for DLP Incident ${incident.dlpincidentid}, Tenant
          ID ${incident.dlptenantid}
      subject:
        simple: XSOAR Playbook Error
      to:
        simple: hsue@paloaltonetworks.com
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -250,
          "y": 1980
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: ea098652-e80e-49de-87cb-a7b66041db8f
    type: regular
    task:
      id: ea098652-e80e-49de-87cb-a7b66041db8f
      version: -1
      name: Find user on slack
      description: Get details about a specified user.
      script: SlackV3|||slack-get-user-details
      type: regular
      iscommand: true
      brand: SlackV3
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      user:
        simple: ${incident.sourceusername}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 520,
          "y": 410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: 4a3bbd9f-7fa3-42c0-872e-a48f48d6583e
    type: condition
    task:
      id: 4a3bbd9f-7fa3-42c0-872e-a48f48d6583e
      version: -1
      name: User exists on Slack?
      description: ""
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "11"
      "yes":
      - "28"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: Slack.User.ID
            iscontext: true
    view: |-
      {
        "position": {
          "x": 520,
          "y": 565
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: 9b56062e-8f86-4924-827e-b86ba6b9c3d8
    type: regular
    task:
      id: 9b56062e-8f86-4924-827e-b86ba6b9c3d8
      version: -1
      name: 'Set feedback status to "Pending" '
      description: Update a DLP incident with user feedback
      script: '|||pan-dlp-update-incident'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "17"
    scriptarguments:
      feedback:
        simple: PENDING_RESPONSE
      incident_id:
        simple: ${incident.dlpincidentid}
      region:
        simple: us
      user_id:
        simple: ${incident.sourceusername}
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 100,
          "y": 1100
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 16cf7abd-a990-48f1-89f3-2f2940cd58ff
    type: condition
    task:
      id: 16cf7abd-a990-48f1-89f3-2f2940cd58ff
      version: -1
      name: Credit Card Data Profile?
      description: ""
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "30"
      "yes":
      - "16"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: containsString
          left:
            value:
              simple: incident.dlpdataprofilename
            iscontext: true
          right:
            value:
              simple: Credit Card
    view: |-
      {
        "position": {
          "x": 150,
          "y": 745
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: b3f78016-9c4e-4fdf-8820-6fc0c4187297
    type: regular
    task:
      id: b3f78016-9c4e-4fdf-8820-6fc0c4187297
      version: -1
      name: Save feedback to DLP
      description: Update a DLP incident with user feedback
      script: '|||pan-dlp-update-incident'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "21"
    scriptarguments:
      feedback:
        simple: ${incident.dlpincidentfeedback}
      incident_id:
        simple: ${incident.dlpincidentid}
      region:
        simple: us
      user_id:
        simple: ${incident.sourceusername}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 70,
          "y": 1630
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: dba1643e-2715-46c3-8e55-0812aa65a37f
    type: regular
    task:
      id: dba1643e-2715-46c3-8e55-0812aa65a37f
      version: -1
      name: Ask user for feedback with 3 options
      description: ""
      scriptName: DlpAskFeedback
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "27"
    scriptarguments:
      execution-timeout:
        simple: "900"
      feedback_options:
        simple: True_Positive,False_Positive,Request_Exemption
      file_name:
        simple: ${incident.filename}
      policy_name:
        simple: ${incident.dlpdataprofilename}
      task:
        simple: "17"
      user:
        simple: ${incident.sourceusername}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 330,
          "y": 920
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "10_11_#default#": 0.48,
      "10_25_yes": 0.52,
      "17_18_#default#": 0.79,
      "17_4_True_Positive": 0.6,
      "21_11_#default#": 0.12
    },
    "paper": {
      "dimensions": {
        "height": 2240,
        "width": 1780,
        "x": -400,
        "y": 65
      }
    }
  }
inputs:
- key: UsernameOrEmail
  value:
    complex:
      root: incident
      accessor: sourceusername
  required: true
  description: The username or the email address of the user whose file upload triggered
    the incident
  playbookInputQuery: null
outputs: []
tests:
  - No test
