description: "This playbook executes hygiene check commands using the PAN-OS integration and identifies items configured in a manner that do not meet minimum security best practices.  It looks for the following:\n1. Log Forwarding Profiles\n  i. Profiles without Enhanced Logging enabled\n  ii. Profiles with no match list (rules) configured\n  iii. Profiles that do not include rules to forward Traffic or Threat logs\n2. Security Zones with no Log Forwarding Profile assigned\n3. Spyware Profiles that do not:\n  i. Block signatures of Critical and High severity\n  ii. Alert on (or block) signatures of Medium and Low severity\n4. URL Filtering Profiles do not block the default URL categories blocked in the pre-defined profile\n5. Vulnerability Profiles that do not:\n  i. Block signatures of Critical and High severity\n  ii. Alert on (or block) signatures of Medium and Low severity\n6. Security Rules that do not:\n  i. Log at Session End\n  ii. Have a Log Forwarding Profile assigned\n  iii. Have Security Profiles assigned for Anti Virus, Spyware, Vulnerability, and URL Filtering (or a group that includes each)\n\nNOTE: This playbook is intended for use with a single PAN-OS Integration Instance."
id: PAN-OS - Run Security Configuration Hygiene Checks
inputSections:
- description: Generic group for inputs
  inputs:
  - targetDevice
  name: General (Inputs group)
inputs:
- description: "The serial number of a specific firewall to target (Used when connected to Panorama) [Optional].\n\nWhen connected to Panorama, leaving this blank will run the checks against Panorama configuration as well as all currently connected managed firewalls."
  key: targetDevice
  playbookInputQuery:
  required: false
  value: {}
name: PAN-OS - Run Security Configuration Hygiene Checks
outputSections:
- description: Generic group for outputs
  name: General (Outputs group)
  outputs:
  - Summary
  - Result
outputs:
- contextPath: Summary
  description: A list of hygiene check summaries (constructed as dictionaries) describing the overall result of hygiene checks and how many issues of each type were found, if any.
  type: unknown
- contextPath: Result
  description: A list of hygiene check results (constructed as dictionaries) including a description of the issue found, the configuration location (container name), and the name of the object affected by the issue.
  type: unknown
starttaskid: '0'
tasks:
  '0':
    continueonerrortype: ''
    id: '0'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '1'
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 257a493e-7e6a-4096-8f4d-62a0dcbab700
      iscommand: false
      name: ''
      version: -1
      description: ''
    taskid: 257a493e-7e6a-4096-8f4d-62a0dcbab700
    timertriggers: []
    type: start
    view: "{\n  \"position\": {\n    \"x\": 449,\n    \"y\": 30\n  }\n}"
  '1':
    continueonerrortype: ''
    id: '1'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '3'
    note: false
    quietmode: 0
    scriptarguments:
      device_filter_string:
        simple: ${inputs.targetDevice}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Checks that at least one log forwarding profile is configured according to best practices.
      id: a1a350a4-fee2-4577-a09d-5cd8ddcbf7a9
      iscommand: true
      name: Check Log Forwarding
      script: '|||pan-os-hygiene-check-log-forwarding'
      type: regular
      version: -1
    taskid: a1a350a4-fee2-4577-a09d-5cd8ddcbf7a9
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 449,\n    \"y\": 216\n  }\n}"
  '2':
    continueonerrortype: ''
    id: '2'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '8'
    note: false
    quietmode: 0
    scriptarguments:
      device_filter_string:
        simple: ${inputs.targetDevice}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Checks that security rules are configured correctly.
      id: e8d4d348-3d41-4988-86c2-38cbf0ec6d02
      iscommand: true
      name: Check Security Rules
      script: '|||pan-os-hygiene-check-security-rules'
      type: regular
      version: -1
    taskid: e8d4d348-3d41-4988-86c2-38cbf0ec6d02
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 449,\n    \"y\": 1095\n  }\n}"
  '3':
    continueonerrortype: ''
    id: '3'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '4'
    note: false
    quietmode: 0
    scriptarguments:
      device_filter_string:
        simple: ${inputs.targetDevice}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Checks that configured security zones have correct settings.
      id: c7224c04-403e-4bc1-85e2-83dcf5d11df4
      iscommand: true
      name: Check Security Zones
      script: '|||pan-os-hygiene-check-security-zones'
      type: regular
      version: -1
    taskid: c7224c04-403e-4bc1-85e2-83dcf5d11df4
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 449,\n    \"y\": 384\n  }\n}"
  '4':
    continueonerrortype: ''
    id: '4'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '5'
    note: false
    quietmode: 0
    scriptarguments:
      device_filter_string:
        simple: ${inputs.targetDevice}
      return_nonconforming_profiles:
        simple: yes
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Checks the configured anti-spyware profiles to ensure at least one meets best practices.
      id: da4a28ec-6f5a-4daf-a1ec-f5abd92fcf9e
      iscommand: true
      name: Check Spyware Profiles
      script: '|||pan-os-hygiene-check-spyware-profiles'
      type: regular
      version: -1
    taskid: da4a28ec-6f5a-4daf-a1ec-f5abd92fcf9e
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 449,\n    \"y\": 565\n  }\n}"
  '5':
    continueonerrortype: ''
    id: '5'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '6'
    note: false
    quietmode: 0
    scriptarguments:
      device_filter_string:
        simple: ${inputs.targetDevice}
      return_nonconforming_profiles:
        simple: yes
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Checks the configured URL filtering profiles to ensure at least one meets best practices.
      id: cfe7ecd9-26d7-4b73-ade4-26216c0ca5c4
      iscommand: true
      name: Check URL Filtering Profiles
      script: '|||pan-os-hygiene-check-url-filtering-profiles'
      type: regular
      version: -1
    taskid: cfe7ecd9-26d7-4b73-ade4-26216c0ca5c4
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 449,\n    \"y\": 745\n  }\n}"
  '6':
    continueonerrortype: ''
    id: '6'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '2'
    note: false
    quietmode: 0
    scriptarguments:
      device_filter_string:
        simple: ${inputs.targetDevice}
      return_nonconforming_profiles:
        simple: yes
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: Checks the configured vulnerability profiles to ensure at least one meets best practices.
      id: ecfe90f2-1b42-4212-9943-4d84df7e993b
      iscommand: true
      name: Check Vulnerability Profiles
      script: '|||pan-os-hygiene-check-vulnerability-profiles'
      type: regular
      version: -1
    taskid: ecfe90f2-1b42-4212-9943-4d84df7e993b
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 449,\n    \"y\": 925\n  }\n}"
  '7':
    continueonerrortype: ''
    id: '7'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      id: 463a7f89-e3ed-4010-bc9e-d65b77f345e3
      iscommand: false
      name: Done
      type: title
      version: -1
      description: ''
    taskid: 463a7f89-e3ed-4010-bc9e-d65b77f345e3
    timertriggers: []
    type: title
    view: "{\n  \"position\": {\n    \"x\": 449,\n    \"y\": 1600\n  }\n}"
  '8':
    continueonerrortype: ''
    id: '8'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '15'
    note: false
    quietmode: 0
    scriptarguments:
      force:
        simple: 'true'
      key:
        simple: Summary
      value:
        complex:
          accessor: Summary
          root: PANOS.ConfigurationHygiene
          transformers:
          - operator: StringifyArray
          - args:
              regex:
                value:
                  simple: \x{274c}
              replaceWith:
                value:
                  simple: Failed
            operator: replaceMatch
          - args:
              regex:
                value:
                  simple: \x{2714}\x{fe0f}
              replaceWith:
                value:
                  simple: Passed
            operator: replaceMatch
          - operator: ParseJSON
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      id: f3e84447-de99-446e-8c21-641f7cbe5209
      iscommand: false
      name: Combine Summary Entries
      script: SetAndHandleEmpty
      type: regular
      version: -1
    taskid: f3e84447-de99-446e-8c21-641f7cbe5209
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 449,\n    \"y\": 1265\n  }\n}"
  '15':
    continueonerrortype: ''
    id: '15'
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - '7'
    note: false
    quietmode: 0
    scriptarguments:
      append:
        simple: 'false'
      force:
        simple: 'true'
      key:
        simple: Result
      value:
        simple: ${PANOS.ConfigurationHygiene.Result}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ''
      description: "Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.\n\nThis automation runs using the default Limited User role, unless you explicitly change the permissions.\nFor more information, see the section about permissions here:\n- For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations \n- For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script\n- For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script"
      id: fc943a5e-49c3-4b45-ba0a-de06135a6a5a
      iscommand: false
      name: Combine Results Entries
      script: SetAndHandleEmpty
      type: regular
      version: -1
    taskid: fc943a5e-49c3-4b45-ba0a-de06135a6a5a
    timertriggers: []
    type: regular
    view: "{\n  \"position\": {\n    \"x\": 449,\n    \"y\": 1440\n  }\n}"
version: -1
view: "{\n  \"linkLabelsPosition\": {},\n  \"paper\": {\n    \"dimensions\": {\n      \"height\": 1630,\n      \"width\": 380,\n      \"x\": 449,\n      \"y\": 30\n    }\n  }\n}"
fromversion: 6.10.0
tests:
- PAN-OS-panorama-topology-test-pb
- PAN-OS-firewall-topology-test-pb
