id: Handle Expanse Incident
version: -1
contentitemexportablefields:
  contentitemfields: {}
name: Handle Expanse Incident
description: |-
  Main Playbook to Handle Expanse Incidents.

  There are several phases:
  1. Enrichment: all the related information from the incident is extracted and related Indicators (of types IP, CIDR, Domain, DomainGlob, Certificate) are created and enriched.
  2. Validation: the found IP and FQDN are correlated with the information available in other products:
    - Firewall logs from Cortex Data Lake, Panorama and Splunk
    - User information from Active Directory
    - Public IP address from AWS/GCP/Azure public IP feeds to identify the Public Cloud region and Service (i.e. us-west-1 on AWS EC2)
    - IP and FQDN from Prisma Cloud inventory
  3. Shadow IT check: based on the information found, the playbook can suggest whether the discovered issue corresponds to an asset that is known to the InfoSec team (i.e. there are firewall logs present, or the asset is protected by Prisma Cloud, or is part of an IP range associated to the Company).
  4. Attribution: based on the information collected above, the Analyst is prompted to assign this issue to an Organization Unit, that is a group within the Company with a specific owner. The Analyst can choose from existing Organization Units (stored in an XSOAR list) or define a new one.
  5. Response: depending on the issue type, several remediation actions can be automatically and manually performed, such as:
      - Tagging the asset in Expanse with a specific Organization Unit tag
      - Blocking the service on PAN-OS (if a Firewall is deployed in front of the service)
      - Creating a new Shadow IT issue (if the asset is detected to be Shadow IT and the Analyst confirms it)
      - Adding the service to a Vulnerability Management system
      - Linking the incident to a related Prisma Cloud alert for the asset (if the asset is found under Prisma Cloud inventory)
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: d6603c1e-8927-4351-8bba-a691699a9e80
    type: start
    task:
      id: d6603c1e-8927-4351-8bba-a691699a9e80
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "163"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1327.5,
          "y": -2180
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "1":
    id: "1"
    taskid: aeb934d7-4d22-4a8f-813c-c9be6bf30d50
    type: condition
    task:
      id: aeb934d7-4d22-4a8f-813c-c9be6bf30d50
      version: -1
      name: Are there Expanse Asset Tags for this incident?
      description: Check whether Expanse Asset tags are present in this incident.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "3"
      "yes":
      - "2"
    separatecontext: false
    defaultassigneecomplex: {}
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: ExpanseDeviceGroupAssetTags
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1960,
          "y": 6575
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "2":
    id: "2"
    taskid: 3a5cd259-6d2e-45a3-89c7-cd76b78477e8
    type: title
    task:
      id: 3a5cd259-6d2e-45a3-89c7-cd76b78477e8
      version: -1
      name: Use Device Groups from Expanse Asset Tags
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "11"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2330,
          "y": 6745
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "3":
    id: "3"
    taskid: facd19b0-8ad6-4f2d-8908-19cd6e123bf9
    type: title
    task:
      id: facd19b0-8ad6-4f2d-8908-19cd6e123bf9
      version: -1
      name: Search Device Groups from Logs
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "4"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1717.5,
          "y": 6745
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "4":
    id: "4"
    taskid: 16844f2c-ec1c-4f1a-8034-337356f26b9a
    type: regular
    task:
      id: 16844f2c-ec1c-4f1a-8034-337356f26b9a
      version: -1
      name: Find Possible Device Groups
      description: Set a value in context under the key you entered. If no value is
        entered, the script doesn't do anything.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "15"
    scriptarguments:
      append: {}
      key:
        simple: TargetFirewalls
      stringify: {}
      value:
        complex:
          root: Expanse.AttributionDevice
          filters:
          - - operator: isTrue
              left:
                value:
                  simple: Expanse.AttributionDevice.exposing_service
                iscontext: true
              ignorecase: true
          - - operator: greaterThan
              left:
                value:
                  simple: Expanse.AttributionDevice.sightings
                iscontext: true
              right:
                value:
                  simple: "0"
          transformers:
          - operator: Stringify
          - operator: replace
            args:
              limit: {}
              replaceWith:
                value:
                  simple: devicegroup
              toReplace:
                value:
                  simple: device-group
          - operator: ParseJSON
          - operator: jmespath
            args:
              expression:
                value:
                  simple: '{deviceGroup: devicegroup, source: ''From Logs'', sightings:sightings}'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1717.5,
          "y": 6850
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "5":
    id: "5"
    taskid: e3111605-6fdb-4d65-800a-1a67a96bbac6
    type: title
    task:
      id: e3111605-6fdb-4d65-800a-1a67a96bbac6
      version: -1
      name: Set Up Context Variables
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "12"
      - "65"
      - "173"
      - "200"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1327.5,
          "y": -1450
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "6":
    id: "6"
    taskid: c43df7ae-4309-4f32-83e4-1dd272d6fe93
    type: condition
    task:
      id: c43df7ae-4309-4f32-83e4-1dd272d6fe93
      version: -1
      name: Is Incident Priority Above AutoRemediation Threshold?
      description: Check whether incident priority is above autoremediation threshold.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "14"
      "yes":
      - "124"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: greaterThanOrEqual
          left:
            value:
              simple: incident.severity
            iscontext: true
          right:
            value:
              simple: inputs.MinPriorityForAutoRemediation
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1457.5,
          "y": 6130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "8":
    id: "8"
    taskid: b3232d6f-019b-4089-8cc3-9812eff0c605
    type: title
    task:
      id: b3232d6f-019b-4089-8cc3-9812eff0c605
      version: -1
      name: Done Network  Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "75"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1467.5,
          "y": 10475
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "9":
    id: "9"
    taskid: 8577d990-2e93-497d-82ba-cfaed45a841b
    type: condition
    task:
      id: 8577d990-2e93-497d-82ba-cfaed45a841b
      version: -1
      name: Is Issue AutoRemediable with PAN-OS? (On-Prem and has IP:Port)
      description: Check whether the issue can be auto-remediated with PAN-OS (on-prem
        and ip/port found)
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "14"
      "Yes":
      - "6"
    separatecontext: false
    conditions:
    - label: "Yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: incident
                accessor: expanseip
            iscontext: true
      - - operator: InRange
          left:
            value:
              complex:
                root: incident
                accessor: expanseport
            iscontext: true
          right:
            value:
              simple: 1,65535
      - - operator: inList
          left:
            value:
              complex:
                root: incident
                accessor: expanseprotocol
            iscontext: true
          right:
            value:
              simple: tcp,udp
          ignorecase: true
      - - operator: isEqualString
          left:
            value:
              complex:
                root: incident
                accessor: expanseprovider
            iscontext: true
          right:
            value:
              simple: On Prem
    view: |-
      {
        "position": {
          "x": 1112.5,
          "y": 5950
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "10":
    id: "10"
    taskid: 8ed9d452-9025-44f5-87a5-2fff3db57946
    type: condition
    task:
      id: 8ed9d452-9025-44f5-87a5-2fff3db57946
      version: -1
      name: Block ${incident.expanseip}:${incident.expanseport}/${incident.expanseprotocol}
        on ${TargetDG} ?
      description: Ask the user confirmation on whether blocking the service.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      ✅ Yes:
      - "24"
      ❌ No:
      - "14"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2017.5,
          "y": 9455
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "11":
    id: "11"
    taskid: 9c40a4c6-84d1-4552-86f7-916fb0eb1abf
    type: regular
    task:
      id: 9c40a4c6-84d1-4552-86f7-916fb0eb1abf
      version: -1
      name: Set Target Device Groups from Expanse Tags
      description: Set a value in context under the key you entered. If no value is
        entered, the script doesn't do anything.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "15"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: TargetFirewalls
      stringify: {}
      value:
        complex:
          root: ${
          accessor: =[]}
          transformers:
          - operator: GetValuesOfMultipleFields
            args:
              key:
                value:
                  simple: FirewallTagList
                iscontext: true
              list:
                value:
                  simple: ExpanseDeviceGroupAssetTags
                iscontext: true
          - operator: concat
            args:
              prefix:
                value:
                  simple: '{"dg":"'
              suffix:
                value:
                  simple: '"}'
          - operator: join
            args:
              separator:
                value:
                  simple: ','
          - operator: concat
            args:
              prefix:
                value:
                  simple: '['
              suffix:
                value:
                  simple: ']'
          - operator: ParseJSON
          - operator: jmespath
            args:
              expression:
                value:
                  simple: '{deviceGroup:dg, source: ''From Expanse Tags'', sightings:''N/A''}'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2330,
          "y": 6850
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "12":
    id: "12"
    taskid: 4b788497-7448-4cf6-886a-9e8089f7f4ad
    type: regular
    task:
      id: 4b788497-7448-4cf6-886a-9e8089f7f4ad
      version: -1
      name: Extract XSOAR Incident Tags from Expanse
      description: Set a value in context under the key you entered. If no value is
        entered, the script doesn't do anything.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "159"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: ExpanseXSOARIssueTags
      stringify: {}
      value:
        complex:
          root: incident.expansetags
          filters:
          - - operator: startWith
              left:
                value:
                  simple: incident.expansetags
                iscontext: true
              right:
                value:
                  simple: inputs.TagPrefix
                iscontext: true
          transformers:
          - operator: join
            args:
              separator:
                value:
                  simple: ','
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 907.5,
          "y": -1305
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "13":
    id: "13"
    taskid: b4cb5db2-020b-458a-8c68-1784345beb7f
    type: regular
    task:
      id: b4cb5db2-020b-458a-8c68-1784345beb7f
      version: -1
      name: Manual Block on Network
      description: Perform manual block on the network
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "8"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1457.5,
          "y": 9950
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "14":
    id: "14"
    taskid: 09a9e5a8-e97e-4cd8-8e54-2528b2e7e5da
    type: title
    task:
      id: 09a9e5a8-e97e-4cd8-8e54-2528b2e7e5da
      version: -1
      name: Manual Network Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "13"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1457.5,
          "y": 9730
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "15":
    id: "15"
    taskid: 28094798-b880-4195-8a15-a899c58b77f8
    type: condition
    task:
      id: 28094798-b880-4195-8a15-a899c58b77f8
      version: -1
      name: Device Groups found?
      description: Check whether a target device group is found
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "196"
      "yes":
      - "66"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: TargetFirewalls
            iscontext: true
    view: |-
      {
        "position": {
          "x": 2017.5,
          "y": 7020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "16":
    id: "16"
    taskid: 77a0e474-6109-472d-894e-002361305f06
    type: collection
    task:
      id: 77a0e474-6109-472d-894e-002361305f06
      version: -1
      name: Choose Device Group to enforce policy
      description: Ask the user on which Device Group to enforce the policy change.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "119"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2055,
          "y": 7645
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
        simple: Analyst
      subject:
        simple: Choose target Device Group
      body:
        simple: Choose target Device Group
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: What Device Group do you want to apply the configuration on?
        required: true
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - complex:
            root: FirewallTagList
            transformers:
            - operator: jmespath
              args:
                expression:
                  value:
                    simple: keys(@)
        - simple: ➕ Add New
        - simple: "\U0001F525 Firewall Only (No Panorama)"
        - simple: ❌ Manual Configuration
        fieldassociated: ""
        placeholder: ""
        tooltip: Choose Device Group
        readonly: false
      title: Choose Device Group
      description: Choose Device Group
      sender: ""
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
  "18":
    id: "18"
    taskid: 6326935d-4c96-43c5-8a47-2c2b11c241e6
    type: title
    task:
      id: 6326935d-4c96-43c5-8a47-2c2b11c241e6
      version: -1
      name: DG Tagging
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "120"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2752.5,
          "y": 7955
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "22":
    id: "22"
    taskid: 2a27f2d9-0134-453c-8726-b1c15b60cd2b
    type: title
    task:
      id: 2a27f2d9-0134-453c-8726-b1c15b60cd2b
      version: -1
      name: Start Validation
      description: Start validation of Incident
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "36"
      - "34"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1330,
          "y": 30
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "23":
    id: "23"
    taskid: 54d5ad07-a038-4062-8c4d-9aca2322ef76
    type: playbook
    task:
      id: 54d5ad07-a038-4062-8c4d-9aca2322ef76
      version: -1
      name: PAN-OS - Block Destination Service
      description: This playbook blocks a Destination IP and Service (tcp or udp port)
        by creating a rule for a specific Device Group on PAN-OS.
      playbookName: PAN-OS - Block Destination Service
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "8"
    scriptarguments:
      AutoCommit:
        complex:
          root: inputs.AutoCommit
      DeviceGroup:
        complex:
          root: TargetDG
      IP:
        complex:
          root: incident
          accessor: expanseip
      LogForwarding:
        complex:
          root: inputs.LogForwarding
      Port:
        complex:
          root: incident
          accessor: expanseport
          transformers:
          - operator: Stringify
      Protocol:
        complex:
          root: incident
          accessor: expanseprotocol
          transformers:
          - operator: toLowerCase
      RuleNamePrefix:
        simple: xsoar-rule-
      ServiceNamePrefix:
        simple: xsoar-service-
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
      forEach: true
    view: |-
      {
        "position": {
          "x": 2495,
          "y": 10285
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "24":
    id: "24"
    taskid: b37c64b5-c90e-4d1d-8dd4-b620957c9b68
    type: title
    task:
      id: b37c64b5-c90e-4d1d-8dd4-b620957c9b68
      version: -1
      name: Block Service
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "25"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2282.5,
          "y": 9665
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "25":
    id: "25"
    taskid: 88896747-5e25-4923-8b67-a11e747f6f30
    type: regular
    task:
      id: 88896747-5e25-4923-8b67-a11e747f6f30
      version: -1
      name: Get PAN-OS Version
      description: Show firewall device software version.
      script: '|||panorama-show-device-version'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      target: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2282.5,
          "y": 9845
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "26":
    id: "26"
    taskid: 6f652d92-63fd-4d2e-8143-3503f14bcc9f
    type: condition
    task:
      id: 6f652d92-63fd-4d2e-8143-3503f14bcc9f
      version: -1
      name: Firewall or Panorama?
      description: Check whether target device is a Firewall or Panorama
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "27"
      Panorama:
      - "23"
    separatecontext: false
    conditions:
    - label: Panorama
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: Panorama.Device.Info
                accessor: Model
            iscontext: true
          right:
            value:
              simple: panorama
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 2282.5,
          "y": 10110
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "27":
    id: "27"
    taskid: eadc4dcd-c031-485e-88a5-fc2534d8a3ee
    type: playbook
    task:
      id: eadc4dcd-c031-485e-88a5-fc2534d8a3ee
      version: -1
      name: PAN-OS - Block Destination Service
      description: This playbook blocks a Destination IP and Service (tcp or udp port)
        by creating a rule for a specific Device Group on PAN-OS.
      playbookName: PAN-OS - Block Destination Service
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "8"
    scriptarguments:
      AutoCommit:
        complex:
          root: inputs.AutoCommit
      DeviceGroup: {}
      IP:
        complex:
          root: incident
          accessor: expanseip
      LogForwarding:
        complex:
          root: inputs.LogForwarding
      Port:
        complex:
          root: incident
          accessor: expanseport
          transformers:
          - operator: Stringify
      Protocol:
        complex:
          root: incident
          accessor: expanseprotocol
          transformers:
          - operator: toLowerCase
      RuleNamePrefix:
        simple: xsoar-rule-
      ServiceNamePrefix:
        simple: xsoar-service-
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
      forEach: true
    view: |-
      {
        "position": {
          "x": 2075,
          "y": 10285
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "28":
    id: "28"
    taskid: 7ebfbb9e-a404-4964-8a39-638f4b3fceb8
    type: title
    task:
      id: 7ebfbb9e-a404-4964-8a39-638f4b3fceb8
      version: -1
      name: Enrichment
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "167"
      - "141"
      - "176"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1337.5,
          "y": -740
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "29":
    id: "29"
    taskid: d63eaef1-a9b9-42b0-841e-ada75b26ed97
    type: title
    task:
      id: d63eaef1-a9b9-42b0-841e-ada75b26ed97
      version: -1
      name: Done Enrichment
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "22"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1337.5,
          "y": -150
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "30":
    id: "30"
    taskid: af8f61e8-9114-4818-85ce-0f8bdf74552e
    type: title
    task:
      id: af8f61e8-9114-4818-85ce-0f8bdf74552e
      version: -1
      name: Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "81"
      - "82"
      - "84"
      - "109"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 610,
          "y": 5690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "31":
    id: "31"
    taskid: 2c906d41-3447-4a78-863f-5b3c3ca4f727
    type: regular
    task:
      id: 2c906d41-3447-4a78-863f-5b3c3ca4f727
      version: -1
      name: Extract Risky Flows from Behavior
      description: Retrieve Expanse Behavior Risky Flows
      script: '|||expanse-get-risky-flows'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "29"
    scriptarguments:
      created_after: {}
      created_before: {}
      internal_ip_range:
        complex:
          root: incident
          accessor: expanseip
      limit: {}
      risk-rule: {}
      tagnames: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 270,
          "y": -390
        }
      }
    note: true
    evidencedata:
      description:
        simple: Risky Flows from Expanse Behavior for this incident's IP
      customfields: {}
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "34":
    id: "34"
    taskid: afc85687-c354-4465-88c2-53bac1096464
    type: playbook
    task:
      id: afc85687-c354-4465-88c2-53bac1096464
      version: -1
      name: Expanse Attribution Subplaybook
      description: "Given an Expanse Asset, Issue IP, Issue Provider, Issue Domain,\
        \ Issue Port and Issue Protocol hunts for internal activity on the detected\
        \ service. \nReturns a list of potential owner BUs, owner Users, Device and\
        \ Notes"
      playbookName: Expanse Attribution Subplaybook
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "147"
    scriptarguments:
      Asset: {}
      Domain:
        complex:
          root: incident
          accessor: expansedomain
      IP:
        complex:
          root: incident
          accessor: expanseip
      InternalIPRange: {}
      NumberOfDaysInThePast:
        complex:
          root: inputs.NumberOfDaysInThePast
      Port:
        complex:
          root: incident
          accessor: expanseport
      Protocol:
        complex:
          root: incident
          accessor: expanseprotocol
      Provider:
        complex:
          root: incident
          accessor: expanseprovider
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 840,
          "y": 510
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "36":
    id: "36"
    taskid: 7f61b142-3d40-421a-85fc-b5754fc356cf
    type: condition
    task:
      id: 7f61b142-3d40-421a-85fc-b5754fc356cf
      version: -1
      name: Is Issue Related To Cloud Asset?
      description: Check whether the asset is on prem or cloud.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "147"
      "yes":
      - "180"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEqualString
          left:
            value:
              complex:
                root: incident
                accessor: expanseprovider
            iscontext: true
          right:
            value:
              simple: On Prem
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 1450,
          "y": 190
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "40":
    id: "40"
    taskid: 13f53a86-804b-47bd-802b-5b953d63fbb4
    type: regular
    task:
      id: 13f53a86-804b-47bd-802b-5b953d63fbb4
      version: -1
      name: Suggest possible Shadow IT
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "158"
    scriptarguments:
      append:
        simple: "false"
      key:
        simple: SuggestedShadowITAnswer
      stringify: {}
      value:
        simple: "Yes"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 970,
          "y": 2605
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "48":
    id: "48"
    taskid: 63af2eda-4c22-4b0f-804c-bd49344943b5
    type: collection
    task:
      id: 63af2eda-4c22-4b0f-804c-bd49344943b5
      version: -1
      name: 'Ask: What Is The Organization Unit?'
      description: Ask the user to perform attribution.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "88"
      - "136"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1257.5,
          "y": 3335
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
        simple: Analyst
      subject:
        simple: '** not used **'
      body:
        complex:
          root: incident
          accessor: id
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'Input needed to help attribution in Expanse Issue  '
              suffix: {}
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: Select the Organization Unit owning this asset
        required: true
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - complex:
            root: OUToOwnerList
            transformers:
            - operator: jmespath
              args:
                expression:
                  value:
                    simple: keys(@)
        - simple: ❓Unknown
        - simple: ➕ Add New
        - simple: ❌ False Positive
        fieldassociated: ""
        placeholder: ""
        tooltip: Select the Organization Unit owning this asset
        readonly: false
      - id: "1"
        label: ""
        labelarg:
          complex:
            root: SuggestedShadowITAnswer
            transformers:
            - operator: If-Then-Else
              args:
                else:
                  value:
                    simple: Automatic analysis suggests that the asset is not Shadow
                      IT. Is the asset Shadow IT?
                equals:
                  value:
                    simple: "Yes"
                then:
                  value:
                    simple: Automatic analysis identified the asset as a possible
                      Shadow IT asset. Is the asset Shadow IT?
        required: true
        gridcolumns: []
        defaultrows: []
        type: singleSelect
        options: []
        optionsarg:
        - simple: "No"
        - simple: ❓Undecided
        - simple: "Yes"
        fieldassociated: ""
        placeholder: ""
        tooltip: Decide whether this a Shadow IT asset
        readonly: false
      title: Analysis of Asset Attribution
      description: |-
        Playbook automatically collected details from different sources to help the identification of the owner of the asset. Please check the Evidence board for additional details that could help in your investigation.

        To continue your investigation, please decide:
        - the **Organization Unit** this asset belongs to. This will be used for notifications and remediations actions. If you don't know, you can select *Unknown*. If the asset doesn't belong to your organization, select *False Positive*. If the OU is not listed select *Add New* to add a new OU.
        - if the asset should be considered **Shadow IT**
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
  "49":
    id: "49"
    taskid: c7b822d1-5e9c-4339-8371-1f62ea3174d2
    type: regular
    task:
      id: c7b822d1-5e9c-4339-8371-1f62ea3174d2
      version: -1
      name: Set Organization Unit
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "93"
    scriptarguments:
      accountid: {}
      accountname: {}
      addLabels: {}
      agentid: {}
      app: {}
      appendMultiSelect: {}
      assetid: {}
      assigneduser: {}
      assignmentgroup: {}
      attachmentcount: {}
      attachmentextension: {}
      attachmenthash: {}
      attachmentid: {}
      attachmentname: {}
      attachmentsize: {}
      attachmenttype: {}
      blockedaction: {}
      bugtraq: {}
      caller: {}
      city: {}
      closeNotes: {}
      closeReason: {}
      cloudservice: {}
      commandline: {}
      costcenter: {}
      costcentercode: {}
      country: {}
      countryname: {}
      criticalassets: {}
      customFields: {}
      cve: {}
      cvss: {}
      dbotMirrorDirection: {}
      dbotMirrorId: {}
      dbotMirrorInstance: {}
      dbotMirrorTags: {}
      dbotprediction: {}
      dbotpredictionprobability: {}
      dbottextsuggestionhighlighted: {}
      deleteEmptyField: {}
      department: {}
      dest: {}
      desthostname: {}
      destinationhostname: {}
      destinationip: {}
      destinationnetwork: {}
      destinationport: {}
      destntdomain: {}
      destos: {}
      details: {}
      detectedexternalhosts: {}
      detectedexternalips: {}
      detectedinternalhosts: {}
      detectedinternalips: {}
      detectedusers: {}
      detectionendtime: {}
      detectionid: {}
      detectionupdatetime: {}
      detectionurl: {}
      deviceexternalip: {}
      devicehash: {}
      devicelocalip: {}
      devicemodel: {}
      devicename: {}
      displayname: {}
      duration: {}
      email: {}
      emailauthenticitycheck: {}
      emailbcc: {}
      emailbody: {}
      emailbodyformat: {}
      emailbodyhtml: {}
      emailcc: {}
      emailclassification: {}
      emailclientname: {}
      emailfrom: {}
      emailheaders: {}
      emailhtml: {}
      emailinreplyto: {}
      emailkeywords: {}
      emailmessageid: {}
      emailreceived: {}
      emailreplyto: {}
      emailreturnpath: {}
      emailsenderip: {}
      emailsize: {}
      emailsource: {}
      emailsubject: {}
      emailto: {}
      emailtocount: {}
      emailurlclicked: {}
      employeedisplayname: {}
      employeeemail: {}
      employeemanageremail: {}
      escalation: {}
      eventaction: {}
      eventid: {}
      eventtype: {}
      expanseactivitystatus: {}
      expanseasset: {}
      expanseassetorganizationunit:
        complex:
          root: Analysis of Asset Attribution.Answers
          accessor: "0"
          transformers:
          - operator: FirstArrayElement
      expanseassetowner: {}
      expanseassignee: {}
      expansebusinessunits: {}
      expansecategory: {}
      expansecertificate: {}
      expansecreated: {}
      expansedomain: {}
      expanseinitialevidence: {}
      expanseip: {}
      expanseissueid: {}
      expanseissuetype: {}
      expanselatestevidence: {}
      expansemodified: {}
      expanseport: {}
      expansepriority: {}
      expanseprogressstatus: {}
      expanseprotocol: {}
      expanseprovider: {}
      expanseshadowit: {}
      expansetags: {}
      externaladdresses: {}
      filehash: {}
      filename: {}
      filepath: {}
      filesize: {}
      firstname: {}
      firstseen: {}
      givenname: {}
      helloworldid: {}
      helloworldstatus: {}
      helloworldtype: {}
      hostname: {}
      id: {}
      incomingmirrorerror: {}
      infectedhosts: {}
      internaladdresses: {}
      investigationstage: {}
      isolated: {}
      jobcode: {}
      jobfamily: {}
      jobfunction: {}
      labels: {}
      lastmodifiedby: {}
      lastmodifiedon: {}
      lastname: {}
      lastseen: {}
      leadership: {}
      location: {}
      locationregion: {}
      logsource: {}
      macaddress: {}
      maliciousbehavior: {}
      malwarefamily: {}
      malwarename: {}
      manageremailaddress: {}
      managername: {}
      md5: {}
      mobiledevicemodel: {}
      mobilephone: {}
      name: {}
      occurred: {}
      os: {}
      osversion: {}
      outgoingmirrorerror: {}
      owner: {}
      parentprocessid: {}
      personalemail: {}
      phase: {}
      phishingsubtype: {}
      phonenumber: {}
      pid: {}
      policydeleted: {}
      policydescription: {}
      policydetails: {}
      policyid: {}
      policyrecommendation: {}
      policyremediable: {}
      policyseverity: {}
      policytype: {}
      prismacloudid: {}
      prismacloudreason: {}
      prismacloudrules: {}
      prismacloudstatus: {}
      prismacloudtime: {}
      protocol: {}
      protocols: {}
      quarantined: {}
      rating: {}
      region: {}
      regionid: {}
      replacePlaybook: {}
      reporteremailaddress: {}
      resourceapiname: {}
      resourcecloudtype: {}
      resourceid: {}
      resourcename: {}
      resourcetype: {}
      riskrating: {}
      riskscore: {}
      roles: {}
      rrn: {}
      samaccountname: {}
      severity: {}
      sha256: {}
      shadowitaccountowneremail: {}
      shadowitaccountownername: {}
      shadowitcloudaccountid: {}
      shadowitcloudaccounttype: {}
      signature: {}
      skuname: {}
      skutier: {}
      sla: {}
      slaField: {}
      sourcehostname: {}
      sourceip: {}
      sourcenetwork: {}
      sourceport: {}
      sourceusername: {}
      src: {}
      srchostname: {}
      srcntdomain: {}
      srcos: {}
      srcuser: {}
      state: {}
      streetaddress: {}
      subcategory: {}
      subscriptionassignedby: {}
      subscriptioncreatedby: {}
      subscriptioncreatedon: {}
      subscriptiondescription: {}
      subscriptionid: {}
      subscriptionname: {}
      subscriptiontype: {}
      subscriptionupdatedby: {}
      subscriptionupdatedon: {}
      subtype: {}
      surname: {}
      systemdefault: {}
      systems: {}
      targetfirewallversion: {}
      tenantname: {}
      terminatedaction: {}
      threatactor: {}
      ticketcloseddate: {}
      ticketnumber: {}
      ticketopeneddate: {}
      title: {}
      triggeredsecurityprofile: {}
      type: {}
      uniqueports: {}
      urlsslverification: {}
      user: {}
      useraccountcontrol: {}
      username: {}
      vendorid: {}
      vendorproduct: {}
      vpcid: {}
      vulnerabilitycategory: {}
      workphone: {}
      xdralertcount: {}
      xdralerts: {}
      xdrassigneduseremail: {}
      xdrassigneduserprettyname: {}
      xdrdescription: {}
      xdrdetectiontime: {}
      xdrfileartifacts: {}
      xdrhighseverityalertcount: {}
      xdrhostcount: {}
      xdrincidentid: {}
      xdrlowseverityalertcount: {}
      xdrmediumseverityalertcount: {}
      xdrnetworkartifacts: {}
      xdrnotes: {}
      xdrresolvecomment: {}
      xdrstatus: {}
      xdrstatusv2: {}
      xdrurl: {}
      xdrusercount: {}
      zipcode: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1062.5,
          "y": 4210
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "51":
    id: "51"
    taskid: f1c5d48d-b3e6-42c8-88e8-87056b568e75
    type: regular
    task:
      id: f1c5d48d-b3e6-42c8-88e8-87056b568e75
      version: -1
      name: Setup Vulnerability Assessment Tool To Scan The Asset
      description: Add this discovered asset to Vulnerability Management tools.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "53"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -590,
          "y": 8020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "52":
    id: "52"
    taskid: 5f7ee269-baa0-4586-8022-bcbc997b977c
    type: condition
    task:
      id: 5f7ee269-baa0-4586-8022-bcbc997b977c
      version: -1
      name: |-
        Check if the system is scanned by Vulnerability Assessment systems.

        Is this protected?
      description: Check if this system is scanned by Vulnerability Management systems.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "51"
      "Yes":
      - "53"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -267.5,
          "y": 7820
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "53":
    id: "53"
    taskid: 3b0fd9da-e814-44bb-8945-779236b05513
    type: title
    task:
      id: 3b0fd9da-e814-44bb-8945-779236b05513
      version: -1
      name: Done Vulnerability Assessment
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "75"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -347.5,
          "y": 9550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "56":
    id: "56"
    taskid: 13c8d688-5222-4eb5-86c0-35a6391bc188
    type: condition
    task:
      id: 13c8d688-5222-4eb5-86c0-35a6391bc188
      version: -1
      name: Is Asset Organization Unit Known?
      description: Check the attributed Organization Unit.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "83"
      "yes":
      - "58"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: notContainsString
          left:
            value:
              simple: incident.expanseassetorganizationunit
            iscontext: true
          right:
            value:
              simple: Unknown
          ignorecase: true
      - - operator: notContainsString
          left:
            value:
              simple: incident.expanseassetorganizationunit
            iscontext: true
          right:
            value:
              simple: False Positive
    view: |-
      {
        "position": {
          "x": 592.5,
          "y": 7515
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "58":
    id: "58"
    taskid: a3567038-fb7e-48e7-8c23-528921c5a99f
    type: regular
    task:
      id: a3567038-fb7e-48e7-8c23-528921c5a99f
      version: -1
      name: Notify OU Owner
      description: Send an email
      script: '|||send-mail'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "83"
    scriptarguments:
      additionalHeader: {}
      attachCIDs: {}
      attachIDs: {}
      attachNames: {}
      bcc: {}
      body:
        complex:
          root: inputs.OwnerNotificationBody
      cc: {}
      htmlBody: {}
      raw_message: {}
      replyTo: {}
      subject:
        complex:
          root: inputs.OwnerNotificationSubject
      templateParams: {}
      to:
        complex:
          root: OUToOwnerList
          transformers:
          - operator: getField
            args:
              field:
                value:
                  simple: incident.expanseassetorganizationunit
                iscontext: true
          - operator: ParseJSON
          - operator: getField
            args:
              field:
                value:
                  simple: email
      transientFile: {}
      transientFileCID: {}
      transientFileContent: {}
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 592.5,
          "y": 7755
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "59":
    id: "59"
    taskid: 187be90c-5d51-4c94-8b94-3e52d6d871fe
    type: condition
    task:
      id: 187be90c-5d51-4c94-8b94-3e52d6d871fe
      version: -1
      name: Check for Possible Shadow IT?
      description: Check if the incident is a possible Shadow IT one.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "40"
      Possible:
      - "133"
    separatecontext: false
    conditions:
    - label: Possible
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: ShadowITCondition
                filters:
                - - operator: isTrue
                    left:
                      value:
                        simple: ShadowITCondition.value
                      iscontext: true
            iscontext: true
    view: |-
      {
        "position": {
          "x": 1297.5,
          "y": 2370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "62":
    id: "62"
    taskid: ecfa8661-c945-4bfb-8d84-12670c4b80f1
    type: title
    task:
      id: ecfa8661-c945-4bfb-8d84-12670c4b80f1
      version: -1
      name: Shadow IT
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "154"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1297.5,
          "y": 1450
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "63":
    id: "63"
    taskid: e169ac62-f570-4764-8ff3-e5e0364ad62b
    type: title
    task:
      id: e169ac62-f570-4764-8ff3-e5e0364ad62b
      version: -1
      name: Organization Unit
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "68"
      - "69"
      - "70"
      - "108"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1257.5,
          "y": 3015
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "65":
    id: "65"
    taskid: e9b5ed3e-deca-4ed1-878f-0161012fc622
    type: regular
    task:
      id: e9b5ed3e-deca-4ed1-878f-0161012fc622
      version: -1
      name: Extract List of Low Confidence Discovery tags from PB Inputs
      description: Set a value in context under the key you entered. If no value is
        entered, the script doesn't do anything.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "28"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: IPRangeLowConfidenceTag
      stringify: {}
      value:
        complex:
          root: inputs.IPRangeLowConfidenceTagList
          transformers:
          - operator: splitAndTrim
            args:
              delimiter:
                value:
                  simple: ','
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1327.5,
          "y": -1130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "66":
    id: "66"
    taskid: d44a5836-3dd5-431a-886f-c05806e87f8b
    type: regular
    task:
      id: d44a5836-3dd5-431a-886f-c05806e87f8b
      version: -1
      name: Print Target Device Group suggestions
      description: Convert an array to a nice table display. Usually, from the context.
      scriptName: ToTable
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "196"
    scriptarguments:
      columns: {}
      data:
        complex:
          root: TargetFirewalls
      title:
        simple: Possible target Device Groups for Remediation
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2435,
          "y": 7190
        }
      }
    note: true
    evidencedata:
      description:
        simple: Potential PAN-OS Target Device Groups
      customfields: {}
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "67":
    id: "67"
    taskid: 86470e30-c196-4d80-87a7-888971a05876
    type: regular
    task:
      id: 86470e30-c196-4d80-87a7-888971a05876
      version: -1
      name: Set Target Device Group based on user input
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "169"
    scriptarguments:
      append:
        simple: "false"
      key:
        simple: TargetDG
      stringify: {}
      value:
        complex:
          root: Choose Device Group.Answers
          accessor: "0"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2312.5,
          "y": 8350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "68":
    id: "68"
    taskid: bde51d54-70b5-463c-893b-fecb60cdfad4
    type: regular
    task:
      id: bde51d54-70b5-463c-893b-fecb60cdfad4
      version: -1
      name: Print Target Users suggestions
      description: Convert an array to a nice table display. Usually, from the context.
      tags:
      - ExpanseSuggestion
      scriptName: ToTable
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      columns: {}
      data:
        complex:
          root: Expanse
          accessor: AttributionUser
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty:
                value:
                  simple: "true"
              defaultValue:
                value:
                  simple: '**NOTFOUND**'
          - operator: DT
            args:
              dt:
                value:
                  simple: .=foo(val);function foo(aa) { if(val == '**NOTFOUND**')
                    { return [{"value":"No results found"}]} else return val;}
      title:
        simple: List of Users who connected to the asset in the past ${inputs.NumberOfDaysInThePast}
          days
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1062.5,
          "y": 3160
        }
      }
    note: true
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "69":
    id: "69"
    taskid: 5d292fe1-f6fa-42cb-83b1-fdb0929a815b
    type: regular
    task:
      id: 5d292fe1-f6fa-42cb-83b1-fdb0929a815b
      version: -1
      name: Print Target IP suggestions
      description: Convert an array to a nice table display. Usually, from the context.
      tags:
      - ExpanseSuggestion
      scriptName: ToTable
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      columns: {}
      data:
        complex:
          root: Expanse
          accessor: AttributionIP
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty:
                value:
                  simple: "true"
              defaultValue:
                value:
                  simple: '**NOTFOUND**'
          - operator: DT
            args:
              dt:
                value:
                  simple: .=foo(val);function foo(aa) { if(val == '**NOTFOUND**')
                    { return [{"value":"No results found"}]} else return val;}
      title:
        simple: List of Source IP that connected to the asset in the past ${inputs.NumberOfDaysInThePast}
          days
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1502.5,
          "y": 3160
        }
      }
    note: true
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "70":
    id: "70"
    taskid: d88e13df-9839-4856-8b3c-da7404d4590f
    type: regular
    task:
      id: d88e13df-9839-4856-8b3c-da7404d4590f
      version: -1
      name: Print Target Devices suggestions
      description: Convert an array to a nice table display. Usually, from the context.
      tags:
      - ExpanseSuggestion
      scriptName: ToTable
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      columns: {}
      data:
        complex:
          root: Expanse
          accessor: AttributionDevice
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty:
                value:
                  simple: "true"
              defaultValue:
                value:
                  simple: '**NOTFOUND**'
          - operator: DT
            args:
              dt:
                value:
                  simple: .=foo(val);function foo(aa) { if(val == '**NOTFOUND**')
                    { return [{"value":"No results found"}]} else return val;}
      title:
        simple: List of Devices that permitted traffic to asset in the past ${inputs.NumberOfDaysInThePast}
          days
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1922.5,
          "y": 3160
        }
      }
    note: true
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "73":
    id: "73"
    taskid: a31d08c4-318f-4264-8567-791faa55c260
    type: condition
    task:
      id: a31d08c4-318f-4264-8567-791faa55c260
      version: -1
      name: Is this shadow IT?
      description: Check if the incident is marked as Shadow IT.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "86"
      "yes":
      - "177"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isTrue
          left:
            value:
              complex:
                root: incident
                accessor: expanseshadowit
            iscontext: true
    view: |-
      {
        "position": {
          "x": 3842.5,
          "y": 8285
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "74":
    id: "74"
    taskid: ee27d2c7-bf7a-4e15-8bb3-74bf52a7072e
    type: regular
    task:
      id: ee27d2c7-bf7a-4e15-8bb3-74bf52a7072e
      version: -1
      name: Create Shadow IT Incident
      description: commands.local.cmd.create.inc
      script: Builtin|||createNewIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "105"
    scriptarguments:
      accountid: {}
      accountname: {}
      agentid: {}
      alertid: {}
      alertname: {}
      app: {}
      applicationid: {}
      applicationname: {}
      assetid: {}
      assigneduser: {}
      assignmentgroup: {}
      attachmentcount: {}
      attachmentextension: {}
      attachmenthash: {}
      attachmentid: {}
      attachmentname: {}
      attachmentsize: {}
      attachmenttype: {}
      blockedaction: {}
      bugtraq: {}
      caller: {}
      categorycount: {}
      city: {}
      closetime: {}
      closingreason: {}
      closinguser: {}
      cloudservice: {}
      commandline: {}
      compliancenotes: {}
      costcenter: {}
      costcentercode: {}
      country: {}
      countryname: {}
      criticalassets: {}
      customFields: {}
      cve: {}
      cvss: {}
      cvssavailabilityrequirement: {}
      cvsscollateraldamagepotential: {}
      cvssconfidentialityrequirement: {}
      cvssintegrityrequirement: {}
      dbotprediction: {}
      dbotpredictionprobability: {}
      dbottextsuggestionhighlighted: {}
      department: {}
      dest: {}
      desthostname: {}
      destinationgeolocation: {}
      destinationhostname: {}
      destinationip: {}
      destinationips: {}
      destinationipv6: {}
      destinationmacaddress: {}
      destinationnetwork: {}
      destinationport: {}
      destntdomain: {}
      destos: {}
      details: {}
      detectedexternalhosts: {}
      detectedexternalips: {}
      detectedinternalhosts: {}
      detectedinternalips: {}
      detectedusers: {}
      detectionendtime: {}
      detectionid: {}
      detectionupdatetime: {}
      detectionurl: {}
      deviceexternalip: {}
      devicehash: {}
      devicelocalip: {}
      devicemodel: {}
      devicename: {}
      devicetime: {}
      displayname: {}
      dnsname: {}
      dstports: {}
      duration: {}
      email: {}
      emailauthenticitycheck: {}
      emailbcc: {}
      emailbody: {}
      emailbodyformat: {}
      emailbodyhtml: {}
      emailcc: {}
      emailclassification: {}
      emailclientname: {}
      emailfrom: {}
      emailheaders: {}
      emailhtml: {}
      emailhtmlimage: {}
      emailinreplyto: {}
      emailkeywords: {}
      emaillabels: {}
      emaillatestmessage: {}
      emailmessageid: {}
      emailreceived: {}
      emailreplyto: {}
      emailreturnpath: {}
      emailsenderip: {}
      emailsize: {}
      emailsource: {}
      emailsubject: {}
      emailto: {}
      emailtocount: {}
      emailurlclicked: {}
      employeedisplayname: {}
      employeeemail: {}
      employeemanageremail: {}
      entryIDs: {}
      errorcode: {}
      errormessage: {}
      escalation: {}
      eventaction: {}
      eventdescriptions: {}
      eventid: {}
      eventnames: {}
      events: {}
      eventtype: {}
      expanseactivitystatus: {}
      expanseasset: {}
      expanseassetorganizationunit: {}
      expanseassetowner: {}
      expanseassignee: {}
      expansebusinessunits: {}
      expansecategory: {}
      expansecertificate: {}
      expansecreated: {}
      expansedomain: {}
      expansegeolocation: {}
      expanseinitialevidence: {}
      expanseip: {}
      expanseissueid: {}
      expanseissuetype: {}
      expanselatestevidence: {}
      expanselatestevidencegeolocation: {}
      expansemlfeatures: {}
      expansemodified: {}
      expanseport: {}
      expansepriority: {}
      expanseprogressstatus: {}
      expanseprotocol: {}
      expanseprovider: {}
      expanseregion: {}
      expanseservice: {}
      expanseshadowit: {}
      expansetags: {}
      externaladdresses: {}
      filehash: {}
      filename: {}
      filepath: {}
      filesize: {}
      firstname: {}
      firstseen: {}
      followup: {}
      givenname: {}
      helloworldid: {}
      helloworldstatus: {}
      helloworldtype: {}
      highlevelcategories: {}
      hostname: {}
      incomingmirrorerror: {}
      infectedhosts: {}
      internaladdresses: {}
      investigationstage: {}
      isolated: {}
      jobcode: {}
      jobfamily: {}
      jobfunction: {}
      labels: {}
      lastmodifiedby: {}
      lastmodifiedon: {}
      lastname: {}
      lastseen: {}
      lastupdatetime: {}
      leadership: {}
      listofrulesevent: {}
      location: {}
      locationregion: {}
      logsource: {}
      logsourcename: {}
      logsourcetype: {}
      lowlevelcategoriesevents: {}
      macaddress: {}
      maliciousbehavior: {}
      malwarefamily: {}
      malwarename: {}
      manageremailaddress: {}
      managername: {}
      md5: {}
      mobiledevicemodel: {}
      mobilephone: {}
      name:
        complex:
          root: incident
          accessor: expanseip
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'Shadow IT Detected by Expanse on IP: '
              suffix: {}
      numberoflogsources: {}
      occurred: {}
      os: {}
      osversion: {}
      outgoingmirrorerror: {}
      owner: {}
      parentprocessid: {}
      personalemail: {}
      phase: {}
      phishingsubtype: {}
      phonenumber: {}
      pid: {}
      policydeleted: {}
      policydescription: {}
      policydetails: {}
      policyid: {}
      policyrecommendation: {}
      policyremediable: {}
      policyseverity: {}
      policytype: {}
      postnatdestinationip: {}
      postnatdestinationport: {}
      postnatsourceip: {}
      postnatsourceport: {}
      prenatdestinationport: {}
      prenatsourceip: {}
      prenatsourceport: {}
      prismacloudid: {}
      prismacloudreason: {}
      prismacloudrules: {}
      prismacloudstatus: {}
      prismacloudtime: {}
      protocol: {}
      protocolevent: {}
      protocols: {}
      quarantined: {}
      rating: {}
      rawevent: {}
      region: {}
      regionid: {}
      reporteremailaddress: {}
      resourceapiname: {}
      resourcecloudtype: {}
      resourceid: {}
      resourcename: {}
      resourcetype: {}
      riskrating: {}
      riskscore: {}
      roles: {}
      rrn: {}
      samaccountname: {}
      severity:
        complex:
          root: incident
          accessor: severity
      sha256: {}
      shadowitaccountowneremail: {}
      shadowitaccountownername: {}
      shadowitbilledtocorp: {}
      shadowitcertificate: {}
      shadowitcloudaccountid: {}
      shadowitcloudaccounttype: {}
      shadowitfqdn: {}
      shadowitip: {}
      shadowitorganizationalunit: {}
      shadowitoucontactemail: {}
      shadowitoucontactname: {}
      shadowitport: {}
      shadowitprovider: {}
      shadowitregion: {}
      shadowitrisk: {}
      shadowitsactionedservice: {}
      shadowitsensitivedata: {}
      shadowitservice: {}
      shadowitservicepurpose: {}
      shadowitsource: {}
      shadowitusersuggestions: {}
      shadowusersuggestions: {}
      signature: {}
      skuname: {}
      skutier: {}
      sla: {}
      slaField: {}
      sourcegeolocation: {}
      sourcehostname: {}
      sourceip: {}
      sourceips: {}
      sourceipv6: {}
      sourcemacaddress: {}
      sourcenetwork: {}
      sourceport: {}
      sourceusername: {}
      src: {}
      srchostname: {}
      srcntdomain: {}
      srcos: {}
      srcports: {}
      srcuser: {}
      starttime: {}
      state: {}
      streetaddress: {}
      subcategory: {}
      subscriptionassignedby: {}
      subscriptioncreatedby: {}
      subscriptioncreatedon: {}
      subscriptiondescription: {}
      subscriptionid: {}
      subscriptionname: {}
      subscriptiontype: {}
      subscriptionupdatedby: {}
      subscriptionupdatedon: {}
      subtype: {}
      surname: {}
      systemdefault: {}
      systems: {}
      targetfirewallversion: {}
      technicalowner: {}
      technicalownercontact: {}
      technicaluser: {}
      tenantname: {}
      terminatedaction: {}
      threatactor: {}
      ticketcloseddate: {}
      ticketnumber: {}
      ticketopeneddate: {}
      title: {}
      trafficdirection: {}
      triggeredsecurityprofile: {}
      type:
        complex:
          root: inputs.ShadowITIncidentType
      uniqueports: {}
      urlsslverification: {}
      user: {}
      useraccountcontrol: {}
      userid: {}
      username: {}
      usernames: {}
      vendorid: {}
      vendorproduct: {}
      vpcid: {}
      vulnerabilitycategory: {}
      workphone: {}
      xdralertcount: {}
      xdralerts: {}
      xdrassigneduseremail: {}
      xdrassigneduserprettyname: {}
      xdrdescription: {}
      xdrdetectiontime: {}
      xdrfileartifacts: {}
      xdrhighseverityalertcount: {}
      xdrhostcount: {}
      xdrincidentid: {}
      xdrlowseverityalertcount: {}
      xdrmediumseverityalertcount: {}
      xdrnetworkartifacts: {}
      xdrnotes: {}
      xdrresolvecomment: {}
      xdrstatus: {}
      xdrstatusv2: {}
      xdrurl: {}
      xdrusercount: {}
      zipcode: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 4610,
          "y": 8690
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "75":
    id: "75"
    taskid: 81514b4f-c8d9-4e8f-8fe1-7f15c31c2ce4
    type: title
    task:
      id: 81514b4f-c8d9-4e8f-8fe1-7f15c31c2ce4
      version: -1
      name: Close Investigation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "76"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1297.5,
          "y": 10705
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "76":
    id: "76"
    taskid: da9b8ea8-b08c-49ef-8432-2d2c6e7d14ff
    type: condition
    task:
      id: da9b8ea8-b08c-49ef-8432-2d2c6e7d14ff
      version: -1
      name: Close Investigation?
      description: Ask the user whether to close the investigation.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      ✅ Yes:
      - "77"
      ❌ No:
      - "78"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1297.5,
          "y": 10850
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "77":
    id: "77"
    taskid: 81f2bb0a-81be-4ba1-841c-dee2270aae3e
    type: regular
    task:
      id: 81f2bb0a-81be-4ba1-841c-dee2270aae3e
      version: -1
      name: Close Investigation
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "78"
    scriptarguments:
      assetid: {}
      closeNotes: {}
      closeReason: {}
      emailclassification: {}
      id: {}
      incomingmirrorerror: {}
      outgoingmirrorerror: {}
      phishingsubtype: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1570,
          "y": 11080
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "78":
    id: "78"
    taskid: 7bd2fb64-a145-4008-8aec-3122da71b46e
    type: title
    task:
      id: 7bd2fb64-a145-4008-8aec-3122da71b46e
      version: -1
      name: All done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1297.5,
          "y": 11320
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "81":
    id: "81"
    taskid: 2c8aabaa-7ae6-449e-8ac3-a59639e515b6
    type: title
    task:
      id: 2c8aabaa-7ae6-449e-8ac3-a59639e515b6
      version: -1
      name: Vulnerability Assessment
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "52"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -267.5,
          "y": 7660
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "82":
    id: "82"
    taskid: d7dcbab5-ea69-4b66-8f5f-21e3a15d143a
    type: title
    task:
      id: d7dcbab5-ea69-4b66-8f5f-21e3a15d143a
      version: -1
      name: Notification Flow
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "56"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 592.5,
          "y": 7320
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "83":
    id: "83"
    taskid: 306714ca-ed8c-4d3e-8faa-81daced43b3a
    type: title
    task:
      id: 306714ca-ed8c-4d3e-8faa-81daced43b3a
      version: -1
      name: Done Notification
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "75"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 562.5,
          "y": 9550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "84":
    id: "84"
    taskid: a453e4bc-375c-478b-875e-2ea7f98acad3
    type: title
    task:
      id: a453e4bc-375c-478b-875e-2ea7f98acad3
      version: -1
      name: Network Remediation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "9"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1112.5,
          "y": 5840
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "85":
    id: "85"
    taskid: c043a444-e8c5-4c6f-8f30-cd7c11fe6c8a
    type: title
    task:
      id: c043a444-e8c5-4c6f-8f30-cd7c11fe6c8a
      version: -1
      name: Shadow IT
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "73"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 3842.5,
          "y": 8125
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "86":
    id: "86"
    taskid: a7a00f94-9d7f-4387-88fa-06884e1f176c
    type: title
    task:
      id: a7a00f94-9d7f-4387-88fa-06884e1f176c
      version: -1
      name: Done Shadow IT
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "75"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 3852.5,
          "y": 10430
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "88":
    id: "88"
    taskid: 35e8f6c2-4358-4913-8c2b-4f6d0842d699
    type: condition
    task:
      id: 35e8f6c2-4358-4913-8c2b-4f6d0842d699
      version: -1
      name: Should Add New OU?
      description: Determine if a new OU has to be added.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "49"
      "yes":
      - "89"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: containsString
          left:
            value:
              simple: Analysis of Asset Attribution.Answers.0
            iscontext: true
          right:
            value:
              simple: Add New
    view: |-
      {
        "position": {
          "x": 1062.5,
          "y": 3510
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "89":
    id: "89"
    taskid: 617ab769-5a23-4d55-8284-e76ac40878b0
    type: collection
    task:
      id: 617ab769-5a23-4d55-8284-e76ac40878b0
      version: -1
      name: Add New OU
      description: Collect new OU details from the user.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "90"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2330,
          "y": 3695
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
      subject:
      body:
        simple: Add New OU
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: Organization Unit Name
        required: true
        gridcolumns: []
        defaultrows: []
        type: shortText
        options: []
        optionsarg: []
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      - id: "1"
        label: ""
        labelarg:
          simple: Expanse Tag
        required: true
        gridcolumns: []
        defaultrows: []
        type: shortText
        options: []
        optionsarg: []
        fieldassociated: ""
        placeholder: ""
        tooltip: The tag to be used on Expanse to tag assets belonging to this Organization
          Unit
        readonly: false
      - id: "2"
        label: ""
        labelarg:
          simple: Organization Unit Asset Owner Name
        required: true
        gridcolumns: []
        defaultrows: []
        type: shortText
        options: []
        optionsarg: []
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      - id: "3"
        label: ""
        labelarg:
          simple: Organization Unit Asset Owner Email
        required: true
        gridcolumns: []
        defaultrows: []
        type: shortText
        options: []
        optionsarg: []
        fieldassociated: ""
        placeholder: ""
        tooltip: ""
        readonly: false
      title: Add New Organization Unit
      description: Specify thew Organization Unit name, name and email of the assets
        owner.
      sender: Your SOC team
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
  "90":
    id: "90"
    taskid: cf93689a-4a40-4857-81c9-ed628a16f6a3
    type: regular
    task:
      id: cf93689a-4a40-4857-81c9-ed628a16f6a3
      version: -1
      name: Save New Organization Unit to List
      description: Adds/Replaces a key in key/value store backed by an XSOAR list.
      scriptName: AddKeyToList
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "190"
    scriptarguments:
      allowDups: {}
      append:
        simple: "true"
      keyName:
        complex:
          root: Add New Organization Unit.Answers
          accessor: "0"
      listName:
        simple: ExpanseOrganizationUnitsToOwner
      value:
        complex:
          root: Add New Organization Unit.Answers
          accessor: "2"
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: '{"name": "'
              suffix:
                value:
                  simple: '", "email": "'
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: Add New Organization Unit.Answers.3
                iscontext: true
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: '"}'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2330,
          "y": 3860
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "91":
    id: "91"
    taskid: c0574f59-9ad4-462f-85bc-39fc5b06dc2d
    type: regular
    task:
      id: c0574f59-9ad4-462f-85bc-39fc5b06dc2d
      version: -1
      name: Set Organization Unit
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "93"
    scriptarguments:
      accountid: {}
      accountname: {}
      addLabels: {}
      agentid: {}
      app: {}
      appendMultiSelect: {}
      assetid: {}
      assigneduser: {}
      assignmentgroup: {}
      attachmentcount: {}
      attachmentextension: {}
      attachmenthash: {}
      attachmentid: {}
      attachmentname: {}
      attachmentsize: {}
      attachmenttype: {}
      blockedaction: {}
      bugtraq: {}
      caller: {}
      city: {}
      closeNotes: {}
      closeReason: {}
      cloudservice: {}
      commandline: {}
      costcenter: {}
      costcentercode: {}
      country: {}
      countryname: {}
      criticalassets: {}
      customFields: {}
      cve: {}
      cvss: {}
      dbotMirrorDirection: {}
      dbotMirrorId: {}
      dbotMirrorInstance: {}
      dbotMirrorTags: {}
      dbotprediction: {}
      dbotpredictionprobability: {}
      dbottextsuggestionhighlighted: {}
      deleteEmptyField: {}
      department: {}
      dest: {}
      desthostname: {}
      destinationhostname: {}
      destinationip: {}
      destinationnetwork: {}
      destinationport: {}
      destntdomain: {}
      destos: {}
      details: {}
      detectedexternalhosts: {}
      detectedexternalips: {}
      detectedinternalhosts: {}
      detectedinternalips: {}
      detectedusers: {}
      detectionendtime: {}
      detectionid: {}
      detectionupdatetime: {}
      detectionurl: {}
      deviceexternalip: {}
      devicehash: {}
      devicelocalip: {}
      devicemodel: {}
      devicename: {}
      displayname: {}
      duration: {}
      email: {}
      emailauthenticitycheck: {}
      emailbcc: {}
      emailbody: {}
      emailbodyformat: {}
      emailbodyhtml: {}
      emailcc: {}
      emailclassification: {}
      emailclientname: {}
      emailfrom: {}
      emailheaders: {}
      emailhtml: {}
      emailinreplyto: {}
      emailkeywords: {}
      emailmessageid: {}
      emailreceived: {}
      emailreplyto: {}
      emailreturnpath: {}
      emailsenderip: {}
      emailsize: {}
      emailsource: {}
      emailsubject: {}
      emailto: {}
      emailtocount: {}
      emailurlclicked: {}
      employeedisplayname: {}
      employeeemail: {}
      employeemanageremail: {}
      escalation: {}
      eventaction: {}
      eventid: {}
      eventtype: {}
      expanseactivitystatus: {}
      expanseasset: {}
      expanseassetorganizationunit:
        complex:
          root: Add New Organization Unit.Answers
          accessor: "0"
          transformers:
          - operator: FirstArrayElement
      expanseassetowner: {}
      expanseassignee: {}
      expansebusinessunits: {}
      expansecategory: {}
      expansecertificate: {}
      expansecreated: {}
      expansedomain: {}
      expanseinitialevidence: {}
      expanseip: {}
      expanseissueid: {}
      expanseissuetype: {}
      expanselatestevidence: {}
      expansemodified: {}
      expanseport: {}
      expansepriority: {}
      expanseprogressstatus: {}
      expanseprotocol: {}
      expanseprovider: {}
      expanseshadowit: {}
      expansetags: {}
      externaladdresses: {}
      filehash: {}
      filename: {}
      filepath: {}
      filesize: {}
      firstname: {}
      firstseen: {}
      givenname: {}
      helloworldid: {}
      helloworldstatus: {}
      helloworldtype: {}
      hostname: {}
      id: {}
      incomingmirrorerror: {}
      infectedhosts: {}
      internaladdresses: {}
      investigationstage: {}
      isolated: {}
      jobcode: {}
      jobfamily: {}
      jobfunction: {}
      labels: {}
      lastmodifiedby: {}
      lastmodifiedon: {}
      lastname: {}
      lastseen: {}
      leadership: {}
      location: {}
      locationregion: {}
      logsource: {}
      macaddress: {}
      maliciousbehavior: {}
      malwarefamily: {}
      malwarename: {}
      manageremailaddress: {}
      managername: {}
      md5: {}
      mobiledevicemodel: {}
      mobilephone: {}
      name: {}
      occurred: {}
      os: {}
      osversion: {}
      outgoingmirrorerror: {}
      owner: {}
      parentprocessid: {}
      personalemail: {}
      phase: {}
      phishingsubtype: {}
      phonenumber: {}
      pid: {}
      policydeleted: {}
      policydescription: {}
      policydetails: {}
      policyid: {}
      policyrecommendation: {}
      policyremediable: {}
      policyseverity: {}
      policytype: {}
      prismacloudid: {}
      prismacloudreason: {}
      prismacloudrules: {}
      prismacloudstatus: {}
      prismacloudtime: {}
      protocol: {}
      protocols: {}
      quarantined: {}
      rating: {}
      region: {}
      regionid: {}
      replacePlaybook: {}
      reporteremailaddress: {}
      resourceapiname: {}
      resourcecloudtype: {}
      resourceid: {}
      resourcename: {}
      resourcetype: {}
      riskrating: {}
      riskscore: {}
      roles: {}
      rrn: {}
      samaccountname: {}
      severity: {}
      sha256: {}
      signature: {}
      skuname: {}
      skutier: {}
      sla: {}
      slaField: {}
      sourcehostname: {}
      sourceip: {}
      sourcenetwork: {}
      sourceport: {}
      sourceusername: {}
      src: {}
      srchostname: {}
      srcntdomain: {}
      srcos: {}
      srcuser: {}
      state: {}
      streetaddress: {}
      subcategory: {}
      subscriptionassignedby: {}
      subscriptioncreatedby: {}
      subscriptioncreatedon: {}
      subscriptiondescription: {}
      subscriptionid: {}
      subscriptionname: {}
      subscriptiontype: {}
      subscriptionupdatedby: {}
      subscriptionupdatedon: {}
      subtype: {}
      surname: {}
      systemdefault: {}
      systems: {}
      targetfirewallversion: {}
      tenantname: {}
      terminatedaction: {}
      threatactor: {}
      ticketcloseddate: {}
      ticketnumber: {}
      ticketopeneddate: {}
      title: {}
      triggeredsecurityprofile: {}
      type: {}
      uniqueports: {}
      urlsslverification: {}
      user: {}
      useraccountcontrol: {}
      username: {}
      vendorid: {}
      vendorproduct: {}
      vpcid: {}
      vulnerabilitycategory: {}
      workphone: {}
      xdralertcount: {}
      xdralerts: {}
      xdrassigneduseremail: {}
      xdrassigneduserprettyname: {}
      xdrdescription: {}
      xdrdetectiontime: {}
      xdrfileartifacts: {}
      xdrhighseverityalertcount: {}
      xdrhostcount: {}
      xdrincidentid: {}
      xdrlowseverityalertcount: {}
      xdrmediumseverityalertcount: {}
      xdrnetworkartifacts: {}
      xdrnotes: {}
      xdrresolvecomment: {}
      xdrstatus: {}
      xdrstatusv2: {}
      xdrurl: {}
      xdrusercount: {}
      zipcode: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2330,
          "y": 4800
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "93":
    id: "93"
    taskid: ce650a1b-76ed-4410-8070-0759c25036a1
    type: title
    task:
      id: ce650a1b-76ed-4410-8070-0759c25036a1
      version: -1
      name: Done Organization Unit
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "85"
      - "165"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1257.5,
          "y": 4385
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "94":
    id: "94"
    taskid: b49dfaf5-2dc7-42ae-84cd-df7c6498c27f
    type: regular
    task:
      id: b49dfaf5-2dc7-42ae-84cd-df7c6498c27f
      version: -1
      name: Save New Organization Tag to List
      description: Adds/Replaces a key in key/value store backed by an XSOAR list.
      scriptName: AddKeyToList
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "192"
    scriptarguments:
      allowDups: {}
      append:
        simple: "false"
      keyName:
        complex:
          root: Add New Organization Unit.Answers
          accessor: "0"
      listName:
        simple: ExpanseOrganizationUnitsToTag
      value:
        complex:
          root: Add New Organization Unit.Answers
          accessor: "1"
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: ou-
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: inputs.TagPrefix
                iscontext: true
              suffix: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2330,
          "y": 4315
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "95":
    id: "95"
    taskid: 830f88c5-941d-4c7a-81e3-1454291effb8
    type: regular
    task:
      id: 830f88c5-941d-4c7a-81e3-1454291effb8
      version: -1
      name: Create Tag in Expanse (if it doesn't exist already)
      description: Create a new tag in Expanse.
      script: '|||expanse-create-tag'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "99"
    scriptarguments:
      description:
        simple: Created by XSOAR for Organization Unit tagging
      name:
        complex:
          root: AssetTag
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -80,
          "y": 5240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "96":
    id: "96"
    taskid: 74e6a121-4c3e-4a04-8d1f-c397f13a980f
    type: condition
    task:
      id: 74e6a121-4c3e-4a04-8d1f-c397f13a980f
      version: -1
      name: Do We Have Tag To Use?
      description: Branch depending on the OU.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "166"
      false-positive:
      - "104"
      known-ou:
      - "103"
    separatecontext: false
    conditions:
    - label: known-ou
      condition:
      - - operator: isNotEqualString
          left:
            value:
              complex:
                root: OUToTagList
                transformers:
                - operator: getField
                  args:
                    field:
                      value:
                        simple: incident.expanseassetorganizationunit
                      iscontext: true
                - operator: SetIfEmpty
                  args:
                    applyIfEmpty: {}
                    defaultValue:
                      value:
                        simple: '**NoTag**'
            iscontext: true
          right:
            value:
              simple: '**NoTag**'
    - label: false-positive
      condition:
      - - operator: containsString
          left:
            value:
              simple: incident.expanseassetorganizationunit
            iscontext: true
          right:
            value:
              simple: False Positive
    view: |-
      {
        "position": {
          "x": 300,
          "y": 4840
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "99":
    id: "99"
    taskid: 7e86abf6-be3f-4a44-842d-7f5dd01c8056
    type: regular
    task:
      id: 7e86abf6-be3f-4a44-842d-7f5dd01c8056
      version: -1
      name: Tag Assets on Expanse with AssetTag
      description: Assign tags to Asset.
      script: '|||expanse-assign-tags-to-asset'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "175"
    scriptarguments:
      asset_id:
        complex:
          root: incident.expanseasset
          accessor: id
      asset_type:
        complex:
          root: incident.expanseasset
          accessor: assettype
      tag_names:
        complex:
          root: AssetTag
      tagnames:
        complex:
          root: AssetTag
      tags: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -80,
          "y": 5395
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "103":
    id: "103"
    taskid: ecafd518-1891-4e73-80c5-3fd7bd352022
    type: regular
    task:
      id: ecafd518-1891-4e73-80c5-3fd7bd352022
      version: -1
      name: Set AssetTag with Known OU Tag
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "95"
    scriptarguments:
      append:
        simple: "false"
      key:
        simple: AssetTag
      stringify: {}
      value:
        complex:
          root: OUToTagList
          transformers:
          - operator: getField
            args:
              field:
                value:
                  simple: incident.expanseassetorganizationunit
                iscontext: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 170,
          "y": 5060
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "104":
    id: "104"
    taskid: 28fe8e34-959f-44c2-8cf2-f6711605e816
    type: regular
    task:
      id: 28fe8e34-959f-44c2-8cf2-f6711605e816
      version: -1
      name: Set AssetTag with False Positive Tag from Inputs
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "95"
    scriptarguments:
      append:
        simple: "false"
      key:
        simple: AssetTag
      stringify: {}
      value:
        simple: ${inputs.FalsePositiveTag}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -267.5,
          "y": 5060
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "105":
    id: "105"
    taskid: a14e7fb3-548a-4022-8cc1-4fffc8b3e67f
    type: regular
    task:
      id: a14e7fb3-548a-4022-8cc1-4fffc8b3e67f
      version: -1
      name: Link Incidents
      description: commands.local.cmd.linkIncidents
      script: Builtin|||linkIncidents
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "179"
    scriptarguments:
      action:
        simple: link
      incidentId: {}
      linkedIncidentIDs:
        complex:
          root: CreatedIncidentID
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 4610,
          "y": 8875
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "106":
    id: "106"
    taskid: 869fb602-13ca-4f45-884d-3c3990e12b0a
    type: regular
    task:
      id: 869fb602-13ca-4f45-884d-3c3990e12b0a
      version: -1
      name: Copy Suggestion Notes to Created Incident
      description: Copy notes from current incident to a remote incident
      scriptName: CopyNotesToIncident
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "86"
    scriptarguments:
      tags:
        simple: ExpanseSuggestion
      target_incident:
        complex:
          root: CreatedIncidentID
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 4610,
          "y": 9305
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "108":
    id: "108"
    taskid: cb8b1c13-5157-49ff-8eab-c87acda169f3
    type: regular
    task:
      id: cb8b1c13-5157-49ff-8eab-c87acda169f3
      version: -1
      name: Print Prisma Cloud suggestions
      description: Convert an array to a nice table display. Usually, from the context.
      tags:
      - ExpanseSuggestion
      scriptName: ToTable
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "48"
    scriptarguments:
      columns: {}
      data:
        complex:
          root: PrismaCloud
          accessor: Attribution
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty:
                value:
                  simple: "true"
              defaultValue:
                value:
                  simple: '**NOTFOUND**'
          - operator: DT
            args:
              dt:
                value:
                  simple: .=foo(val);function foo(aa) { if(val == '**NOTFOUND**')
                    { return [{"value":"No results found"}]} else return val;}
      title:
        simple: List of related assets discovered in Prisma Cloud
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2350,
          "y": 3160
        }
      }
    note: true
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "109":
    id: "109"
    taskid: a550d800-3579-47e9-86cc-4f376fb3ba6c
    type: title
    task:
      id: a550d800-3579-47e9-86cc-4f376fb3ba6c
      version: -1
      name: Prisma Cloud Alert Detection
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "110"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -1180,
          "y": 5860
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "110":
    id: "110"
    taskid: 4083cbc8-0f6d-43b9-8629-a27b932670f9
    type: condition
    task:
      id: 4083cbc8-0f6d-43b9-8629-a27b932670f9
      version: -1
      name: Are assets in Prisma Cloud found?
      description: Check whether assets are found in Prisma Cloud
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "111"
      "yes":
      - "172"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: PrismaCloud
                accessor: Attribution
            iscontext: true
    view: |-
      {
        "position": {
          "x": -1180,
          "y": 6130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "111":
    id: "111"
    taskid: 92a309ef-c33c-4b00-8dcc-6de5338efce7
    type: title
    task:
      id: 92a309ef-c33c-4b00-8dcc-6de5338efce7
      version: -1
      name: Done Prisma Cloud Alert Detection
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "75"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -1180,
          "y": 9555
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "116":
    id: "116"
    taskid: 10dc439e-3f13-4847-8b6a-db9e4e1948e8
    type: regular
    task:
      id: 10dc439e-3f13-4847-8b6a-db9e4e1948e8
      version: -1
      name: Create DG Tag in Expanse (if it doesn't already exist)
      description: Create a new tag in Expanse.
      script: '|||expanse-create-tag'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "194"
    scriptarguments:
      description:
        simple: Created by XSOAR for Device Group tagging
      name:
        complex:
          root: DGTagValue
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2495,
          "y": 8835
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "118":
    id: "118"
    taskid: 235436c2-d599-4c07-8403-af69e949712e
    type: regular
    task:
      id: 235436c2-d599-4c07-8403-af69e949712e
      version: -1
      name: Save DG Tag to List
      description: Adds/Replaces a key in key/value store backed by an XSOAR list.
      scriptName: AddKeyToList
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "169"
    scriptarguments:
      allowDups: {}
      append:
        simple: "false"
      keyName:
        complex:
          root: TargetDG
      listName:
        complex:
          root: inputs.FirewallTagListName
      value:
        complex:
          root: DGTagValue
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2752.5,
          "y": 8490
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "119":
    id: "119"
    taskid: f815157d-8c02-44ab-8849-b11b6181b519
    type: condition
    task:
      id: f815157d-8c02-44ab-8849-b11b6181b519
      version: -1
      name: Determine Target
      description: Determine the target Device Group
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      ADD-NEW:
      - "18"
      MANUAL:
      - "14"
      NO-PANORAMA:
      - "10"
      known-device-group:
      - "199"
    separatecontext: false
    conditions:
    - label: ADD-NEW
      condition:
      - - operator: containsString
          left:
            value:
              complex:
                root: Choose Device Group.Answers
                accessor: "0"
            iscontext: true
          right:
            value:
              simple: Add New
    - label: MANUAL
      condition:
      - - operator: containsString
          left:
            value:
              complex:
                root: Choose Device Group.Answers
                accessor: "0"
            iscontext: true
          right:
            value:
              simple: Manual Configuration
    - label: NO-PANORAMA
      condition:
      - - operator: containsString
          left:
            value:
              complex:
                root: Choose Device Group.Answers
                accessor: "0"
            iscontext: true
          right:
            value:
              simple: Firewall Only (No Panorama)
    - label: known-device-group
      condition:
      - - operator: isNotEqualString
          left:
            value:
              complex:
                root: FirewallTagList
                transformers:
                - operator: getField
                  args:
                    field:
                      value:
                        simple: Choose Device Group.Answers.0
                      iscontext: true
                - operator: SetIfEmpty
                  args:
                    applyIfEmpty: {}
                    defaultValue:
                      value:
                        simple: '**NoTag**'
            iscontext: true
          right:
            value:
              simple: '**NoTag**'
    view: |-
      {
        "position": {
          "x": 2055,
          "y": 7785
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "120":
    id: "120"
    taskid: 2d568b42-0ca8-4a89-8cca-258621529bae
    type: collection
    task:
      id: 2d568b42-0ca8-4a89-8cca-258621529bae
      version: -1
      name: Insert Device Group name and tag
      description: Collect Device Group information from user.
      type: collection
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "140"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2752.5,
          "y": 8060
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    message:
      to:
        simple: Analyst
      subject:
        simple: Select Device Group Name and Tag
      body:
        simple: Select Device Group Name and Tag
      methods: []
      format: ""
      bcc:
      cc:
      timings:
        retriescount: 2
        retriesinterval: 360
        completeafterreplies: 1
    form:
      questions:
      - id: "0"
        label: ""
        labelarg:
          simple: Insert Device Group Name
        required: true
        gridcolumns: []
        defaultrows: []
        type: shortText
        options: []
        optionsarg: []
        fieldassociated: ""
        placeholder: ""
        tooltip: The Device Group must be managed by Panorama
        readonly: false
      - id: "1"
        label: ""
        labelarg:
          simple: Insert Expanse Tag (without prefix)
        required: true
        gridcolumns: []
        defaultrows: []
        type: shortText
        options: []
        optionsarg: []
        fieldassociated: ""
        placeholder: ""
        tooltip: The tag name will be added to the Expanse assets (prefix will be
          added automatically)
        readonly: false
      title: Choose Device Group Name and Tag
      description: Insert Device Group name to enforce this policy, and the corresponding
        tag to attach to the asset
      sender: ""
      expired: false
      totalanswers: 0
    skipunavailable: false
    quietmode: 0
  "121":
    id: "121"
    taskid: 8a530c01-2dfb-488d-830d-d3785d8061c3
    type: regular
    task:
      id: 8a530c01-2dfb-488d-830d-d3785d8061c3
      version: -1
      name: Refresh Assets
      description: |
        Script to refresh tags and attribution reasons of assets inside Expanse Issue. The script should be used inside the Expanse Issue incident context.
      scriptName: ExpanseRefreshIssueAssets
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "174"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2752.5,
          "y": 9160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "122":
    id: "122"
    taskid: 843cf650-061d-4ba9-8245-69c0c91280f2
    type: regular
    task:
      id: 843cf650-061d-4ba9-8245-69c0c91280f2
      version: -1
      name: Extract All Asset Tags from Expanse
      description: Set a value in context under the key you entered. If no value is
        entered, the script doesn't do anything.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "123"
    scriptarguments:
      append:
        simple: "false"
      key:
        simple: ExpanseAllAssetTags
      stringify: {}
      value:
        complex:
          root: incident.expanseasset
          accessor: tags
          transformers:
          - operator: split
            args:
              delimiter:
                value:
                  simple: \n
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": -1130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "123":
    id: "123"
    taskid: a8625115-6ced-453c-8fe3-0e45bd042ae2
    type: regular
    task:
      id: a8625115-6ced-453c-8fe3-0e45bd042ae2
      version: -1
      name: Extract only XSOAR-related Asset Tags
      description: Set a value in context under the key you entered. If no value is
        entered, the script doesn't do anything.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "28"
    scriptarguments:
      append:
        simple: "false"
      key:
        simple: ExpanseXSOARAssetTags
      stringify: {}
      value:
        complex:
          root: ExpanseAllAssetTags
          filters:
          - - operator: startWith
              left:
                value:
                  simple: ExpanseAllAssetTags
                iscontext: true
              right:
                value:
                  simple: inputs.TagPrefix
                iscontext: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": -950
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "124":
    id: "124"
    taskid: 3cab733e-b6dc-4e8b-8a50-b67bcbfb0704
    type: regular
    task:
      id: 3cab733e-b6dc-4e8b-8a50-b67bcbfb0704
      version: -1
      name: Set Device Group Tag Prefix
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "125"
    scriptarguments:
      append:
        simple: "false"
      key:
        simple: XSOARTagDGPrefix
      stringify: {}
      value:
        complex:
          root: inputs.TagPrefix
          transformers:
          - operator: concat
            args:
              prefix: {}
              suffix:
                value:
                  simple: dg-
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1960,
          "y": 6310
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "125":
    id: "125"
    taskid: 1a978907-642c-4305-89ac-9f859f4491b5
    type: regular
    task:
      id: 1a978907-642c-4305-89ac-9f859f4491b5
      version: -1
      name: Find Device Group Tags
      description: Set a value in context under the key you entered. If no value is
        entered, the script doesn't do anything.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "1"
    scriptarguments:
      append:
        simple: "false"
      key:
        simple: ExpanseDeviceGroupAssetTags
      stringify: {}
      value:
        complex:
          root: ExpanseXSOARAssetTags
          filters:
          - - operator: startWith
              left:
                value:
                  simple: ExpanseXSOARAssetTags
                iscontext: true
              right:
                value:
                  simple: XSOARTagDGPrefix
                iscontext: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1960,
          "y": 6440
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "133":
    id: "133"
    taskid: c09dc9ae-4543-4c7f-8076-cd88ec39d3a0
    type: regular
    task:
      id: c09dc9ae-4543-4c7f-8076-cd88ec39d3a0
      version: -1
      name: Suggest No Shadow IT
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "158"
    scriptarguments:
      append:
        simple: "false"
      key:
        simple: SuggestedShadowITAnswer
      stringify: {}
      value:
        simple: "No"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1677.5,
          "y": 2605
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "135":
    id: "135"
    taskid: 25105084-c304-4a66-8409-9e8a4a52d263
    type: regular
    task:
      id: 25105084-c304-4a66-8409-9e8a4a52d263
      version: -1
      name: Set Shadow IT flag based on User response
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "93"
    scriptarguments:
      accountid: {}
      accountname: {}
      addLabels: {}
      agentid: {}
      app: {}
      appendMultiSelect: {}
      assetid: {}
      assigneduser: {}
      assignmentgroup: {}
      attachmentcount: {}
      attachmentextension: {}
      attachmenthash: {}
      attachmentid: {}
      attachmentname: {}
      attachmentsize: {}
      attachmenttype: {}
      blockedaction: {}
      bugtraq: {}
      caller: {}
      city: {}
      closeNotes: {}
      closeReason: {}
      cloudservice: {}
      commandline: {}
      costcenter: {}
      costcentercode: {}
      country: {}
      countryname: {}
      criticalassets: {}
      customFields: {}
      cve: {}
      cvss: {}
      dbotMirrorDirection: {}
      dbotMirrorId: {}
      dbotMirrorInstance: {}
      dbotMirrorTags: {}
      dbotprediction: {}
      dbotpredictionprobability: {}
      dbottextsuggestionhighlighted: {}
      deleteEmptyField: {}
      department: {}
      dest: {}
      desthostname: {}
      destinationhostname: {}
      destinationip: {}
      destinationnetwork: {}
      destinationport: {}
      destntdomain: {}
      destos: {}
      details: {}
      detectedexternalhosts: {}
      detectedexternalips: {}
      detectedinternalhosts: {}
      detectedinternalips: {}
      detectedusers: {}
      detectionendtime: {}
      detectionid: {}
      detectionupdatetime: {}
      detectionurl: {}
      deviceexternalip: {}
      devicehash: {}
      devicelocalip: {}
      devicemodel: {}
      devicename: {}
      displayname: {}
      duration: {}
      email: {}
      emailauthenticitycheck: {}
      emailbcc: {}
      emailbody: {}
      emailbodyformat: {}
      emailbodyhtml: {}
      emailcc: {}
      emailclassification: {}
      emailclientname: {}
      emailfrom: {}
      emailheaders: {}
      emailhtml: {}
      emailinreplyto: {}
      emailkeywords: {}
      emailmessageid: {}
      emailreceived: {}
      emailreplyto: {}
      emailreturnpath: {}
      emailsenderip: {}
      emailsize: {}
      emailsource: {}
      emailsubject: {}
      emailto: {}
      emailtocount: {}
      emailurlclicked: {}
      employeedisplayname: {}
      employeeemail: {}
      employeemanageremail: {}
      escalation: {}
      eventaction: {}
      eventid: {}
      eventtype: {}
      expanseactivitystatus: {}
      expanseasset: {}
      expanseassetorganizationunit: {}
      expanseassetowner: {}
      expanseassignee: {}
      expansebusinessunits: {}
      expansecategory: {}
      expansecertificate: {}
      expansecreated: {}
      expansedomain: {}
      expanseinitialevidence: {}
      expanseip: {}
      expanseissueid: {}
      expanseissuetype: {}
      expanselatestevidence: {}
      expansemodified: {}
      expanseport: {}
      expansepriority: {}
      expanseprogressstatus: {}
      expanseprotocol: {}
      expanseprovider: {}
      expanseshadowit:
        complex:
          root: Analysis of Asset Attribution.Answers
          accessor: "1"
          transformers:
          - operator: If-Then-Else
            args:
              else:
                value:
                  simple: "false"
              equals:
                value:
                  simple: "Yes"
              then:
                value:
                  simple: "true"
      expansetags: {}
      externaladdresses: {}
      filehash: {}
      filename: {}
      filepath: {}
      filesize: {}
      firstname: {}
      firstseen: {}
      givenname: {}
      helloworldid: {}
      helloworldstatus: {}
      helloworldtype: {}
      hostname: {}
      id: {}
      incomingmirrorerror: {}
      infectedhosts: {}
      internaladdresses: {}
      investigationstage: {}
      isolated: {}
      jobcode: {}
      jobfamily: {}
      jobfunction: {}
      labels: {}
      lastmodifiedby: {}
      lastmodifiedon: {}
      lastname: {}
      lastseen: {}
      leadership: {}
      location: {}
      locationregion: {}
      logsource: {}
      macaddress: {}
      maliciousbehavior: {}
      malwarefamily: {}
      malwarename: {}
      manageremailaddress: {}
      managername: {}
      md5: {}
      mobiledevicemodel: {}
      mobilephone: {}
      name: {}
      occurred: {}
      os: {}
      osversion: {}
      outgoingmirrorerror: {}
      owner: {}
      parentprocessid: {}
      personalemail: {}
      phase: {}
      phishingsubtype: {}
      phonenumber: {}
      pid: {}
      policydeleted: {}
      policydescription: {}
      policydetails: {}
      policyid: {}
      policyrecommendation: {}
      policyremediable: {}
      policyseverity: {}
      policytype: {}
      prismacloudid: {}
      prismacloudreason: {}
      prismacloudrules: {}
      prismacloudstatus: {}
      prismacloudtime: {}
      protocol: {}
      protocols: {}
      quarantined: {}
      rating: {}
      region: {}
      regionid: {}
      replacePlaybook: {}
      reporteremailaddress: {}
      resourceapiname: {}
      resourcecloudtype: {}
      resourceid: {}
      resourcename: {}
      resourcetype: {}
      riskrating: {}
      riskscore: {}
      roles: {}
      rrn: {}
      samaccountname: {}
      severity: {}
      sha256: {}
      shadowitaccountowneremail: {}
      shadowitaccountownername: {}
      shadowitbilledtocorp: {}
      shadowitcertificate: {}
      shadowitcloudaccountid: {}
      shadowitcloudaccounttype: {}
      shadowitfqdn: {}
      shadowitip: {}
      shadowitorganizationalunit: {}
      shadowitoucontactemail: {}
      shadowitoucontactname: {}
      shadowitport: {}
      shadowitprovider: {}
      shadowitrisk: {}
      shadowitsactionedservice: {}
      shadowitsource: {}
      shadowusersuggestions: {}
      signature: {}
      skuname: {}
      skutier: {}
      sla: {}
      slaField: {}
      sourcehostname: {}
      sourceip: {}
      sourcenetwork: {}
      sourceport: {}
      sourceusername: {}
      src: {}
      srchostname: {}
      srcntdomain: {}
      srcos: {}
      srcuser: {}
      state: {}
      streetaddress: {}
      subcategory: {}
      subscriptionassignedby: {}
      subscriptioncreatedby: {}
      subscriptioncreatedon: {}
      subscriptiondescription: {}
      subscriptionid: {}
      subscriptionname: {}
      subscriptiontype: {}
      subscriptionupdatedby: {}
      subscriptionupdatedon: {}
      subtype: {}
      surname: {}
      systemdefault: {}
      systems: {}
      targetfirewallversion: {}
      tenantname: {}
      terminatedaction: {}
      threatactor: {}
      ticketcloseddate: {}
      ticketnumber: {}
      ticketopeneddate: {}
      title: {}
      triggeredsecurityprofile: {}
      type: {}
      uniqueports: {}
      urlsslverification: {}
      user: {}
      useraccountcontrol: {}
      username: {}
      vendorid: {}
      vendorproduct: {}
      vpcid: {}
      vulnerabilitycategory: {}
      workphone: {}
      xdralertcount: {}
      xdralerts: {}
      xdrassigneduseremail: {}
      xdrassigneduserprettyname: {}
      xdrdescription: {}
      xdrdetectiontime: {}
      xdrfileartifacts: {}
      xdrhighseverityalertcount: {}
      xdrhostcount: {}
      xdrincidentid: {}
      xdrlowseverityalertcount: {}
      xdrmediumseverityalertcount: {}
      xdrnetworkartifacts: {}
      xdrnotes: {}
      xdrresolvecomment: {}
      xdrstatus: {}
      xdrstatusv2: {}
      xdrurl: {}
      xdrusercount: {}
      zipcode: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 650,
          "y": 4210
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "136":
    id: "136"
    taskid: 87450fbe-24b8-4f11-8112-703ebb10c1f5
    type: condition
    task:
      id: 87450fbe-24b8-4f11-8112-703ebb10c1f5
      version: -1
      name: Did User reply to the Shadow IT question?
      description: Check whether user answered to the Shadow IT question.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "93"
      "yes":
      - "135"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: notContainsString
          left:
            value:
              complex:
                root: Analysis of Asset Attribution.Answers
                accessor: "1"
            iscontext: true
          right:
            value:
              simple: Undecided
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 297.5,
          "y": 3510
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "140":
    id: "140"
    taskid: 89a32cfc-1c3f-41ca-87ee-52a366cea8c0
    type: regular
    task:
      id: 89a32cfc-1c3f-41ca-87ee-52a366cea8c0
      version: -1
      name: Set Device Group Tag Value
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "198"
    scriptarguments:
      append:
        simple: "false"
      key:
        simple: DGTagValue
      stringify: {}
      value:
        complex:
          root: Choose Device Group Name and Tag.Answers
          accessor: "1"
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: dg-
              suffix: {}
          - operator: concat
            args:
              prefix:
                value:
                  simple: inputs.TagPrefix
                iscontext: true
              suffix: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2752.5,
          "y": 8210
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "141":
    id: "141"
    taskid: d689b5e0-23c1-4df3-807f-9ff0e5e5f84a
    type: regular
    task:
      id: d689b5e0-23c1-4df3-807f-9ff0e5e5f84a
      version: -1
      name: Get Expanse Comments
      description: Retrieve issue comments (subset of updates)
      script: '|||expanse-get-issue-comments'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "29"
    scriptarguments:
      created_after: {}
      issue_id:
        complex:
          root: incident
          accessor: expanseissueid
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1070,
          "y": -460
        }
      }
    note: true
    evidencedata:
      description:
        simple: Issue Comments in Expanse
      customfields: {}
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "147":
    id: "147"
    taskid: adb0c0db-f712-4dde-8a6d-dd0a19a58a7b
    type: title
    task:
      id: adb0c0db-f712-4dde-8a6d-dd0a19a58a7b
      version: -1
      name: Done Validation
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "62"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1297.5,
          "y": 1230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "151":
    id: "151"
    taskid: baa6de02-9300-4422-8318-c06cde0569a2
    type: regular
    task:
      id: baa6de02-9300-4422-8318-c06cde0569a2
      version: -1
      name: 'Set Shadow IT Condition variable: On Prisma Cloud?'
      description: Set a value in context under the key you entered. If no value is
        entered, the script doesn't do anything.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "155"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: ShadowITCondition
      stringify: {}
      value:
        complex:
          root: PrismaCloud
          accessor: Attribution
          transformers:
          - operator: count
          - operator: If-Then-Else
            args:
              else:
                value:
                  simple: '{"condition":"Asset found on Prisma Cloud", "value":true}'
              equals:
                value:
                  simple: "0"
              then:
                value:
                  simple: '{"condition":"Asset found on Prisma Cloud", "value":false}'
          - operator: ParseJSON
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 712.5,
          "y": 1870
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "152":
    id: "152"
    taskid: 0e906644-500e-4d74-8af9-14249b09fb92
    type: regular
    task:
      id: 0e906644-500e-4d74-8af9-14249b09fb92
      version: -1
      name: 'Set Shadow IT Condition variable: On Prem high confidence to True'
      description: Set a value in context under the key you entered. If no value is
        entered, the script doesn't do anything.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "155"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: ShadowITCondition
      stringify: {}
      value:
        complex:
          root: UNEXISTINGFIELD
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: '{"condition":"Asset is On Prem with high confidence", "value":true}'
          - operator: ParseJSON
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1070,
          "y": 2040
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "153":
    id: "153"
    taskid: 2dfe4f71-5345-4f65-8e38-a8cf6b6ad286
    type: regular
    task:
      id: 2dfe4f71-5345-4f65-8e38-a8cf6b6ad286
      version: -1
      name: 'Set Shadow IT Condition variable: any Firewall exposing service?'
      description: Set a value in context under the key you entered. If no value is
        entered, the script doesn't do anything.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "155"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: ShadowITCondition
      stringify: {}
      value:
        complex:
          root: Expanse.AttributionDevice
          filters:
          - - operator: isEqualString
              left:
                value:
                  simple: Expanse.AttributionDevice.exposing_service
                iscontext: true
              right:
                value:
                  simple: "true"
              ignorecase: true
          transformers:
          - operator: count
          - operator: If-Then-Else
            args:
              else:
                value:
                  simple: '{"condition":"Found Firewall exposing service", "value":true}'
              equals:
                value:
                  simple: "0"
              then:
                value:
                  simple: '{"condition":"Found Firewall exposing service", "value":false}'
          - operator: ParseJSON
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1922.5,
          "y": 1870
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "154":
    id: "154"
    taskid: 685a3514-b573-44e6-8636-0a5cf81945e8
    type: title
    task:
      id: 685a3514-b573-44e6-8636-0a5cf81945e8
      version: -1
      name: Set up Shadow IT Condition Variables for report
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "151"
      - "153"
      - "156"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1297.5,
          "y": 1680
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "155":
    id: "155"
    taskid: f90bd3d0-2b0b-4cc5-8ed2-93fcd51be598
    type: title
    task:
      id: f90bd3d0-2b0b-4cc5-8ed2-93fcd51be598
      version: -1
      name: Done Setting up Shadow IT Conditions for Report
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "59"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1297.5,
          "y": 2220
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "156":
    id: "156"
    taskid: 27a42fda-44c4-424e-86fe-9e77ccaf9c71
    type: condition
    task:
      id: 27a42fda-44c4-424e-86fe-9e77ccaf9c71
      version: -1
      name: On-prem with high confidence?
      description: Check whether the asset is market as on prem with a high degree
        of confidence.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "157"
      "yes":
      - "152"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: incident
                accessor: expanseprovider
            iscontext: true
          right:
            value:
              simple: On Prem
      - - operator: isEqualNumber
          left:
            value:
              complex:
                root: ExpanseAllAssetTags
                filters:
                - - operator: inList
                    left:
                      value:
                        simple: ExpanseAllAssetTags
                      iscontext: true
                    right:
                      value:
                        simple: IPRangeLowConfidenceTag
                      iscontext: true
                transformers:
                - operator: count
            iscontext: true
          right:
            value:
              simple: "0"
    view: |-
      {
        "position": {
          "x": 1297.5,
          "y": 1860
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "157":
    id: "157"
    taskid: 182c0bd6-80c5-4a09-8e64-2e32cea65c24
    type: regular
    task:
      id: 182c0bd6-80c5-4a09-8e64-2e32cea65c24
      version: -1
      name: 'Set Shadow IT Condition variable: On Prem high confidence to False'
      description: Set a value in context under the key you entered. If no value is
        entered, the script doesn't do anything.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "155"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: ShadowITCondition
      stringify: {}
      value:
        complex:
          root: UNEXISTINGFIELD
          transformers:
          - operator: SetIfEmpty
            args:
              applyIfEmpty: {}
              defaultValue:
                value:
                  simple: '{"condition":"Asset is On Prem with high confidence", "value":false}'
          - operator: ParseJSON
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1517.5,
          "y": 2040
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "158":
    id: "158"
    taskid: 7c27cc76-181d-4333-8394-bc7616434b6c
    type: regular
    task:
      id: 7c27cc76-181d-4333-8394-bc7616434b6c
      version: -1
      name: Generate Report for Attribution
      description: 'Print '
      scriptName: ExpansePrintSuggestions
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "63"
    scriptarguments:
      expanse_asset_tags:
        complex:
          root: ExpanseAllAssetTags
      expanse_business_units:
        complex:
          root: incident
          accessor: expansebusinessunits
      expanse_devices:
        complex:
          root: Expanse
          accessor: AttributionDevice
      expanse_ips:
        complex:
          root: Expanse
          accessor: AttributionIP
      expanse_issue_tags:
        complex:
          root: incident
          accessor: expansetags
      expanse_users:
        complex:
          root: Expanse
          accessor: AttributionUser
      fqdn:
        complex:
          root: incident
          accessor: expansedomain
      ip:
        complex:
          root: incident
          accessor: expanseip
      port:
        complex:
          root: incident
          accessor: expanseport
      prisma_cloud_assets:
        complex:
          root: PrismaCloud
          accessor: Attribution
      provider:
        complex:
          root: incident
          accessor: expanseprovider
      region:
        complex:
          root: incident
          accessor: expanseregion
      service:
        complex:
          root: incident
          accessor: expanseservice
      shadow_it:
        complex:
          root: ShadowITCondition
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1297.5,
          "y": 2780
        }
      }
    note: true
    evidencedata:
      description:
        simple: Expanse Enrichment Information
      customfields: {}
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "159":
    id: "159"
    taskid: baa647b7-5226-47d3-8b43-d9382a62a330
    type: regular
    task:
      id: baa647b7-5226-47d3-8b43-d9382a62a330
      version: -1
      name: 'Extract XSOAR Incident Tags related to OU Attribtion '
      description: Set a value in context under the key you entered. If no value is
        entered, the script doesn't do anything.
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "28"
    scriptarguments:
      append: {}
      key:
        simple: ExpanseXSOAROUIssueTags
      stringify: {}
      value:
        complex:
          root: ExpanseXSOARIssueTags
          filters:
          - - operator: StringContainsArray
              left:
                value:
                  simple: ExpanseXSOARIssueTags
                iscontext: true
              right:
                value:
                  simple: -ou-
              ignorecase: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 907.5,
          "y": -1130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "161":
    id: "161"
    taskid: 23c457ff-df33-49df-833e-750deb5a3fb8
    type: regular
    task:
      id: 23c457ff-df33-49df-833e-750deb5a3fb8
      version: -1
      name: Set Progress Status to Investigating in Expanse issue
      description: Update Expanse issue.
      script: '|||expanse-update-issue'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "162"
    scriptarguments:
      issue_id:
        complex:
          root: incident
          accessor: expanseissueid
      update_type:
        simple: ProgressStatus
      value:
        simple: Investigating
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1740,
          "y": -1840
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "162":
    id: "162"
    taskid: 34ad51a2-ea5c-4b42-8bcd-ac8949aefcce
    type: regular
    task:
      id: 34ad51a2-ea5c-4b42-8bcd-ac8949aefcce
      version: -1
      name: Add "Being investigated by XSOAR" comment to Expanse issue
      description: Update Expanse issue.
      script: '|||expanse-update-issue'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "5"
    scriptarguments:
      issue_id:
        complex:
          root: incident
          accessor: expanseissueid
      update_type:
        simple: Comment
      value:
        simple: This Issue is being investigated by the SOC through Cortex XSOAR
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1740,
          "y": -1680
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "163":
    id: "163"
    taskid: da57cc06-4744-4127-89c2-bf1b17a51ab5
    type: condition
    task:
      id: da57cc06-4744-4127-89c2-bf1b17a51ab5
      version: -1
      name: Are we writing to Expanse?
      description: Determine whether playbook should write data back to Expanse.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "5"
      "yes":
      - "161"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.WriteToExpanse
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 1327.5,
          "y": -2040
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "164":
    id: "164"
    taskid: 6479c0e7-81eb-47bf-8ec8-2edffac23a7a
    type: condition
    task:
      id: 6479c0e7-81eb-47bf-8ec8-2edffac23a7a
      version: -1
      name: Are we writing to Expanse?
      description: Determine whether playbook should write data back to Expanse.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "166"
      "yes":
      - "96"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.WriteToExpanse
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 610,
          "y": 4670
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "165":
    id: "165"
    taskid: 1f2c14c2-483f-4860-8a32-23759e2eeeef
    type: title
    task:
      id: 1f2c14c2-483f-4860-8a32-23759e2eeeef
      version: -1
      name: Tag Assets
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "164"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 610,
          "y": 4530
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "166":
    id: "166"
    taskid: caed24cd-e6d8-4f6b-81e4-fbbadac96709
    type: title
    task:
      id: caed24cd-e6d8-4f6b-81e4-fbbadac96709
      version: -1
      name: Done Tagging
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "30"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 610,
          "y": 5580
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "167":
    id: "167"
    taskid: dce3d124-8262-4302-88a2-77c7bc00bb6d
    type: playbook
    task:
      id: dce3d124-8262-4302-88a2-77c7bc00bb6d
      version: -1
      name: Extract and Enrich Expanse Indicators
      description: Extract and Enrich Indicators (CIDRs, IPs, Certificates and Domains)
        from an Expanse Issue
      playbookName: Extract and Enrich Expanse Indicators
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "29"
    scriptarguments:
      Create Indicators:
        simple: "true"
      Expanse Assets:
        complex:
          root: incident
          accessor: expanseasset
      Expanse IP:
        complex:
          root: incident
          accessor: expanseip
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 1620,
          "y": -460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "169":
    id: "169"
    taskid: b9ebb5c4-33ee-46d3-81e7-0a8c9b10b9d2
    type: condition
    task:
      id: b9ebb5c4-33ee-46d3-81e7-0a8c9b10b9d2
      version: -1
      name: Are we writing to Expanse?
      description: Determine whether playbook should write data back to Expanse.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "yes":
      - "116"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.WriteToExpanse
            iscontext: true
          right:
            value:
              simple: "True"
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 2752.5,
          "y": 8660
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "172":
    id: "172"
    taskid: 8028156d-0d7f-46a7-889d-5ba9732c737c
    type: playbook
    task:
      id: 8028156d-0d7f-46a7-889d-5ba9732c737c
      version: -1
      name: Prisma Cloud Correlate Alerts
      playbookName: Prisma Cloud Correlate Alerts
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "111"
    scriptarguments:
      Link Incidents:
        simple: "True"
      Prisma Cloud Attribution:
        complex:
          root: PrismaCloud
          accessor: Attribution
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": -1600,
          "y": 7460
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "173":
    id: "173"
    taskid: 29ba3e6d-66a0-47a6-85ef-96c30e206c0e
    type: regular
    task:
      id: 29ba3e6d-66a0-47a6-85ef-96c30e206c0e
      version: -1
      name: Refresh Assets
      description: |
        Script to refresh tags and attribution reasons of assets inside Expanse Issue. The script should be used inside the Expanse Issue incident context.
      scriptName: ExpanseRefreshIssueAssets
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "122"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": -1305
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "174":
    id: "174"
    taskid: 2789fc33-86f2-48a8-81ad-d3cbc81605be
    type: title
    task:
      id: 2789fc33-86f2-48a8-81ad-d3cbc81605be
      version: -1
      name: Done DG Tagging
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "10"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2752.5,
          "y": 9305
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "175":
    id: "175"
    taskid: 62164524-366d-4045-83c4-f349a6bfd5ab
    type: regular
    task:
      id: 62164524-366d-4045-83c4-f349a6bfd5ab
      version: -1
      name: Refresh Assets
      description: |
        Script to refresh tags and attribution reasons of assets inside Expanse Issue. The script should be used inside the Expanse Issue incident context.
      scriptName: ExpanseRefreshIssueAssets
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "166"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -80,
          "y": 5550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "176":
    id: "176"
    taskid: 31f9a6a6-3bfb-40f0-8476-489ff444f36c
    type: condition
    task:
      id: 31f9a6a6-3bfb-40f0-8476-489ff444f36c
      version: -1
      name: Collect Risky Flows from Behavior?
      description: Collect Risky Flows for the IP address from Expanse Behavior?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "29"
      "yes":
      - "31"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: inputs.UseBehavior
            iscontext: true
          right:
            value:
              simple: "true"
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 620,
          "y": -590
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "177":
    id: "177"
    taskid: 626a3ba8-23a2-47b3-8be3-ccb712ef6e0f
    type: condition
    task:
      id: 626a3ba8-23a2-47b3-8be3-ccb712ef6e0f
      version: -1
      name: Create Shadow IT Incident automatically?
      description: If the ShadowITIncidentType input is set, an incident of this type
        is automatically created and notes are copied to it.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "178"
      "yes":
      - "74"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: inputs.ShadowITIncidentType
            iscontext: true
    view: |-
      {
        "position": {
          "x": 4222.5,
          "y": 8500
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "178":
    id: "178"
    taskid: 42cb95e5-ff1e-4c72-861b-f71a5caa3f8f
    type: regular
    task:
      id: 42cb95e5-ff1e-4c72-861b-f71a5caa3f8f
      version: -1
      name: Manually create Shadow IT Incident
      description: Manually create an Incident to handle the Shadow IT investigation.
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "86"
    separatecontext: false
    defaultassigneecomplex: {}
    view: |-
      {
        "position": {
          "x": 4060,
          "y": 8680
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "179":
    id: "179"
    taskid: 1f058f6d-7228-48b7-8114-c852a86debe3
    type: regular
    task:
      id: 1f058f6d-7228-48b7-8114-c852a86debe3
      version: -1
      name: Set Shadow IT Pack Incident Fields
      description: If the Shadow IT content pack is enabled and the Shadow IT incident
        fields are provided, this tasks sets the fields accordingly. If the Pack is
        not enabled, no change happens.
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "106"
    scriptarguments:
      accountid: {}
      accountname: {}
      addLabels: {}
      agentid: {}
      alertid: {}
      alertname: {}
      app: {}
      appendMultiSelect: {}
      applicationid: {}
      applicationname: {}
      assetid: {}
      assigneduser: {}
      assignmentgroup: {}
      attachmentcount: {}
      attachmentextension: {}
      attachmenthash: {}
      attachmentid: {}
      attachmentname: {}
      attachmentsize: {}
      attachmenttype: {}
      blockedaction: {}
      bugtraq: {}
      caller: {}
      categorycount: {}
      city: {}
      closeNotes: {}
      closeReason: {}
      closetime: {}
      closingreason: {}
      closinguser: {}
      cloudservice: {}
      commandline: {}
      compliancenotes: {}
      costcenter: {}
      costcentercode: {}
      country: {}
      countryname: {}
      criticalassets: {}
      customFields: {}
      cve: {}
      cvss: {}
      cvssavailabilityrequirement: {}
      cvsscollateraldamagepotential: {}
      cvssconfidentialityrequirement: {}
      cvssintegrityrequirement: {}
      dbotMirrorDirection: {}
      dbotMirrorId: {}
      dbotMirrorInstance: {}
      dbotMirrorTags: {}
      dbotprediction: {}
      dbotpredictionprobability: {}
      dbottextsuggestionhighlighted: {}
      deleteEmptyField: {}
      department: {}
      dest: {}
      desthostname: {}
      destinationgeolocation: {}
      destinationhostname: {}
      destinationip: {}
      destinationips: {}
      destinationipv6: {}
      destinationmacaddress: {}
      destinationnetwork: {}
      destinationport: {}
      destntdomain: {}
      destos: {}
      details: {}
      detectedexternalhosts: {}
      detectedexternalips: {}
      detectedinternalhosts: {}
      detectedinternalips: {}
      detectedusers: {}
      detectionendtime: {}
      detectionid: {}
      detectionupdatetime: {}
      detectionurl: {}
      deviceexternalip: {}
      devicehash: {}
      devicelocalip: {}
      devicemodel: {}
      devicename: {}
      devicetime: {}
      displayname: {}
      dnsname: {}
      dstports: {}
      duration: {}
      email: {}
      emailauthenticitycheck: {}
      emailbcc: {}
      emailbody: {}
      emailbodyformat: {}
      emailbodyhtml: {}
      emailcc: {}
      emailclassification: {}
      emailclientname: {}
      emailfrom: {}
      emailheaders: {}
      emailhtml: {}
      emailhtmlimage: {}
      emailinreplyto: {}
      emailkeywords: {}
      emaillabels: {}
      emaillatestmessage: {}
      emailmessageid: {}
      emailreceived: {}
      emailreplyto: {}
      emailreturnpath: {}
      emailsenderip: {}
      emailsize: {}
      emailsource: {}
      emailsubject: {}
      emailto: {}
      emailtocount: {}
      emailurlclicked: {}
      employeedisplayname: {}
      employeeemail: {}
      employeemanageremail: {}
      errorcode: {}
      errormessage: {}
      escalation: {}
      eventaction: {}
      eventdescriptions: {}
      eventid: {}
      eventnames: {}
      events: {}
      eventtype: {}
      expanseactivitystatus: {}
      expanseasset: {}
      expanseassetorganizationunit: {}
      expanseassetowner: {}
      expanseassignee: {}
      expansebusinessunits: {}
      expansecategory: {}
      expansecertificate: {}
      expansecreated: {}
      expansedomain: {}
      expansegeolocation: {}
      expanseinitialevidence: {}
      expanseip: {}
      expanseissueid: {}
      expanseissuetype: {}
      expanselatestevidence: {}
      expanselatestevidencegeolocation: {}
      expansemlfeatures: {}
      expansemodified: {}
      expanseport: {}
      expansepriority: {}
      expanseprogressstatus: {}
      expanseprotocol: {}
      expanseprovider: {}
      expanseregion: {}
      expanseservice: {}
      expanseshadowit: {}
      expansetags: {}
      externaladdresses: {}
      filehash: {}
      filename: {}
      filepath: {}
      filesize: {}
      firstname: {}
      firstseen: {}
      followup: {}
      givenname: {}
      helloworldid: {}
      helloworldstatus: {}
      helloworldtype: {}
      highlevelcategories: {}
      hostname: {}
      id:
        complex:
          root: CreatedIncidentID
      incomingmirrorerror: {}
      infectedhosts: {}
      internaladdresses: {}
      investigationstage: {}
      isolated: {}
      jobcode: {}
      jobfamily: {}
      jobfunction: {}
      labels: {}
      lastmodifiedby: {}
      lastmodifiedon: {}
      lastname: {}
      lastseen: {}
      lastupdatetime: {}
      leadership: {}
      listofrulesevent: {}
      location: {}
      locationregion: {}
      logsource: {}
      logsourcename: {}
      logsourcetype: {}
      lowlevelcategoriesevents: {}
      macaddress: {}
      maliciousbehavior: {}
      malwarefamily: {}
      malwarename: {}
      manageremailaddress: {}
      managername: {}
      md5: {}
      mobiledevicemodel: {}
      mobilephone: {}
      name: {}
      numberoflogsources: {}
      occurred: {}
      os: {}
      osversion: {}
      outgoingmirrorerror: {}
      owner: {}
      parentprocessid: {}
      personalemail: {}
      phase: {}
      phishingsubtype: {}
      phonenumber: {}
      pid: {}
      policydeleted: {}
      policydescription: {}
      policydetails: {}
      policyid: {}
      policyrecommendation: {}
      policyremediable: {}
      policyseverity: {}
      policytype: {}
      postnatdestinationip: {}
      postnatdestinationport: {}
      postnatsourceip: {}
      postnatsourceport: {}
      prenatdestinationport: {}
      prenatsourceip: {}
      prenatsourceport: {}
      prismacloudid: {}
      prismacloudreason: {}
      prismacloudrules: {}
      prismacloudstatus: {}
      prismacloudtime: {}
      protocol: {}
      protocolevent: {}
      protocols: {}
      quarantined: {}
      rating: {}
      rawevent: {}
      region: {}
      regionid: {}
      replacePlaybook: {}
      reporteremailaddress: {}
      resourceapiname: {}
      resourcecloudtype: {}
      resourceid: {}
      resourcename: {}
      resourcetype: {}
      riskrating: {}
      riskscore: {}
      roles: {}
      rrn: {}
      samaccountname: {}
      severity: {}
      sha256: {}
      shadowitaccountowneremail: {}
      shadowitaccountownername: {}
      shadowitbilledtocorp: {}
      shadowitcertificate:
        complex:
          root: incident
          accessor: expansecertificate
      shadowitcloudaccountid: {}
      shadowitcloudaccounttype: {}
      shadowitfqdn:
        complex:
          root: incident
          accessor: expansedomain
      shadowitip:
        complex:
          root: incident
          accessor: expanseip
      shadowitorganizationalunit:
        complex:
          root: incident
          accessor: expanseassetorganizationunit
      shadowitoucontactemail:
        complex:
          root: lists
          accessor: ExpanseOrganizationUnitsToOwner
          transformers:
          - operator: getField
            args:
              field:
                value:
                  simple: incident.expanseassetorganizationunit
                iscontext: true
          - operator: ParseJSON
          - operator: getField
            args:
              field:
                value:
                  simple: email
      shadowitoucontactname:
        complex:
          root: lists
          accessor: ExpanseOrganizationUnitsToOwner
          transformers:
          - operator: getField
            args:
              field:
                value:
                  simple: incident.expanseassetorganizationunit
                iscontext: true
          - operator: ParseJSON
          - operator: getField
            args:
              field:
                value:
                  simple: name
      shadowitport:
        complex:
          root: incident
          accessor: expanseport
      shadowitprovider:
        complex:
          root: incident
          accessor: expanseprovider
      shadowitregion: {}
      shadowitrisk: {}
      shadowitsactionedservice: {}
      shadowitsensitivedata: {}
      shadowitservice: {}
      shadowitservicepurpose: {}
      shadowitsource:
        simple: Expanse
      shadowitusersuggestions:
        complex:
          root: Expanse.AttributionUser
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: Expanse.AttributionUser
                iscontext: true
          transformers:
          - operator: jmespath
            args:
              expression:
                value:
                  simple: '{name: username, email: mail, notes: join('' '', [''Found
                    '', to_string(sightings), '' log entries''])}'
      signature: {}
      skuname: {}
      skutier: {}
      sla: {}
      slaField: {}
      sourcegeolocation: {}
      sourcehostname: {}
      sourceip: {}
      sourceips: {}
      sourceipv6: {}
      sourcemacaddress: {}
      sourcenetwork: {}
      sourceport: {}
      sourceusername: {}
      src: {}
      srchostname: {}
      srcntdomain: {}
      srcos: {}
      srcports: {}
      srcuser: {}
      starttime: {}
      state: {}
      streetaddress: {}
      subcategory: {}
      subscriptionassignedby: {}
      subscriptioncreatedby: {}
      subscriptioncreatedon: {}
      subscriptiondescription: {}
      subscriptionid: {}
      subscriptionname: {}
      subscriptiontype: {}
      subscriptionupdatedby: {}
      subscriptionupdatedon: {}
      subtype: {}
      surname: {}
      systemdefault: {}
      systems: {}
      targetfirewallversion: {}
      technicalowner: {}
      technicalownercontact: {}
      technicaluser: {}
      tenantname: {}
      terminatedaction: {}
      threatactor: {}
      ticketcloseddate: {}
      ticketnumber: {}
      ticketopeneddate: {}
      title: {}
      trafficdirection: {}
      triggeredsecurityprofile: {}
      type: {}
      uniqueports: {}
      urlsslverification: {}
      user: {}
      useraccountcontrol: {}
      userid: {}
      username: {}
      usernames: {}
      vendorid: {}
      vendorproduct: {}
      vpcid: {}
      vulnerabilitycategory: {}
      workphone: {}
      xdralertcount: {}
      xdralerts: {}
      xdrassigneduseremail: {}
      xdrassigneduserprettyname: {}
      xdrdescription: {}
      xdrdetectiontime: {}
      xdrfileartifacts: {}
      xdrhighseverityalertcount: {}
      xdrhostcount: {}
      xdrincidentid: {}
      xdrlowseverityalertcount: {}
      xdrmediumseverityalertcount: {}
      xdrnetworkartifacts: {}
      xdrnotes: {}
      xdrresolvecomment: {}
      xdrstatus: {}
      xdrstatusv2: {}
      xdrurl: {}
      xdrusercount: {}
      zipcode: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 4610,
          "y": 9095
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "180":
    id: "180"
    taskid: c4f5b2a6-84e6-4ebd-81f6-df2aedc28aaf
    type: playbook
    task:
      id: c4f5b2a6-84e6-4ebd-81f6-df2aedc28aaf
      version: -1
      name: Enrich Cloud Assets
      playbookName: Enrich Cloud Assets
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "147"
    separatecontext: true
    view: |-
      {
        "position": {
          "x": 1637.5,
          "y": 420
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "184":
    id: "184"
    taskid: 731c7d3e-e986-4aec-8155-a8cbdc59b3c6
    type: regular
    task:
      id: 731c7d3e-e986-4aec-8155-a8cbdc59b3c6
      version: -1
      name: Save OU To Tag List
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "201"
    scriptarguments:
      append: {}
      key:
        simple: OUToTagList
      stringify: {}
      value:
        complex:
          root: ParsedList
          transformers:
          - operator: LastArrayElement
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2435,
          "y": -1130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "187":
    id: "187"
    taskid: 830be7e1-ea54-4928-89d9-473667975952
    type: regular
    task:
      id: 830be7e1-ea54-4928-89d9-473667975952
      version: -1
      name: Save OU To Owner List
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "202"
    scriptarguments:
      append: {}
      key:
        simple: OUToOwnerList
      stringify: {}
      value:
        complex:
          root: ParsedList
          transformers:
          - operator: LastArrayElement
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2435,
          "y": -770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "188":
    id: "188"
    taskid: ed1b5fd5-50a0-4977-8880-202bbf6c4b61
    type: regular
    task:
      id: ed1b5fd5-50a0-4977-8880-202bbf6c4b61
      version: -1
      name: Save Firewall Tag List
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "28"
    scriptarguments:
      append: {}
      key:
        simple: FirewallTagList
      stringify: {}
      value:
        complex:
          root: ParsedList
          transformers:
          - operator: LastArrayElement
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2435,
          "y": -420
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "190":
    id: "190"
    taskid: 420a4ae3-b10f-4f70-89f0-9e7f4482cdb4
    type: regular
    task:
      id: 420a4ae3-b10f-4f70-89f0-9e7f4482cdb4
      version: -1
      name: Reload OU To Owner List
      description: commands.local.cmd.list.get
      script: Builtin|||getList
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "191"
    scriptarguments:
      extend-context:
        simple: TempListText.OUToOwner=.
      listName:
        simple: ${inputs.OrganizationUnitsToOwnerName}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2330,
          "y": 4010
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "191":
    id: "191"
    taskid: f28577e3-5ae5-4e18-852e-e594782570b1
    type: regular
    task:
      id: f28577e3-5ae5-4e18-852e-e594782570b1
      version: -1
      name: Set OU To Owner List
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "94"
    scriptarguments:
      append:
        simple: "false"
      key:
        simple: OUToOwnerList
      stringify: {}
      value:
        complex:
          root: TempListText
          accessor: OUToOwner
          transformers:
          - operator: ParseJSON
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2330,
          "y": 4160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "192":
    id: "192"
    taskid: 8837eb58-a89c-4d47-820e-1f268ddc5cee
    type: regular
    task:
      id: 8837eb58-a89c-4d47-820e-1f268ddc5cee
      version: -1
      name: Reload OU To Tag List
      description: commands.local.cmd.list.get
      script: Builtin|||getList
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "193"
    scriptarguments:
      extend-context:
        simple: TempListText.OUToTag=.
      listName:
        simple: ${inputs.OrganizationUnitsToTagName}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2330,
          "y": 4485
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "193":
    id: "193"
    taskid: 84dc7a24-1f78-4b05-8407-669b57186d18
    type: regular
    task:
      id: 84dc7a24-1f78-4b05-8407-669b57186d18
      version: -1
      name: Set OU To Tag List
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "91"
    scriptarguments:
      append:
        simple: "false"
      key:
        simple: OUToTagList
      stringify: {}
      value:
        complex:
          root: TempListText
          accessor: OUToTag
          transformers:
          - operator: ParseJSON
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2330,
          "y": 4640
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "194":
    id: "194"
    taskid: 2165c08d-eef3-447a-83a6-769f66d19f9a
    type: regular
    task:
      id: 2165c08d-eef3-447a-83a6-769f66d19f9a
      version: -1
      name: Tag Assets on Expanse
      description: Assign tags to Asset.
      script: '|||expanse-assign-tags-to-asset'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "121"
    scriptarguments:
      asset_id:
        complex:
          root: incident.expanseasset
          accessor: id
      asset_type:
        complex:
          root: incident.expanseasset
          accessor: assettype
      tag_names:
        complex:
          root: DGTagValue
      tagnames:
        complex:
          root: NewDGTagName
      tags: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2495,
          "y": 8990
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "196":
    id: "196"
    taskid: 74757578-39d8-4f98-8c74-c7faef42b3df
    type: regular
    task:
      id: 74757578-39d8-4f98-8c74-c7faef42b3df
      version: -1
      name: Reload Device Group List
      description: commands.local.cmd.list.get
      script: Builtin|||getList
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "197"
    scriptarguments:
      extend-context:
        simple: TempListText.FirewallDG=.
      listName:
        complex:
          root: inputs.FirewallTagListName
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2055,
          "y": 7365
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "197":
    id: "197"
    taskid: 383e9503-d22b-4aa4-878b-f04f5e78f7d1
    type: regular
    task:
      id: 383e9503-d22b-4aa4-878b-f04f5e78f7d1
      version: -1
      name: Set Firewall Tag List
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      append:
        simple: "false"
      key:
        simple: FirewallTagList
      stringify: {}
      value:
        complex:
          root: TempListText
          accessor: FirewallDG
          transformers:
          - operator: ParseJSON
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2055,
          "y": 7495
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "198":
    id: "198"
    taskid: 67a43768-fb8b-432b-8b21-7f1baa26c90b
    type: regular
    task:
      id: 67a43768-fb8b-432b-8b21-7f1baa26c90b
      version: -1
      name: Set Target Device Group
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "118"
    scriptarguments:
      append:
        simple: "false"
      key:
        simple: TargetDG
      stringify: {}
      value:
        complex:
          root: Choose Device Group Name and Tag.Answers
          accessor: "0"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2752.5,
          "y": 8350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "199":
    id: "199"
    taskid: dd1004d1-0bfb-45f3-8bf3-ccc2f1ab8340
    type: regular
    task:
      id: dd1004d1-0bfb-45f3-8bf3-ccc2f1ab8340
      version: -1
      name: Set Device Group Tag Value
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "67"
    scriptarguments:
      append:
        simple: "false"
      key:
        simple: DGTagValue
      stringify: {}
      value:
        complex:
          root: FirewallTagList
          transformers:
          - operator: getField
            args:
              field:
                value:
                  simple: Choose Device Group.Answers.0
                iscontext: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2312.5,
          "y": 8210
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "200":
    id: "200"
    taskid: 460b0b5c-a088-4776-835b-0337e2fe6fbe
    type: playbook
    task:
      id: 460b0b5c-a088-4776-835b-0337e2fe6fbe
      version: -1
      name: Expanse Load-Create List
      playbookName: Expanse Load-Create List
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "184"
    scriptarguments:
      ListName:
        simple: ${inputs.OrganizationUnitsToTagName}
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 2435,
          "y": -1295
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "201":
    id: "201"
    taskid: c99e7f85-8763-42b1-8df3-2e7b80b31a5a
    type: playbook
    task:
      id: c99e7f85-8763-42b1-8df3-2e7b80b31a5a
      version: -1
      name: Expanse Load-Create List
      playbookName: Expanse Load-Create List
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "187"
    scriptarguments:
      ListName:
        simple: ${inputs.OrganizationUnitsToOwnerName}
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 2435,
          "y": -950
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
  "202":
    id: "202"
    taskid: 0388dcfe-8168-4177-8c81-51e1f0eb3a22
    type: playbook
    task:
      id: 0388dcfe-8168-4177-8c81-51e1f0eb3a22
      version: -1
      name: Expanse Load-Create List
      playbookName: Expanse Load-Create List
      type: playbook
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "188"
    scriptarguments:
      ListName:
        simple: ${inputs.FirewallTagListName}
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 2435,
          "y": -590
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
view: |-
  {
    "linkLabelsPosition": {
      "177_178_#default#": 0.62,
      "73_86_#default#": 0.11,
      "96_166_#default#": 0.4,
      "9_14_#default#": 0.69
    },
    "paper": {
      "dimensions": {
        "height": 13565,
        "width": 6590,
        "x": -1600,
        "y": -2180
      }
    }
  }
inputs:
- key: MinPriorityForAutoRemediation
  value:
    simple: "1"
  required: false
  description: |-
    Minimum Incident Priority for Auto Remediation:
    1 - Low
    2 - Medium
    3 - High
    4 - Critical
  playbookInputQuery:
- key: FirewallTagListName
  value:
    simple: ExpanseTagsToPANOSDeviceGroup
  required: false
  description: Name of XSOAR List that contains the mapping between Expanse tags and
    XSOAR PANOS Instances.
  playbookInputQuery:
- key: TagPrefix
  value:
    simple: xsoar-
  required: false
  description: Prefix for XSOAR related Expanse tags
  playbookInputQuery:
- key: LogForwarding
  value: {}
  required: false
  description: PAN-OS Log Forwarding Profile Name
  playbookInputQuery:
- key: AutoCommit
  value:
    simple: "Yes"
  required: false
  description: Panorama Auto Commit
  playbookInputQuery:
- key: IPRangeLowConfidenceTagList
  value:
    simple: low confidence
  required: false
  description: Comma separated list of tags to be used to identify IP ranges attributed
    with low confidence
  playbookInputQuery:
- key: FalsePositiveTag
  value:
    simple: xsoar-false-positive
  required: false
  description: Tag to be used for assets that do not belong to org
  playbookInputQuery:
- key: WriteToExpanse
  value:
    simple: "True"
  required: false
  description: Write data back to Expanse?
  playbookInputQuery:
- key: OwnerNotificationSubject
  value:
    simple: New security issue on a public service owned by your team
  required: false
  description: Subject of the email to send to the OU Owner.
  playbookInputQuery:
- key: OwnerNotificationBody
  value:
    simple: Infosec identified a security issue on a service owned by your team and
      exposed on Internet. Please get in touch with your Infosec team to define proper
      remediation access.
  required: false
  description: Body of the email to send to the OU Owner.
  playbookInputQuery:
- key: UseBehavior
  value:
    simple: "True"
  required: false
  description: Enrich flows using Expanse Behavior.
  playbookInputQuery:
- key: ShadowITIncidentType
  value:
    simple: Shadow IT
  required: false
  description: If set, specifies the type of Incident that gets automatically created
    during the Shadow IT flow. If not set, the Incident is to be created manually.
  playbookInputQuery:
- key: OrganizationUnitsToOwnerName
  value:
    simple: ExpanseOrganizationUnitsToOwner
  required: false
  description: Name of XSOAR List that contains the mapping between OU and Owners
  playbookInputQuery:
- key: OrganizationUnitsToTagName
  value:
    simple: ExpanseOrganizationUnitsToTag
  required: false
  description: Name of XSOAR List that contains the mapping between OU and Tag names
  playbookInputQuery:
- key: NumberOfDaysInThePast
  value:
    simple: "30"
  required: false
  description: How many days to go back in time when searching logs
  playbookInputQuery:
outputs: []
tests:
- ExpanseV2 Test
- Feed Expanse Test
fromversion: 6.0.0
