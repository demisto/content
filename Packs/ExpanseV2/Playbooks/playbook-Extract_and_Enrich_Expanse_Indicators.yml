description: Extract and Enrich Indicators (CIDRs, IPs, Certificates and Domains) from an Expanse Issue
id: Extract and Enrich Expanse Indicators
inputs:
- description: Expanse Assets to Extract and Enrich.
  key: Expanse Assets
  playbookInputQuery:
  required: false
  value:
    complex:
      accessor: expanseasset
      root: incident
- description: Create Indicators for types that are not handled by AutoExtract, such
    as Certificates, Domains and DomainGlobs.
  key: Create Indicators
  playbookInputQuery:
  required: false
  value:
    simple: "true"
- description: IP from the Expanse Incident.
  key: Expanse IP
  playbookInputQuery:
  required: false
  value:
    complex:
      accessor: expanseip
      root: incident
name: Extract and Enrich Expanse Indicators
outputs:
- contextPath: Expanse.Certificate
  description: Expanse Certificate Information
  type: unknown
- contextPath: Expanse.IPRange
  description: Expanse IP Range
  type: unknown
- contextPath: Domain
  description: The domain objects.
  type: unknown
- contextPath: DBotScore
  description: Indicator, Score, Type, and Vendor.
  type: unknown
- contextPath: IP
  description: The IP objects
  type: unknown
- contextPath: Endpoint
  description: The Endpoint's object
  type: unknown
- contextPath: Expanse.Domain
  description: Expanse Domain
  type: unknown
- contextPath: DomainDNSDetails
  description: Domain DNS Details
  type: Unknown
starttaskid: "0"
tasks:
  "0":
    id: "0"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "172"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 7fe7c23e-a7b5-4373-89ac-ae2e84e45e6e
      iscommand: false
      name: ""
      version: -1
      description: ''
    taskid: 7fe7c23e-a7b5-4373-89ac-ae2e84e45e6e
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 1327.5,
          "y": -1070
        }
      }
  "29":
    id: "29"
    ignoreworker: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 26a4a765-9582-431c-89f8-8943225e1dd2
      iscommand: false
      name: Done Enrichment
      type: title
      version: -1
      description: ''
    taskid: 26a4a765-9582-431c-89f8-8943225e1dd2
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1327.5,
          "y": 1130
        }
      }
  "41":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: inputs.Expanse Assets.assettype
                    operator: isEqualString
                    right:
                      value:
                        simple: Certificate
                root: inputs.Expanse Assets
                transformers:
                - args:
                    field:
                      value:
                        simple: assetkey
                  operator: getField
          operator: isNotEmpty
      label: "yes"
    id: "41"
    ignoreworker: false
    nexttasks:
      '#default#':
      - "174"
      "yes":
      - "100"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check if there are Expanse Certificates in the inputs.
      id: 6273470e-eed9-493f-874d-f4071fe1ff32
      iscommand: false
      name: Are there Certificates to enrich?
      type: condition
      version: -1
    taskid: 6273470e-eed9-493f-874d-f4071fe1ff32
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 580,
          "y": -520
        }
      }
  "42":
    id: "42"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "43"
    note: false
    quietmode: 0
    scriptarguments:
      accounttype: {}
      actor: {}
      admincountry: {}
      adminemail: {}
      adminname: {}
      adminphone: {}
      asn: {}
      assignedrole: {}
      assigneduser: {}
      associatedfilenames: {}
      associations: {}
      biosversion: {}
      campaign: {}
      category: {}
      certificatenames: {}
      certificatesignature: {}
      certificatevalidationchecks: {}
      city: {}
      costcenter: {}
      costcentercode: {}
      countryname: {}
      creationdate: {}
      customFields: {}
      cvedescription: {}
      cvemodified: {}
      cvss: {}
      department: {}
      description: {}
      detectionengines: {}
      devicemodel: {}
      dhcpserver: {}
      displayname: {}
      dns: {}
      domainidnname: {}
      domainname: {}
      domainreferringips: {}
      domainreferringsubnets: {}
      domainstatus: {}
      email: {}
      emailaddress: {}
      entryid: {}
      expanseassettype: {}
      expansebusinessunits: {}
      expansecertificateadvertisementstatus: {}
      expansecommonname: {}
      expansedateadded: {}
      expansednsresolutionstatus: {}
      expansedomain: {}
      expansefirstobserved: {}
      expanseissuerdn: {}
      expanselastobserved: {}
      expansemd5hash: {}
      expansepemmd5hash: {}
      expanseproperties: {}
      expanseprovidername: {}
      expansesans: {}
      expanseserialnumber: {}
      expanseservicestatus: {}
      expansesha256fingerprint: {}
      expansesourcedomain: {}
      expansesubjectdn: {}
      expansetags: {}
      expansetenantname: {}
      expansetype: {}
      expansevalidnotafter: {}
      expansevalidnotbefore: {}
      expirationdate: {}
      extension: {}
      feedrelatedindicators: {}
      fileextension: {}
      filetype: {}
      firstseenbysource: {}
      geocountry: {}
      geolocation: {}
      givenname: {}
      groups: {}
      hostname: {}
      imphash: {}
      indicatoridentification: {}
      internal: {}
      ipaddress: {}
      issuerdn: {}
      jobcode: {}
      jobfamily: {}
      jobfunction: {}
      lastseenbysource: {}
      leadership: {}
      location: {}
      locationregion: {}
      macaddress: {}
      malwarefamily: {}
      malwaretypes: {}
      manageremailaddress: {}
      managername: {}
      md5:
        complex:
          accessor: MD5
          root: Certificate
          transformers:
          - operator: uniq
      memory: {}
      merge: {}
      mobilephone: {}
      name: {}
      namefield: {}
      nameservers: {}
      office365category: {}
      office365expressroute: {}
      office365required: {}
      operatingsystem: {}
      operatingsystemversion: {}
      organization: {}
      organizationalunitou: {}
      osversion: {}
      path: {}
      pem: {}
      personalemail: {}
      port: {}
      positivedetections: {}
      primarymotivation: {}
      processor: {}
      processors: {}
      publickey: {}
      published: {}
      quarantined: {}
      region: {}
      registrantcountry: {}
      registrantemail: {}
      registrantname: {}
      registrantphone: {}
      registrarabuseemail: {}
      registrarabusephone: {}
      registrarname: {}
      relateToIncident: {}
      relatedIncidents: {}
      reportedby: {}
      reputation: {}
      seenNow: {}
      serialnumber: {}
      service: {}
      sha1:
        complex:
          accessor: SHA1
          root: Certificate
          transformers:
          - operator: uniq
      sha256:
        complex:
          accessor: SHA256
          root: Certificate
          transformers:
          - operator: uniq
      sha512: {}
      signatureauthentihash: {}
      signaturecopyright: {}
      signaturedescription: {}
      signaturefileversion: {}
      signatureinternalname: {}
      signed: {}
      size: {}
      source:
        simple: DBot
      sourceTimeStamp: {}
      sourceoriginalseverity: {}
      spkisha256: {}
      ssdeep: {}
      state: {}
      stixaliases: {}
      stixdescription: {}
      stixgoals: {}
      stixid: {}
      stixismalwarefamily: {}
      stixkillchainphases: {}
      stixmalwaretypes: {}
      stixprimarymotivation: {}
      stixresourcelevel: {}
      stixroles: {}
      stixsecondarymotivations: {}
      stixsophistication: {}
      stixthreatactortypes: {}
      stixtooltypes: {}
      stixtoolversion: {}
      streetaddress: {}
      subdomains: {}
      subjectalternativenames: {}
      subjectdn: {}
      surname: {}
      tags: {}
      threattypes: {}
      title: {}
      trafficlightprotocol: {}
      type:
        simple: Certificate
      updateddate: {}
      username: {}
      validitynotafter: {}
      validitynotbefore: {}
      value:
        complex:
          accessor: SHA256
          root: Certificate
          transformers:
          - operator: uniq
      workphone: {}
      xdrstatus: {}
      zipcode: {}
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.new.indicator
      id: c5913d87-f0a5-4f00-840c-e390d15978ad
      iscommand: true
      name: Create Certificate Indicators
      script: Builtin|||createNewIndicator
      type: regular
      version: -1
    taskid: c5913d87-f0a5-4f00-840c-e390d15978ad
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 50,
          "y": 90
        }
      }
  "43":
    id: "43"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "174"
    note: false
    quietmode: 0
    scriptarguments:
      indicatorsValues:
        complex:
          accessor: Value
          root: CreatedIndicator
      using-brand: {}
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.enrich.indicators
      id: 2a1484c7-ab91-46f5-88f6-47636baadde2
      iscommand: true
      name: Enrich Certificate Indicators
      script: Builtin|||enrichIndicators
      type: regular
      version: -1
    taskid: 2a1484c7-ab91-46f5-88f6-47636baadde2
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 350,
          "y": 340
        }
      }
  "100":
    id: "100"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "179"
      - "43"
    note: false
    quietmode: 0
    scriptarguments:
      businessunitnames: {}
      businessunits: {}
      has_active_service: {}
      has_certificate_advertisement: {}
      has_related_cloud_resources: {}
      last_observed_date: {}
      limit: {}
      md5_hash:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: inputs.Expanse Assets.assettype
              operator: isEqualString
              right:
                value:
                  simple: Certificate
          root: inputs.Expanse Assets
          transformers:
          - args:
              field:
                value:
                  simple: assetkey
            operator: getField
          - operator: uniq
      pem_md5_hash:
        complex:
          accessor: assetkey
          filters:
          - - left:
                iscontext: true
                value:
                  simple: inputs.Expanse Assets.assettype
              operator: isEqualString
              right:
                value:
                  simple: Certificate
          root: inputs.Expanse Assets
      providernames: {}
      providers: {}
      search: {}
      tagnames: {}
      tags: {}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Get certificate details by certificate md5 hash or search certificates
      id: a19d15b5-1bab-4050-8a89-ba7d136a5a14
      iscommand: true
      name: Add Certificate details to Context
      script: '|||expanse-get-certificate'
      type: regular
      version: -1
    taskid: a19d15b5-1bab-4050-8a89-ba7d136a5a14
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 350,
          "y": -310
        }
      }
  "101":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: ExtractedExpanseDomains
          operator: isNotEmpty
      label: "yes"
    id: "101"
    ignoreworker: false
    nexttasks:
      '#default#':
      - "176"
      "yes":
      - "180"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check if there are Expanse Domains in the inputs.
      id: a543688b-f1d7-48eb-8305-690750831c50
      iscommand: false
      name: Are there Domains to enrich?
      type: condition
      version: -1
    taskid: a543688b-f1d7-48eb-8305-690750831c50
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1327.5,
          "y": -360
        }
      }
  "131":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: inputs.Expanse Assets.assettype
                    operator: isEqualString
                    right:
                      value:
                        simple: IpRange
                root: inputs.Expanse Assets
                transformers:
                - args:
                    field:
                      value:
                        simple: assetkey
                  operator: getField
                - operator: toUpperCase
          operator: isNotEmpty
      label: "yes"
    id: "131"
    ignoreworker: false
    nexttasks:
      '#default#':
      - "190"
      "yes":
      - "132"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check if there are Expanse IP Ranges in the inputs.
      id: 00ebed74-37ee-4d15-877b-2cc4d58b8260
      iscommand: false
      name: Are there IP Ranges to enrich?
      type: condition
      version: -1
    taskid: 00ebed74-37ee-4d15-877b-2cc4d58b8260
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 2790,
          "y": -520
        }
      }
  "132":
    id: "132"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "190"
    note: false
    quietmode: 0
    scriptarguments:
      businessunitnames: {}
      businessunits: {}
      id:
        complex:
          accessor: assetkey
          filters:
          - - left:
                iscontext: true
                value:
                  simple: incident.expanseasset.assettype
              operator: isEqualString
              right:
                value:
                  simple: IpRange
          root: incident.expanseasset
      include: {}
      inet: {}
      tagnames: {}
      tags: {}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Get ip-range by id or search ip-ranges
      id: f2a6fd6d-89b9-44ef-8662-a67edce6ac21
      iscommand: true
      name: Add IP Range details to Context
      script: '|||expanse-get-iprange'
      type: regular
      version: -1
    taskid: f2a6fd6d-89b9-44ef-8662-a67edce6ac21
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 2570,
          "y": -340
        }
      }
  "169":
    id: "169"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "101"
    note: false
    quietmode: 0
    scriptarguments:
      append: {}
      key:
        simple: ExtractedExpanseDomains
      stringify: {}
      value:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: inputs.Expanse Assets.assettype
              operator: isEqualString
              right:
                value:
                  simple: Domain
          - - left:
                iscontext: true
                value:
                  simple: inputs.Expanse Assets.assetkey
              operator: notStartWith
              right:
                value:
                  simple: '*.'
          root: inputs.Expanse Assets
          transformers:
          - args:
              field:
                value:
                  simple: assetkey
            operator: getField
          - operator: uniq
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set a value in context under the key you entered. If no value is
        entered, the script doesn't do anything.
      id: 0caa3254-d166-4903-8e58-a2d6a118fece
      iscommand: false
      name: Extract Domain Indicators from Expanse Assets
      script: SetAndHandleEmpty
      type: regular
      version: -1
    taskid: 0caa3254-d166-4903-8e58-a2d6a118fece
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1327.5,
          "y": -520
        }
      }
  "170":
    id: "170"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "183"
    note: false
    quietmode: 0
    scriptarguments:
      append: {}
      key:
        simple: ExtractedExpanseDomainGlobs
      stringify: {}
      value:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: incident.expanseasset.assettype
              operator: isEqualString
              right:
                value:
                  simple: Domain
          - - left:
                iscontext: true
                value:
                  simple: incident.expanseasset.assetkey
              operator: startWith
              right:
                value:
                  simple: '*.'
          root: incident.expanseasset
          transformers:
          - args:
              field:
                value:
                  simple: assetkey
            operator: getField
          - operator: uniq
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set a value in context under the key you entered. If no value is
        entered, the script doesn't do anything.
      id: c49a92e8-8dbb-4adb-87de-1b146847c1b7
      iscommand: false
      name: Extract DomainGlob indicators from Expanse Assets
      script: SetAndHandleEmpty
      type: regular
      version: -1
    taskid: c49a92e8-8dbb-4adb-87de-1b146847c1b7
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 2090,
          "y": -520
        }
      }
  "172":
    id: "172"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "173"
      - "175"
      - "182"
      - "189"
      - "191"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: a2dfa010-52fb-4f69-806b-ad7dae16e2de
      iscommand: false
      name: Create and Enrich Indicators
      type: title
      version: -1
      description: ''
    taskid: a2dfa010-52fb-4f69-806b-ad7dae16e2de
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1327.5,
          "y": -850
        }
      }
  "173":
    id: "173"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "41"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 46eb5d61-37c0-4e63-8c2f-3d150247b854
      iscommand: false
      name: Certificates
      type: title
      version: -1
      description: ''
    taskid: 46eb5d61-37c0-4e63-8c2f-3d150247b854
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 580,
          "y": -655
        }
      }
  "174":
    id: "174"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "29"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 7bc36881-22ef-4688-8ba7-5b841f165227
      iscommand: false
      name: Done with Certificates
      type: title
      version: -1
      description: ''
    taskid: 7bc36881-22ef-4688-8ba7-5b841f165227
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 580,
          "y": 550
        }
      }
  "175":
    id: "175"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "169"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 43140a92-b584-4961-8bd8-416e8b790795
      iscommand: false
      name: Domains
      type: title
      version: -1
      description: ''
    taskid: 43140a92-b584-4961-8bd8-416e8b790795
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1327.5,
          "y": -655
        }
      }
  "176":
    id: "176"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "29"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 487ead84-14ab-42be-8b69-e0f4a205ae17
      iscommand: false
      name: Done with Domains
      type: title
      version: -1
      description: ''
    taskid: 487ead84-14ab-42be-8b69-e0f4a205ae17
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1327.5,
          "y": 890
        }
      }
  "177":
    id: "177"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "178"
    note: false
    quietmode: 0
    scriptarguments:
      accounttype: {}
      actor: {}
      admincountry: {}
      adminemail: {}
      adminname: {}
      adminphone: {}
      asn: {}
      assignedrole: {}
      assigneduser: {}
      associatedfilenames: {}
      associations: {}
      biosversion: {}
      campaign: {}
      category: {}
      city: {}
      costcenter: {}
      costcentercode: {}
      countryname: {}
      creationdate: {}
      customFields: {}
      cvedescription: {}
      cvemodified: {}
      cvss: {}
      department: {}
      description: {}
      detectionengines: {}
      devicemodel: {}
      dhcpserver: {}
      displayname: {}
      dns: {}
      domainidnname: {}
      domainname: {}
      domainreferringips: {}
      domainreferringsubnets: {}
      domainstatus: {}
      email: {}
      emailaddress: {}
      entryid: {}
      expanseassettype: {}
      expansebusinessunits: {}
      expansecertificateadvertisementstatus: {}
      expansecommonname: {}
      expansedateadded: {}
      expansednsresolutionstatus: {}
      expansedomain: {}
      expansefirstobserved: {}
      expanseissuerdn: {}
      expanselastobserved: {}
      expansepemmd5hash: {}
      expanseproperties: {}
      expanseprovidername: {}
      expansesans: {}
      expanseserialnumber: {}
      expanseservicestatus: {}
      expansesha256fingerprint: {}
      expansesourcedomain: {}
      expansesubjectdn: {}
      expansetags: {}
      expansetenantname: {}
      expansetype: {}
      expansevalidnotafter: {}
      expansevalidnotbefore: {}
      expirationdate: {}
      feedrelatedindicators: {}
      fileextension: {}
      filetype: {}
      firstseenbysource: {}
      geocountry: {}
      geolocation: {}
      givenname: {}
      groups: {}
      hostname: {}
      imphash: {}
      indicatoridentification: {}
      internal: {}
      ipaddress: {}
      jobcode: {}
      jobfamily: {}
      jobfunction: {}
      lastseenbysource: {}
      leadership: {}
      location: {}
      locationregion: {}
      macaddress: {}
      malwarefamily: {}
      manageremailaddress: {}
      managername: {}
      md5: {}
      memory: {}
      merge: {}
      mobilephone: {}
      name: {}
      namefield: {}
      nameservers: {}
      office365category: {}
      office365expressroute: {}
      office365required: {}
      operatingsystem: {}
      operatingsystemversion: {}
      organization: {}
      organizationalunitou: {}
      osversion: {}
      path: {}
      personalemail: {}
      port: {}
      positivedetections: {}
      processor: {}
      processors: {}
      published: {}
      quarantined: {}
      region: {}
      registrantcountry: {}
      registrantemail: {}
      registrantname: {}
      registrantphone: {}
      registrarabuseemail: {}
      registrarabusephone: {}
      registrarname: {}
      relateToIncident: {}
      relatedIncidents: {}
      reportedby: {}
      reputation: {}
      seenNow: {}
      service: {}
      sha1: {}
      sha256: {}
      sha512: {}
      signatureauthentihash: {}
      signaturecopyright: {}
      signaturedescription: {}
      signaturefileversion: {}
      signatureinternalname: {}
      signed: {}
      size: {}
      source:
        simple: DBot
      sourceTimeStamp: {}
      sourceoriginalseverity: {}
      ssdeep: {}
      state: {}
      stixaliases: {}
      stixdescription: {}
      stixgoals: {}
      stixid: {}
      stixismalwarefamily: {}
      stixkillchainphases: {}
      stixmalwaretypes: {}
      stixprimarymotivation: {}
      stixresourcelevel: {}
      stixroles: {}
      stixsecondarymotivations: {}
      stixsophistication: {}
      stixthreatactortypes: {}
      stixtooltypes: {}
      stixtoolversion: {}
      streetaddress: {}
      subdomains: {}
      surname: {}
      tags: {}
      threattypes: {}
      title: {}
      trafficlightprotocol: {}
      type:
        simple: Domain
      updateddate: {}
      username: {}
      value:
        complex:
          root: ExtractedExpanseDomains
      workphone: {}
      xdrstatus: {}
      zipcode: {}
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.new.indicator
      id: 6af301d6-96bb-4b13-8385-dc87782be59d
      iscommand: true
      name: Create Domain Indicators
      script: Builtin|||createNewIndicator
      type: regular
      version: -1
    taskid: 6af301d6-96bb-4b13-8385-dc87782be59d
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 890,
          "y": 5
        }
      }
  "178":
    id: "178"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "181"
    note: false
    quietmode: 0
    scriptarguments:
      indicatorsValues:
        complex:
          root: ExtractedExpanseDomains
      using-brand: {}
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.enrich.indicators
      id: 67057610-c3a5-4139-8949-5c4e8ea3f3f7
      iscommand: true
      name: Enrich Domain Indicators
      script: Builtin|||enrichIndicators
      type: regular
      version: -1
    taskid: 67057610-c3a5-4139-8949-5c4e8ea3f3f7
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 890,
          "y": 165
        }
      }
  "179":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: inputs.Create Indicators
          operator: isEqualString
          right:
            value:
              simple: "True"
      label: "yes"
    id: "179"
    ignoreworker: false
    nexttasks:
      "yes":
      - "42"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check whether the playbook should create new indicators.
      id: 4a5fae93-580e-40e0-8234-dd8128083169
      iscommand: false
      name: Create Indicators?
      type: condition
      version: -1
    taskid: 4a5fae93-580e-40e0-8234-dd8128083169
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 50,
          "y": -125
        }
      }
  "180":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: inputs.Create Indicators
          operator: isEqualString
          right:
            value:
              simple: "True"
      label: "yes"
    id: "180"
    ignoreworker: false
    nexttasks:
      '#default#':
      - "181"
      "yes":
      - "177"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check whether the playbook should create new indicators.
      id: 88afe70e-9ecf-4368-8ea7-8fdbf66ecee7
      iscommand: false
      name: Create Indicators?
      type: condition
      version: -1
    taskid: 88afe70e-9ecf-4368-8ea7-8fdbf66ecee7
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1100,
          "y": -190
        }
      }
  "181":
    id: "181"
    ignoreworker: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "196"
    note: false
    quietmode: 0
    scriptarguments:
      Domain:
        complex:
          root: ExtractedExpanseDomains
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 11042a52-0f13-445c-8485-c1a65b5d82c9
      iscommand: false
      name: Domain Enrichment - Generic v2
      playbookId: Domain Enrichment - Generic v2
      type: playbook
      version: -1
      description: ''
    taskid: 11042a52-0f13-445c-8485-c1a65b5d82c9
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1100,
          "y": 355
        }
      }
  "182":
    id: "182"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "170"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 8e9bc964-38ef-4663-87ad-9d38b249e03c
      iscommand: false
      name: DomainGlobs
      type: title
      version: -1
      description: ''
    taskid: 8e9bc964-38ef-4663-87ad-9d38b249e03c
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 2090,
          "y": -655
        }
      }
  "183":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: ExtractedExpanseDomainGlobs
          operator: isNotEmpty
      label: "yes"
    id: "183"
    ignoreworker: false
    nexttasks:
      '#default#':
      - "184"
      "yes":
      - "185"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check if there are Expanse Domain Globs in the inputs.
      id: b064f52b-4f34-4b99-8f25-710fa900c3c0
      iscommand: false
      name: Are there DomainGlobs to enrich?
      type: condition
      version: -1
    taskid: b064f52b-4f34-4b99-8f25-710fa900c3c0
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 2090,
          "y": -370
        }
      }
  "184":
    id: "184"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "29"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: f2f4ddda-d5ea-4ec2-865f-98b5a88da9a4
      iscommand: false
      name: Done with DomainGlobs
      type: title
      version: -1
      description: ''
    taskid: f2f4ddda-d5ea-4ec2-865f-98b5a88da9a4
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 2090,
          "y": 730
        }
      }
  "185":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: inputs.Create Indicators
          operator: isEqualString
          right:
            value:
              simple: "True"
      label: "yes"
    id: "185"
    ignoreworker: false
    nexttasks:
      '#default#':
      - "186"
      "yes":
      - "187"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check whether the playbook should create new indicators.
      id: 9d606698-071e-4382-8b36-06af2fa0ff05
      iscommand: false
      name: Create Indicators?
      type: condition
      version: -1
    taskid: 9d606698-071e-4382-8b36-06af2fa0ff05
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1840,
          "y": -190
        }
      }
  "186":
    id: "186"
    ignoreworker: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "195"
    note: false
    quietmode: 0
    scriptarguments:
      Domain:
        complex:
          root: ExtractedExpanseDomainGlobs
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 5ae97ec0-209f-4943-8bd7-104a6952c607
      iscommand: false
      name: Domain Enrichment - Generic v2
      playbookId: Domain Enrichment - Generic v2
      type: playbook
      version: -1
      description: ''
    taskid: 5ae97ec0-209f-4943-8bd7-104a6952c607
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1840,
          "y": 355
        }
      }
  "187":
    id: "187"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "188"
    note: false
    quietmode: 0
    scriptarguments:
      accounttype: {}
      actor: {}
      admincountry: {}
      adminemail: {}
      adminname: {}
      adminphone: {}
      asn: {}
      assignedrole: {}
      assigneduser: {}
      associatedfilenames: {}
      associations: {}
      biosversion: {}
      campaign: {}
      category: {}
      city: {}
      costcenter: {}
      costcentercode: {}
      countryname: {}
      creationdate: {}
      customFields: {}
      cvedescription: {}
      cvemodified: {}
      cvss: {}
      department: {}
      description: {}
      detectionengines: {}
      devicemodel: {}
      dhcpserver: {}
      displayname: {}
      dns: {}
      domainidnname: {}
      domainname: {}
      domainreferringips: {}
      domainreferringsubnets: {}
      domainstatus: {}
      email: {}
      emailaddress: {}
      entryid: {}
      expanseassettype: {}
      expansebusinessunits: {}
      expansecertificateadvertisementstatus: {}
      expansecommonname: {}
      expansedateadded: {}
      expansednsresolutionstatus: {}
      expansedomain: {}
      expansefirstobserved: {}
      expanseissuerdn: {}
      expanselastobserved: {}
      expansepemmd5hash: {}
      expanseproperties: {}
      expanseprovidername: {}
      expansesans: {}
      expanseserialnumber: {}
      expanseservicestatus: {}
      expansesha256fingerprint: {}
      expansesourcedomain: {}
      expansesubjectdn: {}
      expansetags: {}
      expansetenantname: {}
      expansetype: {}
      expansevalidnotafter: {}
      expansevalidnotbefore: {}
      expirationdate: {}
      feedrelatedindicators: {}
      fileextension: {}
      filetype: {}
      firstseenbysource: {}
      geocountry: {}
      geolocation: {}
      givenname: {}
      groups: {}
      hostname: {}
      imphash: {}
      indicatoridentification: {}
      internal: {}
      ipaddress: {}
      jobcode: {}
      jobfamily: {}
      jobfunction: {}
      lastseenbysource: {}
      leadership: {}
      location: {}
      locationregion: {}
      macaddress: {}
      malwarefamily: {}
      manageremailaddress: {}
      managername: {}
      md5: {}
      memory: {}
      merge: {}
      mobilephone: {}
      name: {}
      namefield: {}
      nameservers: {}
      office365category: {}
      office365expressroute: {}
      office365required: {}
      operatingsystem: {}
      operatingsystemversion: {}
      organization: {}
      organizationalunitou: {}
      osversion: {}
      path: {}
      personalemail: {}
      port: {}
      positivedetections: {}
      processor: {}
      processors: {}
      published: {}
      quarantined: {}
      region: {}
      registrantcountry: {}
      registrantemail: {}
      registrantname: {}
      registrantphone: {}
      registrarabuseemail: {}
      registrarabusephone: {}
      registrarname: {}
      relateToIncident: {}
      relatedIncidents: {}
      reportedby: {}
      reputation: {}
      seenNow: {}
      service: {}
      sha1: {}
      sha256: {}
      sha512: {}
      signatureauthentihash: {}
      signaturecopyright: {}
      signaturedescription: {}
      signaturefileversion: {}
      signatureinternalname: {}
      signed: {}
      size: {}
      source:
        simple: DBot
      sourceTimeStamp: {}
      sourceoriginalseverity: {}
      ssdeep: {}
      state: {}
      stixaliases: {}
      stixdescription: {}
      stixgoals: {}
      stixid: {}
      stixismalwarefamily: {}
      stixkillchainphases: {}
      stixmalwaretypes: {}
      stixprimarymotivation: {}
      stixresourcelevel: {}
      stixroles: {}
      stixsecondarymotivations: {}
      stixsophistication: {}
      stixthreatactortypes: {}
      stixtooltypes: {}
      stixtoolversion: {}
      streetaddress: {}
      subdomains: {}
      surname: {}
      tags: {}
      threattypes: {}
      title: {}
      trafficlightprotocol: {}
      type:
        simple: DomainGlob
      updateddate: {}
      username: {}
      value:
        complex:
          root: ExtractedExpanseDomainGlobs
      workphone: {}
      xdrstatus: {}
      zipcode: {}
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.new.indicator
      id: ae428ced-a2ad-47d3-82a3-509630aa3c2c
      iscommand: true
      name: Create DomainGlob Indicators
      script: Builtin|||createNewIndicator
      type: regular
      version: -1
    taskid: ae428ced-a2ad-47d3-82a3-509630aa3c2c
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1600,
          "y": 5
        }
      }
  "188":
    id: "188"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "186"
    note: false
    quietmode: 0
    scriptarguments:
      indicatorsValues:
        complex:
          root: ExtractedExpanseDomainGlobs
      using-brand: {}
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.enrich.indicators
      id: 4fea3473-5dbd-43d3-8580-a5c0730dfd52
      iscommand: true
      name: Enrich DomainGlob Indicators
      script: Builtin|||enrichIndicators
      type: regular
      version: -1
    taskid: 4fea3473-5dbd-43d3-8580-a5c0730dfd52
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1600,
          "y": 165
        }
      }
  "189":
    id: "189"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "131"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 30d91afa-127a-44c0-864d-85512ba34232
      iscommand: false
      name: IP Ranges
      type: title
      version: -1
      description: ''
    taskid: 30d91afa-127a-44c0-864d-85512ba34232
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 2790,
          "y": -655
        }
      }
  "190":
    id: "190"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "29"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: b97d4455-7890-4f73-8fd8-5654b2b05d0a
      iscommand: false
      name: Done with IP Ranges
      type: title
      version: -1
      description: ''
    taskid: b97d4455-7890-4f73-8fd8-5654b2b05d0a
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 2790,
          "y": 540
        }
      }
  "191":
    id: "191"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "192"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 4c24e375-8b73-4575-83af-f1b6dd6dd102
      iscommand: false
      name: IP
      type: title
      version: -1
      description: ''
    taskid: 4c24e375-8b73-4575-83af-f1b6dd6dd102
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 3410,
          "y": -655
        }
      }
  "192":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.Expanse IP
          operator: isNotEmpty
      label: "yes"
    id: "192"
    ignoreworker: false
    nexttasks:
      '#default#':
      - "193"
      "yes":
      - "194"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check if there are Expanse Certificates in the inputs.
      id: 36e6db51-1bc4-40cc-8b5d-d0694872356c
      iscommand: false
      name: Is there an IP to enrich?
      type: condition
      version: -1
    taskid: 36e6db51-1bc4-40cc-8b5d-d0694872356c
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 3410,
          "y": -520
        }
      }
  "193":
    id: "193"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "29"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 44381f68-75f1-4c8c-8265-647694ff775e
      iscommand: false
      name: Done with IP
      type: title
      version: -1
      description: ''
    taskid: 44381f68-75f1-4c8c-8265-647694ff775e
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 3410,
          "y": 540
        }
      }
  "194":
    id: "194"
    ignoreworker: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "193"
    note: false
    quietmode: 0
    scriptarguments:
      IP:
        complex:
          root: inputs.Expanse IP
          transformers:
          - operator: uniq
      InternalRange: {}
      ResolveIP:
        simple: "True"
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Enrich IP addresses using one or more integrations.

        - Resolve IP addresses to hostnames (DNS)
        - Provide threat information
        - Separate internal and external IP addresses
        - For internal IP addresses, get host information
      id: 6d490d3f-2a80-4b64-8852-8982eb283cb7
      iscommand: false
      name: IP Enrichment - Generic v2
      playbookId: IP Enrichment - Generic v2
      type: playbook
      version: -1
    taskid: 6d490d3f-2a80-4b64-8852-8982eb283cb7
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 3190,
          "y": -330
        }
      }
  "195":
    id: "195"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "184"
    note: false
    quietmode: 0
    scriptarguments:
      businessunitnames: {}
      businessunits: {}
      domain:
        complex:
          root: ExtractedExpanseDomainGlobs
          transformers:
          - operator: uniq
      has_active_service: {}
      has_dns_resolution: {}
      has_related_cloud_resources: {}
      last_observed_date: {}
      providernames: {}
      providers: {}
      search: {}
      tagnames: {}
      tags: {}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Get domain details by domain name or search certificates
      id: d88734fb-b877-497d-8c31-cb2c65d12139
      iscommand: true
      name: Add Expanse Domain Details to Context
      script: '|||expanse-get-domain'
      type: regular
      version: -1
    taskid: d88734fb-b877-497d-8c31-cb2c65d12139
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1840,
          "y": 520
        }
      }
  "196":
    id: "196"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "197"
    note: false
    quietmode: 0
    scriptarguments:
      businessunitnames: {}
      businessunits: {}
      domain:
        complex:
          root: ExtractedExpanseDomains
          transformers:
          - operator: uniq
      has_active_service: {}
      has_dns_resolution: {}
      has_related_cloud_resources: {}
      last_observed_date: {}
      providernames: {}
      providers: {}
      search: {}
      tagnames: {}
      tags: {}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Get domain details by domain name or search certificates
      id: 4425a1a5-d657-478f-8ec2-745cf0e5eff1
      iscommand: true
      name: Add Expanse Domain Details to Context
      script: '|||expanse-get-domain'
      type: regular
      version: -1
    taskid: 4425a1a5-d657-478f-8ec2-745cf0e5eff1
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1100,
          "y": 525
        }
      }
  "197":
    id: "197"
    ignoreworker: false
    nexttasks:
      '#none#':
      - "176"
    note: false
    quietmode: 0
    scriptarguments:
      domain:
        complex:
          root: ExtractedExpanseDomains
      qtype: {}
      server: {}
      use_tcp: {}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Returns DNS details for a domain
      id: 716cf6fc-f145-4b2f-823e-a8d51733effa
      iscommand: false
      name: Get Domain DNS Details
      script: GetDomainDNSDetails
      type: regular
      version: -1
    taskid: 716cf6fc-f145-4b2f-823e-a8d51733effa
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1100,
          "y": 700
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 2265,
        "width": 3740,
        "x": 50,
        "y": -1070
      }
    }
  }
fromversion: 6.0.0
tests:
- No tests (auto formatted)
