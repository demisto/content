id: MSG-ediscovery-tpb
version: -1
name: MSG-ediscovery-tpb
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 324e9819-98d6-4b23-81ca-763956c19357
    type: start
    task:
      id: 324e9819-98d6-4b23-81ca-763956c19357
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "37"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 50
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: 8607a320-1114-4197-86e3-034a29c2cdcd
    type: regular
    task:
      id: 8607a320-1114-4197-86e3-034a29c2cdcd
      version: -1
      name: GetRandomString
      description: Generates a random UUID (UUID 4).
      scriptName: GenerateRandomUUID
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "2"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 545
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: cdf6b9b4-5aa0-4e4d-8fd3-b8ab848dca5d
    type: regular
    task:
      id: cdf6b9b4-5aa0-4e4d-8fd3-b8ab848dca5d
      version: -1
      name: Create Case
      description: Create a new eDiscovery case. This command only creates an eDiscovery (Premium) case using the new case format. To learn more about the new case format in eDiscovery, see https://learn.microsoft.com/en-us/microsoft-365/compliance/advanced-ediscovery-new-case-format. After the custodian object is created, the custodian's userSource needs to be created to reference their mailbox and OneDrive for Business site.
      script: '|||msg-create-ediscovery-case'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      description:
        simple: Some description
      display_name:
        complex:
          root: GeneratedUUID
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'Case DisplayName :'
              suffix: {}
      external_id:
        simple: someid
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: db86a2c3-572b-4490-84bc-65c28f31109f
    type: condition
    task:
      id: db86a2c3-572b-4490-84bc-65c28f31109f
      version: -1
      name: Check Outputs
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "yes":
      - "4"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoveryCase
            iscontext: true
          right:
            value: {}
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoveryCase.CaseStatus
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoveryCase.CreatedDateTime
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoveryCase.Description
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoveryCase.DisplayName
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoveryCase.ExternalId
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 895
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: 256f55a8-757d-4f29-846b-3415905490a0
    type: regular
    task:
      id: 256f55a8-757d-4f29-846b-3415905490a0
      version: -1
      name: SetIDToContext
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "5"
    scriptarguments:
      key:
        simple: CaseID
      value:
        simple: ${MsGraph.eDiscoveryCase.CaseId}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1070
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: 5063b0fc-b19d-4f00-821e-87f7e1beb949
    type: regular
    task:
      id: 5063b0fc-b19d-4f00-821e-87f7e1beb949
      version: -1
      name: DeleteContext
      description: |-
        Delete field from context.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        - For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations 
        - For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script
        - For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "41"
    scriptarguments:
      key:
        simple: MsGraph
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1245
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: 286ec36c-1d1a-4f9d-8b7a-57d322c40c80
    type: regular
    task:
      id: 286ec36c-1d1a-4f9d-8b7a-57d322c40c80
      version: -1
      name: Update case
      description: Update an eDiscovery case.
      script: '|||msg-update-ediscovery-case'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "40"
    scriptarguments:
      case_id:
        simple: ${CaseID}
      description:
        simple: new description
      display_name:
        complex:
          root: GeneratedUUID
          transformers:
          - operator: concat
            args:
              prefix:
                value:
                  simple: 'New Display Name:'
              suffix: {}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1595
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: 1570a87e-d9e5-4a90-8525-794ff79e503b
    type: regular
    task:
      id: 1570a87e-d9e5-4a90-8525-794ff79e503b
      version: -1
      name: Close case
      description: Close an eDiscovery case. Before you can delete a case, you must first delete all holds listed on the holds page of the case. That includes deleting holds with a status of Off. Default hold policies can only be deleted when the hold is turned off. You must close an active case to turn off any default hold policies in the case. Once the holds are turned off for default hold policies, they can be deleted.
      script: '|||msg-close-ediscovery-case'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "39"
    scriptarguments:
      case_id:
        simple: ${CaseID}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1945
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: 6b9a9ea0-0c65-4780-8d2f-2298f472e94b
    type: regular
    task:
      id: 6b9a9ea0-0c65-4780-8d2f-2298f472e94b
      version: -1
      name: List cases
      description: Lists edicovery cases.
      script: '|||msg-list-ediscovery-cases'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "42"
    scriptarguments:
      case_id:
        simple: ${CaseID}
      limit:
        simple: "1"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2295
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: af23c202-d6ba-42f4-88c5-aa4f40093d47
    type: condition
    task:
      id: af23c202-d6ba-42f4-88c5-aa4f40093d47
      version: -1
      name: Check updated and closed
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "yes":
      - "10"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: MsGraph.eDiscoveryCase.CaseStatus
            iscontext: true
          right:
            value:
              simple: closed
      - - operator: containsGeneral
          left:
            value:
              simple: MsGraph.eDiscoveryCase.DisplayName
            iscontext: true
          right:
            value:
              simple: New Display Name
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoveryCase.ClosedDateTime
            iscontext: true
      - - operator: isEqualString
          left:
            value:
              simple: MsGraph.eDiscoveryCase.CaseId
            iscontext: true
          right:
            value:
              simple: CaseID
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2645
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: c44f9072-8d57-4aac-8e8d-f961b3913ea1
    type: regular
    task:
      id: c44f9072-8d57-4aac-8e8d-f961b3913ea1
      version: -1
      name: Reopen case
      description: Reopen an eDiscovery case. When you reopen an eDiscovery (Premium) case, any holds that were in place when the case was closed won't be automatically reinstated. After the case is reopened, you'll have to go to the Holds tab and turn on the previous holds. To turn on a hold, select it to display the flyout page, and then set the Status toggle to On.
      script: '|||msg-reopen-ediscovery-case'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      case_id:
        simple: ${CaseID}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2820
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "11":
    id: "11"
    taskid: b3886818-1fbf-4ccf-8809-35accddfd176
    type: regular
    task:
      id: b3886818-1fbf-4ccf-8809-35accddfd176
      version: -1
      name: Create Custodian
      description: Create a new ediscoveryCustodian object. After the custodian object is created, you will need to create the custodian's userSource to reference their mailbox and OneDrive for Business site.
      script: '|||msg-create-ediscovery-custodian'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      case_id:
        simple: ${CaseID}
      email:
        simple: testbox2@demistodev.onmicrosoft.com
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2995
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: a3474653-ff46-439c-87da-70e4140c4eb2
    type: regular
    task:
      id: a3474653-ff46-439c-87da-70e4140c4eb2
      version: -1
      name: DeleteCase
      description: Delete an eDiscovery case. Before you can delete a case, you must first delete all holds listed on the holds page of the case. That includes deleting holds with a status of Off. Default hold policies can only be deleted when the hold is turned off. You must close an active case to turn off any default hold policies in the case. Once the holds are turned off for default hold policies, they can be deleted.
      script: '|||msg-delete-ediscovery-case'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "13"
    scriptarguments:
      case_id:
        simple: ${CaseID}
    separatecontext: false
    continueonerror: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 7195
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: b5b193c7-9f2f-401a-8f60-6afef383a223
    type: title
    task:
      id: b5b193c7-9f2f-401a-8f60-6afef383a223
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 7370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "14":
    id: "14"
    taskid: 12010808-b310-420f-8d57-79c7234717fb
    type: condition
    task:
      id: 12010808-b310-420f-8d57-79c7234717fb
      version: -1
      name: Check Custodian Outputs
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "yes":
      - "15"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoveryCustodian.CustodianId
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoveryCustodian.CustodianStatus
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoveryCustodian.CreatedDateTime
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoveryCustodian.Email
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoveryCustodian.HoldStatus
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoveryCustodian.LastModifiedDateTime
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 3170
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "15":
    id: "15"
    taskid: 6f78702c-6d41-419c-8041-e5eb710de6a0
    type: regular
    task:
      id: 6f78702c-6d41-419c-8041-e5eb710de6a0
      version: -1
      name: Add User Source
      description: Create a new userSource object associated with an eDiscovery custodian. Use the msg-list-ediscovery-custodians command in order to get all available custodians.
      script: '|||msg-create-ediscovery-custodian-user-source'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      case_id:
        simple: ${CaseID}
      custodian_id:
        simple: ${MsGraph.eDiscoveryCustodian.CustodianId}
      email:
        simple: testbox2@demistodev.onmicrosoft.com
      included_sources:
        simple: mailbox, site
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 3345
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: dbd0ea80-502a-4c5b-8034-7da79de1bc1e
    type: regular
    task:
      id: dbd0ea80-502a-4c5b-8034-7da79de1bc1e
      version: -1
      name: List user sources
      description: Get a list of the userSource objects associated with an eDiscoveryCustodian. Use the msg-list-ediscovery-custodians command in order to get all available custodians.
      script: '|||msg-list-ediscovery-custodian-user-sources'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "17"
    scriptarguments:
      case_id:
        simple: ${CaseID}
      custodian_id:
        simple: ${MsGraph.eDiscoveryCustodian.CustodianId}
      user_source_id:
        simple: ${MsGraph.CustodianUserSource.UserSourceId}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 3520
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: afa9225c-b2b2-4dfc-8eb8-15f95ca33ac9
    type: condition
    task:
      id: afa9225c-b2b2-4dfc-8eb8-15f95ca33ac9
      version: -1
      name: Check Outputs
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "yes":
      - "18"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: MsGraph.CustodianUserSource.CreatedBy.User.DisplayName
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.CustodianUserSource.CreatedBy.User.UserPrincipalName
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.CustodianUserSource.CreatedBy.Application.DisplayName
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.CustodianUserSource.HoldStatus
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.CustodianUserSource.CreatedDateTime
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 3695
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: ba99af86-64d6-4662-8a51-0bf7a007baeb
    type: regular
    task:
      id: ba99af86-64d6-4662-8a51-0bf7a007baeb
      version: -1
      name: Create Site Source
      description: Create a new siteSource object associated with an eDiscovery custodian. Use the msg-list-ediscovery-custodians command in order to get all available custodians.
      script: '|||msg-create-ediscovery-custodian-site-source'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "19"
    scriptarguments:
      case_id:
        simple: ${CaseID}
      custodian_id:
        simple: ${MsGraph.eDiscoveryCustodian.CustodianId}
      site:
        simple: https://demistodev.sharepoint.com/sites/site_test_1
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 3870
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: 06f4083a-baf4-438e-8877-f46f914f9247
    type: regular
    task:
      id: 06f4083a-baf4-438e-8877-f46f914f9247
      version: -1
      name: List Site Source
      description: Get a list of the siteSource objects associated with an eDiscoveryCustodian. Use the msg-list-ediscovery-custodians command in order to get all available custodians.
      script: '|||msg-list-ediscovery-custodian-site-sources'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      case_id:
        simple: ${CaseID}
      custodian_id:
        simple: ${MsGraph.eDiscoveryCustodian.CustodianId}
      site_source_id:
        simple: ${MsGraph.CustodianSiteSource.SiteSourceId}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 4045
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: c7d7d701-a718-4840-84a9-2f995d089ded
    type: condition
    task:
      id: c7d7d701-a718-4840-84a9-2f995d089ded
      version: -1
      name: Check outputs
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "yes":
      - "21"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: MsGraph.CustodianSiteSource.Site.WebUrl
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.CustodianSiteSource.SiteSourceId
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.CustodianSiteSource.DisplayName
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.CustodianSiteSource.CreatedBy.User.UserPrincipalName
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.CustodianSiteSource.Site.CreatedDate
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.CustodianSiteSource.HoldStatus
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 4220
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: 8e3b9618-ec95-478a-88f6-c2b487fb58ff
    type: regular
    task:
      id: 8e3b9618-ec95-478a-88f6-c2b487fb58ff
      version: -1
      name: release custodian
      description: Release a custodian from a case. For details, see https://learn.microsoft.com/en-us/microsoft-365/compliance/manage-new-custodians#release-a-custodian-from-a-case.
      script: '|||msg-release-ediscovery-custodian'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "22"
    scriptarguments:
      case_id:
        simple: ${CaseID}
      custodian_id:
        simple: ${MsGraph.eDiscoveryCustodian.CustodianId}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 4395
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: 72384291-22db-4d77-8a22-1f46a17e8867
    type: regular
    task:
      id: 72384291-22db-4d77-8a22-1f46a17e8867
      version: -1
      name: activate custodian
      description: Activate a custodian that has been released from a case to make them part of the case again. For details, see https://learn.microsoft.com/en-us/microsoft-365/compliance/ediscovery-manage-new-custodians?view=o365-worldwide#re-activate-custodian.
      script: '|||msg-activate-ediscovery-custodian'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "23"
    scriptarguments:
      case_id:
        simple: ${CaseID}
      custodian_id:
        simple: ${MsGraph.eDiscoveryCustodian.CustodianId}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 4570
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: 5d875801-9da7-49da-8ddd-59edc2f7671f
    type: regular
    task:
      id: 5d875801-9da7-49da-8ddd-59edc2f7671f
      version: -1
      name: apply hold
      description: "Start the process of applying hold on eDiscovery custodians.\nAvailable return statuses: \nnotApplied - The custodian is not on Hold (all sources in it are not on hold).\napplied - The custodian is on Hold (all sources are on hold).\napplying - The custodian is in applying hold state (applyHold operation triggered).\nremoving - The custodian is in removing the hold state(removeHold operation triggered).\npartial - The custodian is in mixed state where some sources are on hold and some not on hold or error state."
      script: '|||msg-apply-hold-ediscovery-custodian'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "24"
    scriptarguments:
      case_id:
        simple: ${CaseID}
      custodian_id:
        simple: ${MsGraph.eDiscoveryCustodian.CustodianId}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 4745
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: 0e218079-4ad6-401c-8841-19f831eee43c
    type: regular
    task:
      id: 0e218079-4ad6-401c-8841-19f831eee43c
      version: -1
      name: remove hold
      description: Start the process of removing hold from eDiscovery custodians.
      script: '|||msg-remove-hold-ediscovery-custodian'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "25"
    scriptarguments:
      case_id:
        simple: ${CaseID}
      custodian_id:
        simple: ${MsGraph.eDiscoveryCustodian.CustodianId}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 4920
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: 1907e6f3-06bb-4261-8294-402a26a8f9b8
    type: regular
    task:
      id: 1907e6f3-06bb-4261-8294-402a26a8f9b8
      version: -1
      name: create non-custodial datasource
      description: Create a new eDiscoveryNoncustodialDataSource object.
      script: '|||msg-create-ediscovery-non-custodial-data-source'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "26"
    scriptarguments:
      case_id:
        simple: ${CaseID}
      email:
        simple: testbox2@demistodev.onmicrosoft.com
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 5095
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "26":
    id: "26"
    taskid: bd57baab-4a25-4ffe-8ef2-6237c5e90a8c
    type: regular
    task:
      id: bd57baab-4a25-4ffe-8ef2-6237c5e90a8c
      version: -1
      name: list non cust data source
      description: Get a list of the non-custodial data sources and their properties.
      script: '|||msg-list-ediscovery-non-custodial-data-sources'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "27"
    scriptarguments:
      all_results:
        simple: "true"
      case_id:
        simple: ${CaseID}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 5270
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: 2c65931e-0c33-44a6-8bc4-7ea790099f50
    type: condition
    task:
      id: 2c65931e-0c33-44a6-8bc4-7ea790099f50
      version: -1
      name: Check output
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "yes":
      - "28"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: MsGraph.NoncustodialDataSource.DataSourceStatus
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.NoncustodialDataSource.DataSourceId
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.NoncustodialDataSource.LastModifiedDateTime
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.NoncustodialDataSource.CreatedDateTime
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.NoncustodialDataSource.DisplayName
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 5445
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 3b1e80ad-dfe2-4f1f-8ba9-681fd1135a07
    type: regular
    task:
      id: 3b1e80ad-dfe2-4f1f-8ba9-681fd1135a07
      version: -1
      name: Create search
      description: Create a new eDiscoverySearch object.
      script: '|||msg-create-ediscovery-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "30"
    scriptarguments:
      case_id:
        simple: ${CaseID}
      content_query:
        simple: Date>=01/01/2020
      data_source_scopes:
        simple: allCaseCustodians
      description:
        simple: this is my search
      display_name:
        simple: My search name
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 5620
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: 4ccc6566-4e18-423d-8b28-44b80c72e5a8
    type: regular
    task:
      id: 4ccc6566-4e18-423d-8b28-44b80c72e5a8
      version: -1
      name: Set search id to context
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "31"
    scriptarguments:
      key:
        simple: SearchID
      value:
        simple: ${MsGraph.eDiscoverySearch.SearchId}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 5970
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: 825554b8-da11-4a28-81c9-8373afdfd455
    type: condition
    task:
      id: 825554b8-da11-4a28-81c9-8373afdfd455
      version: -1
      name: Check outputs
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "yes":
      - "29"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoverySearch.ContentQuery
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoverySearch.CreatedDateTime
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoverySearch.DataSourceScopes
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoverySearch.Description
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoverySearch.SearchId
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoverySearch.CreatedBy.User.UserPrincipalName
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoverySearch.CreatedBy.Application.DisplayName
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 5795
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: f728f572-1d7b-4123-8b4a-b3a65fb8038f
    type: regular
    task:
      id: f728f572-1d7b-4123-8b4a-b3a65fb8038f
      version: -1
      name: DeleteContext
      description: |-
        Delete field from context.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        - For Cortex XSOAR 6 see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.x/Cortex-XSOAR-Playbook-Design-Guide/Automations 
        - For Cortex XSOAR 8 Cloud see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8/Cortex-XSOAR-Cloud-Documentation/Create-a-script
        - For Cortex XSOAR 8.7 On-prem see https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/8.7/Cortex-XSOAR-On-prem-Documentation/Create-a-script
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "32"
    scriptarguments:
      key:
        simple: MsGraph.eDiscoverySearch
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 6145
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: f33e9d8b-dcdb-4c08-8936-5c8bbfcc434e
    type: regular
    task:
      id: f33e9d8b-dcdb-4c08-8936-5c8bbfcc434e
      version: -1
      name: Update Search
      description: Update an eDiscoverySearch object.
      script: '|||msg-update-ediscovery-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "33"
    scriptarguments:
      case_id:
        simple: ${CaseID}
      content_query:
        simple: Date>=01/01/2021
      data_source_scopes:
        simple: allCaseCustodians
      description:
        simple: new description
      display_name:
        simple: new display name
      search_id:
        simple: ${SearchID}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 6320
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: 054a57c0-6e5f-47af-8954-548a1ea059e9
    type: regular
    task:
      id: 054a57c0-6e5f-47af-8954-548a1ea059e9
      version: -1
      name: List search
      description: Get the list of eDiscoverySearch resources from an eDiscovery case.
      script: '|||msg-list-ediscovery-searchs'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "34"
    scriptarguments:
      case_id:
        simple: ${CaseID}
      limit:
        simple: "3"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 6495
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "34":
    id: "34"
    taskid: 1ccb32bf-54ce-43c7-84c4-43d4375b0794
    type: condition
    task:
      id: 1ccb32bf-54ce-43c7-84c4-43d4375b0794
      version: -1
      name: Check outputs
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "yes":
      - "35"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoverySearch.ContentQuery
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoverySearch.CreatedDateTime
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoverySearch.DataSourceScopes
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoverySearch.Description
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoverySearch.SearchId
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoverySearch.CreatedBy.User.UserPrincipalName
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: MsGraph.eDiscoverySearch.CreatedBy.Application.DisplayName
            iscontext: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 6670
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "35":
    id: "35"
    taskid: 41076824-35a8-4eb0-8445-6ceb89fff553
    type: regular
    task:
      id: 41076824-35a8-4eb0-8445-6ceb89fff553
      version: -1
      name: purge
      description: |-
        Delete Microsoft Teams messages contained in an eDiscovery search.
        Note: This request purges Teams data only. It does not purge other types of data such as mailbox items.

        You can collect and purge the following categories of Teams content:

        Teams 1:1 chats - Chat messages, posts, and attachments shared in a Teams conversation between two people. Teams 1:1 chats are also called conversations.
        Teams group chats - Chat messages, posts, and attachments shared in a Teams conversation between three or more people. Also called 1:N chats or group conversations.
        Teams channels - Chat messages, posts, replies, and attachments shared in a standard Teams channel.
        Private channels - Message posts, replies, and attachments shared in a private Teams channel.
        Shared channels - Message posts, replies, and attachments shared in a shared Teams channel.
      script: '|||msg-purge-ediscovery-data'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "36"
    scriptarguments:
      case_id:
        simple: ${CaseID}
      purge_areas:
        simple: teamsMessages
      purge_type:
        simple: permanentlyDelete
      search_id:
        simple: ${SearchID}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 6845
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "36":
    id: "36"
    taskid: 313936a4-250c-4f9d-8910-cbe79cddca5e
    type: regular
    task:
      id: 313936a4-250c-4f9d-8910-cbe79cddca5e
      version: -1
      name: delete search
      description: Delete an eDiscoverySearch object.
      script: '|||msg-delete-ediscovery-search'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "12"
    scriptarguments:
      case_id:
        simple: ${CaseID}
      search_id:
        simple: ${SearchID}
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 7020
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "37":
    id: "37"
    taskid: 9cb910dd-b555-4f39-8174-35e3b6a2b7ca
    type: regular
    task:
      id: 9cb910dd-b555-4f39-8174-35e3b6a2b7ca
      version: -1
      name: Auth test
      description: Tests connectivity to Microsoft Graph Security.
      script: '|||msg-auth-test'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "38"
    scriptarguments:
      permission_type:
        simple: ediscovery
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 195
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "38":
    id: "38"
    taskid: d222e8a2-2318-45df-8f3c-318f67c5fced
    type: regular
    task:
      id: d222e8a2-2318-45df-8f3c-318f67c5fced
      version: -1
      name: generate url
      description: Generate the login url used for Authorization code flow.
      script: '|||msg-generate-login-url'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "1"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "39":
    id: "39"
    taskid: d6fe4eb4-3a7d-4fbf-8166-977f95263382
    type: regular
    task:
      id: d6fe4eb4-3a7d-4fbf-8166-977f95263382
      version: -1
      name: Sleep 5 sec
      description: Sleep for X seconds.
      scriptName: Sleep
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "8"
    scriptarguments:
      seconds:
        simple: "5"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "40":
    id: "40"
    taskid: e3f77b93-60e1-4a05-8315-d8d8ed22e326
    type: regular
    task:
      id: e3f77b93-60e1-4a05-8315-d8d8ed22e326
      version: -1
      name: Sleep 5 sec
      description: Sleep for X seconds.
      scriptName: Sleep
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      seconds:
        simple: "5"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "41":
    id: "41"
    taskid: dec5fb20-4116-4e02-84a6-070f1f68a2fc
    type: regular
    task:
      id: dec5fb20-4116-4e02-84a6-070f1f68a2fc
      version: -1
      name: Sleep 5 sec
      description: Sleep for X seconds.
      scriptName: Sleep
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "6"
    scriptarguments:
      seconds:
        simple: "5"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1420
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "42":
    id: "42"
    taskid: 1fea9df5-dbaa-4c84-81b7-53ace314e268
    type: regular
    task:
      id: 1fea9df5-dbaa-4c84-81b7-53ace314e268
      version: -1
      name: Sleep 5 sec
      description: Sleep for X seconds.
      scriptName: Sleep
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      seconds:
        simple: "5"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2470
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 7385,
        "width": 380,
        "x": 50,
        "y": 50
      }
    }
  }
inputs: []
outputs: []
fromversion: 5.0.0