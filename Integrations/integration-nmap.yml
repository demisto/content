commonfields:
  id: nmap
  version: -1
name: nmap
display: nmap
category: Network Security
image: data:image/png;base64,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
description: Run nmap scans with the given parameters
configuration: []
script:
  script: |
    from libnmap.process import NmapProcess
    from libnmap.parser import NmapParser
    from libnmap.reportjson import ReportEncoder

    if demisto.command() == 'test-module':
        demisto.results('ok')
        sys.exit(0)
    if demisto.command() == 'nmap-scan':
        nm = NmapProcess(argToList(demisto.args()['targets']), options=demisto.args()['options'])
        rc = nm.run()
        if rc != 0:
            demisto.results({'Type': entryTypes['error'], 'ContentsFormat': formats['text'], 'Contents': 'Unable to execute - ' + nm.stderr})
            sys.exit(0)
        r = NmapParser.parse(nm.stdout)
        md = '## ' + r.summary + '\n'
        hosts = []
        for host in r.hosts:
            h = {}
            if len(host.hostnames):
                tmp_host = host.hostnames.pop()
                h['Hostname'] = tmp_host
            else:
                tmp_host = host.address

            h['Address'] = host.address
            h['Status'] = host.status
            svc = []
            md += "### Nmap scan report for {0}".format(tmp_host) + (" ({0})\n".format(host.address) if tmp_host != host.address else "\n")
            md += "#### Host is {0}.\n".format(host.status)
            for serv in host.services:
                svc.append({'Port': serv.port, 'Protocol': serv.protocol, 'State': serv.state, 'Service': serv.service, 'Banner': serv.banner})
            md += tableToMarkdown('Services', svc, ['Port', 'Protocol', 'State', 'Service', 'Banner'])
            h['Services'] = svc
            hosts.append(h)
        scan = {'Summary': r.summary, 'Version': r.version, 'Started': r.started, 'Ended': r.endtime, 'CommandLine': r.commandline, 'ScanType': r.scan_type, 'Hosts': hosts}
        demisto.results({'ContentsFormat': formats['json'], 'Type': entryTypes['note'], 'Contents': json.dumps(r, cls=ReportEncoder),
            'HumanReadable': md, 'EntryContext': {'NMAP.Scan': scan}})
  type: python
  commands:
  - name: nmap-scan
    arguments:
    - name: targets
      required: true
      description: The targets to scan. Accepts comma-separated list.
    - name: options
      required: true
      description: The nmap options to use as documented by nmap
    outputs:
    - contextPath: NMAP.Scan.Summary
      description: Scan summary
    - contextPath: NMAP.Scan.Version
      description: nmap version
    - contextPath: NMAP.Scan.Started
      description: Start time epoch
    - contextPath: NMAP.Scan.Ended
      description: End time epoch
    - contextPath: NMAP.Scan.CommandLine
      description: The command line being used
    - contextPath: NMAP.Scan.ScanType
      description: The type of discovery scan
    - contextPath: NMAP.Scan.Hosts.Hostname
      description: DNS hostname of scanned host
    - contextPath: NMAP.Scan.Hosts.Address
      description: Scanned host address
    - contextPath: NMAP.Scan.Hosts.Status
      description: Is the host up or down
    - contextPath: NMAP.Scan.Hosts.Services.Port
      description: The port of the service
    - contextPath: NMAP.Scan.Hosts.Services.Protocol
      description: The protocol of the service
    - contextPath: NMAP.Scan.Hosts.Services.State
      description: The state of the service
    - contextPath: NMAP.Scan.Hosts.Services.Banner
      description: Any captured banner from the service
    - contextPath: NMAP.Scan.Hosts.Services.Service
      description: The service name
    description: Scan targets with the given parameters
    execution: true
  dockerimage: demisto/nmap
