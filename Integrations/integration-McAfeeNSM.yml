commonfields:
  id: McAfee NSM
  version: -1
name: McAfee NSM
display: McAfee NSM
category: Network Security
image: data:image/png;base64,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
description: McAfee Network Security Manager
configuration:
- display: 'URL (for example: https://192.168.0.1:5000)'
  name: url
  defaultvalue: ""
  type: 0
  required: true
- display: Username
  name: credentials
  defaultvalue: ""
  type: 9
  required: false
- display: Do not validate server certificate (insecure)
  name: insecure
  defaultvalue: ""
  type: 8
  required: false
script:
  script: |-
    var session_credentials = '';
    var insecure = params.insecure;
    // handle '/' at the end of the url
    var base_url = params.url.slice(0, params.url.length - params.url.match('/*$')[0].length) + '/sdkapi/';

    function sendRequest(method, url_suffix, headers, body) {
        // add default headers
        if (!("Accept" in headers)) {
            headers["Accept"] = ['application/vnd.nsm.v1.0+json', 'application/vnd.nsm.v2.0+json'];
        }
        if (!("Content-Type" in headers)) {
            headers['Content-Type'] = ['application/json'];
        }
        if (session_credentials !== '') {
            headers['NSM-SDK-API'] = [session_credentials];
        }

        var res = http(
            base_url + url_suffix,
            {
                Method: method,
                Headers: headers,
                Body: body,
            },
            insecure
        );

        if (res.StatusCode < 200 || res.StatusCode >= 300) {
            throw 'Request Failed.\nStatus code: ' + res.StatusCode + '.\nBody: ' + JSON.stringify(res) + '.';
        }

        return JSON.parse(res.Body);
    }

    function validateTimeArgs(time_period, start_time, end_time) {
        if (time_period === 'CUSTOM') {
            if ((start_time === undefined) || (end_time === undefined)) {
                return false;
            }
        }
        return true;
    }

    function attacks_to_entry(title, attacks) {
        return createEntry(attacks, {
            contextPath : 'NSM.Attacks(val.ID && val.ID == obj.ID)',
            title : title,
            data : [
                {to : 'ID', from : 'attackId'},
                {to : 'Name', from : 'name'},
                {to : 'Direction', from : 'DosDirection'},
                {to : 'Severity', from : 'Severity'},
                {to : 'Category', from : 'UiCategory'},
            ],
        },
        undefined, pascalToSpace);
    }

    function IPS_policies_to_entry(title, ips_policies) {
        return createEntry(ips_policies, {
            contextPath : 'NSM.IPSPolicies(val.ID && val.ID == obj.ID)',
            title : title,
            data : [
                {to : 'ID', from : 'policyId'},
                {to : 'Name', from : 'name'},
                {to : 'DomainID', from : 'DomainId'},
                {to : 'IsEditable', from : 'IsEditable'},
                {to : 'VisibleToChildren', from : 'VisibleToChild'},
            ],
        },
        undefined, pascalToSpace);
    }

    function IPS_policy_to_entry(title, ips_policy, policy_id) {
        ips_policy.ID = policy_id;
        return createEntry([ips_policy], {
            contextPath : 'NSM.IPSPolicies(val.ID && val.ID == obj.ID)',
            title : title,
            data : [
                {to : 'ID', from : 'ID'},
                {to : 'Name', from : 'PolicyName'},
                {to : 'Description', from : 'Description'},
                {to : 'CreatedTime', from : 'Timestamp'},
                {to : 'IsEditable', from : 'IsEditable'},
                {to : 'VisibleToChildren', from : 'IsVisibleToChildren'},
                {to : 'Version', from : 'VersionNum'},
                {to : 'InboundRuleSet', from : 'InboundRuleSet'},
                {to : 'OutboundRuleSet', from : 'OutboundRuleSet'},

                {to : 'ExploitAttacks', from : 'AttackCategory.ExpolitAttackList', humanReadable : false},
            ],
        },
        undefined, pascalToSpace);
    }

    function alerts_to_entry(title, alerts) {
        return createEntry(alerts, {
            contextPath : 'NSM.Alerts(val.ID && val.ID == obj.ID)',
            title : title,
            data : [
                {to : 'ID', from : 'uniqueAlertId'},
                {to : 'Name', from : 'name'},
                {to : 'State', from : 'alertState'},
                {to : 'CreatedTime', from : 'event.time'},
                {to : 'Assignee', from : 'assignTo'},
                {to : 'AttackSeverity', from : 'attackSeverity'},
                {to : 'Application', from : 'application'},
                {to : 'EventResult', from : 'event.result'},

                {to : 'Event', from : 'event', humanReadable : false},
                {to : 'Event.domain', from : 'detection.domain', humanReadable : false},
                {to : 'Event.interface', from : 'detection.interface', humanReadable : false},
                {to : 'Event.device', from : 'detection.device', humanReadable : false},
                {to : 'Attack', from : 'attack', humanReadable : false},
                {to : 'Attacker', from : 'attacker', humanReadable : false},
                {to : 'Target', from : 'target', humanReadable : false},
                {to : 'MalwareFile', from : 'malwareFile', humanReadable : false},

            ],
        },
        undefined, pascalToSpace);
    }

    function alert_to_entry(title, alert) {
        /// single alert object has different structure than the alerts of alerts_to_entry.
        return createEntry([alert], {
            contextPath : 'NSM.Alerts(val.ID && val.ID == obj.ID)',
            title : title,
            data : [
                {to : 'ID', from : 'uniqueAlertId'},
                {to : 'Name', from : 'name'},
                {to : 'State', from : 'alertState'},
                {to : 'CreatedTime', from : 'summary.event.time'},
                {to : 'Assignee', from : 'assignTo'},
                {to : 'Description', from : 'description.definition'},
                {to : 'EventResult', from : 'summary.event.result'},

                {to : 'Event', from : 'summary.event', humanReadable : false},
                {to : 'Attack.nspId', from : 'description.referance.nspId', humanReadable : false},
                {to : 'Attack.attackCategory', from : 'description.attackCategory', humanReadable : false},
                {to : 'Attacker', from : 'summary.attacker', humanReadable : false},
                {to : 'Target', from : 'summary.target', humanReadable : false},
                {to : 'MalwareFile', from : 'details.malwareFile', humanReadable : false},
            ],
        },
        undefined, pascalToSpace);
    }

    function domains_to_entry(title, domains) {
        return createEntry(domains, {
            contextPath : 'NSM.Domains(val.ID && val.ID == obj.ID)',
            title : title,
            data : [
                {to : 'ID', from : 'DomainDescriptor.id'},
                {to : 'Name', from : 'DomainDescriptor.name'},
            ],
        },
        undefined, pascalToSpace);
    }

    function sensors_to_entry(title, sensors) {
        return createEntry(sensors, {
            contextPath : 'NSM.Sensors(val.ID && val.ID == obj.ID)',
            title : title,
            data : [
                {to : 'ID', from : 'sensorId'},
                {to : 'Name', from : 'name'},
                {to : 'Description', from : 'Description'},
                {to : 'DomainID', from : 'DomainID'},
                {to : 'IPSPolicyID', from : 'IPSPolicyID'},
                {to : 'IP Address', from : 'sensorIPAddress'},
            ],
        },
        undefined, pascalToSpace);
    }

    function login() {
        var cmd_url = "session";
        var credentials = btoa(params.credentials.identifier + ':' + params.credentials.password);
        var headers = {'NSM-SDK-API' : [credentials]};
        var res = sendRequest("GET", cmd_url, headers, '');

        // store current credentials
        session_credentials = btoa(res.session + ':' + res.userId);
        return res;
    }

    function get_attacks(attack_id) {
        var cmd_url, res;
        if (attack_id) {
            if (attack_id.match('^0x[0-9A-Fa-f]{8}$') === null) {
                throw 'Error! Attack ID must be formated as 32-bit hexadecimal number. for example: 0x1234BEEF';
            }

            cmd_url = 'attack/' + attack_id;
        } else {
            cmd_url = 'attacks';
        }

        res = sendRequest('GET', cmd_url, {}, '');
        if (attack_id) {
            return attacks_to_entry('Attack ' + attack_id, [res.AttackDescriptor]);
        } else {
            return attacks_to_entry(res.AttackDescriptorDetailsList.length + ' Attacks', res.AttackDescriptorDetailsList);
        }
    }

    function get_IPS_policies(domain_id) {
        var cmd_url = 'domain/' + domain_id + '/ipspolicies';
        var res = sendRequest('GET', cmd_url, {}, '');

        return IPS_policies_to_entry(res.PolicyDescriptorDetailsList.length + ' IPS Policies', res.PolicyDescriptorDetailsList);
    }

    function get_IPS_policy_details(policy_id) {
        var cmd_url = 'ipspolicy/' + policy_id;
        var res = sendRequest('GET', cmd_url, {}, '');

        return IPS_policy_to_entry('IPS Policy ' + policy_id, res.PolicyDescriptor, policy_id);
    }

    function get_sensors(domain_id) {
        var cmd_url = 'sensors';
        if (domain_id !== undefined) {
            cmd_url += '?domain=' + domain_id;
        }
        var res = sendRequest('GET', cmd_url, {}, '');

        return sensors_to_entry('Sensors', res.SensorDescriptor);
    }

    function get_domains(domain_id) {
        var cmd_url = 'domain';
        if (domain_id) {
            cmd_url += '/' + domain_id;
        }
        var res = sendRequest('GET', cmd_url, {}, '');

        if (domain_id) {
            return domains_to_entry('Domain ' + domain_id, [res]);
        } else {
            return domains_to_entry((res.length || '') + ' Domains', [res]);
        }
    }

    function all_alerts_url(state, time_period, start_time, end_time, search, filter) {
        var cmd_url = 'alerts';
        var cmd_args = {};

        if (state) {
            cmd_args.alertstate = state;
        }

        if (time_period) {
            cmd_args.timeperiod = time_period;
            if (time_period === 'CUSTOM') {
                cmd_args.starttime = start_time;
                cmd_args.endtime = end_time;
            }
        }

        if (search) {
            cmd_args.search = search;
        }

        if (filter) {
            cmd_args.filter = filter;
        }

        return cmd_url + encodeToURLQuery(cmd_args);
    }

    function get_alerts(state, time_period, start_time, end_time, search, filter) {
        var cmd_url = all_alerts_url(state, time_period, start_time, end_time, search, filter);
        var res = sendRequest('GET', cmd_url, {}, '');

        return alerts_to_entry('Showing ' + res.retrievedAlertsCount + '/' + res.totalAlertsCount + ' Alerts', res.alertsList);
    }

    function update_alerts(state, time_period, start_time, end_time, search, filter, new_state, new_assignee) {
        var cmd_url = all_alerts_url(state, time_period, start_time, end_time, search, filter);
        if ((new_state === undefined) && (new_assignee === undefined)) {
            throw 'Error! You must specify a new alert state or a new assignee';
        }

        var query = {};
        if (new_state) {
            query.alertState = new_state;
        }
        if (new_assignee) {
            query.assignTo = new_assignee;
        }
        query = JSON.stringify(query);

        var res = sendRequest('PUT', cmd_url, {}, query);
        if (res.status === -1) {
            throw 'Error! Failed to update alerts.';
        }

        return get_alerts(state, time_period, start_time, end_time);
    }

    function get_alert_details(alert_id) {
        var cmd_url = 'alerts/' + alert_id;
        var res = sendRequest('GET', cmd_url, {}, '');
        return alert_to_entry('Alert ' + res.name, res);
    }

    function get_ntba_monitors() {
        var cmd_url = 'ntbamonitors';
        var res = sendRequest('GET', cmd_url, {}, '');

        return res;
    }

    function get_events(nba_id, hash, duration) {
        var cmd_url = nba_id + '/endpointintelligence/' + hash + '/events?duration=' + duration;
        var res = sendRequest('GET', cmd_url, {}, '');

        return res.eventList;
    }

    login();
    switch (command) {
        case 'nsm-get-pcap':
            return get_pcap_by_sensor(args.sensorID);
        case 'nsm-get-sensors':
            return get_sensors(args.domainID);

        case 'nsm-get-domains':
            return get_domains(args.domain);

        case 'nsm-get-alerts':
            if (!validateTimeArgs(args.time_period, args.start_time, args.end_time)) {
                throw 'Error! In CUSTOM mode, You must specify both start time and end time';
            }
            return get_alerts(args.state, args.time_period, args.start_time, args.end_time, args.search, args.filter);
        case 'nsm-get-alert-details':
            return get_alert_details(args.alert_id);
        case 'nsm-update-alerts':
            if (!validateTimeArgs(args.time_period, args.start_time, args.end_time)) {
                throw 'Error! In CUSTOM mode, You must specify both start time and end time';
            }
            return update_alerts(args.state, args.time_period, args.start_time, args.end_time, args.search, args.filter, args.new_state, args.new_assignee);

        case 'nsm-get-attacks':
            return get_attacks(args.attack_id);

        case 'nsm-get-ips-policies':
            return get_IPS_policies(args.domain_id);
        case 'nsm-get-ips-policy-details':
            return get_IPS_policy_details(args.policy_id);

        case 'test-module':
            return 'ok';
        default:
            break;
    }
  type: javascript
  commands:
  - name: nsm-get-pcap
    arguments:
    - name: sensorID
      required: true
      default: true
      description: The sensor ID related to the pcap
    description: Get a pcap file of given event
  - name: nsm-get-sensors
    arguments:
    - name: domainID
      default: true
      description: The domain of the sensors. If blank, returns all sensors.
    outputs:
    - contextPath: NSM.Sensors.ID
      description: Sensor ID
    - contextPath: NSM.Sensors.Description
      description: Sensor Description
    - contextPath: NSM.Sensors.DomainID
      description: Sensor's Domain ID
    description: get a sensor list of a given domain
  - name: nsm-get-domains
    arguments:
    - name: domain
      default: true
      description: Specific domain details. Leave blank for all domains.
    outputs:
    - contextPath: NSM.Domains.ID
      description: Domain ID
    - contextPath: NSM.Domains.Name
      description: Domain Name
    description: Get all domains
  - name: nsm-get-alerts
    arguments:
    - name: time_period
      auto: PREDEFINED
      predefined:
      - LAST_5_MINUTES
      - LAST_1_HOUR
      - LAST_6_HOURS
      - LAST_12_HOURS
      - LAST_24_HOURS
      - LAST_7_DAYS
      - LAST_14_DAYS
      - CUSTOM
      description: Time Period
    - name: start_time
      description: Start Time in "mm/dd/yyyy HH:MM" format only. used for custom time
        only
    - name: end_time
      description: End Time in "mm/dd/yyyy HH:MM" format only. used for custom time
        only
    - name: state
      auto: PREDEFINED
      predefined:
      - ANY
      - Acknowledged
      - Unacknowledged
      description: Alert State
      defaultValue: ANY
    - name: search
      description: Search string in alert details
    - name: filter
      description: 'Filter alert by fields. example: "name:hello;direction:Inbound,Outbound;attackcount:>3,<4".'
    outputs:
    - contextPath: NSM.Alerts.ID
      description: Alert ID
    - contextPath: NSM.Alerts.Name
      description: Alert Name
    - contextPath: NSM.Alerts.State
      description: Alert State (Acknowledged,Unacknowledged)
    - contextPath: NSM.Alerts.CreatedTime
      description: Alert Creation Time
    - contextPath: NSM.Alerts.Assignee
      description: Alert Assignee
    - contextPath: NSM.Alerts.AttackSeverity
      description: Alert Severity
    - contextPath: NSM.Alerts.Application
      description: The Application assosiated to the alert
    - contextPath: NSM.Alerts.EventResult
      description: Event Result
    - contextPath: NSM.Alerts.Event
      description: The Event who triggered the alert
    - contextPath: NSM.Alerts.Attack
      description: Alert's Attack
    - contextPath: NSM.Alerts.Attacker
      description: The Attacker who committed the attack
    - contextPath: NSM.Alerts.Target
      description: The Attack's Target
    - contextPath: NSM.Alerts.MalwareFile
      description: Malware File used in the attack
    description: Get alerts
  - name: nsm-update-alerts
    arguments:
    - name: state
      auto: PREDEFINED
      predefined:
      - ANY
      - Acknowledged
      - Unacknowledged
      description: Alert State
      defaultValue: ANY
    - name: time_period
      auto: PREDEFINED
      predefined:
      - LAST_5_MINUTES
      - LAST_1_HOUR
      - LAST_6_HOURS
      - LAST_12_HOURS
      - LAST_24_HOURS
      - LAST_7_DAYS
      - LAST_14_DAYS
      - CUSTOM
      description: Time Period
    - name: start_time
      description: Start Time in "mm/dd/yyyy HH:MM" format only. used for custom time
        only
    - name: end_time
      description: End Time in "mm/dd/yyyy HH:MM" format only. used for custom time
        only
    - name: new_state
      auto: PREDEFINED
      predefined:
      - Acknowledged
      - Unacknowledged
      description: The new alert state
    - name: new_assignee
      description: The new assignee
    - name: search
      description: Search string in alert details
    - name: filter
      description: 'Filter alert by fields. example: "name:hello;direction:Inbound,Outbound;attackcount:>3,<4"'
    outputs:
    - contextPath: NSM.Alerts.ID
      description: Alert ID
    - contextPath: NSM.Alerts.Name
      description: Alert Name
    - contextPath: NSM.Alerts.State
      description: Alert State (Acknowledged,Unacknowledged)
    - contextPath: NSM.Alerts.CreatedTime
      description: Alert Creation Time
    - contextPath: NSM.Alerts.Assignee
      description: Alert Assignee
    - contextPath: NSM.Alerts.AttackSeverity
      description: Alert Severity
    - contextPath: NSM.Alerts.Application
      description: The Application assosiated to the alert
    - contextPath: NSM.Alerts.EventResult
      description: Event Result
    - contextPath: NSM.Alerts.Event
      description: The Event who triggered the alert
    - contextPath: NSM.Alerts.Attack
      description: Alert's Attack
    - contextPath: NSM.Alerts.Attacker
      description: The Attacker who committed the attack
    - contextPath: NSM.Alerts.Target
      description: The Attack's Target
    - contextPath: NSM.Alerts.MalwareFile
      description: Malware File used in the attack
    description: Update state or assignee of alerts
  - name: nsm-get-alert-details
    arguments:
    - name: alert_id
      required: true
      default: true
      description: Alert ID
    outputs:
    - contextPath: NSM.Alerts.ID
      description: Alert ID
    - contextPath: NSM.Alerts.Name
      description: Alert Name
    - contextPath: NSM.Alerts.State
      description: Alert State (Acknowledged,Unacknowledged)
    - contextPath: NSM.Alerts.CreatedTime
      description: Alert Creation Time
    - contextPath: NSM.Alerts.Assignee
      description: Alert assignee
    - contextPath: NSM.Alerts.Description
      description: Alert details
    - contextPath: NSM.Alerts.EventResult
      description: Event Result
    - contextPath: NSM.Alerts.Event
      description: Alert Event
    - contextPath: NSM.Alerts.Attack
      description: Alert's Attack
    - contextPath: NSM.Alerts.Attacker
      description: The Attacker who committed the attack
    - contextPath: NSM.Alerts.Target
      description: The Attack's target
    - contextPath: NSM.Alerts.MalwareFile
      description: Malware File used in the attack
    description: Get a single alert details
  - name: nsm-get-ips-policies
    arguments:
    - name: domain_id
      required: true
      default: true
      description: Domain ID
    outputs:
    - contextPath: NSM.IPSPolicies.ID
      description: IPS Policy ID
    - contextPath: NSM.IPSPolicies.Name
      description: IPS Policy Name
    - contextPath: NSM.IPSPolicies.DomainID
      description: IPS Policy Domain ID
    - contextPath: NSM.IPSPolicies.IsEditable
      description: Whether the IPS policy is editable
    - contextPath: NSM.IPSPolicies.VisibleToChildren
      description: Whether the IPS Policy is visible to domain's children
    description: Get IPS Policies in a domain
  - name: nsm-get-ips-policy-details
    arguments:
    - name: policy_id
      required: true
      default: true
      description: IPS Policy ID
    outputs:
    - contextPath: NSM.IPSPolicies.ID
      description: IPS Policy ID
    - contextPath: NSM.IPSPolicies.Name
      description: IPS Policy Name
    - contextPath: NSM.IPSPolicies.Description
      description: IPS Policy information
    - contextPath: NSM.IPSPolicies.CreatedTime
      description: Policy creation time
    - contextPath: NSM.IPSPolicies.IsEditable
      description: Whether the IPS policy is editable
    - contextPath: NSM.IPSPolicies.VisibleToChildren
      description: Whether the IPS Policy is visible to domain's children
    - contextPath: NSM.IPSPolicies.Version
      description: IPS Policy Version
    - contextPath: NSM.IPSPolicies.InboundRuleSet
      description: Inbound Rule Set
    - contextPath: NSM.IPSPolicies.OutboundRuleSet
      description: Outbound Rule Set
    - contextPath: NSM.IPSPolicies.ExploitAttacks
      description: A list of exploit attacks related to the IPS Policy
    description: Get the policy details for the specific IPS policy
  - name: nsm-get-attacks
    arguments:
    - name: attack_id
      default: true
      description: Particular Attack ID
    outputs:
    - contextPath: NSM.Attacks.ID
      description: Attack ID
    - contextPath: NSM.Attacks.Name
      description: Attack Name
    - contextPath: NSM.Attacks.Severity
      description: Attack Severity
    - contextPath: NSM.Attacks.Direction
      description: Attack Direction
    - contextPath: NSM.Attacks.Category
      description: Attack Category
    description: Get all available attack definitions in NSM