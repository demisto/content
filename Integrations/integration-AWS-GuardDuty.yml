commonfields:
  id: AWS - GuardDuty
  version: -1
name: AWS - GuardDuty
display: AWS - GuardDuty
category: IT Services
image: data:image/png;base64,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
description: Amazon Web Services Guard Duty Service (gd)
configuration:
- display: AWS Default Region
  name: defaultRegion
  defaultvalue: ""
  type: 0
  required: false
- display: Role Arn
  name: roleArn
  defaultvalue: ""
  type: 0
  required: false
- display: Fetch incidents
  name: isFetch
  defaultvalue: ""
  type: 8
  required: false
- display: Incident type
  name: incidentType
  defaultvalue: ""
  type: 13
  required: false
- display: Role Session Name
  name: roleSessionName
  defaultvalue: ""
  type: 0
  required: false
- display: Role Session Duration
  name: sessionDuration
  defaultvalue: ""
  type: 0
  required: false
- display: Guard Duty Severity level
  name: gs_severity
  defaultvalue: ""
  type: 0
  required: false
script:
  script: |+
    import boto3
    import json
    import datetime

    AWS_DEFAULT_REGION = demisto.params()['defaultRegion']
    AWS_roleArn = demisto.params()['roleArn']
    AWS_roleSessionName = demisto.params()['roleSessionName']
    AWS_roleSessionDuration = demisto.params()['sessionDuration']
    AWS_rolePolicy = None
    AWS_GD_SEVERITY = demisto.params()['gs_severity']

    def aws_session(service='guardduty',region=None,roleArn=None,roleSessionName=None,roleSessionDuration=None,rolePolicy=None):
        kwargs = {}
        if roleArn and roleSessionName is not None:
            kwargs.update({
                'RoleArn':roleArn,
                'RoleSessionName':roleSessionName,
                })
        elif AWS_roleArn and AWS_roleSessionName is not None:
            kwargs.update({
                'RoleArn':AWS_roleArn,
                'RoleSessionName':AWS_roleSessionName,
                })

        if roleSessionDuration is not None:
            kwargs.update({'DurationSeconds':roleSessionDuration})
        elif AWS_roleSessionDuration is not None:
            kwargs.update({'DurationSeconds':AWS_roleSessionDuration})

        if rolePolicy is not None:
            kwargs.update({'Policy':rolePolicy})
        elif AWS_rolePolicy is not None:
            kwargs.update({'Policy':AWS_rolePolicy})

        if kwargs:
            sts_client = boto3.client('sts')
            sts_response = sts_client.assume_role(**kwargs)
            if region is not None:
                client = boto3.client(
                    service_name=service,
                    region_name=region,
                    aws_access_key_id=sts_response['Credentials']['AccessKeyId'],
                    aws_secret_access_key=sts_response['Credentials']['SecretAccessKey'],
                    aws_session_token=sts_response['Credentials']['SessionToken']
                    )
            else:
                client = boto3.client(
                    service_name=service,
                    region_name=AWS_DEFAULT_REGION,
                    aws_access_key_id=sts_response['Credentials']['AccessKeyId'],
                    aws_secret_access_key=sts_response['Credentials']['SecretAccessKey'],
                    aws_session_token=sts_response['Credentials']['SessionToken']
                    )
        else:
            if region is not None:
                client = boto3.client(service_name=service,region_name=region)
            else:
                client = boto3.client(service_name=service,region_name=AWS_DEFAULT_REGION)

        return client

    def parse_finding_ids(finding_ids):
        id_list = finding_ids.replace(" ", "")
        findingsids = id_list.split(",")
        return findingsids

    class DatetimeEncoder(json.JSONEncoder):
      def default(self, obj):
        if isinstance (obj, datetime.datetime):
            return obj.strftime ('%Y-%m-%dT%H:%M:%S')
        elif isinstance (obj, datetime.date):
            return obj.strftime ('%Y-%m-%d')
        elif isinstance(obj, datetime):
            return obj.strftime('%Y-%m-%dT%H:%M:%S')
        elif isinstance(obj, date):
            return obj.strftime('%Y-%m-%d')
        # Let the base class default method raise the TypeError
        return json.JSONEncoder.default(self, obj)

    def create_entry(title,data, ec):
        return {
            'ContentsFormat': formats['json'],
            'Type': entryTypes['note'],
            'Contents': data,
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': tableToMarkdown(title, data) if data else 'No result were found',
            'EntryContext': ec
        }

    def raise_error(error):
        return {
            'Type' : entryTypes['error'],
            'ContentsFormat' : formats['text'],
            'Contents' : str(error)
        }

    def create_detector(args):
        try:
            client = aws_session(
                    service = 'guardduty',
                    region = args.get('region'),
                    roleArn = args.get('roleArn'),
                    roleSessionName = args.get('roleSessionName'),
                    roleSessionDuration = args.get('roleSessionDuration'),
                )
            kwargs = {'Enable':True if args.get('enable') == 'True' else False}
            response = client.create_detector(**kwargs)
            data =({
                'DetectorId': response['DetectorId']
            })
            ec = {'AWS.GuardDuty.Detectors(val.DetectorId === obj.DetectorId)': data}
            return create_entry('AWS GuardDuty Detectors', data, ec)

        except Exception as e:
            return raise_error(e)


    def delete_detector(args):
        try:
            client = aws_session(
                    region = args.get('region'),
                    roleArn = args.get('roleArn'),
                    roleSessionName = args.get('roleSessionName'),
                    roleSessionDuration = args.get('roleSessionDuration'),
                )
            response = client.delete_detector(DetectorId=args.get('detectorId'))
            if response['ResponseMetadata']['HTTPStatusCode'] == 200:
                return 'The Detector {0} has been deleted'.format(args.get('detectorId'))

        except Exception as e:
            return raise_error(e)

    def get_detector(args):
        try:
            client = aws_session(
                    region = args.get('region'),
                    roleArn = args.get('roleArn'),
                    roleSessionName = args.get('roleSessionName'),
                    roleSessionDuration = args.get('roleSessionDuration'),
                )

            response = client.get_detector(DetectorId=args.get('detectorId'))
            data = ({
                'DetectorId': args.get('detectorId'),
                'CreatedAt': response['CreatedAt'],
                'ServiceRole': response['ServiceRole'],
                'Status': response['Status'],
                'UpdatedAt': response['UpdatedAt'],
            })
            ec = {'AWS.GuardDuty.Detectors(val.DetectorId === obj.DetectorId)': data}
            return create_entry('AWS GuardDuty Detectors', data, ec)

        except Exception as e:
            return raise_error(e)

    def update_detector(args):
        try:
            client = aws_session(
                    region = args.get('region'),
                    roleArn = args.get('roleArn'),
                    roleSessionName = args.get('roleSessionName'),
                    roleSessionDuration = args.get('roleSessionDuration'),
                )
            response = client.update_detector(
                DetectorId = args.get('detectorId'),
                Enable = True if args.get('enable') == 'True' else False
            )
            if response['ResponseMetadata']['HTTPStatusCode'] == 200:
                return 'The Detector {0} has been Updated'.format(args.get('detectorId'))

        except Exception as e:
            return raise_error(e)

    def list_detectors(args):
        try:
            client = aws_session(
                    region = args.get('region'),
                    roleArn = args.get('roleArn'),
                    roleSessionName = args.get('roleSessionName'),
                    roleSessionDuration = args.get('roleSessionDuration'),
                )
            response = client.list_detectors()
            detector = response['DetectorIds']

            data = ({
                'DetectorId': detector[0]
            })
            ec = {'AWS.GuardDuty.Detectors(val.DetectorId === obj.DetectorId)': data}
            return create_entry('AWS GuardDuty Detectors', data, ec)
        except Exception as e:
            return raise_error(e)

    def create_ip_set(args):
        try:
            client = aws_session(
                    region = args.get('region'),
                    roleArn = args.get('roleArn'),
                    roleSessionName = args.get('roleSessionName'),
                    roleSessionDuration = args.get('roleSessionDuration'),
                )

            kwargs = {'DetectorId':args.get('detectorId')}
            if args.get('activate') is not None:
              kwargs.update({'Activate':True if args.get('activate') == 'True' else False})
            if args.get('format') is not None:
              kwargs.update({'Format':args.get('format')})
            if args.get('location') is not None:
              kwargs.update({'Location':args.get('location')})
            if args.get('name') is not None:
              kwargs.update({'Name':args.get('name')})

            response = client.create_ip_set(**kwargs)

            data = ({
                'DetectorId':args.get('detectorId'),
                'IpSetId': response['IpSetId']
            })
            ec = {"AWS.GuardDuty.Detectors(val.DetectorId === obj.DetectorId).IPSet(val.IpSetId === obj.IpSetId)": data}
            return create_entry('AWS GuardDuty IPSets', data, ec)

        except Exception as e:
            return e#raise_error(e)

    def delete_ip_set(args):
        try:
            client = aws_session(
                    region = args.get('region'),
                    roleArn = args.get('roleArn'),
                    roleSessionName = args.get('roleSessionName'),
                    roleSessionDuration = args.get('roleSessionDuration'),
                )
            response = client.delete_ip_set(
                DetectorId=args.get('detectorId'),
                IpSetId=args.get('ipSetId')
            )
            if response['ResponseMetadata']['HTTPStatusCode'] == 200:
                return 'The IPSet {0} has been deleted from Detector {1}'.format(args.get('ipSetId'),args.get('detectorId'))

        except Exception as e:
            return raise_error(e)

    def update_ip_set(args):
        try:
            client = aws_session(
                    region = args.get('region'),
                    roleArn = args.get('roleArn'),
                    roleSessionName = args.get('roleSessionName'),
                    roleSessionDuration = args.get('roleSessionDuration'),
                )
            kwargs ={
                'DetectorId':args.get('detectorId'),
                'IpSetId':args.get('ipSetId')
            }
            if args.get('activate'):
                kwargs.update({'Activate': True if args.get('activate') == 'True' else False})
            if args.get('location'):
                kwargs.update({'Location':args.get('location')})
            if args.get('name'):
                kwargs.update({'Name':args.get('name')})

            response = client.update_ip_set(**kwargs)

            if response['ResponseMetadata']['HTTPStatusCode'] == 200:
                return 'The IPSet {0} has been Updated'.format(args.get('ipSetId'))

        except Exception as e:
            return raise_error(e)

    def get_ip_set(args):
        try:
            client = aws_session(
                    region = args.get('region'),
                    roleArn = args.get('roleArn'),
                    roleSessionName = args.get('roleSessionName'),
                    roleSessionDuration = args.get('roleSessionDuration'),
                )
            response = client.get_ip_set(
                DetectorId=args.get('detectorId'),
                IpSetId=args.get('ipSetId')
            )
            data = ({
                'DetectorId': args.get('detectorId'),
                'IpSetId': args.get('ipSetId'),
                'Format': response['Format'],
                'Location': response['Location'],
                'Name': response['Name'],
                'Status': response['Status']
            })
            ec = {"AWS.GuardDuty.Detectors(val.DetectorId === obj.DetectorId).IPSet(val.IpSetId === obj.IpSetId)": data}
            return create_entry('AWS GuardDuty IPSets', data, ec)

        except Exception as e:
            return raise_error(e)


    def list_ip_sets(args):
        try:
            client = aws_session(
                    region = args.get('region'),
                    roleArn = args.get('roleArn'),
                    roleSessionName = args.get('roleSessionName'),
                    roleSessionDuration = args.get('roleSessionDuration'),
                )
            response = client.list_ip_sets(DetectorId=args.get('detectorId'))
            data = []
            data.append({
                'DetectorId':args.get('detectorId')
            })
            for ipset in response['IpSetIds']:
                data.append({
                    'IpSetId': ipset
                })
            ec = {"AWS.GuardDuty.Detectors(val.DetectorId === obj.DetectorId).IPSet(val.IpSetId === obj.IpSetId)": data}
            return create_entry('AWS GuardDuty IPSets', data, ec)

        except Exception as e:
            return raise_error(e)

    def create_threat_intel_set(args):
        try:
            client = aws_session(
                    region = args.get('region'),
                    roleArn = args.get('roleArn'),
                    roleSessionName = args.get('roleSessionName'),
                    roleSessionDuration = args.get('roleSessionDuration'),
                )
            kwargs = {'DetectorId':args.get('detectorId')}
            if args.get('activate') is not None:
              kwargs.update({'Activate':True if args.get('activate') == 'True' else False})
            if args.get('format') is not None:
              kwargs.update({'Format':args.get('format')})
            if args.get('location') is not None:
              kwargs.update({'Location':args.get('location')})
            if args.get('name') is not None:
              kwargs.update({'Name':args.get('name')})

            response = client.create_threat_intel_set(**kwargs)

            data =({
                'DetectorId':args.get('detectorId'),
                'ThreatIntelSetId': response['ThreatIntelSetId']
            })
            ec = {"AWS.GuardDuty.Detectors(val.DetectorId === obj.DetectorId).ThreatIntelSet(val.ThreatIntelSetId === obj.ThreatIntelSetId)": data}
            return create_entry('AWS GuardDuty ThreatIntel Set', data, ec)

        except Exception as e:
            return raise_error(e)

    def delete_threat_intel_set(args):
        try:
            client = aws_session(
                    region = args.get('region'),
                    roleArn = args.get('roleArn'),
                    roleSessionName = args.get('roleSessionName'),
                    roleSessionDuration = args.get('roleSessionDuration'),
                )
            response = client.delete_threat_intel_set(
                DetectorId=args.get('detectorId'),
                ThreatIntelSetId=args.get('threatIntelSetId')
            )
            if response['ResponseMetadata']['HTTPStatusCode'] == 200:
                return 'The ThreatIntel Set {0} has been deleted from Detector {1}'.format(args.get('ipSetId'),args.get('detectorId'))

        except Exception as e:
            return raise_error(e)


    def get_threat_intel_set(args):
        try:
            client = aws_session(
                    region = args.get('region'),
                    roleArn = args.get('roleArn'),
                    roleSessionName = args.get('roleSessionName'),
                    roleSessionDuration = args.get('roleSessionDuration'),
                )
            response = client.get_threat_intel_set(
                DetectorId=args.get('detectorId'),
                ThreatIntelSetId=args.get('threatIntelSetId')
            )
            data = ({
                'DetectorId':args.get('detectorId'),
                'ThreatIntelSetId':args.get('threatIntelSetId'),
                'Format': response['Format'],
                'Location': response['Location'],
                'Name': response['Name'],
                'Status': response['Status']
            })
            ec = {"AWS.GuardDuty.Detectors(val.DetectorId === obj.DetectorId).ThreatIntelSet(val.ThreatIntelSetId === obj.ThreatIntelSetId)": data}
            return create_entry('AWS GuardDuty ThreatIntel Set', data, ec)

        except Exception as e:
            return raise_error(e)

    def list_threat_intel_sets(args):
        try:
            client = aws_session(
                    region = args.get('region'),
                    roleArn = args.get('roleArn'),
                    roleSessionName = args.get('roleSessionName'),
                    roleSessionDuration = args.get('roleSessionDuration'),
                )
            response = client.list_threat_intel_sets(DetectorId=args.get('detectorId'))
            data = []
            data.append({
                'DetectorId':args.get('detectorId')
            })
            for threatintelset in response['ThreatIntelSetIds']:
                data.append({
                    'ThreatIntelSetId':threatintelset
                })
            ec = {"AWS.GuardDuty.Detectors(val.DetectorId === obj.DetectorId).ThreatIntelSet(val.ThreatIntelSetId === obj.ThreatIntelSetId)": data}
            return create_entry('AWS GuardDuty IPSets', data, ec)

        except Exception as e:
            return raise_error(e)

    def update_threat_intel_set(args):
        try:
            client = aws_session(
                    region = args.get('region'),
                    roleArn = args.get('roleArn'),
                    roleSessionName = args.get('roleSessionName'),
                    roleSessionDuration = args.get('roleSessionDuration'),
                )
            kwargs = {
                'DetectorId':args.get('detectorId'),
                'ThreatIntelSetId':args.get('threatIntelSetId')
            }
            if args.get('activate'):
                kwargs.update({'Activate':True if args.get('activate') == 'True' else False})
            if args.get('location'):
                kwargs.update({'Location':args.get('location')})
            if args.get('name'):
                kwargs.update({'Name':args.get('name')})
            response = client.update_threat_intel_set(**kwargs)
            if response['ResponseMetadata']['HTTPStatusCode'] == 200:
                return 'The ThreatIntel Set {0} has been Updated'.format(args.get('threatIntelSetId'))

        except Exception as e:
            return raise_error(e)

    def severity_mapping(severity):
        if severity <= 3.9:
            demistoSevirity = 1
        elif severity >= 4 and severity <= 6.9:
            demistoSevirity = 2
        elif severity >= 7 and severity <= 8.9:
            demistoSevirity = 3
        else:
            demistoSevirity = 0

        return demistoSevirity

    def gd_severity_mapping(severity):
        if severity == 'Low':
            gdSevirity = 1
        elif severity == 'Medium':
            gdSevirity = 4
        elif severity == 'High':
            gdSevirity = 7
        else:
            gdSevirity = 1

        return gdSevirity

    def list_findings(args):
        try:
            client = aws_session(
                    region = args.get('region'),
                    roleArn = args.get('roleArn'),
                    roleSessionName = args.get('roleSessionName'),
                    roleSessionDuration = args.get('roleSessionDuration'),
                )

            paginator = client.get_paginator('list_findings')
            response_iterator = paginator.paginate(DetectorId=args.get('detectorId'))
            data = []
            for page in response_iterator:
                for finding in page['FindingIds']:
                    data.append({'FindingId':finding})

            ec = {"AWS.GuardDuty.Findings": data}
            return create_entry('AWS GuardDuty Findings', data, ec)

        except Exception as e:
            return raise_error(e)

    def get_findings(args):
        try:
            client = aws_session(
                    region = args.get('region'),
                    roleArn = args.get('roleArn'),
                    roleSessionName = args.get('roleSessionName'),
                    roleSessionDuration = args.get('roleSessionDuration'),
                )
            response = client.get_findings(
                DetectorId=args.get('detectorId'),
                FindingIds=parse_finding_ids(args.get('findingIds')))

            data = []
            for finding in response['Findings']:
                data.append({
                        'AccountId':finding['AccountId'],
                        'Arn':finding['Arn'],
                        'CreatedAt':finding['CreatedAt'],
                        'Description':finding['Description'],
                        'Id':finding['Id'],
                        'Region':finding['Region'],
                        'Title':finding['Title'],
                        'Type':finding['Type'],
                    })

            output = json.dumps( response['Findings'], cls=DatetimeEncoder)
            raw = json.loads(output)
            ec = {"AWS.GuardDuty.Findings(val.FindingId === obj.Id)": raw}
            return create_entry('AWS GuardDuty Findings', data, ec)

        except Exception as e:
            return raise_error(e)

    def parse_incident_from_finding(finding):
        incident = {}
        incident['name'] = finding['Title']
        incident['details'] = finding['Description']
        incident['occurred'] = finding['CreatedAt']
        incident['severity'] = severity_mapping(finding['Severity'])
        incident['rawJSON'] = json.dumps(finding)
        return incident

    def fetch_incidents():
        try:
            client = aws_session()
            findingIds = []
            incidents = []
            response = client.list_detectors()
            detector = response['DetectorIds']

            list_findings = client.list_findings(DetectorId=detector[0],FindingCriteria={
            'Criterion': {
                    'service.archived': {'Eq': ['false','false']},
                    'severity': {'Gt': gd_severity_mapping(AWS_GD_SEVERITY)}
                    }
                }
            )

            get_findings = client.get_findings(DetectorId=detector[0], FindingIds=list_findings['FindingIds'])

            for finding in get_findings['Findings']:
                incident = parse_incident_from_finding(finding)
                incidents.append(incident)

            #Create demisto incidents
            demisto.incidents(incidents)
            if incidents is not None:
                #Archive findings
                archive_findings = client.archive_findings(DetectorId=detector[0],FindingIds=list_findings['FindingIds'])

        except Exception as e:
            return raise_error(e)

    def create_sample_findings(args):
        try:
            client = aws_session(
                    region = args.get('region'),
                    roleArn = args.get('roleArn'),
                    roleSessionName = args.get('roleSessionName'),
                    roleSessionDuration = args.get('roleSessionDuration'),
                )
            kwargs = {'DetectorId':args.get('detectorId')}
            if args.get('findingTypes') is not None:
                kwargs.update({'FindingTypes':parse_finding_ids(args.get('findingTypes'))})

            response = client.create_sample_findings(**kwargs)

            if response['ResponseMetadata']['HTTPStatusCode'] == 200:
                return 'Sample Findings were generated'

        except Exception as e:
            return raise_error(e)

    def archive_findings(args):
        try:
            client = aws_session(
                    region = args.get('region'),
                    roleArn = args.get('roleArn'),
                    roleSessionName = args.get('roleSessionName'),
                    roleSessionDuration = args.get('roleSessionDuration'),
                )
            kwargs = {'DetectorId':args.get('detectorId')}
            if args.get('findingIds') is not None:
                kwargs.update({'FindingIds':parse_finding_ids(args.get('findingIds'))})

            response = client.archive_findings(**kwargs)

            if response['ResponseMetadata']['HTTPStatusCode'] == 200:
                return 'Findings were archived'

        except Exception as e:
            return raise_error(e)

    def unarchive_findings(args):
        try:
            client = aws_session(
                    region = args.get('region'),
                    roleArn = args.get('roleArn'),
                    roleSessionName = args.get('roleSessionName'),
                    roleSessionDuration = args.get('roleSessionDuration'),
                )
            kwargs = {'DetectorId':args.get('detectorId')}
            if args.get('findingIds') is not None:
                kwargs.update({'FindingIds':parse_finding_ids(args.get('findingIds'))})

            response = client.unarchive_findings(**kwargs)

            if response['ResponseMetadata']['HTTPStatusCode'] == 200:
                return 'Findings were Unarchived'

        except Exception as e:
            return raise_error(e)

    def update_findings_feedback(args):
        try:
            client = aws_session(
                    region = args.get('region'),
                    roleArn = args.get('roleArn'),
                    roleSessionName = args.get('roleSessionName'),
                    roleSessionDuration = args.get('roleSessionDuration'),
                )

            kwargs = {'DetectorId':args.get('detectorId')}
            if args.get('findingIds') is not None:
                kwargs.update({'FindingIds':parse_finding_ids(args.get('findingIds'))})
            if args.get('comments') is not None:
                kwargs.update({'Comments':parse_finding_ids(args.get('comments'))})
            if args.get('feedback') is not None:
                kwargs.update({'Feedback':parse_finding_ids(args.get('feedback'))})

            response = client.update_findings_feedback(**kwargs)
            if response['ResponseMetadata']['HTTPStatusCode'] == 200:
                return 'Findings Feedback sent!'

        except Exception as e:
            return raise_error(e)


    def test_function():
        try:
            client = aws_session()
            response = client.list_detectors()
            if response['ResponseMetadata']['HTTPStatusCode'] == 200:
                return 'ok'

        except Exception as e:
            return raise_error(e)

    # The command demisto.command() holds the command sent from the user.
    if demisto.command() == 'test-module':
        # This is the call made when pressing the integration test button.
        result = test_function()

    if demisto.command() == 'aws-gd-create-detector':
        result = create_detector(demisto.args())

    if demisto.command() == 'aws-gd-delete-detector':
        result = delete_detector(demisto.args())

    if demisto.command() == 'aws-gd-get-detector':
        result = get_detector(demisto.args())

    if demisto.command() == 'aws-gd-update-detector':
        result = update_detector(demisto.args())

    if demisto.command() == 'aws-gd-create-ip-set':
        result = create_ip_set(demisto.args())

    if demisto.command() == 'aws-gd-delete-ip-set':
        result = delete_ip_set(demisto.args())

    if demisto.command() == 'aws-gd-list-detectors':
        result = list_detectors(demisto.args())

    if demisto.command() == 'aws-gd-update-ip-set':
        result = update_ip_set(demisto.args())

    if demisto.command() == 'aws-gd-get-ip-set':
        result = get_ip_set(demisto.args())

    if demisto.command() == 'aws-gd-list-ip-sets':
        result = list_ip_sets(demisto.args())

    if demisto.command() == 'aws-gd-create-threatintel-set':
        result = create_threat_intel_set(demisto.args())

    if demisto.command() == 'aws-gd-delete-threatintel-set':
        result = delete_threat_intel_set(demisto.args())

    if demisto.command() == 'aws-gd-get-threatintel-set':
        result = get_threat_intel_set(demisto.args())

    if demisto.command() == 'aws-gd-list-threatintel-sets':
        result = list_threat_intel_sets(demisto.args())

    if demisto.command() == 'aws-gd-update-threatintel-set':
        result = update_threat_intel_set(demisto.args())

    if demisto.command() == 'aws-gd-list-findings':
        result = list_findings(demisto.args())

    if demisto.command() == 'aws-gd-get-findings':
        result = get_findings(demisto.args())

    if demisto.command() == 'aws-gd-create-sample-findings':
        result = create_sample_findings(demisto.args())

    if demisto.command() == 'aws-gd-archive-findings':
        result = archive_findings(demisto.args())

    if demisto.command() == 'aws-gd-unarchive-findings':
        result = unarchive_findings(demisto.args())

    if demisto.command() == 'aws-gd-update-findings-feedback':
        result = update_findings_feedback(demisto.args())

    if demisto.command() == 'fetch-incidents':
        fetch_incidents()
        sys.exit(0)

    demisto.results(result)
    sys.exit(0)

  type: python
  commands:
  - name: aws-gd-create-detector
    arguments:
    - name: enabled
      required: true
      auto: PREDEFINED
      predefined:
      - "True"
      - "False"
      description: A boolean value that specifies whether the detector is to be enabled.
      defaultValue: "True"
    - name: region
      description: The AWS Region, if not specified the default region will be used.
    - name: roleArn
      description: The Amazon Resource Name (ARN) of the role to assume.
    - name: roleSessionName
      description: An identifier for the assumed role session.
    - name: roleSessionDuration
      description: The duration, in seconds, of the role session. The value can range
        from 900 seconds (15 minutes) up to the maximum session duration setting for
        the role.
    outputs:
    - contextPath: AWS.GuardDuty.Detectors.DetectorId
      description: The unique ID of the created detector.
      type: string
    description: Create an AWS Guard Duty Detector on the integration instance specified
      aws account.
  - name: aws-gd-delete-detector
    arguments:
    - name: detectorId
      required: true
      description: The unique ID that specifies the detector that you want to delete.
    - name: region
      description: The AWS Region, if not specified the default region will be used.
    - name: roleArn
      description: The Amazon Resource Name (ARN) of the role to assume.
    - name: roleSessionName
      description: An identifier for the assumed role session.
    - name: roleSessionDuration
      description: The duration, in seconds, of the role session. The value can range
        from 900 seconds (15 minutes) up to the maximum session duration setting for
        the role.
    description: Deletes a Amazon GuardDuty detector specified by the detector ID.
  - name: aws-gd-get-detector
    arguments:
    - name: detectorId
      required: true
      description: The unique ID of the detector that you want to retrieve.
    - name: region
      description: The AWS Region, if not specified the default region will be used.
    - name: roleArn
      description: The Amazon Resource Name (ARN) of the role to assume.
    - name: roleSessionName
      description: An identifier for the assumed role session.
    - name: roleSessionDuration
      description: The duration, in seconds, of the role session. The value can range
        from 900 seconds (15 minutes) up to the maximum session duration setting for
        the role.
    outputs:
    - contextPath: AWS.GuardDuty.Detectors.DetectorId
      description: The unique ID of the created detector.
      type: string
    - contextPath: AWS.GuardDuty.Detectors.CreatedAt
      description: The first time a resource was created.
      type: string
    - contextPath: AWS.GuardDuty.Detectors.ServiceRole
      description: Customer serviceRole name or ARN for accessing customer resources.
      type: string
    - contextPath: AWS.GuardDuty.Detectors.Status
      description: The status of detector.
      type: string
    - contextPath: AWS.GuardDuty.Detectors.UpdatedAt
      description: The time a resource was last updated.
      type: string
    description: Retrieves an Amazon GuardDuty detector specified by the detectorId.
  - name: aws-gd-update-detector
    arguments:
    - name: detectorId
      required: true
      description: The unique ID of the detector that you want to update.
    - name: enable
      required: true
      auto: PREDEFINED
      predefined:
      - "True"
      - "False"
      description: Updated boolean value for the detector that specifies whether the
        detector is enabled.
      defaultValue: "True"
    - name: region
      description: The AWS Region, if not specified the default region will be used.
    - name: roleArn
      description: The Amazon Resource Name (ARN) of the role to assume.
    - name: roleSessionName
      description: An identifier for the assumed role session.
    - name: roleSessionDuration
      description: The duration, in seconds, of the role session. The value can range
        from 900 seconds (15 minutes) up to the maximum session duration setting for
        the role.
    description: Updates an Amazon GuardDuty detector specified by the detectorId.
  - name: aws-gd-create-ip-set
    arguments:
    - name: activate
      auto: PREDEFINED
      predefined:
      - "True"
      - "False"
      description: A boolean value that indicates whether GuardDuty is to start using
        the uploaded IPSet.
      defaultValue: "True"
    - name: detectorId
      required: true
      description: The unique ID of the detector that you want to update.
    - name: format
      required: true
      auto: PREDEFINED
      predefined:
      - TXT
      - STIX
      - OTX_CSV
      - ALIEN_VAULT
      - PROOF_POINT
      - FIRE_EYE
      description: The format of the file that contains the IPSet.
    - name: location
      description: The URI of the file that contains the IPSet. For example (https://s3.us-west-2.amazonaws.com/my-bucket/my-object-key)
    - name: name
      description: The user friendly name to identify the IPSet. This name is displayed
        in all findings that are triggered by activity that involves IP addresses
        included in this IPSet.
    - name: region
      description: The AWS Region, if not specified the default region will be used.
    - name: roleArn
      description: The Amazon Resource Name (ARN) of the role to assume.
    - name: roleSessionName
      description: An identifier for the assumed role session.
    - name: roleSessionDuration
      description: The duration, in seconds, of the role session. The value can range
        from 900 seconds (15 minutes) up to the maximum session duration setting for
        the role.
    outputs:
    - contextPath: AWS.GuardDuty.Detectors.IPSet.IpSetId
      description: The unique identifier for an IP Set.
    description: A list of trusted IP addresses that have been whitelisted for secure
      communication with AWS infrastructure and applications.
  - name: aws-gd-delete-ip-set
    arguments:
    - name: detectorId
      required: true
      description: The detectorID that specifies the GuardDuty service whose IPSet
        you want to delete.
    - name: ipSetId
      required: true
      description: The unique ID that specifies the IPSet that you want to delete.
    - name: region
      description: The AWS Region, if not specified the default region will be used.
    - name: roleArn
      description: The Amazon Resource Name (ARN) of the role to assume.
    - name: roleSessionName
      description: An identifier for the assumed role session.
    - name: roleSessionDuration
      description: The duration, in seconds, of the role session. The value can range
        from 900 seconds (15 minutes) up to the maximum session duration setting for
        the role.
    description: Deletes the IPSet specified by the IPSet ID.
  - name: aws-gd-list-detectors
    arguments:
    - name: region
      description: The AWS Region, if not specified the default region will be used.
    - name: roleArn
      description: The Amazon Resource Name (ARN) of the role to assume.
    - name: roleSessionName
      description: An identifier for the assumed role session.
    - name: roleSessionDuration
      description: The duration, in seconds, of the role session. The value can range
        from 900 seconds (15 minutes) up to the maximum session duration setting for
        the role.
    outputs:
    - contextPath: AWS.GuardDuty.Detectors.DetectorId
      description: The unique identifier for a detector.
      type: string
    description: Lists detectorIds of all the existing Amazon GuardDuty detector resources.
  - name: aws-gd-update-ip-set
    arguments:
    - name: activate
      auto: PREDEFINED
      predefined:
      - "True"
      - "False"
      description: The updated boolean value that specifies whether the IPSet is active
        or not.
    - name: detectorId
      required: true
      description: The detectorID that specifies the GuardDuty service whose IPSet
        you want to update.
    - name: ipSetId
      required: true
      description: The unique ID that specifies the IPSet that you want to update.
    - name: location
      description: The updated URI of the file that contains the IPSet. For example
        (https://s3.us-west-2.amazonaws.com/my-bucket/my-object-key).
    - name: name
      description: The user friendly name to identify the IPSet.
    - name: region
      description: The AWS Region, if not specified the default region will be used.
    - name: roleArn
      description: The Amazon Resource Name (ARN) of the role to assume.
    - name: roleSessionName
      description: An identifier for the assumed role session.
    - name: roleSessionDuration
      description: The duration, in seconds, of the role session. The value can range
        from 900 seconds (15 minutes) up to the maximum session duration setting for
        the role.
    description: Updates the IPSet specified by the IPSet ID.
  - name: aws-gd-get-ip-set
    arguments:
    - name: detectorId
      required: true
      description: The detectorID that specifies the GuardDuty service whose IPSet
        you want to retrieve.
    - name: ipSetId
      required: true
      description: The unique ID that specifies the IPSet that you want to describe.
    - name: region
      description: The AWS Region, if not specified the default region will be used.
    - name: roleArn
      description: The Amazon Resource Name (ARN) of the role to assume.
    - name: roleSessionName
      description: An identifier for the assumed role session.
    - name: roleSessionDuration
      description: The duration, in seconds, of the role session. The value can range
        from 900 seconds (15 minutes) up to the maximum session duration setting for
        the role.
    outputs:
    - contextPath: AWS.GuardDuty.Detectors.IPSet.IpSetId
      description: The unique ID for the IPSet.
      type: string
    - contextPath: AWS.GuardDuty.Detectors.IPSet.Format
      description: The format of the file that contains the IPSet.
      type: string
    - contextPath: AWS.GuardDuty.Detectors.IPSet.Location
      description: The URI of the file that contains the IPSet.
      type: string
    - contextPath: AWS.GuardDuty.Detectors.IPSet.Name
      description: he user friendly name to identify the IPSet.
      type: string
    - contextPath: AWS.GuardDuty.Detectors.IPSet.Status
      description: The status of ipSet file uploaded.
      type: string
    description: Retrieves the IPSet specified by the IPSet ID.
  - name: aws-gd-list-ip-sets
    arguments:
    - name: detectorId
      required: true
      description: The unique ID of the detector that you want to retrieve.
    - name: region
      description: The AWS Region, if not specified the default region will be used.
    - name: roleArn
      description: The Amazon Resource Name (ARN) of the role to assume.
    - name: roleSessionName
      description: An identifier for the assumed role session.
    - name: roleSessionDuration
      description: The duration, in seconds, of the role session. The value can range
        from 900 seconds (15 minutes) up to the maximum session duration setting for
        the role.
    outputs:
    - contextPath: AWS.GuardDuty.Detectors.IPSet.IpSetId
      description: The unique identifier for an IP Set
    description: Lists the IPSets of the GuardDuty service specified by the detector
      ID.
  - name: aws-gd-create-threatintel-set
    arguments:
    - name: activate
      required: true
      auto: PREDEFINED
      predefined:
      - "True"
      - "False"
      description: A boolean value that indicates whether GuardDuty is to start using
        the uploaded ThreatIntelSet.
      defaultValue: "True"
    - name: detectorId
      required: true
      description: The unique ID of the detector that you want to update.
    - name: format
      required: true
      auto: PREDEFINED
      predefined:
      - TXT
      - STIX
      - OTX_CSV
      - ALIEN_VAULT
      - PROOF_POINT
      - FIRE_EYE
      description: The format of the file that contains the ThreatIntelSet.
    - name: location
      required: true
      description: The URI of the file that contains the ThreatIntelSet. For example
        (https://s3.us-west-2.amazonaws.com/my-bucket/my-object-key).
    - name: name
      required: true
      description: A user-friendly ThreatIntelSet name that is displayed in all finding
        generated by activity that involves IP addresses included in this ThreatIntelSet.
    - name: region
      description: The AWS Region, if not specified the default region will be used.
    - name: roleArn
      description: The Amazon Resource Name (ARN) of the role to assume.
    - name: roleSessionName
      description: An identifier for the assumed role session.
    - name: roleSessionDuration
      description: The duration, in seconds, of the role session. The value can range
        from 900 seconds (15 minutes) up to the maximum session duration setting for
        the role.
    outputs:
    - contextPath: AWS.GuardDuty.Detectors.ThreatIntelSet.ThreatIntelSetId
      description: The unique identifier for an threat intel set.
      type: string
    description: Create a new ThreatIntelSet. ThreatIntelSets consist of known malicious
      IP addresses. GuardDuty generates findings based on ThreatIntelSets.
  - name: aws-gd-delete-threatintel-set
    arguments:
    - name: detectorId
      required: true
      description: The detectorID that specifies the GuardDuty service whose ThreatIntelSet
        you want to delete.
    - name: threatIntelSetId
      required: true
      description: The unique ID that specifies the ThreatIntelSet that you want to
        delete.
    - name: region
      description: The AWS Region, if not specified the default region will be used.
    - name: roleArn
      description: The Amazon Resource Name (ARN) of the role to assume.
    - name: roleSessionName
      description: An identifier for the assumed role session.
    - name: roleSessionDuration
      description: The duration, in seconds, of the role session. The value can range
        from 900 seconds (15 minutes) up to the maximum session duration setting for
        the role.
    description: Deletes ThreatIntelSet specified by the ThreatIntelSet ID.
  - name: aws-gd-get-threatintel-set
    arguments:
    - name: detectorId
      required: true
      description: The detectorID that specifies the GuardDuty service whose ThreatIntelSet
        you want to describe.
    - name: threatIntelSetId
      required: true
      description: The unique ID that specifies the ThreatIntelSet that you want to
        describe.
    - name: region
      description: The AWS Region, if not specified the default region will be used.
    - name: roleArn
      description: The Amazon Resource Name (ARN) of the role to assume.
    - name: roleSessionName
      description: An identifier for the assumed role session.
    - name: roleSessionDuration
      description: The duration, in seconds, of the role session. The value can range
        from 900 seconds (15 minutes) up to the maximum session duration setting for
        the role.
    outputs:
    - contextPath: AWS.GuardDuty.Detectors.ThreatIntelSet.ThreatIntelSetId
      description: The unique ID that specifies the ThreatIntelSet.
      type: string
    - contextPath: AWS.GuardDuty.Detectors.ThreatIntelSet.Format
      description: The format of the threatIntelSet.
      type: string
    - contextPath: AWS.GuardDuty.Detectors.ThreatIntelSet.Location
      description: The URI of the file that contains the ThreatIntelSet.
      type: string
    - contextPath: AWS.GuardDuty.Detectors.ThreatIntelSet.Name
      description: A user-friendly ThreatIntelSet name.
      type: string
    - contextPath: AWS.GuardDuty.Detectors.ThreatIntelSet.Status
      description: The status of threatIntelSet file uploaded.
      type: string
    description: Retrieves the ThreatIntelSet that is specified by the ThreatIntelSet
      ID.
  - name: aws-gd-list-threatintel-sets
    arguments:
    - name: detectorId
      required: true
      description: The detectorID that specifies the GuardDuty service whose ThreatIntelSets
        you want to list.
    - name: region
      description: The AWS Region, if not specified the default region will be used.
    - name: roleArn
      description: The Amazon Resource Name (ARN) of the role to assume.
    - name: roleSessionName
      description: An identifier for the assumed role session.
    - name: roleSessionDuration
      description: The duration, in seconds, of the role session. The value can range
        from 900 seconds (15 minutes) up to the maximum session duration setting for
        the role.
    outputs:
    - contextPath: AWS.GuardDuty.Detectors.ThreatIntelSet.ThreatIntelSetId
      description: The unique identifier for an threat intel set
      type: string
    description: Lists the ThreatIntelSets of the GuardDuty service specified by the
      detector ID.
  - name: aws-gd-update-threatintel-set
    arguments:
    - name: detectorId
      required: true
      description: The detectorID that specifies the GuardDuty service whose ThreatIntelSet
        you want to update.
    - name: threatIntelSetId
      description: The unique ID that specifies the ThreatIntelSet that you want to
        update.
    - name: activate
      auto: PREDEFINED
      predefined:
      - "True"
      - "False"
      description: The updated boolean value that specifies whether the ThreateIntelSet
        is active or not.
    - name: location
      description: The updated URI of the file that contains the ThreateIntelSet.
        For example (https://s3.us-west-2.amazonaws.com/my-bucket/my-object-key).
    - name: name
      description: The user-friendly ThreatIntelSet name.
    - name: region
      description: The AWS Region, if not specified the default region will be used.
    - name: roleArn
      description: The Amazon Resource Name (ARN) of the role to assume.
    - name: roleSessionName
      description: An identifier for the assumed role session.
    - name: roleSessionDuration
      description: The duration, in seconds, of the role session. The value can range
        from 900 seconds (15 minutes) up to the maximum session duration setting for
        the role.
    description: Updates the ThreatIntelSet specified by ThreatIntelSet ID.
  - name: aws-gd-list-findings
    arguments:
    - name: detectorId
      required: true
      description: The ID of the detector that specifies the GuardDuty service whose
        findings you want to list.
    - name: region
      description: The AWS Region, if not specified the default region will be used.
    - name: roleArn
      description: The Amazon Resource Name (ARN) of the role to assume.
    - name: roleSessionName
      description: An identifier for the assumed role session.
    - name: roleSessionDuration
      description: The duration, in seconds, of the role session. The value can range
        from 900 seconds (15 minutes) up to the maximum session duration setting for
        the role.
    outputs:
    - contextPath: AWS.GuardDuty.Findings.FindingId
      description: The unique identifier for the Finding
      type: string
    description: Lists Amazon GuardDuty findings for the specified detector ID.
  - name: aws-gd-get-findings
    arguments:
    - name: detectorId
      required: true
      description: The ID of the detector that specifies the GuardDuty service whose
        findings you want to retrieve.
    - name: findingIds
      required: true
      description: IDs of the findings that you want to retrieve.
    - name: region
      description: The AWS Region, if not specified the default region will be used.
    - name: roleArn
      description: The Amazon Resource Name (ARN) of the role to assume.
    - name: roleSessionName
      description: An identifier for the assumed role session.
    - name: roleSessionDuration
      description: The duration, in seconds, of the role session. The value can range
        from 900 seconds (15 minutes) up to the maximum session duration setting for
        the role.
    description: Describes Amazon GuardDuty findings specified by finding IDs.
  - name: aws-gd-create-sample-findings
    arguments:
    - name: detectorId
      required: true
      description: The ID of the detector to create sample findings for.
    - name: findingTypes
      description: Types of sample findings that you want to generate. Separated by
        comma.
    - name: region
      description: The AWS Region, if not specified the default region will be used.
    - name: roleArn
      description: The Amazon Resource Name (ARN) of the role to assume.
    - name: roleSessionName
      description: An identifier for the assumed role session.
    - name: roleSessionDuration
      description: The duration, in seconds, of the role session. The value can range
        from 900 seconds (15 minutes) up to the maximum session duration setting for
        the role.
    description: Generates example findings of types specified by the list of finding
      types. If 'NULL' is specified for findingTypes, the API generates example findings
      of all supported finding types.
  - name: aws-gd-archive-findings
    arguments:
    - name: detectorId
      required: true
      description: The ID of the detector that specifies the GuardDuty service whose
        findings you want to archive.
    - name: findingIds
      description: IDs of the findings that you want to archive. Separated by comma.
    - name: region
      description: The AWS Region, if not specified the default region will be used.
    - name: roleArn
      description: The Amazon Resource Name (ARN) of the role to assume.
    - name: roleSessionName
      description: An identifier for the assumed role session.
    - name: roleSessionDuration
      description: The duration, in seconds, of the role session. The value can range
        from 900 seconds (15 minutes) up to the maximum session duration setting for
        the role.
    description: Archives Amazon GuardDuty findings specified by the list of finding
      IDs.
  - name: aws-gd-unarchive-findings
    arguments:
    - name: detectorId
      required: true
      description: The ID of the detector that specifies the GuardDuty service whose
        findings you want to unarchive.
    - name: findingIds
      description: IDs of the findings that you want to unarchive.
    description: Unarchives Amazon GuardDuty findings specified by the list of finding
      IDs.
  - name: aws-gd-update-findings-feedback
    arguments:
    - name: detectorId
      required: true
      description: The ID of the detector that specifies the GuardDuty service whose
        findings you want to mark as useful or not useful.
    - name: findingIds
      description: IDs of the findings that you want to mark as useful or not useful.
    - name: comments
      description: Additional feedback about the GuardDuty findings.
    - name: feedback
      auto: PREDEFINED
      predefined:
      - USEFUL
      - NOT_USEFUL
      description: Specifi wheter the finding was usful or not.
    - name: region
      description: The AWS Region, if not specified the default region will be used.
    - name: roleArn
      description: The Amazon Resource Name (ARN) of the role to assume.
    - name: roleSessionName
      description: An identifier for the assumed role session.
    - name: roleSessionDuration
      description: The duration, in seconds, of the role session. The value can range
        from 900 seconds (15 minutes) up to the maximum session duration setting for
        the role.
    description: Marks specified Amazon GuardDuty findings as useful or not useful.
  dockerimage: demisto/boto3
  isfetch: true
  runonce: false
