commonfields:
  id: RSA NetWitness v11.1
  version: -1
name: RSA NetWitness v11.1
display: RSA NetWitness v11.1
category: Analytics & SIEM
image: data:image/png;base64,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
description: RSA NetWitness Platform provides systems Logs, Network, and endpoint
  visibility for real-time collection, detection, and automated response with the
  Demisto Enterprise platform. Providing full session analysis, customers can extract
  critical data and effectively operate security operations automated playbook.
configuration:
- display: Server URL (e.g. https://192.168.0.1:30022)
  name: server
  defaultvalue: ""
  type: 0
  required: true
- display: ""
  name: credentials
  defaultvalue: ""
  type: 9
  required: true
- display: ""
  name: version
  defaultvalue: "1.0"
  type: 0
  required: false
- display: Trust any certificate (unsecure)
  name: insecure
  defaultvalue: "false"
  type: 8
  required: false
- display: Use system proxy settings
  name: proxy
  defaultvalue: "false"
  type: 8
  required: false
- display: Fetch incidents
  name: isFetch
  defaultvalue: ""
  type: 8
  required: false
- display: Incident type
  name: incidentType
  defaultvalue: ""
  type: 13
  required: false
- display: on 'Fetch incidents' import all alerts related to the incident
  name: importAlerts
  defaultvalue: "false"
  type: 8
  required: false
script:
  script: |2+

    """

    IMPORTS

    """
    from datetime import datetime, timedelta
    import requests
    import urllib
    import json
    import os
    import re
    # disable insecure warnings
    requests.packages.urllib3.disable_warnings()

    """

    HANDLE PROXY

    """

    def set_proxies():

        if demisto.params()['proxy']:
            http = os.environ['http_proxy'] or os.environ['HTTP_PROXY']
            https = os.environ['https_proxy'] or os.environ['HTTPS_PROXY']
            proxies = {
                'http': http,
                'https': https
            }
            return proxies
        return None


    """

    HELPERS

    """
    def dict_list_to_str(dict_list):
        """

        parses a list of dictionaries into a string representation

        """
        if not dict_list:
            return ''
        string_list = []
        for dict in dict_list:
            key_values = ["{}: {}".format(k,v) for k,v in dict.items()]
            string_list.append(', '.join(key_values))
        return '\n'.join(string_list)

    """

    AUTHENTICATION

    """

    def get_token_request(username, password):
        """

        returns a token on successful get_token request

        raises an exception on:

            - http request failure
            - response status code different from 200
            - response body does not contain valid json (ValueError)

        """
        username_password = "username={}&password={}".format(username, password)
        url = '{}/auth/userpass'.format(BASE_PATH)
        get_token_headers = {
            'Content-Type' : 'application/x-www-form-urlencoded;charset=ISO-8859-1',
            'Accept': 'application/json; charset=UTF-8',
            'NetWitness-Version': VERSION
        }

        response = requests.post(url,
            headers = get_token_headers,
            data = username_password,
            verify = USE_SSL,
            proxies = PROXIES
        )

        #successful get_token
        if response.status_code == 200:
            return response.json()
        #bad request - NetWitness returns a common json structure for errors
        error_lst = response.json().get('errors')
        raise ValueError('get_token failed with status: {}\n{}'.format(response.status_code, dict_list_to_str(error_lst)))

    def get_token():
        """

        returns a token to be used in future requests to NetWitness server

        raises an exception on:

            - unexpected response from the server

        """
        LOG('Attempting to get token')
        response_body = get_token_request(
            USERNAME,
            PASSWORD
        )
        LOG('Token recieved')
        token = response_body.get('accessToken')
        if not token:
            raise ValueError('Failed to access get_token token (Unexpected response)')
        return token

    """

    GLOBAL VARS

    """
    SERVER_URL = demisto.params()['server']
    BASE_PATH = '{}/rest/api'.format(SERVER_URL)
    USERNAME = demisto.params()['credentials']['identifier']
    PASSWORD = demisto.params()['credentials']['password']
    USE_SSL = not demisto.params()['insecure']
    VERSION = demisto.params()['version']
    PROXIES = set_proxies()
    TOKEN = get_token()
    DEFAULT_HEADERS = {
        'Content-Type' : 'application/json;charset=UTF-8',
        'Accept': 'application/json; charset=UTF-8',
        'NetWitness-Version': VERSION
    }

    """

    COMMAND HANDLERS

    """

    def http_request(method, url, body=None, headers={}, url_params=None):
        '''
        returns the http response body

        uses TOKEN global var to send requests to RSA end (this enables using a token for multiple requests and avoiding unnecessary creation of a new token)
        catches and handles token expiration: in case of 'request timeout' the  token will be renewed and the request will be resent once more.

        '''

        global TOKEN

        # add token to headers
        headers['NetWitness-Token'] = TOKEN

        request_kwargs = {
            'headers': headers,
            'verify': USE_SSL,
            'proxies': PROXIES
        }

        #add optional arguments if specified
        if body is not None:
            request_kwargs['data'] = body
        if url_params is not None:
            request_kwargs['params'] = url_params

        LOG('Attempting {} request to {}\nWith params:{}\nWith body:\n{}'.format(method, url,json.dumps(url_params, indent=4), json.dumps(body, indent=4)))
        response = requests.request(
            method,
            url,
            **request_kwargs
        )
        # handle timeout (token expired): renew token and try again
        if response.status_code == 408:
            LOG('Timeout detected -  renwing token')
            TOKEN = get_token()
            headers['NetWitness-Token'] = TOKEN
            response = requests.request(
                method,
                url,
                **request_kwargs
            )
        #successful request
        if response.status_code == 200:
            try:
                return response.json()
            except Exception as e:
                LOG(e.message)
                return None
        #bad request - NetWitness returns a common json structure for errors; a list of error objects
        error_lst = response.json().get('errors')
        raise ValueError('Request failed with status: {}\n{}'.format(response.status_code, dict_list_to_str(error_lst)))

    def get_incident_request(incident_id):
        """

        returns the response body

        raises an exception on:

            - http request failure
            - response status code different from 200
            - response body does not contain valid json (ValueError)

        """
        url = '{}/incidents/{}'.format(BASE_PATH, incident_id)

        response = http_request(
            'GET',
            url,
            headers = DEFAULT_HEADERS
        )
        return response



    def get_incident():
        """

        return incidents main attributes to the war room

        raises an exception on:
            - missing arguments
        """
        args = demisto.args()
        incident_id = args.get('incidentId')
        LOG('Requesting information on incident ' + incident_id)
        #call get_incident_request(), given user arguments
        #returns the response body on success
        #raises an exception on failed request
        incident = get_incident_request(
            incident_id
        )

        md_content = create_incident_md_table(incident)
        md_title = "## NetWitness Get Incident {}".format(incident_id)

        entry = {
            'Type': entryTypes['note'],
            'Contents': incident,
            'ContentsFormat': formats['json'],
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': '\n'.join([md_title, md_content]),
            'EntryContext': {
                "NetWitness.Incidents(obj.id==val.id)": incident
            }
        }
        demisto.results(entry)

    def get_incidents_request(since=None, until=None, page_number=None, page_size=10):
        """

        returns the response body

        arguments:
            - keywords: url params

        raises an exception on:

            - http request failure
            - response status code diff from 200
            - response body does not contain valid json (ValueError)

        """

        url_params = {
            'since': since,
            'until': until,
            'pageNumber': page_number,
            'pageSize': page_size
        }
        url = '{}/incidents'.format(BASE_PATH)

        response = http_request(
            'GET',
            url,
            headers = DEFAULT_HEADERS,
            url_params = url_params
        )

        return response

    def get_all_incidents(since=None, until=None, limit=None):
        """

        returns all/up to limit incidents in a time window

        """

        # if limit is None, set to infinity
        if not limit:
            limit = float('inf')
        has_next = True
        page_number = 0
        incidents = []
        LOG('Requesting for incidents in timeframe of: {s} - {u}'.format(s = since or 'not specified', u = until or 'not specified'))
        while has_next and limit > len(incidents):
        #call get_incidents_request(), given user arguments
        #returns the response body on success
        #raises an exception on failed request
            LOG('Requesting for page {}'.format(page_number))
            response_body = get_incidents_request(
                since = since,
                until = until,
                page_number = page_number
            )
            incidents.extend(response_body.get('items'))
            has_next = response_body.get('hasNext')
            page_number += 1

        #if incidents list larger then limit - fit to limit
        if len(incidents) > limit:
            incidents[limit-1 : -1] = []

        return incidents

    def get_incidents():
        """

        returns list of incidents in a specific time window to the war room (main attributes only)

        raises an exception on:
            - missing arguments
        """
        args = demisto.args()

        #validate one of the following was passed - until, since
        if not any([args.get('since'), args.get('until'), args.get('lastDays')]):
            raise ValueError("Please provide one or both of the following parameters: since, until. Alternatively, use lastDays")

        num_of_days = args.get('lastDays')
        if num_of_days:
            since = datetime.now() - timedelta(days=int(num_of_days))
            #convert to ISO 8601 format and add Z suffix
            timestamp =  since.isoformat() + 'Z'
            args['since'] = timestamp
            args['until'] = None

        limit = args.get('limit')
        # parse limit argument to int
        if limit:
            limit = int(limit)

        incidents = get_all_incidents(
            since = args.get('since'),
            until = args.get('until'),
            limit = limit
        )

        md_content = create_incidents_list_md_table(incidents)
        md_title = "## NetWitness Get Incidents"

        entry = {
            'Type': entryTypes['note'],
            'Contents': incidents,
            'ContentsFormat': formats['json'],
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': '\n'.join([md_title, md_content]),
            'EntryContext': {
                "NetWitness.Incidents(obj.id==val.id)": incidents
            }
        }
        demisto.results(entry)


    def update_incident_request(incident_id, assignee=None, status=None):

        """
        returns the response body

        arguments:
            - keywords: url params

        raises an exception on:

            - http request failure
            - response status code diff from 200
            - response body does not contain valid json (ValueError)

        """
        LOG('Requestig to update incident ' + incident_id)

        body = {
            'assignee': assignee,
            'status': status
        }
        url = '{}/incidents/{}'.format(BASE_PATH, incident_id)
        response = http_request(
            'PATCH',
            url,
            headers = DEFAULT_HEADERS,
            body = body
        )
        return response

    def update_incident():
        """

        returns the updated incident main attributes

        raises an exception on:
            - missing arguments
        """

        args = demisto.args()

        #validate at least one of the following was passed: status, assignee.
        if not any([args.get('status'), args.get('assignee')]):
            raise ValueError("Please provide one or both of the following parameters: status, assignee.")

        #call update_incident_request(), given user arguments
        #returns the response body on success
        #raises an exception on failed request
        incident = update_incident_request(
            args.get('incidentId'),
            status = args.get('status'),
            assignee = args.get('assignee')
            )

        md_content = create_incident_md_table(incident)

        entry = {
            'Type': entryTypes['note'],
            'Contents': incident,
            'ContentsFormat': formats['json'],
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable':  "## NetWitness Update Incident\n" + md_content,
            'EntryContext': {
                "NetWitness.Incidents(obj.id==val.id)": incident
            }
        }
        demisto.results(entry)

    def delete_incident_request(incident_id):
        """
        returns the response body

        arguments:
            - incident_id: the id of the incident to delete

        raises an exception on:

            - http request failure
            - response status code diff from 204

        """
        LOG('Requesting to delete incident ' + incident_id)
        url = '{}/incidents/{}'.format(BASE_PATH, incident_id)
        response = http_request(
            'DELETE',
            url,
            headers = DEFAULT_HEADERS
        )
        return response

    def delete_incident():
        """

        returns a success message to the war room

        """

        args = demisto.args()
        incident_id = args.get('incidentId')

        #call delete_incident_request() function
        #no return value on successful request
        #raises an exception on failed request
        delete_incident_request(
            incident_id
        )

        entry = {
            'Type': entryTypes['note'],
            'Contents': 'Incident {} deleted successfully'.format(incident_id),
            'ContentsFormat': formats['text']
        }
        demisto.results(entry)

    def get_alerts_request(incident_id, page_number=None, page_size=None):
        """
        returns the response body

        arguments:
            - incident_id: the id of the incident

        raises an exception on:

            - http request failure
            - response status code diff from 204

        """

        url = '{}/incidents/{}/alerts'.format(BASE_PATH, incident_id)
        url_params = {
            'pageNumber' : page_number,
            'pageSize' : page_size
        }

        response = http_request(
            'GET',
            url,
            headers = DEFAULT_HEADERS,
            url_params = url_params
        )
        return response

    def get_all_alerts(incident_id):
        """
        returns the alerts that are associated with an incident

        """
        has_next = True
        page_number = 0
        alerts = []

        LOG('Requesting for data on alerts related to incident ' + incident_id)
        while has_next:
        #call get_alerts_request(), given user arguments
        #returns the response body on success
        #raises an exception on failed request
            LOG('Requesting for page {}'.format(page_number))
            response_body = get_alerts_request(
                incident_id,
                page_number = page_number
            )
            alerts.extend(response_body.get('items'))
            has_next = response_body.get('hasNext')
            page_number += 1

        return alerts

    def get_alerts():
        """
        returns all alerts associated with an incident to the war room

        """
        args = demisto.args()
        incident_id = args.get('incidentId')
        alerts = get_all_alerts(
            incident_id
        )

        alerts_parsed = []
        for alert in alerts:
            #add incident id for each alert
            alert['incidentId'] = incident_id

            #parse each alert to markdown representation, to display in the war room
            parsed_alert = parse_alert_to_md_representation(alert)
            alerts_parsed.append(parsed_alert)

        md_content = '\n'.join(alerts_parsed)
        title = '## Incident {} Alerts'.format(incident_id)

        entry = {
            'Type': entryTypes['note'],
            'Contents': alerts,
            'ContentsFormat': formats['json'],
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': '\n'.join([title, md_content]),
            'EntryContext': {
                "NetWitness.Alerts(obj.id==val.id)": alerts
            }
        }
        demisto.results(entry)

    def fetch_incidents():
        """
        fetch is limited to 100 results
        """
        lastRun = demisto.getLastRun()

        #if last timestamp was recorded- use it, else generate timestamp for one day prior to current date
        if lastRun and lastRun.get('timestamp'):
            timestamp = lastRun.get('timestamp')
        else:
            day_ago = datetime.now() - timedelta(days=1)
            #convert to ISO 8601 format and add Z suffix
            timestamp = day_ago.isoformat() + 'Z'

        LOG('Fetching incidents since ' + timestamp)
        netwitness_incidents = get_all_incidents(
            since = timestamp,
            limit = 100
        )

        demisto_incidents =[]
        iso_format = "%Y-%m-%dT%H:%M:%S.%fZ"

        last_incident_datetime = datetime.strptime(timestamp, iso_format)
        last_incident_timestamp = timestamp

        # set boolean flag for fetching alerts per incident
        import_alerts = demisto.params().get('importAlerts')

        for incident in netwitness_incidents:

            incident_timestamp = incident.get('created')
            if incident_timestamp == timestamp:
                continue

            #parse timestamp to datetime format to be able to compare with last_incident_datetime
            incident_datetime = datetime.strptime(incident_timestamp, iso_format)
            if incident_datetime > last_incident_datetime:
                #update last_incident_datetime
                last_incident_datetime = incident_datetime
                last_incident_timestamp = incident_timestamp

            # add to incident object an array of all related alerts
            if import_alerts:
                try:
                    incident['alerts'] = get_all_alerts(incident.get('id'))
                except ValueError as e:
                    LOG('Failed to fetch alerts related to incident ' + incident.get('id'))
            demisto_incidents.append(parse_incident(incident))

        demisto.incidents(demisto_incidents)
        demisto.setLastRun({'timestamp': last_incident_timestamp})


    def parse_incident(netwitness_incident):
        incident_fields = [
            'id',
            'title',
            'summary',
            'riskScore',
            'status',
            'alertCount',
            'created',
            'lastUpdated',
            'assignee',
            'sources',
            'categories'
        ]
        incident_labels = [{'type': field, 'value': json.dumps(netwitness_incident.get(field))} for field in incident_fields ]
        alerts = netwitness_incident.get('alerts')
        if alerts:
            alerts_ids = [alert.get('id') for alert in alerts]
            incident_labels.append({ 'type': 'alerts ids', 'value': ', '.join(alerts_ids)})
        incident = {
            'name': netwitness_incident.get('title'),
            'occurred': netwitness_incident.get('created'),
            'severity': priority_to_severity( netwitness_incident.get('priority') ),
            'labels': incident_labels,
            'rawJSON': json.dumps(netwitness_incident)
        }
        return incident


    """

    ADDITIONAL FUNCTIONS

    """


    def create_incident_md_table(incident):

        #list of fields to be presented in 'incident details' md table, by order of appearance
        incident_entry_fields = [
            'id',
            'title',
            'summary',
            'riskScore',
            'status',
            'alertCount',
            'created',
            'lastUpdated',
            'assignee',
            'sources',
            'categories'
        ]

        #list of fields to be presented in 'journal' md table, by order of appearance
        journal_entry_fields = [
            'created',
            'author',
            'notes',
            'milestone'
        ]

        #create incident entry
        incident_entry = { k:v for k,v in incident.items() if k in incident_entry_fields }

        #if category field exists and not empty - update incident entry 'category' field with a short string representation of the categories-list as value
        categories = incident.get('categories')
        if categories:
            incident_entry['categories'] = ', '.join(["{}:{}".format(category['parent'],category['name']) for category in categories])
        else:
            incident_entry['categories'] = ''

        #if source fields exists and not empty - update incident entry 'source' field with a short string representation of the source-list as value
        source_list = incident.get('sources')
        if source_list:
            incident_entry['sources'] = ', '.join(source_list)
        else:
            incident_entry['sources'] = ''

        incident_table = tableToMarkdown(
            'Incident Details',
            incident_entry,
            headers = incident_entry_fields,
            headerTransform = header_transformer
        )

        #if journalEntries field exists and not empty - create journal entry
        journal = incident.get('journalEntries');
        journal_table = ''
        if journal:
            journal_entry = [ { k:v for k,v in enrty.items() if k in journal_entry_fields } for enrty in journal]
            journal_table = tableToMarkdown(
                'Incident Journal',
                journal_entry,
                headers = journal_entry_fields,
                headerTransform = header_transformer
            )

        md_content = '\n'.join([incident_table, journal_table]);
        return md_content

    def create_incidents_list_md_table(incidents):

        #list of fields to be presented in 'incident details' md table, by order of appearance
        incident_entry_fields = [
            'id',
            'title',
            'summary',
            'riskScore',
            'status',
            'alertCount',
            'created',
            'lastUpdated',
            'assignee',
            'sources',
            'categories'
        ]

        incidents_list = []
        for incident in incidents:
            #create incident entry to hold the fields to be presented in the md table
            incident_entry = { k:v for k,v in incident.items() if k in incident_entry_fields }
            #if category field exists and not empty - update incident entry 'category' field with a short string representation of the categories-list as value
            categories = incident.get('categories')
            if categories:
                incident_entry['categories'] = ', '.join(["{}:{}".format(category['parent'],category['name']) for category in categories])
            else:
                incident_entry['categories'] = ''

             #if source fields exists and not empty - update incident entry 'source' field with a short string representation of the source-list as value
            source_list = incident.get('sources')
            if source_list:
                incident_entry['sources'] = ', '.join(source_list)
            else:
                incident_entry['sources'] = ''

            incidents_list.append(incident_entry)

        incident_table = tableToMarkdown(
            'Incident Details',
            incidents_list,
            headers = incident_entry_fields,
            headerTransform = header_transformer
        )

        return incident_table

    def parse_alert_to_md_representation(alert):

        #list of fields to be presented in 'alert details' md table, by order of appearance
        alert_entry_fields = [
            'id',
            'title',
            'detail',
            'created',
            'source',
            'riskScore',
            'type'
        ]

        alert_entry = { k:v for k,v in alert.items() if k in alert_entry_fields }
        alert_events = alert.get('events', [])

        #add 'total events' to alert entry
        alert_entry['totalEvents'] = len(alert_events)
        alert_entry_fields.append('totalEvents')

        alert_md_table = tableToMarkdown(
            'Alert Details',
            alert_entry,
            headers = alert_entry_fields,
            headerTransform = header_transformer
        )

        events = []
        for event in alert_events:
            events.append(parse_event_to_md_representation(event))

        events_md = '\n'.join(events)
        md_content = '\n'.join([alert_md_table, events_md])
        return md_content

    def parse_event_to_md_representation(event):

        event_details = "### Event Details \
        \n*Domain:* {domain} \
        \n*Source:* {source} \
        \n*ID:* {id} \
        ".format(
        domain = event.get('domain', ''),
        source = event.get('eventSource', ''),
        id = event.get('eventSourceId', '')
        )

        event_source = event.get('source')
        event_destination = event.get('destination')

        def parse_device(device):
            device_entry = {
                'Device IP' : device.get('ipAddress'),
                'Device Port' : device.get('port'),
                'Device MAC' : device.get('macAddress'),
                'DNS Hostname' : device.get('dnsHostname'),
                'DNS Domain' : device.get('dnsDomain')
            }
            return device_entry

        def parse_user(user):
            user_entry = {
                'User UserName': user.get('username'),
                'User Email' : user.get('emailAddress'),
                'Active Directory UserName' : user.get('adUsername'),
                'Active Directory Domain' : user.get('adDomain')
            }
            return user_entry

        # resource table headers in order of appearance
        all_headers = [
            'Device IP',
            'Device Port',
            'Device MAC',
            'DNS Hostname',
            'DNS Domain',
            'User UserName',
            'User Email',
            'Active Directory UserName',
            'Active Directory Domain'
        ]

        def resource_md(resource, resource_type):
            resource_entry = {}
            device = resource.get('device')
            user = resource.get('user')
            resource_entry.update(parse_device(device))
            resource_entry.update(parse_user(user))
            #reduce headers to fields that hold actual value in resource_entry
            headers = [ field for field in all_headers if resource_entry.get(field) ]
            resource_md = tableToMarkdown(
                resource_type,
                resource_entry,
                headers = headers)
            return resource_md

        source_md = resource_md(event_source, 'Source')
        destination_md = resource_md(event_destination, 'Destination')

        md_content = '\n'.join([event_details, source_md, destination_md])
        return md_content

    def return_error_entry(message):
        error_entry = {
            'Type': entryTypes['error'],
            'Contents': message,
            'ContentsFormat': formats['text']
        }
        demisto.results(error_entry)

    def header_transformer(header):
        """
        e.g. input: 'someHeader' output: 'Some Header '

        """

        return re.sub("([a-z])([A-Z])","\g<1> \g<2>", header).capitalize()


    def priority_to_severity(priority):
        """
        coverts NetWitness priority to Demisto severity grade

        input:
            - 'Low'
            - 'Medium'
            - 'High'
            - 'Critical'
        output:
            - 0 Unknown
            - 1 Low
            - 2 Medium
            - 3 High
            - 4 Critical
        """

        priority_grade_map = {
            'Low' : 1,
            'Medium' : 2,
            'High' : 3,
            'Critical': 4
        }

        grade = priority_grade_map.get(priority, 0)
        return grade


    """

    EXECUTION

    """
    command = demisto.command()
    try:
        if command == 'test-module':
            # global variable TOKEN initialization tests user credentials (will raise ValueError exception when unsuccessful).
            demisto.results('ok')
        elif command == 'fetch-incidents':
            fetch_incidents()
        elif command == 'netwitness-get-incident':
            get_incident()
            get_alerts()
        elif command == 'netwitness-get-incidents':
            get_incidents()
        elif command == 'netwitness-update-incident':
            update_incident()
        elif command == 'netwitness-delete-incident':
            delete_incident()
        elif command == 'netwitness-get-alerts':
            get_alerts()
        sys.exit(0)
    except ValueError as e:
        LOG(e.message)
        LOG.print_log()
        return_error_entry(e.message)
        sys.exit(1)

  type: python
  commands:
  - name: netwitness-get-incident
    arguments:
    - name: incidentId
      required: true
      description: The incident id
    outputs:
    - contextPath: NetWitness.Incidents.id
      description: The unique identifier of the incident.
    - contextPath: NetWitness.Incidents.title
      description: Title of the incident.
    - contextPath: NetWitness.Incidents.summary
      description: Summary of the incident.
    - contextPath: NetWitness.Incidents.priority
      description: The incident priority.
    - contextPath: NetWitness.Incidents.riskScore
      description: Incident risk score calculated based on associated alert’s risk
        score. Risk score ranges from 0 (no risk) to 100 (highest risk).
    - contextPath: NetWitness.Incidents.status
      description: The current status.
    - contextPath: NetWitness.Incidents.alertCount
      description: Number of alerts associated with the Incident.
    - contextPath: NetWitness.Incidents.averageAlertRiskScore
      description: Average risk score of the alerts associated with the incident.
    - contextPath: NetWitness.Incidents.sealed
      description: Indicates if additional alerts can be associated with an incident.
    - contextPath: NetWitness.Incidents.totalRemediationTaskCount
      description: The number of total remediation tasks for the incident.
    - contextPath: NetWitness.Incidents.openRemediationTaskCount
      description: The number of open remediation tasks for the incident.
    - contextPath: NetWitness.Incidents.created
      description: The timestamp of when the incident is created.
    - contextPath: NetWitness.Incidents.lastUpdated
      description: The timestamp of when the incident was last updated.
    - contextPath: NetWitness.Incidents.lastUpdatedBy
      description: The NetWitness user identifier of the user who last updated the
        incident.
    - contextPath: NetWitness.Incidents.assignee
      description: The NetWitness user identifier of the user currently working on
        the incident.
    - contextPath: NetWitness.Incidents.sources
      description: Unique set of sources for all of the Alerts in the incident.
    - contextPath: NetWitness.Incidents.ruleId
      description: The unique identifier of the rule that created the incident.
    - contextPath: NetWitness.Incidents.firstAlertTime
      description: The timestamp of the earliest occurring Alert in this incident.
    - contextPath: NetWitness.Incidents.categories.id
      description: The unique category identifier.
    - contextPath: NetWitness.Incidents.categories.parent
      description: Parent name of the category.
    - contextPath: NetWitness.Incidents.categories.name
      description: Friendly name of the category.
    - contextPath: NetWitness.Incidents.journalEntries.id
      description: The unique journal entry identifier.
    - contextPath: NetWitness.Incidents.journalEntries.author
      description: The author of this entry.
    - contextPath: NetWitness.Incidents.journalEntries.notes
      description: Notes and observations about the incident.
    - contextPath: NetWitness.Incidents.journalEntries.created
      description: The timestamp of the journal entry created date.
    - contextPath: NetWitness.Incidents.journalEntries.lastUpdated
      description: The timestamp of the journal entry last updated date.
    - contextPath: NetWitness.Incidents.journalEntries.milestone
      description: Incident milestone classifier.
    - contextPath: NetWitness.Incidents.createdBy
      description: The NetWitness user id or name of the rule that created the incident.
    - contextPath: NetWitness.Incidents.deletedAlertCount
      description: The number of alerts that are deleted from theincident.
    - contextPath: NetWitness.Incidents.eventCount
      description: Number of events associated with incident.
    - contextPath: NetWitness.Incidents.alertMeta.SourceIp
      description: Unique source IP addresses.
    - contextPath: NetWitness.Incidents.alertMeta.DestinationIp
      description: Unique destination IP addresses.
    - contextPath: NetWitness.Alerts.id
      description: The unique alert identifier.
    - contextPath: NetWitness.Alerts.incidentId
      description: The incident id associated with the alert.
    - contextPath: NetWitness.Alerts.title
      description: The title or name of the rule that created the alert.
    - contextPath: NetWitness.Alerts.detail
      description: The details of the alert. This can be the module name or meta that
        the module included.
    - contextPath: NetWitness.Alerts.created
      description: The timestamp of the alert created date.
    - contextPath: NetWitness.Alerts.source
      description: The source of this alert. For example, "Event Stream Analysis",
        "Malware Analysis", etc.
    - contextPath: NetWitness.Alerts.riskScore
      description: The risk score of this alert, usually in the range 0 - 100.
    - contextPath: NetWitness.Alerts.type
      description: Type of alert, "Network", "Log", etc.
    - contextPath: NetWitness.Alerts.events.source.device.ipAddress
      description: The IP address.
    - contextPath: NetWitness.Alerts.events.source.device.port
      description: The port.
    - contextPath: NetWitness.Alerts.events.source.device.macAddress
      description: The ethernet MAC address.
    - contextPath: NetWitness.Alerts.events.source.device.dnsHostname
      description: The DNS resolved hostname.
    - contextPath: NetWitness.Alerts.events.source.device.dnsDomain
      description: The top-level domain from the DNS resolved hostname
    - contextPath: NetWitness.Alerts.events.source.user.username
      description: The unique username.
    - contextPath: NetWitness.Alerts.events.source.user.emailAddress
      description: An email address.
    - contextPath: NetWitness.Alerts.events.source.user.adUsername
      description: An Active Directory (AD) username.
    - contextPath: NetWitness.Alerts.events.source.user.adDomain
      description: An Active Directory (AD) domain
    - contextPath: NetWitness.Alerts.events.destination.device.ipAddress
      description: The IP address.
    - contextPath: NetWitness.Alerts.events.destination.device.port
      description: The port.
    - contextPath: NetWitness.Alerts.events.destination.device.macAddress
      description: The ethernet MAC address.
    - contextPath: NetWitness.Alerts.events.destination.device.dnsHostname
      description: The DNS resolved hostname.
    - contextPath: NetWitness.Alerts.events.destination.device.dnsDomain
      description: The top-level domain from the DNS resolved hostname
    - contextPath: NetWitness.Alerts.events.destination.user.username
      description: The unique username.
    - contextPath: NetWitness.Alerts.events.destination.user.emailAddress
      description: An email address.
    - contextPath: NetWitness.Alerts.events.destination.user.adUsername
      description: An Active Directory (AD) username.
    - contextPath: NetWitness.Alerts.events.destination.user.adDomain
      description: An Active Directory (AD) domain
    description: Get details of a specific incident, including all alerts related
      with the incident.
  - name: netwitness-get-incidents
    arguments:
    - name: since
      description: A timestamp in ISO 8601 format (e.g. 2018-01-01T14:00:00.000Z).
        Use to retrieve incidents created on and after this timestamp.
    - name: until
      description: A timestamp in ISO 8601 format (e.g. 2018-01-01T14:00:00.000Z).
        Use to retrieve incidents created on and before this timestamp.
    - name: limit
      description: The maximum number of incidents to retrieve. default  is 200.
      defaultValue: "200"
    - name: lastDays
      description: Use this to retrieve incidents from the last number of days specified.
    outputs:
    - contextPath: NetWitness.Incidents.id
      description: The unique identifier of the incident.
    - contextPath: NetWitness.Incidents.title
      description: Title of the incident.
    - contextPath: NetWitness.Incidents.summary
      description: Summary of the incident.
    - contextPath: NetWitness.Incidents.priority
      description: The incident priority.
    - contextPath: NetWitness.Incidents.riskScore
      description: Incident risk score calculated based on associated alert’s risk
        score. Risk score ranges from 0 (no risk) to 100 (highest risk).
    - contextPath: NetWitness.Incidents.status
      description: The current status.
    - contextPath: NetWitness.Incidents.alertCount
      description: Number of alerts associated with the Incident.
    - contextPath: NetWitness.Incidents.averageAlertRiskScore
      description: Average risk score of the alerts associated with the incident.
    - contextPath: NetWitness.Incidents.sealed
      description: Indicates if additional alerts can be associated with an incident.
    - contextPath: NetWitness.Incidents.totalRemediationTaskCount
      description: The number of total remediation tasks for the incident.
    - contextPath: NetWitness.Incidents.openRemediationTaskCount
      description: The number of open remediation tasks for the incident.
    - contextPath: NetWitness.Incidents.created
      description: The timestamp of when the incident is created.
    - contextPath: NetWitness.Incidents.lastUpdated
      description: The timestamp of when the incident was last updated.
    - contextPath: NetWitness.Incidents.lastUpdatedBy
      description: The NetWitness user identifier of the user who last updated the
        incident.
    - contextPath: NetWitness.Incidents.assignee
      description: The NetWitness user identifier of the user currently working on
        the incident.
    - contextPath: NetWitness.Incidents.sources
      description: Unique set of sources for all of the Alerts in the incident.
    - contextPath: NetWitness.Incidents.ruleId
      description: The unique identifier of the rule that created the incident.
    - contextPath: NetWitness.Incidents.firstAlertTime
      description: The timestamp of the earliest occurring Alert in this incident.
    - contextPath: NetWitness.Incidents.categories.id
      description: The unique category identifier.
    - contextPath: NetWitness.Incidents.categories.parent
      description: Parent name of the category.
    - contextPath: NetWitness.Incidents.categories.name
      description: Friendly name of the category.
    - contextPath: NetWitness.Incidents.journalEntries.id
      description: The unique journal entry identifier.
    - contextPath: NetWitness.Incidents.journalEntries.author
      description: The author of this entry.
    - contextPath: NetWitness.Incidents.journalEntries.notes
      description: Notes and observations about the incident.
    - contextPath: NetWitness.Incidents.journalEntries.created
      description: The timestamp of the journal entry created date.
    - contextPath: NetWitness.Incidents.journalEntries.lastUpdated
      description: The timestamp of the journal entry last updated date.
    - contextPath: NetWitness.Incidents.journalEntries.milestone
      description: Incident milestone classifier.
    - contextPath: NetWitness.Incidents.createdBy
      description: The NetWitness user id or name of the rule that created the incident.
    - contextPath: NetWitness.Incidents.deletedAlertCount
      description: The number of alerts that are deleted from theincident.
    - contextPath: NetWitness.Incidents.eventCount
      description: Number of events associated with incident.
    - contextPath: NetWitness.Incidents.alertMeta.SourceIp
      description: Unique source IP addresses.
    - contextPath: NetWitness.Incidents.alertMeta.DestinationIp
      description: Unique destination IP addresses.
    description: 'Get a list of incidents in a specific time frame. One of the followings
      must be specified:  since, until, lastDays'
  - name: netwitness-update-incident
    arguments:
    - name: incidentId
      required: true
      description: The incident's id
    - name: status
      auto: PREDEFINED
      predefined:
      - New
      - Assigned
      - InProgress
      - RemediationRequested
      - RemediationComplete
      - Closed
      - ClosedFalsePositive
      description: The current status
    - name: assignee
      description: The NetWitness user identifier of the user currently working on
        the incident.
    outputs:
    - contextPath: NetWitness.Incidents.id
      description: The unique identifier of the incident.
    - contextPath: NetWitness.Incidents.title
      description: Title of the incident.
    - contextPath: NetWitness.Incidents.summary
      description: Summary of the incident.
    - contextPath: NetWitness.Incidents.priority
      description: The incident priority.
    - contextPath: NetWitness.Incidents.riskScore
      description: Incident risk score calculated based on associated alert’s risk
        score. Risk score ranges from 0 (no risk) to 100 (highest risk).
    - contextPath: NetWitness.Incidents.status
      description: The current status.
    - contextPath: NetWitness.Incidents.alertCount
      description: Number of alerts associated with the Incident.
    - contextPath: NetWitness.Incidents.averageAlertRiskScore
      description: Average risk score of the alerts associated with the incident.
    - contextPath: NetWitness.Incidents.sealed
      description: Indicates if additional alerts can be associated with an incident.
    - contextPath: NetWitness.Incidents.totalRemediationTaskCount
      description: The number of total remediation tasks for the incident.
    - contextPath: NetWitness.Incidents.openRemediationTaskCount
      description: The number of open remediation tasks for the incident.
    - contextPath: NetWitness.Incidents.created
      description: The timestamp of when the incident is created.
    - contextPath: NetWitness.Incidents.lastUpdated
      description: The timestamp of when the incident was last updated.
    - contextPath: NetWitness.Incidents.lastUpdatedBy
      description: The NetWitness user identifier of the user who last updated the
        incident.
    - contextPath: NetWitness.Incidents.assignee
      description: The NetWitness user identifier of the user currently working on
        the incident.
    - contextPath: NetWitness.Incidents.sources
      description: Unique set of sources for all of the Alerts in the incident.
    - contextPath: NetWitness.Incidents.ruleId
      description: The unique identifier of the rule that created the incident.
    - contextPath: NetWitness.Incidents.firstAlertTime
      description: The timestamp of the earliest occurring Alert in this incident.
    - contextPath: NetWitness.Incidents.categories.id
      description: The unique category identifier.
    - contextPath: NetWitness.Incidents.categories.parent
      description: Parent name of the category.
    - contextPath: NetWitness.Incidents.categories.name
      description: Friendly name of the category.
    - contextPath: NetWitness.Incidents.journalEntries.id
      description: The unique journal entry identifier.
    - contextPath: NetWitness.Incidents.journalEntries.author
      description: The author of this entry.
    - contextPath: NetWitness.Incidents.journalEntries.notes
      description: Notes and observations about the incident.
    - contextPath: NetWitness.Incidents.journalEntries.created
      description: The timestamp of the journal entry created date.
    - contextPath: NetWitness.Incidents.journalEntries.lastUpdated
      description: The timestamp of the journal entry last updated date.
    - contextPath: NetWitness.Incidents.journalEntries.milestone
      description: Incident milestone classifier.
    - contextPath: NetWitness.Incidents.createdBy
      description: The NetWitness user id or name of the rule that created the incident.
    - contextPath: NetWitness.Incidents.deletedAlertCount
      description: The number of alerts that are deleted from theincident.
    - contextPath: NetWitness.Incidents.eventCount
      description: Number of events associated with incident.
    - contextPath: NetWitness.Incidents.alertMeta.SourceIp
      description: Unique source IP addresses.
    - contextPath: NetWitness.Incidents.alertMeta.DestinationIp
      description: Unique destination IP addresses.
    description: Update a specific incident.  Currently, an incident’s status and
      assignee may be modified
  - name: netwitness-delete-incident
    arguments:
    - name: incidentId
      required: true
      description: The incident id
    description: Delete a specific incident, by its id.
  - name: netwitness-get-alerts
    arguments:
    - name: incidentId
      required: true
      description: The incident id
    outputs:
    - contextPath: NetWitness.Alerts.id
      description: The unique alert identifier.
    - contextPath: NetWitness.Alerts.incidentId
      description: The incident id associated with the alert.
    - contextPath: NetWitness.Alerts.title
      description: The title or name of the rule that created the alert.
    - contextPath: NetWitness.Alerts.detail
      description: The details of the alert. This can be the module name or meta that
        the module included.
    - contextPath: NetWitness.Alerts.created
      description: The timestamp of the alert created date.
    - contextPath: NetWitness.Alerts.source
      description: The source of this alert. For example, "Event Stream Analysis",
        "Malware Analysis", etc.
    - contextPath: NetWitness.Alerts.riskScore
      description: The risk score of this alert, usually in the range 0 - 100.
    - contextPath: NetWitness.Alerts.type
      description: Type of alert, "Network", "Log", etc.
    - contextPath: NetWitness.Alerts.events.source.device.ipAddress
      description: The IP address.
    - contextPath: NetWitness.Alerts.events.source.device.port
      description: The port.
    - contextPath: NetWitness.Alerts.events.source.device.macAddress
      description: The ethernet MAC address.
    - contextPath: NetWitness.Alerts.events.source.device.dnsHostname
      description: The DNS resolved hostname.
    - contextPath: NetWitness.Alerts.events.source.device.dnsDomain
      description: The top-level domain from the DNS resolved hostname
    - contextPath: NetWitness.Alerts.events.source.user.username
      description: The unique username.
    - contextPath: NetWitness.Alerts.events.source.user.emailAddress
      description: An email address.
    - contextPath: NetWitness.Alerts.events.source.user.adUsername
      description: An Active Directory (AD) username.
    - contextPath: NetWitness.Alerts.events.source.user.adDomain
      description: An Active Directory (AD) domain
    - contextPath: NetWitness.Alerts.events.destination.device.ipAddress
      description: The IP address.
    - contextPath: NetWitness.Alerts.events.destination.device.port
      description: The port.
    - contextPath: NetWitness.Alerts.events.destination.device.macAddress
      description: The ethernet MAC address.
    - contextPath: NetWitness.Alerts.events.destination.device.dnsHostname
      description: The DNS resolved hostname.
    - contextPath: NetWitness.Alerts.events.destination.device.dnsDomain
      description: The top-level domain from the DNS resolved hostname
    - contextPath: NetWitness.Alerts.events.destination.user.username
      description: The unique username.
    - contextPath: NetWitness.Alerts.events.destination.user.emailAddress
      description: An email address.
    - contextPath: NetWitness.Alerts.events.destination.user.adUsername
      description: An Active Directory (AD) username.
    - contextPath: NetWitness.Alerts.events.destination.user.adDomain
      description: An Active Directory (AD) domain
    description: Get all the alerts related to a specific incident.
  isfetch: true
releaseNotes: "fix error parsing when encountering a bad response when trying to get token"
tests:
  - RSA NetWitness Test