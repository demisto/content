commonfields:
  id: RSA NetWitness v11.1
  version: -1
name: RSA NetWitness v11.1
display: RSA NetWitness v11.1
category: Analytics & SIEM
image: data:image/png;base64,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
description: RSA NetWitness Platform provides systems Logs, Network, and endpoint
  visibility for real-time collection, detection, and automated response with the
  Demisto Enterprise platform. Providing full session analysis, customers can extract
  critical data and effectively operate security operations automated playbook.
configuration:
- display: Server URL (e.g. https://192.168.0.1:30022)
  name: server
  defaultvalue: ""
  type: 0
  required: true
- display: ""
  name: credentials
  defaultvalue: ""
  type: 9
  required: true
- display: ""
  name: version
  defaultvalue: "1.0"
  type: 0
  required: false
- display: Trust any certificate (unsecure)
  name: insecure
  defaultvalue: "false"
  type: 8
  required: false
- display: Use system proxy settings
  name: proxy
  defaultvalue: "false"
  type: 8
  required: false
- display: Fetch incidents
  name: isFetch
  defaultvalue: ""
  type: 8
  required: false
- display: Incident type
  name: incidentType
  defaultvalue: ""
  type: 13
  required: false
script:
  script: |2+

    """

    IMPORTS

    """
    from datetime import datetime, timedelta
    import requests
    import urllib
    import json
    import os
    import re
    # disable insecure warnings
    requests.packages.urllib3.disable_warnings()

    """

    HANDLE PROXY

    """

    def set_proxies():

        if demisto.params()['proxy']:
            http = os.environ['http_proxy'] or os.environ['HTTP_PROXY']
            https = os.environ['https_proxy'] or os.environ['HTTPS_PROXY']
            proxies = {
                'http': http,
                'https': https
            }
            return proxies
        return None


    """

    GLOBAL VARS

    """
    SERVER_URL = demisto.params()['server']
    BASE_PATH = '{}/rest/api'.format(SERVER_URL)
    USERNAME = demisto.params()['credentials']['identifier']
    PASSWORD = demisto.params()['credentials']['password']
    USE_SSL = not demisto.params()['insecure']
    VERSION = demisto.params()['version']
    PROXIES = set_proxies()
    DEFAULT_HEADERS = {
        'Content-Type' : 'application/json;charset=UTF-8',
        'Accept': 'application/json; charset=UTF-8',
        'NetWitness-Version': VERSION
    }

    """

    COMMAND HANDLERS

    """

    def get_token_request(username, password):
        """

        returns a token on successful get_token request

        raises an exception on:

            - http request failure
            - response status code different from 200
            - response body does not contain valid json (ValueError)

        """
        username_password = "username={}&password={}".format(username, password)
        url = '{}/auth/userpass'.format(BASE_PATH)
        get_token_headers = {
            'Content-Type' : 'application/x-www-form-urlencoded;charset=ISO-8859-1',
            'Accept': 'application/json; charset=UTF-8',
            'NetWitness-Version': VERSION
        }

        response = requests.post(url,
            headers = get_token_headers,
            data = username_password,
            verify = USE_SSL,
            proxies = PROXIES
        )

        #successful get_token
        if response.status_code == 200:
            return response.json()
        #bad request - NetWitness returns a common json structure for errors
        error_lst = response.json().get('errors')
        raise ValueError('get_token failed with status: {}\n{}'.format(response.status_code, dict_list_to_str(error_lst)))

    def get_token():
        """

        returns a token to be used in future requests to NetWitness server

        raises an exception on:

            - unexpected response from the server

        """
        response_body = get_token_request(
            USERNAME,
            PASSWORD
        )
        token = response_body.get('accessToken')
        if not token:
            raise ValueError('Failed to access get_token token (Unexpected response)')
        return token


    def get_incident_request(token, incident_id):
        """

        returns the response body

        raises an exception on:

            - http request failure
            - response status code different from 200
            - response body does not contain valid json (ValueError)

        """
        url = '{}/incidents/{}'.format(BASE_PATH, incident_id)
        headers = add_token_header(DEFAULT_HEADERS, token)

        response = requests.get(url,
            headers = headers,
            verify = USE_SSL,
            proxies = PROXIES
        )

        #successful request
        if response.status_code == 200:
            return response.json()
        #bad request - NetWitness returns a common json structure for errors; a list of error objects
        error_lst = response.json().get('errors')
        raise ValueError('Request failed with status: {}\n{}'.format(response.status_code, dict_list_to_str(error_lst)))

    def get_incident():
        """

        return incidents main attributes to the war room

        raises an exception on:
            - missing arguments
        """
        args = demisto.args()
        incident_id = args.get('incidentId')

        #call get_incident_request(), given user arguments
        #returns the response body on success
        #raises an exception on failed request
        incident = get_incident_request(
            get_token(),
            incident_id
        )

        md_content = create_incident_md_table(incident)
        md_title = "## NetWitness Get Incident {}".format(incident_id)

        entry = {
            'Type': entryTypes['note'],
            'Contents': incident,
            'ContentsFormat': formats['json'],
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': '\n'.join([md_title, md_content]),
            'EntryContext': {
                "NetWitness.Incidents(obj.id==val.id)": incident
            }
        }
        demisto.results(entry)

    def get_incidents_request(token, since=None, until=None, page_number=None, page_size=10):
        """

        returns the response body

        arguments:
            - token for request auth
            - keywords: url params

        raises an exception on:

            - http request failure
            - response status code diff from 200
            - response body does not contain valid json (ValueError)

        """

        url_params = {
            'since': since,
            'until': until,
            'pageNumber': page_number,
            'pageSize': page_size
        }
        url = '{}/incidents'.format(BASE_PATH)
        headers = add_token_header(DEFAULT_HEADERS, token)

        response = requests.get(
            url,
            headers = headers,
            verify = USE_SSL,
            proxies = PROXIES,
            params = url_params
        )

        #successful request
        if response.status_code == 200:
            return response.json()
        #bad request - NetWitness returns a common json structure for errors
        error_lst = response.json().get('errors')
        raise ValueError('Request failed with status: {}\n{}'.format(response.status_code, dict_list_to_str(error_lst)))

    def get_all_incidents(token, since=None, until=None, limit=None):
        """

        returns all/up to limit incidents in a time window

        """

        # if limit is None, set to infinity
        if not limit:
            limit = float('inf')
        has_next = True
        page_number = 0
        incidents = []
        while has_next and limit > len(incidents):
        #call get_incidents_request(), given user arguments
        #returns the response body on success
        #raises an exception on failed request
            response_body = get_incidents_request(
                token,
                since = since,
                until = until,
                page_number = page_number
            )
            incidents.extend(response_body.get('items'))
            has_next = response_body.get('hasNext')
            page_number += 1

        #if incidents list larger then limit - fit to limit
        if len(incidents) > limit:
            incidents[limit-1 : -1] = []

        return incidents

    def get_incidents():
        """

        returns list of incidents in a specific time window to the war room (main attriibutes only)

        raises an exception on:
            - missing arguments
        """
        args = demisto.args()

        #validate one of the following was passed - until, since
        if not any([args.get('since'), args.get('until'), args.get('lastDays')]):
            raise ValueError("Please provide one or both of the following parameters: since, until. Alternatively, use lastDays")

        num_of_days = args.get('lastDays')
        if num_of_days:
            since = datetime.now() - timedelta(days=int(num_of_days))
            #convert to ISO 8601 format and add Z suffix
            timestamp =  since.isoformat() + 'Z'
            args['since'] = timestamp
            args['until'] = None

        limit = args.get('limit')
        # parse limit argument to int
        if limit:
            limit = int(limit)

        incidents = get_all_incidents(
            get_token(),
            since = args.get('since'),
            until = args.get('until'),
            limit = limit
        )

        md_content = create_incidents_list_md_table(incidents)
        md_title = "## NetWitness Get Incidents"

        entry = {
            'Type': entryTypes['note'],
            'Contents': incidents,
            'ContentsFormat': formats['json'],
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': '\n'.join([md_title, md_content]),
            'EntryContext': {
                "NetWitness.Incidents(obj.id==val.id)": incidents
            }
        }
        demisto.results(entry)


    def update_incident_request(token, incident_id, assignee=None, status=None):

        """
        returns the response body

        arguments:
            - token for request auth
            - keywords: url params

        raises an exception on:

            - http request failure
            - response status code diff from 200
            - response body does not contain valid json (ValueError)

        """
        body = {
            'assignee': assignee,
            'status': status
        }
        url = '{}/incidents/{}'.format(BASE_PATH, incident_id)
        headers = add_token_header(DEFAULT_HEADERS, token)
        response = requests.patch(
            url,
            headers = headers,
            verify = USE_SSL,
            proxies = PROXIES,
            json = body
        )
        #successful request
        if response.status_code == 200:
            return response.json()
        #bad request - NetWitness returns a common json structure for errors; a list of error objects
        error_lst = response.json().get('errors')
        raise ValueError('Request failed with status: {}\n{}'.format(response.status_code, dict_list_to_str(error_lst)))

    def update_incident():
        """

        returns the updated incident main attributes

        raises an exception on:
            - missing arguments
        """

        args = demisto.args()

        #validate at least one of the following was passed: status, assignee.
        if not any([args.get('status'), args.get('assignee')]):
            raise ValueError("Please provide one or both of the following parameters: status, assignee.")

        #call update_incident_request(), given user arguments
        #returns the response body on success
        #raises an exception on failed request
        incident = update_incident_request(
            #use get_token to retrieve a token
            get_token(),
            args.get('incidentId'),
            status = args.get('status'),
            assignee = args.get('assignee')
            )

        md_content = create_incident_md_table(incident, "NetWitness Update Incident")

        entry = {
            'Type': entryTypes['note'],
            'Contents': incident,
            'ContentsFormat': formats['json'],
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': md_content,
            'EntryContext': {
                "NetWitness.Incidents(obj.id==val.id)": incident
            }
        }
        demisto.results(entry)

    def delete_incident_request(token, incident_id):
        """
        returns the response body

        arguments:
            - token for request auth
            - incident_id: the id of the incident to delete

        raises an exception on:

            - http request failure
            - response status code diff from 204

        """

        url = '{}/incidents/{}'.format(BASE_PATH, incident_id)
        headers = add_token_header(DEFAULT_HEADERS, token)

        response = requests.delete(
            url,
            headers = headers,
            verify = USE_SSL,
            proxies = PROXIES)
        #successful request, no content is  returned from NetWitness
        if response.status_code == 204:
            return
        #bad request - NetWitness returns a common json structure for errors; a list of error objects
        error_lst = response.json().get('errors')
        raise ValueError('Request failed with status: {}\n{}'.format(response.status_code, dict_list_to_str(error_lst)))

    def delete_incident():
        """

        returns a success message to the war room

        """

        args = demisto.args()
        incident_id = args.get('incidentId')

        #call delete_incident_request() function
        #no return value on successful request
        #raises an exception on failed request
        delete_incident_request(
            get_token(),
            incident_id
        )

        entry = {
            'Type': entryTypes['note'],
            'Contents': 'Incident {} deleted successfully'.format(incident_id),
            'ContentsFormat': formats['text']
        }
        demisto.results(entry)

    def get_alerts_request(token, incident_id, page_number=None, page_size=None):
        """
        returns the response body

        arguments:
            - token for request auth
            - incident_id: the id of the incident

        raises an exception on:

            - http request failure
            - response status code diff from 204

        """

        url = '{}/incidents/{}/alerts'.format(BASE_PATH, incident_id)
        url_params = {
            'pageNumber' : page_number,
            'pageSize' : page_size
        }
        headers = add_token_header(DEFAULT_HEADERS, token)
        response = requests.get(
            url,
            headers = headers,
            verify = USE_SSL,
            proxies = PROXIES,
            params = url_params
        )
        #successful request
        if response.status_code == 200:
            return response.json()
        #bad request - NetWitness returns a common json structure for errors; a list of error objects
        error_lst = response.json().get('errors')
        raise ValueError('Request failed with status: {}\n{}'.format(response.status_code, dict_list_to_str(error_lst)))

    def get_all_alerts(token ,incident_id):
        """
        returns the alerts that are associated with an incident

        """
        has_next = True
        page_number = 0
        alerts = []

        while has_next:
        #call get_alerts_request(), given user arguments
        #returns the response body on success
        #raises an exception on failed request
            response_body = get_alerts_request(
                token,
                incident_id,
                page_number = page_number
            )
            alerts.extend(response_body.get('items'))
            has_next = response_body.get('hasNext')
            page_number += 1

        return alerts

    def get_alerts():
        """
        returns all alerts associated with an incident to the war room

        """
        args = demisto.args()
        incident_id = args.get('incidentId')
        alerts = get_all_alerts(
            get_token(),
            incident_id
        )

        alerts_parsed = []
        for alert in alerts:
            #add incident id for each alert
            alert['incidentId'] = incident_id

            #parse each alert to markdown representation, to display in the war room
            parsed_alert = parse_alert_to_md_representation(alert)
            alerts_parsed.append(parsed_alert)

        md_content = '\n'.join(alerts_parsed)
        title = '## Incident {} Alerts'.format(incident_id)

        entry = {
            'Type': entryTypes['note'],
            'Contents': alerts,
            'ContentsFormat': formats['json'],
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': '\n'.join([title, md_content]),
            'EntryContext': {
                "NetWitness.Alerts(obj.id==val.id)": alerts
            }
        }
        demisto.results(entry)

    def fetch_incidents():
        """
        fetch is limited to 100 results
        """
        lastRun = demisto.getLastRun()

        #if last timestamp was recorded- use it, else generate timestamp for one day prior to current date
        if lastRun and lastRun.get('timestamp'):
            timestamp = lastRun.get('timestamp')
        else:
            day_ago = datetime.now() - timedelta(days=1)
            #convert to ISO 8601 format and add Z suffix
            timestamp = day_ago.isoformat() + 'Z'

        token = get_token()

        netwitness_incidents = get_all_incidents(
            token,
            since = timestamp,
            limit = 100
        )

        demisto_incidents =[]
        iso_format = "%Y-%m-%dT%H:%M:%S.%fZ"

        last_incident_datetime = datetime.strptime(timestamp, iso_format)
        last_incident_timestamp = timestamp

        for incident in netwitness_incidents:

            incident_timestamp = incident.get('created')
            if incident_timestamp == timestamp:
                continue

            #parse timestamp to datetime format to be able to compare with last_incident_datetime
            incident_datetime = datetime.strptime(incident_timestamp, iso_format)
            if incident_datetime > last_incident_datetime:
                #update last_incident_datetime
                last_incident_datetime = incident_datetime
                last_incident_timestamp = incident_timestamp

            # add to incident object an array of all related alerts
            incident['alerts'] = get_all_alerts(token, incident.get('id'))
            demisto_incidents.append(parse_incident(incident))

        demisto.incidents(demisto_incidents)
        demisto.setLastRun({'timestamp': last_incident_timestamp})


    def parse_incident(netwitness_incident):
        incident_fields = [
            'id',
            'title',
            'summary',
            'riskScore',
            'status',
            'alertCount',
            'created',
            'lastUpdated',
            'assignee',
            'sources',
            'categories'
        ]
        incident_labels = [{'type': field, 'value': json.dumps(netwitness_incident.get(field))} for field in incident_fields ]
        alerts = netwitness_incident.get('alerts', [])
        alerts_ids = [alert.get('id') for alert in alerts]
        incident_labels.append({ 'type': 'alerts ids', 'value': ', '.join(alerts_ids)})
        incident = {
            'name': netwitness_incident.get('title'),
            'occurred': netwitness_incident.get('created'),
            'severity': priority_to_severity( netwitness_incident.get('priority') ),
            'labels': incident_labels,
            'rawJSON': json.dumps(netwitness_incident)
        }
        return incident


    """

    ADDITIONAL FUNCTIONS

    """

    def add_token_header(headers, token):
        """

        add the token field to a given headers object

        """
        headers['NetWitness-Token'] = token
        return headers

    def dict_list_to_str(dict_list):
        """

        parses a list of dictionaries into a string representation

        """
        if not dict_list:
            return ''
        string_list = []
        for dict in dict_list:
            key_values = ["{}: {}".format(k,v) for k,v in dict.items()]
            string_list.append(', '.join(string_representation))
        return '\n'.join(string_list)

    def create_incident_md_table(incident):

        #list of fields to be presented in 'incident details' md table, by order of appearance
        incident_entry_fields = [
            'id',
            'title',
            'summary',
            'riskScore',
            'status',
            'alertCount',
            'created',
            'lastUpdated',
            'assignee',
            'sources',
            'categories'
        ]

        #list of fields to be presented in 'journal' md table, by order of appearance
        journal_entry_fields = [
            'created',
            'author',
            'notes',
            'milestone'
        ]

        #create incident entry
        incident_entry = { k:v for k,v in incident.items() if k in incident_entry_fields }

        #if category field exists and not empty - update incident entry 'category' field with a short string representation of the categories-list as value
        categories = incident.get('categories')
        if categories:
            incident_entry['categories'] = ', '.join(["{}:{}".format(category['parent'],category['name']) for category in categories])
        else:
            incident_entry['categories'] = ''

        #if source fields exists and not empty - update incident entry 'source' field with a short string representation of the source-list as value
        source_list = incident.get('sources')
        if source_list:
            incident_entry['sources'] = ', '.join(source_list)
        else:
            incident_entry['sources'] = ''

        incident_table = tableToMarkdown(
            'Incident Details',
            incident_entry,
            headers = incident_entry_fields,
            headerTransform = header_transformer
        )

        #if journalEntries field exists and not empty - create journal entry
        journal = incident.get('journalEntries');
        journal_table = ''
        if journal:
            journal_entry = [ { k:v for k,v in enrty.items() if k in journal_entry_fields } for enrty in journal]
            journal_table = tableToMarkdown(
                'Incident Journal',
                journal_entry,
                headers = journal_entry_fields,
                headerTransform = header_transformer
            )

        md_content = '\n'.join([incident_table, journal_table]);
        return md_content

    def create_incidents_list_md_table(incidents):

        #list of fields to be presented in 'incident details' md table, by order of appearance
        incident_entry_fields = [
            'id',
            'title',
            'summary',
            'riskScore',
            'status',
            'alertCount',
            'created',
            'lastUpdated',
            'assignee',
            'sources',
            'categories'
        ]

        incidents_list = []
        for incident in incidents:
            #create incident entry to hold the fields to be presented in the md table
            incident_entry = { k:v for k,v in incident.items() if k in incident_entry_fields }
            #if category field exists and not empty - update incident entry 'category' field with a short string representation of the categories-list as value
            categories = incident.get('categories')
            if categories:
                incident_entry['categories'] = ', '.join(["{}:{}".format(category['parent'],category['name']) for category in categories])
            else:
                incident_entry['categories'] = ''

             #if source fields exists and not empty - update incident entry 'source' field with a short string representation of the source-list as value
            source_list = incident.get('sources')
            if source_list:
                incident_entry['sources'] = ', '.join(source_list)
            else:
                incident_entry['sources'] = ''

            incidents_list.append(incident_entry)

        incident_table = tableToMarkdown(
            'Incident Details',
            incidents_list,
            headers = incident_entry_fields,
            headerTransform = header_transformer
        )

        return incident_table

    def parse_alert_to_md_representation(alert):

        #list of fields to be presented in 'alert details' md table, by order of appearance
        alert_entry_fields = [
            'id',
            'title',
            'detail',
            'created',
            'source',
            'riskScore',
            'type'
        ]

        alert_entry = { k:v for k,v in alert.items() if k in alert_entry_fields }
        alert_events = alert.get('events', [])

        #add 'total events' to alert entry
        alert_entry['totalEvents'] = len(alert_events)
        alert_entry_fields.append('totalEvents')

        alert_md_table = tableToMarkdown(
            'Alert Details',
            alert_entry,
            headers = alert_entry_fields,
            headerTransform = header_transformer
        )

        events = []
        for event in alert_events:
            events.append(parse_event_to_md_representation(event))

        events_md = '\n'.join(events)
        md_content = '\n'.join([alert_md_table, events_md])
        return md_content

    def parse_event_to_md_representation(event):

        event_details = "### Event Details \
        \n*Domain:* {domain} \
        \n*Source:* {source} \
        \n*ID:* {id} \
        ".format(
        domain = event.get('domain', ''),
        source = event.get('eventSource', ''),
        id = event.get('eventSourceId', '')
        )

        event_source = event.get('source')
        event_destination = event.get('destination')

        def parse_device(device):
            device_entry = {
                'Device IP' : device.get('ipAddress'),
                'Device Port' : device.get('port'),
                'Device MAC' : device.get('macAddress'),
                'DNS Hostname' : device.get('dnsHostname'),
                'DNS Domain' : device.get('dnsDomain')
            }
            return device_entry

        def parse_user(user):
            user_entry = {
                'User UserName': user.get('username'),
                'User Email' : user.get('emailAddress'),
                'Active Directory UserName' : user.get('adUsername'),
                'Active Directory Domain' : user.get('adDomain')
            }
            return user_entry

        # resource table headers in order of appearance
        all_headers = [
            'Device IP',
            'Device Port',
            'Device MAC',
            'DNS Hostname',
            'DNS Domain',
            'User UserName',
            'User Email',
            'Active Directory UserName',
            'Active Directory Domain'
        ]

        def resource_md(resource, resource_type):
            resource_entry = {}
            device = resource.get('device')
            user = resource.get('user')
            resource_entry.update(parse_device(device))
            resource_entry.update(parse_user(user))
            #reduce headers to fields that hold actual value in resource_entry
            headers = [ field for field in all_headers if resource_entry.get(field) ]
            resource_md = tableToMarkdown(
                resource_type,
                resource_entry,
                headers = headers)
            return resource_md

        source_md = resource_md(event_source, 'Source')
        destination_md = resource_md(event_destination, 'Destination')

        md_content = '\n'.join([event_details, source_md, destination_md])
        return md_content

    def return_error_entry(message):
        error_entry = {
            'Type': entryTypes['error'],
            'Contents': message,
            'ContentsFormat': formats['text']
        }
        demisto.results(error_entry)

    def header_transformer(header):
        """
        e.g. input: 'someHeader' output: 'Some Header '

        """

        return re.sub("([a-z])([A-Z])","\g<1> \g<2>", header).capitalize()


    def priority_to_severity(priority):
        """
        coverts NetWitness priority to Demisto severity grade

        input:
            - 'Low'
            - 'Medium'
            - 'High'
            - 'Critical'
        output:
            - 0 Unknown
            - 1 Low
            - 2 Medium
            - 3 High
            - 4 Critical
        """

        priority_grade_map = {
            'Low' : 1,
            'Medium' : 2,
            'High' : 3,
            'Critical': 4
        }

        grade = priority_grade_map.get(priority, 0)
        return grade


    """

    EXECUTION

    """
    command = demisto.command()
    try:
        if command == 'test-module':
            #call get_token() to test user credentials, will raise ValueError exception when unsuccessful
            get_token()
            demisto.results('ok')
        elif command == 'fetch-incidents':
            fetch_incidents()
        elif command == 'netwitness-get-incident':
            get_incident()
            get_alerts()
        elif command == 'netwitness-get-incidents':
            get_incidents()
        elif command == 'netwitness-update-incident':
            update_incident()
        elif command == 'netwitness-delete-incident':
            delete_incident()
        elif command == 'netwitness-get-alerts':
            get_alerts()
        sys.exit(0)
    except ValueError as e:
        return_error_entry(e.message)
        sys.exit(1)

  type: python
  commands:
  - name: netwitness-get-incident
    arguments:
    - name: incidentId
      required: true
      description: The incident id
    outputs:
    - contextPath: NetWitness.Incidents.id
      description: The unique identifier of the incident.
    - contextPath: NetWitness.Incidents.title
      description: Title of the incident.
    - contextPath: NetWitness.Incidents.summary
      description: Summary of the incident.
    - contextPath: NetWitness.Incidents.priority
      description: The incident priority.
    - contextPath: NetWitness.Incidents.riskScore
      description: Incident risk score calculated based on associated alert’s risk
        score. Risk score ranges from 0 (no risk) to 100 (highest risk).
    - contextPath: NetWitness.Incidents.status
      description: The current status.
    - contextPath: NetWitness.Incidents.alertCount
      description: Number of alerts associated with the Incident.
    - contextPath: NetWitness.Incidents.averageAlertRiskScore
      description: Average risk score of the alerts associated with the incident.
    - contextPath: NetWitness.Incidents.sealed
      description: Indicates if additional alerts can be associated with an incident.
    - contextPath: NetWitness.Incidents.totalRemediationTaskCount
      description: The number of total remediation tasks for the incident.
    - contextPath: NetWitness.Incidents.openRemediationTaskCount
      description: The number of open remediation tasks for the incident.
    - contextPath: NetWitness.Incidents.created
      description: The timestamp of when the incident is created.
    - contextPath: NetWitness.Incidents.lastUpdated
      description: The timestamp of when the incident was last updated.
    - contextPath: NetWitness.Incidents.lastUpdatedBy
      description: The NetWitness user identifier of the user who last updated the
        incident.
    - contextPath: NetWitness.Incidents.assignee
      description: The NetWitness user identifier of the user currently working on
        the incident.
    - contextPath: NetWitness.Incidents.sources
      description: Unique set of sources for all of the Alerts in the incident.
    - contextPath: NetWitness.Incidents.ruleId
      description: The unique identifier of the rule that created the incident.
    - contextPath: NetWitness.Incidents.firstAlertTime
      description: The timestamp of the earliest occurring Alert in this incident.
    - contextPath: NetWitness.Incidents.categories.id
      description: The unique category identifier.
    - contextPath: NetWitness.Incidents.categories.parent
      description: Parent name of the category.
    - contextPath: NetWitness.Incidents.categories.name
      description: Friendly name of the category.
    - contextPath: NetWitness.Incidents.journalEntries.id
      description: The unique journal entry identifier.
    - contextPath: NetWitness.Incidents.journalEntries.author
      description: The author of this entry.
    - contextPath: NetWitness.Incidents.journalEntries.notes
      description: Notes and observations about the incident.
    - contextPath: NetWitness.Incidents.journalEntries.created
      description: The timestamp of the journal entry created date.
    - contextPath: NetWitness.Incidents.journalEntries.lastUpdated
      description: The timestamp of the journal entry last updated date.
    - contextPath: NetWitness.Incidents.journalEntries.milestone
      description: Incident milestone classifier.
    - contextPath: NetWitness.Incidents.createdBy
      description: The NetWitness user id or name of the rule that created the incident.
    - contextPath: NetWitness.Incidents.deletedAlertCount
      description: The number of alerts that are deleted from theincident.
    - contextPath: NetWitness.Incidents.eventCount
      description: Number of events associated with incident.
    - contextPath: NetWitness.Incidents.alertMeta.SourceIp
      description: Unique source IP addresses.
    - contextPath: NetWitness.Incidents.alertMeta.DestinationIp
      description: Unique destination IP addresses.
    - contextPath: NetWitness.Alerts.id
      description: The unique alert identifier.
    - contextPath: NetWitness.Alerts.incidentId
      description: The incident id associated with the alert.
    - contextPath: NetWitness.Alerts.title
      description: The title or name of the rule that created the alert.
    - contextPath: NetWitness.Alerts.detail
      description: The details of the alert. This can be the module name or meta that
        the module included.
    - contextPath: NetWitness.Alerts.created
      description: The timestamp of the alert created date.
    - contextPath: NetWitness.Alerts.source
      description: The source of this alert. For example, "Event Stream Analysis",
        "Malware Analysis", etc.
    - contextPath: NetWitness.Alerts.riskScore
      description: The risk score of this alert, usually in the range 0 - 100.
    - contextPath: NetWitness.Alerts.type
      description: Type of alert, "Network", "Log", etc.
    - contextPath: NetWitness.Alerts.events.source.device.ipAddress
      description: The IP address.
    - contextPath: NetWitness.Alerts.events.source.device.port
      description: The port.
    - contextPath: NetWitness.Alerts.events.source.device.macAddress
      description: The ethernet MAC address.
    - contextPath: NetWitness.Alerts.events.source.device.dnsHostname
      description: The DNS resolved hostname.
    - contextPath: NetWitness.Alerts.events.source.device.dnsDomain
      description: The top-level domain from the DNS resolved hostname
    - contextPath: NetWitness.Alerts.events.source.user.username
      description: The unique username.
    - contextPath: NetWitness.Alerts.events.source.user.emailAddress
      description: An email address.
    - contextPath: NetWitness.Alerts.events.source.user.adUsername
      description: An Active Directory (AD) username.
    - contextPath: NetWitness.Alerts.events.source.user.adDomain
      description: An Active Directory (AD) domain
    - contextPath: NetWitness.Alerts.events.destination.device.ipAddress
      description: The IP address.
    - contextPath: NetWitness.Alerts.events.destination.device.port
      description: The port.
    - contextPath: NetWitness.Alerts.events.destination.device.macAddress
      description: The ethernet MAC address.
    - contextPath: NetWitness.Alerts.events.destination.device.dnsHostname
      description: The DNS resolved hostname.
    - contextPath: NetWitness.Alerts.events.destination.device.dnsDomain
      description: The top-level domain from the DNS resolved hostname
    - contextPath: NetWitness.Alerts.events.destination.user.username
      description: The unique username.
    - contextPath: NetWitness.Alerts.events.destination.user.emailAddress
      description: An email address.
    - contextPath: NetWitness.Alerts.events.destination.user.adUsername
      description: An Active Directory (AD) username.
    - contextPath: NetWitness.Alerts.events.destination.user.adDomain
      description: An Active Directory (AD) domain
    description: Get details of a specific incident, including all alerts related
      with the incident.
  - name: netwitness-get-incidents
    arguments:
    - name: since
      description: A timestamp in ISO 8601 format (e.g. 2018-01-01T14:00:00.000Z).
        Use to retrieve incidents created on and after this timestamp.
    - name: until
      description: A timestamp in ISO 8601 format (e.g. 2018-01-01T14:00:00.000Z).
        Use to retrieve incidents created on and before this timestamp.
    - name: limit
      description: The maximum number of incidents to retrieve. default  is 200.
      defaultValue: "200"
    - name: lastDays
      description: Use this to retrieve incidents from the last number of days specified.
    outputs:
    - contextPath: NetWitness.Incidents.id
      description: The unique identifier of the incident.
    - contextPath: NetWitness.Incidents.title
      description: Title of the incident.
    - contextPath: NetWitness.Incidents.summary
      description: Summary of the incident.
    - contextPath: NetWitness.Incidents.priority
      description: The incident priority.
    - contextPath: NetWitness.Incidents.riskScore
      description: Incident risk score calculated based on associated alert’s risk
        score. Risk score ranges from 0 (no risk) to 100 (highest risk).
    - contextPath: NetWitness.Incidents.status
      description: The current status.
    - contextPath: NetWitness.Incidents.alertCount
      description: Number of alerts associated with the Incident.
    - contextPath: NetWitness.Incidents.averageAlertRiskScore
      description: Average risk score of the alerts associated with the incident.
    - contextPath: NetWitness.Incidents.sealed
      description: Indicates if additional alerts can be associated with an incident.
    - contextPath: NetWitness.Incidents.totalRemediationTaskCount
      description: The number of total remediation tasks for the incident.
    - contextPath: NetWitness.Incidents.openRemediationTaskCount
      description: The number of open remediation tasks for the incident.
    - contextPath: NetWitness.Incidents.created
      description: The timestamp of when the incident is created.
    - contextPath: NetWitness.Incidents.lastUpdated
      description: The timestamp of when the incident was last updated.
    - contextPath: NetWitness.Incidents.lastUpdatedBy
      description: The NetWitness user identifier of the user who last updated the
        incident.
    - contextPath: NetWitness.Incidents.assignee
      description: The NetWitness user identifier of the user currently working on
        the incident.
    - contextPath: NetWitness.Incidents.sources
      description: Unique set of sources for all of the Alerts in the incident.
    - contextPath: NetWitness.Incidents.ruleId
      description: The unique identifier of the rule that created the incident.
    - contextPath: NetWitness.Incidents.firstAlertTime
      description: The timestamp of the earliest occurring Alert in this incident.
    - contextPath: NetWitness.Incidents.categories.id
      description: The unique category identifier.
    - contextPath: NetWitness.Incidents.categories.parent
      description: Parent name of the category.
    - contextPath: NetWitness.Incidents.categories.name
      description: Friendly name of the category.
    - contextPath: NetWitness.Incidents.journalEntries.id
      description: The unique journal entry identifier.
    - contextPath: NetWitness.Incidents.journalEntries.author
      description: The author of this entry.
    - contextPath: NetWitness.Incidents.journalEntries.notes
      description: Notes and observations about the incident.
    - contextPath: NetWitness.Incidents.journalEntries.created
      description: The timestamp of the journal entry created date.
    - contextPath: NetWitness.Incidents.journalEntries.lastUpdated
      description: The timestamp of the journal entry last updated date.
    - contextPath: NetWitness.Incidents.journalEntries.milestone
      description: Incident milestone classifier.
    - contextPath: NetWitness.Incidents.createdBy
      description: The NetWitness user id or name of the rule that created the incident.
    - contextPath: NetWitness.Incidents.deletedAlertCount
      description: The number of alerts that are deleted from theincident.
    - contextPath: NetWitness.Incidents.eventCount
      description: Number of events associated with incident.
    - contextPath: NetWitness.Incidents.alertMeta.SourceIp
      description: Unique source IP addresses.
    - contextPath: NetWitness.Incidents.alertMeta.DestinationIp
      description: Unique destination IP addresses.
    description: 'Get a list of incidents in a specific time frame. One of the followings
      must be specified:  since, until, lastDays'
  - name: netwitness-update-incident
    arguments:
    - name: incidentId
      required: true
      description: The incident's id
    - name: status
      auto: PREDEFINED
      predefined:
      - New
      - Assigned
      - InProgress
      - RemediationRequested
      - RemediationComplete
      - Closed
      - ClosedFalsePositive
      description: The current status
    - name: assignee
      description: The NetWitness user identifier of the user currently working on
        the incident.
    outputs:
    - contextPath: NetWitness.Incidents.id
      description: The unique identifier of the incident.
    - contextPath: NetWitness.Incidents.title
      description: Title of the incident.
    - contextPath: NetWitness.Incidents.summary
      description: Summary of the incident.
    - contextPath: NetWitness.Incidents.priority
      description: The incident priority.
    - contextPath: NetWitness.Incidents.riskScore
      description: Incident risk score calculated based on associated alert’s risk
        score. Risk score ranges from 0 (no risk) to 100 (highest risk).
    - contextPath: NetWitness.Incidents.status
      description: The current status.
    - contextPath: NetWitness.Incidents.alertCount
      description: Number of alerts associated with the Incident.
    - contextPath: NetWitness.Incidents.averageAlertRiskScore
      description: Average risk score of the alerts associated with the incident.
    - contextPath: NetWitness.Incidents.sealed
      description: Indicates if additional alerts can be associated with an incident.
    - contextPath: NetWitness.Incidents.totalRemediationTaskCount
      description: The number of total remediation tasks for the incident.
    - contextPath: NetWitness.Incidents.openRemediationTaskCount
      description: The number of open remediation tasks for the incident.
    - contextPath: NetWitness.Incidents.created
      description: The timestamp of when the incident is created.
    - contextPath: NetWitness.Incidents.lastUpdated
      description: The timestamp of when the incident was last updated.
    - contextPath: NetWitness.Incidents.lastUpdatedBy
      description: The NetWitness user identifier of the user who last updated the
        incident.
    - contextPath: NetWitness.Incidents.assignee
      description: The NetWitness user identifier of the user currently working on
        the incident.
    - contextPath: NetWitness.Incidents.sources
      description: Unique set of sources for all of the Alerts in the incident.
    - contextPath: NetWitness.Incidents.ruleId
      description: The unique identifier of the rule that created the incident.
    - contextPath: NetWitness.Incidents.firstAlertTime
      description: The timestamp of the earliest occurring Alert in this incident.
    - contextPath: NetWitness.Incidents.categories.id
      description: The unique category identifier.
    - contextPath: NetWitness.Incidents.categories.parent
      description: Parent name of the category.
    - contextPath: NetWitness.Incidents.categories.name
      description: Friendly name of the category.
    - contextPath: NetWitness.Incidents.journalEntries.id
      description: The unique journal entry identifier.
    - contextPath: NetWitness.Incidents.journalEntries.author
      description: The author of this entry.
    - contextPath: NetWitness.Incidents.journalEntries.notes
      description: Notes and observations about the incident.
    - contextPath: NetWitness.Incidents.journalEntries.created
      description: The timestamp of the journal entry created date.
    - contextPath: NetWitness.Incidents.journalEntries.lastUpdated
      description: The timestamp of the journal entry last updated date.
    - contextPath: NetWitness.Incidents.journalEntries.milestone
      description: Incident milestone classifier.
    - contextPath: NetWitness.Incidents.createdBy
      description: The NetWitness user id or name of the rule that created the incident.
    - contextPath: NetWitness.Incidents.deletedAlertCount
      description: The number of alerts that are deleted from theincident.
    - contextPath: NetWitness.Incidents.eventCount
      description: Number of events associated with incident.
    - contextPath: NetWitness.Incidents.alertMeta.SourceIp
      description: Unique source IP addresses.
    - contextPath: NetWitness.Incidents.alertMeta.DestinationIp
      description: Unique destination IP addresses.
    description: Update a specific incident.  Currently, an incident’s status and
      assignee may be modified
  - name: netwitness-delete-incident
    arguments:
    - name: incidentId
      required: true
      description: The incident id
    description: Delete a specific incident, by its id.
  - name: netwitness-get-alerts
    arguments:
    - name: incidentId
      required: true
      description: The incident id
    outputs:
    - contextPath: NetWitness.Alerts.id
      description: The unique alert identifier.
    - contextPath: NetWitness.Alerts.incidentId
      description: The incident id associated with the alert.
    - contextPath: NetWitness.Alerts.title
      description: The title or name of the rule that created the alert.
    - contextPath: NetWitness.Alerts.detail
      description: The details of the alert. This can be the module name or meta that
        the module included.
    - contextPath: NetWitness.Alerts.created
      description: The timestamp of the alert created date.
    - contextPath: NetWitness.Alerts.source
      description: The source of this alert. For example, "Event Stream Analysis",
        "Malware Analysis", etc.
    - contextPath: NetWitness.Alerts.riskScore
      description: The risk score of this alert, usually in the range 0 - 100.
    - contextPath: NetWitness.Alerts.type
      description: Type of alert, "Network", "Log", etc.
    - contextPath: NetWitness.Alerts.events.source.device.ipAddress
      description: The IP address.
    - contextPath: NetWitness.Alerts.events.source.device.port
      description: The port.
    - contextPath: NetWitness.Alerts.events.source.device.macAddress
      description: The ethernet MAC address.
    - contextPath: NetWitness.Alerts.events.source.device.dnsHostname
      description: The DNS resolved hostname.
    - contextPath: NetWitness.Alerts.events.source.device.dnsDomain
      description: The top-level domain from the DNS resolved hostname
    - contextPath: NetWitness.Alerts.events.source.user.username
      description: The unique username.
    - contextPath: NetWitness.Alerts.events.source.user.emailAddress
      description: An email address.
    - contextPath: NetWitness.Alerts.events.source.user.adUsername
      description: An Active Directory (AD) username.
    - contextPath: NetWitness.Alerts.events.source.user.adDomain
      description: An Active Directory (AD) domain
    - contextPath: NetWitness.Alerts.events.destination.device.ipAddress
      description: The IP address.
    - contextPath: NetWitness.Alerts.events.destination.device.port
      description: The port.
    - contextPath: NetWitness.Alerts.events.destination.device.macAddress
      description: The ethernet MAC address.
    - contextPath: NetWitness.Alerts.events.destination.device.dnsHostname
      description: The DNS resolved hostname.
    - contextPath: NetWitness.Alerts.events.destination.device.dnsDomain
      description: The top-level domain from the DNS resolved hostname
    - contextPath: NetWitness.Alerts.events.destination.user.username
      description: The unique username.
    - contextPath: NetWitness.Alerts.events.destination.user.emailAddress
      description: An email address.
    - contextPath: NetWitness.Alerts.events.destination.user.adUsername
      description: An Active Directory (AD) username.
    - contextPath: NetWitness.Alerts.events.destination.user.adDomain
      description: An Active Directory (AD) domain
    description: Get all the alerts related to a specific incident.
  isfetch: true
