commonfields:
  id: Vectra
  version: -1
name: Vectra
display: Vectra
category: Network Security
image: data:image/png;base64,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
description: Automated attacker behavior analytics
configuration:
- display: Server URL (e.g. https://192.168.0.1)
  name: server
  defaultvalue: ""
  type: 0
  required: true
- display: Credentials
  name: credentials
  defaultvalue: ""
  type: 9
  required: true
- display: Fetch incidents
  name: isFetch
  defaultvalue: ""
  type: 8
  required: false
- display: Trust any certificate (unsecure)
  name: insecure
  defaultvalue: ""
  type: 8
  required: false
- display: Incident type
  name: incidentType
  defaultvalue: ""
  type: 13
  required: false
script:
  script: |-
    var username = params.credentials.identifier;
    var password = params.credentials.password;
    var server = params.server.replace(/[\/]+$/, '');
    var insecure = params.insecure;
    var sendRequest = function(method, url, queryName) {
        var res = http(
                url,
                {
                    Method: method,
                    Username: username,
                    Password: password,
                    Headers: {'content-type': ['application/json']},
                },
                insecure
            );
        if (res.StatusCode < 200 || res.StatusCode >= 300) {
            throw 'Failed to ' + queryName + ', request status code: ' + res.StatusCode + ' and Body: ' + res.Body + '.';
        }
        return res;
    };

    var urlDict = {
        'vectra-detections': '/api/detections/',
        'vectra-hosts':'/api/hosts/',
        'vectra-settings':'/api/settings/',
        'vectra-triage':'/api/rules/',
        'vectra-sensors':'/api/sensors/',
        'vectra-health':'/api/health/',
        'vec-get-detetctions-by-id':'/api/detections/', //deprecated
        'vec-detections': '/api/detections/',   //deprecated
        'vec-hosts':'/api/hosts',               //deprecated
        'vec-settings':'/api/settings',         //deprecated
        'vec-triage':'/api/rules',              //deprecated
        'vec-sensors':'/api/sensors',           //deprecated
        'vec-health':'/api/health/',            //deprecated
        'vec-get-host-by-id':'/api/hosts/',     //deprecate
    };

    var createIncidentFromDetection = function(incident) {
        var keys = Object.keys(incident);
        var labels = [];
        for (var i = 0; i<keys.length; i++) {
            labels.push({'type': keys[i], 'value': typeof(incident[keys[i]]) === 'object' ? JSON.stringify(incident[keys[i]]) : incident[keys[i]].toString()});
        }
        return {
            "name": incident.id + ' ' + incident.type_vname,
            "labels": labels,
            "rawJSON": JSON.stringify(incident)
        };
    };

    var fetchIncidents = function(){
        var lastRun = getLastRun();
        var id = lastRun && lastRun.id ? lastRun.id : 0;
        var result = sendRequest('GET', server + urlDict['vectra-detections'] + encodeToURLQuery({min_id: id, 'page':'last'}), 'vectra-detections');
        var res = JSON.parse(result.Body).results;
        var incidents = [];
        for (var i = 0; i < res.length; i++) {
            var detection = res[i];
            id = Math.max(id, detection.id);
            incidents.push(createIncidentFromDetection(res[i]));
        }
        if (incidents.length > 0) {
          setLastRun({'id': id !== 0 ? id + 1 : 0});
        }
        return JSON.stringify(incidents);
    };

    var isEmpty = function(object) {
        if(Array.isArray(object)){
            return object.length === 0;
        }
        for(var i in object) {
            if(object[i]){
                return false;
            }
        }
        return true;
    };

    var splitToID = function(str){
        var temp = str.split('/');
        return temp[temp.length -1];
    };

    var removeFromArray = function(keys, array){
        for(var i=0; i<keys.length; i++){
            array.splice(array.indexOf(keys[i]), 1);
        }
        return array;
    };

    var vectraDetections = function(result){
        var res = JSON.parse(result.Body);

        var md;
        if(args.detection_id){
            res = [res];
        }
        else{
            res = res.results;
        }
        var keys = Object.keys(res[0]);
        keys.splice(keys.indexOf('url'), 1);

        var temp;
        for(var i=0; i<res.length; i++){
            if(res[i].host){
                res[i].host = splitToID(res[i].host);
            }
        }

        var relayed_comm_set = null;
        var summary = null;

        if(res.length === 1){
            if (res[0].summary)
            {
                summary = res[0].summary;
            }
            if (res[0].relayed_comm_set)
            {
                relayed_comm_set = res[0].relayed_comm_set;
            }
        }

        md = tblToMd('Detection table', res, ['id','type_vname','category','src_ip','t_score','c_score','first_timestamp','tags', 'targets_key_asset']);

        if (relayed_comm_set){
            if (!(relayed_comm_set instanceof Array)){
                relayed_comm_set = [relayed_comm_set];
            }
            if (relayed_comm_set.length > 0 && relayed_comm_set[0]) {
                var relayed_keys = Object.keys(relayed_comm_set[0]);
                relayed_keys.splice(relayed_keys.indexOf('url'), 1);

                md += '\n';
                md += tblToMd('Relayed Comm Set',relayed_comm_set,relayed_keys);
            }
        }
        if (summary){
            if (!(summary instanceof Array)){
                summary = [summary];
            }
            if (summary.length > 0 && summary[0]) {
                var summary_keys = Object.keys(summary[0]);

                md += '\n';
                md += tblToMd('Summary',summary,summary_keys);
            }
        }

        var context = [];
        for(i=0; i<res.length; i++){
            var val = res[i];
            res[i] = {
                        DetectionId: val.id,
                        TypeVName: val.type_vname,
                        Category: val.category,
                        SrcIP: val.src_ip,
                        State: val.state,
                        TScore: val.t_score,
                        CScore: val.c_score,
                        TargetsKeyAsset: val.targets_key_asset,
                        FirstTimestamp: val.first_timestamp,
                        LastTimestamp: val.last_timestamp,
                        Tags: val.tags,
                        HostID: splitToID(val.host)
                    };
            context.push(res[i]);
        }

        return {
            Type: entryTypes.note,
            Contents: result.Body,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext: {'Vectra.Detections(val.DetectionId==obj.DetectionId)': context }
        };
    };

    var vectraHosts = function(result){
        var res;

        if(args.host_id){
            res = [JSON.parse(result.Body)];
        }
        else{
            res = JSON.parse(result.Body).results;
        }

        var temp;
        for(var i=0; i<res.length; i++){
            res[i].detection_ids = res[i].detection_set;
            if(res[i].detection_ids){
                for(j=0; j<res[i].detection_ids.length; j++){
                    res[i].detection_ids[j] = splitToID(res[i].detection_ids[j]);
                }
            }
        }

        var md = tblToMd(
                'Hosts table',
                res,
                ['id','name','state','t_score','c_score','last_source','last_detection_timestamp','detection_ids','tags','key_asset','new_host_pointer','sensor_luid','targets_key_asset']
        );

        var val;
        for(i=0; i<res.length; i++){
            val = res[i];
            res[i] = {
                        Hostname: val.name,
                        Vectra: {
                            ID: val.id,
                            LastDetection: val.last_detection_timestamp,
                            DetectionID: val.detection_ids,
                            TScore: val.t_score,
                            CScore: val.c_score,
                            KeyAsset: val.key_asset,
                            TargetsKeyAsset: val.targets_key_asset,
                        },
                        State: val.state,
                        IP: val.last_source,
                    };
        }
        var context = {Endpoint : res};

        return {
            Type: entryTypes.note,
            Contents: result.Body,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext: context
        };
    };

    var vectraSettings = function(result){
        var res = JSON.parse(result.Body);
        var keys = removeFromArray(['url'],Object.keys(res.results[0]));
        var md = tblToMd('Setting table', res.results, keys);

        return {
            Type: entryTypes.note,
            Contents: result.Body,
            ContentsFormat: formats.json,
            HumanReadable: md
        };
    };

    var vectraTriage = function(result){
        var res = (JSON.parse(result.Body)).results;
        var temp;

        for(var i=0; i<res.length; i++){
            if(res[i].host){
                for(var j=0; j<res[i].host.length; j++){
                    res[i].host[j] = splitToID(res[i].host[j]);
                }
            }
        }

        var keys = removeFromArray(['url'], Object.keys(res[0]));
        var md = tblToMd('Rules table', res, keys);
        var context = {};
        var val;

        for(i=0; i<res.length; i++){
            val = res[i];
            res[i] = {          ID:             val.name,
                                SmartCategory:  val.smart_category,
                                Description:    (val.description? val.description:undefined),
                                Type:           val.type_vname,
                                Category:       val.category,
                                Created :       val.created_timestamp,
                                LastUpdate:     val.last_timestamp,
                                Host:           (val.host.length === 0 ? undefined :  val.host),
                                IP:             (val.ip? val.ip : undefined),
                                Priority:       (val.priority? val.priority : undefined),
                                Remote:         [{  IP: (val.remote1_ip? val.remote1_ip : undefined),
                                                    Protocol: (val.remote1_proto? val.remote1_proto : undefined),
                                                    Port:(val.remote1_port? val.remote1_port : undefined),
                                                    DNS: (val.remote1_dns? val.remote1_dns : undefined),
                                                    Kerberos: {Account: (val.remote1_kerb_account? val.remote1_kerb_account : undefined),
                                                                Service:(val.remote1_kerb_service? val.remote1_kerb_service : undefined)
                                                    }},
                                                 {  IP: (val.remote2_ip? val.remote2_ip : undefined),
                                                    Protocol: (val.remote2_proto? val.remote2_proto : undefined),
                                                    Port: (val.remote2_port? val.remote2_port : undefined),
                                                    DNS:(val.remote2_dns? val.remote2_dns : undefined)
                                                 }]
                                };

        }
        var notEmpty = function(obj){
            return !isEmpty(obj);
        }

        for(i=0; i<res.length; i++){
            temp = res[i].Remote;
            if(isEmpty(temp[0].Kerberos)){
                delete temp[0].Kerberos;
            }
            temp = temp.filter(notEmpty);
            if(isEmpty(temp)){
                temp = undefined;
            }
            res[i].Remote = temp;
        }
        context.Vectra = {Rule: res};

        return {
            Type: entryTypes.note,
            Contents: result.Body,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext : context
        };

    };

    var vectraSensors = function(result){
        var res = JSON.parse(result.Body);
        var keys = removeFromArray(['url','health_stats'], Object.keys(res.results[0]));
        var md = tblToMd('Sensors table', res.results, keys);
        var val;
        for(i=0; i<res.results.length; i++){
            val = res.results[i];
            res.results[i] = {
                                ID : val.id,
                                Alias : val.alias,
                                Location : (val.location? val.location:undefined),
                                SerialNumber : val.serial_number,
                                LUID : val.luid,
                                Status : val.status,
                                CurrentVersion : val.current_version,
                                OriginalVersion : val.original_version,
                                IP : val.ip_address,
                                URI : val.headend_uri,
                                LastSeen : val.last_seen
                            };
        }

        var context = {Vectra: { Sensor: res.results } };

        return {
            Type: entryTypes.note,
            Contents: result.Body,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext : context
        };
    };

    var funcDict = {
        'vectra-detections':  vectraDetections,
        'vectra-hosts':       vectraHosts,
        'vectra-settings':    vectraSettings,
        'vectra-triage':      vectraTriage,
        'vectra-sensors':     vectraSensors,
        'vec-detections':     vectraDetections, //deprecated
        'vec-hosts':          vectraHosts,      //deprecated
        'vec-settings':       vectraSettings,   //deprecated
        'vec-triage':         vectraTriage,     //deprecated
        'vec-sensors':        vectraSensors,    //deprecated
        'vec-get-host-by-id': vectraHosts,      //deprecated
        'vec-get-detetctions-by-id': vectraDetections  //deprecated
    };

    var result;

    switch (command) {
        case 'fetch-incidents':
            return fetchIncidents();
        case 'test-module':
            if (sendRequest('GET', server + urlDict['vec-detections'], 'Test')) {
                return 'ok';
            }
            return 'not cool';
        case 'vectra-health':
        case 'vec-health': //deprecated
            return sendRequest('GET', server + urlDict[command] + '/' + args.path, urlDict[command]);
        case 'vec-get-detetctions-by-id':   //deprecated
        case 'vec-detections':              //deprecated
        case 'vectra-detections':
            result = sendRequest('GET', server + urlDict[command] + (args.detection_id? args.detection_id : encodeToURLQuery(args)), urlDict[command]);
            break;
        case 'vec-get-host-by-id':  //deprecated
        case 'vec-hosts':           //deprecatd
        case 'vectra-hosts':
            result = sendRequest('GET', server + urlDict[command] + (args.host_id? args.host_id : encodeToURLQuery(args)), urlDict[command]);
            break;
        default:
            result = sendRequest('GET', server + urlDict[command] + encodeToURLQuery(args), urlDict[command]);
    }

    return funcDict[command](result);
  type: javascript
  commands:
  - name: vec-detections
    deprecated: true
    arguments:
    - name: detection_id
      description: Filter by detection ID
    - name: fields
      description: Filters objects listed
    - name: page
      description: Page number. Possible values are a positive integer or last
    - name: page_size
      description: Page size. Possible values are a positive integer or all
    - name: ordering
      description: Orders records by last timestamp, threat score and certainty score.
        The default out sorts threat and certainty score in ascending order. Scores
        can sorted in descending order by prepending the query with “minus” symbol
    - name: min_id
      description: '>= the id provided'
    - name: max_id
      description: <= the id provided
    - name: state
      description: 'filter by state: active, inactive, ignored, ignored for all'
    - name: type_vname
      description: filter by the detection type (verbose name)
    - name: category
      description: filter by the detection category
    - name: src_ip
      description: filter by source (ip address)
    - name: t_score
      description: filter by threat score
    - name: t_score_gte
      description: filter by threat score >= the score provided
    - name: c_score
      description: filter by certainty score
    - name: c_score_gte
      description: filter by certainty score >= the score provided
    - name: last_timestamp
      description: filter by last timestamp
    - name: host_id
      description: filter by id of the host object a detection is attributed to
    - name: tags
      description: filter by a tag or a comma-separated list of tags
    - name: destination
      description: filter by destination in the detection detail set
    - name: proto
      description: filter by the protocol in the detection detail set
    - name: dst_port
      description: filter by the destination port in the detection detail set
    - name: inbound_ip
      description: filter by the inbound_ip in the relayed comm set
    - name: inbound_proto
      description: filter by the inbound_proto in the relayed comm set
    - name: inbound_port
      description: filter by the inbound_port in the relayed comm set
    - name: inbound_dns
      description: filter by the inbound_dns in the relayed comm set
    - name: outbound_ip
      description: filter by the outbound_ip in the relayed comm set
    - name: outbound_proto
      description: filter by the outbound_proto in the relayed comm set
    - name: outbound_port
      description: filter by the outbound_port in the relayed comm set
    - name: outbound_dns
      description: filter by the outbound_dns in the relayed_comm_set
    - name: dns_ip
      description: filter by the dns_ip in the dns_set
    - name: dns_request
      description: filter by the dns_request in the dns_set
    - name: resp_code
      description: filter by the resp_code in the dns_set
    - name: resp
      description: filter by the resp in the dns_set
    outputs:
    - contextPath: Vectra.Detections.DetectionId
      description: The learned hostname
    - contextPath: Vectra.Detections.TypeVName
      description: Vectra detection id
    - contextPath: Vectra.Detections.Category
      description: The detection category
    - contextPath: Vectra.Detections.SrcIP
      description: The detection source IP
    - contextPath: Vectra.Detections.State
      description: The detection state
    - contextPath: Vectra.Detections.TScore
      description: The detection tscore
    - contextPath: Vectra.Detections.CScore
      description: The detection cscore
    - contextPath: Vectra.Detections.TargetsKeyAsset
      description: Is detection targets key asset
    - contextPath: Vectra.Detections.Tags
      description: The detection tags
    - contextPath: Vectra.Detections.FirstTimestamp
      description: The detection first time stamp
    - contextPath: Vectra.Detections.LastTimestamp
      description: The detection last time stamp
    - contextPath: Vectra.Detections.HostID
      description: The detection host id
    description: Detection objects contain all the information related to security
      events detected on the network
  - name: vectra-detections
    arguments:
    - name: detection_id
      description: Filter by detection ID
    - name: fields
      description: Filters objects listed
    - name: page
      description: Page number. Possible values are a positive integer or last
    - name: page_size
      description: Page size. Possible values are a positive integer or all
    - name: ordering
      description: Orders records by last timestamp, threat score and certainty score.
        The default out sorts threat and certainty score in ascending order. Scores
        can sorted in descending order by prepending the query with “minus” symbol
    - name: min_id
      description: '>= the id provided'
    - name: max_id
      description: <= the id provided
    - name: state
      description: 'filter by state: active, inactive, ignored, ignored for all'
    - name: type_vname
      description: filter by the detection type (verbose name)
    - name: category
      description: filter by the detection category
    - name: src_ip
      description: filter by source (ip address)
    - name: t_score
      description: filter by threat score
    - name: t_score_gte
      description: filter by threat score >= the score provided
    - name: c_score
      description: filter by certainty score
    - name: c_score_gte
      description: filter by certainty score >= the score provided
    - name: last_timestamp
      description: filter by last timestamp
    - name: host_id
      description: filter by id of the host object a detection is attributed to
    - name: tags
      description: filter by a tag or a comma-separated list of tags
    - name: destination
      description: filter by destination in the detection detail set
    - name: proto
      description: filter by the protocol in the detection detail set
    - name: dst_port
      description: filter by the destination port in the detection detail set
    - name: inbound_ip
      description: filter by the inbound_ip in the relayed comm set
    - name: inbound_proto
      description: filter by the inbound_proto in the relayed comm set
    - name: inbound_port
      description: filter by the inbound_port in the relayed comm set
    - name: inbound_dns
      description: filter by the inbound_dns in the relayed comm set
    - name: outbound_ip
      description: filter by the outbound_ip in the relayed comm set
    - name: outbound_proto
      description: filter by the outbound_proto in the relayed comm set
    - name: outbound_port
      description: filter by the outbound_port in the relayed comm set
    - name: outbound_dns
      description: filter by the outbound_dns in the relayed_comm_set
    - name: dns_ip
      description: filter by the dns_ip in the dns_set
    - name: dns_request
      description: filter by the dns_request in the dns_set
    - name: resp_code
      description: filter by the resp_code in the dns_set
    - name: resp
      description: filter by the resp in the dns_set
    outputs:
    - contextPath: Vectra.Detections.DetectionId
      description: The learned hostname
    - contextPath: Vectra.Detections.TypeVName
      description: Vectra detection id
    - contextPath: Vectra.Detections.Category
      description: The detection category
    - contextPath: Vectra.Detections.SrcIP
      description: The detection source IP
    - contextPath: Vectra.Detections.State
      description: The detection state
    - contextPath: Vectra.Detections.TScore
      description: The detection tscore
    - contextPath: Vectra.Detections.CScore
      description: The detection cscore
    - contextPath: Vectra.Detections.TargetsKeyAsset
      description: Is detection targets key asset
    - contextPath: Vectra.Detections.Tags
      description: The detection tags
    - contextPath: Vectra.Detections.FirstTimestamp
      description: The detection first time stamp
    - contextPath: Vectra.Detections.LastTimestamp
      description: The detection last time stamp
    - contextPath: Vectra.Detections.HostID
      description: The detection host id
    description: Detection objects contain all the information related to security
      events detected on the network
  - name: vec-hosts
    deprecated: true
    arguments:
    - name: host_id
      description: Filter by host ID
    - name: fields
      description: Filters objects listed
    - name: page
      description: Page number. Possible values are a positive integer or last
    - name: page_size
      description: Page size. Possible values are a positive integer or all
    - name: ordering
      description: Orders records by last timestamp, threat score and certainty score.
        The default out sorts threat and certainty score in ascending order. Scores
        can sorted in descending order by prepending the query with “minus” symbol
    - name: name
      description: filter by name
    - name: state
      description: 'filter by state: active, inactive, suspended, ignored, ignored4all'
    - name: last_source
      description: filter by last_source (ip address)
    - name: t_score
      description: filter by threat score
    - name: t_score_gte
      description: filter by threat score >= the score provided
    - name: c_score
      description: filter by certainty score
    - name: c_score_gte
      description: filter by certainty score >= the score provided
    - name: last_detection_timestamp
      description: filter by last_detection_timestamp
    - name: tags
      description: filter by a tag or a comma-separated list of tags (returns hosts
        that contain any of the tags specified), e.g.tags=baz | tags=foo,bar"
    - name: key_assest
      description: 'filter by key asset: True, False'
    - name: mac_address
      description: filter by mac address
    outputs:
    - contextPath: Endpoint.Hostname
      description: The learned hostname
    - contextPath: Endpoint.VectraID
      description: Vectra object id
    - contextPath: Endpoint.State
      description: The state of this record
    - contextPath: Endpoint.IP
      description: Last source IP associated with this host
    - contextPath: Endpoint.LastDetection
      description: Last detection activity from this host
    - contextPath: Endpoint.Detection.ID
      description: List of Detections for Host
    - contextPath: Endpoint.TScore
      description: The current threat score correlated to this host
    - contextPath: Endpoint.CScore
      description: The current certainty score correlated to this host
    description: Host information includes data that correlates the host data to detected
      security events
  - name: vectra-hosts
    arguments:
    - name: host_id
      description: Filter by host ID
    - name: fields
      description: Filters objects listed
    - name: page
      description: Page number. Possible values are a positive integer or last
    - name: page_size
      description: Page size. Possible values are a positive integer or all
    - name: ordering
      description: Orders records by last timestamp, threat score and certainty score.
        The default out sorts threat and certainty score in ascending order. Scores
        can sorted in descending order by prepending the query with “minus” symbol
    - name: name
      description: filter by name
    - name: state
      description: 'filter by state: active, inactive, suspended, ignored, ignored4all'
    - name: last_source
      description: filter by last_source (ip address)
    - name: t_score
      description: filter by threat score
    - name: t_score_gte
      description: filter by threat score >= the score provided
    - name: c_score
      description: filter by certainty score
    - name: c_score_gte
      description: filter by certainty score >= the score provided
    - name: last_detection_timestamp
      description: filter by last_detection_timestamp
    - name: tags
      description: filter by a tag or a comma-separated list of tags (returns hosts
        that contain any of the tags specified), e.g.tags=baz | tags=foo,bar"
    - name: key_assest
      description: 'filter by key asset: True, False'
    - name: mac_address
      description: filter by mac address
    outputs:
    - contextPath: Endpoint.Hostname
      description: The learned hostname
    - contextPath: Endpoint.VectraID
      description: Vectra object id
    - contextPath: Endpoint.State
      description: The state of this record
    - contextPath: Endpoint.IP
      description: Last source IP associated with this host
    - contextPath: Endpoint.LastDetection
      description: Last detection activity from this host
    - contextPath: Endpoint.Detection.ID
      description: List of Detections for Host
    - contextPath: Endpoint.TScore
      description: The current threat score correlated to this host
    - contextPath: Endpoint.CScore
      description: The current certainty score correlated to this host
    description: Host information includes data that correlates the host data to detected
      security events
  - name: vec-settings
    deprecated: true
    arguments: []
    description: The settings information includes S-series sensor and X-series configurations
      input by the administrator
  - name: vectra-settings
    arguments: []
    description: he settings information includes S-series sensor and X-series configurations
      input by the administrator
  - name: vec-health
    deprecated: true
    arguments:
    - name: path
      description: the path to query
    description: The health configuration can be used to retrieve system health statistics
      such as subnet counts, traffic bandwidth, headend and sensor information
  - name: vectra-health
    arguments:
    - name: path
      description: the path to query
    description: The health configuration can be used to retrieve system health statistics
      such as subnet counts, traffic bandwidth, headend and sensor information
  - name: vec-triage
    deprecated: true
    arguments: []
    outputs:
    - contextPath: Vectra.Rule.ID
      description: The record id
    - contextPath: Vectra.Rule.SmartCategory
      description: Custom Triage label used to recategorize specified detections
    - contextPath: Vectra.Rule.Description
      description: Name of Triage filter
    - contextPath: Vectra.Rule.Type
      description: Original detection type
    - contextPath: Vectra.Rule.Category
      description: Original detection category
    - contextPath: Vectra.Rule.Created
      description: The timestamp when this Triage filter was created
    - contextPath: Vectra.Rule.LastUpdate
      description: The timestamp when this Triage filter was triggered
    - contextPath: Vectra.Rule.Host.ID
      description: Host(s) that this Triage filter applies to
    - contextPath: Vectra.Rule.IP
      description: Host IP
    - contextPath: Vectra.Rule.Priority
      description: Used in ordering execution of Triage filters
    - contextPath: Vectra.Rule.Remote.IP
      description: Destination IP where this Triage filter will be applied to
    - contextPath: Vectra.Rule.Remote.Protocol
      description: Destination protocol where this Triage filter will be applied to
    - contextPath: Vectra.Rule.Remote.Port
      description: Destination port where this Triage filter will be applied to
    - contextPath: Vectra.Rule.Remote.DNS
      description: Destination FQDN where this Triage filter will apply to
    - contextPath: Vectra.Rule.Remote.Kerberos.Account
      description: Kerberos Account
    - contextPath: Vectra.Rule.Remote.Kerberos.Service
      description: Kerberos Service
    description: The rules branch can be used to retrieve a listing of configured
      Triage rules
  - name: vectra-triage
    arguments: []
    outputs:
    - contextPath: Vectra.Rule.ID
      description: The record id
    - contextPath: Vectra.Rule.SmartCategory
      description: Custom Triage label used to recategorize specified detections
    - contextPath: Vectra.Rule.Description
      description: Name of Triage filter
    - contextPath: Vectra.Rule.Type
      description: Original detection type
    - contextPath: Vectra.Rule.Category
      description: Original detection category
    - contextPath: Vectra.Rule.Created
      description: The timestamp when this Triage filter was created
    - contextPath: Vectra.Rule.LastUpdate
      description: The timestamp when this Triage filter was triggered
    - contextPath: Vectra.Rule.Host.ID
      description: Host(s) that this Triage filter applies to
    - contextPath: Vectra.Rule.IP
      description: Host IP
    - contextPath: Vectra.Rule.Priority
      description: Used in ordering execution of Triage filters
    - contextPath: Vectra.Rule.Remote.IP
      description: Destination IP where this Triage filter will be applied to
    - contextPath: Vectra.Rule.Remote.Protocol
      description: Destination protocol where this Triage filter will be applied to
    - contextPath: Vectra.Rule.Remote.Port
      description: Destination port where this Triage filter will be applied to
    - contextPath: Vectra.Rule.Remote.DNS
      description: Destination FQDN where this Triage filter will apply to
    - contextPath: Vectra.Rule.Remote.Kerberos.Account
      description: Kerberos Account
    - contextPath: Vectra.Rule.Remote.Kerberos.Service
      description: Kerberos Service
    description: The rules branch can be used to retrieve a listing of configured
      Triage rules
  - name: vec-sensors
    deprecated: true
    arguments: []
    outputs:
    - contextPath: Vectra.Sensor.ID
      description: Object ID
    - contextPath: Vectra.Sensor.Alias
      description: User configured alias assigned tothe sensor
    - contextPath: Vectra.Sensor.Location
      description: User configured location assigned to the sensor
    - contextPath: Vectra.Sensor.SerialNumber
      description: Serial number of the sensor
    - contextPath: Vectra.Sensor.LUID
      description: Local Unique Identifier assigned to the sensor
    - contextPath: Vectra.Sensor.Status
      description: Pairing status of the sensor
    - contextPath: Vectra.Sensor.CurrentVersion
      description: OS version currently running on the sensor
    - contextPath: Vectra.Sensor.OriginalVersion
      description: OS version originally installed on the sensor
    - contextPath: Vectra.Sensor.IP
      description: IP address of the sensor
    - contextPath: Vectra.Sensor.URI
      description: The URI of the brain the sensor is paired
    - contextPath: Vectra.Sensor.LastSeen
      description: Timestamp of the last connection by the sensor to the brain
    description: The sensors branch can retrieve a listing of sensors that collect
      and feed data to the X-series
  - name: vectra-sensors
    arguments: []
    outputs:
    - contextPath: Vectra.Sensor.ID
      description: Object ID
    - contextPath: Vectra.Sensor.Alias
      description: User configured alias assigned tothe sensor
    - contextPath: Vectra.Sensor.Location
      description: User configured location assigned to the sensor
    - contextPath: Vectra.Sensor.SerialNumber
      description: Serial number of the sensor
    - contextPath: Vectra.Sensor.LUID
      description: Local Unique Identifier assigned to the sensor
    - contextPath: Vectra.Sensor.Status
      description: Pairing status of the sensor
    - contextPath: Vectra.Sensor.CurrentVersion
      description: OS version currently running on the sensor
    - contextPath: Vectra.Sensor.OriginalVersion
      description: OS version originally installed on the sensor
    - contextPath: Vectra.Sensor.IP
      description: IP address of the sensor
    - contextPath: Vectra.Sensor.URI
      description: The URI of the brain the sensor is paired
    - contextPath: VectraSensor.LastSeen
      description: Timestamp of the last connection by the sensor to the brain
    description: The sensors branch can retrieve a listing of sensors that collect
      and feed data to the X-series
  - name: vec-get-host-by-id
    deprecated: true
    arguments:
    - name: host_id
      required: true
      default: true
      description: The id of the required host
    outputs:
    - contextPath: Endpoint.Hostname
      description: The learned hostname
    - contextPath: Endpoint.VectraID
      description: Vectra object id
    - contextPath: Endpoint.State
      description: The state of this record
    - contextPath: Endpoint.IP
      description: Last source IP associated with this host
    - contextPath: Endpoint.Vectra.LastDetection
      description: Last detection activity from this host
    - contextPath: Endpoint.Vectra.DetectionID
      description: List of Detections for Host
    - contextPath: Endpoint.Vectra.TScore
      description: The current threat score correlated to this host
    - contextPath: Endpoint.Vectra.CScore
      description: The current certainty score correlated to this host
    description: Get host by id
  - name: vec-get-detetctions-by-id
    deprecated: true
    arguments:
    - name: detection_id
      description: The id of the required detection
    description: Get detections by host id
  isfetch: true
tests:
  - No test