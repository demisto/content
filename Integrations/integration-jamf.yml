versionedfields: {}
commonfields:
  id: jamf
  version: -1
name: jamf
display: jamf
category: Endpoint
image: data:image/png;base64,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
description: Jamf device management
configuration:
- display: Server URL (e.g. https://192.168.0.1)
  name: server
  defaultvalue: ""
  type: 0
  required: true
- display: Username
  name: credentials
  defaultvalue: ""
  type: 9
  required: false
- display: Trust any certificate (unsecure)
  name: insecure
  defaultvalue: "true"
  type: 8
  required: false
- display: Use system proxy settings
  name: proxy
  defaultvalue: "false"
  type: 8
  required: false
script:
  script: |-
    import requests
    from requests.auth import HTTPBasicAuth
    import re
    import os

    HEADERS = {"Accept":"application/json"}

    base_url = demisto.params()['server']
    user = demisto.params()['credentials']['identifier']
    password = demisto.params()['credentials']['password']
    auth = HTTPBasicAuth(user,password)

    if not demisto.params()['proxy']:
        del os.environ['HTTP_PROXY']
        del os.environ['HTTPS_PROXY']
        del os.environ['http_proxy']
        del os.environ['https_proxy']

    def jamf_get_computers():
        endpoint = "/JSSResource/computers"
        try:
            contents = requests.get(base_url + endpoint,auth=auth,headers=HEADERS).json()
            ec = {}
            ec["JAMF"] = [{"ID": item["id"], "Name":item["name"]} for item in contents['computers']]

            demisto.results({ 'Type' : entryTypes['note'], 'ContentsFormat' : formats['json'], 'Contents' : contents, "EntryContext": ec,"HumanReadable": tableToMarkdown("Computers", ec["JAMF"])})
        except Exception,e:
            demisto.results({ 'Type' : entryTypes['error'], 'ContentsFormat' : formats['text'], 'Contents' : "Unable to complete command.  Please check credentials and/or proxy settings" })
            sys.exit(0)

    def jamf_get_computers_match(match):
        endpoint = "/JSSResource/computers/match/{match}"
        try:
            contents = requests.get(base_url + endpoint.format(match=match),auth=auth,headers=HEADERS).json()
            ec = {}
            ec["JAMF"] = [
                {"ID": item["id"],
                "Name": item["name"],
                "AltMAC": item["alt_mac_address"],
                "MAC": item["mac_address"],
                "Serial": item["serial_number"],
                "UDID": item["udid"],
                "AssetTag": item["asset_tag"],
                "BarCode-1": item["bar_code_1"],
                "BarCode-2": item["bar_code_2"],
                "Building": item["building"],
                "BuildingName": item["building_name"],
                "Department": item["department"],
                "DepartmentName": item["department_name"],
                "Email": item["email"],
                "EmailAddress": item["email_address"],
                "Position": item["position"],
                "Username": item["username"],
                "Realname": item["realname"],
                "Room": item["room"]}
                for item in contents["computers"]
            ]

            demisto.results({ 'Type' : entryTypes['note'], 'ContentsFormat' : formats['json'], 'Contents' : contents, "EntryContext": ec,"HumanReadable": tableToMarkdown("Computers", ec["JAMF"])})
        except Exception,e:
            demisto.results({ 'Type' : entryTypes['error'], 'ContentsFormat' : formats['text'], 'Contents' : "Unable to complete command.  Please check credentials and/or proxy settings" })
            sys.exit(0)

    def jamf_computers_hardware(computer_id):
        endpoint = "/JSSResource/computers/id/{computer_id}/subset/hardware"

        try:
            contents = requests.get(base_url + endpoint.format(computer_id=computer_id),auth=auth,headers=HEADERS).json()
            ec = {}
            ec["JAMF"] = {
                "Make": contents["computer"]["hardware"]["make"],
                "Model": contents["computer"]["hardware"]["model"],
                "ModelIdentifier": contents["computer"]["hardware"]["model_identifier"],
                "OSName": contents["computer"]["hardware"]["os_name"],
                "OSVersion": contents["computer"]["hardware"]["os_version"],
                "OSBuild": contents["computer"]["hardware"]["os_build"],
                "MasterPasswordSet": contents["computer"]["hardware"]["master_password_set"],
                "ActiveDirectoryStatus": contents["computer"]["hardware"]["active_directory_status"],
                "ServicePack": contents["computer"]["hardware"]["service_pack"],
                "ProcessorType": contents["computer"]["hardware"]["processor_type"],
                "ProcessorArchitecture": contents["computer"]["hardware"]["processor_architecture"],
                "NumberProcessors": contents["computer"]["hardware"]["number_processors"],
                "NumberCores": contents["computer"]["hardware"]["number_cores"],
                "TotalRam": contents["computer"]["hardware"]["total_ram"],
            }

            ec["JAMF"]["Storage"] = [
                {
                    "Disk": item["disk"],
                    "Model": item["model"],
                    "SerialNumber": item["serial_number"],
                    "Size": item["size"],
                    "DriveCapacityMB": item["drive_capacity_mb"],
                    "PartitionName": item["partition"]["name"],
                    "Size": item["partition"]["size"],
                    "Type": item["partition"]["type"],
                    "PartitionCapacityMB": item["partition"]["partition_capacity_mb"],
                    "FilevaultStatus": item["partition"]["filevault_status"],
                    "Filevault2Status": item["partition"]["filevault2_status"]
                }
                    for item in contents["computer"]["hardware"]["storage"]
                ]

            demisto.results({ 'Type' : entryTypes['note'], 'ContentsFormat' : formats['json'], 'Contents' : contents, "EntryContext": ec,"HumanReadable": tableToMarkdown("Hardware Information", ec["JAMF"]) + "\n\n" + tableToMarkdown("Storage Information", ec["JAMF"]["Storage"]) })

        except Exception,e:
            demisto.results({ 'Type' : entryTypes['error'], 'ContentsFormat' : formats['text'], 'Contents' : "Unable to complete command.  Please check credentials and/or proxy settings\n" + str(e) })
            sys.exit(0)

    def jamf_erase_device(computer_id,passcode):
        endpoint = "/JSSResource/computercommands/command/EraseDevice/passcode/{passcode}/id/{computer_id}"
        data = None

        try:
            contents = requests.post(base_url + endpoint.format(computer_id=computer_id,passcode=passcode),auth=auth,headers=HEADERS).text
            demisto.results(contents)
            sys.exit(0)
        except Exception, e:
            demisto.results({ 'Type' : entryTypes['error'], 'ContentsFormat' : formats['text'], 'Contents' : "Unable to complete command.  Please check credentials and/or proxy settings\n" + str(e) })
            sys.exit(0)

    if demisto.command() == 'test-module':
        try:
            endpoint = "/JSSResource/users"
            contents = requests.get(base_url + endpoint,auth=auth,headers=HEADERS).json()
            demisto.results('ok')
            sys.exit(0)
        except Exception, e:
            demisto.results({ 'Type' : entryTypes['error'], 'ContentsFormat' : formats['text'], 'Contents' : 'Unable to login.  Please check credentials and/or proxy settings.'})
            sys.exit(0)

    if demisto.command() == 'jamf-get-computers':
        jamf_get_computers()

    if demisto.command() == 'jamf-get-computers-match':
        jamf_get_computers_match(demisto.args()['match'])

    if demisto.command() == 'jamf-get-computer-hardware':
        jamf_computers_hardware(demisto.args()['id'])

    if demisto.command() == 'jamf-erase-device':
        jamf_erase_device(demisto.args()['id'],demisto.args()['passcode'])
  type: python
  commands:
  - name: jamf-get-computers
    arguments: []
    outputs:
    - contextPath: Jamf.Computers.ID
      description: Computer ID
    - contextPath: Jamf.Computers.Name
      description: Computer name
    description: Get a list of managed computers
  - name: jamf-get-computers-match
    arguments:
    - name: match
      required: true
      description: Match criteria. e.g. to retrieve all computers associated with
        a user use $UserID
    outputs:
    - contextPath: Jamf.Computers.ID
      description: Computer ID
    - contextPath: Jamf.Computers.Name
      description: Computer name
    - contextPath: Jamf.Computers.AltMAC
      description: Computer alternative MAC
    - contextPath: Jamf.Computers.MAC
      description: Computer MAC
    - contextPath: Jamf.Computers.Serial
      description: Computer serial
    - contextPath: Jamf.Computers.UDID
      description: Computer UDID
    - contextPath: Jamf.Computers.AssetTag
      description: Computer asset tag
    - contextPath: Jamf.Computers.BarCode.1
      description: Computer barcode 1
    - contextPath: Jamf.Computers.BarCode.2
      description: Computer barcode 2
    - contextPath: Jamf.Computers.Building
      description: Computer building
    - contextPath: Jamf.Computers.BuildingName
      description: Computer building name
    - contextPath: Jamf.Computers.Department
      description: Computer department
    - contextPath: Jamf.Computers.DepartmentName
      description: Computer department name
    - contextPath: Jamf.Computers.Email
      description: Computer email
    - contextPath: Jamf.Computers.EmailAddress
      description: Computer email address
    - contextPath: Jamf.Computers.Position
      description: Computer position
    - contextPath: Jamf.Computers.Username
      description: Computer username
    - contextPath: Jamf.Computers.Realname
      description: Computer real name
    - contextPath: Jamf.Computers.Room
      description: Computer room
    description: Get a list of managed computers that matches inputs query
  - name: jamf-get-computer-hardware
    arguments:
    - name: id
      required: true
      description: Lookup by ID
    outputs:
    - contextPath: JAMF.Make
      description: Make of device
    - contextPath: JAMF.Model
      description: Model of device
    - contextPath: JAMF.ModelIdentifier
      description: Model Identifier of device
    - contextPath: JAMF.OSName
      description: Operating System of device
    - contextPath: JAMF.OSVersion
      description: OS Version of device
    - contextPath: JAMF.OSBuild
      description: OS Build of device
    - contextPath: JAMF.MasterPasswordSet
      description: Is Master Password Set
    - contextPath: JAMF.ActiveDirectoryStatus
      description: Active Directory Status
    - contextPath: JAMF.ServicePack
      description: Service Pack of device
    - contextPath: JAMF.ProcessorType
      description: Processor Type
    - contextPath: JAMF.ProcessorArchitecture
      description: Processor Architecture
    - contextPath: JAMF.NumberProcessors
      description: Number Processors
    - contextPath: JAMF.NumberCores
      description: Number of Cores
    - contextPath: JAMF.TotalRam
      description: Total RAM (MB)
    - contextPath: JAMF.Storage.Size
      description: Size of storage device (MB)
    - contextPath: JAMF.Storage.FilevaultStatus
      description: FileVault Status of storage device
    - contextPath: JAMF.Storage.Filevault2Status
      description: Filevault2 Status of storage device
    description: Display a subset of hardware information for a computer
  - name: jamf-erase-device
    arguments:
    - name: id
      required: true
      description: Lookup by ID
    - name: passcode
      required: true
      description: 6 digit passcode you that must be presented upon unlocking the
        device
    description: Send Erase command to device. Erases all content on the specified
      device
    execution: true
  runonce: false
hidden: false
releaseNotes: 'Converted integration to Python, added jamf-erase-device and jamf-get-computer-hardware command'
