commonfields:
  id: okta
  version: -1
name: okta
display: okta
category: Authentication
image: data:image/png;base64,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
description: Integration with Okta's cloud-based identity management service
detaileddescription: |-
  To get an API token go to the following URL:
  http://developer.okta.com/docs/api/getting_started/getting_a_token.html
configuration:
- display: okta URL https://<domain.okta.com>
  name: url
  defaultvalue: ""
  type: 0
  required: true
- display: API Token
  name: apitoken
  defaultvalue: ""
  type: 4
  required: true
script:
  script: |-
    var profileArgs = [
        'firstName',
        'lastName',
        'email',
        'login',
        'secondEmail',
        'middleName',
        'honorificPrefix',
        'honorificSuffix',
        'title',
        'displayName',
        'nickName',
        'profileUrl',
        'primaryPhone',
        'mobilePhone',
        'streetAddress',
        'city',
        'state',
        'zipCode',
        'countryCode',
        'postalAddress',
        'preferredLanguage',
        'locale',
        'timezone',
        'userType',
        'employeeNumber',
        'costCenter',
        'organization',
        'division',
        'department',
        'managerId',
        'manager'
    ];

    var fixUrl = function(base) {
        res = base;
        if (base && base[base.length - 1] != '/') {
            res = res + '/';
        }
        return res;
    };

    var parseResponse = function(resp) {
        if (resp.StatusCode === 200) {
            try {
                return JSON.parse(resp.Body);
            } catch (e) {
                return resp.Body;
            }
        } else {
          err = resp.Status;
          if (resp.Body) {
              err += '\n' + resp.Body;
          }
          throw err;
        }
    };

    var getRaw = function(args, params, uri) {
        url = fixUrl(params.url);
        url = url + uri;
         res = http(
            url,
            {
                Method: 'GET',
                Headers: {
                    Authorization: ['SSWS ' + params.apitoken]
                }
            },
            true
        );
        return res;
    };

    var post = function(args, params, uri, body) {
        url = fixUrl(params.url);
        url = url + uri;
        readyBody = null;
        if (body) {
            readyBody = JSON.stringify(body);
        }
        res = http(
            url,
            {
                Method: 'POST',
                Headers: {
                    Authorization: ['SSWS ' + params.apitoken],
                    Accept: ['application/json'],
                    'Content-Type': ['application/json']
                },
                Body: readyBody
            },
            true
        );
        return parseResponse(res);
    };


    var get = function(args, params, uri) {
        raw = getRaw(args, params, uri);
        res =  parseResponse(raw);
        if (res && res.length && res.length > 1 ) {
            return { result: res };
        } else if (res && res.length === 0) {
            return {};
        }else {
            return res;
        }
    };

    var getUserId = function(args, params) {
        username = args.username;
        uri = '/api/v1/users?filter=profile.login+eq+"'+encodeURIComponent(username)+'"';
        res = get(args, params, uri);
        if (res && res.length && res.length == 1) {
            return res[0].id;
        } else {
            throw 'Unable to find userId ' + username + '\n' + JSON.stringify(res);
        }
    };

    var buildProfile = function(args) {
        var profile = {};
        var keys = Object.keys(args);
        for (var i = 0 ; i < profileArgs.length; i++) {
            if (args[profileArgs[i]]) {
                profile[profileArgs[i]] = args[profileArgs[i]];
            }
        }
        return profile;
    };

    var buildCredentials = function(args) {
      var creds = {};
      if (args.password) {
          var  pswd = { value: args.password };
          creds.password = pswd;
      }
      if (args.passwordQuestion || args.passwordAnswer) {
          var recovery = {
              question: args.passwordQuestion,
              answer: args.passwordAnswer
          };
          creds.recovery_question = recovery;
      }
      if (args.providerName || args.providerType) {
          var provider = {
              name: args.providerName,
              type: args.providerType
          };
          creds.provider = provider;
      }
      return creds;
    };

    var identLevel = function(count) {
        var ret='';
        for (var i=0;i<count;i++) {
            ret += '     ';
        }
        return ret;
    };

    var flattenValue = function(value,level) {
        if (!level) {
            level=0;
        }
        if (!value || value == '') {
            return '<br>';
        } else if (typeof value == 'string') {
            return value + '<br>';
        } else {
            var ret = (level>0) ? identLevel(level-1) + '{ <br>' : '';
            for (key in value) {
                ret += identLevel(level) + key + ': ' + flattenValue(value[key],level+1);
            }
            return (level>0) ? ret + identLevel(level-1) + '}<br>' : ret;
        }

    };

    var profileToMd = function (profile) {
        var head = '|';
        var line = '|';
        var data = '|';

        for (var key in profile) {
            head += key + '|';
            line += '-|';
            data += profile[key] + '|';
        }
        return head + '\n' + line + '\n' + data + '\n';
    };

    var usersToMd = function (users, verbose) {
        var md='';

        if (!Array.isArray(users)) {
            users = [users] ;
        }

        if (verbose=='true') {
            for (var i=0;i<users.length;i++) {
                var user=users[i];
                md += '### User: ' + user.profile.login +'\n';
                md += '#### Profile:\n';
                md += profileToMd(user.profile);
                md += '#### Additional data:\n';
                md += 'Key|Value\n-|-\n';
                for (var key in user) {
                    if (key != 'profile') {
                        md += key+'|'+flattenValue(user[key]) + '\n';
                    }
                }
            }
        } else {
            md += 'ID|Login|First Name|Last Name|Mobile Phone|Last Login|Status\n-|-|-|-|-|-|-\n';
            for (var i=0;i<users.length;i++) {
                var user=users[i];
                md += user.id + '|';
                md += user.profile.login + '|';
                md += user.profile.firstName+'|';
                md += user.profile.lastName+'|';
                md += user.profile.mobilePhone+'|';
                md += user.lastLogin+'|';
                md += user.status+'\n';
            }
        }
        return md;
    };

    var usersToEc = function(users) {

        var ec={};
        ec.Account = [];
        if (!Array.isArray(users)) {
            users = [users] ;
        }
        for (var i=0;i<users.length;i++) {
            var user=users[i];
            var ecItem={id:user.id,Type:'Okta'};
            if (user.profile.firstName || user.profile.lastName) {
                var displayName='';
                displayName += (user.profile.firstName)? user.profile.firstName + ' ' : '';
                displayName += (user.profile.lastName)? user.profile.lastName : '';
                ecItem.DisplayName = displayName.trim();
            }
            if (user.profile.email) {
                ecItem.Email = user.profile.email;
            }
            if (user.profile.login) {
                ecItem.Username = user.profile.login;
            }
            if (user.objectClass) {
                ecItem.Groups = user.objectClass;
            }
            ec.Account.push(ecItem);
        }
        return ec;
    };

    // The command input arg holds the command sent from the user.
    switch (command) {
        // This is the call made when pressing the integration test button.
        case 'test-module':
            var resp = getRaw(args, params, 'api/v1/users?limit=1');
            if (resp.StatusCode === 200) {
                return 'ok';
            } else if (resp.Status) {
                return resp.Status;
            } else {
                return resp;
            }
            break;
        case 'okta-deactivate-user':
            var userId = getUserId(args, params);
            var res = post(args, params, 'api/v1/users/' + userId + '/lifecycle/deactivate');
            var md = "### Okta user deactivated: " + args.username + '\n';
            md += 'User ID: ' + userId + '\n';
            return {Type: entryTypes.note, Contents: res, ContentsFormat: formats.json, HumanReadable: md};
        case 'okta-activate-user':
            var userId = getUserId(args, params);
            var res = post(args, params, 'api/v1/users/' + userId + '/lifecycle/activate');
            var md = "### Okta user activated: " + args.username + '\n';
            md += 'User ID: ' + userId + '\n';
            return {Type: entryTypes.note, Contents: res, ContentsFormat: formats.json, HumanReadable: md};
        case 'okta-get-groups':
            var userId = getUserId(args, params);
            var res = get(args, params, 'api/v1/users/' + userId + '/groups');
            var md = "### Okta groups for user " + args.username + '\n';
            md += 'User ID: ' + userId + '\n';
            md += '#### Groups:\n';
            md += res[0].objectClass + '\n';
            md += '#### Profiles:\n';
            md += objToMd(res[0].profile) + '\n';
            var ec = usersToEc(res);
            return {Type: entryTypes.note, entryContext: ec, Contents: res, ContentsFormat: formats.json, HumanReadable: md};
        case 'okta-set-password':
            var userId = getUserId(args, params);
            var body = {
                "credentials": {
                    "password" : { "value": args.password }
                }
            };
            res = post(args, params, 'api/v1/users/' + userId, body);
            var md = "### Okta user password set: " + args.username + '\n';
            md += 'User ID: ' + userId + '\n';
            return {Type: entryTypes.note, Contents: res, ContentsFormat: formats.json, HumanReadable: md};
        case 'okta-search':
            var limit = 200;
            if (args.limit) {
                limit = args.limit;
            }
            var term = args.term;
            if (term) {
                term = encodeURIComponent(term);
            }
            res = get(args, params, 'api/v1/users?q=' + term + '&limit=' + limit);
            if (res && res.result && res.result.length>0) {
                var md = '### Okta users found:\n';
                md += usersToMd(res.result,args.verbose);
                var ec = usersToEc(res.result);
            } else {
                var md = '### No users found in Okta\n';
            }
            return {Type: entryTypes.note, EntryContext: ec, Contents: res, ContentsFormat: formats.json, HumanReadable: md};
        case 'okta-get-user':
            var term = args.username;
            if (term) {
                term = encodeURIComponent(term);
            } else {
                term = args.userid;
                if (!term) {
                    throw "You must supply either 'username' or 'userid'"
                }
            }
            var res = get(args, params, 'api/v1/users/' + term);

            var md = '### Okta user:\n';
            md += usersToMd(res,args.verbose);
            var ec = usersToEc(res);
            return {Type: entryTypes.note, EntryContext: ec, Contents: res, ContentsFormat: formats.json, HumanReadable: md};
        case 'okta-create-user':
            var cred = buildCredentials(args);
            var profile = buildProfile(args);
            var groupIds = args.groupIds;
            if (groupIds) {
                groupIds = groupIds.split(',');
            }
            var body = {
                profile: profile,
                groupIds: groupIds,
                credentials: cred
            };
            var activate = false;
            if (args.activate) {
                activate = args.activate.toLowerCase() === 'true';
            }
            var uri = '/api/v1/users?activate=' + activate;
            if (cred && cred.provider) {
                uri += '&provider=true';
            }
            var res = post(args, params, uri, body);

            var md = "### Okta user created: " + args.login + '\n';
            md += profileToMd(res.profile);
            var ec = usersToEc(res);
            return {Type: entryTypes.note, EntryContext: ec, Contents: res, ContentsFormat: formats.json, HumanReadable: md};
        case 'okta-update-user':
            var userId = getUserId(args, params);
            var cred = buildCredentials(args);
            var profile = buildProfile(args);
            profile.login = args.username;
            var body = {
                profile: profile,
                credentials: cred
            };
            var uri = '/api/v1/users/' + userId;
            var res = post(args, params, uri, body);
            var md = "### Okta user updated: " + args.username + '\n';
            md += 'User ID: ' + userId + '\n';
            md += profileToMd(res.profile);
            return {Type: entryTypes.note, Contents: res, ContentsFormat: formats.json, HumanReadable: md};
    }
  type: javascript
  commands:
  - name: okta-deactivate-user
    arguments:
    - name: username
      required: true
      default: true
      description: Username in Okta to deactivate
    description: 'Deactivate user '
    execution: true
  - name: okta-activate-user
    arguments:
    - name: username
      required: true
      default: true
      description: Username in Okta to activate
    description: Activate user
    execution: true
  - name: okta-get-groups
    arguments:
    - name: username
      required: true
      default: true
      description: Username in Okta to get groups for
    outputs:
    - contextPath: Account.Groups
      description: Okta groups the account is associated with
    - contextPath: Account.ID
      description: Okta account ID
    - contextPath: Account.Type
      description: Account type - Okta
    description: Get all user groups
  - name: okta-set-password
    arguments:
    - name: username
      required: true
      default: true
      description: Username in Okta to get groups for
    - name: password
      required: true
      description: The new password to set for the user
    description: Set a new password for user
    execution: true
  - name: okta-search
    arguments:
    - name: term
      required: true
      default: true
      description: Term to search for, this term can be first name, last name or email
    - name: limit
      description: Max number of results to return (defaults to 200)
    - name: verbose
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Print all details of users that match search term
    outputs:
    - contextPath: Account.ID
      description: Okta account IDs returned by search
    - contextPath: Account.Username
      description: Okta account usernames returned by search
    - contextPath: Account.Email
      description: Okta account emails returned by search
    - contextPath: Accout.DisplayName
      description: Okta account display names returned by search
    - contextPath: Account.Type
      description: Account type returned by search - Okta
    description: Search for Okta users
  - name: okta-get-user
    arguments:
    - name: username
      description: Username of requested user, please note that this will not work
        for usernames that contains a '/' character
    - name: userid
      description: User ID of requested user
    - name: verbose
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Print all details of user
    outputs:
    - contextPath: Account.ID
      description: Okta account ID
    - contextPath: Account.Email
      description: Okta account email
    - contextPath: Account.Username
      description: Okta account username
    - contextPath: Account.DisplayName
      description: Okta account display name
    - contextPath: Account.Type
      description: Account type - Okta
    description: Fetches a specific user when you know the user’s login, please note
      that one of the parameters bellow is mandatory.
  - name: okta-create-user
    arguments:
    - name: firstName
      required: true
      description: Given name of the user (givenName)
    - name: lastName
      required: true
      description: Family name of the user (familyName)
    - name: email
      description: primary email address of user
    - name: login
      required: true
      description: Unique identifier for the user (username)
    - name: secondEmail
      description: Secondary email address of user typically used for account recovery
    - name: middleName
      description: "Middle name(s) of the user\t"
    - name: honorificPrefix
      description: Honorific prefix(es) of the user, or title in most Western languages
    - name: honorificSuffix
      description: honorific suffix(es) of the user
    - name: title
      description: User’s title, such as “Vice President”
    - name: displayName
      description: Name of the user, suitable for display to end-users
    - name: nickName
      description: Casual way to address the user in real life
    - name: profileUrl
      description: Url of user’s online profile (e.g. a web page)
    - name: primaryPhone
      description: "Primary phone number of user such as home number\t"
    - name: mobilePhone
      description: mobile phone number of user
    - name: streetAddress
      description: Full street address component of user’s address
    - name: city
      description: City or locality component of user’s address (locality)
    - name: state
      description: State or region component of user’s address (region)
    - name: zipCode
      description: Zipcode or postal code component of user’s address (postalCode)
    - name: countryCode
      description: Country name component of user’s address (country)
    - name: postalAddress
      description: Mailing address component of user’s address
    - name: preferredLanguage
      description: User’s preferred written or spoken languages
    - name: locale
      description: User’s default location for purposes of localizing items such as
        currency, date time format, numerical representations, etc.
    - name: timezone
      description: User’s time zone
    - name: userType
      description: Used to identify the organization to user relationship such as
        “Employee” or “Contractor”
    - name: employeeNumber
      description: Organization or company assigned unique identifier for the user
    - name: costCenter
      description: name of a cost center assigned to
    - name: organization
      description: Name of user’s organization
    - name: division
      description: Name of user’s division
    - name: department
      description: Name of user’s department
    - name: managerId
      description: ID of a user’s manager
    - name: manager
      description: DisplayName of the user’s manager
    - name: password
      description: Password for new user
    - name: passwordQuestion
      description: Password question for new user
    - name: passwordAnswer
      description: Password answer for question supplied
    - name: providerType
      auto: PREDEFINED
      predefined:
      - OKTA
      - ACTIVE_DIRECTORY
      - LDAP
      - FEDERATION
      - SOCIAL
      description: OKTA, ACTIVE_DIRECTORY,LDAP, FEDERATION, or SOCIAL
    - name: providerName
      description: Name of provider
    - name: groupIds
      description: Ids of groups that user will be immediately added to at time of
        creation (Do not include default group)
    - name: activate
      description: Executes activation lifecycle operation when creating the user
    outputs:
    - contextPath: Account.ID
      description: Created okta account ID
    - contextPath: Account.Email
      description: Created okta account email
    - contextPath: Account.Username
      description: Created okta account username
    - contextPath: Account.DisplayName
      description: Created okta account display name
    - contextPath: Account.Type
      description: Type of create account - Okta
    description: Creates a new user with an option of setting password, recovery question
      & answer. The new user will immediately be able to login after activation with
      the assigned password. This flow is common when developing a custom user registration
      experience.
    execution: true
  - name: okta-update-user
    arguments:
    - name: firstName
      description: Given name of the user (givenName)
    - name: lastName
      description: Family name of the user (familyName)
    - name: email
      description: primary email address of user
    - name: username
      required: true
      description: Unique identifier for the user (login)
    - name: secondEmail
      description: Secondary email address of user typically used for account recovery
    - name: middleName
      description: "Middle name(s) of the user\t"
    - name: honorificPrefix
      description: Honorific prefix(es) of the user, or title in most Western languages
    - name: honorificSuffix
      description: honorific suffix(es) of the user
    - name: title
      description: User’s title, such as “Vice President”
    - name: displayName
      description: Name of the user, suitable for display to end-users
    - name: nickName
      description: Casual way to address the user in real life
    - name: profileUrl
      description: Url of user’s online profile (e.g. a web page)
    - name: primaryPhone
      description: "Primary phone number of user such as home number\t"
    - name: mobilePhone
      description: mobile phone number of user
    - name: streetAddress
      description: Full street address component of user’s address
    - name: city
      description: City or locality component of user’s address (locality)
    - name: state
      description: State or region component of user’s address (region)
    - name: zipCode
      description: Zipcode or postal code component of user’s address (postalCode)
    - name: countryCode
      description: Country name component of user’s address (country)
    - name: postalAddress
      description: Mailing address component of user’s address
    - name: "preferredLanguage\t"
      description: User’s preferred written or spoken languages
    - name: locale
      description: User’s default location for purposes of localizing items such as
        currency, date time format, numerical representations, etc.
    - name: "timezone\t"
      description: User’s time zone
    - name: userType
      description: Used to identify the organization to user relationship such as
        “Employee” or “Contractor”
    - name: employeeNumber
      description: Organization or company assigned unique identifier for the user
    - name: costCenter
      description: name of a cost center assigned to
    - name: organization
      description: Name of user’s organization
    - name: division
      description: Name of user’s division
    - name: department
      description: Name of user’s department
    - name: managerId
      description: ID of a user’s manager
    - name: manager
      description: DisplayName of the user’s manager
    - name: password
      description: Password for new user
    - name: passwordQuestion
      description: Password question for new user
    - name: passwordAnswer
      description: Password answer for question supplied
    - name: providerType
      auto: PREDEFINED
      predefined:
      - OKTA
      - ACTIVE_DIRECTORY
      - LDAP
      - FEDERATION
      - SOCIAL
      description: OKTA, ACTIVE_DIRECTORY,LDAP, FEDERATION, or SOCIAL
    - name: providerName
      description: Name of provider
    description: Update user with a given login, all fields are optional, fields which
      are not set will not be overriden
    execution: true
hidden: false
