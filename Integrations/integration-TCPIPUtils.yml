commonfields:
  id: TCPIPUtils
  version: -1
name: TCPIPUtils
display: TCPIPUtils
category: Data Enrichment
image: data:image/png;base64,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
description: Use the TCPIPUtils.com API to get data about an IP address
configuration:
- display: TCPIPUtils.com API key
  name: apiKey
  defaultvalue: ""
  type: 4
  required: true
script:
  script: |-
    import urllib2, json

    API_KEY = demisto.params()["apiKey"]

    IP2ASN_API_URL = "https://www.utlsapi.com/api.php?type=ip2asn&q=%s&version=1.0&apikey=" + API_KEY
    IPV4_INFO_API_URL = "https://www.utlsapi.com/api.php?type=ipv4info&q=%s&version=1.1&apikey=" + API_KEY

    # The command demisto.command() holds the command sent from the user.
    if demisto.command() == 'test-module':
        query = IP2ASN_API_URL % "8.8.8.8"
        response = json.loads(urllib2.urlopen(query).read())
        if response['status'] == "succeed":
            demisto.results('ok')
        sys.exit(0)
    if demisto.command() == 'ip':
        ec = {}
        def parse_whois_data(whois_lines):
            result = {}
            for line in whois_lines:
                if line.startswith("#"):
                    continue
                key_value = line.split(":")
                if len(key_value) == 2:
                    key, value = key_value[0], key_value[1]
                    result[key.strip()] = value.strip()
            return result

        query = IPV4_INFO_API_URL % demisto.args()["ip"]
        response = urllib2.urlopen(query)
        data = json.loads(response.read())["data"]
        ip_address = data["question"]
        ip_data = {
            "Address": ip_address,
            "ASN": "AS" + str(data["asinfo"]["asn"]),
            "Geo": {
                "Country": data["geoinfo"]["country_name"],
                "Description": data["geoinfo"]["capital"]
            },
            "WHOIS": parse_whois_data(data["whois"]["whois"])
        }
        ec[outputPaths["ip"]] = [];
        ec[outputPaths["ip"]].append(ip_data)
        hm = {
            "Address": ip_address,
            "ASN": ip_data["ASN"],
            "Country": ip_data["Geo"]["Country"],
            "City": ip_data["Geo"]["Description"]
        }

        if ip_data["WHOIS"].has_key("Organization"):
            hm['Organization'] = ip_data["WHOIS"]['Organization']
        if ip_data["WHOIS"].has_key("NetRange"):
            hm['NetRange'] = ip_data["WHOIS"]['NetRange']

        demisto.results({"Type": 1, "Contents": data, "ContentsFormat": "json", "EntryContext": ec,
        "HumanReadable": tableToMarkdown("TCPIPUtils Info for " + ip_address, [hm], "")})

        sys.exit(0)

    # You can use demisto.args()[argName] to get a specific arg. args are strings.
    # You can use demisto.params()[paramName] to get a specific params.
    # Params are of the type given in the integration page creation.
  type: python
  commands:
  - name: ip
    arguments:
    - name: ip
      required: true
      description: IP address to query. E.g. !ip 1.1.1.1
    outputs:
    - contextPath: IP.Address
      description: The IP address
    - contextPath: IP.ASN
      description: The IP ASN'
    - contextPath: IP.Geo.Country
      description: The IP country
    - contextPath: IP.Geo.Description
      description: The IP city
    description: Get information about IP (ASN, WHOIS, country, city). When information
      is available, returns a JSON with details)
