commonfields:
  id: Jask
  version: -1
name: Jask
display: Jask
category: Analytics & SIEM
image: data:image/png;base64,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
description: Freeing the analyst with autonomous decisions
detaileddescription: |-
  You can retrieve your personal API key from the following URL under the "Profile" tab:
  https://[CUSTOMER].portal.jask.ai/config
configuration:
- display: ""
  name: URL
  defaultvalue: ""
  type: 0
  required: true
- display: ""
  name: Username
  defaultvalue: ""
  type: 0
  required: true
- display: ""
  name: APIKey
  defaultvalue: ""
  type: 4
  required: true
- display: Fetch incidents
  name: isFetch
  defaultvalue: ""
  type: 8
  required: false
- display: Incident type
  name: incidentType
  defaultvalue: ""
  type: 13
  required: false
- display: Use system proxy settings
  name: proxy
  defaultvalue: "true"
  type: 8
  required: false
- display: Override default fetch query
  name: fetchQuery
  defaultvalue: ""
  type: 0
  required: false
script:
  script: |
    import requests
    import json
    from datetime import datetime

    if not demisto.getParam('proxy'):
        del os.environ['HTTP_PROXY']
        del os.environ['HTTPS_PROXY']
        del os.environ['http_proxy']
        del os.environ['https_proxy']

    URL = demisto.getParam('URL')
    if URL[-1] != '/':
        URL += '/'
    QUERY = {'username': demisto.getParam('Username'), 'api_key': demisto.getParam('APIKey')}


    def return_error(data):
        """
        Return error as result and exit
        """
        demisto.results({
            'Type': entryTypes['error'],
            'ContentsFormat': formats['text'],
            'Contents': data
        })
        sys.exit(0)


    def req(method, path, query):
        """
        Send the request to JASK and return the JSON response
        """
        r = requests.request(method, URL + path, params=query)
        if r.status_code != requests.codes.ok:
            return_error('Error in API call to Jask service - %s' % (r.text))
        if not r.text:
            return {}
        return r.json()


    def to_readable(o, fields, translated):
        """
        Convert object properties to nice title readable
        """
        res = {}
        for f in fields:
            if o.get(f):
                if translated.get(f):
                    res[translated.get(f)] = o.get(f)
                else:
                    res[f.title().replace('_', '')] = o.get(f)
        return res


    def entity_to_readable(entityJSON):
        """
        Convert entity response JSON to nicely formatted object
        """
        entity = to_readable(entityJSON, ['id', 'name', 'source', 'hostname', 'risk_score', 'is_whitelisted', 'groups', 'asset_type', 'firstSeen', 'lastSeen'],
            {'asset_type': 'EntityType', 'firstSeen': 'FirstSeen', 'lastSeen': 'LastSeen'})
        entity['PrimaryEntityType'] = demisto.get(entityJSON, 'current_entity.primary_asset_type')
        return entity


    def signal_to_readable(signalJSON):
        """
        Convert signal response JSON to nicely formatted object
        """
        signal = to_readable(signalJSON, ['id', 'name', 'category', 'description', 'score', 'source_type', 'timestamp'], {})
        if demisto.get(signalJSON, 'threat_indicators'):
            signal['ThreatIndicators'] = [{
                'IndicatorType': ti.get('indicator_type'),
                'Value': ti.get('value')
            } for ti in signalJSON.get('threat_indicators')]
        return signal


    def insight_to_readable(insightJSON):
        """
        Convert insight response JSON to nicely formatted object
        """
        insight = to_readable(insightJSON, ['id', 'name', 'action', 'assigned_to', 'description', 'last_updated_by', 'last_updated', 'severity', 'workflow_status'], {})
        if insightJSON.get('record_start_time'):
            insight['InsightTime'] = datetime.utcfromtimestamp(insightJSON.get('record_start_time')).isoformat()
        if demisto.get(insightJSON, 'ip') and demisto.get(insightJSON['ip'], 'address'):
            insight['IpAddress'] = demisto.get(insightJSON['ip'], 'address')
        return insight


    def convert_string_date_to_unix(dstr):
        """
        Convert a given string with MM/DD/YYYY format to millis since epoch
        """
        d = datetime.strptime(dstr, '%m/%d/%Y')
        return int((d - datetime.utcfromtimestamp(0)).total_seconds() * 1000)


    def get_insight_details():
        """
        Get insight details
        """
        alert_id = demisto.getArg('insight-id')
        resp_json = req('GET', 'alert/' + alert_id, QUERY)
        ec = insight_to_readable(resp_json)

        details_md = tableToMarkdown('Insight Details:', [ec], ['Id', 'Name','Action','AssignedTo','Description','IpAddress','LastUpdated','LastUpdatedBy','Severity','InsightTime','WorkflowStatus'])

        entity_display = entity_to_readable(resp_json.get('asset_details'))
        entity_display.update({'IpAddress': demisto.get(resp_json['asset_details']['ip'], 'address')})
        ec['EntityDetails'] = entity_display
        entity_display['Id'] = resp_json.get('id')

        entity_markdown = tableToMarkdown('Insight\'s Main Entity Details:', [entity_display], ['Id', 'EntityType', 'Hostname', 'Groups', 'FirstSeen', 'LastSeen', 'IpAddress', 'IsWhitelisted', 'RiskScore', 'Source'])

        related_assets_json = resp_json.get('related_assets') or []
        results_assets_list = []
        for rel_asset in related_assets_json:
            results_asset = to_readable(rel_asset, ['id', 'is_whitelisted', 'risk_score', 'source', 'asset_type'], {'asset_type': 'EntityType'})
            if rel_asset.get('asset_type') == 'hostname':
                results_asset['Name'] = rel_asset.get('hostname')
            elif rel_asset.get('asset_type') == 'username':
                results_asset['Name'] = rel_asset.get('username')

            if demisto.get(rel_asset, 'ip.address'):
                results_asset['IpAddress'] = demisto.get(rel_asset, 'ip.address')

            results_assets_list.append(results_asset)
        ec['RelatedEntityList'] = results_assets_list
        rel_assets_md = tableToMarkdown('Related Entities:', results_assets_list, ['Id', 'EntityType', 'IpAddress', 'Name', 'IsWhitelisted', 'RiskScore', 'Source'])

        signal_list_json = resp_json.get('signals') or []
        signal_list = []
        threat_intel = 0
        anomalies = 0
        patterns = 0
        for signal_item in signal_list_json:
            result_signal = signal_to_readable(signal_item)
            if result_signal['SourceType'] == 'threatintel':
                threat_intel += 1
            elif result_signal['SourceType'] == 'rule':
                patterns += 1
            elif result_signal['SourceType'] == 'anomaly':
                anomalies += 1
            signal_list.append(result_signal)
        ec['SignalList'] = signal_list
        signals_md = tableToMarkdown('Related Signals:', signal_list, ['Id', 'Name', 'Description', 'Category', 'SourceType'])
        ec['SignalListMetadata'] = {
            'Patterns': {
                'Count': patterns
            },
            'Anomalies': {
                'Count': anomalies
            },
            'ThreatIntel': {
                'Count': threat_intel
            }
        }
        final_ec = {'Jask.Insight(val.Id === obj.Id)': ec}
        signal_metadata_md = tableToMarkdown('Signal Metadata:', [{'Pattern Count': patterns, 'Anomaly Count': anomalies, 'Threat Intel Count': threat_intel}], ['Pattern Count', 'Anomaly Count', 'Threat Intel Count'])
        combined_md = details_md + '\n\n' + entity_markdown + '\n\n' + rel_assets_md + '\n\n' + signals_md + '\n\n' + signal_metadata_md
        link = URL.replace('/api/', '/insight/') + alert_id
        md_link = "[" + link + "](" + link + ")"
        combined_md += '\n\n' + md_link
        demisto.results({
            'Type': entryTypes['note'],
            'EntryContext': final_ec,
            'HumanReadable': combined_md,
            'Contents': resp_json,
            'ContentsFormat': formats['json']
        })


    def get_insight_comments():
        """
        Get comments for insight
        """
        alert_id = demisto.getArg('insight-id')
        resp_json = req('GET', 'alert/%s/comments' % alert_id, QUERY)
        comments = [to_readable(comment, ['id', 'alert_id', 'author', 'body', 'last_updated', 'timestamp'], {'alert_id': 'InsightId'}) for comment in resp_json['objects']]
        ec = {'Jask.Insight(val.Id == "%s").CommentList': comments}
        md = tableToMarkdown('Insight Comments:', comments, ['Id', 'InsightId', 'Author', 'Body', 'LastUpdated', 'Timestamp'])
        demisto.results({
            'Type': entryTypes['note'],
            'EntryContext': ec,
            'HumanReadable': md,
            'Contents': resp_json,
            'ContentsFormat': formats['json']
        })


    def get_signal_details():
        """
        Get signal details
        """
        alert_id = demisto.getArg('signal-id')
        resp_json = req('GET', 'signal/' + alert_id, QUERY)
        signal = signal_to_readable(resp_json)
        md = tableToMarkdown('Insight Signal Details:', [signal], ['Id', 'Name', 'Category', 'Description', 'Score', 'SourceType', 'Timestamp'])

        flow = 0
        notice = 0
        http = 0
        if resp_json.get('extra_records'):
            for record in resp_json.get('extra_records'):
                if record.get('type') == 'http':
                    http += 1
                elif record.get('type') == 'flow':
                    flow += 1
                elif record.get('type') == 'notice':
                    notice += 1
        record_types = [{'RecordType' : 'flow', 'RecordCount': flow}, {'RecordType': 'notice', 'RecordCount': notice}, {'RecordType': 'http', 'RecordCount': http}]
        if signal.get('ThreatIndicators'):
            md = md + tableToMarkdown('Threat Indicators', signal.get('ThreatIndicators'), ['IndicatorType', 'Value'])
        md = md + tableToMarkdown('Record Metadata', {'Flow Count': flow, 'Notice Count': notice, 'Http Count': http}, ['Flow Count', 'Notice Count', 'Http Count'])
        signal['Metadata'] = record_types
        ec = {'Jask.Signal(val.Id === obj.Id)': signal}
        demisto.results({
            'Type': entryTypes['note'],
            'EntryContext': ec,
            'HumanReadable': md,
            'Contents': resp_json,
            'ContentsFormat': formats['json']
        })


    def get_entity_details():
        """
        Get entity details
        """
        entity_id = demisto.getArg('entity-id')
        resp_json = req('GET', 'asset/' + entity_id, QUERY)
        entity = entity_to_readable(resp_json)
        md = tableToMarkdown('Entity Details:', [entity], ['Id', 'Name', 'FirstSeen', 'LastSeen', 'Source', 'EntityType', 'PrimaryEntityType', 'Hostname', 'RiskScore', 'IsWhitelisted', 'Groups'])
        demisto.results({
            'Type': entryTypes['note'],
            'EntryContext': {'Jask.Entity': entity},
            'HumanReadable': md,
            'Contents': resp_json,
            'ContentsFormat': formats['json']
        })


    def get_related_entities():
        """
        Get related entities
        """
        resultsList = []
        entity_id = demisto.getArg('entity-id')
        resp_json = req('GET', 'asset/%s/related_assets' % entity_id, QUERY)
        entities = [to_readable(e, [
            'id', 'name', 'email', 'source', 'username', 'hostname', 'active', 'admin', 'asset_type',
            'created_ts', 'firstSeen', 'given_name', 'is_whitelisted', 'lastSeen', 'last_name', 'risk_score', 'groups'], {
                'asset_type': 'EntityType', 'created_ts': 'CreatedTimestamp', 'firstSeen': 'FirstSeen', 'lastSeen': 'LastSeen'
            }) for e in resp_json['objects']]

        ec = {'Jask.RelatedEntityList(val.Id === obj.Id)': entities}
        md = tableToMarkdown('Related Entities:', entities, ['Id', 'Name', 'EntityType', 'FirstSeen', 'LastSeen', 'Source',
            'Hostname', 'Username', 'GivenName', 'Email', 'RiskScore', 'IsWhitelisted', 'Groups','CreatedTimestamp','Admin'])
        demisto.results({
            'Type': entryTypes['note'],
            'EntryContext': ec,
            'HumanReadable': md,
            'Contents': resp_json,
            'ContentsFormat': formats['json']
        })


    def get_whitelisted_entities():
        """
        Get whitelisted entities
        """
        resp_json = req('GET', 'asset/whitelisted', QUERY)
        items = []
        for whitelisted_item in resp_json.get('objects'):
            w = to_readable(whitelisted_item, ['id', 'name'], {})
            w['ModelId'] = demisto.get(whitelisted_item, 'history.model_id')
            w['Timestamp'] = demisto.get(whitelisted_item, 'history.timestamp')
            w['UserName'] = demisto.get(whitelisted_item, 'history.username')
            items.append(w)
        ec = {'Jask.WhiteListed.EntityList(val.Id === obj.Id)': items}
        ec['Jask.WhiteListed.Metadata.TotalCount'] = len(items)
        md = tableToMarkdown('Whitelisted:', items, ['Id', 'Name', 'ModelId', 'Timestamp', 'UserName']) + '\n' + '### Count: ' + str(len(items))
        demisto.results({
            'Type': entryTypes['note'],
            'EntryContext': ec,
            'HumanReadable': md,
            'Contents': resp_json,
            'ContentsFormat': formats['json']
        })


    def convert_date_to_unix(d):
        """
        Convert a given date to seconds
        """
        return int((d - datetime.utcfromtimestamp(0)).total_seconds() * 1000)


    def translate_last_seen(last):
        """
        Convert last-seen argument to querystring
        """
        if not last or last == 'All time':
            return ''
        if last == 'Last week':
            return 'timestamp:[%d TO *]' % (convert_date_to_unix(datetime.utcnow()) - 7 * 24 * 60 * 60 * 1000)
        if last == 'Last 48 hours':
            return 'timestamp:[%d TO *]' % (convert_date_to_unix(datetime.utcnow()) - 2 * 24 * 60 * 60 * 1000)
        if last == 'Last 24 hours':
            return 'timestamp:[%d TO *]' % (convert_date_to_unix(datetime.utcnow()) - 24 * 60 * 60 * 1000)


    def _add_list_to_q(q, translate):
        """
        Add arguments in the translate dictionary to querystring
        """
        for v in translate:
            arg_list = argToList(demisto.getArg(translate[v]))
            if len(arg_list) == 1:
                q += ' AND ' + v + ':(%s)' % (arg_list[0])
            elif len(arg_list) > 1:
                q += ' AND ' + v + ':(%s)' % (' OR '.join(arg_list))
        return q


    def _add_time_to_q(q):
        """
        Add the time filter to the query string
        Defaults to All time if no fields specified
        """
        last_seen = demisto.getArg('last-seen')
        time_from = demisto.getArg('time-from')
        time_to = demisto.getArg('time-to')
        if last_seen:
            if time_from or time_to:
                return_error('You cannot specify absolute times [time-to, time-from] ' +
                    'with relative time [last-seen]')
            else:
                if translate_last_seen(last_seen) != '':
                    q += ' AND ' + translate_last_seen(last_seen)
        elif time_from and time_to:
            q += ' AND timestamp:[%d TO %d]' % (convert_string_date_to_unix(time_from), convert_string_date_to_unix(time_to))
        elif time_from or time_to:
            return_error('You must specify both absolute times [time-to, time-from] ' +
                'or relative time [last-seen]')
        return q


    def search_insights():
        """
        Search insights using available filters
        """
        q = _add_time_to_q('*')
        q = _add_list_to_q(q, {'workflow_status':'status', 'rating': 'rating', 'group_assigned_to': 'assigned_team', 'assigned_to': 'assigned-user'})
        query = QUERY.copy()
        query['q'] = q
        query['offset'] = demisto.getArg('offset')
        query['limit'] = demisto.getArg('limit')
        query['sort_by'] = demisto.getArg('sort')
        resp_json = req('GET', 'search/alerts', query)
        insights = []
        for insight in resp_json['objects']:
            readable_insight = insight_to_readable(insight)
            readable_insight['IpAddress'] = demisto.get(insight, 'asset.ip')
            readable_insight['InsightTime'] = demisto.get(insight, 'timestamp')
            insights.append(readable_insight)
        ec = {'Jask.Insight(val.Id === obj.Id)': insights}
        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['json'],
            'Contents': resp_json,
            'EntryContext': ec,
            'HumanReadable': tableToMarkdown('Insights', insights, ['Id', 'Name', 'Action', 'AssignedTo', 'Description', 'IpAddress', 'LastUpdated', 'LastUpdatedBy', 'Severity', 'InsightTime', 'WorkflowStatus'])
        })


    def search_signals():
        """
        Search signals using available filters
        """
        q = _add_time_to_q('*')
        q = _add_list_to_q(q, {'source_type': 'source', 'category': 'category'})
        query = QUERY.copy()
        query['q'] = q
        query['offset'] = demisto.getArg('offset')
        query['limit'] = demisto.getArg('limit')
        query['sort_by'] = demisto.getArg('sort')
        resp_json = req('GET', 'search/signals', query)
        signals = [signal_to_readable(signal) for signal in resp_json['objects']]
        ec = {'Jask.Signal(val.Id === object.Id)': signals}
        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['json'],
            'Contents': resp_json,
            'EntryContext': ec,
            'HumanReadable': tableToMarkdown('Signals', signals, ['Id', 'Name', 'Category', 'Description', 'Score', 'SourceType', 'Timestamp', 'ThreatIndicators'])
        })


    def search_entities():
        """
        Search entities using the available filters
        """
        q = _add_time_to_q('*')
        q = _add_list_to_q(q, {'asset_type': 'entity-type'})
        query = QUERY.copy()
        query['q'] = q
        query['offset'] = demisto.getArg('offset')
        query['limit'] = demisto.getArg('limit')
        query['sort_by'] = demisto.getArg('sort')
        resp_json = req('GET', 'search/assets', query)
        entities = []
        for entity in resp_json['objects']:
            readable = entity_to_readable(entity)
            readable['IpAddress'] = entity.get('ip')
            entities.append(readable)
        ec = {'Jask.Entity(val.Id === obj.Id)': entities}
        demisto.results({
            'Type': entryTypes['note'],
            'ContentsFormat': formats['json'],
            'Contents': resp_json,
            'EntryContext': ec,
            'HumanReadable': tableToMarkdown('Entities', entities, [
                'Id', 'Name', 'FirstSeen', 'LastSeen', 'Source', 'EntityType', 'PrimaryEntityType', 'Hostname', 'RiskScore', 'IsWhitelisted', 'Groups', 'IpAddress'
            ])
        })


    def translate_severity(severity):
        """
        Translate from Jask insight severity to Demisto severity
        """
        if severity <= 4:
            return severity
        return 4


    def fetch_incidents():
        """
        Retrieve new incidents periodically based on pre-defined instance parameters
        """
        now = convert_date_to_unix(datetime.utcnow())
        last_run_object = demisto.getLastRun()
        if last_run_object and last_run_object.get('time'):
            last_run = last_run_object.get('time')
        else:
            last_run = now - 24 * 60 * 60 * 1000
        q = '* AND timestamp:[%d TO *]' % last_run
        if demisto.getParam('fetchQuery'):
            q += ' AND ' + demisto.getParam('fetchQuery')
        else:
            q += ' AND workflow_status:(new OR inprogress)'
        query = QUERY.copy()
        query['q'] = q
        query['offset'] = 0
        query['limit'] = 100
        query['sort_by'] = 'timestamp:desc'
        resp_json = req('GET', 'search/alerts', query)
        incidents = []
        for a in resp_json['objects']:
            incidents.append({
                'name': a.get('name', 'No name') + ' - ' + a.get('id'),
                'occurred': a.get('timestamp') + 'Z',
                'details': a.get('description'),
                'severity': translate_severity(a.get('severity')),
                'rawJSON': json.dumps(a)
            })
        demisto.incidents(incidents)
        demisto.setLastRun({'time': now})

    if demisto.command() == 'test-module':
        req('GET', 'asset/whitelisted', QUERY)
        demisto.results('ok')
    elif demisto.command() == 'jask-get-insight-details':
        get_insight_details()
    elif demisto.command() == 'jask-get-insight-comments':
        get_insight_comments()
    elif demisto.command() == 'jask-get-signal-details':
        get_signal_details()
    elif demisto.command() == 'jask-get-entity-details':
        get_entity_details()
    elif demisto.command() == 'jask-get-related-entities':
        get_related_entities()
    elif demisto.command() == 'jask-get-whitelisted-entities':
        get_whitelisted_entities()
    elif demisto.command() == 'jask-search-insights':
        search_insights()
    elif demisto.command() == 'jask-search-entities':
        search_entities()
    elif demisto.command() == 'jask-search-signals':
        search_signals()
    elif demisto.command() == 'fetch-incidents':
        fetch_incidents()
    else:
        return_error('Unrecognized command: ' + demisto.command())
  type: python
  commands:
  - name: jask-get-insight-details
    arguments:
    - name: insight-id
      required: true
      default: true
      description: The insight to retrieve details for
    outputs:
    - contextPath: Jask.Insight.Id
      description: The insight ID
      type: string
    - contextPath: Jask.Insight.Name
      description: The insight name
      type: string
    - contextPath: Jask.Insight.Action
      description: The insight action
      type: string
    - contextPath: Jask.Insight.Entity
      description: The main entity related to the insight
      type: string
    - contextPath: Jask.Insight.AssignedTo
      description: Who the insight was assigned to
      type: string
    - contextPath: Jask.Insight.Description
      description: The insight description
      type: string
    - contextPath: Jask.Insight.IpAddress
      description: The IP address of the insight
      type: string
    - contextPath: Jask.Insight.LastUpdated
      description: The time the insight was last updated
      type: date
    - contextPath: Jask.Insight.LastUpdatedBy
      description: The last person to update the insight
      type: string
    - contextPath: Jask.Insight.Severity
      description: 'The severity of the insight '
      type: number
    - contextPath: Jask.Insight.InsightTime
      description: The time of the insight
      type: date
    - contextPath: Jask.Insight.WorkflowStatus
      description: The status of the insight
      type: string
    - contextPath: Jask.Insight.RelatedEntityList.Id
      description: The ID of the related entity
      type: string
    - contextPath: Jask.Insight.RelatedEntityList.EntityType
      description: The type of the related entity
      type: string
    - contextPath: Jask.Insight.RelatedEntityList.Hostname
      description: The hostname of the related entity
      type: string
    - contextPath: Jask.Insight.SignalList.Id
      description: The ID of the signal
      type: string
    - contextPath: Jask.Insight.SignalList.Name
      description: The name of the signal
      type: string
    - contextPath: Jask.Insight.SignalList.Category
      description: The category of the signal
      type: string
    - contextPath: Jask.Insight.SignalList.SourceType
      description: The source of the signal
      type: string
    - contextPath: Jask.Insight.SignalListMetadata.Patterns.Count
      description: The number of signals of the category pattern
      type: number
    - contextPath: Jask.Insight.SignalListMetadata.Anomalies.Count
      description: The number of signals of the category anomaly
      type: number
    - contextPath: Jask.Insight.SignalListMetadata.ThreatIntel.Count
      description: The number of signals of the category threat intelligence
      type: number
    - contextPath: Jask.Insight.RelatedEntityList.IpAddress
      description: IP address of related entity
      type: string
    - contextPath: Jask.Insight.RelatedEntityList.IsWhitelisted
      description: Whether or not the entity is whitelisted
      type: boolean
    - contextPath: Jask.Insight.RelatedEntityList.RiskScore
      description: The risk score of the related entity
      type: number
    - contextPath: Jask.Insight.RelatedEntityList.Source
      description: The source of the related entity
      type: string
    description: Get Insight details for a specific Insight ID. Insight details command
      references SmartAlerts, which are the highest level abstractions in JASK SIEM
      consisting of multiple signals, and records and relating to one or more assets.
  - name: jask-get-insight-comments
    arguments:
    - name: insight-id
      required: true
      default: true
      description: 'The insight ID for which to retrieve comments. '
    outputs:
    - contextPath: Jask.InsightCommentList.id
      description: ID of comment
      type: string
    - contextPath: Jask.InsightCommentList.InsightId
      description: ID of insight
      type: string
    - contextPath: Jask.InsightCommentList.Author
      description: Author of comment
      type: string
    - contextPath: Jask.InsightCommentList.Body
      description: The comment body
      type: string
    - contextPath: Jask.InsightCommentList.LastUpdated
      description: The date the comment was last updated
      type: date
    - contextPath: Jask.InsightCommentList.Timestamp
      description: The time of the comment
      type: date
    description: Get comments for a specific Insight ID. (Users can post and update
      comments on the JASK SIEM portal for any Insight ID.)
  - name: jask-get-signal-details
    arguments:
    - name: signal-id
      required: true
      default: true
      description: The signal to retrieve details for
    outputs:
    - contextPath: Jask.Signal.Id
      description: The signal ID
      type: string
    - contextPath: Jask.Signal.Name
      description: The signal name
      type: string
    - contextPath: Jask.Signal.Category
      description: The signal category
      type: string
    - contextPath: Jask.Signal.Description
      description: The signal description
      type: string
    - contextPath: Jask.Signal.Score
      description: The signal score
      type: number
    - contextPath: Jask.Signal.SourceType
      description: The source type of the signal
      type: string
    - contextPath: Jask.Signal.Timestamp
      description: The time of the signal
      type: date
    - contextPath: Jask.Signal.Metadata.RecordType
      description: The record type
      type: string
    - contextPath: Jask.Signal.Metadata.RecordCount
      description: the associated count of each record type
      type: number
    - contextPath: Jask.SignalThreatIndicators.IndicatorType
      description: The type of threat indicator
      type: string
    - contextPath: Jask.Signal.ThreatIndicators.Value
      description: The value of the threat indicator
      type: string
    description: Get Signal details for a specific Signal ID. Signal details command
      references signals in JASK which are created when records exhibit suspicious
      properties and mate with patterns or other detection logic.
  - name: jask-get-entity-details
    arguments:
    - name: entity-id
      required: true
      default: true
      description: The entity to retrieve details for
    outputs:
    - contextPath: Jask.Entity.Id
      description: The entity ID
      type: string
    - contextPath: Jask.Entity.Name
      description: The entity name
      type: string
    - contextPath: Jask.Entity.IpAddress
      description: The IP address of the entity
      type: string
    - contextPath: Jask.Entity.FirstSeen
      description: When the entity was first seen
      type: date
    - contextPath: Jask.Entity.LastSeen
      description: The time the entity was last seen
      type: date
    - contextPath: Jask.Entity.Source
      description: The source of the entity
      type: string
    - contextPath: Jask.Entity.AssetType
      description: The asset type
      type: string
    - contextPath: Jask.Entity.PrimaryAssetType
      description: The primary asset type
      type: string
    - contextPath: Jask.Entity.HostName
      description: The hostname
      type: string
    - contextPath: Jask.Entity.RiskScore
      description: The risk score
      type: number
    - contextPath: Jask.Entity.IsWhiteListed
      description: Whether or not the entity is whitelisted
      type: boolean
    description: Get entity details for a specific entity ID
  - name: jask-get-related-entities
    arguments:
    - name: entity-id
      required: true
      default: true
      description: 'The entity ID for which the related entities are retrieved. '
    outputs:
    - contextPath: Jask.RelatedEntityList.Id
      description: The entity ID
      type: string
    - contextPath: Jask.RelatedEntityList.Name
      description: The entity name
      type: string
    - contextPath: Jask.RelatedEntityList.Email
      description: The entity email
      type: string
    - contextPath: Jask.RelatedEntityList.Source
      description: The entity source
      type: string
    - contextPath: Jask.RelatedEntityList.UserName
      description: The username of the related entity
      type: string
    - contextPath: Jask.RelatedEntityList.HostName
      description: The hostname of the entity
      type: string
    - contextPath: Jask.RelatedEntityList.Active
      description: Whether or not the entity is active
      type: boolean
    - contextPath: Jask.RelatedEntityList.Admin
      description: The entity admin
      type: string
    - contextPath: Jask.RelatedEntityList.AssetType
      description: The asset type
      type: string
    - contextPath: Jask.RelatedEntityList.CreatedTimestamp
      description: The time of creation
      type: date
    - contextPath: Jask.RelatedEntityList.FirstSeen
      description: The time the entity was first seen
      type: date
    - contextPath: Jask.RelatedEntityList.GivenName
      description: The name given to the entity
      type: string
    - contextPath: Jask.RelatedEntityList.IsWhiteListed
      description: Whether or not the entity is whitelisted
      type: boolean
    - contextPath: Jask.RelatedEntityList.LastSeen
      description: The time the entity was last seen
      type: date
    - contextPath: Jask.RelatedEntityList.LastName
      description: 'The last name '
      type: string
    - contextPath: Jask.RelatedEntityList.RiskScore
      description: The risk score of the entity
      type: number
    description: Get entities related to a specific entity ID.
  - name: jask-get-whitelisted-entities
    arguments: []
    outputs:
    - contextPath: Jask.Whitelisted.EntityList.Id
      description: Id of the whitelisted entity
      type: string
    - contextPath: Jask.Whitelisted.EntityList.Name
      description: Name of the whitelisted entity
      type: string
    - contextPath: Jask.Whitelisted.EntityList.UserName
      description: Username of the whitelisted entity
      type: string
    - contextPath: Jask.Whitelisted.EntityList.ModelId
      description: The modelID of the whitelisted entity
      type: string
    - contextPath: Jask.Whitelisted.EntityList.Timestamp
      description: The time of the whitelisted entity
      type: date
    - contextPath: Jask.Whitelisted.EntityList.Metadata.TotalCount
      description: The number of whitelisted entities
      type: number
    description: 'Get the whitelisted entities. '
  - name: jask-search-insights
    arguments:
    - name: last-seen
      auto: PREDEFINED
      predefined:
      - All time
      - Last week
      - Last 48 hours
      - Last 24 hours
      description: When the insight was last seen. Defaults to 'All time' if no time
        arguments are specified.
    - name: rating
      description: comma separated list of values between 1-5 inclusive
    - name: status
      description: 'comma separated list of values from the options: new, inprogress,
        closed'
      defaultValue: new,inprogress
    - name: assigned-team
      description: comma separated list of values
    - name: assigned-user
      description: comma separated list of values
    - name: offset
      description: The page offset for the results
      defaultValue: "0"
    - name: limit
      description: How many results to retrieve
      defaultValue: "100"
    - name: sort
      description: What to sort the results by
      defaultValue: timestamp:desc
    - name: time-from
      description: The start time for the search in the following string format -  MM/DD/YYYY
    - name: time-to
      description: The end time for the search in the following string format -  MM/DD/YYYY
    outputs:
    - contextPath: Jask.Insight.Id
      description: The ID of the insight
      type: string
    - contextPath: Jask.Insight.Name
      description: The name of the insight
      type: string
    - contextPath: Jask.Insight.Action
      description: The action to take on the insight
      type: string
    - contextPath: Jask.Insight.AssignedTo
      description: 'Who the insight was assigned to '
      type: string
    - contextPath: Jask.Insight.Description
      description: The description of the insight
      type: string
    - contextPath: Jask.Insight.IpAddress
      description: The IP address of the insight
      type: string
    - contextPath: Jask.Insight.LastUpdated
      description: 'When the insight was last updated. '
      type: date
    - contextPath: Jask.Insight.LastUpdatedBy
      description: Who the insight was last updated by
      type: string
    - contextPath: Jask.Insight.Severity
      description: The severity of the insight
      type: number
    - contextPath: Jask.Insight.InsightTime
      description: The time of the insight
      type: date
    - contextPath: Jask.WorkflowStatus
      description: The status of the insight
      type: string
    description: 'Search insights using the given filters. '
  - name: jask-search-signals
    arguments:
    - name: last-seen
      auto: PREDEFINED
      predefined:
      - All time
      - Last week
      - Last 48 hours
      - Last 24 hours
      description: When the insight was last seen. Defaults to 'All time' if no time
        arguments are specified.
    - name: source
      description: 'comma separated list of values from options: threatintel, rule,
        anomaly'
    - name: category
      description: 'comma separated list of values form options: Attack Stage, C2,
        Defense Evasion,  Discovery, Exfiltration, Exploitation, External Recon, Internal
        Recon, Lateral Movement, Threat Intelligence, Traffic Anomaly'
    - name: offset
      description: The page offset for the results
      defaultValue: "0"
    - name: limit
      description: The maximum number of signals retrieved
      defaultValue: "100"
    - name: sort
      description: How to sort the results
      defaultValue: score:desc
    - name: time-from
      description: The start time for the search in the following string format -  MM/DD/YYYY
    - name: time-to
      description: The end time for the search in the following string format -  MM/DD/YYYY
    outputs:
    - contextPath: Jask.Signal.Id
      description: The ID of the signal
      type: string
    - contextPath: Jask.Signal.Name
      description: The name of the signal
      type: string
    - contextPath: Jask.Signal.Category
      description: The category of the signal
      type: string
    - contextPath: Jask.Signal.Description
      description: The description of the signal
      type: string
    - contextPath: Jask.Signal.Score
      description: The score of the signal
      type: number
    - contextPath: Jask.Signal.SourceType
      description: The source type of the signal
      type: string
    - contextPath: Jask.Signal.Timestamp
      description: The time of the signal
      type: date
    - contextPath: Jask.Signal.ThreatIndicators.IndicatorType
      description: The type of threat indicator
      type: string
    - contextPath: Jask.Signal.ThreatIndicators.Value
      description: The value of the threat indicator
      type: string
    description: 'Search signals using the given filters. '
  - name: jask-search-entities
    arguments:
    - name: last-seen
      auto: PREDEFINED
      predefined:
      - All time
      - Last week
      - Last 48 hours
      - Last 24 hours
      description: When the insight was last seen. Defaults to 'All time' if no time
        arguments are specified.
    - name: entity-type
      description: 'comma separated list of values from the options: username, hostname,
        ip'
    - name: offset
      description: The page offset for the results
      defaultValue: "0"
    - name: limit
      description: How many results to retrieve
      defaultValue: "100"
    - name: sort
      description: What to sort by
      defaultValue: risk_score:desc
    - name: time-from
      description: The start time for the search in the following string format -  MM/DD/YYYY
    - name: time-to
      description: The end time for the search in the following string format -  MM/DD/YYYY
    outputs:
    - contextPath: Jask.Entity.Id
      description: The ID of the entity
      type: string
    - contextPath: Jask.Entity.Name
      description: The name of the entity
      type: string
    - contextPath: Jask.Entity.FirstSeen
      description: When the entity was first seen
      type: date
    - contextPath: Jask.Entity.LastSeen
      description: When the entity was last seen
      type: date
    - contextPath: Jask.Entity.Source
      description: The source of the entity
      type: string
    - contextPath: Jask.Entity.EntityType
      description: The type of the entity
      type: string
    - contextPath: Jask.Entity.PrimaryEntityType
      description: The primary entity type
      type: string
    - contextPath: Jask.Entity.HostName
      description: 'The hostname '
      type: string
    - contextPath: Jask.Entity.RiskScore
      description: The risk score of the entity
      type: number
    - contextPath: Jask.Entity.IsWhiteListed
      description: Whether or not the entity is whitelisted
      type: boolean
    - contextPath: Jask.Entity.Groups
      description: The groups of the entity
      type: string
    - contextPath: Jask.Entity.Ip.Address
      description: The IP address of the entity
      type: string
    description: Search entities using the given filters.
  isfetch: true
  runonce: false
