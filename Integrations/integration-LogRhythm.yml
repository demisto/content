commonfields:
  id: LogRhythm
  version: -1
name: LogRhythm
display: LogRhythm
category: Analytics & SIEM
image: data:image/png;base64,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
description: LogRhythm security intelligence
detaileddescription: SIEM, log management, network and endpoint monitoring and forensics,
  and security analytics.
configuration:
- display: Hostname, IP address or Server URL
  name: Host
  defaultvalue: ""
  type: 0
  required: true
- display: ""
  name: Credentials
  defaultvalue: ""
  type: 9
  required: true
- display: Trust any certificate (unsecure)
  name: Insecure
  defaultvalue: ""
  type: 8
  required: false
- display: Use system proxy settings
  name: useproxy
  defaultvalue: ""
  type: 8
  required: false
- display: Fetch incidents
  name: isFetch
  defaultvalue: ""
  type: 8
  required: false
- display: Default page size for alarm queries
  name: pageSize
  defaultvalue: "2000"
  type: 0
  required: false
- display: Timezone offset in minutes of the LogRhythm server machine
  name: timeZone
  defaultvalue: ""
  type: 0
  required: false
- display: Incident type
  name: incidentType
  defaultvalue: ""
  type: 13
  required: false
script:
  script: |-
    // SOAP templates
    var tmplAddAlarmComment = '<?xml version="1.0" encoding="UTF-8"?>' +
    '<env:Envelope xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tns="http://www.logrhythm.com/webservices" xmlns:env="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ins0="http://schemas.microsoft.com/2003/10/Serialization/Arrays">' +
    '  <env:Header>' +
    '    <wsse:Security xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd">' +
    '      <wsse:UsernameToken xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd" wsu:Id="UsernameToken-1">' +
    '        <wsse:Username>{{.Username}}</wsse:Username>' +
    '        <wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">{{.Password}}</wsse:Password>' +
    '      </wsse:UsernameToken>' +
    '    </wsse:Security>' +
    '  </env:Header>' +
    '  <env:Body>' +
    '    <tns:AddAlarmComments>' +
    '        <tns:alarmID>{{.AlarmID}}</tns:alarmID>' +
    '        <tns:comments>{{.Comments}}</tns:comments>' +
    '    </tns:AddAlarmComments>' +
    '  </env:Body>' +
    '</env:Envelope>';

    var tmplGetAlarmByID =
    '<?xml version="1.0" encoding="UTF-8"?>' +
    '<SOAP-ENV:Envelope xmlns:ns0="http://www.logrhythm.com/webservices" xmlns:ns1="http://schemas.xmlsoap.org/soap/envelope/" xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/">' +
    ' <SOAP-ENV:Header>' +
    '  <wsse:Security mustUnderstand="true">' +
    '   <wsse:UsernameToken>' +
    '    <wsse:Username>{{.Username}}</wsse:Username>' +
    '    <wsse:Password>{{.Password}}</wsse:Password>' +
    '   </wsse:UsernameToken>' +
    '  </wsse:Security>' +
    ' </SOAP-ENV:Header>' +
    ' <ns1:Body>' +
    "  <ns0:GetAlarmByID xmlns:ns1='http://www.logrhythm.com/webservices'>" +
    '    <ns1:alarmID>{{.AlarmID}}</ns1:alarmID>' +
    '  </ns0:GetAlarmByID>' +
    ' </ns1:Body>' +
    '</SOAP-ENV:Envelope>';

    var tmplGetAlarmEventsByID = '<?xml version="1.0" encoding="UTF-8"?>' +
    '<env:Envelope xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tns="http://www.logrhythm.com/webservices" xmlns:env="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ins0="http://schemas.microsoft.com/2003/10/Serialization/Arrays">' +
    '  <env:Header>' +
    '    <wsse:Security xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd">' +
    '      <wsse:UsernameToken xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd" wsu:Id="UsernameToken-1">' +
    '       <wsse:Username>{{.Username}}</wsse:Username>' +
    '        <wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">{{.Password}}</wsse:Password>' +
    '      </wsse:UsernameToken>' +
    '    </wsse:Security>' +
    '  </env:Header>' +
    '  <env:Body>' +
    '    <tns:GetAlarmEventsByID>' +
    '        <tns:alarmID>{{.AlarmID}}</tns:alarmID>' +
    '        <tns:includeRawLog>{{.IncludeRawLog}}</tns:includeRawLog>' +
    '    </tns:GetAlarmEventsByID>' +
    '  </env:Body>' +
    '</env:Envelope>';

    var tmplGetAlarmHistoryByID = '<?xml version="1.0" encoding="UTF-8"?>' +
    '<env:Envelope xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tns="http://www.logrhythm.com/webservices" xmlns:env="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ins0="http://schemas.microsoft.com/2003/10/Serialization/Arrays">' +
    '  <env:Header>' +
    '    <wsse:Security xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd">' +
    '      <wsse:UsernameToken xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd" wsu:Id="UsernameToken-1">' +
    '        <wsse:Username>{{.Username}}</wsse:Username>' +
    '        <wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">{{.Password}}</wsse:Password>' +
    '      </wsse:UsernameToken>' +
    '    </wsse:Security>' +
    '  </env:Header>' +
    '  <env:Body>' +
    '    <tns:GetAlarmHistoryByID>' +
    '        <tns:alarmID>{{.AlarmID}}</tns:alarmID>' +
    '        <tns:includeNotifications>{{.IncludeNotifications}}</tns:includeNotifications>' +
    '        <tns:includeComments>{{.IncludeComments}}</tns:includeComments>' +
    '    </tns:GetAlarmHistoryByID>' +
    '  </env:Body>' +
    '</env:Envelope>';

    var tmplUpdateAlarmStatus = '<?xml version="1.0" encoding="UTF-8"?>' +
    '<env:Envelope xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tns="http://www.logrhythm.com/webservices" xmlns:env="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ins0="http://schemas.microsoft.com/2003/10/Serialization/Arrays">' +
    '  <env:Header>' +
    '    <wsse:Security xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd">' +
    '      <wsse:UsernameToken xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd" wsu:Id="UsernameToken-1">' +
    '        <wsse:Username>{{.Username}}</wsse:Username>' +
    '        <wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">{{.Password}}</wsse:Password>' +
    '      </wsse:UsernameToken>' +
    '    </wsse:Security>' +
    '  </env:Header>' +
    '  <env:Body>' +
    '    <tns:UpdateAlarmStatus>' +
    '        <tns:alarmID>{{.AlarmID}}</tns:alarmID>' +
    '        <tns:status>{{.Status}}</tns:status>' +
    '        {{.Comments}}' +
    '    </tns:UpdateAlarmStatus>' +
    '  </env:Body>' +
    '</env:Envelope>';

    var tmplGetFirstPageAlarmsByAlarmStatus =
    '<?xml version="1.0" encoding="UTF-8"?>' +
    '<SOAP-ENV:Envelope xmlns:ns0="http://www.logrhythm.com/webservices" xmlns:ns1="http://schemas.xmlsoap.org/soap/envelope/" xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/">' +
    ' <SOAP-ENV:Header>' +
    '  <wsse:Security mustUnderstand="true">' +
    '   <wsse:UsernameToken>' +
    '    <wsse:Username>{{.Username}}</wsse:Username>' +
    '    <wsse:Password>{{.Password}}</wsse:Password>' +
    '   </wsse:UsernameToken>' +
    '  </wsse:Security>' +
    ' </SOAP-ENV:Header>' +
    ' <ns1:Body>' +
    "    <ns1:GetFirstPageAlarmsByAlarmStatus xmlns:ns1='http://www.logrhythm.com/webservices'>" +
    '      <ns1:startDate>{{.StartDate}}</ns1:startDate>' +
    '      <ns1:endDate>{{.EndDate}}</ns1:endDate>' +
    '      <ns1:status>{{.Status}}</ns1:status>' +
    '      <ns1:allUsers>{{.AllUsers}}</ns1:allUsers>' +
    '      <ns1:maximumResultsPerPage>{{.MaxResultsPerPage}}</ns1:maximumResultsPerPage>' +
    '    </ns1:GetFirstPageAlarmsByAlarmStatus>' +
    ' </ns1:Body>' +
    '</SOAP-ENV:Envelope>'

    var tmplGetNextPageAlarms = '<?xml version="1.0" encoding="UTF-8"?>' +
    '<env:Envelope xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tns="http://www.logrhythm.com/webservices" xmlns:env="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ins0="http://schemas.microsoft.com/2003/10/Serialization/Arrays">' +
    '  <env:Header>' +
    '    <wsse:Security xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd">' +
    '      <wsse:UsernameToken xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd" wsu:Id="UsernameToken-1">' +
    '        <wsse:Username>{{.Username}}</wsse:Username>' +
    '        <wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">{{.Password}}</wsse:Password>' +
    '      </wsse:UsernameToken>' +
    '    </wsse:Security>' +
    '  </env:Header>' +
    '  <env:Body>' +
    '    <tns:GetNextPageAlarms>' +
    '      <tns:nextPageID>{{.NextPageID}}</tns:nextPageID>' +
    '    </tns:GetNextPageAlarms>' +
    '  </env:Body>' +
    '</env:Envelope>';

    // global variables and helper functions

    var soapActionURIGetNextPageAlarms               = 'http://www.logrhythm.com/webservices/AlarmService/GetNextPageAlarms';
    var soapActionURIGetFirstPageAlarmsByAlarmStatus = 'http://www.logrhythm.com/webservices/AlarmService/GetFirstPageAlarmsByAlarmStatus';
    var logRhythmAPI = 'LogRhythm.API/Services/AlarmServiceBasicAuth.svc';
    var defaultAlarmsPageSize = 2000;
    var defaultCount = 1000;
    var alarmsFieldsToRemove=["EntityID","LastUpdatedID","LastUpdatedName","DateInserted","DateUpdated","EventDateFirst","EventDateLast","EventCount","RuleID"];

    var fixUrl = function(base) {
        res = base;
        if (base && base[base.length - 1] != '/') {
            res = res + '/';
        }
        return res;
    };
    var url;
    // includes server URL that starts with http or https
    if (params.Host.startsWith('http')) {
        url = fixUrl(params.Host) + logRhythmAPI;
    }
    else {
        url = 'https://' + fixUrl(params.Host) + logRhythmAPI;
    }
    var myTimezone = new Date().getTimezoneOffset();
    var tz = params.timeZone ? parseInt(params.timeZone) : myTimezone;
    if (params.timeZone === '0') {
        tz = 0;
    }

    var getRaw = function(url) {
         res = http(
            url,
            {
                Method: 'GET',
            },
            params.Insecure,
            params.useproxy
        );
        return res;
    };

    var fixTemplate = function(template, data) {
        var keys = Object.keys(data);
        for (var i = 0 ; i < keys.length; i++) {
            var key = keys[i];
            template = template.replace('{{.'+key+'}}',data[key]);
        }
        return template;
    };

    var sendRequest = function(envelope, soapAction) {
         res = http(
            url,
            {
                Method: 'POST',
                Body: envelope,
                Headers: {
                    'Content-Type': ['text/xml; charset=utf-8'],
                    Soapaction: [soapAction]
                }
            },
            params.Insecure,
            params.useproxy
         );
         if (res.StatusCode < 200 || res.StatusCode >= 300) {
            throw 'Request to LogRhythm ' + url + ' failed, request status code: ' + res.StatusCode + ' and Body: ' + res.Body + '.';
        }
        return res.Body;
    };

    var parseResponse = function(body) {
        return JSON.parse(x2j(body));
    };

    var doBatch = function(envelope, action, count, pageSize) {
        var alarmPath = 'Envelope.Body.GetFirstPageAlarmsByAlarmStatusResponse.GetFirstPageAlarmsByAlarmStatusResult.Alarms.AlarmSummaryDataModel';
        var hasMorePath = 'Envelope.Body.GetFirstPageAlarmsByAlarmStatusResponse.GetFirstPageAlarmsByAlarmStatusResult.HasMoreResults';
        var nextPagePath = 'Envelope.Body.GetFirstPageAlarmsByAlarmStatusResponse.GetFirstPageAlarmsByAlarmStatusResult.NextPageID';
        var alarms = [];
        var res = parseResponse(sendRequest(envelope, action));
        while (true) {
            var alarmObj = dq(res,alarmPath);
            if (!alarmObj) {
                break;
            }
            if (alarmObj.length) {
                alarms = alarms.concat(alarmObj);
            } else {
                alarms.push(alarmObj);
            }
            var hasMore = dq(res,hasMorePath);
            var nextPage  = dq(res,nextPagePath);
            if (!hasMore || count <= pageSize || count <= alarms.length || !nextPage) {
                break;
            }

            var obj = {
                Username: params.Credentials.identifier,
                Password: params.Credentials.password,
                NextPageID: nextPage
            };
            var nextEnvelope = fixTemplate(tmplGetNextPageAlarms, obj);
            res = parseResponse(sendRequest(nextEnvelope, soapActionURIGetNextPageAlarms));
            alarmPath = 'Envelope.Body.GetNextPageAlarmsResponse.GetNextPageAlarmsResult.Alarms.AlarmSummaryDataModel';
            hasMorePath = 'Envelope.Body.GetNextPageAlarmsResponse.GetNextPageAlarmsResult.HasMoreResults';
            nextPagePath = 'Envelope.Body.GetNextPageAlarmsResponse.GetNextPageAlarmsResult.NextPageID';
        }

        alarms.forEach(function(element) {
            alarmsFieldsToRemove.forEach(function(field){
                delete element[field];
            });
        });

        return alarms.length > count ? alarms.slice(0,count) : alarms;
    };

    function fixDictionaryKeys(dict){
        //remove the word 'Alarm' from dictionary keys (e.g AlarmID to ID)
        Object.keys(dict).forEach(function(key) {
            if(key.indexOf("Alarm") !== -1){
                var newkey = key.replace('Alarm', '');
                dict[newkey] = dict[key];
                delete dict[key];
            }
        });
    }

    function getAlarmsData(allUsers, count, pageSize, startDate, endDate, status, dataObj) {
        dataObj.StartDate = startDate;
        dataObj.EndDate = endDate;
        dataObj.Status = status;
        dataObj.AllUsers = allUsers;
        dataObj.MaxResultsPerPage = pageSize;
        var envelope = fixTemplate(tmplGetFirstPageAlarmsByAlarmStatus, dataObj);
        return doBatch(envelope, soapActionURIGetFirstPageAlarmsByAlarmStatus, count, pageSize);
    }

    var prepareDetailsString = function(al) {
        return JSON.stringify(
            {
                AlarmRuleID: al.AlarmRuleID,
                AlarmStatus: al.AlarmStatus,
                EntityID: al.EntityID,
                LastUpdatedID: al.LastUpdatedID,
                EventCount: al.EventCount,
                EventDateFirst: al.EventDateFirst,
                EventDateLast: al.EventDateLast,
                RBPAvg: al.RBPAvg,
                RBPMax: al.RBPMax,
                DateInserted: al.DateInserted,
                DateUpdated: al.DateUpdated,
                AlarmRuleName: al.AlarmRuleName,
                EntityName: al.EntityName,
                LastUpdatedName: al.LastUpdatedName
            }
        );
    };

    var getOccurredTime = function(al) {
        var occurred = new Date();
        if (al.AlarmDate) {
            var hour = tz / 60;
            var minute = tz % 60;
            var tzPrefix = tz < 0 ? '-' : '+';
            var hourstr = hour +'';
            if (hourstr.length < 2) {
                hourstr = '0' + hourstr;
            }
            var minutestr = minute +'';
            if (minutestr.length < 2) {
                minutestr = '0' + minutestr;
            }
            occurred = new Date(Date.parse(al.AlarmDate + tzPrefix + hourstr + minutestr));
        }
        return occurred;
    };

    var alarmsToIncident = function(alarmList, lastRun) {
        var incs = [];
        var orgLastId = lastRun.lastId;
        for (var i = 0; i < alarmList.length; i++) {
            logDebug("Got alarm from LR",JSON.stringify(alarmList[i]));
            inc = {
                name: 'LogRhythm alarm ' + alarmList[i].AlarmID,
                occurred: getOccurredTime(alarmList[i]),
                created: new Date(),
                details: prepareDetailsString(alarmList[i]),
                rawJSON: JSON.stringify(alarmList[i])
            };
            // Check that it is in the time range and in the id range
            var alarmIdInt = parseInt(alarmList[i].AlarmID);
            if (alarmIdInt && alarmIdInt <= orgLastId) {
                continue;
            }
            if (alarmIdInt > lastRun.lastId) {
                lastRun.lastId = alarmIdInt;
            }
            if (inc.occurred.getTime() > lastRun.lastTime) {
                lastRun.lastTime = inc.occurred.getTime();
            }
            incs.push(inc);
        }
        setLastRun(lastRun);
        logDebug("LogRythm: lastRun is",JSON.stringify(lastRun));
        logDebug("LogRythm: returning incs",JSON.stringify(incs));
        return JSON.stringify(incs);
    };

    var getDateAsString = function(d) {
        return d.toISOString();
    }

    function processAlarmEventsMd(mdRaw){
        // flattening the AlarmEvents structure
        var processedMd = {};
        mdRaw = mdRaw['LogDataModel'];
        Object.keys(mdRaw).forEach(function(key) {
            if (mdRaw[key] === undefined || mdRaw[key] === "" || mdRaw[key] === "NaN") {
                return;
            }
            else if (typeof (mdRaw[key]) === 'object'){
                var inputString = "";
                Object.keys(mdRaw[key]).forEach(function(innerKey) {
                    inputString += innerKey + ":" + mdRaw[key][innerKey] + "\n";
                });
                processedMd[key] = inputString;
            } else {
                processedMd[key] = mdRaw[key];
            }
        });
        return processedMd;
    }

    // commands functions

    function addAlarmComments(args){
        // corresponds to lr-add-alarm-comments command. Adds a comment to an alarm

        var dataObj = {
            Username: params.Credentials.identifier,
            Password: params.Credentials.password,
            AlarmID: args['alarm-id'],
            Comments: args['comments']
        };


        var soapActionURIAddAlarmComments = 'http://www.logrhythm.com/webservices/AlarmService/AddAlarmComments';
        var envelope = fixTemplate(tmplAddAlarmComment, dataObj);
        var jsResponse = parseResponse(sendRequest(envelope, soapActionURIAddAlarmComments));
        var mdRaw = dq(jsResponse, 'Envelope.Body.AddAlarmCommentsResponse.AddAlarmCommentsResult');

        fixDictionaryKeys(mdRaw);


        var md = 'LogRhythm added alarm comment ' + args['comments'] + ' for ID: ' + args['alarm-id'];


        var ec= {};
        ec["LogRhythm.Alarm(val.ID && val.ID == " + args['alarm-id'] + ")"] = {'ID' : args['alarm-id']};
        ec["LogRhythm.Alarm(val.ID && val.ID == " + args['alarm-id'] + ").Comment"] = [args['comments']];

        return {
            Type: entryTypes.note,
            Contents: jsResponse,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext: ec
        };
    }

    function getAlarmById(args){
        // corresponds to lr-get-alarm-by-id command. Get the data by a specific alarm id

        var dataObj = {
            Username: params.Credentials.identifier,
            Password: params.Credentials.password,
            AlarmID: args['alarm-id']
        };

        var soapActionURIGetAlarmByID = 'http://www.logrhythm.com/webservices/AlarmService/GetAlarmByID';
        var envelope = fixTemplate(tmplGetAlarmByID, dataObj);
        var jsResponse =  parseResponse(sendRequest(envelope, soapActionURIGetAlarmByID));
        var mdRaw = dq(jsResponse, 'Envelope.Body.GetAlarmByIDResponse.GetAlarmByIDResult');
        if (mdRaw['-i']) {
            delete mdRaw['-i'];
        }

        fixDictionaryKeys(mdRaw);

        alarmsFieldsToRemove.forEach(function(field){
            delete mdRaw[field];
        });

        var md = tableToMarkdown('LogRhythm alarm for ID: ' + args['alarm-id'],  mdRaw);

        var ec = {};
        ec["LogRhythm.Alarm(val.ID && val.ID == " + mdRaw['ID'] + ")"] = mdRaw;


        return {
            Type: entryTypes.note,
            Contents: jsResponse,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext: ec
        };
    }

    function getAlarmEventsById(args){
        // corresponds to lr-get-alarm-events-by-id command. Get the alarm's events by a specific alarm id


        var fieldsToRemove = ["Bytes","ClassificationID","ClassificationTypeName","CommonEventID","DirectionName","EntityID","ImpactedZone",
        "ImpactedEntityID","ImpactedHostID","ImpactedLocation","ImpactedLocationID","ImpactedNATPort","ImpactedNetwork","ImpactedNetworkID",
        "ImpactedPort","LogDate","LogSourceHost","LogSourceHostID","LogSourceID","LogSourceType","LogSourceTypeName","Login","MPERuleID",
        "MPERuleName","MessageID","NormalDateMax","OriginEntityID","OriginHostID","OriginLocation","OriginLocationID","LogSourceHostName",
        "OriginNATPort","OriginName","OriginNetwork","OriginNetworkID","OriginPort","Priority","ProcessID","ProtocolID","Direction",
        "SequenceNumber","ServiceID","ServiceName","Count","DateInserted","OriginZone","MessageType","EntityName","ImpactedHostID"];

        var dataObj = {
            Username: params.Credentials.identifier,
            Password: params.Credentials.password,
            AlarmID: args['alarm-id'],
            IncludeRawLog: args['include-raw-log'] === 'true'
        };

        var soapActionURIGetAlarmsEventsByID = 'http://www.logrhythm.com/webservices/AlarmService/GetAlarmEventsByID';
        var envelope = fixTemplate(tmplGetAlarmEventsByID, dataObj);
        var jsResponse = parseResponse(sendRequest(envelope, soapActionURIGetAlarmsEventsByID));
        var mdRaw = dq(jsResponse, 'Envelope.Body.GetAlarmEventsByIDResponse.GetAlarmEventsByIDResult.Events')
        if (mdRaw['-i']) {
            delete mdRaw['-i'];
        }
        var processedMd = processAlarmEventsMd(mdRaw);


        fieldsToRemove.forEach(function(field){
            delete processedMd[field];
        });



        var md = tableToMarkdown('LogRhythm alarm events for ID: ' + args['alarm-id'],  processedMd);


        var historyRow = {};
        historyRow['ID'] = args['alarm-id'];
        historyRow['Event'] = processedMd;

        var ec = {};
        ec['LogRhythm.Alarm(val.ID && val.ID == ' + args['alarm-id'] + ')'] = historyRow;


        return {
            Type: entryTypes.note,
            Contents: jsResponse,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext: ec
        };
    }

    function getAlarmHistoryById(args){
        // corresponds to lr-get-alarm-history-by-id command. Get the alarm's history by a specific alarm id

        var dataObj = {
            Username: params.Credentials.identifier,
            Password: params.Credentials.password,
            AlarmID: args['alarm-id'],
            IncludeComments: args['include-comments'] === 'true',
            IncludeNotifications: args['include-notifications'] === 'true'
        };

        //Verify that at least one of the 2 are marked as true, else throw an error
        if (!dataObj.IncludeNotifications && !dataObj.IncludeComments) {
            throw 'At least one of "include-comments", "include-notifications" should be true';
        }

        var soapActionURIGetAlarmsHistoryByID = 'http://www.logrhythm.com/webservices/AlarmService/GetAlarmHistoryByID';
        var envelope = fixTemplate(tmplGetAlarmHistoryByID, dataObj);
        var jsResponse =  parseResponse(sendRequest(envelope, soapActionURIGetAlarmsHistoryByID));
        var md = "", mdRaw;
        if (dataObj.IncludeNotifications) {
            mdRaw = dq(jsResponse, 'Envelope.Body.GetAlarmHistoryByIDResponse.GetAlarmHistoryByIDResult.Notifications.AlarmNotificationDataModel')
            md = tableToMarkdown('LogRhythm alarm notifications history for ID: ' + args['alarm-id'],  mdRaw);
        }
        if (dataObj.IncludeComments) {
            if (md.length > 0) {
                md += '\n\n';
            }
            var mdRaw = dq(jsResponse, 'Envelope.Body.GetAlarmHistoryByIDResponse.GetAlarmHistoryByIDResult.Comments.AlarmCommentDataModel')
            md += tableToMarkdown('LogRhythm alarm comments history for ID: ' + args['alarm-id'],  mdRaw);
        }

        var historyRow = {};
        historyRow['ID'] = args['alarm-id'];
        historyRow['History'] = mdRaw;

        var ec = {};
        ec['LogRhythm.Alarm(val.ID && val.ID == ' + args['alarm-id'] + ')'] = historyRow;

        return {
            Type: entryTypes.note,
            Contents: jsResponse,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext: ec
        };
    }

    function updateAlarmStatus(args){
        // corresponds to lr-update-alarm-status command. Updates an alarm's current status

        var dataObj = {
            Username: params.Credentials.identifier,
            Password: params.Credentials.password,
            AlarmID: args['alarm-id'],
            Status: args['status'],
            Comments: (args.comments ? ('<tns:comments>' + args.comments + '</tns:comments>') : '')
        };

        var soapActionURIUpdateAlarmStatus = 'http://www.logrhythm.com/webservices/AlarmService/UpdateAlarmStatus';
        var envelope = fixTemplate(tmplUpdateAlarmStatus, dataObj);
        var jsResponse = parseResponse(sendRequest(envelope, soapActionURIUpdateAlarmStatus));
        var mdRaw = dq(jsResponse, 'Envelope.Body.UpdateAlarmStatusResponse.UpdateAlarmStatusResult')

        fixDictionaryKeys(mdRaw);

        var md = 'LogRhythm alarm status updated for alarm: *' + args['alarm-id']+'* status: *' + args.status +'*';

        var status = {
            'Status' : args['status'],
            'ID' : args['alarm-id']
        };

        var ec= {};
        ec["LogRhythm.Alarm(val.ID && val.ID == " + args['alarm-id'] + ")"] = status;

        return {
            Type: entryTypes.note,
            Contents: jsResponse,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext : ec
        };
    }

    function getAlarms(dataArgs){
        /* corresponds to lr-get-alarms command. Retrieves data about alarms in a particular time range.
           time format follows iso 8601, for example: startDate="2017-03-27" */

        var dataObj = {
            Username: params.Credentials.identifier,
            Password: params.Credentials.password,
        };

        var allUsers = dataArgs['all-users'] === 'true';
        var count = dataArgs.count ? parseInt(dataArgs.count) : defaultCount;
        count = count || defaultCount;

        var pageSize = params.pageSize ? parseInt(params.pageSize) : defaultAlarmsPageSize;
        pageSize = pageSize || defaultAlarmsPageSize;
        if (count < pageSize) {
            pageSize = count;
        }

        var timeFrame = dataArgs['time_frame'];


        var start = new Date();
        var end = new Date();
        end.setDate(start.getDate()+1);

        switch(timeFrame){
        case 'Today':
            break;
        case 'Last2Days':
            start.setDate(start.getDate()-2);
            break;
        case 'LastWeek':
            start.setDate(start.getDate()-7);
            break;
        case 'LastMonth':
            start.setDate(start.getDate()-30);
            break;
        case 'Custom':
            if(!dataArgs['start-date']){
                throw 'start-date argument is missing';
            }
            if(!dataArgs['end-date']){
                throw 'end-date argument is missing';
            }
            break;
        }


        if(timeFrame == 'Custom'){
            startDate = new Date(dataArgs['start-date']).toISOString().slice(0,10);
            endDate = new Date(dataArgs['end-date']).toISOString().slice(0,10);
        }
        else{
            startDate = start.toISOString().slice(0,10);
            endDate = end.toISOString().slice(0,10);
        }


        var alarms = getAlarmsData(allUsers, count, pageSize, startDate, endDate, dataArgs.status, dataObj);

        var ec = {};

        alarms.forEach(function(alarm) {
            fixDictionaryKeys(alarm);
            ec['LogRhythm.Alarm(val.ID && val.ID == ' + alarm['ID'] + ')'] = alarm;
        });

        if (alarms.length) {
            var md = tableToMarkdown('',  alarms);
            return {
                Type: entryTypes.note,
                Contents: alarms,
                ContentsFormat: formats.json,
                HumanReadable: md,
                EntryContext: ec
            };
        } else {
            return {
                Type: entryTypes.note,
                Contents: "No results",
                ContentsFormat: formats.text
            };
        }
    }

    function fetchIncidents(){

        var dataObj = {
            Username: params.Credentials.identifier,
            Password: params.Credentials.password
        };

        var lastRun = getLastRun();
        if (!lastRun || !lastRun.lastTime) {
            lastRun = {
                lastId: 0,
                lastTime: new Date().getTime() - (10 * 60 * 1000)
            }
        }
        var pageSize = params.pageSize ? parseInt(params.pageSize) : defaultAlarmsPageSize;
        pageSize = pageSize || defaultAlarmsPageSize;
        var alarms = getAlarmsData(true, pageSize, pageSize, getDateAsString(new Date(lastRun.lastTime)), getDateAsString(new Date()), 'New',dataObj);
        if (alarms.length) {
            return alarmsToIncident(alarms, lastRun);
        }
        return '[]';
    }
    // The command input arg holds the command sent from the user.
    switch (command) {
        // This is the call made when pressing the integration test button.
        case 'test-module':
            var resp = getRaw(url + '?singleWsdl');
            var alarmsArgs = {};
            alarmsArgs['all-users'] = "true";
            alarmsArgs['start-date'] = "2018-03-01";
            alarmsArgs['end-date'] = "2018-03-30";
            alarmsArgs['status'] = "New";
            var alarmsResponse = getAlarms(alarmsArgs);
            // if we get alarmsResponse.Type it means that no error was raised in getAlarms
            if (resp.StatusCode === 200 && alarmsResponse.Type) {
                return 'ok';
            } else if (resp.Status) {
                return resp.Status;
            } else {
                return resp;
            }
            break;
        case 'lr-add-alarm-comments':
            return addAlarmComments(args);

        case 'lr-get-alarm-by-id':
            return getAlarmById(args);

        case 'lr-get-alarm-events-by-id':
            return getAlarmEventsById(args);

        case 'lr-get-alarm-history-by-id':
            return getAlarmHistoryById(args);

        case 'lr-update-alarm-status':
            return updateAlarmStatus(args);

        case 'lr-get-alarms':
            return getAlarms(args);

        case 'fetch-incidents':
            return fetchIncidents();
    }
  type: javascript
  commands:
  - name: lr-add-alarm-comments
    arguments:
    - name: alarm-id
      required: true
      default: true
      description: The unique ID of the alarm
    - name: comments
      required: true
      description: The alarm comments
    outputs:
    - contextPath: LogRhythm.Alarm.Comment
      description: The alarm comment.
    - contextPath: LogRhythm.Alarm.ID
      description: The unique id of the alarm.
    description: Update alarm with comments
    execution: true
  - name: lr-get-alarm-by-id
    arguments:
    - name: alarm-id
      required: true
      default: true
      description: The unique ID of the alarm
    outputs:
    - contextPath: LogRhythm.Alarm.RBPMax
      description: Alarm maximum RBP(Risk Based Prioritization).
    - contextPath: LogRhythm.Alarm.RuleName
      description: Alarm rule name.
    - contextPath: LogRhythm.Alarm.EntityName
      description: entity name
    - contextPath: LogRhythm.Alarm.Date
      description: Alarm date.
    - contextPath: LogRhythm.Alarm.Status
      description: Alarm status.
    - contextPath: LogRhythm.Alarm.RBPAvg
      description: Alarm average RBP(Risk Based Prioritization).
    - contextPath: LogRhythm.Alarm.ID
      description: The unique id of the alarm.
    description: Retrieve a single alarm by the unique alarm identifier
  - name: lr-get-alarm-events-by-id
    arguments:
    - name: alarm-id
      required: true
      default: true
      description: The unique ID of the alarm
    - name: include-raw-log
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Include raw log
    outputs:
    - contextPath: LogRhythm.Alarm.Event.LogSourceName
      description: Event log source.
    - contextPath: LogRhythm.Alarm.Event.Command
      description: Event command.
    - contextPath: LogRhythm.Alarm.Event.Subject
      description: Event subject.
    - contextPath: LogRhythm.Alarm.Event.Process
      description: Event process name.
    - contextPath: LogRhythm.Alarm.Event.ClassificationName
      description: Event classification.
    - contextPath: LogRhythm.Alarm.Event.ImpactedEntityName
      description: Event entity (Impacted).
    - contextPath: LogRhythm.Alarm.Event.OriginEntityName
      description: Event entity (Origin).
    - contextPath: LogRhythm.Alarm.Event.VendorMsgID
      description: Event vendor Message ID.
    - contextPath: LogRhythm.Alarm.Event.NormalDate
      description: Event date.
    - contextPath: LogRhythm.Alarm.Event.Session
      description: Event session.
    - contextPath: LogRhythm.Alarm.Event.ImpactedHostName
      description: Event hostname (Impacted).
    - contextPath: LogRhythm.Alarm.Event.CommonEventName
      description: Event name.
    - contextPath: LogRhythm.Alarm.Event.ImpactedZoneName
      description: Event zone (Impacted).
    - contextPath: LogRhythm.Alarm.Event.OriginZoneName
      description: Event zone (Origin).
    - contextPath: LogRhythm.Alarm.Event.Severity
      description: Event severity.
    - contextPath: LogRhythm.Alarm.ID
      description: The unique id of the alarm.
    description: Retrieve a list of events associated to this alarm
  - name: lr-get-alarm-history-by-id
    arguments:
    - name: alarm-id
      required: true
      default: true
      description: The unique ID of the alarm
    - name: include-notifications
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Include notification history
    - name: include-comments
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Include comments history
    outputs:
    - contextPath: LogRhythm.Alarm.History.Comment
      description: Alarm history comment.
    - contextPath: LogRhythm.Alarm.History.DateInserted
      description: Alarm history record date.
    - contextPath: LogRhythm.Alarm.History.ID
      description: The unique id of the history record.
    - contextPath: LogRhythm.Alarm.History.PersonID
      description: Alarm history person id
    - contextPath: LogRhythm.Alarm.History.PersonName
      description: Alarm history person name
    - contextPath: LogRhythm.Alarm.ID
      description: The unique id of the alarm.
    description: Retrieve a list of alarm status and comment updates
  - name: lr-update-alarm-status
    arguments:
    - name: alarm-id
      required: true
      default: true
      description: The unique ID of the alarm
    - name: status
      required: true
      auto: PREDEFINED
      predefined:
      - New
      - Opened
      - Working
      - Escalated
      - Closed
      - Closed_FalseAlarm
      - Closed_Resolved
      - Closed_Unresolved
      - Closed_Reported
      - Closed_Monitor
      description: The enumeration status of the alarm
    - name: comments
      description: The alarm comments
    outputs:
    - contextPath: LogRhythm.Alarm.Status
      description: Alarm new status.
    - contextPath: LogRhythm.Alarm.ID
      description: The unique id of the alarm.
    description: Update alarm status
  - name: lr-get-alarms
    arguments:
    - name: start-date
      description: 'Start date for the data query. For example: start-date="2018-03-27", ignore this argument when time_frame is not Custom'
    - name: end-date
      description: 'End date for the data query. For example: end-date="2018-04-08", ignore this argument when time_frame is not Custom'
    - name: all-users
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Alarms for all users
    - name: count
      description: Number of alerts to retrieve. If empty, will be set to default
        of 1000.
      defaultValue: "1000"
    - name: status
      required: true
      auto: PREDEFINED
      predefined:
      - New
      - Opened
      - Working
      - Escalated
      - Closed
      - Closed_FalseAlarm
      - Closed_Resolved
      - Closed_Unresolved
      - Closed_Reported
      - Closed_Monitor
      description: The enumeration status of the alarm
    - name: time_frame
      default: true
      auto: PREDEFINED
      predefined:
      - Today
      - Last2Days
      - LastWeek
      - LastMonth
      - Custom
      defaultValue: Custom
      description: If time_frame is Custom, specify the start time for the time range.
    outputs:
    - contextPath: LogRhythm.Alarm.RBPMax
      description: Alarm maximum RBP(Risk Based Prioritization).
    - contextPath: LogRhythm.Alarm.RuleName
      description: Alarm rule name.
    - contextPath: LogRhythm.Alarm.EntityName
      description: entity name.
    - contextPath: LogRhythm.Alarm.Date
      description: Alarm date.
    - contextPath: LogRhythm.Alarm.Status
      description: Alarm status.
    - contextPath: LogRhythm.Alarm.RBPAvg
      description: Alarm average RBP(Risk Based Prioritization).
    - contextPath: LogRhythm.Alarm.ID
      description: The unique id of the alarm.
    description: Retrieve alarms in a given time period, optionally filtered by the
      alarm status or entity
  isfetch: true
  runonce: false
tests:
- LogRhythm-Test-Playbook
releaseNotes: "add outputs and update context"
