commonfields:
  id: Threat Grid
  version: -1
name: Threat Grid
display: Cisco Threat Grid
category: Forensics & Malware Analysis
image: data:image/png;base64,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
description: Query and upload samples to Cisco threat grid.
detaileddescription: |-
  1. In your threat grid instance, click your user name at the right top corner.
  2. Select my account.
  3. Under the API Key section in the left you will see your API.
configuration:
- display: Server URL (e.g. https://192.168.0.1)
  name: server
  defaultvalue: https://panacea.threatgrid.com
  type: 0
  required: true
- display: API token
  name: token
  defaultvalue: ""
  type: 4
  required: true
- display: Trust any certificate (unsecure)
  name: insecure
  defaultvalue: ""
  type: 8
  required: false
- display: Use system proxy settings
  name: proxy
  defaultvalue: ""
  type: 8
  required: false
script:
  script: |-
    var v3Commands = [
        'threat-grid-who-am-i',
        'threat-grid-user-get-rate-limit',
    ];
    var TERSHOLD = 80;

    var url = params.server.replace(/[\/]+$/, '') + '/api/' + (v3Commands.indexOf(command) === -1 ? 'v2' : 'v3') + '/';

    var mapObjFunction = function(mapFields) {
        var transformSingleObj= function(obj) {
            var res = {};
            mapFields.forEach(function(f) {
               res[f.to] = dq(obj, f.from);
            });
            return res;
        };
        return function(obj) {
            if (obj instanceof Array) {
                var res = [];
                for (var j=0; j < obj.length; j++) {
                    res.push(transformSingleObj(obj[j]));
                }
                return res;
            }
            return transformSingleObj(obj);
        }
    }

    var sendRequest = function(method, path, args, filename) {
        // add a token
        args['api_key'] = params.token;
        var res = http(
                url + path + encodeToURLQuery(args),
                {
                    Method: method
                },
                params.insecure,
                params.proxy
            );
        if (res.StatusCode < 200 || res.StatusCode >= 300) {
            throw 'Request to ThreatGrid ' + path + ' failed, request status code: ' + res.StatusCode + ' and Body: ' + res.Body + '.';
        }
        // If file name is provided, we should save to file
        return filename ?
            {Type: 9, FileID: saveFile(res.Body), File: filename, Contents: filename} :
            JSON.parse(res.Body);
    }

    var objectDictionary = {
        'threat-grid-get-sample-by-id': [
                {to: 'ID', from: 'id'},
                {to: 'Filename', from: 'filename'},
                {to: 'State', from: 'state'},
                {to: 'Status', from: 'status'},
                {to: 'MD5', from: 'md5'},
                {to: 'SHA1', from: 'sha1'},
                {to: 'SHA256', from: 'sha256'},
                {to: 'OS', from: 'os'},
                {to: 'OSVer', from: 'osver'},
                {to: 'SubmittedAt', from: 'submitted_at'},
                {to: 'StartedAt', from: 'started_at'},
                {to: 'CompletedAt', from: 'completed_at'},
            ],
        'threat-grid-upload-sample': [
                {to: 'ID', from: 'id'},
                {to: 'Filename', from: 'filename'},
                {to: 'State', from: 'state'},
                {to: 'Status', from: 'status'},
                {to: 'MD5', from: 'md5'},
                {to: 'SHA1', from: 'sha1'},
                {to: 'SHA256', from: 'sha256'},
                {to: 'OS', from: 'os'},
                {to: 'OSVer', from: 'osver'},
                {to: 'SubmittedAt', from: 'submitted_at'},
            ],
        'threat-grid-get-samples': [
                {to: 'ID', from: 'id'},
                {to: 'Filename', from: 'filename'},
                {to: 'State', from: 'state'},
                {to: 'Status', from: 'status'},
                {to: 'MD5', from: 'md5'},
                {to: 'SHA1', from: 'sha1'},
                {to: 'SHA256', from: 'sha256'},
                {to: 'OS', from: 'os'},
                {to: 'OSVer', from: 'osver'},
                {to: 'SubmittedAt', from: 'submitted_at'},
                {to: 'StartedAt', from: 'started_at'},
                {to: 'CompletedAt', from: 'completed_at'},
            ],
        'threat-grid-get-sample-state-by-id': [
                {to: 'State', from: 'state'},
                {to: 'ID', from: 'id'},
            ],
        'threat-grid-get-threat-summary-by-id': [
                {to: 'MaxConfidence', from: 'max-confidence'},
                {to: 'MaxSeverity', from: 'max-severity'},
                {to: 'Score', from: 'score'},
                {to: 'Count', from: 'count'},
                {to: 'ID', from: 'sample'},
            ],
    }

    var titleDictionary = {
        'threat-grid-upload-sample': 'Threat grid upload sample',
        'threat-grid-get-sample-state-by-id': 'Threat grid sample state',
        'threat-grid-get-sample-by-id': 'Threat grid get sample',
        'threat-grid-get-samples': 'Threat grid get samples',
        'threat-grid-get-threat-summary-by-id': 'Threat grid get threat summary'
    }

    var createHR = function(command, object) {
        if (!object) {
            return undefined;
        }
        if (titleDictionary[command]) {
            return tableToMarkdown(titleDictionary[command], object);
        }
        return undefined;
    }

    var contextDictionary = {
        'threat-grid-upload-sample': {
            ContextPath: 'ThreatGrid.Sample(val.ID == obj.ID)',
            ContentPath: 'data',
        },
        'threat-grid-get-sample-state-by-id': {
            ContextPath: 'ThreatGrid.Sample(val.ID == obj.ID)',
            ContentPath: 'data',
        },
        'threat-grid-get-sample-by-id': {
            ContextPath: 'ThreatGrid.Sample(val.ID == obj.ID)',
            ContentPath: 'data',
        },
        'threat-grid-get-samples': {
            ContextPath: 'ThreatGrid.Sample(val.ID == obj.ID)',
            ContentPath: 'data.items',
        },
        'threat-grid-get-threat-summary-by-id': {
            ContextPath: 'ThreatGrid.Sample(val.ID == obj.ID)',
            ContentPath: 'data',
        },
    }

    var fileCommands = {
        'threat-grid-get-video-by-id': '%id%.webm',
        'threat-grid-get-processes-by-id': '%id%-processes.json',
        'threat-grid-get-pcap-by-id': '%id%-pcap.json',
        'threat-grid-get-warnings-by-id': '%id%-warnings.json',
        'threat-grid-get-html-report-by-id': '%id%-report.html',
        'threat-grid-download-sample-by-id': '%id%-sample.zip',
        'threat-grid-download-artifact': '%aid%-artifact',
        'threat-grid-get-specific-feed': '%feed-name%-%feed-period%.%output-type%',
    };

    var methodDictionary = {
        'test-module': 'GET',
        'threat-grid-download-artifact': 'GET',
        'threat-grid-get-samples': 'GET',
        'threat-grid-get-sample-by-id': 'GET',
        'threat-grid-get-sample-state-by-id': 'GET',
        'threat-grid-get-samples-state': 'POST',
        'threat-grid-search-samples': 'GET',
        'threat-grid-upload-sample': 'POST',
        'threat-grid-search-submissions': 'GET',
        'threat-grid-get-video-by-id': 'GET',
        'threat-grid-get-analysis-by-id': 'GET',
        'threat-grid-get-processes-by-id': 'GET',
        'threat-grid-get-pcap-by-id': 'GET',
        'threat-grid-get-summary-by-id': 'GET',
        'threat-grid-get-threat-summary-by-id': 'GET',
        'threat-grid-get-html-report-by-id': 'GET',
        'threat-grid-download-sample-by-id': 'GET',
        'threat-grid-get-analysis-iocs': 'GET',
        'threat-grid-get-analysis-ioc': 'GET',
        'threat-grid-get-analysis-network-streams': 'GET',
        'threat-grid-get-analysis-network-stream': 'GET',
        'threat-grid-get-analysis-artifacts': 'GET',
        'threat-grid-get-analysis-artifact': 'GET',
        'threat-grid-get-analysis-processes': 'GET',
        'threat-grid-get-analysis-process': 'GET',
        'threat-grid-get-analysis-annotations': 'GET',
        'threat-grid-get-analysis-metadata': 'GET',
        'threat-grid-feeds-ip': 'GET',
        'threat-grid-feeds-domain': 'GET',
        'threat-grid-feeds-url': 'GET',
        'threat-grid-feeds-path': 'GET',
        'threat-grid-feeds-artifacts': 'GET',
        'threat-grid-feeds-network-stream': 'GET',
        'threat-grid-feeds-registry-key': 'GET',
        'threat-grid-who-am-i': 'GET',
        'threat-grid-user-get-rate-limit': 'GET',
        'threat-grid-get-specific-feed': 'GET',
    };

    var urlDict = {
        'test-module': 'samples',
        'threat-grid-get-samples': 'samples',
        'threat-grid-get-sample-by-id': 'samples/%id%',
        'threat-grid-get-sample-state-by-id': 'samples/%id%/state',
        'threat-grid-get-samples-state': 'samples/state',
        'threat-grid-search-samples': 'samples/search',
        'threat-grid-upload-sample': 'samples',
        'threat-grid-search-submissions': 'search/submissions',
        'threat-grid-get-video-by-id': 'samples/%id%/video.webm',
        'threat-grid-get-analysis-by-id': 'samples/%id%/analysis.json',
        'threat-grid-get-processes-by-id': 'samples/%id%/processes.json',
        'threat-grid-get-pcap-by-id': 'samples/%id%/network.json',
        'threat-grid-get-warnings-by-id': 'samples/%id%/warnings.json',
        'threat-grid-get-summary-by-id': 'samples/%id%/summary',
        'threat-grid-get-threat-summary-by-id': 'samples/%id%/threat',
        'threat-grid-get-html-report-by-id': 'samples/%id%/report.html',
        'threat-grid-download-sample-by-id': 'samples/%id%/sample.zip',
        'threat-grid-get-analysis-iocs': 'samples/%id%/analysis/iocs',
        'threat-grid-get-analysis-ioc': 'samples/%id%/analysis/%ioc%',
        'threat-grid-get-analysis-network-streams': 'samples/%id%/analysis/network_streams',
        'threat-grid-get-analysis-network-stream': 'samples/%id%/analysis/network_streams/%nsid%',
        'threat-grid-get-analysis-artifacts': 'samples/%id%/analysis/artifacts',
        'threat-grid-get-analysis-artifact': 'samples/%id%/analysis/artifacts/%aid%',
        'threat-grid-get-analysis-processes': 'samples/%id%/analysis/processes',
        'threat-grid-get-analysis-process': 'samples/%id%/analysis/processes/%pid%',
        'threat-grid-get-analysis-annotations': 'samples/%id%/analysis/annotations',
        'threat-grid-get-analysis-metadata': 'samples/%id%/analysis/metadata',
        'threat-grid-feeds-ip': 'iocs/feeds/ips',
        'threat-grid-feeds-domain': 'iocs/feeds/domains',
        'threat-grid-feeds-url': 'iocs/feeds/urls',
        'threat-grid-feeds-path': 'iocs/feeds/paths',
        'threat-grid-feeds-artifacts': 'iocs/feeds/artifacts',
        'threat-grid-feeds-network-stream': 'iocs/feeds/network_streams',
        'threat-grid-feeds-registry-key': 'iocs/feeds/registry_keys',
        'threat-grid-download-artifact': 'artifacts/%aid%/download',
        'threat-grid-who-am-i': 'session/whoami',
        'threat-grid-user-get-rate-limit': 'users/%login%/rate-limit',
        'threat-grid-get-specific-feed': 'feeds/%feed-name%-%feed-period%.%output-type%',
    };

    var rawResponse;
    var id = args.id;
    switch (command) {
      case 'test-module':
        args.limit = 1;
        sendRequest(methodDictionary['test-module'], urlDict['test-module'], args);
        return 'ok';
      case 'threat-grid-upload-sample':
        args['api_key'] = params.token;
        var fileId = args['file-id'];
        delete(args['file-id']);
        var res = httpMultipart(
                url + urlDict[command],
                fileId,
                {
                    Method: methodDictionary[command],
                },
                args,
                params.insecure,
                params.proxy,
                undefined,
                'sample',
                args.filename
            );
        if (res.StatusCode < 200 || res.StatusCode >= 300) {
            throw 'Request to ThreatGrid ' + urlDict[command] + ' failed, request status code: ' + res.StatusCode + ' and Body: ' + res.Body + '.';
        }
        rawResponse = JSON.parse(res.Body);
        break;
      case 'threat-grid-get-samples-state':
        args.ids = JSON.stringify(args.ids.split(','));
      default:
        // Get file name if such exists
        var filename = command in fileCommands && replaceInTemplates(fileCommands[command], args);
        rawResponse = sendRequest(
            methodDictionary[command],
            replaceInTemplatesAndRemove(urlDict[command], args),
            args,
            filename
        );
        if (filename){
            return rawResponse;
        }
    }

    var contextData = contextDictionary[command];
    var ec = {};
    var returnObject = objectDictionary[command] &&
      mapObjFunction(objectDictionary[command])(dq(rawResponse, contextData.ContentPath));
    if (contextData) {
        ec[contextData.ContextPath] = returnObject;
    }
    if (returnObject && !returnObject.ID) {
        returnObject.ID = id;
    }
    if (command === 'threat-grid-get-threat-summary-by-id' && returnObject.Score >= TERSHOLD) {
        var md5 = dq(invContext, "ThreatGrid.Sample(val=val.ID=='" + returnObject.ID + "').MD5");
        addMalicious(ec, outputPaths.file, {
            MD5: Array.isArray(md5) ? md5[0] : md5,
            Malicious: {Vendor: 'ThreatGrid', Description: 'Sample has score of ' + returnObject.Score + ' which is higher than treshold (80)'}
        });
    }

    return {
        Type: entryTypes.note,
        ContentsFormat: formats.json,
        Contents: rawResponse,
        ReadableContentsFormat: formats.markdown,
        HumanReadable: createHR(command, returnObject),
        EntryContext: (contextData && returnObject && ec) ? ec : undefined
    };
  type: javascript
  commands:
  - name: threat-grid-feeds-ip
    arguments:
    - name: ip
      description: Restrict returned records to this IP or CIDR block
    - name: before
      description: A date/time (ISO 8601), restricting results to samples submitted
        before it
    - name: after
      description: A date/time (ISO 8601), restricting results to samples submitted
        after it
    - name: confidence
      description: Restrict to IOCs with this confidence score or higher, defaults
        to 80
    - name: severity
      description: Restrict to IOCs with this severity score or higher, defaults to
        80
    - name: ioc
      description: Restrict returned records to events of this type
    - name: org_only
      description: If “true”, will only match against samples submitted by your organization
    - name: user_only
      description: ' If “true”, will only match against samples you submitted'
    - name: sample
      description: A comma-separated list of sample IDs. Restrict results to these
        samples.
    description: Get ips threat feed
  - name: threat-grid-feeds-domain
    arguments:
    - name: domain
      description: Restrict returned records to this domain or hostname
    - name: before
      description: A date/time (ISO 8601), restricting results to samples submitted
        before it
    - name: after
      description: A date/time (ISO 8601), restricting results to samples submitted
        after it
    - name: confidence
      description: Restrict to IOCs with this confidence score or higher, defaults
        to 80
    - name: severity
      description: Restrict to IOCs with this severity score or higher, defaults to
        80
    - name: ioc
      description: Restrict returned records to events of this type
    - name: org_only
      description: If “true”, will only match against samples submitted by your organization
    - name: user_only
      description: ' If “true”, will only match against samples you submitted'
    - name: sample
      description: A comma-separated list of sample IDs. Restrict results to these
        samples.
    description: Get domain threat feed
  - name: threat-grid-feeds-url
    arguments:
    - name: url
      description: Restrict returned records to this URL or URL fragment
    - name: before
      description: A date/time (ISO 8601), restricting results to samples submitted
        before it
    - name: after
      description: A date/time (ISO 8601), restricting results to samples submitted
        after it
    - name: confidence
      description: Restrict to IOCs with this confidence score or higher, defaults
        to 80
    - name: severity
      description: Restrict to IOCs with this severity score or higher, defaults to
        80
    - name: ioc
      description: Restrict returned records to events of this type
    - name: org_only
      description: If “true”, will only match against samples submitted by your organization
    - name: user_only
      description: ' If “true”, will only match against samples you submitted'
    - name: sample
      description: A comma-separated list of sample IDs. Restrict results to these
        samples.
    description: Get url threat feed
  - name: threat-grid-feeds-path
    arguments:
    - name: path
      description: Restrict returned records to this path or path fragment
    - name: before
      description: A date/time (ISO 8601), restricting results to samples submitted
        before it
    - name: after
      description: A date/time (ISO 8601), restricting results to samples submitted
        after it
    - name: confidence
      description: Restrict to IOCs with this confidence score or higher, defaults
        to 80
    - name: severity
      description: Restrict to IOCs with this severity score or higher, defaults to
        80
    - name: ioc
      description: Restrict returned records to events of this type
    - name: org_only
      description: If “true”, will only match against samples submitted by your organization
    - name: user_only
      description: ' If “true”, will only match against samples you submitted'
    - name: sample
      description: A comma-separated list of sample IDs. Restrict results to these
        samples.
    description: Get path threat feed
  - name: threat-grid-feeds-artifacts
    arguments:
    - name: sha256
      description: Restrict returned records with this sha256
    - name: sha1
      description: Restrict returned records with this sha1
    - name: md5
      description: Restrict returned records with this md5
    - name: path
      description: Restrict returned records to this path or path fragment.
    - name: before
      description: A date/time (ISO 8601), restricting results to samples submitted
        before it
    - name: after
      description: A date/time (ISO 8601), restricting results to samples submitted
        after it
    - name: confidence
      description: Restrict to IOCs with this confidence score or higher, defaults
        to 80
    - name: severity
      description: Restrict to IOCs with this severity score or higher, defaults to
        80
    - name: ioc
      description: Restrict returned records to events of this type
    - name: org_only
      description: If “true”, will only match against samples submitted by your organization
    - name: user_only
      description: ' If “true”, will only match against samples you submitted'
    - name: sample
      description: A comma-separated list of sample IDs. Restrict results to these
        samples.
    description: Get artifacts threat feed
  - name: threat-grid-feeds-network-stream
    arguments:
    - name: ip
      description: Restrict returned records to this IP address
    - name: port
      description: Restrict returned records to this port number
    - name: before
      description: A date/time (ISO 8601), restricting results to samples submitted
        before it
    - name: after
      description: A date/time (ISO 8601), restricting results to samples submitted
        after it
    - name: confidence
      description: Restrict to IOCs with this confidence score or higher, defaults
        to 80
    - name: severity
      description: Restrict to IOCs with this severity score or higher, defaults to
        80
    - name: ioc
      description: Restrict returned records to events of this type
    - name: org_only
      description: If “true”, will only match against samples submitted by your organization
    - name: user_only
      description: ' If “true”, will only match against samples you submitted'
    - name: sample
      description: A comma-separated list of sample IDs. Restrict results to these
        samples.
    description: Get network stream threat feed
  - name: threat-grid-feeds-registry-key
    arguments:
    - name: registry_key
      description: Restrict returned records to this registry_key
    - name: before
      description: A date/time (ISO 8601), restricting results to samples submitted
        before it
    - name: after
      description: A date/time (ISO 8601), restricting results to samples submitted
        after it
    - name: confidence
      description: Restrict to IOCs with this confidence score or higher, defaults
        to 80
    - name: severity
      description: Restrict to IOCs with this severity score or higher, defaults to
        80
    - name: ioc
      description: Restrict returned records to events of this type
    - name: org_only
      description: If “true”, will only match against samples submitted by your organization
    - name: user_only
      description: ' If “true”, will only match against samples you submitted'
    - name: sample
      description: A comma-separated list of sample IDs. Restrict results to these
        samples.
    description: Get registry keys threat feed
  - name: threat-grid-get-samples
    arguments:
    - name: limit
      description: The most results to be returned in the response
    - name: offset
      description: The number of records to skip
    - name: sha256
      description: A sha256 of the submitted sample, only matches samples, not their
        artifacts
    - name: md5
      description: A MD5 of the submitted sample, only matches samples, not their
        artifacts
    - name: sha1
      description: A sha1 of the submitted sample, only matches samples, not their
        artifacts
    - name: id
      description: a sample ID
    - name: ids
      description: a comma-separated list of sample IDs
    - name: ioc
      description: an IOC name
    - name: before
      description: A date/time (ISO 8601), restricting results to samples submitted
        before it
    - name: after
      description: A date/time (ISO 8601), restricting results to samples submitted
        after it
    - name: org_only
      description: If “true”, will only match against samples submitted by your organization
    - name: user_only
      description: If “true”, will only match against samples you submitted
    outputs:
    - contextPath: ThreatGrid.Sample.ID
      description: The sample id
    - contextPath: ThreatGrid.Sample.Filename
      description: The sample filename
    - contextPath: ThreatGrid.Sample.State
      description: The sample state
    - contextPath: ThreatGrid.Sample.Status
      description: The sample status
    - contextPath: ThreatGrid.Sample.MD5
      description: The sample md5
    - contextPath: ThreatGrid.Sample.SHA1
      description: The sample sha1
    - contextPath: ThreatGrid.Sample.SHA256
      description: The sample sha256
    - contextPath: ThreatGrid.Sample.OS
      description: The sample os
    - contextPath: ThreatGrid.Sample.OSVer
      description: The sample ov version
    - contextPath: ThreatGrid.Sample.SubmittedAt
      description: The sample submission time
    - contextPath: ThreatGrid.Sample.StartedAt
      description: The sample analysis starting time
    - contextPath: ThreatGrid.Sample.CompletedAt
      description: The sample completion time
    description: Get samples from threat grid
  - name: threat-grid-get-sample-by-id
    arguments:
    - name: id
      required: true
      default: true
      description: The sample ID
    outputs:
    - contextPath: ThreatGrid.Sample.ID
      description: The sample id
    - contextPath: ThreatGrid.Sample.Filename
      description: The sample filename
    - contextPath: ThreatGrid.Sample.State
      description: The sample state
    - contextPath: ThreatGrid.Sample.Status
      description: The sample status
    - contextPath: ThreatGrid.Sample.MD5
      description: The sample md5
    - contextPath: ThreatGrid.Sample.SHA1
      description: The sample sha1
    - contextPath: ThreatGrid.Sample.SHA256
      description: The sample sha256
    - contextPath: ThreatGrid.Sample.OS
      description: The sample os
    - contextPath: ThreatGrid.Sample.OSVer
      description: The sample ov version
    - contextPath: ThreatGrid.Sample.SubmittedAt
      description: The sample submission time
    - contextPath: ThreatGrid.Sample.StartedAt
      description: The sample analysis starting time
    - contextPath: ThreatGrid.Sample.CompletedAt
      description: The sample completion time
    description: Get threat grid sample by id
  - name: threat-grid-get-sample-state-by-id
    arguments:
    - name: id
      required: true
      default: true
      description: The sample ID
    outputs:
    - contextPath: ThreatGrid.Sample.ID
      description: The sample id
    - contextPath: ThreatGrid.Sample.State
      description: The sample state
    description: Get threat grid sample state by id
  - name: threat-grid-get-samples-state
    arguments:
    - name: ids
      required: true
      default: true
      description: IDs to get state of, comma separated
    description: Get threat grid samples state
  - name: threat-grid-upload-sample
    arguments:
    - name: file-id
      required: true
      default: true
      description: The sample file
    - name: filename
      required: true
      description: The real file name
    - name: os
      description: a string identifying the source OS
    - name: osver
      description: a string defining the OS version.
    - name: vm
      description: a string identifying a specific VM to use
    - name: private
      description: if present, and set to any value but “false” the sample will be
        marked private
    - name: source
      description: a string identifying the source (user defined)
    - name: tags
      description: A comma-separated list of tags applied to this sample.
    outputs:
    - contextPath: ThreatGrid.Sample.ID
      description: The sample id
    - contextPath: ThreatGrid.Sample.Filename
      description: The sample filename
    - contextPath: ThreatGrid.Sample.State
      description: The sample state
    - contextPath: ThreatGrid.Sample.Status
      description: The sample status
    - contextPath: ThreatGrid.Sample.MD5
      description: The sample md5
    - contextPath: ThreatGrid.Sample.SHA1
      description: The sample sha1
    - contextPath: ThreatGrid.Sample.SHA256
      description: The sample sha256
    - contextPath: ThreatGrid.Sample.OS
      description: The sample os
    - contextPath: ThreatGrid.Sample.OSVer
      description: The sample ov version
    - contextPath: ThreatGrid.Sample.SubmittedAt
      description: The sample submission time
    description: Submits a sample to threat grid for analysis
  - name: threat-grid-search-submissions
    arguments:
    - name: q
      description: Query text.
    - name: user_only
      description: Only display submissions created by the current user, as determined
        by the value of api_key
    - name: org_only
      description: Only display submissions created by the current user's organization,
        as determined by the value of api_key.
    - name: term
      description: Restrict matches to a subset of submission fields. The value of
        'term' is a comma-delimited list of strings which select groups of fields
    - name: before
      description: Return submissions created before specified time. Value is a timestring,
        either ISO-8601, or free-form (see documentation for 'chronic,' at https://github.com/mojombo/chronic)
    - name: after
      description: Return submissions created after specified time. Value is a timestring,
        either ISO-8601, or free-form (see documentation for 'chronic,' at https://github.com/mojombo/chronic).
    - name: state
      description: 'Restrict match to submissions in specific state or states. Value
        is a comma-delimited string containing one or more of the values:  wait proc
        succ fail'
    - name: advanced
      description: 'Interpret ''q'' as an advanced elasticsearch query, allowing matches
        by specific field, for instance:  https:// ... /search/submissions?q=sha256:1b4468
        ... &advanced=true'
    - name: sort_by
      description: Sorts by timestamp, submitted_at, analyzed_at, filename, type,
        state, threat or threat_score, login
    - name: sort_order
      description: desc or asc
    - name: limit
      description: Restrict the number of records returned.
    - name: offset
      description: Return matching submissions starting at the given offset.
    - name: highlight
      description: Provide a 'matches' field in results, indicating which fields were
        matched
    description: Search threat grid submissions
  - name: threat-grid-get-video-by-id
    arguments:
    - name: id
      required: true
      default: true
      description: The sample id
    description: Get the sample analysis video by id
  - name: threat-grid-get-analysis-by-id
    arguments:
    - name: id
      required: true
      default: true
      description: The sample id
    description: The detailed overview of dynamic and static analysis results for
      the sample
  - name: threat-grid-get-processes-by-id
    arguments:
    - name: id
      required: true
      default: true
      description: The sample id
    description: A JSON object which contains a timeline of all process activity as
      determined by the dynamic analysis engine
  - name: threat-grid-get-pcap-by-id
    arguments:
    - name: id
      required: true
      default: true
      description: The sample id
    description: Gets the tcpdump PCAP file, with all the network activity of the
      sample
  - name: threat-grid-get-warnings-by-id
    arguments:
    - name: id
      required: true
      default: true
      description: The sample id
    description: Gets a JSON structure describing any warnings that occured during
      the analysis
  - name: threat-grid-get-summary-by-id
    arguments:
    - name: id
      required: true
      default: true
      description: The sample id
    description: Returns summary analysis information
  - name: threat-grid-get-threat-summary-by-id
    arguments:
    - name: id
      required: true
      default: true
      description: The sample id
    outputs:
    - contextPath: ThreatGrid.Sample.ID
      description: The sample id
    - contextPath: ThreatGrid.Sample.MaxSeverity
      description: The sample max severity
    - contextPath: ThreatGrid.Sample.Score
      description: The sample score
    - contextPath: ThreatGrid.Sample.Count
      description: The sample count
    - contextPath: ThreatGrid.Sample.MaxConfidence
      description: The sample max confidence
    - contextPath: File.Malicious.Vendor
      description: For malicious files, the vendor that made the decision
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason for the vendor to make the decision
    description: Returns a summary of the threats detected during analysis
  - name: threat-grid-get-html-report-by-id
    arguments:
    - name: id
      required: true
      default: true
      description: The sample id
    description: Gets the report.html file is a stand-alone, complete report on the
      sample run. It is designed to be emailed or printed
  - name: threat-grid-download-sample-by-id
    arguments:
    - name: id
      required: true
      default: true
      description: The sample id
    description: Gets the sample.zip file is an archive of the sample itself, in a
      zip format to as a form of quarantine
  - name: threat-grid-get-analysis-iocs
    arguments:
    - name: id
      required: true
      default: true
      description: The sample id
    description: Returns a JSON list of the Indicators of Compromise identified in
      this sample run
  - name: threat-grid-get-analysis-ioc
    arguments:
    - name: id
      required: true
      default: true
      description: The sample id
    - name: ioc
      required: true
      description: The ioc requested
    description: Returns data regarding the specified Indicator of Compromise
  - name: threat-grid-get-analysis-network-streams
    arguments:
    - name: id
      required: true
      default: true
      description: The sample id
    description: Returns the network stream analysis
  - name: threat-grid-get-analysis-artifacts
    arguments:
    - name: id
      required: true
      default: true
      description: The sample id
    description: Returns the sample id artifacts
  - name: threat-grid-get-analysis-network-stream
    arguments:
    - name: id
      required: true
      default: true
      description: The sample id
    - name: nsid
      required: true
      description: The network stream id
    description: Returns data regarding a specific network stream
  - name: threat-grid-get-analysis-artifact
    arguments:
    - name: id
      required: true
      default: true
      description: The sample id
    - name: aid
      required: true
      description: The artificatd id requested
    description: Returns the sample id artifact with artifact id
  - name: threat-grid-get-analysis-processes
    arguments:
    - name: id
      required: true
      default: true
      description: The sample id
    description: Returns data regarding the analysis processes
  - name: threat-grid-get-analysis-process
    arguments:
    - name: id
      required: true
      default: true
      description: The sample id
    - name: pid
      required: true
      description: The process id requested
    description: Returns data regarding the specifiic process id in the analysis
  - name: threat-grid-get-analysis-annotations
    arguments:
    - name: id
      required: true
      default: true
      description: The sample id
    description: Returns data regarding the annotations of the anlysis
  - name: threat-grid-get-analysis-metadata
    arguments:
    - name: id
      required: true
      default: true
      description: The sample id
    description: Returns metadata about the analysis
  - name: threat-grid-download-artifact
    arguments:
    - name: aid
      required: true
      default: true
      description: the artifact id (sha 256)
    description: Download artifact
  - name: threat-grid-who-am-i
    arguments: []
    description: Get logged in user
  - name: threat-grid-user-get-rate-limit
    arguments:
    - name: login
      description: User login name
      required: true
      default: true
    description: Get rate limit for user
  - name: threat-grid-get-specific-feed
    arguments:
    - name: feed-name
      required: true
      default: true
      description: The feed name
    - name: feed-period
      description: Feed period (hourly/daily)
      required: true
      auto: PREDEFINED
      predefined:
      - hourly
      - daily
    - name: output-type
      description: The output type
      defaultValue: json
    description: Gets a specific threat feed
hidden: false
toversion: 3.1.0
