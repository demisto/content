commonfields:
  id: ServiceNow
  version: -1
name: ServiceNow
display: ServiceNow
category: Case Management
image: data:image/png;base64,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
description: IT service management
configuration:
- display: ServiceNow URL, in the format https://company.service-now.com/
  name: url
  defaultvalue: ""
  type: 0
  required: true
- display: Username
  name: credentials
  defaultvalue: ""
  type: 9
  required: false
- display: Use system proxy settings
  name: proxy
  defaultvalue: "True"
  type: 8
  required: false
- display: Trust any certificate (unsecure)
  name: insecure
  defaultvalue: "false"
  type: 8
  required: false
- display: Default ticket type of commands. Can be incident, sc_request, problem or
    change_reuquest. Commands also take ticket_type argument
  name: ticket_type
  defaultvalue: incident
  type: 0
  required: false
- display: ServiceNow API Version (e.g. 'v1')
  name: api_version
  defaultvalue: ""
  type: 0
  required: false
- display: Fetch incidents
  name: isFetch
  defaultvalue: ""
  type: 8
  required: false
- display: The query to use when fetching ServiceNow incidents
  name: sysparm_query
  defaultvalue: stateNOT IN6,7
  type: 0
  required: false
- display: How many ServiceNow incidents to fetch each time
  name: fetch_limit
  defaultvalue: "10"
  type: 0
  required: false
- display: Incident type
  name: incidentType
  defaultvalue: ""
  type: 13
  required: false
script:
  script: |-
    var username = params.credentials.identifier;
    var password = params.credentials.password;
    var serverUrl = params.url;

    if (serverUrl[serverUrl.length - 1] !== '/') {
        serverUrl += '/';
    }

    var defaults = {limit:10, fetch_limit:10};

    var identLevel = function(count) {
        var ret='';
        for (var i=0;i<count;i++) {
            ret += '     ';
        }
        return ret;
    };

    var flattenValue = function(value,level) {
        if (!level) {
            level=0;
        }
        if (!value || value == '') {
            return '<br>';
        } else if (typeof value == 'string') {
            return value.replace(/(\n)/gm," ") + '<br>';
        } else {
            var ret = (level>0) ? identLevel(level-1) + '{ <br>' : '';
            for (key in value) {
                ret += identLevel(level) + key + ': ' + flattenValue(value[key],level+1);
            }
            return (level>0) ? ret + identLevel(level-1) + '}<br>' : ret;
        }
    };

    var getBody = function(templateName, cusFields) {
        var body = {};
        var tmpRes;

        if (templateName){
            tmpRes = SNGetTemplate(templateName);
        }

        for (var i=0;i<snArgs.length;i++){
            if (args[snArgs[i]]) {
                body[snArgs[i]]=args[snArgs[i]];
            }else{
                if (templateName !== undefined &&
                    snArgs[i] in tmpRes){
                        body[snArgs[i]] = tmpRes[snArgs[i]];
                    }
            }
        }

        if(cusFields){
            for (fd in cusFields){
                body["u_"+fd] = cusFields[fd];
            }
        }

        return body;
    }

    var snArgs = ["active", "activity_due", "short_description", "additional_assignee_list", "approval_history", "approval_set", "assigned_to", "assignment_group",
         "business_duration", "business_service", "business_stc", "calendar_duration", "calendar_stc", "caller_id", "caused_by", "close_code", "close_notes",
         "closed_at", "closed_by", "cmdb_ci", "comments", "comments_and_work_notes", "company", "contact_type", "correlation_display", "correlation_id",
         "delivery_plan", "delivery_task", "description", "due_date", "expected_start", "follow_up", "group_list", "hold_reason", "impact", "incident_state",
         "knowledge", "location", "made_sla", "notify", "order", "parent", "parent_incident", "priority", "problem_id", "resolved_at", "resolved_by", "rfc",
         "severity", "sla_due", "state", "subcategory", "sys_tags", "time_worked", "urgency", "user_input", "watch_list", "work_end", "work_notes", "work_notes_list",
         "work_start", "impact", "incident_state", "title", "type", "category", "state"];

    var sendRequest = function(method, path, headers, body, file_id) {
        if (!headers) {
            headers = {
                'Accept': ['application/json'],
                'Content-Type': ['application/json']
            };
        }
        body = (body) ? body : '';
        var api = '/api/now/';
        if (params.api_version) {
            api += params.api_version + '/';
        }
        var url = serverUrl + api + path;

        var res;
        if (file_id) {
            res = httpMultipart(url,file_id,{Headers: headers, Username: username,Password: password},body,params.insecure,params.proxy,false,'uploadFile', body.file_name,true);
        } else {
            res = http(url,{Method: method,Headers: headers,Body: body, Username: username,Password: password},params.insecure,params.proxy);
        }
        try {
            obj = JSON.parse(res.Body);
        } catch (ex) {
            throw 'Error parsing reply - ' + res.Body + ' - ' + ex;
        }

        if (obj.error) {
            throw 'ServiceNow Error: ' + obj.error.detail;
        }
        if (res.StatusCode < 200 || res.StatusCode >= 300) {
            throw 'ServiceNow Error: Failed to perform request. request status: ' + res.Status;
        }

        try {
            var obj = JSON.parse(res.Body);
            return {body: res.Body, obj: obj};
        } catch (ex) {
            throw 'Error parsing reply - ' + res.Body + ' - ' + ex;
        }
    }

    var mdDict = {
        'default': {
            number: 'Number',
            sys_id: 'System ID',
            state:  'State',
            impact: 'Impact',
            priority:'Priority',
            severity:'Severity',
            urgency:'Urgency',
            sys_created_on:'Created On',
            sys_created_by:'Created by',
            active:'Active',
            close_notes:'Close notes',
            description:'Description',
            opened_at:'Opened at',
            due_date:'Due date',
            closed_by:'Resolved by',
            closed_at:'Resolved at',
            sla_due:'SLA due',
            short_description:'Short description',
        },
        'servicenow-create': {
            number:'Number',
            sys_id:'Sys ID',
            state:  'State',
            impact: 'Impact',
            priority:'Priority',
            severity:'Severity',
            urgency:'Urgency',
            sys_created_on:'Created On',
            sys_created_by:'Created by',
            short_description:'Short description'
        },
        'servicenow-upload-file': {
            file_name: 'Filename',
            download_link: 'Download link',
            sys_id: 'System ID'
        },
        'servicenow-incident-create': {
            number:'Number',
            sys_id:'Sys ID',
            state:  'State',
            impact: 'Impact',
            priority:'Priority',
            severity:'Severity',
            urgency:'Urgency',
            sys_created_on:'Created On',
            sys_created_by:'Created by',
            short_description:'Short description'
        },
        'servicenow-incident-upload-file': {
            file_name: 'Filename',
            download_link: 'Download link',
            sys_id: 'System ID'
        }
    };

    var ticketEc = function(data) {
        return {
                "ID":data["sys_id"],
                "Creator":data["opened_by"]["value"],
                "Assignee":data["assigned_to"]["value"],
                "State":data["state"],
                "Summary":data["short_description"],
                "Number":data["number"]
            };
    }

    var dataToEc = function(data) {
        var ec = {};
        if (Array.isArray(data)) {
            ec.Ticket=[];
            for (var i=0;i<data.length;i++) {
                ec.Ticket.push(ticketEc(data[i]));
            }
        } else {
            ec.Ticket = ticketEc(data);
        }
        return ec;
    }

    var dataToMd = function(command,data) {
        var md;
        var head='|';
        var line='|';

        var dict = (command in mdDict) ? mdDict[command] : mdDict['default'];

        for (key in dict) {
            head += dict[key] + '|';
            line += '-|';
        }

        md = head + '\n' + line + '\n';
        data = (Array.isArray(data))? data : [data];
        for (var i=0;i<data.length;i++) {
            md += '|';
            for (key in dict) {
                md +=flattenValue(data[i][key]) + '|'
            }
            md += '\n';
        }
        return md;
    }

    var SNGetIncident = function() {
        var ticket_type = getTableName();
        if (args.id) {
            var path = "table/"+ticket_type+"/"+args['id'];
        } else if (args.number) {
            var path = "table/"+ticket_type + encodeToURLQuery({sysparm_query:"number="+args.number});
        } else {
            throw 'incindet-get requires either incident ID (sys_id) or incdent number';
        }
        res = sendRequest('GET',path);
        if (res && res.obj && res.obj.result) {
            var md = "### Service now incident\n";
            md += dataToMd(command,res.obj.result);
            var ec = {};
            ec = dataToEc(res.obj.result);
        } else {
            var md = 'Cannot find incident\n';
        }
        return ( {'ContentsFormat': formats['json'], 'Type': entryTypes['note'], 'Contents': res.obj.result, "HumanReadable": md, "EntryContext": ec} );
    }

    var SNUpdate = function(){
        var cusFields;

        var ticket_type = getTableName();

        if (args.custom_fields){
            cusFields = splitCusFilds(args.custom_fields);
        }

        var body = getBody(args.template, cusFields);

        var path = "table/"+ticket_type+"/"+args["id"];
        var res = sendRequest('PATCH',path,null,JSON.stringify(body));
        var md = "### ServiceNow incident updated\n";
        md += "### Ticket type: " + ticket_type + '\n';
        md += dataToMd(command,res.obj.result);
        return ( {'ContentsFormat': formats['json'], 'Type': entryTypes['note'], 'Contents': res.obj.result, "HumanReadable": md} );
    }


    var splitCusFilds = function(cusFields){
        var dicFields = {};
        var arrFields = cusFields.split(';');

        for(var i=0; i<arrFields.length; i++){
            var field = arrFields[i].split('=');
            if (field.length > 1){
                dicFields[field[0]] = field[1];
            }
        }

        return dicFields;
    }

    var SNCreate = function(){
        var cusFields;

        if (args.custom_fields){
            cusFields = splitCusFilds(args.custom_fields);
        }

        var body = getBody(args.template, cusFields);

        var ticket_type = getTableName();
        var path = "table/"+ticket_type;
        var res = sendRequest('POST',path,null,JSON.stringify(body));
        var md = "### ServiceNow incident created\n";
        md += "### Ticket type: " + ticket_type + '\n';
        md += dataToMd(command,res.obj.result);
        var ec = dataToEc(res.obj.result);
        return ( {'ContentsFormat': formats['json'], 'Type': entryTypes['note'], 'Contents': res.obj.result, "HumanReadable": md, "EntryContext": ec} );
    }

    var SNAddLink = function(){
        var key=(args['post-as-comment']=='true')?'comments':'work_notes';
        var ticket_type = getTableName();
        var text=(args.text) ? args.text : args.link;
        var link='[code]<a class="web" target="_blank" href="'+args.link+'" >'+text+'</a>[/code]';
        var body={};
        body[key]=link;
        var path = "table/"+ticket_type+"/" + args["id"];
        var res = sendRequest('PATCH',path,null,JSON.stringify(body));
        var md = "### Link added to ServiceNow incident\n";
        md += dataToMd(command,res.obj.result);
        return ( {'ContentsFormat': formats['json'], 'Type': entryTypes['note'], 'Contents': res.obj.result, "HumanReadable": md} );
    }

    var SNAddComment = function(){
        var key=(args['post-as-comment']=='true')?'comments':'work_notes';
        var ticket_type = getTableName();
        var text=args.comment;
        var body={};
        body[key]=text;
        var path = "table/"+ticket_type+"/" + args["id"];
        var res = sendRequest('PATCH',path,null,JSON.stringify(body));
        var md = "### Link added to ServiceNow incident\n";
        md += dataToMd(command,res.obj.result);
        return ( {'ContentsFormat': formats['json'], 'Type': entryTypes['note'], 'Contents': res.obj.result, "HumanReadable": md} );
    }

    var getTableName = function(){
        if (args.ticket_type !== undefined){
            return args.ticket_type;
        }else {
            if (params.ticket_type !== undefined){
                return params.ticket_type;
            }else {
                return "incident";
            }
        }
    }
    var SNQuery = function(){
        var parameters={};
        parameters.sysparm_limit = (args.limit) ? args.limit : defaults.limit;
        if (args.sysparm_query) {
            parameters.sysparm_query = args.sysparm_query;
        }

        var ticket_type = getTableName();
        var path = "table/"+ticket_type + encodeToURLQuery(parameters);
        res = sendRequest('GET',path);
        var md = "### ServiceNow incidents\n";
        md += dataToMd(command,res.obj.result);
        var ec = dataToEc(res.obj.result);
        return ( {'ContentsFormat': formats['json'], 'Type': entryTypes['note'], 'Contents': res.obj.result, "HumanReadable": md, "EntryContext": ec} );
    }

    var addMinutes = function(date, minutes) {
        return new Date(date.getTime() + minutes*60000);
    }

    var getServiceNowTime = function(minutesOffset) {
        var time = new Date();
        time = addMinutes(time,time.getTimezoneOffset());
        time = (minutesOffset) ? addMinutes(time,minutesOffset) : time;

        var month = "0" + (time.getMonth()+1);
        var day = "0" + time.getDate();
        var hours = "0" + time.getHours();
        var minutes = "0" + time.getMinutes();
        var seconds = "0" + time.getSeconds();
        var dateOld = time.getFullYear()+'-'+month.substr(-2)+'-'+day.substr(-2);
        var timeOld = hours.substr(-2) + ':' + minutes.substr(-2) + ':' + seconds.substr(-2);
        sertime = dateOld+" "+timeOld;
        return sertime;
    }

    var SNUploadFile = function(){
        var headers = {
            'Accept': ['application/json'],
            'Content-Type': ['multipart/form-data']
            };
        var ticket_type = getTableName();
        var body = {
            table_name:ticket_type,
            table_sys_id: args['id']
        };
        if (args.file_name) {
            body.file_name = args['file_name'];
        } else {
            body.file_name = dq(invContext,"File(val.EntryID=='"+args.file_id+"').Name");
        }
        body.file_name = (Array.isArray(body.file_name)) ? body.file_name[0]: body.file_name;

        var path = "attachment/upload";
        var res = sendRequest('POST',path,headers,body,args.file_id);

        var result = res.obj.result;
        var md='### File uploaded\n';
        md += dataToMd(command,result);

        return ( {'ContentsFormat': formats['json'], 'Type': entryTypes['note'], 'Contents': result, "HumanReadable": md} );
    }


    var fetchIncidents = function() {
        var parameters={};
        var incidents = [];

        var now = getLastRun();

        if (!now.time) {
            sertime = getServiceNowTime(-10);
        } else {
            sertime = now.time;
        }

        parameters.sysparm_query = "ORDERBYopened_at^opened_at>"+sertime;
        if (params.sysparm_query) {
            parameters.sysparm_query += "^" + params.sysparm_query;
        }
        parameters.sysparm_limit = (params.fetch_limit) ? params.fetch_limit : defaults.fetch_limit;

        var path = "table/" + params.ticket_type + encodeToURLQuery(parameters);

        res = sendRequest('GET',path);

        for (var i=0;i<res.obj.result.length;i++) {
            var incident = res.obj.result[i];
            var labels = [];

            for(var atr in res.obj.result[i]){
                if (typeof res.obj.result[i][atr] == 'string') {
                    labels.push({'type':atr,'value':res.obj.result[i][atr]});
                } else {
                    labels.push({'type':atr,"value":JSON.stringify(res.obj.result[i][atr])});
                }
            }

            var severity = (incident.severity) ? parseInt(incident.severity) : 0;
            incidents.push({
                "name": 'ServiceNow Incident ' + incident["number"],
                "labels": labels,
                "details" : JSON.stringify(incident),
                "severity" : severity,
                "rawJSON": JSON.stringify(incident)
            });

            sertime = incident.opened_at;
        }

        setLastRun({'time': sertime});

        return (JSON.stringify(incidents));
    }


    var SNGetTemplate = function(name){
        var parameters={};
        parameters.sysparm_limit = 1;
        parameters.sysparm_query = "name="+name;

        var ticket_type = "sys_template";
        var path = "table/"+ticket_type + encodeToURLQuery(parameters);
        res = sendRequest('GET',path);

        if(res.obj.result.length === 0){
            throw "Incorrect template name";
        }

        var tmpRes = res.obj.result[0].template.split('^');
        var dicRes = {};

        for(var i=0; i<tmpRes.length-1; i++){
            if (tmpRes[i].split('=').length > 1){
                dicRes[tmpRes[i].split('=')[0]] = tmpRes[i].split('=')[1];
            }
        }

        return dicRes;
    }


    var SNGetGroups = function(name){
        var parameters={};
        var ticket_type = "sys_user_group";
        var path = "table/"+ticket_type + encodeToURLQuery(parameters);
        res = sendRequest('GET',path).obj;
        var md = '## ServiceNow groups\n';
        var ec = {ServiceNowGroups: []};
        for (var i = 0; i < res.result.length; i++) {
            var headerTran = function(name) {
                var headers = {
                    sys_id: 'Id',
                    name: 'Name',
                    description: 'Description',
                    email: 'Email',
                    active: 'Active',
                    manager: 'Manager'
                }
                if (headers[name]) {
                    return headers[name];
                } else {
                    return name;
                }
            };
            if (name) {
                if (res.result[i].name === name) {
                    md += tableToMarkdown('ServiceNow Group', res.result[i], ['sys_id', 'name', 'description', 'email', 'active', 'manager'], '', headerTran);
                    ec.ServiceNowGroups.push({
                        GroupId: res.result[i].sys_id,
                        GroupName: res.result[i].name
                    });
                }
            } else {
                md += tableToMarkdown('ServiceNow Group', res.result[i], ['sys_id', 'name', 'description', 'email', 'active', 'manager'], '', headerTran);
                    ec.ServiceNowGroups.push({
                        GroupId: res.result[i].sys_id,
                        GroupName: res.result[i].name
                    });
            }
        }
        return {'ContentsFormat': formats['json'], 'Type': entryTypes['note'], 'Contents': res, "HumanReadable": md, "EntryContext": ec};
    };
    
    var SNGetComputer = function (computerName) {
        var ticket_type = "cmdb_ci_computer";
        if (computerName) {
            var path = "table/" + ticket_type + encodeToURLQuery({ sysparm_query: "u_code=" + computerName });

            res = sendRequest('GET', path);

            var md = '## ServiceNow Computer\n';
            var ec = { ServiceNowComputer: [] };

            var headerTran = function (headerName) {
                var headers = {
                    sys_id: 'Id',
                    u_code: 'u_code (computer name)',
                    support_group: 'support group',
                    os: 'operating system',
                    comments: 'comments'
                }
                if (headers[headerName]) {
                    return headers[headerName];
                } else {
                    return headerName;
                }
            };

            if (res.obj.result[0].u_code === computerName) {
                md += tableToMarkdown('ServiceNow Computer', res.obj.result[0], ['sys_id', 'u_code', 'support_group','os','comments'], '', headerTran);
                ec.ServiceNowComputer.push({
                    sys_id: res.obj.result[0].sys_id,
                    u_code: res.obj.result[0].u_code,
                    support_group: res.obj.result[0].support_group.value,
                    os: res.obj.result[0].os,
                    comments: res.obj.result[0].comments
                });
            }

            return { 'ContentsFormat': formats['json'], 'Type': entryTypes['note'], 'Contents': res, "HumanReadable": md, "EntryContext": ec };
        } else {
            throw 'incident-get-computer requires a computerName (snow field u_code)';
        }
    };
    if (!params.ticket_type) {
        params.ticket_type = 'incident';
    }

    switch (command) {
        case "servicenow-get":
        case "servicenow-incident-get":
            return SNGetIncident();
        case "servicenow-query":
        case "servicenow-incidents-query":
            return SNQuery();
        case 'servicenow-update':
        case 'servicenow-incident-update':
            return SNUpdate();
        case "servicenow-create":
        case "servicenow-incident-create":
            return SNCreate();
        case "servicenow-add-link":
        case "servicenow-incident-add-link":
            return SNAddLink();
        case "servicenow-add-comment":
        case "servicenow-incident-add-comment":
            return SNAddComment();
        case "servicenow-upload-file":
        case "servicenow-incident-upload-file":
            return SNUploadFile();
        case 'servicenow-get-groups':
            return SNGetGroups(args.name);
        case 'servicenow-get-computer':
            return SNGetComputer(args.computerName);
        case 'fetch-incidents':
            return fetchIncidents();
        case 'test-module':
            var path = "table/incident?sysparm_limit=1";
            res = sendRequest('GET',path);
            var obj  = res.obj;
            if (!obj.result) {
                throw 'ServiceNow error: ' + JSON.stringify(res);
            }
            return 'ok';
        default:
            throw 'ServiceNow unknown command';
    }
  type: javascript
  commands:
  - name: servicenow-get
    arguments:
    - name: id
      default: true
      description: Incident ID to retrieve
    - name: ticket_type
      auto: PREDEFINED
      predefined:
      - incident
      - problem
      - change_request
      - sc_request
      description: Ticket type to create
      defaultValue: incident
    - name: number
      description: Incident number to retrieve
    outputs:
    - contextPath: Ticket.Id
      description: ServiceNow incident ID
    - contextPath: Ticket.Creator
      description: ServiceNow ticket creator
    - contextPath: Ticket.Assignee
      description: ServiceNow ticket assignee
    - contextPath: Ticket.State
      description: ServiceNow ticket state
    - contextPath: Ticket.Summary
      description: ServiceNow ticket short summary
    description: Retrieve ticket information by specific ticket ID
  - name: servicenow-incident-get
    deprecated: true
    arguments:
    - name: id
      default: true
      description: Incident ID to retrieve
    - name: ticket_type
      auto: PREDEFINED
      predefined:
      - incident
      - problem
      - change_request
      description: Ticket type to create
      defaultValue: incident
    - name: number
      description: Incident number to retrieve
    outputs:
    - contextPath: Ticket.Id
      description: ServiceNow incident ID
    - contextPath: Ticket.Creator
      description: ServiceNow ticket creator
    - contextPath: Ticket.Assignee
      description: ServiceNow ticket assignee
    - contextPath: Ticket.State
      description: ServiceNow ticket state
    - contextPath: Ticket.Summary
      description: ServiceNow ticket short summary
    description: Retrieve ticket information by specific ticket ID
  - name: servicenow-create
    arguments:
    - name: short_description
      description: Short description of the ticket
    - name: ticket_type
      auto: PREDEFINED
      predefined:
      - incident
      - problem
      - change_request
      - sc_request
      description: Ticket type to create
      defaultValue: incident
    - name: urgency
      description: Ticket urgency
    - name: severity
      description: Ticket severity
    - name: impact
      description: Ticket impact
    - name: active
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Set incident as Active
    - name: activity_due
      description: Set incident ActivityDue - format "2016-07-02 21:51:11" glide_date_time
    - name: additional_assignee_list
      description: List of assigned users to the ticket
    - name: approval_history
      description: Ticket history approval
    - name: approval_set
      description: Set incident ApprovalSet - format "2016-07-02 21:51:11" glide_date_time
    - name: assigned_to
      description: To whom the ticket is assigned
    - name: business_duration
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: business_service
      description: Business service
    - name: business_stc
      description: Business source
    - name: calendar_duration
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: caller_id
      description: UID Format
    - name: category
      description: Category of ticket
    - name: caused_by
      description: UID Format
    - name: close_code
      description: Ticket's close code
    - name: close_notes
      description: Close notes of the ticket
    - name: closed_at
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: closed_by
      description: User who closed the ticket
    - name: cmdb_ci
      description: UID Format
    - name: comments
      description: Format type journal input
    - name: comments_and_work_notes
      description: Format type journal input
    - name: company
      description: UID Format
    - name: contact_type
      description: Contact type
    - name: correlation_display
      description: Correlation display
    - name: correlation_id
      description: Correlation id
    - name: delivery_plan
      description: UID Format
    - name: display
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: If you want to display comments, work_notes...
    - name: description
      description: Ticket description
    - name: due_date
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: escalation
      description: Escalation
    - name: expected_start
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: follow_up
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: group_list
      description: UID format list
    - name: knowledge
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Is the ticket solved in the knowledge base
    - name: location
      description: Location of the ticket
    - name: made_sla
      description: SLA of the ticket
    - name: notify
      auto: PREDEFINED
      predefined:
      - "1"
      - "0"
      description: Notify about this incident
    - name: order
      description: Order number
    - name: parent
      description: UID Format
    - name: parent_incident
      description: UID Format
    - name: problem_id
      description: UID Format
    - name: reassignment_count
      description: How many users included in this ticket before
    - name: reopen_count
      description: How many time the ticket has been reopened
    - name: resolved_at
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: resolved_by
      description: UID Format
    - name: rfc
      description: UID
    - name: sla_due
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: subcategory
      description: Subcategory
    - name: sys_updated_by
      description: Last updated by
    - name: sys_updated_on
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: user_input
      description: Input from the end user
    - name: watch_list
      description: A list of watched tickets
    - name: work_end
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: work_notes
      description: Format journal list
    - name: work_notes_list
      description: List with UIDs
    - name: work_start
      description: Date when started to work on the ticket
    - name: assignment_group
      description: Set AssignmentGroup - uuid of group like 46b87022a9fe198101a78787e40d7547
    - name: incident_state
      description: integer
    - name: number
      description: Ticket number
    - name: priority
      description: Priority of the ticket (number)
    - name: template
      description: Template name to use as a base to create new incidents.
    - name: custom_fields
      description: 'Custom fields in this format: fieldname=value;fieldname=value...'
    - name: type
      auto: PREDEFINED
      predefined:
      - normal
      - standard
      - emergency
      description: Type of Change Request ticket
      defaultValue: normal
    - name: state
      description: State of the incident (an integer)
    outputs:
    - contextPath: Ticket.Id
      description: ServiceNow ticket ID
    - contextPath: Ticket.Creator
      description: ServiceNow ticket creator
    - contextPath: Ticket.Assignee
      description: ServiceNow ticket assignee
    - contextPath: Ticket.State
      description: ServiceNow ticket state
    - contextPath: Ticket.Summary
      description: ServiceNow ticket short summary
    description: Create new ServiceNow ticket
  - name: servicenow-incident-create
    deprecated: true
    arguments:
    - name: short_description
      description: Short description of the ticket
    - name: ticket_type
      auto: PREDEFINED
      predefined:
      - incident
      - problem
      - change_request
      description: Ticket type to create
      defaultValue: incident
    - name: urgency
      description: Ticket urgency
    - name: severity
      description: Ticket severity
    - name: impact
      description: Ticket impact
    - name: active
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Set incident as Active
    - name: activity_due
      description: Set incident ActivityDue - format "2016-07-02 21:51:11" glide_date_time
    - name: additional_assignee_list
      description: List of assigned users to the ticket
    - name: approval_history
      description: Ticket history approval
    - name: approval_set
      description: Set incident ApprovalSet - format "2016-07-02 21:51:11" glide_date_time
    - name: assigned_to
      description: To whom the ticket is assigned
    - name: business_duration
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: business_service
      description: Business service
    - name: business_stc
      description: Business source
    - name: calendar_duration
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: caller_id
      description: UID Format
    - name: category
      description: Category name
    - name: caused_by
      description: UID Format
    - name: close_code
      description: Ticket's close code
    - name: close_notes
      description: Close notes of the ticket
    - name: closed_at
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: closed_by
      description: User who closed the ticket
    - name: cmdb_ci
      description: UID Format
    - name: comments
      description: Format type journal input
    - name: comments_and_work_notes
      description: Format type journal input
    - name: company
      description: UID Format
    - name: contact_type
      description: Contact type
    - name: correlation_display
      description: Correlation display
    - name: correlation_id
      description: Correlation id
    - name: delivery_plan
      description: UID Format
    - name: display
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: If you want to display comments, work_notes...
    - name: description
      description: Ticket description
    - name: due_date
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: escalation
      description: Escalation
    - name: expected_start
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: follow_up
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: group_list
      description: UID format list
    - name: knowledge
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Is the ticket solved in the knowledge base
    - name: location
      description: Location of the ticket
    - name: made_sla
      description: SLA of the ticket
    - name: notify
      auto: PREDEFINED
      predefined:
      - "1"
      - "0"
      description: Notify about this incident
    - name: order
      description: Order number
    - name: parent
      description: UID Format
    - name: parent_incident
      description: UID Format
    - name: problem_id
      description: UID Format
    - name: reassignment_count
      description: How many users included in this ticket before
    - name: reopen_count
      description: How many time the ticket has been reopened
    - name: resolved_at
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: resolved_by
      description: UID Format
    - name: rfc
      description: UID
    - name: sla_due
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: subcategory
      description: Subcategory
    - name: sys_updated_by
      description: Last updated by
    - name: sys_updated_on
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: user_input
      description: Input from the end user
    - name: watch_list
      description: A list of watched tickets
    - name: work_end
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: work_notes
      description: Format journal list
    - name: work_notes_list
      description: List with UIDs
    - name: work_start
      description: Date when started to work on the ticket
    - name: assignment_group
      description: Set AssignmentGroup - uuid of group like 46b87022a9fe198101a78787e40d7547
    - name: incident_state
      description: integer
    - name: number
      description: Ticket number
    - name: priority
      description: Priority of the ticket (number)
    - name: template
      description: Template name to use as a base to create new incidents.
    outputs:
    - contextPath: Ticket.Id
      description: ServiceNow ticket ID
    - contextPath: Ticket.Creator
      description: ServiceNow ticket creator
    - contextPath: Ticket.Assignee
      description: ServiceNow ticket assignee
    - contextPath: Ticket.State
      description: ServiceNow ticket state
    - contextPath: Ticket.Summary
      description: ServiceNow ticket short summary
    description: Create new ServiceNow ticket
  - name: servicenow-update
    arguments:
    - name: short_description
      description: Short description of the ticket
    - name: ticket_type
      auto: PREDEFINED
      predefined:
      - incident
      - problem
      - change_request
      - sc_request
      description: Ticket type to create
      defaultValue: incident
    - name: urgency
      description: Ticket urgency
    - name: severity
      description: Ticket severity
    - name: impact
      description: Ticket impact
    - name: active
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Does the ticket active(true/false)
    - name: activity_due
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: additional_assignee_list
      description: List of assigned users to the ticket
    - name: approval_history
      description: Ticket history approval
    - name: approval_set
      description: Set incident ApprovalSet - format "2016-07-02 21:51:11" glide_date_time
    - name: assigned_to
      description: To whom the ticket is assigned
    - name: business_duration
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: business_service
      description: Business service
    - name: business_stc
      description: Business source
    - name: calendar_duration
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: caller_id
      description: UID Format
    - name: category
      description: Category name
    - name: caused_by
      description: UID Format
    - name: close_code
      description: Ticket's close code
    - name: close_notes
      description: Close notes of the ticket
    - name: closed_at
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: closed_by
      description: User who closed the ticket
    - name: cmdb_ci
      description: UID Format
    - name: comments
      description: Format type journal input
    - name: comments_and_work_notes
      description: Format type journal input
    - name: company
      description: UID Format
    - name: contact_type
      description: Contact type
    - name: correlation_display
      description: Correlation display
    - name: correlation_id
      description: Correlation id
    - name: delivery_plan
      description: UID Format
    - name: display
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: If you want to display comments, work_notes...
    - name: description
      description: Ticket description
    - name: due_date
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: escalation
      description: Escalation
    - name: expected_start
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: follow_up
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: group_list
      description: UID format list
    - name: knowledge
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Is the ticket solved in the knowledge base
    - name: location
      description: Location of the ticket
    - name: made_sla
      description: SLA of the ticket
    - name: notify
      auto: PREDEFINED
      predefined:
      - "1"
      - "0"
      description: Notify about this incident
    - name: order
      description: Order number
    - name: parent
      description: UID Format
    - name: parent_incident
      description: UID Format
    - name: problem_id
      description: UID Format
    - name: reassignment_count
      description: How many users included in this ticket before
    - name: reopen_count
      description: How many time the ticket has been reopened
    - name: resolved_at
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: resolved_by
      description: UID Format
    - name: rfc
      description: UID
    - name: sla_due
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: subcategory
      description: Subcategory
    - name: sys_updated_by
      description: Last updated by
    - name: sys_updated_on
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: user_input
      description: Input from the end user
    - name: watch_list
      description: A list of watched tickets
    - name: work_end
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: work_notes
      description: Format journal list
    - name: work_notes_list
      description: List with UIDs
    - name: work_start
      description: Date when started to work on the ticket
    - name: assignment_group
      description: UID
    - name: incident_state
      description: integer
    - name: number
      description: Ticket number
    - name: priority
      description: Priority of the ticket (number)
    - name: id
      required: true
      description: Id(UID) of the ticket to update
    - name: custom_fields
      description: 'Custom fields in this format: fieldname=value;fieldname=value...'
    - name: type
      auto: PREDEFINED
      predefined:
      - normal
      - standard
      - emergency
      description: Type of Change Request ticket
      defaultValue: normal
    - name: state
      description: State of the incident (an integer)
    description: Update specific ticket by providing ticket id
  - name: servicenow-incident-update
    deprecated: true
    arguments:
    - name: short_description
      description: Short description of the ticket
    - name: ticket_type
      auto: PREDEFINED
      predefined:
      - incident
      - problem
      - change_request
      description: Ticket type to create
      defaultValue: incident
    - name: urgency
      description: Ticket urgency
    - name: severity
      description: Ticket severity
    - name: impact
      description: Ticket impact
    - name: active
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Does the ticket active(true/false)
    - name: activity_due
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: additional_assignee_list
      description: List of assigned users to the ticket
    - name: approval_history
      description: Ticket history approval
    - name: approval_set
      description: Set incident ApprovalSet - format "2016-07-02 21:51:11" glide_date_time
    - name: assigned_to
      description: To whom the ticket is assigned
    - name: business_duration
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: business_service
      description: Business service
    - name: business_stc
      description: Business source
    - name: calendar_duration
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: caller_id
      description: UID Format
    - name: category
      description: Category name
    - name: caused_by
      description: UID Format
    - name: close_code
      description: Ticket's close code
    - name: close_notes
      description: Close notes of the ticket
    - name: closed_at
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: closed_by
      description: User who closed the ticket
    - name: cmdb_ci
      description: UID Format
    - name: comments
      description: Format type journal input
    - name: comments_and_work_notes
      description: Format type journal input
    - name: company
      description: UID Format
    - name: contact_type
      description: Contact type
    - name: correlation_display
      description: Correlation display
    - name: correlation_id
      description: Correlation id
    - name: delivery_plan
      description: UID Format
    - name: display
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: If you want to display comments, work_notes...
    - name: description
      description: Ticket description
    - name: due_date
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: escalation
      description: Escalation
    - name: expected_start
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: follow_up
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: group_list
      description: UID format list
    - name: knowledge
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Is the ticket solved in the knowledge base
    - name: location
      description: Location of the ticket
    - name: made_sla
      description: SLA of the ticket
    - name: notify
      auto: PREDEFINED
      predefined:
      - "1"
      - "0"
      description: Notify about this incident
    - name: order
      description: Order number
    - name: parent
      description: UID Format
    - name: parent_incident
      description: UID Format
    - name: problem_id
      description: UID Format
    - name: reassignment_count
      description: How many users included in this ticket before
    - name: reopen_count
      description: How many time the ticket has been reopened
    - name: resolved_at
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: resolved_by
      description: UID Format
    - name: rfc
      description: UID
    - name: sla_due
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: subcategory
      description: Subcategory
    - name: sys_updated_by
      description: Last updated by
    - name: sys_updated_on
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: user_input
      description: Input from the end user
    - name: watch_list
      description: A list of watched tickets
    - name: work_end
      description: 'Format: YYYY-MM-DD HH:MM:SS'
    - name: work_notes
      description: Format journal list
    - name: work_notes_list
      description: List with UIDs
    - name: work_start
      description: Date when started to work on the ticket
    - name: assignment_group
      description: UID
    - name: incident_state
      description: integer
    - name: number
      description: Ticket number
    - name: priority
      description: Priority of the ticket (number)
    - name: id
      required: true
      description: Id(UID) of the ticket to update
    description: Update specific ticket by providing ticket id
  - name: servicenow-add-link
    arguments:
    - name: id
      required: true
      description: Incident ID , also known in the api as sys_id - format is uuid
        like 46b87022a9fe198101a78787e40d7547
    - name: ticket_type
      auto: PREDEFINED
      predefined:
      - incident
      - problem
      - change_request
      - sc_request
      description: Ticket type to create
      defaultValue: incident
    - name: link
      required: true
      description: The actual link to publish in ServiceNow incident, valid url format,
        like http://www.demisto.com
    - name: post-as-comment
      description: Publish the link as comment on the incident, by default true, if
        false will publish the link as WorkNote, format bool
    - name: text
      description: The text to represent the link
    description: Add link to specific ticket by providing ticket id
  - name: servicenow-incident-add-link
    deprecated: true
    arguments:
    - name: id
      required: true
      description: Incident ID , also known in the api as sys_id - format is uuid
        like 46b87022a9fe198101a78787e40d7547
    - name: ticket_type
      auto: PREDEFINED
      predefined:
      - incident
      - problem
      - change_request
      description: Ticket type to create
      defaultValue: incident
    - name: link
      required: true
      description: The actual link to publish in ServiceNow incident, valid url format,
        like http://www.demisto.com
    - name: post-as-comment
      description: Publish the link as comment on the incident, by default true, if
        false will publish the link as WorkNote, format bool
    - name: text
      description: The text to represent the link
    description: Add link to specific ticket by providing ticket id
  - name: servicenow-add-comment
    arguments:
    - name: id
      required: true
      description: Incident ID , also known in the api as sys_id - format is uuid
        like 46b87022a9fe198101a78787e40d7547
    - name: ticket_type
      auto: PREDEFINED
      predefined:
      - incident
      - problem
      - change_request
      - sc_request
      description: Ticket type to create
      defaultValue: incident
    - name: comment
      required: true
      description: Comment to add
    - name: post-as-comment
      description: Publish the link as comment on the incident, by default true, if
        false will publish the link as WorkNote, format bool
    description: Add comment to specific ticket by providing ticket id
  - name: servicenow-incident-add-comment
    deprecated: true
    arguments:
    - name: id
      required: true
      description: Incident ID , also known in the api as sys_id - format is uuid
        like 46b87022a9fe198101a78787e40d7547
    - name: ticket_type
      auto: PREDEFINED
      predefined:
      - incident
      - problem
      - change_request
      description: Ticket type to create
      defaultValue: incident
    - name: comment
      required: true
      description: Comment to add
    - name: post-as-comment
      description: Publish the link as comment on the incident, by default true, if
        false will publish the link as WorkNote, format bool
    description: Add comment to specific ticket by providing ticket id
  - name: servicenow-query
    arguments:
    - name: limit
      description: Limit for how many tickets to retrieve
      defaultValue: "10"
    - name: sysparm_query
      description: Query
    - name: ticket_type
      auto: PREDEFINED
      predefined:
      - incident
      - problem
      - change_request
      - sc_request
      description: Ticket type to create
      defaultValue: incident
    outputs:
    - contextPath: Ticket.Id
      description: ServiceNow ticket ID
    - contextPath: Ticket.Creator
      description: ServiceNow ticket creator
    - contextPath: Ticket.Assignee
      description: ServiceNow ticket assignee
    - contextPath: Ticket.State
      description: ServiceNow ticket state
    - contextPath: Ticket.Summary
      description: ServiceNow ticket short summary
    description: Retrieve info with query
  - name: servicenow-incidents-query
    deprecated: true
    arguments:
    - name: limit
      description: Limit for how many tickets to retrieve
      defaultValue: "10"
    - name: sysparm_query
      description: Query
    - name: ticket_type
      auto: PREDEFINED
      predefined:
      - incident
      - problem
      - change_request
      description: Ticket type to create
      defaultValue: incident
    outputs:
    - contextPath: Ticket.Id
      description: ServiceNow ticket ID
    - contextPath: Ticket.Creator
      description: ServiceNow ticket creator
    - contextPath: Ticket.Assignee
      description: ServiceNow ticket assignee
    - contextPath: Ticket.State
      description: ServiceNow ticket state
    - contextPath: Ticket.Summary
      description: ServiceNow ticket short summary
    description: Retrieve info with query
  - name: servicenow-upload-file
    arguments:
    - name: id
      required: true
      description: Incident ID , also known in the api as sys_id - format is uuid
        like 46b87022a9fe198101a78787e40d7547
    - name: ticket_type
      auto: PREDEFINED
      predefined:
      - incident
      - problem
      - change_request
      - sc_request
      description: Ticket type to create
      defaultValue: incident
    - name: file_id
      required: true
      description: War-room entry ID that includes the file
    - name: file_name
      description: Filename of uploaded file to override the existing file name in
        entry
    description: Upload new file
  - name: servicenow-incident-upload-file
    deprecated: true
    arguments:
    - name: id
      required: true
      description: Incident ID , also known in the api as sys_id - format is uuid
        like 46b87022a9fe198101a78787e40d7547
    - name: ticket_type
      auto: PREDEFINED
      predefined:
      - incident
      - problem
      - change_request
      description: Ticket type to create
      defaultValue: incident
    - name: file_id
      required: true
      description: War-room entry ID that includes the file
    - name: file_name
      description: Filename of uploaded file to override the existing file name in
        entry
    description: Upload new file
  - name: servicenow-get-groups
    arguments:
    - name: name
      required: true
      description: Servicenow group name
    description: Return information about specific servicenow group
  - name: servicenow-get-computer
    arguments:
    - name: computerName
      required: true
      description: machine name
    outputs:
    - contextPath: ServiceNowComputer.sys_id
      description: Id
    - contextPath: ServiceNowComputer.u_code
      description: Code
    - contextPath: ServiceNowComputer.support_group
      description: Support group
    - contextPath: ServiceNowComputer.os
      description: Operation System
    - contextPath: ServiceNowComputer.comments
      description: Comments
    description: query the cmdb_ci_computer table with a computer code
  isfetch: true
releaseNotes: "Add servicenow-get-computer command"