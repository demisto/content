commonfields:
  id: IntSights
  version: -1
name: IntSights
display: IntSights
category: Data Enrichment & Threat Intelligence
image: data:image/png;base64,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
description: Use IntSights to manage and fetch alerts
detaileddescription: 'The credentials username is your user ID and the password is
  the API key. '
configuration:
- display: Server URL (e.g. https://192.168.0.1)
  name: server
  defaultvalue: https://api.intsights.com/
  type: 0
  required: true
- display: Account-ID
  name: Account-Id
  defaultvalue: ""
  type: 0
  required: true
- display: API Key
  name: APIKey
  defaultvalue: ""
  type: 4
  required: true
- display: 'Alert type to fetch as incidents, allowed: "AttackIndication", "DataLeakage",
    "Phishing", "BrandSecurity", "ExploitableData", "VIP"'
  name: type
  defaultvalue: ""
  type: 0
  required: false
- display: Trust any certificate (unsecure)
  name: insecure
  defaultvalue: "false"
  type: 8
  required: false
- display: Use system proxy settings
  name: proxy
  defaultvalue: "false"
  type: 8
  required: false
- display: Fetch incidents
  name: isFetch
  defaultvalue: ""
  type: 8
  required: false
- display: Incident type
  name: incidentType
  defaultvalue: ""
  type: 13
  required: false
script:
  script: |-
    import requests
    import json
    import base64

    from requests.packages.urllib3.exceptions import InsecureRequestWarning
    requests.packages.urllib3.disable_warnings(InsecureRequestWarning)

    URL = demisto.getParam('server')
    if URL[-1] != '/':
        URL += '/'

    if not demisto.getParam('proxy'):
        del os.environ['HTTP_PROXY']
        del os.environ['HTTPS_PROXY']
        del os.environ['http_proxy']
        del os.environ['https_proxy']

    VALIDATE_CERT = not demisto.params().get('insecure', True)

    id_and_api_key = demisto.getParam('Account-Id') + ':' + demisto.getParam('APIKey')
    encoded_auth_key = base64.b64encode(id_and_api_key.encode("utf-8"))
    HEADERS = {'Authorization': 'Basic ' + encoded_auth_key, 'Content-Type': 'application/json', 'Account-Id': demisto.getParam('Account-Id')}

    def req(method, path, json_data=None, params=None):
        """
        Send the request to IntSights and return the JSON response
        """
        r = requests.request(method, URL + path, headers=HEADERS, json=json_data, params=params, verify=VALIDATE_CERT)
        if r.status_code < 200 or r.status_code > 299:
            if not (r.text == 'SeverityNotChanged' or r.text == 'TagExist' or r.text == 'IocBlocklistStatusNotChanged'):
                return_error('Error in API call to IntSights service %s - [%d] %s' % (path, r.status_code, r.text))
        return r


    def handle_filters():
        """
        Apply filters to alert list
        """
        argsConversion = {
            'alert-type':'alertType',
            'source-type':'sourceType',
            'network-type':'networkType',
            'source-date-from':'sourceDateFrom',
            'source-date-to':'sourceDateTo',
            'found-date-from':'foundDateFrom',
            'found-date-to':'foundDateTo',
            'is-flagged':'isFlagged',
            'is-closed':'isClosed',
            'source-ID': 'sourceId',
            'first-seen-from': 'firstSeenFrom',
            'first-seen-to': 'firstSeenTo',
            'last-seen-from': 'lastSeenFrom',
            'last-seen-to': 'lastSeenTo',
            'value': 'iocValue',
        }
        params = {}
        for k in demisto.args():
            if demisto.getArg(k):
                params[argsConversion.get(k) or k] = demisto.getArg(k)
        return params


    def get_alerts_helper(params):
        demisto.info("Executing get_alerts")
        resp = req('GET', 'public/v1/data/alerts/alerts-list', params=params)
        if resp.status_code == 204:
            r = []
        else:
            r = resp.json()
        alerts = []
        for alert_id in r:
            alert_information = get_alert_by_id_helper(alert_id)
            alerts.append(alert_information)
        return alerts


    def get_alerts():
        """
        Gets all alerts and returns as a list.
        """
        alerts = get_alerts_helper(handle_filters())

        demisto.results({
            'Type': entryTypes['note'],
            'EntryContext': {'IntSights.Alerts(val.ID === obj.ID)':alerts},
            'Contents': alerts,
            'HumanReadable': tableToMarkdown('IntSights Alerts', alerts, ['ID', 'Severity', 'Type', 'FoundDate', 'Source.Type', 'Source.URL', 'Source.Email', 'Source.NetworkType', 'IsClosed', 'IsFlagged']),
            'ContentsFormat': formats['json']
        })


    def alert_to_readable(r):
        """
        Convert alert to readable format
        """
        return {
            'ID': demisto.get(r,'_id'),
            'Severity': demisto.get(r,'Details.Severity'),
            'Type': demisto.get(r,'Details.Type'),
            'FoundDate': demisto.get(r,'FoundDate'),
            'Source.Type': demisto.get(r,'Details.Source.Type'),
            'Source.URL': demisto.get(r,'Details.Source.URL'),
            'Source.Email': demisto.get(r,'Details.Source.Email'),
            'Source.NetworkType': demisto.get(r,'Details.Source.NetworkType'),
            'IsClosed': demisto.get(r,'IsClosed'),
            'IsFlagged': demisto.get(r,'IsFlagged'),
            'Assets': demisto.get(r,'Assets')
        }


    def get_alert_by_id_helper(alert_id):
        """
        Helper for getting details by ID
        """
        r = req('GET', 'public/v1/data/alerts/get-alert/' + alert_id).json()
        return alert_to_readable(r)


    def get_alert_by_id():
        """
        Get alert details by id
        """
        alert_id = demisto.getArg('alert-id')
        activity = get_alert_by_id_helper(alert_id)
        demisto.results({
            'Type': entryTypes['note'],
            'EntryContext': {'IntSights.Alerts(val.ID === obj.ID)':activity},
            'Contents': activity,
            'HumanReadable': tableToMarkdown('IntSights Alert Details', [activity], ['ID', 'Severity', 'Type', 'FoundDate', 'Source.Type', 'Source.URL', 'Source.Email', 'Source.NetworkType', 'IsClosed', 'IsFlagged']),
            'ContentsFormat': formats['json']
        })


    def get_alert_image():
        """
        Retrieves the alert image by image_id
        """
        image_id = demisto.getArg('image-id')
        r = req('GET', 'public/v1/data/alerts/alert-image/' + image_id)
        demisto.results(fileResult(image_id + '-image.jpeg', r.content))


    def ask_analyst():
        """
        Send question to an analyst about the requested alert
        """
        alert_id = demisto.getArg('alert-id')
        question = demisto.getArg('question')
        r = req('POST', 'public/v1/data/alerts/ask-the-analyst/'+ alert_id, json_data={'Question':question})
        question_details = {'ID': alert_id, 'Question': question}
        demisto.results(
            {
                'Type': entryTypes['note'],
                'EntryContext': {'IntSights.Alerts(val.ID === obj.ID)': question_details},
                'Contents': question_details,
                'HumanReadable': tableToMarkdown('IntSights Ask the Analyst: Your question has been successfully sent to an analyst about the requested alert', [question_details], ['ID', 'Question']),
                'ContentsFormat': formats['json']
            }
        )


    def get_alert_activity():
        """
        Retrieves the alert activity by alert-id
        """
        alert_id = demisto.getArg('alert-id')
        r = req('GET', 'public/v1/data/alerts/activity-log/' + alert_id).json()
        activities = []

        alert = {'ID': alert_id, 'Activities': []}
        for k in r:
            alert['Activities'].append({
                'ID': demisto.get(k,'_id'),
                'Type': demisto.get(k, 'Type'),
                'Initiator': demisto.get(k,'Initiator'),
                'CreatedDate': demisto.get(k,'CreatedDate'),
                'UpdateDate': demisto.get(k,'UpdateDate'),
                'RemediationBlocklistUpdate': demisto.get(k,'AdditionalInformation.RemediationBlocklistUpdate'),
                'AskTheAnalyst': {'Replies': demisto.get(k,'AdditionalInformation.AskTheAnalyst.Replies')},
                'Mail': {'Replies': demisto.get(k,'AdditionalInformation.Mail.Replies')},
                'ReadBy': demisto.get(k,'ReadBy')
            })
        demisto.results({
            'Type': entryTypes['note'],
            'EntryContext': {'IntSights.Alerts(val.ID === obj.ID)': alert},
            'Contents': r,
            'HumanReadable': tableToMarkdown('IntSights Alert Activity Log', alert['Activities'], ['ID', 'Type', 'Initiator', 'CreatedDate', 'UpdateDate', 'RemediationBlocklistUpdate', 'AskTheAnalyst', 'Mail', 'ReadBy']),
            'ContentsFormat': formats['json']
        })


    def change_severity():
        """
        Change severity of an alert
        """
        alert_id = demisto.getArg('alert-id')
        severity = demisto.getArg('severity')
        r = req('PATCH', 'public/v1/data/alerts/change-severity/' + alert_id, json_data = {'Severity': severity})
        severity_details = {'ID': alert_id, 'Severity': severity}
        demisto.results({
            'Type': entryTypes['note'],
            'EntryContext': {'IntSights.Alerts(val.ID === obj.ID)': severity_details},
            'Contents': severity_details,
            'HumanReadable': tableToMarkdown('IntSights Update Alert Severity: The Alert severity has been successfully updated.', [severity_details], ['ID', 'Severity']),
            'ContentsFormat': formats['json']
        })

    def get_assignee_id(assignee_email):
        r = req('GET', 'public/v1/account/users-details')
        r = r.json()
        for user in r:
            if assignee_email == user.get('Email', ''):
                return user.get('_id')

        raise Exception('user not found')

    def assign_alert():
        """
        Assign alert to an Assignee ID
        """
        alert_id = demisto.getArg('alert-id')
        assignee_email = demisto.getArg('assignee-email')
        is_mssp = demisto.getArg('is-mssp-optional')
        assignee_id = get_assignee_id(assignee_email)
        assign_details = {'ID': alert_id, 'Assignees.AssigneeID': assignee_id}

        url = 'public/v1/data/alerts/assign-alert/' + alert_id
        if is_mssp:
            url += '?IsMssp=' + is_mssp
        r = req('PATCH', url, json_data = {'AssigneeID': assignee_id})
        demisto.results({
            'Type': entryTypes['note'],
            'EntryContext': {'IntSights.Alerts(val.ID === obj.ID)': assign_details},
            'Contents': assign_details,
            'HumanReadable': tableToMarkdown('IntSights Assign Alert: The Alert has been successfully assigned to assigneeID', [assign_details], ['ID', 'Assignees.AssigneeID']),
            'ContentsFormat': formats['json']
        })


    def unassign_alert():
        """
        Unassign an alert
        """
        alert_id = demisto.getArg('alert-id')
        r = req('PATCH', 'public/v1/data/alerts/unassign-alert/' + alert_id)
        demisto.results({
            'Type': entryTypes['note'],
            'EntryContext': {'IntSights.Alerts(val.ID === obj.ID)': {'ID': alert_id}},
            'Contents': {'ID': alert_id},
            'HumanReadable': 'Alert id: ' + alert_id + ' successfully unassigned',
            'ContentsFormat': formats['json']
        })


    def close_alert():
        """
        Close an alert
        """
        alert_id = demisto.getArg('alert-id')
        reason = demisto.getArg('reason')
        free_text = demisto.getArg('free-text')
        is_hidden = demisto.getArg('is-hidden')
        rate = demisto.getArg('rate')
        close_details = {'ID': alert_id, 'Close.Reason': reason, 'Close.FreeText': free_text, 'Close.Rate': rate, 'IsHidden': is_hidden}
        url = 'public/v1/data/alerts/close-alert/' + alert_id
        json_data = {'Reason': reason}

        if free_text:
            json_data['FreeText'] = free_text
        if free_text:
            json_data['IsHidden'] = is_hidden
        if free_text:
            json_data['Rate'] = rate

        r = req('PATCH', url, json_data)
        demisto.results({
            'Type': entryTypes['note'],
            'EntryContext': {'IntSights.Alerts(val.ID === obj.ID)': close_details},
            'Contents': close_details,
            'HumanReadable': tableToMarkdown('IntSights Close Alert: The Alert has successfully been closed.', [close_details], ['ID', 'Close.Reason', 'Close.FreeText', 'Close.Rate', 'IsHidden']),
            'ContentsFormat': formats['json']
        })


    def send_mail():
        """
        Send email with the alert details and a question
        """
        alert_id = demisto.getArg('alert-id')
        emails = argToList(demisto.getArg('emails'))
        content = demisto.getArg('content')
        r = req('POST', 'public/v1/data/alerts/send-mail/' + alert_id, {'Emails': emails,'Content': content})
        ec = {
            'ID': alert_id,
            'EmailID': emails,
            'Question': content
        }
        demisto.results({
            'Type': entryTypes['note'],
            'EntryContext': {'IntSights.Alerts(val.ID === obj.ID)': ec},
            'Contents': ec,
            'HumanReadable': 'Email with content (' + content + ') sent to emails',
            'ContentsFormat': formats['json']
        })


    def get_tag_id(alert_id, tag_name):
        res = req('GET', 'public/v1/data/alerts/get-complete-alert/' + alert_id)
        res = res.json()

        details = res.get('Details', {})
        tags = details.get('Tags', [])
        for tag in tags:
            if tag.get('Name', '') == tag_name:
                return tag.get('_id', '')

        return 'Not found'


    def add_tag():
        """
        Adds a tag to the alert
        """
        alert_id = demisto.getArg('alert-id')
        tag_name = demisto.getArg('tag-name')
        r = req('PATCH', 'public/v1/data/alerts/add-tag/' + alert_id, json_data={'TagName': tag_name})
        tag_info = {
            'TagName': tag_name,
            'ID': get_tag_id(alert_id, tag_name)
        }
        ec = {
            'ID': alert_id,
            'Tags': tag_info
        }
        demisto.results({
            'Type': entryTypes['note'],
            'EntryContext': {'IntSights.Alerts(val.ID === obj.ID)': ec},
            'Contents': ec,
            'HumanReadable': 'Tag (' + tag_name + ') added to alert id: ' + alert_id,
            'ContentsFormat': formats['json']
        })


    def remove_tag():
        """
        Removes a tag from an alert
        """
        alert_id = demisto.getArg('alert-id')
        tag_id = demisto.getArg('tag-id')
        r = req('PATCH', 'public/v1/data/alerts/remove-tag/' + alert_id, json_data={'TagID': tag_id})
        ec = {
            'ID': alert_id,
            'Tags.TagID': tag_id
        }
        demisto.results({
            'Type': entryTypes['note'],
            'EntryContext': {'IntSights.Alerts(val.ID === obj.ID)': ec},
            'Contents': ec,
            'HumanReadable': 'Tag id: ' + tag_id + ' removed from alert id: ' + alert_id,
            'ContentsFormat': formats['json']
        })


    def add_comment():
        """
        Adds a comment to an alert
        """
        alert_id = demisto.getArg('alert-id')
        comment = demisto.getArg('comment')
        r = req('PATCH', 'public/v1/data/alerts/add-comment/' + alert_id, json_data={'Comment': comment})
        ec = {
            'ID': alert_id,
            'Comment': comment
        }
        demisto.results({
            'Type': entryTypes['note'],
            'EntryContext': {'IntSights.Alerts(val.ID === obj.ID)': ec},
            'Contents': ec,
            'HumanReadable': 'Succesfully added comment "' + comment + '" to alert id: ' + alert_id,
            'ContentsFormat': formats['json']
        })


    def IOC_to_readable(r):
        """
        Convert IOC to readable format
        """
        return {
            'ID': demisto.get(r,'_id'),
            'SourceID': demisto.get(r,'SourceID'),
            'AccountID': demisto.get(r,'AccountID'),
            'Type': demisto.get(r,'Type'),
            'Value': demisto.get(r,'Value'),
            'FirstSeen': demisto.get(r,'FirstSeen'),
            'LastSeen': demisto.get(r,'LastSeen'),
            'Domain': demisto.get(r,'Domain'),
            'Status': demisto.get(r,'Status'),
            'Severity': demisto.get(r,'Severity'),
            'SourceName': demisto.get(r, 'Source.Name'),
            'SourceConfidence': demisto.get(r, 'Source.Confidence'),
            'Flags.IsInAlexa': demisto.get(r, 'Flags.IsInAlexa'),
            'Enrichment.Status': demisto.get(r, 'Enrichment.Status'),
            'Enrichment.Date': demisto.get(r, 'Enrichment.Data')
        }


    def search_for_IOC():
        """
        Search for IOC by value
        """
        value = demisto.getArg('value')
        r = req('GET', 'public/v1/iocs/ioc-by-value', handle_filters()).json()
        IOC = IOC_to_readable(r)
        demisto.results(
            {
                'Type': entryTypes['note'],
                'EntryContext': {'IntSights.Iocs': IOC},
                'Contents': r,
                'HumanReadable': tableToMarkdown('IOC Information', [activity], ['ID', 'SourceID', 'AccountID', 'Type', 'Value', 'FirstSeen', 'LastSeen', 'Domain', 'Status', 'Severity', 'SourceName', 'SourceConfidence', 'Flags.IsInAlexa', 'Enrichment.Status', 'Enrichment.Data']),
                'ContentsFormat': formats['json']
            }
        )


    def translate_severity(sev):
        """
        Translate alert severity to demisto
        """
        if sev == 'High':
            return 3
        elif sev == 'Medium':
            return 2
        elif sev == 'Low':
            return 1
        return 0


    def fetch_incidents():
        """
        Fetch incidents for Demisto
        """
        now = int((datetime.utcnow() - datetime.utcfromtimestamp(0)).total_seconds() * 1000)
        lastRunObject = demisto.getLastRun()
        lastRun = lastRunObject and lastRunObject['time']
        if not lastRun:
            lastRun = now - 24 * 60 * 60 * 1000
        demisto.args()['found-date-from'] = lastRun
        if not demisto.getLastRun():
            demisto.args()['is-closed'] = False

        demisto.args()['alert-type'] = demisto.getParam('type')
        alerts = get_alerts_helper(handle_filters())
        incidents = []
        for alert in alerts:
            incidents.append({
                'name': alert['Type'] + ' - ' + alert['ID'],
                'occurred': alert['FoundDate'],
                'severity': translate_severity(alert['Severity']),
                'rawJSON': json.dumps(alert)
            })
        demisto.incidents(incidents)
        demisto.setLastRun({'time': now})


    def get_iocs():
        """
        Gets all IOCs with the given filters
        """
        r = req('GET', 'public/v1/iocs/complete-iocs-list', params=handle_filters()).json()
        iocs = []
        for k in r:
            iocs.append(IOC_to_readable(k))
        demisto.results(
            {
                'Type': entryTypes['note'],
                'EntryContext': {'IntSights.Iocs': iocs},
                'Contents': r,
                'HumanReadable': tableToMarkdown('IOC Information', iocs, ['ID', 'SourceID', 'AccountID', 'Type', 'Value', 'FirstSeen', 'LastSeen', 'Domain', 'Status', 'Severity', 'SourceName', 'SourceConfidence', 'Flags.IsInAlexa', 'Enrichment.Status', 'Enrichment.Data']),
                'ContentsFormat': formats['json']
            }
        )


    def takedown_request():
        """
        Request alert takedown
        """
        alert_id = demisto.getArg('alert-id')
        r = req('PATCH', 'public/v1/data/alerts/takedown-request/' + alert_id)
        ec = {
            'ID': alert_id,
        }
        demisto.results({
            'Type': entryTypes['note'],
            'EntryContext': {'Insights.Alerts(val.ID === obj.ID)': ec},
            'Contents': ec,
            'HumanReadable': '### IntSights Alert Takedown\n' + 'The Alert Takedown request has been sent successfully for ' + str(alert_id),
            'ContentsFormat': formats['json']
        })


    def get_alert_takedown_status():
        """
        Get an alert's takedown status
        """
        alert_id = demisto.getArg('alert-id')
        r = req('GET', 'public/v1/data/alerts/takedown-status/' + alert_id)
        ec = {
            'ID': alert_id,
            'TakedownStatus': r.text
        }
        demisto.results({
            'Type': entryTypes['note'],
            'EntryContext': {'Insights.Alerts(val.ID === obj.ID)': ec},
            'Contents': ec,
            'HumanReadable': tableToMarkdown('IntSights Alert Takedown Status', [ec], ['ID', 'TakedownStatus']),
            'ContentsFormat': formats['json']
        })


    def update_ioc_blocklist_status():
        alert_id = demisto.getArg('alert-id')
        types = argToList(demisto.getArg('type'))
        values = argToList(demisto.getArg('value'))
        statuses = argToList(demisto.getArg('blocklist-status'))
        if len(types) != len(values) or len(types) != len(statuses):
            return_error('The lists must be of equal length. For each IOC, provide an entry in each list.')
        data = []
        for i in range(len(types)):
            data.append({
                'Type': types[i],
                'Value': values[i],
                'BlocklistStatus': statuses[i]
            })
        r = req('PATCH', 'public/v1/data/alerts/change-iocs-blocklist-status/' + alert_id, json_data={'Iocs': data})
        demisto.results({
            'Type': entryTypes['note'],
            'EntryContext': {'IntSights.Alerts(val.ID === obj.ID)': {'ID': alert_id, 'Status': statuses}},
            'Contents': {'ID': alert_id, 'Status': statuses},
            'HumanReadable': tableToMarkdown('IntSights Update IOC BlockList Status for ' + alert_id, data, ['BlocklistStatus']),
            'ContentsFormat': formats['json']
        })


    def get_ioc_blocklist_status():
        alert_id = demisto.getArg('alert-id')
        r = req('GET', 'public/v1/data/alerts/blocklist-status/' + alert_id).json()
        demisto.results({
            'Type': entryTypes['note'],
            'EntryContext': {'Insights.Alerts(val.ID === obj.ID)': {'ID': alert_id, 'Status': [s.get('Status') for s in r]}},
            'Contents': r,
            'HumanReadable': tableToMarkdown('IntSights Blocklist Status for ' + alert_id, r, ['Status']),
            'ContentsFormat': formats['json']
        })


    if demisto.command() == 'test-module':
        req('GET', 'public/v1/api/version')
        demisto.results('ok')
    elif demisto.command() =='intsights-get-alerts':
        get_alerts()
    elif demisto.command() == 'intsights-get-alert-image':
        get_alert_image()
    elif demisto.command() == 'intsights-get-alert-activities':
        get_alert_activity()
    elif demisto.command() == 'intsights-assign-alert':
        assign_alert()
    elif demisto.command() == 'intsights-unassign-alert':
        unassign_alert()
    elif demisto.command() == 'intsights-send-mail':
        send_mail()
    elif demisto.command() == 'intsights-ask-the-analyst':
        ask_analyst()
    elif demisto.command() == 'intsights-add-tag-to-alert':
        add_tag()
    elif demisto.command() == 'intsights-remove-tag-from-alert':
        remove_tag()
    elif demisto.command() == 'intsights-add-comment-to-alert':
        add_comment()
    elif demisto.command() == 'intsights-update-alert-severity':
        change_severity()
    elif demisto.command() == 'intsights-get-alert-by-id':
        get_alert_by_id()
    elif demisto.command() == 'intsights-get-ioc-by-value':
        search_for_IOC()
    elif demisto.command() == 'intsights-get-iocs':
        get_iocs()
    elif demisto.command() == 'intsights-alert-takedown-request':
        takedown_request()
    elif demisto.command() == 'fetch-incidents':
        fetch_incidents()
    elif demisto.command() == 'intsights-get-alert-takedown-status':
        get_alert_takedown_status()
    elif demisto.command() == 'intsights-get-ioc-blocklist-status':
        get_ioc_blocklist_status()
    elif demisto.command() == 'intsights-update-ioc-blocklist-status':
        update_ioc_blocklist_status()
    elif demisto.command() == 'intsights-close-alert':
        close_alert()
    else:
        return_error('Unrecognized command: ' + demisto.command())
  type: python
  commands:
  - name: intsights-get-alert-image
    arguments:
    - name: image-id
      required: true
      default: true
      description: The image ID
    description: Get's alert's image by ID
  - name: intsights-get-alert-activities
    arguments:
    - name: alert-id
      required: true
      default: true
      description: The alert ID
    outputs:
    - contextPath: IntSights.Alerts.ID
      description: The alert ID
      type: string
    - contextPath: IntSights.Alerts.Activities.Type
      description: The activity type
      type: string
    - contextPath: IntSights.Alerts.Activities.Initiator
      description: The initiator of the alert
      type: string
    - contextPath: IntSights.Alerts.Activities.CreatedDate
      description: The alert date of creation
      type: date
    - contextPath: IntSights.Alerts.Activities.UpdateDate
      description: The date the alert was updated
      type: date
    - contextPath: IntSights.Alerts.Activities.RemediationBlocklistUpdate
      description: Remediation blocklist update
      type: string
    - contextPath: IntSights.Alerts.Activities.AskTheAnalyst.Replies
      description: Analyst replies to questions
      type: string
    - contextPath: IntSights.Alerts.Activities.Mail.Replies
      description: Mail replies
      type: string
    - contextPath: IntSights.Alerts.Activities.ReadBy
      description: Alert read by
      type: string
    description: Get alert activities
  - name: intsights-assign-alert
    arguments:
    - name: alert-id
      required: true
      default: true
      description: Alert's unique ID
    - name: assignee-email
      required: true
      description: Assigned user email
    - name: is-mssp-optional
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: If the assigned user is MSSP user or not
      defaultValue: "false"
    outputs:
    - contextPath: IntSights.Alerts.ID
      description: The alert ID
      type: string
    - contextPath: IntSights.Alerts.Assignees.AssigneeID
      description: The ID of the assignee
      type: string
    description: Assign an alert
  - name: intsights-unassign-alert
    arguments:
    - name: alert-id
      required: true
      default: true
      description: Alert's unique ID
    outputs:
    - contextPath: IntSights.Alerts.ID
      description: The alert ID
      type: string
    description: Unassign an alert
  - name: intsights-send-mail
    arguments:
    - name: alert-id
      required: true
      default: true
      description: Alert's unique ID
    - name: emails
      required: true
      description: Destination email addresses array (comma-separated)
    - name: content
      required: true
      description: Content added to the alert details
    outputs:
    - contextPath: IntSights.Alerts.ID
      description: Alert ID
      type: string
    - contextPath: IntSights.Alerts.Mail.EmailID
      description: The email ID
      type: string
    - contextPath: IntSights.Alerts.Question
      description: The question asked
      type: string
    description: Send mail with the alert details and a question
  - name: intsights-ask-the-analyst
    arguments:
    - name: alert-id
      required: true
      default: true
      description: Alert's unique ID
    - name: question
      required: true
      description: Question to ask Intsights analyst about the requested alert
    outputs:
    - contextPath: IntSights.Alerts.ID
      description: Alert ID
      type: string
    - contextPath: IntSights.Alerts.Question
      description: The question asked
      type: string
    description: Send a question to IntSights analyst about the requested alert
  - name: intsights-add-tag-to-alert
    arguments:
    - name: alert-id
      required: true
      default: true
      description: Unique alert ID
    - name: tag-name
      required: true
      description: The new tag string
    outputs:
    - contextPath: IntSights.Alerts.ID
      description: The alert ID
      type: string
    - contextPath: IntSights.Alerts.Tags.TagName
      description: The name of the tag
      type: string
    - contextPath: IntSights.Alerts.Tags.ID
      description: The Tag ID
      type: string
    description: Adds a tag to the alert
  - name: intsights-remove-tag-from-alert
    arguments:
    - name: alert-id
      required: true
      default: true
      description: Alert's unique ID
    - name: tag-id
      required: true
      description: Tags's unique ID to remove
    outputs:
    - contextPath: IntSights.Alerts.ID
      description: The alert ID
      type: string
    - contextPath: IntSights.Alerts.Tags.TagID
      description: The tag ID
      type: string
    description: ' Removes a tag from the alert'
  - name: intsights-add-comment-to-alert
    arguments:
    - name: alert-id
      required: true
      default: true
      description: Alert's unique ID
    - name: comment
      required: true
      description: Desired comment
    outputs:
    - contextPath: IntSights.Alerts.ID
      description: The alert ID
      type: string
    - contextPath: IntSights.Alerts.Comment
      description: The comment
      type: string
    description: Add comment to alert
  - name: intsights-update-alert-severity
    arguments:
    - name: alert-id
      required: true
      default: true
      description: Alert's unique ID
    - name: severity
      required: true
      auto: PREDEFINED
      predefined:
      - High
      - Medium
      - Low
      description: The desired severity
    outputs:
    - contextPath: IntSights.Alerts.ID
      description: The alert ID
      type: string
    - contextPath: IntSights.Alerts.Severity
      description: The severity of the alert
      type: string
    description: Change the alert's severity
  - name: intsights-get-alert-by-id
    arguments:
    - name: alert-id
      required: true
      default: true
      description: Alert's unique ID
    outputs:
    - contextPath: IntSights.Alerts.ID
      description: The alert ID
      type: string
    - contextPath: IntSights.Alerts.Severity
      description: The alert severity
      type: string
    - contextPath: IntSights.Alerts.Type
      description: The alert type
      type: string
    - contextPath: IntSights.Alerts.FoundDate
      description: The date the alert was found
      type: date
    - contextPath: IntSights.Alerts.Source.Type
      description: The alert source type
      type: string
    - contextPath: IntSights.Alerts.Source.URL
      description: The alert source URL
      type: string
    - contextPath: IntSights.Alerts.Source.Email
      description: The alert source email
      type: string
    - contextPath: IntSights.Alerts.Source.NetworkType
      description: The network type of the alert
      type: string
    - contextPath: IntSights.Alerts.IsClosed
      description: Whether or not the alert is closed
      type: boolean
    - contextPath: IntSights.Alerts.IsFlagged
      description: Whether or not the alert is flagged
      type: boolean
    description: Returns alert object by alert ID
  - name: intsights-get-ioc-by-value
    arguments:
    - name: value
      required: true
      default: true
      description: Desired IOC value
    outputs:
    - contextPath: IntSights.Iocs.ID
      description: The IOC ID
      type: string
    - contextPath: IntSights.Iocs.Value
      description: The IOC value
      type: string
    - contextPath: IntSights.Iocs.Type
      description: The IOC type
      type: string
    - contextPath: IntSights.Iocs.FirstSeen
      description: When the IOC was first seen
      type: date
    - contextPath: IntSights.Iocs.LastSeen
      description: When the IOC was last seen
      type: date
    - contextPath: IntSights.Iocs.SourceID
      description: The IOC source ID
      type: string
    - contextPath: IntSights.Iocs.SourceName
      description: The IOC source name
      type: string
    - contextPath: IntSights.Iocs.SourceConfidenceLevel
      description: The IOC source confidence level
      type: string
    - contextPath: IntSights.Iocs.Severity
      description: The IOC severity
      type: string
    - contextPath: IntSights.Iocs.AccountID
      description: The IOC account ID
      type: string
    - contextPath: IntSights.Iocs.Domain
      description: The IOC domain
      type: string
    - contextPath: IntSights.Iocs.Status
      description: The IOC status
      type: string
    - contextPath: IntSights.Iocs.Flags.IsInAlexa
      description: Whether or not the IOC is in Alexa
      type: boolean
    - contextPath: IntSights.Iocs.Enrichment.Status
      description: IOC enrichment status
      type: string
    - contextPath: IntSights.Iocs.Enrichment.Data
      description: IOC enrichment data
      type: string
    description: Search for exact IOC value
  - name: intsights-get-iocs
    arguments:
    - name: type
      auto: PREDEFINED
      predefined:
      - Urls
      - Hashes
      - IpAddresses
      - Domains
      description: IOC's type
    - name: limit
      description: '"Desired number of resultsDefault value: 1000 Size range: 1-1000"'
    - name: severity
      auto: PREDEFINED
      predefined:
      - High
      - Medium
      - Low
      description: 'Ioc severityAllowed values: "High", "Medium", "Low"'
    - name: source-ID
      description: Ioc source
    - name: first-seen-from
      description: 'Ioc date of first seen in the following string format - MM/DD/YYYY
        Default value: 0'
    - name: first-seen-to
      description: 'Ioc date of first seen in the following string format - MM/DD/YYYY
        Default value: 0'
    - name: last-seen-from
      description: 'Ioc date of last seen in the following string format - MM/DD/YYYY
        Default value: 0'
    - name: last-seen-to
      description: 'Ioc date of last seen in the following string format - MM/DD/YYYY
        Default value: 0'
    outputs:
    - contextPath: IntSights.Iocs.ID
      description: The IOC ID
      type: string
    - contextPath: IntSights.Iocs.Value
      description: The IOC value
      type: string
    - contextPath: IntSights.Iocs.Type
      description: The IOC type
      type: string
    - contextPath: IntSights.Iocs.FirstSeen
      description: IOC first seen
      type: date
    - contextPath: IntSights.Iocs.LastSeen
      description: IOC last seen
      type: date
    - contextPath: IntSights.Iocs.SourceID
      description: The IOC source ID
      type: string
    - contextPath: IntSights.Iocs.SourceName
      description: The IOC source name
      type: string
    - contextPath: IntSights.Iocs.SourceConfidenceLevel
      description: The IOC source confidence level
      type: string
    - contextPath: IntSights.Iocs.Severity
      description: The IOC severity
      type: string
    - contextPath: IntSights.Iocs.AccountID
      description: The IOC account ID
      type: string
    - contextPath: IntSights.Iocs.Domain
      description: The IOC domain
      type: string
    - contextPath: IntSights.Iocs.Status
      description: The IOC status
      type: string
    - contextPath: IntSights.Iocs.Flags.IsInAlexa
      description: Whether or not the IOC is in Alexa
      type: boolean
    - contextPath: IntSights.Iocs.Enrichment.Status
      description: IOC enrichment status
      type: string
    - contextPath: IntSights.Iocs.Enrichment.Data
      description: IOC enrichment data
      type: string
    description: Get count totals of the available IOCs
  - name: intsights-get-alerts
    arguments:
    - name: alert-type
      auto: PREDEFINED
      predefined:
      - AttackIndication
      - DataLeakage
      - Phishing
      - BrandSecurity
      - ExploitableData
      - VIP
      description: Alert's type
    - name: severity
      auto: PREDEFINED
      predefined:
      - High
      - Medium
      - Low
      description: Alert's severity
    - name: source-type
      auto: PREDEFINED
      predefined:
      - ApplicationStores
      - BlackMarkets
      - HackingForums
      - SocialMedia
      - PasteSites
      - Others
      description: Alert's source type
    - name: network-type
      auto: PREDEFINED
      predefined:
      - ClearWeb
      - DarkWeb
      description: Alert's network type
    - name: source-date-from
      description: Start date to fetch from in Unix Millisecond Timestamp
    - name: source-date-to
      description: End date to fetch to in Unix Millisecond Timestamp
    - name: found-date-from
      description: Start date to fetch from in Unix Millisecond Timestamp
    - name: found-date-to
      description: End date to fetch to in Unix Millisecond Timestamp
    - name: assigned
      description: Show assigned/unAssigned alerts
    - name: is-flagged
      description: Show flagged/unflagged alerts
    - name: is-closed
      description: Show closed/open alerts
    outputs:
    - contextPath: IntSights.Alerts.ID
      description: The alert ID
      type: string
    - contextPath: IntSights.Alerts.Severity
      description: The alert severity
      type: string
    - contextPath: IntSights.Alerts.Type
      description: The alert type
      type: string
    - contextPath: IntSights.Alerts.FoundDate
      description: The date the alert was found
      type: date
    - contextPath: IntSights.Alerts.Source.Type
      description: The alert source type
      type: string
    - contextPath: IntSights.Alerts.Source.URL
      description: The alert source URL
      type: string
    - contextPath: IntSights.Alerts.Source.Email
      description: The alert source email
      type: string
    - contextPath: IntSights.Alerts.Source.NetworkType
      description: The network type of the alert
      type: string
    - contextPath: IntSights.Alerts.IsClosed
      description: Whether or not the alert is closed
      type: boolean
    - contextPath: IntSights.Alerts.IsFlagged
      description: Whether or not the alert is flagged
      type: boolean
    description: Fetch alerts
  - name: intsights-alert-takedown-request
    arguments:
    - name: alert-id
      required: true
      default: true
      description: The alert ID
    outputs:
    - contextPath: IntSights.Alerts.ID
      description: The alert's ID
      type: string
    description: request alert takedown
  - name: intsights-get-alert-takedown-status
    arguments:
    - name: alert-id
      required: true
      default: true
      description: The alert ID
    outputs:
    - contextPath: IntSights.Alerts.ID
      description: The alert ID
      type: string
    - contextPath: IntSights.Alerts.TakedownStatus
      description: The takedown status
      type: string
    description: Get alert takedown status
  - name: intsights-update-ioc-blocklist-status
    arguments:
    - name: alert-id
      required: true
      default: true
      description: The alert id
    - name: type
      required: true
      description: 'Comma separated list of each IOC''s type. Options: Domains,IPs,URLs'
    - name: value
      required: true
      description: Comma separated list of each IOC's value
    - name: blocklist-status
      required: true
      description: 'Comma separated list of each IOC''s blocklist status. Options:
        Sent,NotSent'
    outputs:
    - contextPath: IntSights.Alerts.ID
      description: The alert ID
      type: string
    - contextPath: IntSights.Alerts.Status
      description: 'The blocklist status '
      type: string
    description: Update IOC blocklist status
  - name: intsights-get-ioc-blocklist-status
    arguments:
    - name: alert-id
      required: true
      default: true
      description: The alert ID
    outputs:
    - contextPath: IntSights.Alerts.ID
      description: The alert ID
      type: string
    - contextPath: IntSights.Alerts.Status
      description: The blocklist status
      type: string
    description: Get IOC blocklist status
  - name: intsights-close-alert
    arguments:
    - name: alert-id
      required: true
      description: The alert ID
    - name: reason
      auto: PREDEFINED
      required: true
      predefined:
      - ProblemSolved
      - InformationalOnly
      - ProblemWeAreAlreadyAwareOf
      - CompanyOwnedDomain
      - LegitimateApplication/Profile
      - NotRelatedToMyCompany
      - FalsePositive
      - Other
      description: The alert's closed reason
    - name: free-text
      description: The alert's comments
    - name: is-hidden
      description: The alerts' hidden status (Delete alert from the account instance - only when reason is FalsePositive)
      defaultValue: "False"
    - name: rate
      description: The alert's rate
    outputs:
    - contextPath: IntSights.Alerts.ID
      description: The alert ID
      type: string
    - contextPath: IntSights.Alerts.Closed.Reason
      description: The alert's closed reason
      type: string
    description: Close an alert
  isfetch: true
  runonce: false
releaseNotes: "Adding new intSights integration"
