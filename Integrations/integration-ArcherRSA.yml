commonfields:
  id: RSA Archer
  version: -1
name: RSA Archer
display: RSA Archer
category: Case Management
image: data:image/png;base64,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
description: The RSA Archer GRC Platform provides a common foundation for managing
  policies, controls, risks, assessments and deficiencies across lines of business.
configuration:
- display: Server URL (e.g. https://192.168.0.1/rsaarcher/)
  name: server
  defaultvalue: ""
  type: 0
  required: true
- display: Instance name
  name: instanceName
  defaultvalue: ""
  type: 0
  required: true
- display: Username
  name: credentials
  defaultvalue: ""
  type: 9
  required: true
- display: Do not validate server certificate (insecure)
  name: insecure
  defaultvalue: ""
  type: 8
  required: false
- display: Use system proxy settings
  name: proxy
  defaultvalue: ""
  type: 8
  required: false
- display: Fetch incidents
  name: isFetch
  defaultvalue: ""
  type: 8
  required: false
- display: Incident type
  name: incidentType
  defaultvalue: ""
  type: 13
  required: false
- display: Application ID for fetch
  name: fetchApplicationId
  defaultvalue: ""
  type: 0
  required: false
- display: 'Date field name for fetch (en-US format: 07/22/2016 3:58 PM)'
  name: fetchByField
  defaultvalue: Date Created
  type: 0
  required: false
- display: Fields for fetch (comma separated)
  name: fetchFields
  defaultvalue: Title,Incident ID
  type: 0
  required: false
- display: Timezone offset in minutes of the RSA Archer server machine (+60, -60,
    in minutes)
  name: timeZone
  defaultvalue: ""
  type: 0
  required: false
script:
  script: |-
    var server = params.server.replace(/[\/]+$/, '');

    var commands = {
      createRecord:     'archer-create-record',
      updateRecord:     'archer-update-record',
      getRecord:        'archer-get-record',
      searchApps:       'archer-search-applications',
      searchRecords:    'archer-search-records',
      getAppFields:     'archer-get-application-fields',
      deleteRecord:     'archer-delete-record',
      valueListForField: 'archer-value-list-for-field'
    };

    var urlDictionary = {};
    urlDictionary.login = '/api/core/security/login';
    urlDictionary.logout = '/api/core/security/logout';
    urlDictionary.levelIdByModuleId = '/api/core/system/level/module/%applicationId%';
    urlDictionary.fieldByLevelId = '/api/core/system/fielddefinition/level/%levelId%';
    urlDictionary[commands.createRecord] = '/ws/record.asmx';
    urlDictionary[commands.updateRecord] = '/ws/record.asmx';
    urlDictionary[commands.getRecord] = '/ws/record.asmx';
    urlDictionary[commands.searchApps] = '/api/core/system/application';
    urlDictionary[commands.searchRecords] = '/ws/search.asmx';
    urlDictionary[commands.deleteRecord] = '/ws/record.asmx';
    urlDictionary[commands.valueListForField] = '/ws/field.asmx';

    var methodDictionary = {};
    methodDictionary.login = 'POST';
    methodDictionary.logout = 'POST';
    methodDictionary.levelIdByModuleId = 'POST';
    methodDictionary.fieldByLevelId = 'POST';
    methodDictionary[commands.createRecord] = 'POST';
    methodDictionary[commands.updateRecord] = 'POST';
    methodDictionary[commands.getRecord] = 'POST';
    methodDictionary[commands.searchApps] = 'POST';
    methodDictionary[commands.searchRecords] = 'POST';
    methodDictionary[commands.deleteRecord] = 'POST';
    methodDictionary[commands.valueListForField] = 'POST';


    function extractObjectFromXML(xml, path) {
        var searchRes = dq(xml, path);
        if (searchRes.indexOf("<?xml") > -1) {
            var index = searchRes.indexOf(">");
            if (index !== -1) {
                searchRes = searchRes.substr(index + 1);
            }
        }

        return JSON.parse(x2j(searchRes));
    }

    function parseRecordsXml(response, mapping) {
        var parsedJson = extractObjectFromXML(response, 'Envelope.Body.ExecuteSearchResponse.ExecuteSearchResult');
        var records = parsedJson.Records.Record;
        if (!records) {
            return [];
        }

        var outputs =[];
        if (!Array.isArray(records)) {
            records = [records];
        }
        records.forEach(function (record) {
            var el = {
                Id: record['-contentId'],
                ModuleId: record['-moduleId'],
                Fields: {}
            };
            var fields = record.Field;
            if (!Array.isArray(fields)) {
                fields = [fields];
            }

            fields.forEach(function (field) {
                el.Fields[mapping[field['-id']].Name] = field['#text'];
            });

            outputs.push(el);
        });

        return outputs;
    }

    function sendSoapRequest(cmd, bodyContent, SOAPAction) {
        var headers = {'Content-Type': ['text/xml; charset=utf-8']};
        if (SOAPAction) {
            headers.SOAPAction = [SOAPAction];
        }

        var url =  server +  urlDictionary[cmd];
        var result = http(
            url,
            {
                Method: methodDictionary[cmd],
                Headers: headers,
                Body: bodyContent
            },
            params.insecure,
            params.proxy
        );

        if (result.StatusCode < 200 || result.StatusCode >= 300) {
            throw 'Request to RSA Archer ' + url + ' failed, request status code: ' + result.StatusCode + ' and Body: ' + result.Body + '.';
        }

        return result.Body;
    }

    function sendRestRequest(cmd, bodyContent, token, httpTunneling, queryParams) {
        var headers = {
            'Content-Type': ['application/json'],
            'Accept': ['application/json']
        };

        if (token) {
            headers.Authorization = ['Archer session-id=' + token];
        }

        if(httpTunneling) {
            headers['X-Http-Method-Override'] = ['GET'];
        }

        var url = server + replaceInTemplatesAndRemove(urlDictionary[cmd], args);
        if (queryParams) {
            url += queryParams;
        }

        var body = JSON.stringify(bodyContent);
        var result = http(
            url,
            {
                Method: methodDictionary[cmd],
                Headers: headers,
                Body: body ? body : ''
            },
            params.insecure,
            params.proxy
        );

        if (result.StatusCode < 200 || result.StatusCode >= 300) {
            throw 'Request to RSA Archer ' + url + ' failed, request status code: ' + result.StatusCode + ' and Body: ' + result.Body + '.';
        }

        return JSON.parse(result.Body);
    }

    function getContentsByAppIdRequest(token, appId, displayFields, maxResults, fieldIdToSearchOn, fieldNameToSearchOn, searchValue, sortByFieldId, isDescending, numericOperator, dateOperator, pageNumber) {
        var readyMaxReults = (maxResults === undefined || maxResults === null) ? '100' : maxResults;
        return (
        '<?xml version="1.0" encoding="UTF-8"?>' +
        '<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">' +
        '   <soap:Body>' +
        '       <ExecuteSearch xmlns="http://archer-tech.com/webservices/">' +
        '           <sessionToken>' + token + '</sessionToken>' +
        '           <searchOptions>' +
        '               <![CDATA[' +
        '                   <SearchReport>' +
        '                       <PageSize>' + readyMaxReults + '</PageSize>' +
        '                       <PageNumber>' + pageNumber + '</PageNumber>' +
        '                       <MaxRecordCount>' + (readyMaxReults || '1') + '</MaxRecordCount>' +
        '                       <ShowStatSummaries>false</ShowStatSummaries>' +
        '                       <DisplayFields>' + displayFields + '</DisplayFields>' +
        '                       <Criteria>' +
        '                           <ModuleCriteria>' +
        '                               <Module name="appname">' + appId + '</Module>' +
        '                           </ModuleCriteria>' +
                                    (fieldIdToSearchOn ?
        '                           <Filter>' +
        '                               <Conditions>' +
                                            (dateOperator ?
        '                                   <DateComparisonFilterCondition>' +
        '                                       <Operator>' + dateOperator + '</Operator>' +
        '                                       <Field name="'+ escapeXMLChars(fieldNameToSearchOn) +'">' + fieldIdToSearchOn + '</Field>' +
        '                                       <Value>' + searchValue + '</Value>' +
        '                                       <TimeZoneId>UTC Standard Time</TimeZoneId>' +
        '                                       <IsTimeIncluded>TRUE</IsTimeIncluded>' +
        '                                   </DateComparisonFilterCondition>' : '') +
                                            ((!dateOperator && numericOperator) ?
        '                                   <NumericFilterCondition>' +
        '                                       <Operator>' + numericOperator + '</Operator>' +
        '                                       <Field name="'+ escapeXMLChars(fieldNameToSearchOn) +'">' + fieldIdToSearchOn + '</Field>' +
        '                                       <Value>' + searchValue + '</Value>' +
        '                                   </NumericFilterCondition>' : '') +
                                            ((!dateOperator && !numericOperator) ?
        '                                   <TextFilterCondition>' +
        '                                       <Operator>Contains</Operator>' +
        '                                       <Field name="'+ escapeXMLChars(fieldNameToSearchOn) +'">' + fieldIdToSearchOn + '</Field>' +
        '                                       <Value>' + searchValue + '</Value>' +
        '                                   </TextFilterCondition>' : '') +
        '                               </Conditions>' +
        '                           </Filter>'
                                    : '') +
                                    (sortByFieldId ?
        '                           <SortFields>' +
        '                               <SortField>' +
        '                                   <Field>' + sortByFieldId + '</Field>' +
        '                                   <SortType>' + (isDescending ? 'Descending' : 'Ascending') + '</SortType>' +
        '                               </SortField>' +
        '                           </SortFields>'
                                    : '') +
        '                       </Criteria>' +
        '                   </SearchReport>' +
        '               ]]>' +
        '           </searchOptions>' +
        '           <pageNumber>1</pageNumber>' +
        '       </ExecuteSearch>' +
        '   </soap:Body>' +
        '</soap:Envelope>'
        );
    }

    function createContentSoapRequest(token, appId, fields) {
        return (
        '<?xml version="1.0" encoding="utf-8"?>' +
        '<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema- instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">' +
        '   <soap:Body>' +
        '       <CreateRecord xmlns="http://archer-tech.com/webservices/">' +
        '           <sessionToken>' + token + '</sessionToken>' +
        '           <moduleId>' + appId + '</moduleId>' +
        '           <fieldValues> ' +
        '               <![CDATA[ ' +
        '                   <Record>' + fields + '</Record>' +
        '                ]]>' +
        '           </fieldValues>' +
        '       </CreateRecord>' +
        '   </soap:Body> ' +
        '</soap:Envelope>'
        );
    }

    function updateContentSoapRequest(token, appId, contentId, fields) {
        return (
        '<?xml version="1.0" encoding="utf-8"?> ' +
        '<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchemainstance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">' +
        '   <soap:Body>' +
        '       <UpdateRecord xmlns="http://archer-tech.com/webservices/">' +
        '           <sessionToken>' + token + '</sessionToken>' +
        '           <moduleId>' + appId + '</moduleId>' +
        '           <contentId>' + contentId +'</contentId>' +
        '           <fieldValues>' +
        '               <![CDATA[' +
        '                   <UpdateRecord>' + fields + '</UpdateRecord>' +
        '               ]]>' +
        '           </fieldValues>' +
        '       </UpdateRecord>' +
        '   </soap:Body>' +
        '</soap:Envelope>'
        );
    }

    function getContentSoapRequest(token, appId, contentId) {
        return (
        '<?xml version="1.0" encoding="utf-8"?> ' +
        '<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchemainstance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">' +
        '   <soap:Body>' +
        '       <GetRecordById xmlns="http://archer-tech.com/webservices/">' +
        '           <sessionToken>' + token + '</sessionToken>' +
        '           <moduleId>' + appId + '</moduleId>' +
        '           <contentId>' + contentId +'</contentId>' +
        '       </GetRecordById>' +
        '   </soap:Body>' +
        '</soap:Envelope>'
        );
    }

    function deleteContentSoapRequest(token, appId, contentId) {
        return (
        '<?xml version="1.0" encoding="utf-8"?>' +
        '<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchemainstance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">' +
        '   <soap:Body>' +
        '       <DeleteRecord xmlns="http://archer-tech.com/webservices/">' +
        '           <sessionToken>' + token + '</sessionToken>' +
        '           <moduleId>' + appId + '</moduleId>' +
        '           <contentId>' + contentId + '</contentId>' +
        '       </DeleteRecord>' +
        '   </soap:Body>' +
        '</soap:Envelope>'
        );
    }

    function getValueListForFieldSoapRequest(token, fieldID){
        return (
        '<?xml version="1.0" encoding="utf-8"?>'+
        '<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchemainstance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">'+
            '<soap:Body>'+
                '<GetValueListForField xmlns="http://archer-tech.com/webservices/">'+
                    '<sessionToken>'+token+'</sessionToken>'+
                    '<fieldId>'+fieldID+'</fieldId>'+
                '</GetValueListForField>'+
            '</soap:Body>'+
        '</soap:Envelope>'
        );
    }

    function getLevelsByApplicationId(token) {
        var lvlResponse = sendRestRequest('levelIdByModuleId', '', token, true);
        return dq(lvlResponse, 'RequestedObject.Id');
    }

    function createMappingFieldIdToName(levels, token) {
        var mapping = {};
        if (!levels) {
            throw 'Mapping levels to Fields failed';
        }

        if (!Array.isArray(levels)) {
            levels = [levels];
        }

        levels.forEach(function (lvl) {
            args.levelId = lvl;
            var fieldsLevelInfo = sendRestRequest('fieldByLevelId', '' ,token, true);

            if (!Array.isArray(fieldsLevelInfo)) {
               fieldsLevelInfo = [fieldsLevelInfo];
            }

            fieldsLevelInfo.forEach(function (field) {
                if (field.RequestedObject.Type !== 25) {
                    mapping[field.RequestedObject.Id] = {
                        Type: field.RequestedObject.Type,
                        Name: field.RequestedObject.Name,
                        levelId: lvl
                    };
                }
            });
        });

        return mapping;
    }

    function createMappingNameToFieldId(levels, token) {
        var mapping = {};
        if (!levels) {
            throw 'Mapping levels to Fields failed';
        }

        if (!Array.isArray(levels)) {
            levels = [levels];
        }

        levels.forEach(function (lvl) {
            args.levelId = lvl;
            var fieldsLevelInfo = sendRestRequest('fieldByLevelId', '', token, true);

            if (!Array.isArray(fieldsLevelInfo)) {
                fieldsLevelInfo = [fieldsLevelInfo];
            }

            fieldsLevelInfo.forEach(function (field) {
                if (field.RequestedObject.Type !== 25) {
                    mapping[field.RequestedObject.Name] = {
                        Type: field.RequestedObject.Type,
                        Id: field.RequestedObject.Id,
                        levelId: lvl
                    };
                }
            });
        });

        return mapping;
    }

    function mapContentFieldNameToValue(mapping, fields) {
        var output = [];
        if (fields) {
            fields.forEach(function (field) {
                var groupValue
                if (field.Groups) {
                    var group = field.Groups.Group;
                    if (group) {
                        if (!Array.isArray(group)) {
                            group = [group]
                        }
                        group.forEach(function (gr) {
                            groupValue = groupValue ? groupValue + ',' + gr['-name'] : gr['-name']
                        })
                    }
                }
                output.push({
                    FieldId: field['-id'],
                    FieldName: mapping[field['-id']].Name,
                    FieldType: field['-type'],
                    Value: groupValue || field['-value'],
                    LevelId: field['-id']
                });
            });
        }
        return output;
    }

    function createContentContext (recordId, records) {
        var context = {};
        var fields = {};
        records.forEach(function (r) {
           fields[r.FieldName] = r.Value;
        });
        context.Id = recordId;
        context.Fields = fields;
        return context;
    }

    function getAppFields(token) {
        var applicationId = args.applicationId;
        var levels = getLevelsByApplicationId(token);
        var mapping = createMappingFieldIdToName(levels, token);
        var md = [];
        for (var fieldId in mapping) {
            md.push({
                FieldId: fieldId,
                FieldName: mapping[fieldId].Name,
                FieldType: mapping[fieldId].Type,
                LevelId: mapping[fieldId].levelId
            })
        }

        return {
            Type: entryTypes.note,
            Contents: mapping,
            ContentsFormat: formats.json,
            HumanReadable: tableToMarkdown(command, md),
            ReadableContentsFormat: formats.markdown
        };
    }

    function getRecord(command, token) {
        var contentId = args.contentId;
        var applicationId = args.applicationId;
        var levels = getLevelsByApplicationId(token);
        var mapping = createMappingFieldIdToName(levels, token);

        var soap = getContentSoapRequest(token, applicationId, contentId);
        var SOAPAction = 'http://archer-tech.com/webservices/GetRecordById';
        var response = JSON.parse(x2j(sendSoapRequest(command, soap, SOAPAction)));

        if (response === null || typeof response !== 'object' || response === undefined) {
            throw "Error in response. Check request : " + soap;
        }

        var parsedJSON = extractObjectFromXML(response, 'Envelope.Body.GetRecordByIdResponse.GetRecordByIdResult');
        var nameToValue = mapContentFieldNameToValue(mapping, parsedJSON.Record.Field);

        return {
            Type: entryTypes.note,
            Contents: response,
            ContentsFormat: formats.json,
            HumanReadable: tableToMarkdown(command, nameToValue),
            ReadableContentsFormat: formats.markdown,
            EntryContext: {'Archer.Content(true)': createContentContext(contentId, nameToValue)}
        };
    }

    function getListOfApplications(command, token) {
        var body = '';
        var applicatInfo = [];
        var queryParams = '';
        if (args.findByName !== undefined) {
            body = { Value: "?$filter=Name eq '" + args.findByName + "'" };
        } else if (args.findById) {
            queryParams = '/' + args.findById;
        }

        var applictions = sendRestRequest(command, body, token, true, queryParams)

        if (!Array.isArray(applictions)) {
            applictions = [applictions];
        }

        applictions.forEach(function (app) {
            var record = app.RequestedObject;
            if (record) {
                applicatInfo.push({
                    Type: record.Type,
                    LanguageId: record.LanguageId,
                    Id: record.Id,
                    Name: record.Name,
                    Guid: record.Guid,
                    Status: record.Status
                })
            }
        });

        return {
            Type: entryTypes.note,
            Contents: applicatInfo,
            ContentsFormat: formats.json,
            HumanReadable: tableToMarkdown(command, applicatInfo),
            ReadableContentsFormat: formats.markdown,
            EntryContext: {'Archer.Applications': applicatInfo}
        };
    }

    function inputToXML(fieldsToValue, mapping, token){
        var fields = '';
        for (var key in fieldsToValue) {
            if (mapping[key] !== undefined) {
                switch(mapping[key].Type){
                    case 1:
                    case 2:
                    case 3:
                    case 19:
                        fields += '<Field id="' + mapping[key].Id +'" value="' + fieldsToValue[key] + '" />';
                        break;
                    case 9:
                    case 18:
                        fields += '<Field id="' + mapping[key].Id +'" value="' + fieldsToValue[key][0] +'">';
                        for(var i=1; i<fieldsToValue[key].length; i++){
                            fields+= '<MultiValue value="'+fieldsToValue[key][i]+'" />';
                        }
                        fields+= '</Field>';
                        break;
                    case 4:
                        //fieldsToValue[key] is of the form [value1, value2,...]
                        listValueIdtoName = getValueListForField(commands.valueListForField, token ,{fieldID : mapping[key].Id});
                        fields += '<Field id="' + mapping[key].Id +'" value="' + listValueIdtoName[fieldsToValue[key][0]] +'">';
                        for(var i=1; i<fieldsToValue[key].length; i++){
                            fields+= '<MultiValue value="'+listValueIdtoName[fieldsToValue[key][i]]+'" />';
                        }
                        fields+= '</Field>';
                        break;
                    case 7:
                        //fieldsToValue[key] is of the form [{value: ___ , link: ___}, {value: ___ , link: ___}, ...]
                        fields += '<Field id="' + mapping[key].Id +'" value="' + fieldsToValue[key][0].value + '" link="'+fieldsToValue[key][0].link+'">';
                        for(var i=1; i<fieldsToValue[key].length; i++){
                            fields+= '<MultiValue value="'+fieldsToValue[key][i].value+'" link="'+fieldsToValue[key][i].link+'" />';
                        }
                        fields+= '</Field>';
                        break;
                    case 8:
                    case 15:
                        //fieldsToValue[key] is of the form {groups: [group1, group2,...], users : [user1, user2,...]}
                        fields+= '<Field id="' + mapping[key].Id + '" >';
                        groups = fieldsToValue[key].groups;
                        users = fieldsToValue[key].users;
                        if(groups && Array.isArray(groups) && groups.length > 0){
                            fields += '<Groups>';
                            for(var i=0; i<groups.length; i++){
                                fields += '<Group id="' + groups[i] + '" />';
                            }
                            fields += '</Groups>'
                        }
                        if(users && Array.isArray(users) && users.length > 0){
                            fields += '<Users>';
                            for(var i=0; i<users.length; i++){
                                fields += '<User id="' + users[i] + '" />';
                            }
                            fields += '</Users>'
                        }
                        fields+='</Field>';
                        break;
                    //case 14, 16 : not supported yet
                }
            }
        }
        return fields;
    }

    function createRecord(command, token, dataArgs) {
        var appId = dataArgs.applicationId;
        var fieldsToValue = JSON.parse(dataArgs.fieldsToValues);
        if (fieldsToValue === null || typeof fieldsToValue !== 'object') {
            throw 'Invalid Argument fieldToValue';
        }

        var levels = getLevelsByApplicationId(token);
        var mapping = createMappingNameToFieldId(levels, token);
        var fields = inputToXML(fieldsToValue, mapping, token);

        var soap = createContentSoapRequest(token, appId, fields);
        var SOAPAction = 'http://archer-tech.com/webservices/CreateRecord';
        var response = JSON.parse(x2j(sendSoapRequest(command, soap, SOAPAction)));

        if (response === null || typeof response !== 'object' || response === undefined) {
            throw "Error in response. Check request : " + soap;
        }

        var contentId = dq(response, 'Envelope.Body.CreateRecordResponse.CreateRecordResult');
        var md = fieldsToValue;
        md.Id = contentId;

        if (!contentId) {
            return {
                ContentsFormat: formats["markdown"],
                Type: entryTypes["error"],
                Contents: "Recived an error" + JSON.stringify(response)
            };
        }

        return {
            Type: entryTypes.note,
            Contents: response,
            ContentsFormat: formats.json,
            HumanReadable: tableToMarkdown(command, md),
            ReadableContentsFormat: formats.markdown,
            EntryContext: {'Archer.Content(true)': {Id: contentId , Fields: fieldsToValue}}
        };
    }

    function updateRecord(command, token, dataArgs) {
        var appId = dataArgs.applicationId;
        var contentId = dataArgs.contentId;
        var fieldsToValue = JSON.parse(dataArgs.fieldsToValues);

        if (fieldsToValue === null || typeof fieldsToValue !== 'object') {
            throw 'Invalid Argument fieldToValue';
        }

        var levels = getLevelsByApplicationId(token);
        var mapping = createMappingNameToFieldId(levels, token);
        var fields = inputToXML(fieldsToValue, mapping, token);

        var soap = updateContentSoapRequest(token,appId,contentId,fields);
        var SOAPAction = 'http://archer-tech.com/webservices/UpdateRecord';
        var response = JSON.parse(x2j(sendSoapRequest(command, soap, SOAPAction)));

        if (response === null || typeof response !== 'object' || response === undefined) {
            throw "Error in response. Check request : " + soap;
        }

        var result = dq(response, 'Envelope.Body.UpdateRecordResponse.UpdateRecordResult');
        if (!result && result < 1) {
            return {
                ContentsFormat: formats["markdown"],
                Type: entryTypes["error"],
                Contents: "Recived an error" + JSON.stringify(response)
            };
        }

        return {
            Type: entryTypes.note,
            ContentsFormat: formats.json,
            Contents: response,
            ReadableContentsFormat: formats.markdown,
            HumanReadable: 'content id = ' + contentId + ' was updated successfully'
        }
    }

    function getValueListForField(command, token, dataArgs){
        var SOAPAction = 'http://archer-tech.com/webservices/GetValueListForField';
        var fieldID = dataArgs.fieldID;
        var soap = getValueListForFieldSoapRequest(token, fieldID);
        var response = JSON.parse(x2j(sendSoapRequest(command, soap, SOAPAction)));
        var result = dq(response, 'Envelope.Body.GetValueListForFieldResponse.GetValueListForFieldResult');
        result = dq(JSON.parse(x2j(result)), 'SelectDef.SelectDefValues.SelectDefValue(true)={Name: val.Name, Id : val.Id}');
        var ret = {};
        for(key in result){
            ret[result[key]['Name']] = result[key]['Id'];
        }
        return ret;
    }

    function deleteRecord(command, token, dataArgs) {
        var appId = dataArgs.applicationId;
        var contentId = dataArgs.contentId;
        var soap =  deleteContentSoapRequest(token, appId, contentId);
        var SOAPAction = 'http://archer-tech.com/webservices/DeleteRecord';

        var response = JSON.parse(x2j(sendSoapRequest(command, soap, SOAPAction)));
        if (response === null || typeof response !== 'object' || response === undefined) {
            throw "Error in response. Check request : " + soap;
        }

        var result = dq(response, 'Envelope.Body.DeleteRecordResponse.DeleteRecordResult');
        if (!result && result < 1) {
            return {
                ContentsFormat: formats.markdown,
                Type: entryTypes.error,
                Contents: "Recived an error while deleting record: " + JSON.stringify(response)
            };
        }

        return {
            Type: entryTypes.note,
            Contents: 'content id = ' + contentId + ' was deleted successfully'
        }
    }

    function searchRecords(command, token, dataArgs) {
        var appId = dataArgs.applicationId;
        var fieldsToDisplay = dataArgs.fieldsToDisplay;
        var maxResults = dataArgs.maxResults;
        var fieldToSearchOn = dataArgs.fieldToSearchOn;
        var searchValue = dataArgs.searchValue;
        var numericOperator = dataArgs.numericOperator;
        var dateOperator = dataArgs.dateOperator;
        var isDescending = dataArgs.Descending;
        var pageNumber = dataArgs.pageNumber || '1';

        var levels = getLevelsByApplicationId(token);
        var mapping = createMappingNameToFieldId(levels, token);
        var reversemapping = createMappingFieldIdToName(levels, token);
        var fields = ''

        if (!fieldsToDisplay) {
            fieldsToDisplay = Object.keys(mapping);
        }

        if (fieldsToDisplay && !Array.isArray(fieldsToDisplay)){
            fieldsToDisplay = fieldsToDisplay.split(',');
        }

        if (fieldsToDisplay) {
            fieldsToDisplay.forEach(function (field) {
                if (field && mapping[field] !== undefined) {
                    fields += '<DisplayField name="' + escapeXMLChars(field) +'">' + mapping[field].Id + '</DisplayField>';
                }
            });
        }

        var fieldIdToSearchOn;
        var fieldNameToSearchOn;
        if (fieldToSearchOn) {
            fieldIdToSearchOn = mapping[fieldToSearchOn] ? mapping[fieldToSearchOn].Id : '';
            fieldNameToSearchOn = fieldToSearchOn;
        }

        var soap = getContentsByAppIdRequest(token, appId, fields, maxResults, fieldIdToSearchOn, fieldNameToSearchOn, searchValue, fieldIdToSearchOn, isDescending, numericOperator, dateOperator, pageNumber);

        var SOAPAction = 'http://archer-tech.com/webservices/ExecuteSearch';
        var response = JSON.parse(x2j(sendSoapRequest(command, soap, SOAPAction)));

        if (response === null || typeof response !== 'object' || response === undefined) {
            throw "Error in response. Check request : " + soap;
        }

        var output = parseRecordsXml(response, reversemapping);
        var md = [];
        output.forEach(function (out) {
            md.push(treeToFlattenObject(out));
        })

        return {
            Type: entryTypes.note,
            Contents: output,
            ContentsFormat: formats.json,
            HumanReadable: tableToMarkdown(command, md),
            ReadableContentsFormat: formats.markdown,
            EntryContext: { 'Archer.Content(true)': output }
        };
    }

    function getOccurredTime(recordTimeStr, tz) {
        var occurred = new Date();
        if (recordTimeStr) {
            var tzHour = tz / 60;
            if (tzHour < 0) {
                tzHour *= -1;
            }
            var tzMinute = tz % 60;
            var tzPrefix = tz < 0 ? '-' : '+';
            var tzHourstr = tzHour + '';
            if (tzHourstr.length < 2) {
                tzHourstr = '0' + tzHourstr;
            }
            var tzMinutestr = tzMinute +'';
            if (tzMinutestr.length < 2) {
                tzMinutestr = '0' + tzMinutestr;
            }

            // convert 7/18/2017 8:17:49 AM to 2017-07-18T20:17:49-0800
            var dateStr = recordTimeStr.split(' ')[0];
            var monthStr = dateStr.split('/')[0];
            var dayStr = dateStr.split('/')[1];
            var yearStr = dateStr.split('/')[2];

            var timeStr = recordTimeStr.split(' ')[1];
            var extStr = recordTimeStr.split(' ')[2];
            var hourInt = Number(timeStr.split(':')[0]);
            var minStr = timeStr.split(':')[1];
            var secStr = timeStr.split(':')[2];

            if (extStr == "PM" && hourInt < 12) {
                hourInt = hourInt + 12;
            }

            if (extStr == "AM" && hourInt == 12) {
                hourInt = hourInt - 12;
            }

            var hourStr = hourInt + '';
            if (Number(hourInt) < 10 && hourStr.length === 1) {
                hourStr = "0" + hourStr;
            }

            if (Number(minStr) < 10 && minStr.length === 1) {
                minStr = "0" + minStr;
            }

            if (Number(dayStr) < 10 && dayStr.length === 1) {
                dayStr = "0" + dayStr;
            }

            if (Number(monthStr) < 10 && monthStr.length === 1) {
                monthStr = "0" + monthStr;
            }

            recordTimeStr = yearStr + '-' +  monthStr + '-' + dayStr + 'T' + hourStr + ':' + minStr + ':' + secStr;
            occurred = new Date(Date.parse(recordTimeStr + tzPrefix + tzHourstr + tzMinutestr));
        }

        return occurred;
    }

    function toDateArcherString(date) {
        var day = Number(date.getDate());
        var month = Number(date.getMonth()) + 1;
        var year = date.getFullYear();
        var hour = date.getHours();
        var minutes = date.getMinutes();
        var seconds = date.getSeconds();
        var ext = 'AM';
        var finalHour = hour;

        if (hour > 12) {
            ext = 'PM';
            finalHour = (hour - 12);
            if (finalHour == 12) {
                ext = 'AM';
            }
        } else if (hour < 12) {
            finalHour = hour;
            ext = 'AM';
        } else if (hour == 12) {
            ext = 'PM';
        }

        if (minutes < 10) {
            minutes = '0' + minutes;
        }

        if (seconds < 10) {
            seconds = '0' + seconds;
        }

        // format such: 7/22/2017 3:58 PM
        return month + '/' + day + '/' + year + ' ' + finalHour + ':' + minutes + ':' + seconds + ' ' + ext;
    }

    function fetchIncidents(token, dataArgs) {
        var myTimezone = new Date().getTimezoneOffset() * -1;
        var tz = params.timeZone ? parseInt(params.timeZone) : myTimezone;
        if (params.timeZone === '0') {
            tz = 0;
        }

        var cmd = commands.searchRecords;
        var incidentRes = [];
        var lastRun = getLastRun();

        var day = 60 * 1000 * 60 * 24;
        var lastTime = lastRun.lastTime;
        if (!lastRun.lastTime) {
            lastTime = new Date().getTime() - (day * 1);
        }

        var searchByField = params.fetchByField;
        dataArgs.applicationId = params.fetchApplicationId;
        dataArgs.dateOperator = 'GreaterThan';
        dataArgs.searchValue = toDateArcherString(new Date(lastTime));
        dataArgs.fieldToSearchOn = searchByField;
        dataArgs.fieldsToDisplay = params.fetchFields + ',' + searchByField;

        var incidents = [];
        var results = searchRecords(cmd, token, dataArgs);

        if (results && results.Contents && results.Contents.length > 0) {
            for (var i = 0; i < results.Contents.length; i++) {
                var res = results.Contents[i];
                var labels = [];

                var fields = Object.keys(res.Fields);
                if (fields) {
                    for (var j = 0; j < fields.length; j++) {
                        var fieldName = fields[j];
                        var fieldValue = res.Fields[fieldName];
                        if (fieldName === searchByField) {
                            lastTime = getOccurredTime(fieldValue, tz);
                        }
                        labels.push({ 'type': fieldName, 'value': fieldValue });
                    }
                }

                var raw = JSON.stringify(res);
                incidents.push({
                    name: 'RSA Archer Incident: ' + res.Id,
                    labels: labels,
                    details: raw,
                    rawJSON: raw,
                    occurred: lastTime
                });
            }

            var offset = tz ? (60 * 1000 * new Date().getTimezoneOffset()) : 0;
            setLastRun({ lastTime: lastTime.getTime() + offset });
        }

        return (JSON.stringify(incidents));
    }

    function getAuthToken() {
        var result = sendRestRequest("login",
            {
                InstanceName: params.instanceName,
                Username: params.credentials.identifier,
                Password: params.credentials.password
            },
            false
        );

        if (result.IsSuccessful != true) {
            throw 'Login failed. Result = ' + JSON.stringify(result);
        }

        return result.RequestedObject.SessionToken;
    }

    switch (command) {
        case 'test-module':
            var token = getAuthToken();
            return !!token ? 'ok' : 'not-ok';
        case commands.createRecord:
            return createRecord(command, getAuthToken(), args);
        case commands.valueListForField:
            return getValueListForField(command, getAuthToken(), args);
        case commands.updateRecord:
            return updateRecord(command, getAuthToken(), args);
        case commands.deleteRecord:
            return deleteRecord(command, getAuthToken(), args);
        case commands.getRecord:
            return getRecord(command, getAuthToken());
        case commands.searchApps:
            return getListOfApplications(command, getAuthToken());
        case commands.searchRecords:
            return searchRecords(command, getAuthToken() , args);
        case commands.getAppFields:
            return getAppFields(getAuthToken());
        case 'fetch-incidents':
            return fetchIncidents(getAuthToken(), args);
        default:
            break;
    }
  type: javascript
  commands:
  - name: archer-create-record
    arguments:
    - name: applicationId
      required: true
      description: ID of the application to create record in
    - name: fieldsToValues
      required: true
      description: 'Record fields in JSON format: { Name1: Value1, Name2: Value2 }.
        Field name is case sensitive.'
    outputs:
    - contextPath: Archer.Content.Id
      description: Content Id
    - contextPath: Archer.Content.Fields
      description: Content property fields
    description: Creates a new content record in the given application.
  - name: archer-update-record
    arguments:
    - name: contentId
      required: true
      description: The Content (record) ID to update
    - name: applicationId
      required: true
      description: ID of the application to update record in
    - name: fieldsToValues
      required: true
      description: 'Record fields in JSON format: { Name1: Value1, Name2: Value2 }.
        Field name is case sensitive.'
    description: Updates existing content record in the given application.
  - name: archer-get-record
    arguments:
    - name: contentId
      required: true
      description: 'The Content (record) ID to get details for (for example: id=12345
        for INC-12345)'
    - name: applicationId
      required: true
      description: ID of the application to get record from
    outputs:
    - contextPath: Archer.Content.Id
      description: Content Id
    - contextPath: Archer.Content.Fields
      description: Content property fields
    description: Gets information about a content record in the given application.
  - name: archer-search-applications
    arguments:
    - name: findByName
      default: true
      description: Get application by name (leave empty to get all applications)
    - name: findById
      description: Get application by ID (leave empty to get all applications)
    outputs:
    - contextPath: Archer.Applications.Id
      description: Application Id
    - contextPath: Archer.Applications.Type
      description: Application Type
    - contextPath: Archer.Applications.Name
      description: Application Name
    - contextPath: Archer.Applications.Status
      description: Application Status
    - contextPath: Archer.Applications.Guid
      description: Unique Id of application
    description: Gets application details or list of all applications.
  - name: archer-search-records
    arguments:
    - name: applicationId
      required: true
      description: ID of the application to search records in
    - name: fieldsToDisplay
      description: 'Fields to present in the search results in array format (for example:
        "Title,Incident Summary")'
      isArray: true
    - name: maxResults
      description: Maximum results to return from the search (default is 100)
      defaultValue: "100"
    - name: searchValue
      description: Search value (leave empty to search for all)
    - name: fieldToSearchOn
      description: Name of field to search on (leave empty to search for all)
    - name: numericOperator
      auto: PREDEFINED
      predefined:
      - Equals
      - NotEqual
      - GreaterThan
      - LessThan
      description: Numeric search operator
    - name: dateOperator
      auto: PREDEFINED
      predefined:
      - Equals
      - DoesNotEqual
      - GreaterThan
      - LessThan
      description: Date search operator
    outputs:
    - contextPath: Archer.Content.Id
      description: Content Id
    - contextPath: Archer.Content.ApplicationId
      description: Application Id
    - contextPath: Archer.Content.Fields
      description: Content property fields
    description: Search for records inside the given application
  - name: archer-get-application-fields
    arguments:
    - name: applicationId
      required: true
      default: true
      description: ID of the application to search fields in
    description: Gets all application fields by application ID
  - name: archer-delete-record
    arguments:
    - name: applicationId
      required: true
      description: ID of the application to delete record in
    - name: contentId
      required: true
      description: The Content (record) ID to delete
    description: Delete existing content record in the given application.
  - name: archer-value-list-for-field
    arguments:
    - name: fieldID
      description: ID of the field
    description: Returns mapping from list value name to list value id
  isfetch: true
