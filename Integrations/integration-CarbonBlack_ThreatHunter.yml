commonfields:
  id: Carbon Black ThreatHunter
  version: -1
name: Carbon Black ThreatHunter
display: Carbon Black ThreatHunter
category: Endpoint
image: data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAANCAQAAADIgmIrAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAALiMAAC4jAXilP3YAAAAHdElNRQfjCAERHzFVqCjLAAAFU0lEQVRIx63Wa4xV1RUH8N+98+IxCCNQ3vKMCFiDvMKogIotlGoipVXTEAhYUxNDi62JFcFIFJFIk1ZbA4oUa6FQbGBkkFcIFT9YC4ZCKQ4MCMPD0XkwDvNg7sydu/uBwzi3M22mSdf+ss9//8/a63/OWmtvIMN9tiiVVO+IJQbqmD3vU78U6yD7v1uWFXa3jF3eMlsOmGGvN3XvsKc86+31rf9M6GqZLwXNrqgXNCvQo0Ou1wo2i/9fBOfYK6SNryyThYWCE3p32FNfpwTz21/MlO1pz2CHzc7o4i7zFKtr+e654mo0gpgMNAuICQKClLjuuKK5jYgQvZlunTS14RKwzSbQ03z5FnvfJwJSrXhZMjSmIdfRREtE17y1K3iWRVjtJTXggK2qNIkZ6X5TDRFzxibbNepvhW5e0my2ar+KwpzgcePFHLfOB9FG2e7xoBGa/N1WR8AP3emwYnONcFmBP2toE88J70azIoV6uMknrVa7m+xeY3TxuUIFrkb4KD8wUWfn7LAvzV9/i9zgPXu+hvYK9rdTIXGrpFQocklQa5GYkcoFhUoFW8WtEZxwWrXz6gRf+B7o5hU1glpXBRc8KgPrBCU+V+eq4KpfyEjLhj2ClWJiYjp5TEK5sVggOK43HlIrqVKVoMFKOYj5vmJBQo2gwiS9FAnmIe4FwQW3tRZWLVjc7t8faYFb3Gio16UUG2iEUkHKHgvdjjWCYKd8g9zrQ8FR/cUskVThWRNNtU6jy2bhDUHCb+WbYpugxIg2go/baKNNdqlS5UmZaYL7es4DbjbGixpcMQ13uCRls+nGe9JqnfVRJJiLSUol/Ty9rTZr9nD7+a6HCaab7gm1GkwzTKmgQM9ofY3grJHR02RlkuYY7KwmP43QrjYKdupsreCAXDBWuURaJ70muPU4a6ZYmmDi+hltjClOCZ4S97Zgt7zISzaR4KUmKRQc1Cu9hi/rZXC71f2IxW6RKYjJltQJpPxRZSveMWei2XGn5RuuziAXbY/QOn/ykG/6hoBLUTssUy1PVptdt/p9FPg0j3rLPPtbrY72lHuiEyQXXd1gHLapihhft8glnpar1isq0mV9YI7ZNij7t62/7TXZ3vGxpD6e1bUlI6rSePGWhImJIyVDTFKyhZEQxKN6TT+z23bSUwqj2Q59POxxB6LnlP7Wyfexjepkmm84kd9EOz+sQqMukqrT4bjf+MIkK/RtQe40At/Vw05P+J13vKepVajpQY81OpqNd7Mmp5xWboCpEZrhO7KcVvY/XlCaJTGgJQtS7jLZGXMttdJKFxFzRRFmRNnX2la6z0E9/CwqoonWWWNspoNetMqP3OpdxbqaYo7dHlOPfoa4JM+P3djm3LtuA71qhfNGWSrPIX912RY/8YKUD+V4xAIN1qvtkOCh7gbZ7nY//tGSpEEcmXLFZJlpDEhab7oHnbNerQmGeT3i1zlnlXFmmuNtuZZ5gGvFm2Whk4IgKQjqbdDNRKcFxfb7p/MSkmYarkyzmS3hrRUcc0ydMgnBZ2aAfrZISihWIuWK5TrhTcGmSHZ/n0mZ1UrqtZtWswYNGjQKUj4yxvWbVk+DHBIU+YNCJeoFy5FpsQrBRafUqzRR75abVpY1guOGuME+QXAwAylHHFAtW1DmoJf9Wo1SR3V3kzwfeRkXvO+yYUrsUhoFOVhQYLVu+qqxzzNRxdU6oNogQ+X4m+e9IYHb9XQ4akKd3aHedudbFVe+bOUqVapU7qSNnnMSg41WrMCXjhrgNuM0e9VXYv7isJTDPtXLcL1csME+SVM02umklBK3ynHRIVVGOW/5vwCRVxOkz2hVNwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0wOC0wMVQxNzozMTo0OCswMDowMFIiO5cAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMDgtMDFUMTc6MzE6NDgrMDA6MDAjf4MrAAAAAElFTkSuQmCC
description: Next-generation antivirus + EDR in one cloud-delivered platform that
  stops commodity malware, advanced malware, non-malware attacks and ransomware
configuration:
- display: Server URL (e.g. https://192.168.0.1)
  name: url
  defaultvalue: ""
  type: 0
  required: true
- display: API Key
  name: key
  defaultvalue: ""
  type: 4
  required: true
- display: API Version
  name: version
  defaultvalue: v3
  type: 0
  required: true
- display: Connector ID
  name: connectorId
  defaultvalue: ""
  type: 0
  required: true
- display: Fetch incidents
  name: isFetch
  defaultvalue: ""
  type: 8
  required: false
- display: Incident type
  name: incidentType
  defaultvalue: ""
  type: 13
  required: false
- display: SIEM key. Use to fetch incidents.
  name: siemKey
  defaultvalue: ""
  type: 4
  required: false
- display: SIEM Connector ID. Use to fetch incidents.
  name: siemConnector
  defaultvalue: ""
  type: 0
  required: false
- display: Trust any certificate (unsecure)
  name: insecure
  defaultvalue: ""
  type: 8
  required: false
- display: Use system proxy settings
  name: proxy
  defaultvalue: ""
  type: 8
  required: false
script:
  script: |-
    var CBThreatHunter = function() {
        var client = (function() {
            var urlTemplae = '%url%/integrationServices/%version%/';
            var authTemplate = '%key%/%connectorId%';
            var authSiemTemplate = '%siemKey%/%siemConnector%';
            var urlFull = replaceInTemplates(urlTemplae, params);
            var AuthToken = replaceInTemplates(authTemplate, params);
            var SiemToken = replaceInTemplates(authSiemTemplate, params);
            function addAuthToHeaders(headerObj, token) {
                 if (headerObj === 'undefined') {
                    return { 'X-Auth-Token': [token] };
                }
                headerObj['X-Auth-Token'] = [token];
                return headerObj;
            }
            var addClientAuthToHeaders = function(headerObj) {
                return addAuthToHeaders(headerObj, AuthToken);
            };
            var addSiemKeyToHeaders = function(headerObj) {
                return addAuthToHeaders(headerObj, SiemToken);
            };
            return {
                url: urlFull,
                addClientAuthToHeaders: addClientAuthToHeaders,
                addSiemKeyToHeaders: addSiemKeyToHeaders
            };
        })();
        var policyData = [
            {to: 'Id', from: 'id'},
            {to: 'PriorityLevel', from: 'priorityLevel'},
            {to: 'SystemPolicy',from: 'systemPolicy'},
            {to: 'LatestRevision',from: 'latestRevision'},
            {to: 'Policy',from: 'policy'}
        ];
        var commands = {
            'cbth-get-devices-status': {
                path: 'device',
                method: 'GET',
                queryParams: {
                    start: true,
                    rows: true,
                    hostName: true,
                    hostNameExact: true,
                    ownerName: true,
                    ownerNameExact: true,
                    ipAddress: true
                },
                extended: true,
                translator:[
                    {
                        contextPath: 'CarbonBlackThreatHunter.GetDevicesStatus.Results(val.DeviceId==obj.DeviceId)',
                        title: 'Carbon Black Defense Get Devices Status',
                        innerPath: 'results',
                        data: [
                            { to: 'Name', from: 'name'},
                            { to: 'LastReportedTime', from: 'lastReportedTime'},
                            { to: 'PolicyId', from: 'policyId'},
                            { to: 'LastShutdownTime', from: 'lastShutdownTime'},
                            { to: 'LastContact', from: 'lastContact'},
                            { to: 'LastExternalIpAddress', from: 'lastExternalIpAddress'},
                            { to: 'AvStatus', from: 'avStatus'},
                            { to: 'RegisteredTime', from: 'registeredTime'},
                            { to: 'TargetPriorityType', from: 'targetPriorityType'},
                            { to: 'OrganizationId', from: 'organizationId'},
                            { to: 'DeviceOwnerId', from: 'deviceOwnerId'},
                            { to: 'Email', from: 'email'},
                            { to: 'ActivationCodeExpiryTime', from: 'activationCodeExpiryTime'},
                            { to: 'SensorVersion', from: 'sensorVersion'},
                            { to: 'Status', from: 'status'},
                            { to: 'TestId', from: 'testId'},
                            { to: 'DeviceId', from: 'deviceId'},
                            { to: 'SensorStates', from: 'sensorStates'},
                            { to: 'PolicyName', from: 'policyName'},
                            { to: 'SensorOutOfDate', from: 'sensorOutOfDate'},
                            { to: 'LastLocation', from: 'lastLocation'},
                            { to: 'DeviceType', from: 'deviceType'},
                            { to: 'OsVersion', from: 'osVersion'},
                            { to: 'LastInternalIpAddress', from: 'lastInternalIpAddress'},
                            { to: 'OrganizationName', from: 'organizationName'}
                        ]
                    }
                ]
            },
            'cbth-get-device-status': {
                path: 'device/%deviceId%',
                method: 'GET',
                extended: true,
                translator:[
                    {
                        contextPath: 'CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo(val.DeviceId==obj.DeviceId)',
                        title: 'Carbon Black Defense Get Device Status',
                        innerPath: 'deviceInfo',
                        data: [
                            { to: 'Name', from: 'name'},
                            { to: 'LastReportedTime', from: 'lastReportedTime'},
                            { to: 'PolicyId', from: 'policyId'},
                            { to: 'LastShutdownTime', from: 'lastShutdownTime'},
                            { to: 'LastContact', from: 'lastContact'},
                            { to: 'LastExternalIpAddress', from: 'lastExternalIpAddress'},
                            { to: 'AvStatus', from: 'avStatus'},
                            { to: 'RegisteredTime', from: 'registeredTime'},
                            { to: 'TargetPriorityType', from: 'targetPriorityType'},
                            { to: 'OrganizationId', from: 'organizationId'},
                            { to: 'DeviceOwnerId', from: 'deviceOwnerId'},
                            { to: 'Email', from: 'email'},
                            { to: 'ActivationCodeExpiryTime', from: 'activationCodeExpiryTime'},
                            { to: 'SensorVersion', from: 'sensorVersion'},
                            { to: 'Status', from: 'status'},
                            { to: 'TestId', from: 'testId'},
                            { to: 'DeviceId', from: 'deviceId'},
                            { to: 'SensorStates', from: 'sensorStates'},
                            { to: 'PolicyName', from: 'policyName'},
                            { to: 'SensorOutOfDate', from: 'sensorOutOfDate'},
                            { to: 'LastLocation', from: 'lastLocation'},
                            { to: 'DeviceType', from: 'deviceType'},
                            { to: 'OsVersion', from: 'osVersion'},
                            { to: 'LastInternalIpAddress', from: 'lastInternalIpAddress'},
                            { to: 'OrganizationName', from: 'organizationName'}
                        ]
                    }
                ]
            },
            'cbth-get-alert-details': {
                path: 'alert/%alertId%',
                method: 'GET',
                extended: true,
                translator : [
                    {
                        contextPath: 'CarbonBlackThreatHunter.GetAlertDetails.DeviceInfo(val.DeviceId==obj.DeviceId)',
                        title: 'Carbon Black Defense Get Alert Details',
                        data: [
                            { to: 'DeviceInfo.DeviceType', from: 'deviceInfo.deviceType'},
                            { to: 'DeviceInfo.Group', from: 'deviceInfo.adGroupName'},
                            { to: 'DeviceInfo.GroupId', from: 'deviceInfo.adGroupId'},
                            { to: 'DeviceInfo.RegisteredTime', from: 'deviceInfo.registeredTime'},
                            { to: 'DeviceInfo.DeviceId', from: 'deviceInfo.deviceId'},
                            { to: 'DeviceInfo.DeviceName', from: 'deviceInfo.deviceName'},
                            { to: 'DeviceInfo.Status', from: 'deviceInfo.status'},
                            { to: 'DeviceInfo.OsVersion', from: 'deviceInfo.osVersion'},
                            { to: 'DeviceInfo.SensorVersion', from: 'deviceInfo.sensorVersion'},
                            { to: 'DeviceInfo.UserName', from: 'deviceInfo.userName'},
                            { to: 'DeviceInfo.Importance', from: 'deviceInfo.importance'},
                            { to: 'DeviceInfo.Message', from: 'deviceInfo.message'},
                            { to: 'DeviceInfo.Success', from: 'deviceInfo.success'},
                            { to: 'Events.ParentHash', from: 'events.parentHash'},
                            { to: 'Events.PolicyState', from: 'events.policyState'},
                            { to: 'Events.LongDescription', from: 'events.longDescription'},
                            { to: 'Events.CommandLine', from: 'events.commandLine'},
                            { to: 'Events.ParentPid', from: 'events.parentPid'},
                            { to: 'Events.ProcessId', from: 'events.processId'},
                            { to: 'Events.ThreatIndicators', from: 'events.threatIndicators'},
                            { to: 'Events.ApplicationPath', from: 'events.applicationPath'},
                            { to: 'Events.ProcessHash', from: 'events.processHash'},
                            { to: 'Events.ProcessMd5Hash', from: 'events.processMd5Hash'},
                            { to: 'Events.EventId', from: 'events.eventId'},
                            { to: 'Events.EventTime', from: 'events.eventTime'},
                            { to: 'Events.EventType', from: 'events.eventType'},
                            { to: 'Events.KillChainStatus', from: 'events.killChainStatus'},
                            { to: 'Events.ParentName', from: 'events.parentName'},
                            { to: 'Events.ParentPPid', from: 'events.parentPPid'},
                            { to: 'Events.ProcessPPid', from: 'events.processPPid'},
                            { to: 'OrgId', from: 'orgId'},
                            { to: 'ThreatInfo.IncidentId', from: 'threatInfo.incidentId'},
                            { to: 'ThreatInfo.Indicators.ApplicationName', from: 'threatInfo.indicators.applicationName'},
                            { to: 'ThreatInfo.Indicators.IndicatorName', from: 'threatInfo.indicators.indicatorName'},
                            { to: 'ThreatInfo.Indicators.Sha256Hash', from: 'threatInfo.indicators.sha256Hash'},
                            { to: 'ThreatInfo.Summary', from: 'threatInfo.summary'},
                            { to: 'ThreatInfo.ThreatId', from: 'threatInfo.threatId'},
                            { to: 'ThreatInfo.ThreatScore', from: 'threatInfo.threatScore'},
                            { to: 'ThreatInfo.Time', from: 'threatInfo.time'}
                        ],
                        contextTranslator: [
                            {
                                contextPath: 'Endpoint(val.deviceName==obj.deviceName)',
                                innerPath: 'deviceInfo',
                                data: [
                                    {to: 'Hostname', from: 'deviceName'},
                                    {to: 'OS', from: 'deviceType'}
                                ]
                            },
                            {
                                contextPath: 'Process(val.processId==obj.processId)',
                                innerPath: 'events',
                                data: [
                                    {to: 'PID', from: 'processId'},
                                    {to: 'CommandLine', from: 'commandLine'},
                                    {to: 'MD5', from: 'processMd5Hash'},
                                    {to: 'Path', from: 'applicationPath'},
                                    {to: 'ParentName', from: 'parentName'},
                                    {to: 'ParentID', from: 'parentPid'}
                                ]
                            },
                            {
                                contextPath: 'Process(val.deviceName==obj.deviceName)',
                                innerPath: 'deviceInfo',
                                data: [{to: 'Endpoint', from: 'deviceName'}]
                            },
                            {
                                contextPath: 'Account(val.Email==obj.Email)',
                                innerPath: 'deviceInfo',
                                data: [
                                    {to: 'Email', from: 'userName'},
                                    {to: 'Groups', from: 'group'}
                                ]
                            }
                        ]
                    }
                ]
            },
            'cbth-get-notifications': {
                path: 'notification',
                method: 'GET',
                siemKey: true
            }
        };
        //Taken from common server- with modifications
        var createEntry = function(result, translator, headerTransform) {
            /* filters out all fields where humanReadable is false */
            var filter = function(obj) {
              if(obj.humanReadable !== false) {
                  return true;
              }
              return false;
            };
            var entry = {
              Type: entryTypes.note,
              Contents: result,
              ContentsType: formats.json,
              ReadableContentsFormat: formats.markdown,
              EntryContext: {}
            };
            var content = translator.innerPath ? dq(result, translator.innerPath) : result;
            var translatedContext = mapObjFunction(translator.data) (content);
            var translatedMD = mapObjFunction(translator.data, filter) (content);
            var context = createContext(translatedContext);
            entry.EntryContext[translator.contextPath] = context;
            entry.HumanReadable = tableToMarkdown(translator.title, translatedMD, undefined, undefined, headerTransform || dotToSpace);
            if (translator.contextTranslator) {
                var conTranslator = translator.contextTranslator;
                for (var i = 0; i < conTranslator.length; i++ ) {
                    addContextToEntry(result, entry, conTranslator[i]);
                }
            }
            return entry;
        };
        function addContextToEntry(result, entry, translator) {
            var content = translator.innerPath ? dq(result, translator.innerPath) : result;
            var translatedContext = mapObjFunction(translator.data) (content);
            var context = createContext(translatedContext);
            entry.EntryContext[translator.contextPath] = context;
        }
        var generateQuery = function(cmd) {
            var seperateQueryParams = (function() {
                var seperated = {};
                if (cmd.queryParams) {
                    for (var arg in args) {
                        if (cmd.queryParams[arg]) {
                           seperated[arg] = args[arg];
                        }
                    }
                }
                return seperated;
            })();
            var queryString = (function() {
                return encodeToURLQuery(seperateQueryParams);
            })();
            return {
                str: queryString,
                parameters: seperateQueryParams
            };
        };
        function sendRequest(fullurl, method, headers, body) {
            var req = {
                    Method: method,
                    Headers: headers
                };
            if (body !== 'undifiend') {
                req.Body = body;
            }
            var res = http(fullurl, req, params.insecure, params.proxy);
            return res;
        }
        function pathify(cmd) {
            return replaceInTemplates(cmd.path,args);
        }
        function buildBody(cmd) {
            content = cmd.content;
            assignContentFromArgs(content);
            return JSON.stringify(content);
        }
        function assignContentFromArgs(obj) {
            for (var key in obj) {
                if (obj[key] === null) {
                    if (args[key]) {
                        if (args[key] === 'true' || args[key] === 'false') {
                            obj[key] = (args[key] === 'true');
                        } else if (!isNaN(args[key])) {
                            obj[key] = parseInt(args[key]);
                        }
                        else {
                            obj[key] = args[key];
                        }
                    }
                } else if(typeof obj[key] === 'object' ) {
                    assignContentFromArgs(obj[key]);
                }
            }
        }
        var setPolicy = function() {
            var setter;
            var policy = args.policy;
            try {
                setter = JSON.parse(args.keyValue);
            } catch(err) {
                throw err;
            }
            for (var path in setter) {
                var val = setter[path];
                var keysArr = path.split('.');
                var obj = policy;
                var i = 0;
                while (obj && i < keysArr.length - 1) {
                    obj = obj[keysArr[i]];
                    i++;
                }
                if (!(obj && obj[keysArr[i]])) {
                    throw 'field path ' + path + ' is not defined in the policy object';
                }
                obj[keysArr[i]] = val;
            }
            return {
                Type: entryTypes.note,
                Contents: policy,
                ContentsFormat: formats.json,
                EntryContext : {'CarbonBlackThreatHunter.SetPolicy.Policy': policy }
            };
        };
        function executeCommand(cmd) {
            var query = generateQuery(cmd);
            var uniquePath = pathify(cmd);
            var url = client.url + uniquePath + query.str;
            var headers = {};
            var body;
            if (cmd.content) {
                body = buildBody(cmd);
            }
            headers = {
                'Content-Type': ['application/json'],
                'Accept': ['application/json']
            };
            if (cmd.siemKey) {
                client.addSiemKeyToHeaders(headers);
            } else {
                client.addClientAuthToHeaders(headers);
            }
            var res = sendRequest(url, cmd.method, headers, body);
            return res;
        }
        var executeAndShowResult = function (cmdName) {
            var cmd = commands[cmdName];
            var res = executeCommand(cmd);
            var body = parseBody(res);
            if (!cmd.extended) {
                return {
                    Type: entryTypes.note,
                    ContentsFormat: formats.text,
                    Contents: 'Request Success'
                };
            }
            var entries = [];
            for (var i = 0; i < cmd.translator.length; i++) {
                entries.push(createEntry(body, cmd.translator[i]));
            }
            return entries;
        };
        function parseBody(httpResponse) {
            var body = JSON.parse(httpResponse.Body);
            if (httpResponse.StatusCode !== 200) {
                throw 'Request failed: ' + httpResponse.Status + ".\n" + body.message
            }
            return body;
        }
        var runTest = function() {
            args = { rows: '0' };
            var res = executeCommand(commands['cbth-get-devices-status']);
            if (res.StatusCode === 200) {
                return 'ok';
            }
            if (res.StatusCode === 401) {
                throw 'Test failed. Make sure that the Connector ID and API key are valid.';
            }
            throw 'Test failed for unknown reason';
        };
        function createIncidentsFromNotification(notification) {
            return {
                'name': 'event ' + notification.eventId + ', ' + notification.eventDescription,
                'rawJson': JSON.stringify(notification)
            };
        }
        var getNotifications = function() {
            if (!params.siemKey) {
                throw 'SIEM key is missing from parameters.';
            }
            if (!params.siemConnector) {
                throw 'SIEM connector is missing from parameters.';
            }
            var res = executeCommand(commands['cbth-get-notifications']);
            if (res.StatusCode !== 200 ) {
                throw 'Request failed with status code: ' + res.StatusCode;
            }
            var body = JSON.parse(res.Body);

            if (!body.notifications) {
                return;
            }
            var notifications = body.notifications;
            var incidents = [];
            for (var i = 0; i < notifications.length; i++) {
                var incident = createIncidentsFromNotification(notifications[i]);
                incidents.push(incident);
            }
            return JSON.stringify(incidents);
        };
        return {
            execute: executeAndShowResult,
            runTest: runTest,
            getNotifications: getNotifications,
            setPolicy: setPolicy
        };
    };
    var cbth = CBThreatHunter();
    switch (command) {
        case 'test-module':
            return cbth.runTest();
        case 'fetch-incidents':
            return cbth.getNotifications();
        default:
            if (args.policy && typeof args.policy === 'string') {
                try {
                    var p = JSON.parse(args.policy);
                    args.policy = p;
                } catch (err) {
                    return "Failed to parse policy into a JSON object.\n" + err;
                }
            }
            return cbth.execute(command);
    }
  type: javascript
  commands:
  - name: cbth-get-devices-status
    arguments:
    - name: hostName
      description: Query parameter. Filter on hostnames based on a case insensitive
        token search.
    - name: hostNameExact
      description: Query parameter. Filter on the exact hostname
    - name: ownerName
      description: Query parameter. Filter on owner name case insensitively.
    - name: ownerNameExact
      description: Query parameter. Same as ownerName but with case sensitivity
    - name: ipAddress
      description: Query parameter. Filter on devices with a given external or internal
        IP address
    - name: start
      description: Wanted first row number from the result (starting from 1).
    - name: rows
      description: Wanted maximum number of rows from the result. This parameter can
        be limited on the Cb Defense server side.
    outputs:
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.ActivationCodeExpiryTime
      description: Activation Code Expiry Time
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.LastExternalIpAddress
      description: Last External IpAddress
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.LastLocation
      description: Last Location
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.LastReportedTime
      description: Last Reported Time
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.LastShutdownTime
      description: Last Shutdown Time
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.OsVersion
      description: Os Version
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.PolicyId
      description: Policy Id
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.RegisteredTime
      description: Registered Time
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.Status
      description: Status
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.DeviceId
      description: Device Id
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.DeviceOwnerId
      description: Device Owner Id
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.DeviceType
      description: Device Type
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.OrganizationId
      description: Organization Id
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.SensorVersion
      description: Sensor Version
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.TargetPriorityType
      description: Target Priority Type
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.Email
      description: Email
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.LastContact
      description: Last Contact
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.OrganizationName
      description: Organization Name
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.SensorStates
      description: SensorStates
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.AvStatus
      description: AvStatus
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.LastInternalIpAddress
      description: Last Internal IpAddress
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.Name
      description: Name
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.PolicyName
      description: Policy Name
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.SensorOutOfDate
      description: Sensor Out OfDate
    - contextPath: CarbonBlackThreatHunter.GetDevicesStatus.Results.TestId
      description: Test Id
    description: 'Get a status of all devices. Optionally you can include a query
      parameter to filter the results. Combining these query parameters is an implicit
      “AND”. '
  - name: cbth-get-device-status
    arguments:
    - name: deviceId
      required: true
      description: Individual device id.
    outputs:
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.TargetPriorityType
      description: Target Priority Type
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.OrganizationId
      description: Organization Id
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.CreateTime
      description: Create Time
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.DeviceId
      description: Device Id
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.Email
      description: Email
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.LastInternalIpAddress
      description: Last Internal IpAddress
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.LastLocation
      description: Last Location
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.OsVersion
      description: Os Version
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.AvStatus
      description: AvStatus
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.LastExternalIpAddress
      description: Last External IpAddress
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.RegisteredTime
      description: Registered Time
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.LastContact
      description: Last Contact
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.Status
      description: Status
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.TestId
      description: Test Id
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.PolicyId
      description: Policy Id
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.UpdateVersion
      description: Update Version
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.OrganizationName
      description: Organization Name
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.RootedByAnalytics
      description: Rooted ByAnalytics
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.SensorVersion
      description: Sensor Version
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.DeviceType
      description: Device Type
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.PolicyName
      description: Policy Name
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.RootedByAnalyticsTime
      description: Rooted ByAnalytics Time
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.SensorOutOfDate
      description: Sensor Out OfDate
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.SensorStates
      description: SensorStates
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.Name
      description: Name
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.Id
      description: Id
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.LastReportedTime
      description: Last Reported Time
    - contextPath: CarbonBlackThreatHunter.GetDeviceStatus.DeviceInfo.DeviceOwnerId
      description: Device Owner Id
    description: Retrieve details for an individual device given the device ID.
  - name: cbth-get-alert-details
    arguments:
    - name: alertId
      required: true
      description: The alert id
    outputs:
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.DeviceInfo.DeviceType
      description: Device Type
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.DeviceInfo.Group
      description: Group
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.DeviceInfo.GroupId
      description: Group Id
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.DeviceInfo.RegisteredTime
      description: Registered Time
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.DeviceInfo.DeviceId
      description: Device Id
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.DeviceInfo.DeviceName
      description: Device Name
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.DeviceInfo.Status
      description: Status
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.DeviceInfo.OsVersion
      description: Os Version
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.DeviceInfo.SensorVersion
      description: Sensor Version
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.DeviceInfo.UserName
      description: User Name
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.DeviceInfo.Importance
      description: Importance
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.DeviceInfo.Message
      description: Message
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.DeviceInfo.Success
      description: Success
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.Events.ParentHash
      description: Parent Hash
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.Events.PolicyState
      description: Policy State
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.Events.LongDescription
      description: Long Description
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.Events.CommandLine
      description: Command Line
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.Events.ParentPid
      description: Parent Pid
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.Events.ProcessId
      description: Process Id
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.Events.ThreatIndicators
      description: Threat Indicators
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.Events.ApplicationPath
      description: Application Path
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.Events.ProcessHash
      description: Process Hash
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.Events.ProcessMd5Hash
      description: Process Md5Hash
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.Events.EventId
      description: Event Id
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.Events.EventTime
      description: Event Time
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.Events.EventType
      description: Event Type
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.Events.KillChainStatus
      description: Kill Chain Status
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.Events.ParentName
      description: Parent Name
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.Events.ParentPPid
      description: ParentP Pid
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.Events.ProcessPPid
      description: ProcessP Pid
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.DeviceInfo.ThreatInfo.IncidentId
      description: Incident Id
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.DeviceInfo.ThreatInfo.Indicators.ApplicationName
      description: Application Name
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.DeviceInfo.ThreatInfo.Indicators.IndicatorName
      description: Indicator Name
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.DeviceInfo.ThreatInfo.Indicators.Sha256Hash
      description: Sha256Hash
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.DeviceInfo.ThreatInfo.Summary
      description: Summary
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.DeviceInfo.ThreatInfo.ThreatId
      description: Threat Id
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.DeviceInfo.ThreatInfo.ThreatScore
      description: Threat Score
    - contextPath: CarbonBlackThreatHunter.GetAlertDetails.DeviceInfo.ThreatInfo.Time
      description: Time
    description: Get details on the events that led to an alert. This includes retrieving
      metadata around the alert as well as a list of all the events associated with
      the alert. Only API keys of type “API” can call the alerts API.
  isfetch: true
  runonce: false
