commonfields:
  id: VxStream
  version: -1
name: VxStream
display: CrowdStrike Falcon Sandbox
category: Forensics & Malware Analysis
image: data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAATCAYAAABbV8lLAAAS6UlEQVRoge1aaZRV1bH+au8z3oGeRxq6mWlGAQEREdDHICJGRQgYnEXRaDRxiMpgNDggILqMSpTII3FARRREEWRQkZZuRmXSAM3U8zzce+49w97vx+kGOppk5b0fWXnLWuuete49e1ft2lW79ldVl+wvNg9UR4zeDQCyqRGytgostwtkzIIsK4GoqoSMx0CBIGSkGdKOgzQDIEDGYiAzABYOg0IhUGY2oOmAlAAAEAMpCs4QESAERPEReMVHQaGwP5YASkqGV1YK3m8AyAyApAQUBfL0CXj7dkO5YAQoq33LeIK0bYjiv0KUnAaZAUDXASHAUtNA7TsCkIAQgOf5sjkHqRqkbQOMgTTN5yUlZMw6w/cMCQFn2xawhCSwtDRQTi7IMP13jgPvyGGI0hKACCw1HZSQAJbdAeLEMcC2AQJaHmfWQlk5QFMDZKTZl6Wo8CrKQYoC3uc8kGFA2nGgvg6ythqU2wUQHsTpEyAQKBgEMrJAZgCishwoLwVltQelZUCeOAbZ3AQw1kYu83YXjo29sOApKTxIz4NsakxrsQZ+ov98YvqUGSviq1fcFVvwxGOkqrBeXLjC+fSjyQB+svH/A1JkIFCqXzXjeetPz8yTzQ1J2qQpSyNzZr1t3vd7ro69bCVqav7da/yJ/g+kwHEgm5tNZcCoAnvjqpneiaP9tPFTl1svzPuj+82uEdrlV8+lQLAWnP+71/oT/S+IsdQ06NNueFWUnurIew3e7pWd6uJs/egapfeQQverjT+PPjprj73ug4dlfX0WBQIgXW+5yH+i/wRSICVYp67fBR595vbIAzeuZDldvyc1w3H3F15ICamNsJo7xle9/KSzcdUDvNf5Hyn9Br7HuuZvZ0mJ1SACuPLPpfwtEQGqBgoEfPQqvDMIlnTDR9GtY80ApKq1Rbjn8CFd9/noOmQ83lYG5yDd8FEykT/eMNqOIfIzBCvqI+tWfaQA6Qagqj8uW1F99M4IZJotY8hH2ooKkERbFO1nBaRqQCDQgqI1f24bnRigaT5ibomaZBgg1qJL6z4ZBhAInjlspBlAQACMzsqVAmeso158ybrgkjdGRef/9jVRcqwPy8ytlI11efBssMQsyGhDkrNj/QyncOMMFk6uYzlddvKe/dYog4auQ3L3YtL0f2zUVmIMUBSIQ9+Oc04UXwQhOM/rvFe5ZOxqCM9xvtgEgDKosXEihBcQddUSkUixHDzsYwLkGUfw0xzV3fn1laLk9CAEApbS97wN/MKRX4MIiFuQ1VXZ7u6iS/nwUSthGDY8D+6O7WMpIbGW9+67E54H2diU4G7feqUyYPAHbsmpRllRNgHxeEe4ruoW/zWmdO/1DRs2fAdU9awOqgpRcqqns37tZBmPJvAefb/Rxox/T7q2Y3+y5ibZUB8GZ/IcAxNsG+r4SZ+KspKD3sFvbwMQBGMkohFL6Z6/U+k3qAiuC9nUCG/fruFuUcEQfdqNawB51Nn0aVg2Nt7C2ncoUf5r/LtkmHAKtl3uff1lb33y9DWUknbY+XLztd7xYzlQFd9zpQSZxh6SQvje5LoQDXWQFaWa/dEHd9ofv/uQjDVnUkKqv1lOHIhHfQMJD9JzfC83Eyzec+Bnxs9velq5dNx2X59z82Due1Rr/trUmNB854x3RfHBgSyv59dgzBOnjg2mhOQa497Z49zPN5Y6X3wyWtZXbqb03B0ASUTqu/K+Q3cEF7x0NWm6DVWFOHGse9Ndv3gf0eZ2rEOXXTJuhcSJ74aow8a+H1zw4m3Sslzv+4Odmmddeyz49LKhvP/AQunYWvP0caW8U8/dgWdfGQvPg7tp/WTr5aeWh19bnRFd+FjEKdq0l5nt0pCUcRxSmGioyWM5Xb4NLXl9OmVmlQCAW7h9ZPOvrlsrm8rC4CZkrB76xNvfCsx7+qbGScNrROX3QXADYNw/kUJAxhsQeuz1We6hb1+Nf7CsERABSAFID1BMBB967m5t2g0viuPHYL36wqLYu8//OmHphmulyt+LPHF/niw5VMzzL9oZevHPg2FFejRcc+EBlphZF353c2+WmFTZNGPSTmfP+kHE9Zb99kAJ7Ze3ja/xOKCotj79piXquInLnHUfzopvXXeHbKjoxNJzq6XwkuDaHIyDWAvocuKmu2vTFZGDReNCyStH8N79CqVtA1KCOIc0Ay3GBogxRGfft0Ja0czgS2/3lo1NFXBtkBlo5x3cP0UbcUmTV/gVJFcYZXU5FZiz4AJx+gSUrj0zmu/+xTHnw/fGKROuXEu6EWq6a8YGpUf/bcaNM28TtTUWOAdpevfInHu2WIueXGQ+NO9XrGPnYta+ywFv/96RyuALCsXhA71FXVkKgEGyriaRUtPrnd07JijnDdsITYvImAVmhIkyO85XR459iXfuDpaWmW29vOiN5gduXx169Z1hsqrCs15e9KC06sPmrPlTKZyw1zty+FZl2MW7KRiOB+YsHi4dW5MnT/SyXnl8OWV1ed+8+Z6nKRQG79Sl2N6+JUSK6rDc3ofMu357g3f8SGp8+fNvWK8umsP79HudEhIjpOkxUlWAcwd+aBbQQpLMQAMlJiH65COLZayOBx5bOYMlp1RKxwYUNcYTOtiBeS+Mk8TqITwiohoGKfyKDxEoNQ28czdA0zMQiSbpN85cEF68rJt+2XUL1AHDN+oTpr0q440/CLlkhCBjTVp89dtDnfVr4H79JdDUCOk4kGWnIUtPQVaUwynY1scp2jIhOO/ZaSyvawVcBzIaAQyjUZs87TXvyHdNzu7tIE0HGJeyuRmi+CgoKbkCqhaDFCYxgrN65VSyLTPwu2dvpqQUS8bjQDwO3qf/94FHnrne/uiNW71D+7OgaVDOG/qps2v75eAc7p6isbxjr0NQtbh3+MAQSAn3wO7R6rBRa0VdLWQsCnBFykiT5hR8DlleBp7bqTT4xHNTRfGhPs5n6y4iVQMZgbh0Lcjmpq68R365cce9D2rjr3jbxzOd9yk9exVRbt4eMAWI1Jc5O74sYh1yi9yigmrvdLECpnIKhhtkPFrE8zp/gsS0amk1thNlpbr0vB+58wkgJiClYq/88y3xTW9OMK686y/qiFHrpW233AKSwLhkWe1P8KysYzynw/c8v89JRTpuGz4gBjTUJUUXzn1fGTR8BUtJbaaE5GqenfONMn7iWmdf0YXi6J5+UM8BK5AAV6H07FvOe/YGBUNAUjJYuB28ijJIKwIyTHj7dg4gI1zqnTp+AKeO+yW9FhAjY3HYa96FjMcARfVQV5toPff4fHBuu3uLhlByerk6afKn7u5CxD9eNZTS2hc427fa0rFBQoLSM+AdPgBwXgSmxp2tG7qpYyeWKUOGr3e/+OQGWV1l2tu3XKlPmLzU/f7gEG/XjnG8Q94hNDcm80FDPvOOfAfpOC1OywHXgbN/N1i3ngBQiYTU487nm/qw3M6fm/c+PNc7daS7tfyJ+fE1f35QG3ftc8Y9Dy1giUkWKSqkFQE8VwcAqWiKd/x7RJ/7PWQsAlI1KRUtJo4fzrcWzVtDianJ4vR33fTx172hjB5TJ8vL/APXhiSgGlHv4I6R0b2bR7JwVsy469ezAfgAlXOQorgiUqs33XrFMQgXSMoqNqbP7K2Qrv+AF+vW83Bw7rOTogvmvRo/uH2UjDeBZ/SsUfZ8PYklJlbLcEpEWk1BUGu6RCCuIrb0qdfYJ91vUUdd9q728+v/G4DL2neAd/gApOuCNKMJ0guw9Ewdmh6XtTW+c2oGSNPAe/UDCjYDEgKerbKk1O7SiqZ5hwpHht/a2hO60UBmACw9u0lUlHZTeuRDRi2IilJASFA4DNi2AeEqLKdjlHQdSn6fAqlocefzz6bLmopcPviCtRQK1cTXvHMvpWWUUmrmCZaeedIt+OJv9kGChRLAUlJ9g0upUVKKjVgMPL/v/vALK/rba9+fZa956zextxc+hmikm/nYszMQCknEomfPjASgqJANNT4q9pG7J+1oEmLNo0VVcYi173XSfHT+LHiehB3/cdQuPJ1SOxzi6dmH3b2brnI2fDxFv+n2Z1uBnBSCkaJ72tgpb5CuxxAMVfMe+R5rLbif+cAHSJSRdSTw+OLRgfsXjtUuvW4ZqWqD/dnKKc6O9ZfISP05xm3VhCDjVjv3cOG46AsPvOZ8+N6dkBIwTPD+A8F79oZ2+VVfwXMCoqxkCu/cFVC4H+J1HdJ1oY65HDy3KxCLqkhMrzLvfuja8POvj2J5ff7qfLpuOmkalIFDoE+9frU4fvAieF43Sk0DXA8i0gTWIQ/e/m9uQjipThk28gDMIBAMNvO87rtjy198jEKJVSwn9xjvP3CraKjNjH/w5i+V/oM3SiEgKsrP6uJ5HktOg9JvICgjG9KKDpF1FXnauCu2834DIepqM7ySU7nazya/GFyyvLOS06/U3rrmSvudFUFn25YfN1CrcQHAtU2W031fYN6L2eqIq9eIkoM57p6ii/2r6e/UGNy4xtvnHQ8uXDqdZfcqsZY+NVeePplLmtbqAIzMsBOY+9QN5tynbzd//cijSr9B9t9PYh0HsONQBgzayHv12Sjr6hRZWd7f2V04VVZXnO9+WzC6zWKkhPRsQALEdcReeepp9YLhG6hTl8Nw4XeVsrKrzJkPPRJ94t5lRsn9Nu/WYz0UxXW/3TsotvwPi4LzFj2sTbjmM2tfIQGkkG4EKD0jat7xwAOROXes0q64ajnr2KlYGTp8m3rxxHeaZ07ZZN750AyEE4rgxM3YHxZOi6/84/zg/KVTWWqaJWqqAdeF0v/8jfEtb000h96zDqoC6pB7mqVknHT2rB8WGPa7tZACoqrCV8NziIXaJSt9B2TJaNRw1r4/NLZ8yR/0CdOWKQMGHYAQSmTOfW+6O7cM08ZOWQJNE6L6dCbr3H+/OmpMDJ7nh3opCNIDpGiDc/wOl6OAK1AuHNnEu/Z4xCn4+HJr8eMLlUFDN0szYMHzCMKDlJL8OoEApICMWSEEQzHz7ocfbv7NNSuii37/fHDx0p8R+R0kaTUZ0fmzlxBXohAeEAgd+6dVChmPQ0ajAJFLHXJ3GQPO3wXX69906xVFsGMqlJa2G1ctdcDFnyr5fd6EGYw427c+7Hy+aZQabncY8RiQlgFSQtB+cfPzsB3HWv7c81A0EDEh4xFdGTlxOWW1LxQFXwCBkEeKFpUARFUl1EvGfKi8ef5XsWUvzQnMe+ZmADBnPznDembes9HFc98jPehIz+HgSiQwZ8kUdcyE9yEl4LkA4+ADhmzmybkR5aLRH4FxQHhQB16wQZSf7Ma79diNaBTStsACQchAQpWsKrsvvvrNX8K1CVyJauOvXWzeP/tJEIe0Y0IdctFyceRA1/hHf3oYkOCZ3Y8GZj81k3Xs5IrqKqC2GuCqR3rQghGIk26eNbDnSTJCEdJNS9ZWg3fPP2Bcfduy2Dsv3OysWXWTevXUl6BqNuntLOLclZyDDFNCD0VhBmKoroJ22aS/aOuuu97eumqCvm36WGXEqA3MDEY8UMz++I1f+emXBIXTtvl58N8SEcTJ45DNjX5fOBr1UygiUHIKlP4DYW/85LLo7JkfylijSqoJMtpFWF6Pr4wb7nyQ9z1vH4XCISkEo3C4sTUvppYqkayvg3dof1DU1XSXdbWc0jKOK/l9qqHpvlFc1wBRCqVmlIIxSboG2dgQktWVKZSRdQKc+xEm0gxnT1EyIpHOpPA4MrMPKfl9XEpIwhnP908NibKS9pSeUUZc8SAlpBU1ZVNjAsvIKocQENWV/njhpcMTAQiX3MICh3I6lvOsbJeyO4AM0+/lNtTDqywLiKNHO8NziPfud4T16mcR54BtQ0oJOI4mqysywVgzGK89Z3cZXCcbmu5Scmo56RpkLK7JkpOZMEyHMrLKZH19AhrrEigrpwqQlqyp4vC89tCMGEtOqYRhQDY3B2TZ6TQEwxbLyKyUVRXp0ooaba4HxmP/ooEBltMRlJYBaBrcjz+8win4coxbtOUWnj9oC0tJO8JyuxzWJlz5CqWl+wi5lT9jIEX1Q3l5Gbyy06BQCKK2xm/Up2WA2iWCUlIAzy+5EVN8AzE/tEnH9hv4nAOxGGRdDbzjx0BJyfBDow2e1wUsI+tssaU1ErnO2dxd+g8phf8bEaTrnKM/A6QHZ9MGULt2YO0SwDp3A5kB/08PleUQ0QikZQGeC5aUDJbb2S9dnsEygPTclu9o23ptLZG2yIaUZ+UTa3FK7+x+ee7ZUijjZ/ejhT8pqu9UUrRCKF+eBP71QrKi+IZzHCjnD1vLR1y6Vuy/alX0ud9dpo0c85Zy1dR91KrYjzlPKwnhn0LHaQtKPA9wPV8JtbWDRS2/uz8EMK18hPcDo54hKf25Kjs7Xwg/Wmjcf++dO9+vBP1Dnq1yPbetnucCVsf58bmAD6Za19PKizFAYS26On5dvHXtrXNa7ts2cwB/Ha3/XjlDhP8B+dAx6g3B3sYAAAAASUVORK5CYII=
description: Fully automated malware analysis with unique Hybrid Analysis. (formerly
  Payload Security VxStream)
configuration:
- display: Server URL (e.g. https://216.3.128.82)
  name: serverUrl
  defaultvalue: https://www.hybrid-analysis.com
  type: 0
  required: true
- display: API Key
  name: apiKey
  defaultvalue: ""
  type: 4
  required: true
- display: Secret Key
  name: secretKey
  defaultvalue: ""
  type: 4
  required: true
- display: Do not validate server certificate (insecure)
  name: insecure
  defaultvalue: ""
  type: 8
  required: false
- display: Use system proxy settings
  name: proxy
  defaultvalue: ""
  type: 8
  required: false
script:
  script: |+
    var apiKey = params.apiKey;
    var secretKey = params.secretKey;
    var serverUrl = params.serverUrl;
    var insecure = params.insecure;
    var proxy = params.proxy;
    var auth = 'Basic ' + Base64.encode(apiKey + ':' + secretKey);

    // handle '/' at the end of serverUrl
    if (serverUrl[serverUrl.length - 1] === '/') {
        serverUrl = serverUrl.substring(0, serverUrl.length - 1);
    }

    function entryError(errorCode, text) {
        var error = 'Falcon Sandbox returned an error (' + errorCode + ') - ' + text;
        return {Type: entryTypes.error, ContentsFormat: formats.text, Contents: error};
    }

    // return a function that maps object keys by mapper (or capitlize keys if key is not exists in mapper)
    function mapObject(mapper) {
        return function(obj) {
            var res = {};
            Object.keys(obj).forEach(function(key) {
                // map key or capitalize if not exists
                var newKey = mapper[key] || key;
                res[newKey] = obj[key];
            });
            return res;
        }
    }

    function createTableEntry(name, rawResponse, table, context, headers) {
        return {
            Type: entryTypes.note,
            ContentsFormat: formats.json,
            Contents: rawResponse,
            ReadableContentsFormat: formats.markdown,
            HumanReadable: tableToMarkdown(name, table, headers),
            EntryContext: context
        };
    }

    var sendRequest = function(endpoint) {
        var requestUrl = serverUrl + endpoint;
        var res = http(
            requestUrl,
            {
                Method: 'GET',
                Headers: {
                    'Authorization': [auth],
                    'User-Agent': ['VxStream']
                }
            },
            insecure,
            proxy
        );

        if (res.StatusCode < 200 || res.StatusCode >= 300) {
            throw 'Request Failed.\nStatus code: ' + res.StatusCode + '.\nBody: ' + JSON.stringify(res) + '.';
        }

        var body;
        try {
            body = JSON.parse(res.Body);
        } catch (ex) {
            throw 'Error parsing response - ' + res.Body + ' - ' + ex;
        }

        return body;
    };

    function scan(hash) {
        return sendRequest('/api/scan/' + hash);
    }
    function scanToEntry(res) {
        if (res.response_code !== 0) {
            return entryError(res.response_code, res.response.error);
        }

        var response = res.response;

        // create table from response
        var tableMapper = {
           threatlevel: 'threat level',
           total_network_connections: 'total network connections',
           targeturl: 'target url',
           classification_tags: 'classification tags',
           threatscore: 'threat score',
           total_processes: 'total processes',
           submitname: 'submit name',
           environmentDescription: 'environment description',
           isinteresting: 'interesting',
           environmentId: 'environment id',
           isurlanalysis: 'url analysis',
           analysis_start_time: 'analysis start time',
           total_signatures: 'total signatures'
        };

        var table = response.map(mapObject(tableMapper));

        // create context from response
        var context = {};

        var contextMapper = {
            sha1: 'SHA1',
            sha256: 'SHA256',
            md5: 'MD5',
        };
        context[outputPaths.file] = response.map(mapObject(contextMapper));
        response.forEach(function(res) {
           if(res.threatlevel && res.threatlevel > 1) {
               addMalicious(context, outputPaths.file, {
                    MD5: res.md5,
                    SHA1: res.sha1,
                    SHA256: res.sha256,
                    Malicious: { Vendor: 'Falcon Sandbox', Description: 'Score above ' + res.threatscore }
                });
           }
        });
        return createTableEntry('Scan Results:', response, table, context);
    }

    function getEnvironments() {
        var res = sendRequest('/system/state');
        if (res.response_code !== 0) {
            return entryError(res.response_code, res.response.error);
        }

        var response = res.response;
        return response;

    }

    function tableFromEnvironments(response) {
        var environments = response.backend.global_environment;
        var environmentsKeys = Object.keys(environments);
        var table=[];
        var envContext = [];
        for (var i = 0; i < environmentsKeys.length; i++){
            var currentEnvironment = environments[environmentsKeys[i]];
            envContext[i] = environments[environmentsKeys[i]];
            table[i] = {
                ID: currentEnvironment.ID,
                description: currentEnvironment.description,
                architecture: currentEnvironment.architecture,
                'total VMS': currentEnvironment.VMs_busy,
                'busy VMS': currentEnvironment.VMs_total,
                'analysis mode': currentEnvironment.analysisMode,
                'group icon': currentEnvironment.groupicon ? currentEnvironment.groupicon : ''
            }
        }
        // create context from environments
        var context = {
            'VX.Environment(val.ID && val.ID == obj.ID)': envContext
        };


        return createTableEntry('All Environments:', response, table, context, ['ID', 'description', 'architecture', 'total VMS', 'busy VMS', 'analysis mode', 'group icon']);
    }

    function submitFile (entryId, environmentId) {
        var requestUrl = serverUrl + '/api/submit';
        // submit file
        var res = httpMultipart(
                    requestUrl, // URL
                    entryId, // Optional - FilePath / EntryID
                    {
                        Method: 'POST',
                        Headers: {
                            'Authorization': [auth],
                            'User-Agent': ['VxStream']
                        }
                    },
                    { // Multipart Contents
                        environmentId: environmentId
                    },
                    insecure,
                    proxy
                );

        if (res.StatusCode < 200 || res.StatusCode >= 300) {
            throw 'Multipart Request Failed.\nStatus code: ' + res.StatusCode + '.\nBody: ' + JSON.stringify(res) + '.';
        }
        var body;
        try {
            body = JSON.parse(res.Body);
        } catch (ex) {
            throw 'Error parsing response - ' + res.Body + ' - ' + ex;
        }
        if (body.response_code !== 0) {
            return entryError(res.response_code, res.response.error);

        }
        var response = body.response;
        var resMessage = '';
        if (response.sha256) {
            resMessage = resMessage + '\nsha256 - ' + response.sha256;
        }
        if (response.sha1) {
            resMessage = resMessage + '\nsha1 - ' + response.sha1;
        }
        if (response.md5) {
            resMessage = resMessage + '\nmd5 - ' + response.md5;
        }

        return resMessage;
    }

    function submitFileMsg(hash) {
        var resMessage = "File submitted successfully";
        resMessage += resMessage + hash;
        return resMessage;
    }

    function searchQuery(query) {
        var res = sendRequest('/api/search?query=' + args.query);
        if (res.response_code !== 0) {
            return entryError(res.response_code, res.response.error);
        }

        var result = res.response.result;

        // create table from search result
        var tableMapper = {
           environmentDescription: 'environment description',
           start_time: 'start time',
           submitname: 'submit name',
           threatscore: 'threat score',
           type_short: 'type short',
        };

        var table = result.map(mapObject(tableMapper));

        // create context from search result
        var contextMapper = {
            sha1: 'SHA1',
            sha256: 'SHA256',
            md5: 'MD5',
        };

        var context = {
            'VX.Search(val.MD5 && val.MD5 == obj.MD5 || val.SHA1 && val.SHA1 == obj.SHA1 || val.SHA256 && val.SHA256 == obj.SHA256)': result.map(mapObject(contextMapper))
        };

        result.forEach(function(res) {
           if(res.threatlevel && res.threatlevel > 1) {
               addMalicious(context, outputPaths.file, {
                    MD5: res.md5,
                    SHA1: res.sha1,
                    SHA256: res.sha256,
                    Malicious: { Vendor: 'Falcon Sandbox', Description: 'Score above ' + res.threatscore }
                });
           }
        });

        return createTableEntry('All Environments:', result, table, context);
    }

    function vxResult(hash, environmentId) {
        var res = sendRequest('/api/result/' + hash + '?type=json&environmentId=' + args.environmentId);
        if (res.response_code !== undefined && res.response_code !== 0) {
            return entryError(res.response_code, res.response.error);
        }
        return res;
    }

    function detonateFile(entryId, delay, timeout) {

        var environmentId;
        if (args.environmentID) {
            environmentId = args.environmentID;
        } else {
            var environments = getEnvironments().backend.global_environment;
            for (var i=0; i<environments.length; i++) {
                if (environments[i]['ID'] === 100) {
                    environmentId = 100;
                    break;
                 } else if (environments[i]['architecture'] === 'WINDOWS') {
                    environmentId = environments[i]['ID'];
                    break;
                    } else {
                        throw 'Please enter valid environment ID';
                }
            }
        }

        var hash = submitFile(entryId, environmentId).substring(10);

        delayTime = parseInt(delay);
        timeOut = parseInt(timeout);
        var waitTime = delayTime;

        wait(delayTime);

        while (waitTime<timeOut) {
            res = scan(hash);
            if (res.response.length > 0 && res.response[0]) {
                return scanToEntry(res);
            } else {
                waitTime = waitTime + delayTime;
                wait(delayTime);
            }
        }
        throw ('Timeout due to no answer after ' + timeOut + ' seconds.');

    }

    switch (command) {
        case 'test-module':
            var entry = searchQuery('url:google');
            if (entry && entry.Type === entryTypes.note) {
               return 'ok';
            }
            return entry && entry.Contents;
        case 'vx-scan':
        case 'crowdstrike-scan':
            var res = scan(args.file);
            return scanToEntry(res);
        case 'vx-get-environments':
        case 'crowdstrike-get-environments':
            var response = getEnvironments();
            return tableFromEnvironments(response);
        case 'vx-submit-sample':
        case 'crowdstrike-submit-sample':
            var hash = submitFile(args.entryId, args.environmentID);
            return submitFileMsg(hash);
        case 'vx-search':
        case 'crowdstrike-search':
            return searchQuery(args.query);
        case 'vx-result':
        case 'crowdstrike-result':
            return vxResult(args.file, args.environmentId);
        case 'vx-detonate-file':
        case 'crowdstrike-detonate-file':
            return detonateFile(args.entryId, args.delay, args.timeout);
    }

  type: javascript
  commands:
  - name: vx-scan
    arguments:
    - name: file
      required: true
      default: true
      description: File hash (MD5, SHA1 or SHA256)
    outputs:
    - contextPath: File.SHA256
      description: SHA256 of the file
    - contextPath: File.SHA1
      description: SHA1 of the file
    - contextPath: File.MD5
      description: MD5 of the file
    - contextPath: File.environmentId
      description: 'Environment id of the file '
    - contextPath: File.analysis_start_time
      description: Analysis start time of the file
    - contextPath: File.submitname
      description: Submission name of the file
    - contextPath: File.classification_tags
      description: List of classification tags of the file
    - contextPath: File.vxfamily
      description: Family classification of the file
    - contextPath: File.total_network_connections
      description: Total network connections of the file
    - contextPath: File.total_processes
      description: Total processes count of the file
    - contextPath: File.total_signatures
      description: Total signatures count if the file
    - contextPath: File.hosts
      description: List of file's hosts
    - contextPath: File.isinteresting
      description: If server found this file interesting
    - contextPath: File.domains
      description: List of file's related domains
    - contextPath: File.isurlanalysis
      description: If file analyzed by url
    - contextPath: File.Malicious.Vendor
      description: or malicious files, the vendor that made the decision
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason for the vendor to make the decision
    description: Get summary information for a given MD5, SHA1 or SHA256 and all the
      reports generated for any environment ID
  - name: crowdstrike-scan
    arguments:
    - name: file
      required: true
      default: true
      description: File hash (MD5, SHA1 or SHA256)
    outputs:
    - contextPath: File.SHA256
      description: SHA256 of the file
    - contextPath: File.SHA1
      description: SHA1 of the file
    - contextPath: File.MD5
      description: MD5 of the file
    - contextPath: File.environmentId
      description: 'Environment id of the file '
    - contextPath: File.analysis_start_time
      description: Analysis start time of the file
    - contextPath: File.submitname
      description: Submission name of the file
    - contextPath: File.classification_tags
      description: List of classification tags of the file
    - contextPath: File.vxfamily
      description: Family classification of the file
    - contextPath: File.total_network_connections
      description: Total network connections of the file
    - contextPath: File.total_processes
      description: Total processes count of the file
    - contextPath: File.total_signatures
      description: Total signatures count if the file
    - contextPath: File.hosts
      description: List of file's hosts
    - contextPath: File.isinteresting
      description: If server found this file interesting
    - contextPath: File.domains
      description: List of file's related domains
    - contextPath: File.isurlanalysis
      description: If file analyzed by url
    - contextPath: File.Malicious.Vendor
      description: or malicious files, the vendor that made the decision
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason for the vendor to make the decision
    description: Get summary information for a given MD5, SHA1 or SHA256 and all the
      reports generated for any environment ID
  - name: vx-get-environments
    arguments: []
    outputs:
    - contextPath: VX.Environment.ID
      description: Environment id
    - contextPath: VX.Environment.description
      description: Environment description
    - contextPath: VX.Environment.architecture
      description: Environment architecture
    - contextPath: VX.Environment.VMs_total
      description: Total virtual machines in environment
    - contextPath: VX.Environment.VMs_busy
      description: Busy virtual machines in environment
    - contextPath: VX.Environment.analysisMode
      description: 'Analysis mode of environment '
    - contextPath: VX.Environment.groupicon
      description: Icon of environment
    description: Get a list of all available environments  (NOTE - minimum required
      authorization is `default`)
  - name: crowdstrike-get-environments
    arguments: []
    outputs:
    - contextPath: VX.Environment.ID
      description: Environment id
    - contextPath: VX.Environment.description
      description: Environment description
    - contextPath: VX.Environment.architecture
      description: Environment architecture
    - contextPath: VX.Environment.VMs_total
      description: Total virtual machines in environment
    - contextPath: VX.Environment.VMs_busy
      description: Busy virtual machines in environment
    - contextPath: VX.Environment.analysisMode
      description: 'Analysis mode of environment '
    - contextPath: VX.Environment.groupicon
      description: Icon of environment
    description: Get a list of all available environments  (NOTE - minimum required
      authorization is `default`)
  - name: vx-submit-sample
    arguments:
    - name: entryId
      required: true
      default: true
      description: War-room entry ID of sample file
    - name: environmentID
      required: true
      description: Environment ID to submit file to (get all IDs via vx-get-environments)
    description: Submit a file from investigation to analysis server  (NOTE - minimum
      required authorization is `default`)
  - name: crowdstrike-submit-sample
    arguments:
    - name: entryId
      required: true
      default: true
      description: War-room entry ID of sample file
    - name: environmentID
      required: true
      description: Environment ID to submit file to (get all IDs via vx-get-environments)
    description: Submit a file from investigation to analysis server  (NOTE - minimum
      required authorization is `default`)
  - name: vx-search
    arguments:
    - name: query
      required: true
      default: true
      description: Falcon Sandbox query syntax (see `<server url>/faq#advanced-search-options`
        for more details). examples -  url:google, host:95.181.53.78
    outputs:
    - contextPath: VX.Search.SHA256
      description: SHA256 of search result
    - contextPath: VX.Search.SHA1
      description: SHA1of search result
    - contextPath: VX.Search.MD5
      description: MD5 of search result
    - contextPath: VX.Search.environmentId
      description: Environment Id of search result
    - contextPath: VX.Search.start_time
      description: Start time of search result
    - contextPath: VX.Search.threatscore
      description: Threat score of search result by server
    - contextPath: VX.Search.verdict
      description: Verdict of search result
    - contextPath: VX.Search.environmentDescription
      description: Environment description of search result
    - contextPath: VX.Search.submitname
      description: Submission name of search result
    - contextPath: VX.Search.vxfamily
      description: Family of search result
    - contextPath: VX.Search.threatscore
      description: Threat score of search result
    - contextPath: VX.Search.type_short
      description: type of search result (url, host, etc.)
    - contextPath: VX.Search.size
      description: Size of search result
    - contextPath: File.Malicious.Vendor
      description: or malicious files, the vendor that made the decision
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason for the vendor to make the decision
    description: Search the database using the Falcon Sandbox search syntax
  - name: crowdstrike-search
    arguments:
    - name: query
      required: true
      default: true
      description: Falcon Sandbox query syntax (see `<server url>/faq#advanced-search-options`
        for more details). examples -  url:google, host:95.181.53.78
    outputs:
    - contextPath: VX.Search.SHA256
      description: SHA256 of search result
    - contextPath: VX.Search.SHA1
      description: SHA1of search result
    - contextPath: VX.Search.MD5
      description: MD5 of search result
    - contextPath: VX.Search.environmentId
      description: Environment Id of search result
    - contextPath: VX.Search.start_time
      description: Start time of search result
    - contextPath: VX.Search.threatscore
      description: Threat score of search result by server
    - contextPath: VX.Search.verdict
      description: Verdict of search result
    - contextPath: VX.Search.environmentDescription
      description: Environment description of search result
    - contextPath: VX.Search.submitname
      description: Submission name of search result
    - contextPath: VX.Search.vxfamily
      description: Family of search result
    - contextPath: VX.Search.threatscore
      description: Threat score of search result
    - contextPath: VX.Search.type_short
      description: type of search result (url, host, etc.)
    - contextPath: VX.Search.size
      description: Size of search result
    - contextPath: File.Malicious.Vendor
      description: or malicious files, the vendor that made the decision
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason for the vendor to make the decision
    description: Search the database using the Falcon Sandbox search syntax
  - name: vx-result
    arguments:
    - name: file
      required: true
      default: true
      description: File hash (MD5, SHA1 or SHA256)
    - name: environmentId
      required: true
      description: 'environment ID to submit file to(get all via vx-get-environments) '
    description: Retrieve result data upon a file. NOTE - This command returns a file
      (also - minimum required authorization is `default`)
  - name: crowdstrike-result
    arguments:
    - name: file
      required: true
      default: true
      description: File hash (MD5, SHA1 or SHA256)
    - name: environmentId
      required: true
      description: 'environment ID to submit file to(get all via vx-get-environments) '
    description: Retrieve result data upon a file. NOTE - This command returns a file
      (also - minimum required authorization is `default`)
  - name: vx-detonate-file
    arguments:
    - name: entryId
      required: true
      description: War-room entry ID of sample file
    - name: environmentID
      description: environment ID to submit file to(get all via vx-get-environments).
        Default is 100, or other WINDOWS ID
    - name: delay
      description: Delay wait time between calls (in seconds)
      defaultValue: "3"
    - name: timeout
      description: Total wait time (in seconds)
      defaultValue: "60"
    description: Detonate file through Falcon Sandbox
  - name: crowdstrike-detonate-file
    arguments:
    - name: entryId
      required: true
      description: War-room entry ID of sample file
    - name: environmentID
      description: environment ID to submit file to(get all via vx-get-environments).
        Default is 100, or other WINDOWS ID
    - name: delay
      description: Delay wait time between calls (in seconds)
      defaultValue: "3"
    - name: timeout
      description: Total wait time (in seconds)
      defaultValue: "60"
    description: Detonate file through Falcon Sandbox
