commonfields:
  id: Lastline
  version: -1
name: Lastline
display: Lastline
category: Data Enrichment & Threat Intelligence
image: data:image/png;base64,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
description: Provides threat analysts and incident response teams with the advanced
  malware isolation and inspection environment, needed to safely execute advanced
  malware samples and understand their behavior.
configuration:
- display: Server URL (e.g. https://analysis.lastline.com)
  name: url
  defaultvalue: https://analysis.lastline.com
  type: 0
  required: true
- display: API Key for accessing Lastline APIs
  name: api_key
  defaultvalue: ""
  type: 0
  required: true
- display: API Token for accessing Lastline APIs
  name: api_token
  defaultvalue: ""
  type: 4
  required: true
- display: Use system proxy settings
  name: proxy
  defaultvalue: "true"
  type: 8
  required: false
- display: Trust any certificate (unsecure)
  name: insecure
  defaultvalue: "false"
  type: 8
  required: false
script:
  script: |+
    var lastlineDefaults = {interval:10, timeout:0, threshold:50, pushToPortal:true};

    var serverUrl = params.url;
    if (serverUrl[serverUrl.length - 1] !== '/') {
        serverUrl += '/';
    }

    // print data report as markdown
    var dataToMd = function(data,threshold) {
        var key;
        var name;
        if ('url' in data.analysis_subject) {
            key='URL';
            name = data.analysis_subject.url;
        } else {
            key='file';
            name = 'MD5:'+data.analysis_subject.md5;
        }
        var md = '';
        if (data.score>=threshold) {
            name = name+ ' :red_circle:';
        }
        md += '### Lastline analysis for ' + key + ': **' + name +'**\n';

        md += '#### Score: ' + data.score  + "\n";
        md += 'Task UUID: ' + data.task_uuid + "\n";
        md += 'Submission Time: ' + data.submission + "\n";
        if (Array.isArray(data.malicious_activity) && data.malicious_activity.length>0) {
            md += '### Suspicious Activity\n';
            md += objToMd(data.malicious_activity) + "\n";
        }
        if (key == 'file') {
            md += objToMd(data.analysis_subject);
        }
        md += "\n";
        return md;
    }

    // send http post request
    var doReq = function(method, path, parameters, body) {
        if (!parameters) {
            parameters = {};
        }
        parameters.key = params.api_key;
        parameters.api_token=params.api_token;

        var result = http(
            serverUrl + path + encodeToURLQuery(parameters),
            {
                Headers: {'Content-Type': ['application/json']},
                Method: method
            },
            params.insecure,
            params.proxy
        );
        if (result.StatusCode < 200 && result.StatusCode > 299) {
            throw 'Failed to perform request ' + path + ', request status code: ' + result.StatusCode;
        }

        var obj;
        try {
            obj = JSON.parse(result.Body);
        } catch (ex) {
            throw 'Error parsing reply - ' + result.Body + ' - ' + ex;
        }

        // analysis is not ready yet
        if (obj.error_code && obj.error_code == 106) {
            return {
                body: null,
                obj: {
                    data: null
                }
            };
        }
        if (obj.success==0) {
            throw 'Error from Lastline: ' + obj.error;
        }
        if (obj.error_code) {
            switch (obj.error_code) {
                case 101:
                    // file hash does not exist
                    break;
                case 106:
                    // analysis report not ready
                    break;
                default:
                    throw 'Error from Lastline. Error code: ' + obj.error_code + ". Error: " + obj.error;
            }
        }

        return {body: result.Body, obj: obj};
    }

    // send http multipart request (post file)
    var doFile = function (entry_id,parameters) {
        if (!parameters) {
            parameters = {};
        }
        parameters.key = params.api_key;
        parameters.api_token=params.api_token;
        var path = 'analysis/submit/file';

        var result = httpMultipart(
            serverUrl + path + encodeToURLQuery(parameters),
            entry_id,
            {
                Method: 'POST',
                Headers: {'Content-Type': ['application/json']}
            },
            {},
            params.insecure,
            params.proxy
        );
        if (result.StatusCode < 200 && result.StatusCode > 299) {
            throw 'Failed to perform request ' + path + ', request status code: ' + result.StatusCode;
        }
        var obj;
        try {
            obj = JSON.parse(result.Body);
        } catch (ex) {
            throw 'Error parsing reply - ' + result.Body + ' - ' + ex;
        }

        if (obj.error_code) {
            switch (obj.error_code) {
                case 101:
                    // file hash does not exist
                    break;
                case 106:
                    // analysis report not ready
                    break;
                default:
                    throw 'Error code: ' + obj.error_code + ". Error: " + obj.error;
            }
        }
        return {body: result.Body, obj: obj};

    }

    // poll for analysis report
    var analysisPoll = function(uuid, threshold, timeout, interval) {
        if (!timeout) {
            timeout = lastlineDefaults.timeout;
        }
        if (!interval) {
            interval = lastlineDefaults.interval;
        }
        if (!threshold) {
            threshold = lastlineDefaults.threshold;
        }
        var result = doReq('POST', '/analysis/get', {uuid: uuid, full_report_score:threshold});

        var waited=0;
        while (!analysisReady(result.obj.data) && parseInt(timeout)>waited) {
            wait(parseInt(interval));
            waited+=interval;
            result = doReq('POST', 'analysis/get', {uuid: uuid, full_report_score:threshold});
        }
        return result;
    }

    // check if report is ready based on data content (score field is set)
    var analysisReady = function (data) {
        return (data && 'score' in data);
    }

    // submit file for analysis
    // optional - wait for analysis to copmplete and print results
    // if not waiting - add uuid to context
    var fileSubmit = function (file_id,threshold,timeout,interval,pushToPortal) {
        if (!timeout) {
            timeout = lastlineDefaults.timeout;
        }
        if (!interval) {
            interval = lastlineDefaults.interval;
        }
        if (!threshold) {
            threshold = lastlineDefaults.threshold;
        }
        if (!pushToPortal) {
            pushToPortal = lastlineDefaults.pushToPortal;
        }
        result = doFile(file_id, {
            full_report_score: threshold,
            push_to_portal: pushToPortal
        });

        var uuid = result.obj.data.task_uuid;

        var ec = {};
        var md = '';

        if (!analysisReady(result.obj.data) && timeout > 0) {
            result = analysisPoll(uuid, timeout, interval);
        }

        if (analysisReady(result.obj.data)) {
            md = dataToMd(result.obj.data, threshold);
            if (result.obj.data.score > threshold) {
                var analysis = result.obj.data.analysis_subject;
                var DBotScore = {
                    Indicator: analysis.md5,
                    Type: 'hash',
                    Vendor: 'Lastline',
                    Score: 3
                };

                ec['DBotScore'] = DBotScore;
                addMalicious(ec, outputPaths.file, {
                    MD5: analysis.md5,
                    SHA1: analysis.sha1,
                    SHA256: analysis.sha256,
                    Malicious: {
                        Vendor: 'Lastline',
                        Description: 'Score above ' + threshold,
                        Score: result.obj.data.score
                    }
                });
            }
        } else {
            ec.lastlineTasks = [
                {
                    'file_id': file_id,
                    'uuid': uuid
                }
            ];

            md += '### Lastline analysis for file: **' + file_id +'**\n';
            md += 'File submitted for analysis.\n';
            md += 'Task UUID: ' + uuid + '\n';
        }

        return {
            Type: entryTypes.note,
            Contents: result.obj,
            ContentsFormat: formats.json,
            HumanReadable: md,
            EntryContext: ec
        };
    }

    // submit URL for analysis and get its report
    // if analysis exists - return it immediately.
    // if analysis does not exist - submit it and either wait or put task id into context
    var urlGetSubmit = function (url,threshold,timeout,interval, pushToPortal) {
        if (!timeout) {
            timeout = lastlineDefaults.timeout;
        }
        if (!interval) {
            interval = lastlineDefaults.interval;
        }
        if (!threshold) {
            threshold = lastlineDefaults.threshold;
        }
        if (!pushToPortal) {
            pushToPortal = lastlineDefaults.pushToPortal;
        }


        var result = doReq('POST', 'analysis/submit/url', {url: url, full_report_score:threshold, push_to_portal:pushToPortal});
        var uuid = result.obj.data.task_uuid;

        var ec = {};
        var md = '';

        if (!analysisReady(result.obj.data) && timeout > 0) {
            result = analysisPoll(uuid,threshold,timeout,interval);
        }

        var DBotScore = {Indicator: url, Type: 'url', Vendor: 'Lastline', Score:0};
        if (analysisReady(result.obj.data)) {
            md=dataToMd(result.obj.data,threshold);
            if (result.obj.data.score > threshold) {
                addMalicious(ec, outputPaths.url, {
                    Data: url,
                    Malicious: {Vendor: 'Lastline', Description: 'Score above ' + threshold, Score: result.obj.data.score}
                });
                DBotScore.Score=3;
            } else {
                DBotScore.Score=1;
            }
        } else {
            ec.lastlineTasks=[{'url':url,'uuid':uuid}];
            md += '### Lastline analysis for url: **' + url +'**\n';
            md += 'URL submitted for analysis.\n';
            md += 'Task UUID: ' + uuid + '\n';
        }
        ec['DBotScore']=DBotScore;
        return {Type: entryTypes.note, Contents: result.obj, ContentsFormat: formats.json, HumanReadable: md, EntryContext: ec};

    }

    // get file hash analysis.
    // If hash is not known - retuern error
    var hashGet = function(hash, threshold) {
        if (!threshold) {
            threshold = lastlineDefaults.threshold;
        }

        var fileParams={full_report_score:threshold};

        switch (hash.length) {
            case 32:
                fileParams.md5=hash;
                break;
            case 40:
                fileParams.sha1=hash;
                break;
            case 64:
                fileParams.sha256=hash;
                break
            default:
                throw 'Hash not recognized';
        }

        var md='';
        var ec={};

        // check if file hash exists
        var result = doReq('POST','analysis/submit/file', fileParams);

        if (result.obj.error_code == 101) {
            throw 'File hash not found in Lastline';
        }
        var data = result.obj.data;
        md += dataToMd(data,threshold);

        var DBotScore = {Indicator: hash, Type: 'hash', Vendor: 'Lastline', Score: 0};
        if (result.obj.data.score > threshold) {
            var analysis = result.obj.data.analysis_subject;
            addMalicious(ec, outputPaths.file, {
                MD5: analysis.md5,
                SHA1: analysis.sha1,
                SHA256: analysis.sha256,
                Malicious: {Vendor: 'Lastline', Description: 'Score above ' + threshold, Score: result.obj.data.score}
            });
            DBotScore.Score= 3;
        } else {
            DBotScore.Score= 1;
        }
        ec['DBotScore']=DBotScore;
        return {Type: entryTypes.note, Contents: result.obj, ContentsFormat: formats.json, HumanReadable: md, EntryContext: ec};

    }

    // get analysis report based on uuid
    // if report not ready - either wait or return waiting message
    var analysisGet = function(uuid,threshold,timeout,interval) {
        if (!timeout) {
            timeout = lastlineDefaults.timeout;
        }
        if (!interval) {
            interval = lastlineDefaults.interval;
        }
        if (!threshold) {
            threshold = lastlineDefaults.threshold;
        }
        if (!uuid || uuid == '') {
            throw 'No task UUID provided';
        }
        var ec = {};
        var md = '';

        result = analysisPoll(uuid,threshold,timeout,interval);

        var DBotScore = {Vendor: 'Lastline', Score: 0};
        if (analysisReady(result.obj.data)) {
            var analysis = result.obj.data.analysis_subject;
            if ('url' in analysis) {
                DBotScore.Type = 'url';
                DBotScore.Indicator = analysis.url;
                if (result.obj.data.score > threshold) {
                    addMalicious(ec, outputPaths.url, {
                        Data: url,
                        Malicious: {Vendor: 'Lastline', Description: 'Score above ' + threshold, Score: result.obj.data.score}
                    });
                    DBotScore.Score = 3;
                } else {
                    DBotScore.Score = 1;
                }
            } else {
                DBotScore.Type = 'hash';
                DBotScore.Indicator = analysis.md5;
                if (result.obj.data.score > threshold) {
                    addMalicious(ec, outputPaths.file, {
                        MD5: analysis.md5,
                        SHA1: analysis.sha1,
                        SHA256: analysis.sha256,
                        Malicious: {Vendor: 'Lastline', Description: 'Score above ' + threshold, Score: result.obj.data.score}
                    });
                    DBotScore.Score = 3;
                } else {
                    DBotScore.Score = 1;
                }
            }
            md+=dataToMd(result.obj.data,threshold);
        } else {
            md += '#### Report not ready.\n';
            md += 'Task UUID: ' + uuid + '\n';
        }
        ec['DBotScore']=DBotScore;
        return {Type: entryTypes.note, Contents: result.obj, ContentsFormat: formats.json, HumanReadable: md, EntryContext: ec};
    };

    // The command input arg holds the command sent from the user.
    switch (command) {
        // This is the call made when pressing the integration test button.
        case 'test-module':
            urlGetSubmit('https://google.com');
            return 'ok';
        case 'url':
            return urlGetSubmit(args.url, args.threshold, args.timeout, args.interval, args.pushToPortal);
        case 'file':
            return hashGet(args.file, args.threshold,args.threshold);
        case 'lastline-upload':
            return fileSubmit(args.file_id, args.threshold, args.timeout, args.interval, args.pushToPortal);
        case 'lastline-get':
            if (!args.threshold) {
                args.threshold = lastlineDefaults.threshold;
            }
            return analysisGet(args.uuid, args.threshold, args.timeout, args.interval);
        default:
            throw 'Unknown command - ' + command;
    }

  type: javascript
  commands:
  - name: lastline-get
    arguments:
    - name: uuid
      required: true
      default: true
      description: Analysis report ID
    - name: timeout
      description: Timeout (in seconds) to wait for analysis to complete
      defaultValue: "0"
    - name: interval
      description: Interval (in seconds) to poll for the analysis status
      defaultValue: "10"
    - name: threshold
      description: Score threshold to identify file as malicious
      defaultValue: "50"
    outputs:
    - contextPath: URL.Data
      description: List of malicious URLs identified by Lastline analysis
    - contextPath: URL.Malicious.Vendor
      description: For malicious URLs, the vendor that made the decision
    - contextPath: URL.Malicious.Description
      description: For malicious URLs, the reason for the vendor to make the decision
    - contextPath: URL.Malicious.Score
      description: For malicious URLs, the score from the vendor
    - contextPath: File.MD5
      description: Bad hash MD5
    - contextPath: File.SHA1
      description: Bad hash SHA1
    - contextPath: File.SHA256
      description: Bad hash SHA256
    - contextPath: File.Malicious.Vendor
      description: For malicious files, the vendor that made the decision
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason for the vendor to make the decision
    - contextPath: File.Malicious.Score
      description: For malicious files, the score from the vendor
    - contextPath: DBotScore.Indicator
      description: The indicator we tested
    - contextPath: DBotScore.Type
      description: The type of the indicator
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score
    - contextPath: DBotScore.Score
      description: The actual score
    description: Get analysis report
  - name: url
    arguments:
    - name: url
      required: true
      default: true
      description: 'URL to be analyzed '
    - name: timeout
      description: Timeout (in seconds) to wait for analysis to complete
      defaultValue: "0"
    - name: interval
      description: Interval (in seconds) to poll for the analysis status
      defaultValue: "10"
    - name: threshold
      description: Score threshold to identify file as malicious
      defaultValue: "50"
    - name: pushToPortal
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Add the request to the Lastline portal
    outputs:
    - contextPath: lastlineTasks
      description: List of the submitted Lastline analysis tasks
    - contextPath: URL.Data
      description: List of malicious URLs identified by Lastline analysis
    - contextPath: URL.Malicious.Vendor
      description: For malicious URLs, the vendor that made the decision
    - contextPath: URL.Malicious.Description
      description: For malicious URLs, the reason for the vendor to make the decision
    - contextPath: URL.Malicious.Score
      description: For malicious URLs, the score from the vendor
    - contextPath: DBotScore.Indicator
      description: The indicator we tested
    - contextPath: DBotScore.Type
      description: The type of the indicator
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score
    - contextPath: DBotScore.Score
      description: The actual score
    description: Submit URL for analysis
  - name: file
    arguments:
    - name: file
      required: true
      default: true
      description: File hash to be checked (supporting MD5, SHA1, SHA256)
    - name: threshold
      description: Score threshold to identify file as malicious
      defaultValue: "50"
    outputs:
    - contextPath: File.MD5
      description: Bad hash MD5
    - contextPath: File.SHA1
      description: Bad hash SHA1
    - contextPath: File.SHA256
      description: Bad hash SHA256
    - contextPath: File.Malicious.Vendor
      description: For malicious files, the vendor that made the decision
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason for the vendor to make the decision
    - contextPath: File.Malicious.Score
      description: For malicious files, the score from the vendor
    - contextPath: DBotScore.Indicator
      description: The indicator we tested
    - contextPath: DBotScore.Type
      description: The type of the indicator
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the score
    - contextPath: DBotScore.Score
      description: The actual score
    description: Submit a file for analysis
  - name: lastline-upload
    arguments:
    - name: file_id
      required: true
      default: true
      description: File ID to be uploaded
    - name: threshold
      description: Score threshold to identify file as malicious
      defaultValue: "50"
    - name: timeout
      description: Timeout (in seconds) to wait for analysis to complete
      defaultValue: "0"
    - name: interval
      description: Interval (in seconds) to poll for the analysis status
      defaultValue: "10"
    - name: pushToPortal
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Add the request to the Lastline portal
    outputs:
    - contextPath: lastlineTasks.file_id
      description: File ID of submitted Lastline analysis tasks
    - contextPath: lastlineTasks.uuid
      description: Task UUID of submitted Lastline analysis
    description: Upload file for analysis
  runonce: false
