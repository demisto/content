id: JoeSecurity - Detonate File From URL
version: -1
name: JoeSecurity - Detonate File From URL
description: |-
  Detonates one or more remote files using the Joe Security sandbox integration.
  Returns relevant reports to the War Room and file reputations to the context data.
  This type of analysis is available for Windows only and works only for direct download links.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: d8a91f9c-40f6-48f2-8dd2-1c7e59b6abdb
    type: start
    task:
      id: d8a91f9c-40f6-48f2-8dd2-1c7e59b6abdb
      version: -1
      name: ""
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 450,
          "y": -324
        }
      }
    note: false
  "1":
    id: "1"
    taskid: e0168b07-e01c-4e60-8e41-07e4ff005357
    type: regular
    task:
      id: e0168b07-e01c-4e60-8e41-07e4ff005357
      version: -1
      name: JoeSecurity Upload File
      script: Joe Security|||joe-analysis-submit-sample
      type: regular
      iscommand: true
      brand: Joe Security
    nexttasks:
      '#none#':
      - "2"
    scriptarguments:
      comments:
        simple: ${inputs.comments}
      file_id: {}
      internet-access:
        simple: ${inputs.internet-access}
      sample_url:
        simple: ${inputs.FileUrl}
      should_wait: {}
      systems:
        simple: ${inputs.systems}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 450,
          "y": 321
        }
      }
    note: false
  "2":
    id: "2"
    taskid: ccc26545-1d62-4706-83ac-aa9b41d807eb
    type: playbook
    task:
      id: ccc26545-1d62-4706-83ac-aa9b41d807eb
      version: -1
      name: GenericPolling
      description: Generic Polling Playbook
      playbookName: GenericPolling
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      Ids:
        simple: ${Joe.Analysis.ID}
      Interval:
        simple: ${inputs.interval}
      PollingCommandArgName:
        simple: webid
      PollingCommandName:
        simple: joe-analysis-info
      Timeout:
        simple: ${inputs.timeout}
      dt:
        simple: Joe.Analysis(val.Status != 'finished').ID
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
    view: |-
      {
        "position": {
          "x": 450,
          "y": 483
        }
      }
    note: false
  "3":
    id: "3"
    taskid: 320acad1-fd84-44e9-8fa1-1a260214f220
    type: regular
    task:
      id: 320acad1-fd84-44e9-8fa1-1a260214f220
      version: -1
      name: JoeSecurity Get Report
      script: Joe Security|||joe-download-report
      type: regular
      iscommand: true
      brand: Joe Security
    nexttasks:
      '#none#':
      - "5"
    scriptarguments:
      type:
        simple: ${inputs.report-file-type}
      webid:
        simple: ${Joe.Analysis.WebID}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 450,
          "y": 658
        }
      }
    note: false
  "5":
    id: "5"
    taskid: 93fac7de-168e-4b60-8172-1d0d8cc46702
    type: title
    task:
      id: 93fac7de-168e-4b60-8172-1d0d8cc46702
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 450,
          "y": 991
        }
      }
    note: false
  "6":
    id: "6"
    taskid: 38d5dae5-d813-4ebc-8e57-7bbc497226cd
    type: condition
    task:
      id: 38d5dae5-d813-4ebc-8e57-7bbc497226cd
      version: -1
      name: Is there a File to detonate?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "5"
      "yes":
      - "1"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: inputs.FileUrl
            iscontext: true
    view: |-
      {
        "position": {
          "x": 450,
          "y": 103
        }
      }
    note: false
  "7":
    id: "7"
    taskid: da4f6f43-f807-4804-8014-9d1597a5cc7c
    type: condition
    task:
      id: da4f6f43-f807-4804-8014-9d1597a5cc7c
      version: -1
      name: Is JoeSecurity sandbox enabled?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "5"
      "yes":
      - "6"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: isEqualString
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: Joe Security
                transformers:
                - operator: getField
                  args:
                    field:
                      value:
                        simple: state
            iscontext: true
          right:
            value:
              simple: active
    view: |-
      {
        "position": {
          "x": 450,
          "y": -115
        }
      }
    note: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 1380,
        "width": 380,
        "x": 450,
        "y": -324
      }
    }
  }
inputs:
- key: FileUrl
  value: {}
  required: true
  description: Url of web file to detonate from the context
- key: interval
  value:
    simple: "1"
  required: false
  description: The duration of an interval of executing the pooling in minutes
- key: timeout
  value:
    simple: "15"
  required: false
  description: timeout to stop pooling and resume the playbook
- key: systems
  value: {}
  required: false
  description: 'Operating System to run analysis on (comma separated). possible values
    are: w7, w7x64, w7_1, w7_2, w7native, android2, android3, mac1, w7l, w7x64l, w10,
    android4, w7x64native, w7_3, w10native, android5native_1, w7_4, w7_5, w10x64,
    w7x64_hvm, android6, iphone1, w7_sec, macvm, w7_lang_packs, w7x64native_hvm, lnxubuntu1,
    lnxcentos1, android7_nougat'
- key: comments
  value: {}
  required: false
  description: Comments for the analysis.
- key: internet-access
  value:
    simple: "True"
  required: false
  description: Enable full internet access. Default is True.
- key: report-file-type
  value: {}
  required: false
  description: The resource type to download. Defaults to html.
outputs:
- contextPath: File.Malicious.Vendor
  description: For malicious files, the vendor that made the decision
  type: string
- contextPath: File.Name
  description: Filename (only in case of report type=json)
  type: string
- contextPath: File.Size
  description: File size (only in case of report type=json)
  type: number
- contextPath: File.MD5
  description: MD5 hash of the file (only in case of report type=json)
  type: string
- contextPath: File.SHA1
  description: SHA1 hash of the file (only in case of report type=json)
  type: string
- contextPath: File.Type
  description: File type e.g. "PE" (only in case of report type=json)
  type: string
- contextPath: File.SHA256
  description: SHA256 hash of the file (only in case of report type=json)
  type: string
- contextPath: File.EntryID
  description: The Entry ID of the sample
  type: string
- contextPath: File.Malicious.Description
  description: For malicious files, the reason for the vendor to make the decision
  type: string
- contextPath: DBotScore.Indicator
  description: The indicator we tested (only in case of report type=json)
  type: string
- contextPath: DBotScore.Type
  description: The type of the indicator (only in case of report type=json)
  type: string
- contextPath: DBotScore.Vendor
  description: Vendor used to calculate the score (only in case of report type=json)
  type: string
- contextPath: IP.Address
  description: IP's relevant to the sample
  type: string
- contextPath: DBotScore.Score
  description: The actual score (only in case of report type=json)
  type: number
releaseNotes: "URL File detonation using polling playbook"