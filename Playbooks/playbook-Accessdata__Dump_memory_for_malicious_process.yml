id: Accessdata_Dump_memory_for_malicious_process
version: -1
fromversion: 4.1.0
name: 'Accessdata: Dump memory for malicious process'
description: This playbook dumps memory  if given process is running on legacy AD
  agent
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 203b8134-3542-4f2f-8976-c83227b7991d
    type: start
    task:
      id: 203b8134-3542-4f2f-8976-c83227b7991d
      version: -1
      name: ""
      description: Playbook entry point
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "8"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 10
        }
      }
    note: false
    timertriggers: []
  "1":
    id: "1"
    taskid: f5af4b9d-40aa-4812-84a6-8ccc53722cd5
    type: regular
    task:
      id: f5af4b9d-40aa-4812-84a6-8ccc53722cd5
      version: -1
      name: Get process list from legacy agent
      description: Call command to get process list from legacy agent
      script: '|||accessdata-legacyagent-get-processlist'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "15"
    scriptarguments:
      caseid:
        simple: ${inputs.caseid}
      target_ip:
        simple: ${inputs.target_ip}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 290
        }
      }
    note: false
    timertriggers: []
  "7":
    id: "7"
    taskid: 893960ac-a473-4f23-8176-1840d3dec3c6
    type: title
    task:
      id: 893960ac-a473-4f23-8176-1840d3dec3c6
      version: -1
      name: Done
      description: Playbook exit point
      type: title
      iscommand: false
      brand: ""
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1715
        }
      }
    note: false
    timertriggers: []
  "8":
    id: "8"
    taskid: ec776aab-6bf3-4450-8957-d1bbe81efbb9
    type: regular
    task:
      id: ec776aab-6bf3-4450-8957-d1bbe81efbb9
      version: -1
      name: DeleteContext
      description: Clear current context
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "1"
    scriptarguments:
      all:
        simple: "yes"
      index: {}
      key: {}
      keysToKeep: {}
      subplaybook: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 135
        }
      }
    note: false
    timertriggers: []
  "10":
    id: "10"
    taskid: fceb95da-a501-4a57-8a77-35b284879da1
    type: regular
    task:
      id: fceb95da-a501-4a57-8a77-35b284879da1
      version: -1
      name: Read snapshot file from case folder
      description: Reads a file from case folder and saves its content in current
        contet
      script: Quinc|||accessdata-read-casefile
      type: regular
      iscommand: true
      brand: Quinc
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      filepath:
        simple: ${Accessdata.Job.Result.SnapshotDetails.File}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 740
        }
      }
    note: false
    timertriggers: []
  "11":
    id: "11"
    taskid: e8e2d2d9-e2a4-4d9c-828b-2759e1887152
    type: regular
    task:
      id: e8e2d2d9-e2a4-4d9c-828b-2759e1887152
      version: -1
      name: Check if process exists in process list
      description: Reads contetn of XML file from context, converts it to JSON and
        checks if given filename exists in process list. Returs yes or no
      scriptName: AccessdataCheckProcessExistsInSnapshot
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "12"
    scriptarguments:
      process:
        simple: ${inputs.process_name}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 895
        }
      }
    note: false
    timertriggers: []
  "12":
    id: "12"
    taskid: 11e4ecae-6fb2-4054-8d45-77f51c9c0cd0
    type: condition
    task:
      id: 11e4ecae-6fb2-4054-8d45-77f51c9c0cd0
      version: -1
      name: Does the  process exist?
      description: Simple conditional task
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "7"
      "yes":
      - "13"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: Accessdata.Process.Exists
            iscontext: true
          right:
            value:
              simple: "Yes"
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1050
        }
      }
    note: false
    timertriggers: []
  "13":
    id: "13"
    taskid: c3b4b8c2-486b-49cc-82e9-8dcdbc838a0b
    type: regular
    task:
      id: c3b4b8c2-486b-49cc-82e9-8dcdbc838a0b
      version: -1
      name: Create memory dump job
      description: Creates legacy agent memory dump
      script: Quinc|||accessdata-legacyagent-get-memorydump
      type: regular
      iscommand: true
      brand: Quinc
    nexttasks:
      '#none#':
      - "17"
    scriptarguments:
      caseid:
        simple: ${inputs.caseid}
      target_ip:
        simple: ${inputs.target_ip}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 350,
          "y": 1240
        }
      }
    note: false
    timertriggers: []
  "15":
    id: "15"
    taskid: dffa12ec-6f24-4b77-8507-130a4f33260c
    type: playbook
    task:
      id: dffa12ec-6f24-4b77-8507-130a4f33260c
      version: -1
      name: GenericPolling
      description: |-
        Use as a sub-playbook to block execution of the master playbook until a remote action is complete.
        This playbook implements polling by continually running the command in Step #2 until the operation completes.
        The remote action should have the following structure:

        1. Initiate the operation.
        2. Poll to check if the operation completed.
        3. (optional) Get the results of the operation.
      playbookName: GenericPolling
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      Ids:
        simple: ${Accessdata.Job.CaseJobID}
      Interval:
        simple: "1"
      PollingCommandArgName:
        simple: caseJobID
      PollingCommandName:
        simple: accessdata-jobstatus-scan
      Timeout:
        simple: "15"
      dt:
        simple: Accessdata.Job(val.State == 'Unknown' || val.State == 'Started' ||
          val.State == 'Pending' || val.State == 'Submitted' || val.State == 'InProgress').CaseJobID
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
    view: |-
      {
        "position": {
          "x": 50,
          "y": 440
        }
      }
    note: false
    timertriggers: []
  "16":
    id: "16"
    taskid: f67e6abe-ef41-4a99-81c2-c16eb486b10e
    type: regular
    task:
      id: f67e6abe-ef41-4a99-81c2-c16eb486b10e
      version: -1
      name: Get process list job result
      description: Get status of job
      script: Quinc|||accessdata-get-jobstatus
      type: regular
      iscommand: true
      brand: Quinc
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      caseID:
        simple: ${inputs.caseid}
      jobID:
        simple: ${Accessdata.Job(val.Type=="Volatile").ID}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 590
        }
      }
    note: false
    timertriggers: []
  "17":
    id: "17"
    taskid: 4d92aa7b-37be-4c6d-8edd-d4e9a593715c
    type: playbook
    task:
      id: 4d92aa7b-37be-4c6d-8edd-d4e9a593715c
      version: -1
      name: GenericPolling
      description: |-
        Use as a sub-playbook to block execution of the master playbook until a remote action is complete.
        This playbook implements polling by continually running the command in Step #2 until the operation completes.
        The remote action should have the following structure:

        1. Initiate the operation.
        2. Poll to check if the operation completed.
        3. (optional) Get the results of the operation.
      playbookName: GenericPolling
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "18"
    scriptarguments:
      Ids:
        simple: ${Accessdata.Job.CaseJobID}
      Interval:
        simple: "1"
      PollingCommandArgName:
        simple: caseJobID
      PollingCommandName:
        simple: accessdata-jobstatus-scan
      Timeout:
        simple: "15"
      dt:
        simple: Accessdata.Job(val.State == 'Unknown' || val.State == 'Started' ||
          val.State == 'Pending' || val.State == 'Submitted' || val.State == 'InProgress').CaseJobID
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
    view: |-
      {
        "position": {
          "x": 350,
          "y": 1390
        }
      }
    note: false
    timertriggers: []
  "18":
    id: "18"
    taskid: 2f2bef09-1ffb-4515-8580-ee0d53794bbb
    type: regular
    task:
      id: 2f2bef09-1ffb-4515-8580-ee0d53794bbb
      version: -1
      name: Get memory dump job result
      description: Get status of job
      script: Quinc|||accessdata-get-jobstatus
      type: regular
      iscommand: true
      brand: Quinc
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      caseID:
        simple: ${inputs.caseid}
      jobID:
        simple: ${Accessdata.Job(val.Type=="LegacyMemoryDump").ID}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 350,
          "y": 1545
        }
      }
    note: false
    timertriggers: []
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 1770,
        "width": 680,
        "x": 50,
        "y": 10
      }
    }
  }
inputs:
- key: caseid
  value:
    simple: "1"
  required: true
  description: ""
- key: target_ip
  value:
    simple: X.X.X.X
  required: true
  description: ""
- key: process_name
  value:
    simple: explorer.exe
  required: true
  description: ""
outputs:
- contextPath: Result
  description: ""
- contextPath: State
  description: ""
tests:
  - No test
