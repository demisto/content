id: Frontline.Cloud - PAN-OS block assets with critical vulns from threat logs
version: -1
name: Frontline.Cloud - PAN-OS block assets with critical vulns from threat logs
description: This playbook will pull threat logs from Panorama query logs and check
  for any correlating assets are found to have a minimum of high level vulnerabilities.
  If so, it will block the the IP using Panorama's PAN-OS - Block IP and URL - External
  Dynamic List playbook.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 3af2c27a-a555-4626-80d4-85e692a8263c
    type: start
    task:
      id: 3af2c27a-a555-4626-80d4-85e692a8263c
      version: -1
      name: ""
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "1"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 50
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "1":
    id: "1"
    taskid: 8d0120d0-657c-49ff-8552-ada9b349d9b1
    type: regular
    task:
      id: 8d0120d0-657c-49ff-8552-ada9b349d9b1
      version: -1
      name: panorama-query-logs (query threat logs)
      description: Query logs in Panorama.
      script: Panorama|||panorama-query-logs
      type: regular
      iscommand: true
      brand: Panorama
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      action: {}
      addr-dst: {}
      addr-src: {}
      filedigest: {}
      log-type:
        simple: threat
      number_of_logs: {}
      port-dst: {}
      query: {}
      rule: {}
      time-generated: {}
      url: {}
      zone-dst: {}
      zone-src: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 195
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "2":
    id: "2"
    taskid: ef885479-a9e0-4725-888f-43c7aab13861
    type: regular
    task:
      id: ef885479-a9e0-4725-888f-43c7aab13861
      version: -1
      name: panorama-check-logs-status
      description: Checks the status of a logs query.
      script: Panorama|||panorama-check-logs-status
      type: regular
      iscommand: true
      brand: Panorama
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      job_id:
        simple: ${Panorama.Monitor.JobID}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 545
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "3":
    id: "3"
    taskid: 10436cc9-fc8e-4877-8f22-b76646bb65ea
    type: condition
    task:
      id: 10436cc9-fc8e-4877-8f22-b76646bb65ea
      version: -1
      name: Log has completed
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "5"
      "yes":
      - "4"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: Panorama.Monitor.Status
            iscontext: true
          right:
            value:
              simple: Completed
    view: |-
      {
        "position": {
          "x": 480,
          "y": 720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "4":
    id: "4"
    taskid: 81702d7f-3631-4752-8a6c-0a6239294803
    type: regular
    task:
      id: 81702d7f-3631-4752-8a6c-0a6239294803
      version: -1
      name: panorama-get-logs (retrieve completed log query)
      description: Retrieves the data of a logs query.
      script: Panorama|||panorama-get-logs
      type: regular
      iscommand: true
      brand: Panorama
    nexttasks:
      '#none#':
      - "6"
    scriptarguments:
      ignore_auto_extract: {}
      job_id:
        simple: ${Panorama.Monitor.JobID}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 265,
          "y": 895
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "5":
    id: "5"
    taskid: 0f43ed3d-046f-4a29-8cfa-92444d812941
    type: regular
    task:
      id: 0f43ed3d-046f-4a29-8cfa-92444d812941
      version: -1
      name: Queried logs have not completed.
      description: Prints text to war room (Markdown supported)
      scriptName: Print
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      value:
        simple: 'Query log status: ${Panorama.Monitor.Status}'
    separatecontext: false
    defaultassigneecomplex:
      simple: admin
    view: |-
      {
        "position": {
          "x": 695,
          "y": 895
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "6":
    id: "6"
    taskid: 0804d959-0212-43af-852b-668ced5d206d
    type: regular
    task:
      id: 0804d959-0212-43af-852b-668ced5d206d
      version: -1
      name: frontline-get-vulns (pull vuln data from threat source)
      script: Digital Defense Inc. FrontlineVM|||frontline-get-vulns
      type: regular
      iscommand: true
      brand: Digital Defense Inc. FrontlineVM
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      days_newer_than: {}
      days_older_than: {}
      host_id: {}
      ip_address:
        simple: ${Panorama.Monitor.Logs.SourceAddress}
      max_days_since_created: {}
      min_days_since_created: {}
      min_severity:
        simple: high
      severity: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 265,
          "y": 1070
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "7":
    id: "7"
    taskid: ef58155a-dd57-4f7c-84de-fe366a77f2c1
    type: condition
    task:
      id: ef58155a-dd57-4f7c-84de-fe366a77f2c1
      version: -1
      name: Check if critical vulns found.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "9"
      "yes":
      - "8"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: FrontlineVM.Vulns
            iscontext: true
    view: |-
      {
        "position": {
          "x": 265,
          "y": 1230
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "8":
    id: "8"
    taskid: f3212b13-3088-42b6-859d-46e0f291f2f1
    type: regular
    task:
      id: f3212b13-3088-42b6-859d-46e0f291f2f1
      version: -1
      name: Critical vulnerabilities exist within Frontline.Cloud from PAN OS threat
        logs.
      description: Prints text to war room (Markdown supported)
      scriptName: Print
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      value:
        simple: 'Asset found to have critical level vulnerabilities within Frontline.Cloud:
          ${Panorama.Monitor.Logs.SourceAddress}'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1420
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "9":
    id: "9"
    taskid: b908714f-bfba-4062-8630-3a9487229cf3
    type: regular
    task:
      id: b908714f-bfba-4062-8630-3a9487229cf3
      version: -1
      name: No critical vulnerabilities found from PAN OS threat logs.
      description: Prints text to war room (Markdown supported)
      scriptName: Print
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      value:
        simple: 'Critical vulnerabilities not found within Frontline.Cloud for given
          asset: ${Panorama.Monitor.Logs.SourceAddress}'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1420
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "10":
    id: "10"
    taskid: a0e11307-329a-44ed-8e1d-3d87f464e7f0
    type: regular
    task:
      id: a0e11307-329a-44ed-8e1d-3d87f464e7f0
      version: -1
      name: Wait for query logs to complete (30 sec)
      description: Sleep for X seconds
      scriptName: Sleep
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "2"
    scriptarguments:
      seconds:
        simple: "30"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "11":
    id: "11"
    taskid: ad46089d-bf36-4350-8ad8-956060c95c9d
    type: playbook
    task:
      id: ad46089d-bf36-4350-8ad8-956060c95c9d
      version: -1
      name: PAN-OS - Block IP and URL - External Dynamic List
      playbookName: PAN-OS - Block IP and URL - External Dynamic List
      type: playbook
      iscommand: false
      brand: ""
    scriptarguments:
      AutoCommit:
        simple: "No"
      EDLServerIP: {}
      IP:
        complex:
          root: FrontlineVM
          accessor: IPList
          transformers:
          - operator: uniq
      IPListName:
        simple: Demisto Remediation - IP EDL
      LogForwarding: {}
      URL: {}
      URLListName:
        simple: Demisto Remediation - URL EDL
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1580
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 1625,
        "width": 1025,
        "x": 50,
        "y": 50
      }
    }
  }
inputs: []
outputs: []
