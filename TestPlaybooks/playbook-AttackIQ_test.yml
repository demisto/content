id: AttackIQ - Test
version: -1
name: AttackIQ - Test
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 4c4cfd24-d02b-4820-8125-3c15e76ccb9b
    type: start
    task:
      id: 4c4cfd24-d02b-4820-8125-3c15e76ccb9b
      version: -1
      name: ""
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "1"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 50
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "1":
    id: "1"
    taskid: 8ca19166-3dd5-490c-8493-a93e89fa0d0d
    type: regular
    task:
      id: 8ca19166-3dd5-490c-8493-a93e89fa0d0d
      version: -1
      name: Clear Context
      description: Delete field from context
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "2"
    scriptarguments:
      all:
        simple: "yes"
      index: {}
      key: {}
      keysToKeep: {}
      subplaybook: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 195
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "2":
    id: "2"
    taskid: dfbe1bf4-0309-4296-8ce3-b7eb553665a4
    type: regular
    task:
      id: dfbe1bf4-0309-4296-8ce3-b7eb553665a4
      version: -1
      name: Activate assessment
      description: Activates the assessment. this is required for execution.
      script: '|||attackiq-activate-assessment'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      assessment_id:
        simple: c4e352ae-1506-4c74-bd90-853f02dd765a
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 370
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "3":
    id: "3"
    taskid: 826ae74e-d834-4227-82db-b6933ce0300b
    type: regular
    task:
      id: 826ae74e-d834-4227-82db-b6933ce0300b
      version: -1
      name: Get assessment execution status
      description: Get assessment execution status - supports only on demand runs.
      script: '|||attackiq-get-assessment-execution-status'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      assessment_id:
        simple: c4e352ae-1506-4c74-bd90-853f02dd765a
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 545
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "4":
    id: "4"
    taskid: b7fdbdb7-383e-4a2d-88dd-2d4de6e60326
    type: condition
    task:
      id: b7fdbdb7-383e-4a2d-88dd-2d4de6e60326
      version: -1
      name: Assert execution status
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "yes":
      - "7"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isFalse
          left:
            value:
              simple: AttackIQ.Assessment.Running
            iscontext: true
    view: |-
      {
        "position": {
          "x": 50,
          "y": 720
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "7":
    id: "7"
    taskid: 25702b3e-6033-48cc-81d8-4e8b24e6d009
    type: regular
    task:
      id: 25702b3e-6033-48cc-81d8-4e8b24e6d009
      version: -1
      name: Get test results
      script: '|||attackiq-get-test-results'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "8"
    scriptarguments:
      show_last_result:
        simple: "True"
      test_id:
        simple: 1c350a5a-84f2-4938-93d8-cc31f0a99482
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 895
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "8":
    id: "8"
    taskid: 3abff49e-5011-4e50-8224-5f850be57365
    type: condition
    task:
      id: 3abff49e-5011-4e50-8224-5f850be57365
      version: -1
      name: Assert test results
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "yes":
      - "9"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.TestResult.Assessment.Id
            iscontext: true
          right:
            value:
              simple: c4e352ae-1506-4c74-bd90-853f02dd765a
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.TestResult.Assessment.Name
            iscontext: true
          right:
            value:
              simple: Arseny's ransomware project
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.TestResult.MasterJob.Id
            iscontext: true
          right:
            value:
              simple: 1c350a5a-84f2-4938-93d8-cc31f0a99482
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.TestResult.MasterJob.Assets.ProductName
            iscontext: true
          right:
            value:
              simple: Windows Server 2016 Datacenter
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.TestResult.MasterJob.Scenarios.Name
            iscontext: true
          right:
            value:
              simple: Download WannaCry Ransomware Sample
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.TestResult.Scenario.Name
            iscontext: true
          right:
            value:
              simple: Download ODCODC Ransomware
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.TestResult.Asset.Ipv4Address
            iscontext: true
          right:
            value:
              simple: 172.31.39.254
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.TestResult.JobState.Name
            iscontext: true
          right:
            value:
              simple: Finished
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.TestResult.Outcome.Name
            iscontext: true
          right:
            value:
              simple: Passed
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1070
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "9":
    id: "9"
    taskid: e10146be-40bc-4ff3-8a9e-c1ab9b56c494
    type: regular
    task:
      id: e10146be-40bc-4ff3-8a9e-c1ab9b56c494
      version: -1
      name: Get all assessments
      description: Get all assessments in a page or by assessment id.
      script: '|||attackiq-list-assessments'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      assessment_id: {}
      page_number: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1245
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "10":
    id: "10"
    taskid: 5796c4a4-dcfe-41c0-82a6-70a2bb8fe70e
    type: condition
    task:
      id: 5796c4a4-dcfe-41c0-82a6-70a2bb8fe70e
      version: -1
      name: Assert assessments
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "yes":
      - "11"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: AttackIQ.Assessment.Id
            iscontext: true
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.Assessment.Name
            iscontext: true
          right:
            value:
              simple: Arseny's ransomware project
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.Assessment.Description
            iscontext: true
          right:
            value:
              simple: Test of common ransomware variants
      - - operator: isExists
          left:
            value:
              simple: AttackIQ.Assessment.AssessmentState
            iscontext: true
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.Assessment.Creator
            iscontext: true
          right:
            value:
              simple: akrupnik@paloaltonetworks.com
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.Assessment.Owner
            iscontext: true
          right:
            value:
              simple: akrupnik@paloaltonetworks.com
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.Assessment.User
            iscontext: true
          right:
            value:
              simple: akrupnik@paloaltonetworks.com
      - - operator: isExists
          left:
            value:
              simple: AttackIQ.Assessment.Created
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: AttackIQ.Assessment.Modified
            iscontext: true
      - - operator: containsGeneral
          left:
            value:
              simple: AttackIQ.Assessment.Users
            iscontext: true
          right:
            value:
              simple: 71e92cf9-5159-466c-8050-142d1ba279ea
      - - operator: isEqualNumber
          left:
            value:
              simple: AttackIQ.Assessment.DefaultAssetCount
            iscontext: true
          right:
            value:
              simple: "1"
      - - operator: isEqualNumber
          left:
            value:
              simple: AttackIQ.Assessment.DefaultAssetGroupCount
            iscontext: true
          right:
            value:
              simple: "0"
      - - operator: isEqualNumber
          left:
            value:
              simple: AttackIQ.Assessment.MasterJobCount
            iscontext: true
          right:
            value:
              simple: "3"
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.Assessment.AssessmentTemplate.Id
            iscontext: true
          right:
            value:
              simple: 59d35f4a-2da0-4c4a-a08a-c30cb41dae6b
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.Assessment.AssessmentTemplate.TemplateName
            iscontext: true
          right:
            value:
              simple: Ransomware Project
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.Assessment.AssessmentTemplate.TemplateDescription
            iscontext: true
          right:
            value:
              simple: Variety of common ransomware variants
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.Assessment.AssessmentTemplate.Company
            iscontext: true
          right:
            value:
              simple: 906d5ec6-101c-4ae6-8906-b93ce0529060
      - - operator: isExists
          left:
            value:
              simple: AttackIQ.Assessment.AssessmentTemplate.Created
            iscontext: true
      - - operator: isExists
          left:
            value:
              simple: AttackIQ.Assessment.AssessmentTemplate.Modified
            iscontext: true
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1420
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "11":
    id: "11"
    taskid: 3aaa8966-abdc-4fb2-8b4d-83be42b8e547
    type: regular
    task:
      id: 3aaa8966-abdc-4fb2-8b4d-83be42b8e547
      version: -1
      name: Get tests by assessment
      script: '|||attackiq-list-tests-by-assessment'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "12"
    scriptarguments:
      assessment_id:
        simple: c4e352ae-1506-4c74-bd90-853f02dd765a
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1595
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "12":
    id: "12"
    taskid: 656aacb0-d0ac-479a-8d8b-a434449673e3
    type: condition
    task:
      id: 656aacb0-d0ac-479a-8d8b-a434449673e3
      version: -1
      name: Assert tests
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "yes":
      - "15"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: greaterThanOrEqual
          left:
            value:
              simple: AttackIQ.Test.TotalAssetCount
            iscontext: true
          right:
            value:
              simple: "1"
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.Test.LastResult
            iscontext: true
          right:
            value:
              simple: Failed
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.Test.User
            iscontext: true
          right:
            value:
              simple: akrupnik@paloaltonetworks.com
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.Test.Created
            iscontext: true
          right:
            value:
              simple: 2019-08-27T10:17:09.968467Z
      - - operator: isTrue
          left:
            value:
              simple: AttackIQ.Test.UsingDefaultAssets
            iscontext: true
      - - operator: isTrue
          left:
            value:
              simple: AttackIQ.Test.UsingDefaultSchedule
            iscontext: true
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.Test.Scenarios.Id
            iscontext: true
          right:
            value:
              simple: b7425756-ab9a-4c7e-8fda-d1080c170910
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.Test.Scenarios.Name
            iscontext: true
          right:
            value:
              simple: Download Petya Ransomware
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.Test.Assets.Id
            iscontext: true
          right:
            value:
              simple: 03e17460-849e-4b86-b6c6-ef0db72823ff
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.Test.Assets.Ipv4Address
            iscontext: true
          right:
            value:
              simple: 172.31.39.254
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.Test.Assets.Hostname
            iscontext: true
          right:
            value:
              simple: ec2amaz-g4iu5no
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.Test.Assets.ProductName
            iscontext: true
          right:
            value:
              simple: Windows Server 2016 Datacenter
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.Test.Assets.Status
            iscontext: true
          right:
            value:
              simple: Active
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1770
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "13":
    id: "13"
    taskid: d632ec8c-ed32-4725-844e-baebba5ff10e
    type: title
    task:
      id: d632ec8c-ed32-4725-844e-baebba5ff10e
      version: -1
      name: Done
      description: runs all of the tests in the assessment.
      type: title
      iscommand: false
      brand: ""
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2470
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "14":
    id: "14"
    taskid: ca880e71-061c-4d77-8697-21697f3da532
    type: regular
    task:
      id: ca880e71-061c-4d77-8697-21697f3da532
      version: -1
      name: Get assessment by id
      description: Get all assessments in a page or by assessment id.
      script: '|||attackiq-get-assessment-by-id'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "16"
    scriptarguments:
      assessment_id:
        simple: c4e352ae-1506-4c74-bd90-853f02dd765a
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "15":
    id: "15"
    taskid: 6d363e76-31d4-41ce-8fb2-943f1b75ecae
    type: regular
    task:
      id: 6d363e76-31d4-41ce-8fb2-943f1b75ecae
      version: -1
      name: Clear Context
      description: Delete field from context
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      all:
        simple: "yes"
      index: {}
      key: {}
      keysToKeep: {}
      subplaybook: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1945
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "16":
    id: "16"
    taskid: a1ed9043-fefd-4c17-8cf5-c836f3621045
    type: condition
    task:
      id: a1ed9043-fefd-4c17-8cf5-c836f3621045
      version: -1
      name: Assert get assessment results
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "yes":
      - "13"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.Assessment.Id
            iscontext: true
          right:
            value:
              simple: c4e352ae-1506-4c74-bd90-853f02dd765a
      - - operator: isEqualString
          left:
            value:
              simple: AttackIQ.Assessment.DefaultSchedule
            iscontext: true
          right:
            value:
              simple: 41;8;*;*;1
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2295
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 2485,
        "width": 380,
        "x": 50,
        "y": 50
      }
    }
  }
inputs: []
outputs: []
