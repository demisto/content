id: Send Investigation Summary Reports - Test
version: -1
name: Send Investigation Summary Reports - Test
description: 'Playbook should be run as a scheduled job at a recommended interval
  of once every 15 minutes. Playbook simply calls sub playbook: "Send Investigation
  Summary Reports" and closes the incident. Playbook by default will search all closed
  incidents within the last hour. If you wish to run the playbook more frequently,
  you should adjust the search query of the child playbook: Send Investigation Summary
  Reports.'
starttaskid: "0"
fromversion: "4.1.0"
tasks:
  "0":
    id: "0"
    taskid: 4e9d487f-0cee-410a-89d2-d3b76ddadb52
    type: start
    task:
      id: 4e9d487f-0cee-410a-89d2-d3b76ddadb52
      version: -1
      name: ""
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "2"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 450,
          "y": 50
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "1":
    id: "1"
    taskid: 33d7fbb4-bb28-4be2-8cbb-2fbcf1620c6f
    type: playbook
    task:
      id: 33d7fbb4-bb28-4be2-8cbb-2fbcf1620c6f
      version: -1
      name: Send Investigation Summary Reports
      description: 'Playbook will iterate over closed incidents and generate a summary
        report for each. Will then email all reports. '
      playbookName: Send Investigation Summary Reports
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "6"
    scriptarguments:
      IncidentSearchQuery:
        simple: -category:job status:closed closed:>="1 hour ago"
      MailTo:
        simple: avishai@demistodev.onmicrosoft.com
      ReportName:
        simple: Investigation Summary
      ReportType:
        simple: pdf
    separatecontext: true
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
    view: |-
      {
        "position": {
          "x": 450,
          "y": 820
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "2":
    id: "2"
    taskid: 4e59af5f-4296-4b79-8f22-90d5f4df1333
    type: regular
    task:
      id: 4e59af5f-4296-4b79-8f22-90d5f4df1333
      version: -1
      name: Clear Context
      description: Delete field from context
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      all:
        simple: "yes"
      index: {}
      key: {}
      keysToKeep: {}
      subplaybook: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 450,
          "y": 190
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "3":
    id: "3"
    taskid: a02e7579-1333-4656-86aa-cd62b0353a20
    type: title
    task:
      id: a02e7579-1333-4656-86aa-cd62b0353a20
      version: -1
      name: Test Completed
      description: commands.local.cmd.close.inv
      type: title
      iscommand: false
      brand: Builtin
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1300
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "4":
    id: "4"
    taskid: fd03a36a-81f4-46db-8d2a-636a6574a2af
    type: regular
    task:
      id: fd03a36a-81f4-46db-8d2a-636a6574a2af
      version: -1
      name: Create Incident
      description: commands.local.cmd.create.inc
      script: Builtin|||createNewIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "5"
    scriptarguments:
      affecteddata: {}
      affecteddatatype: {}
      affectedindividualscontactinformation: {}
      app: {}
      approximatenumberofaffecteddatasubjects: {}
      assetid: {}
      attachmentcount: {}
      attachmentextension: {}
      attachmenthash: {}
      attachmentid: {}
      attachmentname: {}
      attachmentsize: {}
      attachmenttype: {}
      bugtraq: {}
      city: {}
      companyaddress: {}
      companycity: {}
      companycountry: {}
      companyhasinsuranceforthebreach: {}
      companyname: {}
      companypostalcode: {}
      contactaddress: {}
      contactname: {}
      country: {}
      countrywherebusinesshasitsmainestablishment: {}
      countrywherethebreachtookplace: {}
      customFields: {}
      cve: {}
      cvss: {}
      dataencryptionstatus: {}
      datetimeofthebreach: {}
      dest: {}
      destntdomain: {}
      details: {}
      dpoemailaddress: {}
      duration: {}
      emailaddress: {}
      emailbcc: {}
      emailbody: {}
      emailbodyformat: {}
      emailbodyhtml: {}
      emailcc: {}
      emailclientname: {}
      emailfrom: {}
      emailinreplyto: {}
      emailkeywords: {}
      emailmessageid: {}
      emailreceived: {}
      emailreplyto: {}
      emailreturnpath: {}
      emailsenderip: {}
      emailsize: {}
      emailsource: {}
      emailsubject: {}
      emailto: {}
      emailtocount: {}
      emailurlclicked: {}
      entryIDs: {}
      filehash: {}
      filename: {}
      filepath: {}
      isthedatasubjecttodpia: {}
      labels: {}
      likelyimpact: {}
      maliciouscauseifthecauseisamaliciousattack: {}
      malwarefamily: {}
      measurestomitigate: {}
      name:
        simple: Incident to test close
      occurred: {}
      owner: {}
      phase: {}
      possiblecauseofthebreach: {}
      postalcode: {}
      roles: {}
      sectorofaffectedparty: {}
      severity: {}
      signature: {}
      sizenumberofemployees: {}
      sizeturnover: {}
      sla: {}
      slaField: {}
      src: {}
      srcntdomain: {}
      srcuser: {}
      systems: {}
      telephoneno: {}
      type: {}
      user: {}
      vendorid: {}
      vendorproduct: {}
      vulnerabilitycategory: {}
      whereisdatahosted: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 450,
          "y": 350
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "5":
    id: "5"
    taskid: 89fc1675-d898-4349-8d22-e5fa1d7b0f7b
    type: regular
    task:
      id: 89fc1675-d898-4349-8d22-e5fa1d7b0f7b
      version: -1
      name: Close Incident
      description: commands.local.cmd.close.inv
      script: Builtin|||closeInvestigation
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      assetid: {}
      closeNotes: {}
      closeReason: {}
      id:
        simple: ${CreatedIncidentID}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 450,
          "y": 500
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "6":
    id: "6"
    taskid: 1ec1f709-3039-445f-8419-b2aaa6c7635f
    type: regular
    task:
      id: 1ec1f709-3039-445f-8419-b2aaa6c7635f
      version: -1
      name: Get Incident
      description: Searches Demisto incidents
      scriptName: SearchIncidents
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "7"
    scriptarguments:
      details: {}
      fromclosedate: {}
      fromdate: {}
      fromduedate: {}
      id:
        simple: ${CreatedIncidentID}
      level: {}
      name: {}
      notstatus: {}
      owner: {}
      page: {}
      query: {}
      reason: {}
      size: {}
      sort: {}
      status: {}
      toclosedate: {}
      todate: {}
      toduedate: {}
      type: {}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 450,
          "y": 955
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "7":
    id: "7"
    taskid: a4680974-c3d8-4680-8024-1fea9d876fad
    type: condition
    task:
      id: a4680974-c3d8-4680-8024-1fea9d876fad
      version: -1
      name: Verify ReportSent is set
      description: Check if a given value exists in the context. Will return 'no'
        for empty empty arrays. To be used mostly with DQ and selectors.
      scriptName: Exists
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "8"
      "yes":
      - "3"
    scriptarguments:
      value:
        simple: ${foundIncidents.labels(val.type == 'ReportSent').value}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1100
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "8":
    id: "8"
    taskid: a69dc209-8061-4f99-8197-68e41169aed6
    type: regular
    task:
      id: a69dc209-8061-4f99-8197-68e41169aed6
      version: -1
      name: Print Error
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: Failed verifying that ReportSent is set on the incident
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 910,
          "y": 1270
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
  "9":
    id: "9"
    taskid: 0357042f-8fb3-434b-8f31-3eae446ff778
    type: regular
    task:
      id: 0357042f-8fb3-434b-8f31-3eae446ff778
      version: -1
      name: Wait 2 seconds
      description: Sleep for X seconds
      scriptName: Sleep
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "1"
    scriptarguments:
      seconds:
        simple: "2"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 450,
          "y": 660
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 1315,
        "width": 840,
        "x": 450,
        "y": 50
      }
    }
  }
inputs: []
outputs: []
