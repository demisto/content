commonfields:
  id: emailFieldTriggered
  version: -1
name: emailFieldTriggered
script: >
  // pack version: 1.19.29

  var users = executeCommand('getUsers', {});

  var email;

  for (var i = 0; i < users[0].Contents.length; i++) {
      if (incidents[0].owner === users[0].Contents[i].name || incidents[0].owner === users[0].Contents[i].username) {
          email = users[0].Contents[i].email;
          break;
      }
  }

  if (email) {
      var body = 'Hello,\nField ' + args.name + ' was changed from ' + args.old + ' to ' + args.new + ' in incident ' + incidents[0].name + '.\n--DBot';
      var subject = 'Field ' + args.name + ' was triggered';
      executeCommand('send-mail', {'to':email, 'subject':subject, 'body':body});
  }
type: javascript
tags:
- field-change-triggered
comment: Sends email to incident owner when selected field is triggered.
enabled: true
dependson:
  must:
  - send-mail
scripttarget: 0
fromversion: 5.0.0
marketplaces:
- xsoar
- marketplacev2
- platform
tests:
- No tests
