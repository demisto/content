commonfields:
  id: JSONtoCSV
  version: -1
name: JSONtoCSV
script: |-
  import json

  json_ent = demisto.executeCommand('getEntry', {'id': demisto.args()['entryid']})
  dictlist = json_ent[0]['Contents']
  delim = demisto.args()['delimiter']

  newline = "\n"
  csv_out = ""
  count = 0

  for d in dictlist:

  #get CSV column names and add delim
      if count == 0:
          for k, v in d.items():
              csv_out += k + delim
  #remove last delim
              csv_out = csv_out[:-len(delim)]
  #add newline for next row
          csv_out += newline
          count += 1

  #get values and add delim
      for k, v in d.items():
          csv_out += v + delim
  #remove last delim
      csv_out = csv_out[:-len(delim)]
  #add newline for next row
      csv_out += newline

  if 'filename' in demisto.args():
      #outout cvs to file in warrrom
      demisto.results(fileResult(demisto.args()['filename'],csv_out.encode("utf-8")))
  else:
      #outout cvs to warrrom
      demisto.results(csv_out.encode("utf-8"))
type: python
tags: []
comment: Convert a JSON warroom output via EntryID to a CSV file.
enabled: true
args:
- name: entryid
  required: true
  description: entry id of json
- name: delimiter
  default: true
  description: CSV Delimiter.
  defaultValue: '|'
- name: filename
  description: if provided will output CSV to file. Default output is to WarRoom.
scripttarget: 0
runonce: false
