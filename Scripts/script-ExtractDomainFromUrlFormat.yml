commonfields:
  id: ExtractDomainFromUrlAndEmail
  version: -1
name: ExtractDomainFromUrlAndEmail
script: |-
  var extractHostname = function(url) {
      var hostname;
      if (url.indexOf("://") > -1) {
          hostname = url.split('/')[2];
      }
      else {
          hostname = url.split('/')[0];
      }
      hostname = hostname.split(':')[0];
      hostname = hostname.split('?')[0];
      return hostname;
  };

  var extractRootDomain = function(url) {
      var domain = extractHostname(url),
          splitArr = domain.split('.'),
          arrLen = splitArr.length;

      if (arrLen > 2) {
          domain = splitArr[arrLen - 2] + '.' + splitArr[arrLen - 1];
      }
      return domain;
  };


  var url = args.input;

  var emailStringRegex = emailRegex.toString().substring(1,(emailRegex.toString().length - 1));
  var gmi = 'gmi';
  var reg = new RegExp(emailStringRegex, gmi);
  var email = reg.exec(url);
  if ((email) && (email.length>0)){
      return email[0].replace(/.*@/, "");
  }
  return extractRootDomain(url);
type: javascript
tags:
- indicator-format
enabled: true
args:
- name: input
  required: true
  default: true
  description: The URL or Email to process
scripttarget: 0
comment: Extract Domain from a URL or Email
