commonfields:
  id: IncidentToContext
  version: -1
name: IncidentToContext
script: |-
  # These comments are required to make sure that all pre-defined labels are selectable in the playbook
  i = demisto.incidents()[0]
  incident_lables = i.pop('labels') if i.has_key('labels') else None
  for key in i.keys():
      demisto.setContext(key, i[key])
      if key == 'severity':
          # Setting initial score based on severity. Severity "Unknown" yields score 0.
          score = i['severity'] * 25
          demisto.setContext('score', score)

  if incident_lables:
      labels = {}
      for l in incident_lables:
          name = 'Label/' + l['type']
          labels[name] = [l['value']] + (labels[name] if name in labels else [])
      for k, v in labels.iteritems():
          demisto.setContext(k, v if len(v) > 1 else v[0])

  demisto.results('Incident context set')
type: python
tags:
- infra
comment: Inserts incident info and labels into context for use inside playbooks.
system: true
scripttarget: 0
dependson: {}
timeout: 0s
