.release-sdk:
  rules:
    - if: '$SDK_RELEASE == "true"'


trigger-nightlies:
  stage: trigger-nightlies
  extends:
    - .release-sdk
    - .default-job-settings
  variables:
    BRANCH_NAME: $BRANCH_NAME
    CONTENT_CI_TOKEN: $CONTENT_CI_TOKEN
    CONTENT_INTERNAL_DIST_TRIGGER_NIGHTLY: $CONTENT_INTERNAL_DIST_TRIGGER_NIGHTLY
    SLACK_CHANNEL: $SLACK_CHANNEL
    RELEASE_VERSION: $RELEASE_VERSION
    GITHUB_TOKEN: $GITHUB_TOKEN
  script:
    - echo $RELEASE_VERSION
#    - python3 ./Tests/sdk_release/create_release_branch.py -t $GITHUB_TOKEN -b $RELEASE_VERSION
    - export PIPELINE_ID=$(./Utils/gitlab_triggers/trigger_content_internal_dist_nightly_build.sh -ct $CONTENT_INTERNAL_DIST_TRIGGER_NIGHTLY -sdk $RELEASE_VERSION | jq .id)
    - echo $PIPELINE_ID
    - echo "test"
#    - ./Utils/gitlab_triggers/trigger_content_internal_dist_nightly_build.sh -ct $CONTENT_INTERNAL_DIST_TRIGGER_NIGHTLY
#    - python3 ./Tests/scripts/gitlab_slack_notifier_copy.py -s "${SLACK_TOKEN}" -t "test message"
#    - echo "test2"
#    - ./Utils/gitlab_triggers/trigger_content_nightly_build.sh -ct $CI_TOKEN
#    - ./Tests/sdk_release/create_release_branch.sh --release-branch $RELEASE_VERSION


wait-for-build-to-finish:
  stage: wait-for-build-to-finish
  extends:
    - .release-sdk
    - .default-job-settings
  dependencies:
    - trigger-nightlies
  variables:
    PIPELINE_ID: $PIPELINE_ID
  script:
    - python3 ./Tests/sdk_release/wait_for_pipeline.py -g "${PIPELINE_ID}" -p $PIPELINE_ID -pid 1738
