category: Case Management
commonfields:
  id: Dell Secureworks
  version: -1
configuration:
- defaultvalue: https://api.secureworks.com
  display: Server URL (e.g. https://api.secureworks.com)
  name: server
  required: true
  type: 0
- defaultvalue: ""
  display: Username
  name: credentials
  required: true
  type: 9
- defaultvalue: "false"
  display: Trust any certificate (unsecure)
  name: insecure
  required: false
  type: 8
- defaultvalue: "false"
  display: Use system proxy settings
  name: proxy
  required: false
  type: 8
- defaultvalue: ""
  display: Fetch incidents
  name: isFetch
  required: false
  type: 8
- defaultvalue: ""
  display: Fetch tickets matching to one of SERVICE_REQUEST, INCIDENT or CHANGE
  name: ticketType
  required: false
  type: 0
- defaultvalue: ""
  display: Limit tickets to one of REQUEST, CHANGE, HEALTH or SECURITY
  name: groupingType
  required: false
  type: 0
- defaultvalue: New
  display: 'Fetch tickets by status(comma separated): New,Active,Queued,Pending,Resolved'
  name: status
  required: false
  type: 0
- defaultvalue: ALL
  display: Whether to return worklogs - If "ALL," all worklogs are returned for each
    ticket. If "UPDATED", all worklogs added since last acknowledgement are returned.
    If "NONE," the path returns no worklogs. Default is "ALL."
  name: worklogs
  required: false
  type: 0
- defaultvalue: ""
  display: Incident type
  name: incidentType
  required: false
  type: 13
- defaultvalue: "false"
  display: Whether to get attachments for the fetched tickets
  name: attachments
  required: false
  type: 0
description: Provides access to the Secureworks CTP ticketing system
detaileddescription: |-
  In the SecureWorks web UI, under the API Credential, You can generate your API password.
  The API Key is provided by SecureWorks.
display: Dell Secureworks
image: data:image/png;base64,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
name: Dell Secureworks
script:
  commands:
  - arguments:
    - description: Client reference
      name: clientRef
      required: true
    - description: Client location reference
      name: clientLocationRef
    - description: Request type
      name: requestType
      required: true
    - description: Ticket title
      name: title
      required: true
    - description: External ticket
      name: externalTicket
    - description: Device reference
      name: deviceRef
    - description: Ticket details
      name: detail
      required: true
    - description: Ticket POC contact reference
      name: pocContactRef
      required: true
    - description: Ticket watchers
      name: watchers
    - description: Ticket attachments
      name: attachments
    - description: Ticket source
      name: source
    - description: Ticket assigned group dd
      name: assignedGroupId
    - description: Ticket assigned ticket 2
      name: assignedTicket2
    - description: Ticket partner
      name: partner
    - description: Ticket vendor
      name: vendor
    - auto: PREDEFINED
      description: Ticket risk assessment
      name: riskAssessment
      predefined:
      - UNDEFINED
      - NON
      - LOW
      - MEDIUM
      - HIGH
    - auto: PREDEFINED
      description: Ticket change slo
      name: changeSlo
      predefined:
      - STANDARD
      - SHARP
      - EXPEDITE
      - EMERGENCY
      - SHARP_EXPEDITE
    - description: Ticket change window start
      name: changeWindowStart
    - description: Ticket change window end
      name: changeWindowEnd
    - auto: PREDEFINED
      description: Ticket impact
      name: impact
      predefined:
      - LOW
      - MEDIUM
      - HIGH
      - CRITICAL
    - auto: PREDEFINED
      description: Ticket urgency
      name: urgency
      predefined:
      - LOW
      - MEDIUM
      - HIGH
      - CRITICAL
    - auto: PREDEFINED
      description: Ticket priority
      name: priority
      predefined:
      - LOW
      - MEDIUM
      - HIGH
      - UNKNOWN
    - description: Ticket custom field No.1
      name: customerMiscellaneous1
    - description: Ticket custom field No.2
      name: customerMiscellaneous2
    - description: Ticket custom field No.3
      name: customerMiscellaneous3
    - description: Ticket custom field No.4
      name: customerMiscellaneous4
    - description: Ticket categorization class
      name: categorizationClass
    - description: Ticket categorization category
      name: categorizationCategory
    - description: Ticket categorization type
      name: categorizationType
    - description: Ticket categorization item
      name: categorizationItem
    description: Create a new ticket
    name: secure-works-create-ticket
    outputs:
    - contextPath: SecureWorks.Ticket.ticketId
      description: Ticket ID in SecureWorks
      type: string
    - contextPath: SecureWorks.Ticket.CreationStatusCode
      description: Ticket creation status code
      type: string
  - arguments:
    - description: ID of the ticket to update
      name: id
      required: true
    - description: External ticket number
      name: externalTicketNum
    - description: External ticket number 2
      name: externalTicketNum2
    - description: External group name
      name: externalGroupName
    - description: ticket watchers
      name: watchers
    - description: ticket vendor
      name: vendor
    - description: Ticket custom field No.1
      name: customerMiscellaneous1
    - description: Ticket custom field No.2
      name: customerMiscellaneous2
    - description: Ticket custom field No.3
      name: customerMiscellaneous3
    - description: Ticket custom field No.4
      name: customerMiscellaneous4
    description: Update an existing ticket
    name: secure-works-update-ticket
    outputs:
    - contextPath: SecureWorks.Ticket.ticketId
      description: Ticket ID in SecureWorks
      type: string
    - contextPath: SecureWorks.Ticket.UpdateStatusCode
      description: Ticket update status code
      type: string
  - arguments:
    - description: The Ticket ID of the ticket that you want the details for.
      name: id
      required: true
    - description: The work log message describing why you are closing the ticket
      name: worklogContent
    - auto: PREDEFINED
      description: The reason code to use when closing the ticket
      name: closeCode
      predefined:
      - Mitigated by Security Controls
      - Authorized/Expected
      - Inconclusive
      - True Positive
      - False Positive
      - Not Relevant
      - Duplicate - Previously Escalated
      - Work Completed
      required: true
    description: Close a ticket
    name: secure-works-close-ticket
    outputs:
    - contextPath: SecureWorks.Ticket.ticketId
      description: Ticket ID in SecureWorks
      type: string
    - contextPath: SecureWorks.Ticket.ClosureStatusCode
      description: Ticket closure status code
      type: string
  - arguments:
    - description: The work log message
      name: content
      required: true
    - description: ID of the ticket to add worklogs to
      name: id
      required: true
    description: Add worklog to a ticket
    name: secure-works-add-worklogs-ticket
    outputs:
    - contextPath: SecureWorks.Ticket.ticketId
      description: Ticket ID in SecureWorks
      type: string
    - contextPath: SecureWorks.Ticket.WorklogAdditionStatusCode
      description: Ticket worklog addition status code
      type: string
  - arguments:
    - description: The Ticket ID of the ticket that you want the details for.
      name: id
      required: true
    - auto: PREDEFINED
      description: Whether or not to include ticket worklogs, default is true
      name: includeWorklogs
      predefined:
      - "true"
      - "false"
    - description: Whether or not to get ticket attachments
      name: getAttachments
    description: Get the details of a specific ticket, by ID
    name: secure-works-get-ticket
    outputs:
    - contextPath: SecureWorks.Ticket.changeApproval
      description: Ticket change approval
      type: string
    - contextPath: SecureWorks.Ticket.attachmentInfo.id
      description: Ticket attachment info ID
      type: string
    - contextPath: SecureWorks.Ticket.changeSlo
      description: Ticket change service level objective
      type: string
    - contextPath: SecureWorks.Ticket.changeWindowStart
      description: Ticket change window start
      type: number
    - contextPath: SecureWorks.Ticket.changeWindowEnd
      description: Ticket change window end
      type: number
    - contextPath: SecureWorks.Ticket.client.id
      description: Ticket client ID
      type: string
    - contextPath: SecureWorks.Ticket.client.name
      description: Ticket client name
      type: string
    - contextPath: SecureWorks.Ticket.contact.id
      description: Ticket contact ID
      type: string
    - contextPath: SecureWorks.Ticket.contact.name
      description: Ticket contact name
      type: string
    - contextPath: SecureWorks.Ticket.dateCreated
      description: Ticket creation time
      type: number
    - contextPath: SecureWorks.Ticket.dateClosed
      description: Ticket closing time
      type: number
    - contextPath: SecureWorks.Ticket.dateModified
      description: Ticket modified
      type: number
    - contextPath: SecureWorks.Ticket.detailedDescription
      description: Ticket detailed description
      type: string
    - contextPath: SecureWorks.Ticket.devices.id
      description: Ticket device ID
      type: string
    - contextPath: SecureWorks.Ticket.devices.name
      description: Ticket device name
      type: string
    - contextPath: SecureWorks.Ticket.impact
      description: Ticket impact
      type: string
    - contextPath: SecureWorks.Ticket.clientLocation.id
      description: Ticket client location ID
      type: string
    - contextPath: SecureWorks.Ticket.partner
      description: Ticket partner
      type: string
    - contextPath: SecureWorks.Ticket.priority
      description: Ticket priority
      type: string
    - contextPath: SecureWorks.Ticket.reason
      description: Ticket closure reason
      type: string
    - contextPath: SecureWorks.Ticket.requestType
      description: Ticket request type
      type: string
    - contextPath: SecureWorks.Ticket.riskAssessment
      description: Ticket risk assessment
      type: string
    - contextPath: SecureWorks.Ticket.service
      description: Ticket service
      type: string
    - contextPath: SecureWorks.Ticket.status
      description: Ticket status
      type: string
    - contextPath: SecureWorks.Ticket.symptomDescription
      description: Ticket symptom description
      type: string
    - contextPath: SecureWorks.Ticket.ticketId
      description: Ticket ID
      type: string
    - contextPath: SecureWorks.Ticket.type
      description: Ticket type
      type: string
    - contextPath: SecureWorks.Ticket.urgency
      description: Ticket urgency
      type: string
    - contextPath: SecureWorks.Ticket.watchers
      description: Ticket watchers
      type: unknown
    - contextPath: SecureWorks.Ticket.category
      description: Ticket category
      type: string
    - contextPath: SecureWorks.Ticket.categoryClass
      description: Ticket category class
      type: string
    - contextPath: SecureWorks.Ticket.categoryType
      description: Ticket category class
      type: string
    - contextPath: SecureWorks.Ticket.categoryItem
      description: Ticket category item
      type: string
    - contextPath: SecureWorks.Ticket.attachmentInfo.name
      description: Ticket attachment name
      type: string
    - contextPath: SecureWorks.Ticket.clientLocation.name
      description: Ticket client location name
      type: string
    - contextPath: SecureWorks.Ticket.worklogs.createdBy
      description: Ticket worklog creator
      type: string
    - contextPath: SecureWorks.Ticket.worklogs.dateCreated
      description: Ticket worklog creation date
      type: number
    - contextPath: SecureWorks.Ticket.worklogs.description
      description: Ticket worklog description
      type: string
    - contextPath: SecureWorks.Ticket.worklogs.type
      description: Ticket worklog type
      type: string
    - contextPath: SecureWorks.Ticket.closeCodes
      description: Ticket close codes
      type: unknown
    - contextPath: File.Info
      description: Attachment file info
      type: unknown
    - contextPath: File.Name
      description: Attachment file name
      type: string
    - contextPath: File.Size
      description: Attachment file size
      type: number
    - contextPath: File.SHA1
      description: Attachment file SHA1
      type: string
    - contextPath: File.SHA256
      description: Attachment file SHA256
      type: string
    - contextPath: File.EntryID
      description: Attachment file entry ID
      type: string
    - contextPath: File.Type
      description: Attachment file type
      type: string
    - contextPath: File.MD5
      description: Attachment file MD5
      type: string
  - arguments:
    - description: The id of the ticket that you want to assign to the SOC
      name: id
      required: true
    - description: Ticket worklog
      name: worklog
      required: true
    - auto: PREDEFINED
      description: Valid for Change tickets only
      name: riskAssessment
      predefined:
      - UNDEFINED
      - NONE
      - LOW
      - MEDIUM
      - HIGH
    - auto: PREDEFINED
      description: Valid for Change tickets only
      name: changeApproval
      predefined:
      - PM_FULLY_APPROVED
      - PM_RFC
      - PM_RFC_NON_EP
      - PM_COST_NON_EP
      - PM_PEND_COST
      - PM_COST
      - PM_PEND_RFC
      - PM_PEND_RFC_AND_COST
    description: Assign a ticket to the Secureworks Security Operations Center (SOC)
    name: secure-works-assign-ticket
    outputs:
    - contextPath: SecureWorks.Ticket.ticketId
      description: Ticket ID in SecureWorks
    - contextPath: SecureWorks.Ticket.AssignStatusCode
      description: Ticket assign status code
  - arguments:
    - description: A maximum number of tickets to be returned (default 10), between
        1 and 500
      name: limit
    - auto: PREDEFINED
      description: Tickets matching the ticketType. If not specified, the path returns
        all ticket types
      name: ticketType
      predefined:
      - SERVICE_REQUEST
      - INCIDENT
      - CHANGE
    - auto: PREDEFINED
      description: If "ALL," all worklogs are returned for each ticket. If "UPDATED",
        all worklogs added since last acknowledgement are returned. If "NONE," the
        path returns no worklogs. Default is "ALL."
      name: worklogs
      predefined:
      - ALL
      - NONE
      - UPDATED
    - auto: PREDEFINED
      description: If provided, limit response to tickets matching the grouping type(s)
        identified
      name: groupingType
      predefined:
      - REQUEST
      - CHANGE
      - HEALTH
      - SECURITY
    - auto: PREDEFINED
      defaultValue: "false"
      description: Whether to acknowledge the received tickets, default false
      name: acknowledge
      predefined:
      - "true"
      - "false"
    description: Retrieves tickets from 24 hours prior to when the updates command
      is executed. If a limit is specified, it will retrieve up to that many tickets
      (max is 500 tickets). Tickets must be updated within the last 24 hours to be
      visible in the command results. When executing this command you also receive
      the ticket worklogs. In order to view the attachment information of a specific
      ticket, you must use the get-ticket command. This command will return the list
      of attachments available for that particular ticket. Use acknowledge to confirm
      the updates.
    name: secure-works-get-tickets-updates
    outputs:
    - contextPath: SecureWorks.Ticket.changeApproval
      description: Ticket change approval
    - contextPath: SecureWorks.Ticket.attachmentInfo.id
      description: Ticket attachment info ID
    - contextPath: SecureWorks.Ticket.changeSlo
      description: Ticket change service level objective
    - contextPath: SecureWorks.Ticket.changeWindowStart
      description: Ticket change window start
    - contextPath: SecureWorks.Ticket.changeWindowEnd
      description: Ticket change window end
    - contextPath: SecureWorks.Ticket.client.id
      description: Ticket client ID
    - contextPath: SecureWorks.Ticket.client.name
      description: Ticket client name
    - contextPath: SecureWorks.Ticket.contact.id
      description: Ticket contact ID
    - contextPath: SecureWorks.Ticket.contact.name
      description: Ticket contact name
    - contextPath: SecureWorks.Ticket.dateCreated
      description: Ticket creation time
    - contextPath: SecureWorks.Ticket.dateClosed
      description: Ticket closing time
    - contextPath: SecureWorks.Ticket.dateModified
      description: Ticket modified
    - contextPath: SecureWorks.Ticket.detailedDescription
      description: Ticket detailed description
    - contextPath: SecureWorks.Ticket.devices.id
      description: Ticket device ID
    - contextPath: SecureWorks.Ticket.devices.name
      description: Ticket device name
    - contextPath: SecureWorks.Ticket.impact
      description: Ticket impact
    - contextPath: SecureWorks.Ticket.clientLocation.id
      description: Ticket client location ID
    - contextPath: SecureWorks.Ticket.partner
      description: Ticket partner
    - contextPath: SecureWorks.Ticket.priority
      description: Ticket priority
    - contextPath: SecureWorks.Ticket.reason
      description: Ticket closure reason
    - contextPath: SecureWorks.Ticket.requestType
      description: Ticket request type
    - contextPath: SecureWorks.Ticket.riskAssessment
      description: Ticket risk assessment
    - contextPath: SecureWorks.Ticket.service
      description: Ticket service
    - contextPath: SecureWorks.Ticket.status
      description: Ticket status
    - contextPath: SecureWorks.Ticket.symptomDescription
      description: Ticket symptom description
    - contextPath: SecureWorks.Ticket.ticketId
      description: Ticket ID
    - contextPath: SecureWorks.Ticket.type
      description: Ticket type
    - contextPath: SecureWorks.Ticket.urgency
      description: Ticket urgency
    - contextPath: SecureWorks.Ticket.watchers
      description: Ticket watchers
    - contextPath: SecureWorks.Ticket.category
      description: Ticket category
    - contextPath: SecureWorks.Ticket.categoryClass
      description: Ticket category class
    - contextPath: SecureWorks.Ticket.categoryType
      description: Ticket category class
    - contextPath: SecureWorks.Ticket.categoryItem
      description: Ticket category item
    - contextPath: SecureWorks.Ticket.attachmentInfo.name
      description: Ticket attachment name
    - contextPath: SecureWorks.Ticket.clientLocation.name
      description: Ticket client location name
    - contextPath: SecureWorks.Ticket.worklogs.createdBy
      description: Ticket worklog creator
    - contextPath: SecureWorks.Ticket.worklogs.dateCreated
      description: Ticket worklog creation date
    - contextPath: SecureWorks.Ticket.worklogs.description
      description: Ticket worklog description
    - contextPath: SecureWorks.Ticket.worklogs.type
      description: Ticket worklog type
    - contextPath: SecureWorks.Ticket.closeCodes
      description: Ticket close codes
  - arguments:
    - description: The ID of the ticket
      name: id
      required: true
    description: Returns a list of close codes for a ticket
    name: secure-works-get-close-codes
    outputs:
    - contextPath: SecureWorks.Ticket.ticketID
      description: Ticket ID
      type: string
    - contextPath: SecureWorks.Ticket.closeCodes
      description: Ticket close codes
      type: unknown
  - arguments:
    - auto: PREDEFINED
      description: Tickets matching the ticketType. If not specified, the path returns
        all ticket types
      name: ticketType
      predefined:
      - SERVICE_REQUEST
      - INCIDENT
      - CHANGE
    - description: If provided, limit response to that number of tickets. If not provided,
        a maximum of 10 tickets are returned
      name: limit
    - auto: PREDEFINED
      description: If provided, limit response to tickets matching the grouping type(s)
        identified
      name: groupingType
      predefined:
      - REQUEST
      - CHANGE
      - HEALTH
      - SECURITY
    description: Get a list of ticket IDs in the same order as the tickets returned
      by the GET /tickets/updates command.
    name: secure-works-get-tickets-ids
    outputs:
    - contextPath: SecureWorks.IDs
      description: The ticket IDs
  - arguments:
    - auto: PREDEFINED
      description: The ticket type to filter
      name: ticketType
      predefined:
      - SERVICE_REQUEST
      - INCIDENT
      - CHANGE
    description: Retrieve a count of tickets that have been updated and not yet acknowledged
    name: secure-works-get-ticket-count
    outputs:
    - contextPath: SecureWorks.TicketCount
      description: The ticket count
      type: number
  isfetch: true
  runonce: false
  script: |-
    var SERVER_URL = params.server.replace(/[\/]+$/, '') + '/api/ticket/v3/';
    var EVENT_SOURCE_HEALTH_TYPE = "CTP_HEALTH";
    var CATEGORIZATION_CLASS_HEALTH_TYPE = "Health";
    var MAX_LIMIT = 500;
    // The following is the designated field to mark fetched tickets with
    var DIRTY_FIELD = 'customerMiscellaneous4';
    var DIRTY_VALUE = 'MARKED';


    function sendRequest(path, method, queryParams, body){
        var query = '';
        if(queryParams){
            query = encodeToURLQuery(queryParams);
        }

        var url = SERVER_URL.concat(path, query);

        var res = http(
            url,
            {
                Method: method ? method : 'GET',
                Headers: {
                    'Authorization': [ 'APIKEY ' + params.credentials.identifier + ':' + params.credentials.password],
                    'Content-Type': ['application/json'],
                },
                Body: body ? JSON.stringify(body) : body
            },
            params.insecure,
            params.proxy
        );
        if (res.StatusCode < 200 || res.StatusCode >= 300) {
            throw 'Failed on request ' + url + ' , request status code: ' + res.StatusCode + ' and Body: ' + res.Body + '.';
        }
        return JSON.parse(res.Body);
    }

    function convertTicketDates(response){
        if(!(response instanceof Array)){
            response = [response];
        }

        response.forEach(function(element){
            element.dateCreated = new Date(element.dateCreated).toString();
            element.dateModified = element.dateModified ? new Date(element.dateModified).toString() : '';
            element.dateClosed = element.dateClosed ? new Date(element.dateClosed).toString() : '';
        });
    }

    function createTicketCommand(){
        var response = createTicket(args.clientRef,
        args.clientLocationRef,
        args.requestType,
        args.title,
        args.externalTicket,
        args.deviceRef,
        args.detail,
        args.pocContactRef,
        args.watchers,
        args.attachments,
        args.source,
        args.assignedGroupId,
        args.assignedTicket2,
        args.partner,
        args.vendor,
        args.riskAssessment,
        args.changeSlo,
        args.changeWindowStart,
        args.changeWindowEnd,
        args.impact,
        args.urgency,
        args.priority,
        args.customerMiscellaneous1,
        args.customerMiscellaneous2,
        args.customerMiscellaneous3,
        args.customerMiscellaneous4,
        args.categorizationClass,
        args.categorizationCategory,
        args.categorizationType,
        args.categorizationItem);

        if(!response || !response.ticketID){
            return 'No data returned';
        }

        var translator = [
            {to: 'ticketId', from: 'ticketID'},
            {to: 'CreationStatusCode', from: 'code'}
        ];

        var entry = {
            Type: entryTypes.note,
            Contents: response,
            ContentsFormat: formats.json
        };

        var translated = cleanObject(mapObjFunction(translator)(response));
        entry.ReadableContentsFormat = formats.markdown;
        entry.HumanReadable = tableToMarkdown('Secure works create ticket response' , translated, Object.keys(translated));
        entry.EntryContext = {
            'SecureWorks.Ticket(val.ticketId==obj.ticketId)': translated
        };

        return entry;
    }

    function createTicket(
        clientRef,
        clientLocationRef,
        requestType,
        title,
        externalTicket,
        deviceRef,
        detail,
        pocContactRef,
        watchers,
        attachments,
        source,
        assignedGroupId,
        assignedTicket2,
        partner,
        vendor,
        riskAssessment,
        changeSlo,
        changeWindowStart,
        changeWindowEnd,
        impact,
        urgency,
        priority,
        customerMiscellaneous1,
        customerMiscellaneous2,
        customerMiscellaneous3,
        customerMiscellaneous4,
        categorizationClass,
        categorizationCategory,
        categorizationType,
        categorizationItem){

        var ticketBody = {};

        if(clientRef){
            ticketBody.clientRef = clientRef;
        }

        if(clientLocationRef){
            ticketBody.clientLocationRef = clientLocationRef;
        }

        if(requestType){
            ticketBody.requestType = requestType;
        }

        if(title){
            ticketBody.title = title;
        }

        if(externalTicket){
            ticketBody.externalTicket = externalTicket;
        }

        if(deviceRef){
            ticketBody.deviceRef = deviceRef;
        }

        if(detail){
            ticketBody.detail = detail;
        }

        if(pocContactRef){
            ticketBody.pocContactRef = pocContactRef;
        }

        if(watchers){
            ticketBody.watchers = watchers;
        }

        if(attachments){
            ticketBody.attachments = attachments;
        }

        if(source){
            ticketBody.source = source;
        }

        if(assignedGroupId){
            ticketBody.assignedGroupId = assignedGroupId;
        }

        if(assignedTicket2){
            ticketBody.assignedTicket2 = assignedTicket2;
        }

        if(partner){
            ticketBody.partner = partner;
        }

        if(vendor){
            ticketBody.vendor = vendor;
        }

        if(riskAssessment){
            ticketBody.riskAssessment = riskAssessment;
        }

        if(changeSlo){
            ticketBody.changeSlo = changeSlo;
        }

        if(changeWindowStart){
            ticketBody.changeWindowStart = changeWindowStart;
        }

        if(changeWindowEnd){
            ticketBody.changeWindowEnd = changeWindowEnd;
        }

        if(impact){
            ticketBody.impact = impact;
        }

        if(urgency){
            ticketBody.urgency = urgency;
        }

        if(priority){
            ticketBody.priority = priority;
        }

        if(customerMiscellaneous1){
            ticketBody.customerMiscellaneous1 = customerMiscellaneous1;
        }

        if(customerMiscellaneous2){
            ticketBody.customerMiscellaneous2 = customerMiscellaneous2;
        }

        if(customerMiscellaneous3){
            ticketBody.customerMiscellaneous3 = customerMiscellaneous3;
        }

        if(customerMiscellaneous4){
            ticketBody.customerMiscellaneous4 = customerMiscellaneous4;
        }

        if(categorizationClass){
            ticketBody.categorizationClass = categorizationClass;
        }

        if(categorizationCategory){
            ticketBody.categorizationCategory = categorizationCategory;
        }

        if(categorizationType){
            ticketBody.categorizationType = categorizationType;
        }

        if(categorizationItem){
            ticketBody.categorizationItem = categorizationItem;
        }

        var response = sendRequest('tickets', 'POST', '', ticketBody);

        return response;
    }

    function updateTicketCommand(){
        var id = args['id'];
        var response = updateTicket(id,
                          args.externalTicketNum,
                          args.externalTicketNum2,
                          args.externalGroupName,
                          args.watchers,
                          args.vendor,
                          args.customerMiscellaneous1,
                          args.customerMiscellaneous2,
                          args.customerMiscellaneous3,
                          args.customerMiscellaneous4);

        if(!response){
            return 'No data returned';
        }

        var translator = [
            {to: 'UpdateStatusCode', from: 'code'},
            {to: 'ticketId', from: 'ticketID'}
        ];

        var entry = {
            Type: entryTypes.note,
            Contents: response,
            ContentsFormat: formats.json
        };

        var translated = cleanObject(mapObjFunction(translator)(response));
        entry.ReadableContentsFormat = formats.markdown;
        entry.HumanReadable = tableToMarkdown('Secure works update ticket response' , translated);
        entry.EntryContext = {
            'SecureWorks.Ticket(val.ticketId==obj.ticketId)': translated
        };

        return entry;
    }

    function updateTicket(ticketId,
                          externalTicketNum,
                          externalTicketNum2,
                          externalGroupName,
                          watchers,
                          vendor,
                          customerMiscellaneous1,
                          customerMiscellaneous2,
                          customerMiscellaneous3,
                          customerMiscellaneous4) {

        var updateBody = {};

        if(externalTicketNum){
            updateBody.externalTicketNum = externalTicketNum;
        }

        if(externalTicketNum2){
            updateBody.externalTicketNum2 = externalTicketNum2;
        }

        if(externalGroupName){
            updateBody.externalGroupName = externalGroupName;
        }

        if(watchers){
            updateBody.watchers = watchers;
        }

        if(vendor){
            updateBody.vendor = vendor;
        }

        if(customerMiscellaneous1){
            updateBody.customerMiscellaneous1 = customerMiscellaneous1;
        }

        if(customerMiscellaneous2){
            updateBody.customerMiscellaneous2 = customerMiscellaneous2;
        }

        if(customerMiscellaneous3){
            updateBody.customerMiscellaneous3 = customerMiscellaneous3;
        }

        if(customerMiscellaneous4){
            updateBody.customerMiscellaneous4 = customerMiscellaneous4;
        }

        var response = sendRequest('tickets/' + ticketId, 'POST', '', updateBody);

        return response;
    }

    function getTicketCountCommand(){
        var countObject = getTicketCount(args.ticketType);

        var translator = [
            {to: 'TicketCount', from: 'ticketCount'}
        ];

        var entry = {
            Type: entryTypes.note,
            Contents: countObject,
            ContentsFormat: formats.json
        };

        var translated = mapObjFunction(translator)(countObject);
        entry.ReadableContentsFormat = formats.markdown;
        entry.HumanReadable = tableToMarkdown('Secure works get ticket count response' , translated);
        entry.EntryContext = {
            'SecureWorks.TicketCount': countObject.ticketCount
        }

        return entry;
    }

    function getTicketCount(ticketType){
        var queryParams = {}

        if(ticketType){
            queryParams.ticketType = ticketType;
        }

        var response = sendRequest('tickets/count', 'POST', queryParams);

        return response;
    }

    function assignTicketCommand(){
        var id = args['id'];
        var response = assignTicket(id,
                args.worklog,
                args.riskAssessment,
                args.changeApproval);

        if(!response){
            return 'No data returned';
        }

        var data = response.assignTicketToSoc;

        var translator = [
            {to: 'AssignStatusCode', from: 'code'},
            {to: 'ticketId', from: 'ticketId'}
        ];

        var entry = {
            Type: entryTypes.note,
            Contents: data,
            ContentsFormat: formats.json
        };

        var translated = cleanObject(mapObjFunction(translator)(data));
        entry.ReadableContentsFormat = formats.markdown;
        entry.HumanReadable = tableToMarkdown('Secure works assign ticket response' , translated);
        entry.EntryContext = {
            'SecureWorks.Ticket(val.ticketId==obj.ticketId)': translated
        };

        return entry;
    }

    function assignTicket(id,
                worklog,
                riskAssessment,
                changeApproval){

        var assignBody = {};

        if(worklog){
            assignBody.worklog = worklog;
        }

        if(riskAssessment){
            assignBody.riskAssessment = riskAssessment;
        }

        if(changeApproval){
            assignBody.changeApproval = changeApproval;
        }

        var response = sendRequest('tickets/' + id + '/assign', 'POST', '', assignBody);

        return response;
    }

    function closeTicketCommand(){
        var id = args['id'];
        var response = closeTicket(id, args.worklogContent, args.closeCode);

        if(!response){
            return 'No data returned';
        }

        var ticket = getTicket(id);

        var translator = [
            {to: 'ClosureStatusCode', from: 'code'},
            {to: 'ticketId', from: 'ticketID'}
        ];

        var entry = {
            Type: entryTypes.note,
            Contents: response,
            ContentsFormat: formats.json
        };

        var translated = cleanObject(mapObjFunction(translator)(response));
        entry.ReadableContentsFormat = formats.markdown;
        entry.HumanReadable = tableToMarkdown('Secure works close ticket response' , translated);
        entry.EntryContext = {
            'SecureWorks.Ticket(val.ticketId==obj.ticketId)': translated
        };

        return entry;
    }

    function closeTicket(id,
            worklogContent,
            closeCode){

        closeBody = {};

        if(worklogContent){
            closeBody.worklogContent = worklogContent;
        }

        if(closeCode){
            closeBody.closeCode = closeCode;
        }

        var response = sendRequest('tickets/' + id + '/close', 'POST', '', closeBody);

        return response;
    }

    function addTicketWorklogCommand(){
        var id = args['id'];
        var response = addTicketWorklog(id, args.content);

        if(!response){
            return 'No data returned';
        }

        var translator = [
            {to: 'WorklogAdditionStatusCode', from: 'code'},
            {to: 'ticketId', from: 'ticketId'}
        ];

        var entry = {
            Type: entryTypes.note,
            Contents: response,
            ContentsFormat: formats.json
        };

        var translated = cleanObject(mapObjFunction(translator)(response));
        entry.ReadableContentsFormat = formats.markdown;
        entry.HumanReadable = tableToMarkdown('Secure works add ticket worklog response' , translated);
        entry.EntryContext = {
            'SecureWorks.Ticket(val.ticketId==obj.ticketId)': translated
        };

        return entry;
    }

    function addTicketWorklog(id, content) {
        var worklogBody = {content: content};

        var response = sendRequest('tickets/' + id + '/worklogs', 'POST', '', worklogBody);

        return response;
    }

    function getTicketCommand() {
        var ticket = getTicket(args['id'], args.includeWorklogs);

        if(!ticket){
            return 'No data returned';
        }

        convertTicketDates(ticket);

        var translator = [
            {to: 'ID', from: 'ticketId'},
            {to: 'Subject', from: 'symptomDescription'},
            {to: 'Description', from: 'detailedDescription'},
            {to: 'Status', from: 'status'},
            {to: 'Created', from: 'dateCreated'},
            {to: 'Updated', from: 'dateModified'},
            {to: 'Closed', from: 'dateClosed'},
            {to: 'Priority', from: 'priority'},
            {to: 'Reference', from: 'externalTicketNum'},
            {to: 'Location', from: 'clientLocation.name'},
            {to: 'Categorization', from: 'categorizationClass'},
            {to: 'Device', from: 'devices.name'},
            {to: 'Assigned Employee', from: 'contact.name'},
            {to: 'Watchers', from: 'watchers'},
            {to: 'AttachmentInfo', from: 'attachmentInfo.name'},
            {to: 'Type', from: 'groupingType'},
        ];

        if(ticket.worklogs){
            convertTicketDates(ticket.worklogs);
            var worklogTranslator = [
                {to: 'Created', from: 'dateCreated'},
                {to: 'Description', from: 'description'},
                {to: 'Type', from: 'type'}
            ];
            var worklogsTranslated = cleanObject(mapObjFunction(worklogTranslator)(ticket.worklogs));
        }

        entries = [];
        if(args.getAttachments === 'true'){
            entries = getTicketAttachmentsEntries(ticket);
        }

        var entry = {
            Type: entryTypes.note,
            Contents: ticket,
            ContentsFormat: formats.json
        };

        var translated = cleanObject(mapObjFunction(translator)(ticket));
        var md = tableToMarkdown('Secure works get ticket response', translated, Object.keys(translated));
        md += (worklogsTranslated && worklogsTranslated.length > 0) ? tableToMarkdown('Worklogs', worklogsTranslated) : '';
        entry.ReadableContentsFormat = formats.markdown;
        entry.HumanReadable = md,
        entry.EntryContext = {
            'SecureWorks.Ticket(val.ticketId==obj.ticketId)': ticket
        };

        entries.push(entry);

        return entries;
    }

    function getTicket(ticketId, includeWorklogs) {
        var queryParams = {};
        if(includeWorklogs){
            queryParams.includeWorklogs = includeWorklogs;
        }
        var response = sendRequest('tickets/' + ticketId, 'GET', queryParams);

        return response;
    }


    function getTicketAttachmentsEntries(ticket) {
        var entries = [];
        if(!ticket.attachmentInfo || ticket.attachmentInfo.length === 0){
            return entries;
        }

        ticket.attachmentInfo.forEach(function(attachment) {
            var response = sendRequest('tickets/' + ticket.ticketId + '/attachments/' + attachment.id);
            if(response && response.attachment){
                entry = {
                    Type: entryTypes.file,
                    FileID: saveFile(atob(response.attachment.content)),
                    File: response.attachment.filename,
                    Contents: response.attachment.filename
                };

                entries.push(entry);
            }
        });

        return entries;
    }

    function getTicketsIdsCommand() {
            var response = getTicketsIds(args.ticketType, args.limit, args.groupingType);

            if(!response || !response.ticketIds || response.ticketIds.length === 0){
                return 'No ids returned';
            }

            var translator = [
                {to: 'IDs', from: 'ticketIds'}
            ];

            var entry = {
                Type: entryTypes.note,
                Contents: response,
                ContentsFormat: formats.json
            };

            var translated = cleanObject(mapObjFunction(translator)(response));
            entry.ReadableContentsFormat = formats.markdown;
            entry.HumanReadable = tableToMarkdown('Secure works get tickets ids response' , translated);
            entry.EntryContext = {
              'SecureWorks.IDs': response.ticketIds
            };

            return entry;
        }

    function getTicketsIds(ticketType, limit, groupingType) {
        var queryParams = {}

        if(ticketType){
            queryParams.ticketType = ticketType;
        }

        if(limit){
            queryParams.limit = limit;
        }

        if(groupingType){
            queryParams.groupingType = groupingType;
        }

        var response = sendRequest('tickets/ids', 'POST', queryParams);

        return response;
    }

    function getTicketsUpdatesCommand() {
        var tickets = getTicketsUpdates(
        args.acknowledge,
        args.limit,
        args.ticketType,
        args.worklogs,
        args.groupingType);

        if(!tickets || tickets.length == 0){
            return 'No results found';
        }

        convertTicketDates(tickets);

        var translator = [
            {to: 'ID', from: 'ticketId'},
            {to: 'Reference', from: 'externalTicketNum'},
            {to: 'Created', from: 'dateCreated'},
            {to: 'Status', from: 'status'},
            {to: 'Subject', from: 'symptomDescription'},
            {to: 'Devices', from: 'devices.name'},
            {to: 'Assigned Employee', from: 'contact.name'},
            {to: 'Updated', from: 'dateModified'},
            {to: 'Closed', from: 'dateClosed'},
        ];

        var entry = {
            Type: entryTypes.note,
            Contents: tickets,
            ContentsFormat: formats.json
        };

        var translated = cleanObject(mapObjFunction(translator)(tickets));
        entry.ReadableContentsFormat = formats.markdown;
        entry.HumanReadable = tableToMarkdown('Secure works get tickets updates response', translated, Object.keys(translated[0]));
        entry.EntryContext = {
            'SecureWorks.Ticket(val.ticketId==obj.ticketId)': tickets
        };

        return entry;
    }

    function getTicketsUpdates(acknowledge,
        limit,
        ticketType,
        worklogs,
        groupingType) {

        var queryParams = {};
        if(limit){
            queryParams.limit = limit;
        }

        if(ticketType){
            queryParams.ticketType = ticketType;
        }

        if(worklogs){
            queryParams.worklogs = worklogs;
        }

        if(groupingType){
            queryParams.groupingType = groupingType;
        }

        var response = sendRequest('tickets/updates', 'POST', queryParams);

        if(!response){
            return response;
        }

        var responseTickets = response.tickets;
        var tickets = [];
        var ticketVersionsObject = {
            ticketVersions: []
        };
        responseTickets.forEach(function(responseTicket){
            tickets.push(responseTicket);
            ticketVersionsObject.ticketVersions.push({
                ticketId: responseTicket.ticketId,
                version: responseTicket.version
            });
        });

        if(acknowledge === "true" && tickets.length > 0){
            acknowledgeTickets(ticketVersionsObject);
        }

        return tickets;
    }

    function acknowledgeTickets(tickets) {
        var response = sendRequest('tickets/acknowledge', 'POST', '', tickets);

        return response;
    }

    function getCloseCodesCommand(){
        var id = args['id'];
        var response = getCloseCodes(id);

        if(!response){
            return 'No results found';
        }

        response.ticketID = id;

        var translator = [
            {from: 'ticketID', to: 'ID' },
            {from: 'closeCodes', to: 'CloseCodes'} ];

        var entry = {
            Type: entryTypes.note,
            Contents: response,
            ContentsFormat: formats.json,
            ReadableContentsFormat: formats.markdown
        };

        var translated = cleanObject(mapObjFunction(translator)(response));

        entry.HumanReadable = tableToMarkdown('Secure works close codes response', translated);
        entry.EntryContext = {
            'SecureWorks.Ticket(val.ticketID==obj.ticketID)': response
        };

        return entry;
    }

    function getCloseCodes(ticketId){
        var response = sendRequest('tickets/' + ticketId + '/close-codes', 'GET');

        return response;
    }

    function markTicket(ticketId){
           var updateBody = {};
           updateBody[DIRTY_FIELD] = DIRTY_VALUE;

           sendRequest('tickets/' + ticketId, 'POST', '', updateBody);
    }

    function fetchIncidents(){
        var queryParams = {};
        if(params.ticketType){
            queryParams.ticketType = params.ticketType;
        }
        if(params.groupingType){
            queryParams.groupingType = params.groupingType;
        }
        if(params.worklogs){
            queryParams.worklogs = params.worklogs;
        }
        queryParams.limit = MAX_LIMIT;

        var getAttachments = params.attachments === 'true' ? true : false;

        if(!params.status || params.status.length == 0){
            throw 'Error! Cannot fetch tickets without a status';
        }

        var statuses = params.status.split(',');
        var tickets = [];
        var ticketVersionsObject = {
            ticketVersions: []
        };

        var responseTickets = getTicketsUpdates(false,
        queryParams.limit,
        queryParams.ticketType,
        queryParams.worklogs,
        queryParams.groupingType);

        var attachments = [];

        responseTickets.forEach(function(responseTicket){
            // Exclude health tickets
            var excludeHealthFilter = responseTicket.eventSource !== EVENT_SOURCE_HEALTH_TYPE &&
                responseTicket.categorizationClass !== CATEGORIZATION_CLASS_HEALTH_TYPE;
            // Exclude tickets that were marked using the designated field
            var excludeMarkedTickets = responseTicket[DIRTY_FIELD] !== DIRTY_VALUE;

            if(statuses.indexOf(responseTicket.status) !== -1 && excludeHealthFilter && excludeMarkedTickets){
                convertTicketDates(responseTicket);
                tickets.push(responseTicket);

                if(getAttachments){
                    var attachmentEntries = getTicketAttachmentsEntries(responseTicket);
                    attachments = attachmentEntries.map(function(entry){
                       return {
                           path: entry['FileID'],
                           name: entry['File']
                       }
                    });
                }

                ticketVersionsObject.ticketVersions.push({
                    ticketId: responseTicket.ticketId,
                    version: responseTicket.version
                });

                // Mark the designated field, so it's excluded next time
                markTicket(responseTicket.ticketId);
            }
        });

        var incidents = [];
        // convert tickets to demisto incidents
        if (tickets.length > 0) {
            acknowledgeTickets(ticketVersionsObject);
            tickets.forEach(function(ticket){
                var severity;
                switch(ticket.priority){
                    case 'LOW':
                        severity = 1;
                        break;
                    case 'MEDIUM':
                        severity = 2;
                        break;
                    case 'HIGH':
                        severity = 3;
                        break;
                    case 'CRITICAL':
                        severity = 4;
                        break;
                    default:
                        severity = 0;
                        break;
                }
                var incident = {
                    name: 'Secureworks - Ticket - ' + ticket.ticketId,
                    severity: severity,
                    details: ticket.detailedDescription,
                    occurred: new Date(ticket.dateCreated).toISOString(),
                    attachment: attachments,
                    rawJSON: JSON.stringify(ticket)
                };

                incidents.push(incident);
            });
        }

        return JSON.stringify(incidents);
    }

    var entry = {};
    switch(command){
        case 'test-module':
            var updates = getTicketsUpdates();
            return  updates ? 'ok' : 'not ok';
        case 'fetch-incidents':
            return fetchIncidents();
        case 'secure-works-create-ticket':
            entry = createTicketCommand();
            break;
        case 'secure-works-update-ticket':
            entry = updateTicketCommand();
            break;
        case 'secure-works-close-ticket':
            entry = closeTicketCommand();
            break;
        case 'secure-works-add-worklogs-ticket':
            entry = addTicketWorklogCommand();
            break;
        case 'secure-works-get-ticket':
            entry = getTicketCommand();
            break;
        case 'secure-works-assign-ticket':
            entry = assignTicketCommand();
            break;
        case 'secure-works-get-tickets-updates':
            entry = getTicketsUpdatesCommand();
            break;
        case 'secure-works-get-close-codes':
            entry = getCloseCodesCommand();
            break;
        case 'secure-works-get-tickets-ids':
            entry = getTicketsIdsCommand();
            break;
        case 'secure-works-get-ticket-count':
            entry = getTicketCountCommand();
            break;
    }

    return entry;
  type: javascript
system: true
